var editor;(()=>{"use strict";var t,e,s,i,a,n,o,r,h={82355:(t,e,s)=>{s.a(t,(async(t,i)=>{try{s.r(e),s.d(e,{Displacement:()=>n.UM,Gif:()=>n.TX,GifBuffer:()=>n.NT,Layer:()=>n.Wd,Mp4:()=>n.Ad,PXD:()=>n.l9,Stroke:()=>n.tc,ZipReader:()=>n.zg,ZipWriter:()=>n.Vx,__wbg_buffer_085ec1f694018c4f:()=>n.Qj,__wbg_height_c0440005f53e9792:()=>n.Qm,__wbg_new_4c0b35176d4e6c47:()=>n.HY,__wbg_newwithbyteoffsetandlength_a624c98280289b0f:()=>n.Zi,__wbg_set_wasm:()=>n.lI,__wbg_width_9a7937fdc4208452:()=>n.zP,__wbg_x_7af334499c70ecf9:()=>n._k,__wbg_y_7b2e0b17f2702db7:()=>n._4,__wbindgen_memory:()=>n.Py,__wbindgen_object_drop_ref:()=>n.bk,__wbindgen_string_new:()=>n.yc,__wbindgen_throw:()=>n.Qn,distanceTransform:()=>n.gC,distanceTransformInv:()=>n.TD});var a=s(46825),n=s(29821),o=t([a]);a=(o.then?(await o)():o)[0],(0,n.lI)(a),i()}catch(r){i(r)}}))},29821:(t,e,s)=>{s.d(e,{Ad:()=>I,HY:()=>G,NT:()=>D,Py:()=>H,Qj:()=>V,Qm:()=>q,Qn:()=>W,TD:()=>L,TX:()=>P,UM:()=>M,Vx:()=>N,Wd:()=>z,Zi:()=>$,_4:()=>O,_k:()=>B,bk:()=>X,gC:()=>T,l9:()=>F,lI:()=>n,tc:()=>_,yc:()=>j,zP:()=>U,zg:()=>R});var i=s(40963);let a;function n(t){a=t}t=s.hmd(t);const o=new Array(128).fill(void 0);o.push(void 0,null,!0,!1);let r=o.length;function h(t){r===o.length&&o.push(o.length+1);const e=r;return r=o[e],o[e]=t,e}function l(t){return o[t]}function c(t){const e=l(t);return function(t){t<132||(o[t]=r,r=t)}(t),e}let d=new("undefined"==typeof TextDecoder?(0,t.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});d.decode();let u=null;function p(){return null!==u&&0!==u.byteLength||(u=new Uint8Array(a.memory.buffer)),u}function g(t,e){return t>>>=0,d.decode(p().subarray(t,t+e))}let m=0;function v(t,e){const s=e(1*t.length,1)>>>0;return p().set(t,s/1),m=t.length,s}let y=new("undefined"==typeof TextEncoder?(0,t.require)("util").TextEncoder:TextEncoder)("utf-8");const f="function"==typeof y.encodeInto?function(t,e){return y.encodeInto(t,e)}:function(t,e){const s=y.encode(t);return e.set(s),{read:t.length,written:s.length}};function w(t,e,s){if(void 0===s){const s=y.encode(t),i=e(s.length,1)>>>0;return p().subarray(i,i+s.length).set(s),m=s.length,i}let i=t.length,a=e(i,1)>>>0;const n=p();let o=0;for(;o<i;o++){const e=t.charCodeAt(o);if(e>127)break;n[a+o]=e}if(o!==i){0!==o&&(t=t.slice(o)),a=s(a,i,i=o+3*t.length,1)>>>0;const e=p().subarray(a+o,a+i);o+=f(t,e).written}return m=o,a}let x=null;function b(){return null!==x&&0!==x.byteLength||(x=new Int32Array(a.memory.buffer)),x}let A=null;function k(t,e){return t>>>=0,(null!==A&&0!==A.byteLength||(A=new Uint8ClampedArray(a.memory.buffer)),A).subarray(t/1,t/1+e)}function S(t,e){return t>>>=0,p().subarray(t/1,t/1+e)}let E=null;function C(t,e){return t>>>=0,(null!==E&&0!==E.byteLength||(E=new Float32Array(a.memory.buffer)),E).subarray(t/4,t/4+e)}function T(t,e,s){try{const r=a.__wbindgen_add_to_stack_pointer(-16),h=v(s,a.__wbindgen_malloc),l=m;a.distanceTransform(r,t,e,h,l);var i=b()[r/4+0],n=b()[r/4+1],o=C(i,n).slice();return a.__wbindgen_free(i,4*n),o}finally{a.__wbindgen_add_to_stack_pointer(16)}}function L(t,e,s){try{const r=a.__wbindgen_add_to_stack_pointer(-16),h=v(s,a.__wbindgen_malloc),l=m;a.distanceTransformInv(r,t,e,h,l);var i=b()[r/4+0],n=b()[r/4+1],o=C(i,n).slice();return a.__wbindgen_free(i,4*n),o}finally{a.__wbindgen_add_to_stack_pointer(16)}}class M{static __wrap(t){t>>>=0;const e=Object.create(M.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();a.__wbg_displacement_free(t)}constructor(t,e,s,i,n,o){const r=v(t,a.__wbindgen_malloc),h=m,l=a.displacement_new(r,h,e,s,i,n,o);return M.__wrap(l)}beginStroke(){const t=a.displacement_beginStroke(this.__wbg_ptr);return _.__wrap(t)}setStampSize(t){a.displacement_setStampSize(this.__wbg_ptr,t)}setDensity(t){a.displacement_setDensity(this.__wbg_ptr,t)}setStrength(t){a.displacement_setStrength(this.__wbg_ptr,t)}retarget(t,e,s){const i=v(t,a.__wbindgen_malloc),n=m;a.displacement_retarget(this.__wbg_ptr,i,n,e,s)}setMode(t){const e=w(t,a.__wbindgen_malloc,a.__wbindgen_realloc),s=m;a.displacement_setMode(this.__wbg_ptr,e,s)}applyFast(t){return c(a.displacement_applyFast(this.__wbg_ptr,h(t)))}applyQuality(t){return c(a.displacement_applyQuality(this.__wbg_ptr,h(t)))}}class P{static __wrap(t){t>>>=0;const e=Object.create(P.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();a.__wbg_gif_free(t)}constructor(t,e,s){try{const o=a.__wbindgen_add_to_stack_pointer(-16);a.gif_new(o,t,e,s);var i=b()[o/4+0],n=b()[o/4+1];if(b()[o/4+2])throw c(n);return P.__wrap(i)}finally{a.__wbindgen_add_to_stack_pointer(16)}}addFrame(t,e,s){try{const n=a.__wbindgen_add_to_stack_pointer(-16),o=v(t,a.__wbindgen_malloc),r=m;a.gif_addFrame(n,this.__wbg_ptr,o,r,e,s);var i=b()[n/4+0];if(b()[n/4+1])throw c(i)}finally{a.__wbindgen_add_to_stack_pointer(16)}}takeResult(){try{const i=this.__destroy_into_raw(),n=a.__wbindgen_add_to_stack_pointer(-16);a.gif_takeResult(n,i);var t=b()[n/4+0],e=b()[n/4+1],s=k(t,e).slice();return a.__wbindgen_free(t,1*e),s}finally{a.__wbindgen_add_to_stack_pointer(16)}}}class D{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();a.__wbg_gifbuffer_free(t)}}class z{static __wrap(t){t>>>=0;const e=Object.create(z.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();a.__wbg_layer_free(t)}get kind(){let t,e;try{const n=a.__wbindgen_add_to_stack_pointer(-16);a.layer_kind(n,this.__wbg_ptr);var s=b()[n/4+0],i=b()[n/4+1];return t=s,e=i,g(s,i)}finally{a.__wbindgen_add_to_stack_pointer(16),a.__wbindgen_free(t,e,1)}}get x(){return a.layer_x(this.__wbg_ptr)}get y(){return a.layer_y(this.__wbg_ptr)}get name(){let t,e;try{const n=a.__wbindgen_add_to_stack_pointer(-16);a.layer_name(n,this.__wbg_ptr);var s=b()[n/4+0],i=b()[n/4+1];return t=s,e=i,g(s,i)}finally{a.__wbindgen_add_to_stack_pointer(16),a.__wbindgen_free(t,e,1)}}get width(){return a.layer_width(this.__wbg_ptr)}get height(){return a.layer_height(this.__wbg_ptr)}get alpha(){return a.layer_alpha(this.__wbg_ptr)}get blendMode(){let t,e;try{const n=a.__wbindgen_add_to_stack_pointer(-16);a.layer_blendMode(n,this.__wbg_ptr);var s=b()[n/4+0],i=b()[n/4+1];return t=s,e=i,g(s,i)}finally{a.__wbindgen_add_to_stack_pointer(16),a.__wbindgen_free(t,e,1)}}get visible(){return 0!==a.layer_visible(this.__wbg_ptr)}get locked(){return 0!==a.layer_locked(this.__wbg_ptr)}get rotation(){return a.layer_rotation(this.__wbg_ptr)}takeCanvas(){try{const i=a.__wbindgen_add_to_stack_pointer(-16);a.layer_takeCanvas(i,this.__wbg_ptr);var t=b()[i/4+0],e=b()[i/4+1],s=k(t,e).slice();return a.__wbindgen_free(t,1*e),s}finally{a.__wbindgen_add_to_stack_pointer(16)}}takeMask(){try{const i=a.__wbindgen_add_to_stack_pointer(-16);a.layer_takeMask(i,this.__wbg_ptr);var t=b()[i/4+0],e=b()[i/4+1],s=k(t,e).slice();return a.__wbindgen_free(t,1*e),s}finally{a.__wbindgen_add_to_stack_pointer(16)}}get meta(){let t,e;try{const n=a.__wbindgen_add_to_stack_pointer(-16);a.layer_meta(n,this.__wbg_ptr);var s=b()[n/4+0],i=b()[n/4+1];return t=s,e=i,g(s,i)}finally{a.__wbindgen_add_to_stack_pointer(16),a.__wbindgen_free(t,e,1)}}}class I{static __wrap(t){t>>>=0;const e=Object.create(I.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();a.__wbg_mp4_free(t)}constructor(t){try{const i=a.__wbindgen_add_to_stack_pointer(-16);a.mp4_new(i,t);var e=b()[i/4+0],s=b()[i/4+1];if(b()[i/4+2])throw c(s);return I.__wrap(e)}finally{a.__wbindgen_add_to_stack_pointer(16)}}addVideoTrack(t,e,s){try{const o=a.__wbindgen_add_to_stack_pointer(-16),r=v(s,a.__wbindgen_malloc),h=m;a.mp4_addVideoTrack(o,this.__wbg_ptr,t,e,r,h);var i=b()[o/4+0],n=b()[o/4+1];if(b()[o/4+2])throw c(n);return i>>>0}finally{a.__wbindgen_add_to_stack_pointer(16)}}addFrame(t,e,s,i,n,o){try{const h=a.__wbindgen_add_to_stack_pointer(-16),l=v(o,a.__wbindgen_malloc),d=m;a.mp4_addFrame(h,this.__wbg_ptr,t,e,s,i,n,l,d);var r=b()[h/4+0];if(b()[h/4+1])throw c(r)}finally{a.__wbindgen_add_to_stack_pointer(16)}}fetchFile(){try{const n=this.__destroy_into_raw(),o=a.__wbindgen_add_to_stack_pointer(-16);a.mp4_fetchFile(o,n);var t=b()[o/4+0],e=b()[o/4+1],s=b()[o/4+2];if(b()[o/4+3])throw c(s);var i=S(t,e).slice();return a.__wbindgen_free(t,1*e),i}finally{a.__wbindgen_add_to_stack_pointer(16)}}}class F{static __wrap(t){t>>>=0;const e=Object.create(F.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();a.__wbg_pxd_free(t)}get width(){return a.__wbg_get_pxd_width(this.__wbg_ptr)}set width(t){a.__wbg_set_pxd_width(this.__wbg_ptr,t)}get height(){return a.__wbg_get_pxd_height(this.__wbg_ptr)}set height(t){a.__wbg_set_pxd_height(this.__wbg_ptr,t)}get layers(){return a.__wbg_get_pxd_layers(this.__wbg_ptr)}set layers(t){a.__wbg_set_pxd_layers(this.__wbg_ptr,t)}static decode(t){try{const i=a.__wbindgen_add_to_stack_pointer(-16),n=v(t,a.__wbindgen_malloc),o=m;a.pxd_decode(i,n,o);var e=b()[i/4+0],s=b()[i/4+1];if(b()[i/4+2])throw c(s);return F.__wrap(e)}finally{a.__wbindgen_add_to_stack_pointer(16)}}takeNextLayer(){try{const s=a.__wbindgen_add_to_stack_pointer(-16);a.pxd_takeNextLayer(s,this.__wbg_ptr);var t=b()[s/4+0],e=b()[s/4+1];if(b()[s/4+2])throw c(e);return z.__wrap(t)}finally{a.__wbindgen_add_to_stack_pointer(16)}}}class _{static __wrap(t){t>>>=0;const e=Object.create(_.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();a.__wbg_stroke_free(t)}push(t,e,s){return c(a.stroke_push(this.__wbg_ptr,t,e,s))}}class R{static __wrap(t){t>>>=0;const e=Object.create(R.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();a.__wbg_zipreader_free(t)}constructor(t){try{const i=a.__wbindgen_add_to_stack_pointer(-16),n=v(t,a.__wbindgen_malloc),o=m;a.zipreader_new(i,n,o);var e=b()[i/4+0],s=b()[i/4+1];if(b()[i/4+2])throw c(s);return R.__wrap(e)}finally{a.__wbindgen_add_to_stack_pointer(16)}}readFile(t){try{const o=a.__wbindgen_add_to_stack_pointer(-16),r=w(t,a.__wbindgen_malloc,a.__wbindgen_realloc),h=m;a.zipreader_readFile(o,this.__wbg_ptr,r,h);var e=b()[o/4+0],s=b()[o/4+1],i=b()[o/4+2];if(b()[o/4+3])throw c(i);var n=S(e,s).slice();return a.__wbindgen_free(e,1*s),n}finally{a.__wbindgen_add_to_stack_pointer(16)}}readString(t){let e,s;try{const d=a.__wbindgen_add_to_stack_pointer(-16),u=w(t,a.__wbindgen_malloc,a.__wbindgen_realloc),p=m;a.zipreader_readString(d,this.__wbg_ptr,u,p);var i=b()[d/4+0],n=b()[d/4+1],o=b()[d/4+2],r=b()[d/4+3],h=i,l=n;if(r)throw h=0,l=0,c(o);return e=h,s=l,g(h,l)}finally{a.__wbindgen_add_to_stack_pointer(16),a.__wbindgen_free(e,s,1)}}}class N{static __wrap(t){t>>>=0;const e=Object.create(N.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();a.__wbg_zipwriter_free(t)}constructor(){const t=a.zipwriter_new();return N.__wrap(t)}writeFile(t,e,s){try{const n=a.__wbindgen_add_to_stack_pointer(-16),o=w(t,a.__wbindgen_malloc,a.__wbindgen_realloc),r=m,h=v(e,a.__wbindgen_malloc),l=m;a.zipwriter_writeFile(n,this.__wbg_ptr,o,r,h,l,s);var i=b()[n/4+0];if(b()[n/4+1])throw c(i)}finally{a.__wbindgen_add_to_stack_pointer(16)}}writeString(t,e,s){try{const n=a.__wbindgen_add_to_stack_pointer(-16),o=w(t,a.__wbindgen_malloc,a.__wbindgen_realloc),r=m,h=w(e,a.__wbindgen_malloc,a.__wbindgen_realloc),l=m;a.zipwriter_writeFile(n,this.__wbg_ptr,o,r,h,l,s);var i=b()[n/4+0];if(b()[n/4+1])throw c(i)}finally{a.__wbindgen_add_to_stack_pointer(16)}}finish(){try{const n=this.__destroy_into_raw(),o=a.__wbindgen_add_to_stack_pointer(-16);a.zipwriter_finish(o,n);var t=b()[o/4+0],e=b()[o/4+1],s=b()[o/4+2];if(b()[o/4+3])throw c(s);var i=S(t,e).slice();return a.__wbindgen_free(t,1*e),i}finally{a.__wbindgen_add_to_stack_pointer(16)}}}function B(t){return l(t).x}function O(t){return l(t).y}function U(t){return l(t).width}function q(t){return l(t).height}function H(){return h(a.memory)}function V(t){return h(l(t).buffer)}function $(t,e,s){return h(new Uint8ClampedArray(l(t),e>>>0,s>>>0))}function X(t){c(t)}function G(t,e,s,a){return h(new i.A(t,e,s,a))}function j(t,e){return h(g(t,e))}function W(t,e){throw new Error(g(t,e))}},38665:(t,e,s)=>{s.d(e,{P:()=>n});var i=s(54738),a=(s(23556),s(6395));async function n(t){const e=await fetch("/api/auth/ai/remove-background/"),s=await e.json();if(!1===s.status)throw new Error(s.message);const n=new AbortController,{signal:o}=n,r=i.H5(t,640,640),h=await i.PG(r,{type:"image/jpeg",quality:.8}),l=new FormData;l.append("image_file",new File([h],"file.jpg"));const c=await fetch("/api/ai/remove-background/",{method:"POST",headers:{authorizationtoken:s.data,Accept:"application/json"},body:l,signal:o}),d=await c.json();if(!d.status)throw new Error(d.error);return await(0,a.kw)("data:image/jpeg;base64,"+d.data)}},98244:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(29755),a=s(79453);const n=(t,e)=>{var s,n,o;"undefined"==typeof gtag||(null!==(n=null===(s=window.dataLayer)||void 0===s?void 0:s.length)&&void 0!==n?n:0)>1e3||gtag("event",t,{product:i.Ay.product,user_type:null!==(o=null===a.N||void 0===a.N?void 0:a.N.type)&&void 0!==o?o:"guest",label:e})}},52038:(t,e,s)=>{s.d(e,{A:()=>o});var i=s(28153),a=s(76315);class n{constructor(t=!1,e=void 0,s=void 0,i=void 0,a=void 0){this.block=t,this.enter=e,this.scene=s,this.exit=i,this.stagger=a}}n.fromInjection=(t,e)=>{let s=e?n.clone(e):new n;if(s.block=!1,!t)return s;if(t.enter&&(s.enter&&(t.enter.delay=s.enter.delay,t.enter.speed=s.enter.speed),s.enter=t.enter,s.enter.duration=s.enter.duration?s.enter.duration:n.getMotionsDuration(s.enter.motions)),t.scene&&(s.scene&&(t.scene.delay=s.scene.delay,t.scene.speed=s.scene.speed,t.scene.repeat=s.scene.repeat,t.scene.gap=s.scene.gap),s.scene=t.scene,s.scene.motions)){let t=n.getMotionsDuration(s.scene.motions);s.scene.duration=t+s.scene.repeat*(t+s.scene.gap)}return t.exit&&(s.exit&&(t.exit.delay=s.exit.delay,t.exit.speed=s.exit.speed),s.exit=t.exit,s.exit.duration=n.getMotionsDuration(s.exit.motions)),t.stagger&&(s.stagger=t.stagger),s},n.getSegment=(t,e)=>{if(e)switch(t){case"enter":return e.enter;case"scene":return e.scene;case"exit":return e.exit}},n.setSegmentSpeed=(t,e)=>{if(!t)return;t.speed=e;let s=n.getMotionsDuration(t.motions,t.speed);t.duration=s+t.repeat*(s+t.gap)},n.setSegmentRepeat=(t,e)=>{if(!t)return;let s=n.getMotionsDuration(t.motions,t.speed);t.repeat=e,t.duration=s+e*(s+t.gap)},n.setSegmentGap=(t,e)=>{if(!t)return;let s=n.getMotionsDuration(t.motions,t.speed);t.gap=e,t.duration=s+t.repeat*(s+t.gap)},n.getAnimationSegment=(t,e)=>{if(!e)return;const s=new n(e.block);return"enter"===t&&(s.enter=new i.A(e.enter.name,[...e.enter.motions],e.enter.option,e.enter.duration,e.enter.delay,e.enter.speed,e.enter.repeat,e.enter.gap)),"scene"===t&&(s.scene=new i.A(e.scene.name,[...e.scene.motions],e.scene.option,e.scene.duration,e.scene.delay,e.scene.speed,e.scene.repeat,e.scene.gap)),"exit"===t&&(s.exit=new i.A(e.exit.name,[...e.exit.motions],e.exit.option,e.exit.duration,e.exit.delay,e.exit.speed,e.exit.repeat,e.exit.gap)),s},n.getMotionsDuration=(t,e=1)=>{if(!t||0===t.length)return 0;let s=0;for(const i of t)s=Math.max(s,Math.round((i.delay+i.duration)*e));return s},n.clone=t=>{if(!t)return;const e=new n(t.block);return t.enter&&(e.enter=new i.A(t.enter.name,[...t.enter.motions],t.enter.option,t.enter.duration,t.enter.delay,t.enter.speed,t.enter.repeat,t.enter.gap)),t.scene&&(e.scene=new i.A(t.scene.name,[...t.scene.motions],t.scene.option,t.scene.duration,t.scene.delay,t.scene.speed,t.scene.repeat,t.scene.gap)),t.exit&&(e.exit=new i.A(t.exit.name,[...t.exit.motions],t.exit.option,t.exit.duration,t.exit.delay,t.exit.speed,t.exit.repeat,t.exit.gap)),t.stagger&&(e.stagger=new a.A(t.stagger.duration,t.stagger.metod)),e};const o=n},26931:(t,e,s)=>{s.d(e,{A:()=>u});var i=s(53900),a=s(41915),n=s(15818),o=s(23556),r=s(73897),h=s(54127),l=s(76315),c=s(52038);class d{constructor(t,e){this.scantime=0,this.scantype="none",this.getDuration=()=>{let t=0;return this.transitions.forEach((e=>{t=Math.max(t,e.getDuration())})),t},this.prepare=t=>{for(const e of this.transitions)e.motion.fill&&(e.begin(this.getProperty(e.motion.method,t)),this.setProperty(e.motion.method,e.motion.manner,t,e.step(0)))},this.step=(t,e)=>{for(const s of this.transitions)s.shouldRun(t)&&(s.playing||s.begin(this.getProperty(s.motion.method,e)),this.setProperty(s.motion.method,s.motion.manner,e,s.step(t)))},this.setProperty=(t,e,s,i)=>{switch(t){case"opacity":this.layer.transform.opacity=i;break;case"rotate":this.layer.transform.rotation=360*i,this.layer.transform.rAnchor=this.anchorToPoint(e);break;case"scale":this.layer.transform.scale.x=i,this.layer.transform.scale.y=i,this.layer.transform.sAnchor=this.anchorToPoint(e);break;case"scale-width":this.layer.transform.scale.x=i,this.layer.transform.sAnchor=this.anchorToPoint(e);break;case"scale-height":this.layer.transform.scale.y=i,this.layer.transform.sAnchor=this.anchorToPoint(e);break;case"self-x":this.layer.transform.offset.x=i*this.layer.getRect().width;break;case"self-y":this.layer.transform.offset.y=i*this.layer.getRect().height;break;case"offset-x":this.layer.transform.offset.x=i*s.width;break;case"offset-y":this.layer.transform.offset.y=i*s.height;break;case"viewport-x":this.layer.transform.offset.x=i*s.width-this.layer.getRect().center().x;break;case"viewport-y":this.layer.transform.offset.y=i*s.height-this.layer.getRect().center().y;break;case"viewport-box-x":const a=this.transformedRectWidth();this.layer.transform.offset.x=this.layer.getRect().center().x-(.5*a+i*(s.width-a));break;case"viewport-box-y":const n=this.transformedRectHeight();this.layer.transform.offset.y=this.layer.getRect().center().y-(.5*n+i*(s.height-n));break;default:this.setShader(t,i,e)}},this.transformedRectWidth=()=>this.layer.getRect().width*this.layer.transform.scale.x,this.transformedRectHeight=()=>this.layer.getRect().height*this.layer.transform.scale.y,this.anchorToPoint=t=>{switch(t){case"topleft":return new a.A(0,0);case"top":return new a.A(.5,0);case"topright":return new a.A(1,0);case"left":return new a.A(0,.5);case"center":return new a.A(.5,.5);case"right":return new a.A(1,.5);case"bottomleft":return new a.A(0,1);case"bottom":return new a.A(.5,1);case"bottomright":return new a.A(1,1)}return new a.A(.5,.5)},this.setShader=(t,e,s)=>{switch(this.shaders||(this.shaders=new o.A),t){case"wipe":this.shaders.addShader("wipe",{direction:s,amount:e});break;case"swipe":this.shaders.addShader("swipe",{direction:s,amount:e,color:this.getLayerAccent()});break;case"slot":this.shaders.addShader("slot",{direction:s,amount:e});break;case"blinds":this.shaders.addShader("blinds",{direction:s,amount:e});break;case"melt":this.shaders.addShader("melt",{direction:s,amount:e});break;case"warp":this.shaders.addShader("warp",{direction:s,amount:e});break;case"curtain":this.shaders.addShader("curtain",{direction:s,amount:e});break;case"split":this.shaders.addShader("split",{direction:s,sections:2,amount:e});break;case"line":this.shaders.addShader("split",{direction:s,sections:8,amount:e});break;case"marquee":this.shaders.addShader("marquee",{direction:s,amount:e});break;default:this.shaders.addShader(t,e)}this.layer.transient=this.shaders.apply(this.layer.baked?this.layer.baked:this.layer.canvas)},this.getLayerAccent=()=>this.layer instanceof h.A&&"color"===this.layer.fill.getType()?this.layer.fill.value:new n.A(255,255,255),this.getProperty=(t,e)=>{switch(t){case"opacity":return this.layer.transform.opacity;case"rotate":return this.layer.transform.rotation/360;case"scale":case"scale-width":return this.layer.transform.scale.x;case"scale-height":return this.layer.transform.scale.y;case"self-x":return this.layer.transform.offset.x/this.layer.getRect().width;case"self-y":return this.layer.transform.offset.y/this.layer.getRect().height;case"offset-x":return this.layer.transform.offset.x/e.width;case"offset-y":return this.layer.transform.offset.y/e.height;case"viewport-x":return(this.layer.getRect().center().x+this.layer.transform.offset.x)/e.width;case"viewport-y":return(this.layer.getRect().center().y+this.layer.transform.offset.y)/e.height;case"viewport-box-x":return(this.layer.getRect().center().x+this.layer.transform.offset.x)/(e.width-this.transformedRectWidth());case"viewport-box-y":return(this.layer.getRect().center().y+this.layer.transform.offset.y)/(e.height-this.transformedRectHeight())}return 0},this.finish=()=>{this.layer.transient=void 0,this.layer.transform=void 0},this.layer=t,this.transitions=e,this.layer.transform={sAnchor:new a.A(.5,.5),rAnchor:new a.A(.5,.5),scale:new a.A(1,1),offset:new a.A(0,0),rotation:0,opacity:1}}}d.bakeAnimators=t=>{const e=new Array;for(const s of t.layers)if(s.rect)if(!s.animation&&t.animation){const i=d.createPageTransitions(s,t,t.animation);i.length>0&&e.push(new d(s,i))}else if(s.animation&&!s.animation.block){const t=d.createLayerTransitions(s.animation);e.push(new d(s,t))}return e},d.createPageTransitions=(t,e,s)=>{const a=e.layerNr(t.id),n=e.layers.length,o=new i.A(e.width,e.height),h=d.filterMotions(s.enter,t,a,n,o),c=d.filterMotions(s.scene,t,a,n,o),u=d.filterMotions(s.exit,t,a,n,o);if(!h&&!c&&!u&&0===h.length&&0===c.length&&0===u.length)return;const p=0===a&&t.settings.locked?0:l.A.getOffset(t,e,s.stagger),g=s.enter?s.enter.duration+s.enter.delay:0,m=s.scene?s.scene.duration+s.scene.delay:0,v=new Array;if(h)for(const i of h)v.push(new r.A(i,s.enter.speed,s.enter.delay+p));if(c)for(const i of c)v.push(new r.A(i,s.scene.speed,s.scene.delay+p+g));if(u)for(const i of u)v.push(new r.A(i,s.exit.speed,s.enter.delay+p+g+m));return v},d.createLayerTransitions=(t,e=!1)=>{const s=!!t.enter,i=!!t.scene,a=new Array;let n=s?t.enter.duration:0,o=i?t.scene.duration:0;if(!e&&s&&(n+=t.enter.delay),(e&&s&&i||!e&&i)&&(o+=t.scene.delay),t.enter){const s=e?0:t.enter.delay;for(const e of t.enter.motions)a.push(new r.A(e,t.enter.speed,s))}if(t.scene){const i=e&&!s?0:t.scene.delay;for(const e of t.scene.motions)a.push(new r.A(e,t.scene.speed,i+n));if(t.scene.repeat>0){let e=c.A.getMotionsDuration(t.scene.motions,t.scene.speed),s=e+t.scene.gap;for(let o=0;o<t.scene.repeat;o++){for(const e of t.scene.motions)a.push(new r.A(e,t.scene.speed,s+i+n));s+=e+t.scene.gap}}}if(t.exit){const h=!e||s||i?t.exit.delay:0;for(const e of t.exit.motions)a.push(new r.A(e,t.exit.speed,h+n+o))}return a},d.createSegmentTransitions=t=>{const e=new Array;if(t)for(const s of t.motions)e.push(new r.A(s,t.speed));return e},d.filterMotions=(t,e,s,i,a)=>{if(!t||!t.motions||0===t.motions.length)return;let n;for(const o of t.motions)if(d.filterMotion(e,s,i,a,o)){n=o.filter;break}return t.motions.filter((t=>t.filter===n))},d.filterMotion=(t,e,s,i,a)=>{if("background"===a.filter)return 0===e&&t.settings.locked;if(0===e&&t.settings.locked)return!1;if("foreground"===a.filter)return e===s-1;if("all"===a.filter||a.filter===t.type)return!0;if("large"===a.filter)return t.getRect().width>.75*i.width||t.getRect().height>.75*i.height;if("medium"===a.filter)return t.getRect().width>.25*i.width&&t.getRect().width<.75*i.width&&t.getRect().height>.25*i.height&&t.getRect().height<.75*i.height;if("small"===a.filter)return t.getRect().width<.25*i.width||t.getRect().height<.25*i.height;switch(a.filter){case"odd":return e%2==1;case"even":return e%2==0;case"1-three":return e%3==0;case"2-three":return e%3==1;case"3-three":return e%3==2;case"1-four":return e%4==0;case"2-four":return e%4==1;case"3-four":return e%4==2;case"4-four":return e%4==3}};const u=d},51532:(t,e,s)=>{s.d(e,{A:()=>a});class i{constructor(t){switch(this.type=t,this.type){case i.EASE_LINEAR:this.calculate=i.linear;break;case i.EASE_TWENTY_LADDER:this.calculate=i.ladderTwenty;break;case i.EASE_TEN_LADDER:this.calculate=i.ladderTen;break;case i.EASE_FIVE_LADDER:this.calculate=i.ladderFive;break;case i.EASE_THREE_LADDER:this.calculate=i.ladderThree;break;case i.EASE_IN_SINE:this.calculate=i.inSine;break;case i.EASE_OUT_SINE:this.calculate=i.outSine;break;case i.EASE_IN_OUT_SINE:this.calculate=i.inOutSine;break;case i.EASE_IN_CUBIC:this.calculate=i.inCubic;break;case i.EASE_OUT_CUBIC:this.calculate=i.outCubic;break;case i.EASE_IN_OUT_CUBIC:this.calculate=i.inOutCubic;break;case i.EASE_IN_QUINT:this.calculate=i.inQuint;break;case i.EASE_OUT_QUINT:this.calculate=i.outQuint;break;case i.EASE_IN_OUT_QUINT:this.calculate=i.inOutQuint;break;case i.EASE_IN_CIRC:this.calculate=i.inCirc;break;case i.EASE_OUT_CIRC:this.calculate=i.outCirc;break;case i.EASE_IN_OUT_CIRC:this.calculate=i.inOutCirc;break;case i.EASE_IN_QUAD:this.calculate=i.inQuad;break;case i.EASE_OUT_QUAD:this.calculate=i.outQuad;break;case i.EASE_IN_OUT_QUAD:this.calculate=i.inOutQuad;break;case i.EASE_IN_QUART:this.calculate=i.inQuart;break;case i.EASE_OUT_QUART:this.calculate=i.outQuart;break;case i.EASE_IN_OUT_QUART:this.calculate=i.inOutQuart;break;case i.EASE_IN_EXPO:this.calculate=i.inExpo;break;case i.EASE_OUT_EXPO:this.calculate=i.outExpo;break;case i.EASE_IN_OUT_EXPO:this.calculate=i.inOutExpo;break;case i.EASE_IN_BACK:this.calculate=i.inBack;break;case i.EASE_OUT_BACK:this.calculate=i.outBack;break;case i.EASE_IN_OUT_BACK:this.calculate=i.inOutBack;break;case i.EASE_IN_BOUNCE:this.calculate=i.inBounce;break;case i.EASE_OUT_BOUNCE:this.calculate=i.outBounce;break;case i.EASE_IN_OUT_BOUNCE:this.calculate=i.inOutBounce;break;case i.EASE_IN_ELASTIC:this.calculate=i.inElastic;break;case i.EASE_OUT_ELASTIC:this.calculate=i.outElastic;break;case i.EASE_IN_OUT_ELASTIC:this.calculate=i.inOutElastic}}static inOutQuint(t){return t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2}static outCirc(t){return Math.sqrt(1-Math.pow(t-1,2))}static inOutCirc(t){return t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2}}i.EASE_LINEAR="linear",i.EASE_TWENTY_LADDER="twenty-ladder",i.EASE_TEN_LADDER="ten-ladder",i.EASE_FIVE_LADDER="five-ladder",i.EASE_THREE_LADDER="three-ladder",i.EASE_IN_SINE="in-sine",i.EASE_OUT_SINE="out-sine",i.EASE_IN_OUT_SINE="in-out-sine",i.EASE_IN_CUBIC="in-cubic",i.EASE_OUT_CUBIC="out-cubic",i.EASE_IN_OUT_CUBIC="in-out-cubic",i.EASE_IN_QUINT="in-quint",i.EASE_OUT_QUINT="out-quint",i.EASE_IN_OUT_QUINT="in-out-quint",i.EASE_IN_CIRC="in-circ",i.EASE_OUT_CIRC="out-circ",i.EASE_IN_OUT_CIRC="in-out-circ",i.EASE_IN_QUAD="in-quad",i.EASE_OUT_QUAD="out-quad",i.EASE_IN_OUT_QUAD="in-out-quad",i.EASE_IN_QUART="in-quart",i.EASE_OUT_QUART="out-quart",i.EASE_IN_OUT_QUART="in-out-quart",i.EASE_IN_EXPO="in-expo",i.EASE_OUT_EXPO="out-expo",i.EASE_IN_OUT_EXPO="in-out-expo",i.EASE_IN_BACK="in-back",i.EASE_OUT_BACK="out-back",i.EASE_IN_OUT_BACK="in-out-back",i.EASE_IN_BOUNCE="in-bounce",i.EASE_OUT_BOUNCE="out-bounce",i.EASE_IN_OUT_BOUNCE="in-out-bounce",i.EASE_IN_ELASTIC="in-elastic",i.EASE_OUT_ELASTIC="out-elastic",i.EASE_IN_OUT_ELASTIC="in-out-elastic",i.linear=t=>t,i.ladderTwenty=t=>i.ladder(t,20),i.ladderTen=t=>i.ladder(t,10),i.ladderFive=t=>i.ladder(t,5),i.ladderThree=t=>i.ladder(t,3),i.ladder=(t,e)=>Math.ceil(t*e)*(1/e),i.inSine=t=>1-Math.cos(t*Math.PI/2),i.outSine=t=>Math.sin(t*Math.PI/2),i.inOutSine=t=>-(Math.cos(Math.PI*t)-1)/2,i.inCubic=t=>t*t*t,i.outCubic=t=>1-Math.pow(1-t,3),i.inOutCubic=t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,i.inQuint=t=>t*t*t*t*t,i.outQuint=t=>1-Math.pow(1-t,5),i.inCirc=t=>1-Math.sqrt(1-Math.pow(t,2)),i.inQuad=t=>t*t,i.outQuad=t=>1-(1-t)*(1-t),i.inOutQuad=t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,i.inQuart=t=>t*t*t*t,i.outQuart=t=>1-Math.pow(1-t,4),i.inOutQuart=t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,i.inExpo=t=>0===t?0:Math.pow(2,10*t-10),i.outExpo=t=>1===t?1:1-Math.pow(2,-10*t),i.inOutExpo=t=>0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,i.inBack=t=>{const e=1.70158;return 2.70158*t*t*t-e*t*t},i.outBack=t=>{const e=1.70158;return 1+2.70158*Math.pow(t-1,3)+e*Math.pow(t-1,2)},i.inOutBack=t=>{const e=2.5949095;return t<.5?Math.pow(2*t,2)*(7.189819*t-e)/2:(Math.pow(2*t-2,2)*((e+1)*(2*t-2)+e)+2)/2},i.inBounce=t=>1-i.outBounce(1-t),i.outBounce=t=>{const e=7.5625,s=2.75;return t<1/s?e*t*t:t<2/s?e*(t-=1.5/s)*t+.75:t<2.5/s?e*(t-=2.25/s)*t+.9375:e*(t-=2.625/s)*t+.984375},i.inOutBounce=t=>t<.5?(1-i.outBounce(1-2*t))/2:(1+i.outBounce(2*t-1))/2,i.inElastic=t=>{const e=2*Math.PI/3;return 0===t?0:1===t?1:-Math.pow(2,10*t-10)*Math.sin((10*t-10.75)*e)},i.outElastic=t=>{const e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1},i.inOutElastic=t=>{const e=2*Math.PI/4.5;return 0===t?0:1===t?1:t<.5?-Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*e)/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*e)/2+1};const a=i},28153:(t,e,s)=>{s.d(e,{A:()=>a});class i{constructor(t,e,s,a=0,n=0,o=i.SPEED_NORMAL,r=0,h=0){this.name=t,this.motions=e,this.option=s,this.duration=a,this.delay=n,this.speed=o,this.repeat=r,this.gap=h}}i.SPEED_SNAIL=3,i.SPEED_SLOW=2,i.SPEED_NORMAL=1,i.SPEED_FAST=.5,i.SPEED_FLASH=.25;const a=i},76315:(t,e,s)=>{s.d(e,{A:()=>o});var i=s(54738),a=s(41915);class n{constructor(t,e="top"){this.duration=t,this.metod=e}}n.getOffset=(t,e,s)=>{let n=0;if(void 0===s||0===s.duration||!t.rect)return n;switch(s.metod){case"top":n=t.getRect().y/e.height;break;case"bottom":n=1-t.getRect().y/e.height;break;case"left":n=t.getRect().x/e.width;break;case"right":n=1-t.getRect().x/e.width;break;case"back":n=e.layerNr(t.id)/e.layers.length;break;case"front":n=1-e.layerNr(t.id)/e.layers.length;break;case"center":n=new a.A(e.width/2,e.height/2).distanceTo(t.getRect().center())/Math.sqrt(e.width*e.width+e.height*e.height)/2;break;case"bounds":n=1-new a.A(e.width/2,e.height/2).distanceTo(t.getRect().center())/Math.sqrt(e.width*e.width+e.height*e.height)/2}return Math.round((0,i.qE)(n*s.duration,0,s.duration))};const o=n},56709:(t,e,s)=>{s.d(e,{A:()=>o});var i=s(54738),a=s(53900),n=s(26931);class o{constructor(t,e=24,s=1,o=!1,r=!1){this.requestFrame=async()=>{if(this.currentFrame+=1,this.currentFrame>this.totalFrames)return void this.cancel();const t=this.currentFrame*this.interval,e=new a.A(this.fresco.width,this.fresco.height);for(const s of this.animators)s.step(t,e);return this.stage.renderOutputFrame(this.ctx,this.inclusive,this.transparency),1!==this.scale?(await i.D9(),await i.j4(this.output,this.scaled.width,this.scaled.height,this.scaled)):this.output},this.cancel=()=>{if(this.animators)for(const t of this.animators)t.finish()},this.scale=s,this.stage=t,this.fresco=t.fresco,this.inclusive=r,this.transparency=o,this.animators=[];let h=this.fresco.width,l=this.fresco.height;if(h%2==1&&(h-=1),l%2==1&&(l-=1),this.output=i.Nw(h,l),1!==s){let t=Math.round(this.fresco.width*s),e=Math.round(this.fresco.height*s);t%2==1&&(t-=1),e%2==1&&(e-=1),this.scaled=i.Nw(t,e)}this.ctx=this.output.getContext("2d"),this.animators=n.A.bakeAnimators(t.fresco),this.runTime=0;for(const i of this.animators)this.runTime=Math.max(this.runTime,i.getDuration()),i.prepare(new a.A(this.fresco.width,this.fresco.height));this.currentFrame=0,this.interval=1e3/e,this.totalFrames=Math.ceil((this.runTime+50)/1e3)*e}}},73897:(t,e,s)=>{s.d(e,{A:()=>a});var i=s(51532);class a{constructor(t,e,s=0){this.shouldRun=t=>{const e=t<this.idelay,s=t>this.idelay+this.iduration;return s&&!this.end?(this.end=!0,!0):!e&&!s},this.getDuration=()=>this.idelay+this.iduration,this.fill=t=>{this.initial=void 0===this.motion.value.set?t:this.motion.value.set;const e=void 0===this.motion.value.from?this.initial:this.motion.value.from,s=void 0===this.motion.value.to?this.initial:this.motion.value.to;return 2===this.motion.direction||4===this.motion.direction?s-(s-e):e+(s-e)},this.begin=t=>{this.end=!1,this.playing=!0,this.initial=void 0===this.motion.value.set?t:this.motion.value.set,this.ibefore=void 0===this.motion.value.from?this.initial:this.motion.value.from,this.iafter=void 0===this.motion.value.to?this.initial:this.motion.value.to},this.step=t=>{if(0===t||t-this.idelay<1||0===this.ipass||0===this.motion.iterations)return this.ibefore;let e=Math.ceil((t-this.idelay)/this.ipass),s=(t-this.idelay)%this.ipass,i=0===s?1:s/this.ipass;(this.end||e>this.motion.iterations)&&(e=this.motion.iterations,i=1);const a=(this.iafter-this.ibefore)*this.ease.calculate(i);return this.flip(e)?this.iafter-a:this.ibefore+a},this.flip=t=>2===this.motion.direction||3===this.motion.direction&&t%2==0||4===this.motion.direction&&t%2==1,this.motion=t,this.ease=new i.A(t.easing),this.idelay=Math.round(this.motion.delay*e+s),this.iduration=Math.round(this.motion.duration*e),this.ipass=0===this.iduration||0===this.motion.iterations?0:this.iduration/this.motion.iterations}}},78508:(t,e,s)=>{s.d(e,{In:()=>n,Pe:()=>d,Vi:()=>h,Wv:()=>l,X6:()=>u,XC:()=>o,_t:()=>p,gs:()=>r,sG:()=>c,xs:()=>g});var i=s(79453),a=s(42268);async function n(t,e="GET",s={},i=!1){try{const n={"Content-Type":"application/json"};i&&(n.Authorization=`Bearer ${(0,a.lR)("__pat","")}`);const o={method:e,headers:n};"GET"!==e&&(o.body=JSON.stringify(s));const r=await fetch(t,o);return await r.json()}catch(n){return console.error(n),{status:!1,message:"Internal Server Error"}}}const o=()=>n("/checkout/giftcard"),r=()=>n("/checkout/plans"),h=t=>n("/checkout/upgrade/details","POST",{plan:t}),l=(t={})=>n("/checkout/paymentmethods","POST",t),c=(t,e)=>n(`/paypal/polling?id=${t}&type=${e}`,"POST"),d=(t,e,s)=>n(`/api/promo/status/?code=${t}&product=${e}&splan=${s}`),u=()=>n("/api/country/"),p=async()=>{try{const t=await fetch("/api/geoip/"),e=await t.json();return e.registeredCountry.isoCode}catch(t){return"US"}},g=t=>n(`/api/credits/consume/${t}`,"POST").then((t=>{!0===t.status&&(i.N.credits=t.data.credits+t.data.subscription)}))},11839:(t,e,s)=>{s.d(e,{FS:()=>l,Ay:()=>c});var i=s(21742),a=s(98244),n=s(78508),o=s(42268),r=s(79453);class h{constructor(){this.chooser=()=>`\n            <div class="chooser">\n                <div class="social-button" data-social="google">\n                    <img src="/images/icon/google.svg" alt="google">\n                    ${(0,i.A)("common-continueWith")} Google\n                </div>\n                <div class="social-button" data-social="facebook">\n                    <img src="/images/icon/facebook.svg" alt="facebook">\n                    ${(0,i.A)("common-continueWith")} Facebook\n                </div>\n                <div class="social-button" data-social="apple">\n                    <img src="/images/icon/apple_gray.svg" alt="apple">\n                    ${(0,i.A)("common-continueWith")} Apple\n                </div>\n                <a class="top-20" style="display:inline-block;text-align:center;font-size:15px;" id="choose-email">\n                    <strong>${(0,i.A)("common-orUseEmail")}</strong>\n                </a>\n            </div>\n            <p class="top-30 center" style="padding:0 25px">\n                ${(0,i.A)("common-agreeTo")} <a href="/terms-of-use/" target='_new'>${(0,i.A)("common-termsOfUse")}</a> ${(0,i.A)("common-and")} <a href="/privacy-policy/" target='_new'> ${(0,i.A)("common-privacyPolicy")}</a>.\n            </p>\n        `,this.login=()=>`\n\n            <div class="center top-10">\n                ${(0,i.A)("common-notMember")} &nbsp; <strong><a id="load-signup">${(0,i.A)("common-signUp")}!</a></strong>\n            </div>\n\n            <form id="entry-form" data-entry="login" class="top-30">\n                <div class="input-group">\n                    <label for="entry-email">${(0,i.A)("common-email")}</label>\n                    <input type="email" maxlength="70" name="email" id="entry-email" placeholder="Email address">\n                    <p class="error-msg">${(0,i.A)("common-enterValidEmail")}</p>\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.A)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password" placeholder="Enter password" >\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n\n                <input type="checkbox" id="entry-rememberMe" name="rememberMe" checked/>\n                <label class="top-20 switch" for="entry-rememberMe"><span></span> ${(0,i.A)("common-rememberMe")}</label>\n\n                <button type="submit" class="button med w-100 top-40" id="entry-submit">${(0,i.A)("common-login")}</button>\n\n                <div class="center top-30"><strong><a id="load-forgotPassword">${(0,i.A)("common-forgotPass")}</a></strong></center>\n\n            </form>\n        `,this.register=async()=>{let t="",e=!1;const s=await(0,n._t)();for(let i in l)e||"US"!==i&&s!=i?t+=`<option value="${i}">${l[i]}</option>`:(t+=`<option value="${i}" selected>${l[i]}</option>`,e=!0);return`\n            <form id="entry-form" data-entry="register">\n                <div class="input-group">\n                    <label for="entry-email">${(0,i.A)("common-email")}</label>\n                    <input type="email" maxlength="70" name="email" id="entry-email" placeholder="Email address">\n                    <p class="error-msg">${(0,i.A)("common-enterValidEmail")}</p>\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.A)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password" placeholder="Enter password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                 </div>\n                <div class="input-group">\n                    <label for="country">${(0,i.A)("common-country")}</label>\n                    <select name="country">\n                        ${t}\n                    </select>\n                </div>\n\n                <input type="checkbox" id="entry-newsletter" name="newsletter" checked>\n                <label class="top-20 switch" for="entry-newsletter"><span></span>${(0,i.A)("subscribeToNewsletter")}</label>\n\n                <button type="submit" class="button med w-100 top-40">${(0,i.A)("common-signUp")}</button>\n            </form>\n        `},this.forgotPassword=()=>`\n            <h2 class="top-30">${(0,i.A)("common-forgotPass")}</h2>\n\n            <form id="entry-form" class="top-30" data-entry="forgotPassword">\n                <div class="input-group">\n                    <label for="entry-email">${(0,i.A)("common-email")}</label>\n                    <input type="email" maxlength="70" name="email" id="entry-email" placeholder="Email address"/>\n                    <p class="error-msg">${(0,i.A)("common-enterValidEmail")}</p>\n                </div>\n\n                <button type="submit" class="button large w-100 top-40" id="load-verification">${(0,i.A)("common-reqCode")}</button>\n            </form>\n        `,this.resetPassword=(t=!1)=>`\n            <h2 class="top-10">${t?(0,i.A)("common-setPassword"):(0,i.A)("common-resetPass")}</h2>\n\n            <form id="entry-form" class="top-30" data-entry="${t?"setPassword":"resetPassword"}">\n                <div class="input-group">\n                    <label for="entry-email">${(0,i.A)("common-email")}</label>\n                    <input type="email" maxlength="70" name="email" id="entry-email" readonly/>\n                    <p class="error-msg">${(0,i.A)("common-enterValidEmail")}</p>\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.A)("common-newPass")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                    <span id="password-meter" class="none">\n                        <span></span><span></span><span></span><span></span>\n                    </span>\n                </div>\n                <div class="input-group">\n                    <label for="entry-code">${(0,i.A)("common-code")}</label>\n                    <input type="number" name="code" id="entry-code" onkeypress="if(this.value.length===6)return false;">\n                    <p class="error-msg">${(0,i.A)("common-enterValidCode")}</p>                    \n                </div>\n                \n                ${t?`<p class="center top-20 text-center"><strong><a id="entry-resend">${(0,i.A)("common-SendResetCode")}</a></strong></p>`:""}\n\n                <div id="recaptcha" style="padding-top: 5px"></div>\n                <button class="button large w-100" type="submit">${(0,i.A)("common-updatePass")}</button>\n                ${t?"":`<p class="top-20 hide center" id="entry-resend">${(0,i.A)("common-didNotReceiveCode")} <a class="anchor">${(0,i.A)("common-resend")}</a></p>`}\n            </form>\n        `,this.verification=t=>`\n            <h1>${(0,i.A)("common-verifyAcc")}</h1>\n            <p id="entry-to-email" data-text="${(0,i.A)("common-sentCodeDesc")}">${(0,i.A)("common-sentCodeDesc")}</p>\n\n            <form id="entry-form" data-entry="${t}">\n                <input id="verification-email" type="hidden" name="email" readonly/>\n                <div class="input-group">\n                    <label for="code">${(0,i.A)("common-code")}</label>\n                    <input type="number" name="code" id="entry-code" onkeypress="if(this.value.length===6)return false;">\n                    <p class="error-msg">${(0,i.A)("common-enterValidCode")}</p>\n                </div>\n\n                <button type="submit" class="button large w-100 top-20">${(0,i.A)("common-verify")}</button>\n                <p class="top-20 hide text-center" id="entry-resend">${(0,i.A)("common-didNotReceiveCode")} &nbsp; <a class="anchor">${(0,i.A)("common-resend")}</a></p>\n            </form>\n        `,this.changePassword=()=>`\n            <h2>${(0,i.A)("common-changePassword")}</h2>\n            <form id="entry-form" class="top-30" data-entry="changePassword">\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.A)("common-oldPass")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.A)("common-newPass")}</label>\n                    <input type="password" name="new-password" id="entry-password-new">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password-2" class="input-icon" src="/img/icon/eye-hide.svg">\n                    <span id="password-meter" class="none">\n                        <span></span><span></span><span></span><span></span>\n                    </span>\n                </div>\n                <button type="submit" class="button w-100 top-20" style="margin-bottom: 20px">${(0,i.A)("common-changePassword")}</button>\n            </form>\n        `,this.changeEmail=()=>`\n            <h2>${(0,i.A)("common-changeEmail")}</h2>\n\n            <form id="entry-form" class="top-30" data-entry="changeEmail">\n                <div class="input-group">\n                    <label class="text-capitalize" for="email">${(0,i.A)("common-newEmail")}</label>\n                    <input type="email" maxlength="70" name="email" id="entry-email">\n                    <p class="error-msg">${(0,i.A)("common-EnterValidEmail")}</p>\n                </div>\n            \n                <button type="submit" class="button w-100 top-20" style="margin-bottom: 20px">${(0,i.A)("common-newEmail")}</button>\n            </form>\n        `,this.changeUsername=(t="")=>`\n            <h2>${(0,i.A)("changeUsername")}</h2>\n\n            <form id="entry-form" class="top-30" data-entry="changeUsername">\n                <div class="input-group">\n                    <label for="entry-username">${(0,i.A)("newUsername")}</label>\n                    <input type="text" name="name" id="entry-username" value="${t}">\n                </div>\n\n                <button type="submit" class="button w-100 top-20">${(0,i.A)("update")}</button>\n            </form>\n        `,this.deleteAccount=t=>`\n            <h2>${(0,i.A)("common-deleteMyAccount")}</h2>\n            <p class="top-20">Hey ${t},</p>\n            <p class="no-margin">${(0,i.A)("common-sadToSeeYouGoWhyLeaving")}</p>\n\n            <form id="entry-form" data-entry="deleteAccount">\n                <div class="input-group">\n                    <label class="top-20 text-uppercase">${(0,i.A)("common-leavingBecause")}</label>\n                    <select name="reason">\n                        <option value="leavingReasonDefault" disabled selected>${(0,i.A)("common-leavingReasonDefault")}</option>\n                        <option value="leavingReasons1">${(0,i.A)("common-leavingReasons1")}</option>\n                        <option value="leavingReasons2">${(0,i.A)("common-leavingReasons2")}</option>\n                        <option value="leavingReasons3">${(0,i.A)("common-leavingReasons3")}</option>\n                        <option value="leavingReasons4">${(0,i.A)("common-leavingReasons4")}</option>\n                        <option value="leavingReasons5">${(0,i.A)("common-leavingReasons5")}</option>\n                    <select>\n                </div>\n\n                <button type="submit" class="button red w-100 top-20" style="margin-bottom: 20px">${(0,i.A)("common-deleteMyAccount")}</button>\n            </form>\n        `,this.deleteAccountConfirmation=(t="leavingReasonDefault")=>`\n            <h4 class="top-35 text-default">${(0,i.A)("areYouSureYouWantToDelete")} </h4>\n            ${r.N.subscription?`<p class="top-35">${(0,i.A)("common-youHaveActiveSubsBeforeDelete")}</p>`:""}\n            <p class="top-15">${(0,i.A)("youCanStillChangeYourMind")} </p>\n\n            <form id="entry-form" data-entry="deleteAccountConfirmation">\n                <input type="hidden" name="reason" value="${t}">\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.A)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n\n                <div class="input-group checkbox-group inline justify-center flex-wrap" style="margin-top: 30px">\n                    <button id="entry-cancel" class="button full positive">${(0,i.A)("cancel")}</button>\n                    <button id="delete-confirm" type="submit" class="button w-100 transparent">${(0,i.A)("deleteMyAccount")}</button>\n                </div>\n            </form>\n        `,this.additionalVerification=()=>`\n            <h3 class="heavy">${(0,i.A)("enterYourPasswordToContinue")}</h3>\n\n            <form id="entry-form" data-entry="additionalVerification">\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.A)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n\n                <div class="input-group checkbox-group inline justify-center" style="margin-top: 30px">\n                    <button type="submit" class="button full top-20">Continue</button>\n                </div>\n            </form>\n        `}}const l={AF:"Afghanistan",AX:"Åland Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia",BQ:"Bonaire, Sint Eustatius and Saba",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo, Republic of the (Brazzaville)",CD:"Congo, the Democratic Republic of the (Kinshasa)",CK:"Cook Islands",CR:"Costa Rica",CI:"Côte d'Ivoire, Republic of",HR:"Croatia",CU:"Cuba",CW:"Curaçao",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Islas Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern and Antarctic Lands",GA:"Gabon",GM:"Gambia, The",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and McDonald Islands",VA:"Holy See (Vatican City)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran, Islamic Republic of",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"Korea, Democratic People's Republic of",KR:"Korea, Republic of",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Laos",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia, Republic of",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia, Federated States of",MD:"Moldova",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestine, State of",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"Réunion",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",BL:"Saint Barthélemy",SH:"Saint Helena, Ascension and Tristan da Cunha",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",MF:"Saint Martin",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SX:"Sint Maarten (Dutch part)",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and South Sandwich Islands",SS:"South Sudan",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TJ:"Tajikistan",TZ:"Tanzania, United Republic of",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States Minor Outlying Islands",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela, Bolivarian Republic of",VN:"Viet Nam",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"};class c{constructor(t={}){var e;this.setContent=async(t,e)=>{var s,i;switch(t){case"chooser":this.content.innerHTML=this.form.chooser(),document.querySelectorAll(".social-button").forEach((t=>{t.addEventListener("click",(()=>this.loadSocialLogin(t.dataset.social)))})),null===(s=(0,o.Ay)("choose-email"))||void 0===s||s.addEventListener("click",(()=>this.loadForm("login")));break;case"login":this.content.innerHTML=this.form.login(),(0,o.Ay)("load-signup").onclick=()=>this.loadForm("register"),this.options.email&&((0,o.Ay)("entry-email").value=this.options.email);break;case"register":this.content.innerHTML=await this.form.register();break;case"forgotPassword":this.content.innerHTML=this.form.forgotPassword();break;case"setPassword":this.loadCaptcha(),this.content.innerHTML=this.form.resetPassword(!0);break;case"resetPassword":this.loadCaptcha(),this.content.innerHTML=this.form.resetPassword();break;case"verification":this.content.innerHTML=this.form.verification(null!==(i=e.verify)&&void 0!==i?i:"verification");break;case"changePassword":this.content.innerHTML=this.form.changePassword();break;case"changeEmail":this.content.innerHTML=this.form.changeEmail();break;case"changeUsername":this.content.innerHTML=this.form.changeUsername((0,o.Ay)("change-name").dataset.name);break;case"deleteAccount":const t=(0,o.Ay)("delete-account").dataset.name||"User";this.content.innerHTML=this.form.deleteAccount(t);break;case"deleteAccountConfirmation":this.content.innerHTML=this.form.deleteAccountConfirmation(e.reason);break;case"additionalVerification":this.passwordVerification="pending",this.content.innerHTML=this.form.additionalVerification()}},this.setFooter=t=>{switch(this.footer.style.display="block",t){case"login":this.footer.innerHTML=`${(0,i.A)("common-notMember")} &nbsp; <a id="load-chooser">${(0,i.A)("common-signUpNow")}</a>`,(0,o.Ay)("load-chooser").onclick=()=>this.loadForm("chooser");break;case"register":this.footer.innerHTML=`${(0,i.A)("common-alreadyMember")} &nbsp; <a id="load-login">${(0,i.A)("common-loginHere")}</a>`,(0,o.Ay)("load-login").onclick=()=>this.loadForm("login");break;case"forgotPassword":this.footer.innerHTML=`<a class="back" id="entry-back">&#10094; &nbsp; ${(0,i.A)("common-back")}</a>`,(0,o.Ay)("entry-back").onclick=()=>this.loadForm("login");break;case"resetPassword":this.footer.innerHTML=`<a class="back" id="entry-back">&#10094; &nbsp; ${(0,i.A)("common-back")}</a>`,(0,o.Ay)("entry-back").onclick=()=>this.loadForm("forgotPassword");break;default:return this.footer.innerHTML="",void(this.footer.style.display="none")}},this.loadForm=async(t,e={})=>{var s,i,a,n,r,h,l;if(this.options.view=t,await this.setContent(this.options.view,e),"setPassword"!==this.options.view&&"resetPassword"!==this.options.view||this.renderCaptcha(),null===(s=(0,o.Ay)("entry-form"))||void 0===s||s.addEventListener("submit",(t=>{this.submitForm((0,o.Ay)("entry-form").dataset.entry,t)})),"setPassword"===this.options.view&&(e.email=(0,o.Ay)("set-password").dataset.email),"resetPassword"!==this.options.view&&"setPassword"!==this.options.view||((0,o.Ay)("entry-email").value=e.email),(0,o.Ay)("entry-to-email")){const t=(0,o.Ay)("entry-to-email").dataset.text.replace("[EMAIL]",e.email);(0,o.Ay)("entry-to-email").innerHTML=t}(0,o.Ay)("verification-email")&&((0,o.Ay)("verification-email").value=e.email),(0,o.Ay)("entry-resend")&&(clearTimeout(this.resendCodeTimeouts),this.resendCodeTimeouts=setTimeout((()=>{(0,o.Ay)("entry-resend").classList.remove("hide")}),3e4),null===(i=(0,o.Ay)("entry-resend"))||void 0===i||i.addEventListener("click",(()=>this.resendCode(e.email)))),null===(a=(0,o.Ay)("entry-email"))||void 0===a||a.addEventListener("keyup",(()=>{this.validateInputTimer("email")})),null===(n=(0,o.Ay)("entry-email"))||void 0===n||n.addEventListener("blur",(()=>{(0,o.TT)((0,o.Ay)("entry-email"),"","email")})),null===(r=(0,o.Ay)("load-forgotPassword"))||void 0===r||r.addEventListener("click",(()=>this.loadForm("forgotPassword"))),null===(h=(0,o.Ay)("toggle-password"))||void 0===h||h.addEventListener("click",(()=>this.togglePassword())),null===(l=(0,o.Ay)("toggle-password-2"))||void 0===l||l.addEventListener("click",(()=>this.togglePassword("toggle-password-2","entry-password-new")))},this.loadSocialLogin=async t=>{if((0,a.A)("login",t),"apple"===t){const t=await new Promise(((t,e)=>{let s=document.createElement("script");s.type="text/javascript",s.crossOrigin="anonymous",s.src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js",document.body.appendChild(s),s.onload=function(){t(AppleID?AppleID.auth:null)},s.onerror=function(){e("Failed to load apple auth script")}}));t&&(t.init({clientId:"com.pixlr.web",scope:"name email",redirectURI:new URL(location.href).origin+"/auth/apple/callback",state:location.href,nonce:"",usePopup:!1}),t.signIn())}else{const e=window.location.origin,s=this.options.callback?e+decodeURIComponent(this.options.callback).split("#")[0]:encodeURIComponent(window.location.href);window.location.href=`${e}/auth/${t}?callbackUrl=${s}`}},this.togglePassword=(t="toggle-password",e="entry-password")=>{const s=(0,o.Ay)(t),i=(0,o.Ay)(e);"text"===i.type?(i.type="password",s.src="/img/icon/eye-hide.svg"):(i.type="text",s.src="/img/icon/eye-show.svg")},this.validateInputTimer=t=>{this.validationTimer[t]&&clearTimeout(this.validationTimer[t]),this.validationTimer[t]=setTimeout((()=>(0,o.TT)((0,o.Ay)(`entry-${t}`),"",t)),1e3)},this.loadCaptcha=()=>{let t=document.createElement("script");t.id="recaptcha-js-api",t.defer=!0,t.src="https://www.google.com/recaptcha/api.js",document.getElementsByTagName("head")[0].appendChild(t)},this.renderCaptcha=()=>{this.captcha=void 0;const t=window.location.href.includes("localhost")?"6LeBQzcaAAAAAPwVny3IG23_fY_FasFVKXvQG9qB":"6LcqBEsaAAAAAF-JcOUzRtVKASZt5b-EMITWxEJf";setTimeout((()=>{try{this.captcha=grecaptcha.render((0,o.Ay)("recaptcha"),{sitekey:t})}catch(e){console.error("Failed to load Captcha, please check your network connection!")}}),2500)},this.getFormInput=()=>{const t={},e=(0,o.Ay)("entry-form");return e.querySelectorAll("input").forEach((e=>{"checkbox"==e.type?t[e.name]=e.checked:t[e.name]=e.value})),e.querySelectorAll("select").forEach((e=>{t[e.name]=e.value})),t},this.submitForm=async(t,e)=>{switch(e.preventDefault(),t){case"login":this.loginHandler();break;case"register":this.registerHandler();break;case"verification":this.verificationHandler();break;case"forgotPassword":this.forgotPasswordHandler();break;case"setPassword":this.passwordResetHandler(!0);break;case"resetPassword":this.passwordResetHandler();break;case"changeEmail":this.changeEmailHandler();break;case"changeEmailVerification":this.changeEmailVerificationHandler();break;case"changePassword":this.changePasswordHandler();break;case"changeUsername":this.changeUsernameHandler();break;case"deleteAccount":this.deleteAccountHandler();break;case"deleteAccountConfirmation":this.deleteAccountConfirmationHandler()}},this.loginHandler=async()=>{const t=this.getFormInput();t.email=t.email.trim();const e=(0,o.TT)((0,o.Ay)("entry-email"),t.email,"email"),s=(0,o.TT)((0,o.Ay)("entry-password"),t.password,"password");if(!e||!s)return;(0,o.Ay)("entry-submit").classList.add("working");const i=await(0,n.In)("/auth/login","POST",t);i.status?((0,a.A)("login","password"),this.options.callback?window.location.href=decodeURIComponent(this.options.callback).split("#")[0]:window.location.reload()):i.verify?(this.loadForm("verification",{email:t.email}),(0,o.y8)("danger",i.message,5)):((0,o.Ay)("entry-submit").innerText="Login",(0,o.y8)("danger",i.message,5)),(0,o.Ay)("entry-submit").classList.remove("working")},this.registerHandler=async()=>{this.registerData=this.getFormInput();const t=(0,o.TT)((0,o.Ay)("entry-email"),this.registerData.email,"email"),e=(0,o.TT)((0,o.Ay)("entry-password"),this.registerData.password,"password");if(!t||!e)return;const s=this.getFormInput();Object.assign(s,this.registerData);const i=await(0,n.In)("/auth/register","POST",s);if(!i.status)return(0,o.y8)("danger",i.message,5),void this.loadForm("register");this.loadForm("verification",{email:s.email})},this.verificationHandler=async()=>{const t=this.getFormInput(),e=await(0,n.In)("/auth/verify","POST",t);if(!e.status)return(0,o.y8)("danger",e.message,5);(0,o.y8)("success",e.message,5),setTimeout((()=>{this.options.callback?window.location.href=decodeURIComponent(this.options.callback).split("#")[0]:window.location.href=`/upsell?next=${location.pathname}`}),1e3)},this.forgotPasswordHandler=async()=>{const t=this.getFormInput();if(!(0,o.TT)((0,o.Ay)("entry-email"),t.email,"email"))return;t.resend=!1;const e=await(0,n.In)("/auth/request/code/","POST",t);if(!e.status)return(0,o.y8)("danger",e.message,5);(0,o.y8)("success",e.message,5,t.email),this.loadForm("resetPassword",{email:t.email})},this.passwordResetHandler=async(t=!1)=>{let e;try{if(e=grecaptcha.getResponse(this.captcha),grecaptcha.reset(this.captcha),!e)return(0,o.y8)("danger","Please complete the CAPTCHA!",3)}catch(l){console.error("Failed to get Captcha Token!")}const s=this.getFormInput();s.token=e;const i=(0,o.TT)((0,o.Ay)("entry-email"),s.email,"email"),a=(0,o.TT)((0,o.Ay)("entry-password"),s.password,"password"),r=(0,o.TT)((0,o.Ay)("entry-code"),s.code,"code");if(!i||!a||!r)return;const h=await(0,n.In)("/auth/reset","POST",s);if(!h.status)return(0,o.y8)("danger",h.message,5);(0,o.y8)("success",h.message,5),setTimeout((()=>{t?window.location.href="/logout":window.location.reload()}),1e3)},this.resendCode=async t=>{(0,o.Ay)("entry-resend").classList.add("hide"),this.resendCodeTimeouts=setTimeout((()=>{(0,o.Ay)("entry-resend").classList.remove("hide")}),3e4);const e=await(0,n.In)("/auth/request/code/","POST",{email:t,resend:!0});if(!e.status)return(0,o.y8)("danger",e.message,5);(0,o.y8)("success",e.message,5,t)},this.changeEmailHandler=async()=>{const t=this.getFormInput();if(!(0,o.TT)((0,o.Ay)("entry-email"),t.email,"email"))return;const e=await(0,n.In)("/auth/changeemail/request","POST",{newEmail:t.email});if(!e.status)return(0,o.y8)("danger",e.message);this.loadForm("verification",{email:t.email,verify:"changeEmailVerification"}),(0,o.y8)("success",e.message,5,t.email)},this.changeEmailVerificationHandler=async()=>{const t=this.getFormInput();t.newEmail=t.email;if(!(0,o.TT)((0,o.Ay)("entry-code"),t.code,"code"))return;const e=await(0,n.In)("/auth/changeemail/verify","POST",t);if(!e.status)return(0,o.y8)("danger",e.message,5);(0,o.y8)("success",e.message,5),setTimeout((()=>{window.location.replace("/logout?callbackUrl=/")}),1e3)},this.changePasswordHandler=async()=>{const t=this.getFormInput(),e=(0,o.TT)((0,o.Ay)("entry-password"),t.password,"password"),s=(0,o.TT)((0,o.Ay)("entry-password-new"),t["new-password"],"password");if(!e||!s)return;const i=await(0,n.In)("/auth/changepassword","PUT",{oldPassword:t.password,newPassword:t["new-password"]});if(!i.status)return(0,o.y8)("danger",i.message,5);(0,o.y8)("success",i.message,5),setTimeout((()=>{window.location.replace("/")}),2e3)},this.changeUsernameHandler=async()=>{const t=this.getFormInput(),e=await(0,n.In)("/myaccount/api/profile","PUT",t,!0);if(!e.status)return(0,o.y8)("danger",e.message);(0,o.y8)("success",e.message),setTimeout((()=>window.location.reload()),500)},this.deleteAccountHandler=async()=>{const t=this.getFormInput();"leavingReasonDefault"!==t.reason&&this.loadForm("deleteAccountConfirmation",{reason:t.reason})},this.deleteAccountConfirmationHandler=async()=>{const t=this.getFormInput();if(!(0,o.TT)((0,o.Ay)("entry-password"),t.password,"password"))return;(0,o.Ay)("entry-cancel").style.display="none",(0,o.Ay)("delete-confirm").innerText=(0,i.A)("common-deleteInProgress");const e=await(0,n.In)("/api/myaccount/profile","DELETE",t,!0);if(!e.status)return(0,o.Ay)("entry-cancel").style.display="block",(0,o.Ay)("delete-confirm").innerText=(0,i.A)("deleteMyAccount"),(0,o.y8)("danger",e.message);window.location.href="/logout/"},this.getAdditionalVerificationstatus=()=>(0,o.Ay)("entry-modal"),this.additionalVerificationHandler=async()=>{const t=this.getFormInput();if(!(0,o.TT)((0,o.Ay)("entry-password"),t.password,"password"))return!1;const e=await(0,n.In)("/api/myaccount/verification","POST",t,!0);return!!e.status||((0,o.y8)("danger",e.message),!1)},this.options=t,this.form=new h,this.registerData={},this.validationTimer={},this.captcha={},this.dialog=this.options.holder,this.dialog.classList.add("entry"),this.content=(0,o.T)("div",{className:"entry-content"}),this.footer=(0,o.T)("div",{id:"entry-footer",className:"center"}),this.dialog.append(this.content,this.footer),this.loadForm(null!==(e=this.options.view)&&void 0!==e?e:"chooser")}}},96703:(t,e,s)=>{s.d(e,{A:()=>v});var i=s(42268),a=s(21742);function n(t,e=100,s="",n="",o=""){return(0,i.T)("div",{className:`form-group w-${e}`},(0,i.T)("div",{className:"adyen-checkout-title"},(0,i.T)("span",{className:"adyen-checkout__label__text"},`${(0,a.A)(t)} ${(0,a.A)(n)}`),o),(0,i.T)("input",{type:"text",id:t.replace("checkout-",""),maxLength:56,required:!0,value:s}))}const o=(t,e,s)=>{const[n,o]=function(t,e){let s,i;return e.forEach((e=>{e.product===t&&(1===e.monthDuration?s=e:12===e.monthDuration&&(i=e))})),[{code:s.code,monthlyPrice:s.pricing.USD.amount.toFixed(2),yearlyPrice:(12*s.pricing.USD.amount).toFixed(2)},{code:i.code,monthlyPrice:String(i.pricing.USD.displayPriceInMonths),yearlyPrice:i.pricing.USD.amount.toFixed(2)}]}(e,s),r=Math.round(100*(1-+o.yearlyPrice/+n.yearlyPrice));return(0,i.T)("details",{id:"chckout-planSelection",className:"kort",open:"Pixlr Plus"===e},(0,i.T)("summary",{style:"display: flex; align-items: center;"},(0,i.T)("img",{src:`/images/checkout/icon/${e}.svg`,width:24,height:24,style:"margin-right: 8px;"}),(0,i.T)("span",{className:"fs-16 fw-7"},e),(0,i.T)("img",{src:"/images/icon/up.svg",style:"margin-left: auto"})),(0,i.T)("div",{style:"display: flex; flex-direction: column; row-gap: 8px"},(0,i.T)("div",{className:"plan-options "+(t===n.code?"selected":""),dataset:{plan:n.code}},(0,i.T)("p",{className:"fs-14 fw-7"},(0,a.A)("payMonthly")),(0,i.T)("p",(0,i.T)("span",{className:"fs-14 fw-7",style:"margin-right: 5px"},`${n.monthlyPrice} /month`),(0,i.T)("span",{className:"fs-12 fw-4"},`. ${n.yearlyPrice} /year`))),(0,i.T)("div",{className:"plan-options "+(t===o.code?"selected":""),dataset:{plan:o.code}},(0,i.T)("p",{className:"fs-14 fw-7"},(0,a.A)("payYearly")),(0,i.T)("p",(0,i.T)("span",{className:"fs-14 fw-7",style:"margin-right: 5px"},`${o.monthlyPrice} /month`),(0,i.T)("span",{className:"fs-12 fw-4"},`. ${o.yearlyPrice} /year`,(0,i.T)("span",{className:"saving-badge"},`Save ${r}%`)))),(0,i.T)("span",{className:"fs-12 fw-4",style:"line-height: 18px"},(0,a.A)("youCanCancelAuto"))))},r=()=>(0,i.T)("details",{open:!0,className:"kort"},(0,i.T)("summary",{style:"display: flex; align-items: center;"},(0,i.T)("img",{src:"/images/checkout/icon/card.svg",width:24,height:24,style:"margin-right: 8px;"}),(0,i.T)("span",{className:"fs-16 fw-7"},(0,a.A)("paymentMethod")),(0,i.T)("img",{src:"/images/icon/up.svg",style:"margin-left: auto"})),(0,i.T)("div",{style:"display: flex; flex-direction: column; row-gap: 18px;"},(0,i.T)("div",{id:"saved-cards"}),(0,i.T)("div",{id:"payment-option-radios"},(0,i.T)("div",{className:"payment-options"},(0,i.T)("input",{id:"adyen-radio-option",type:"radio",name:"payment",value:"adyen",checked:!0}),(0,i.T)("label",{htmlFor:"adyen-radio-option",className:"fs-12 fw-7"},"Credit Card")),(0,i.T)("div",{id:"paypal-payment-option",className:"payment-options"},(0,i.T)("input",{id:"paypal-radio-option",type:"radio",name:"payment",value:"paypal"}),(0,i.T)("label",{htmlFor:"paypal-radio-option",className:"fs-12 fw-7"},"Paypal"))),(0,i.T)("div",{id:"component-container"}))),h=()=>(0,i.T)("details",{id:"wrapper-billing-option",className:"kort"},(0,i.T)("summary",{style:"display: flex; align-items: center;"},(0,i.T)("img",{src:"/images/checkout/icon/card.svg",width:24,height:24,style:"margin-right: 8px;"}),(0,i.T)("span",{className:"fs-16 fw-7"},(0,a.A)("optionalBillingInformation")),(0,i.T)("img",{src:"/images/icon/up.svg",style:"margin-left: auto"})),(0,i.T)("div",{id:"billing-form",className:"w-100"},(0,i.T)("form",{},(0,i.T)("div",{className:"flex"},n("checkout-firstName",50),n("checkout-lastName",50)),(0,i.T)("div",{className:"flex"},n("checkout-companyName",100,"","checkout-optional")),(0,i.T)("div",{className:"flex"},n("checkout-vatNumber",100,"","checkout-optional")),(0,i.T)("div",{className:"flex"},n("checkout-address",100)),(0,i.T)("div",{className:"flex"},n("checkout-city",50),n("checkout-zipCode",50)),(0,i.T)("div",{className:"flex"},n("checkout-state",50),function(t,e=100){return(0,i.T)("div",{className:`form-group w-${e}`},(0,i.T)("span",{className:"adyen-checkout__label__text"},(0,a.A)(t)),(0,i.T)("select",{id:"country",name:"country",className:"country-select"}))}("checkout-country",50))))),l=()=>(0,i.T)("details",{id:"wrapper-seat-option",className:"kort"},(0,i.T)("summary",{style:"display: flex; align-items: center;"},(0,i.T)("img",{src:"/images/checkout/icon/seats.svg",width:24,height:24,style:"margin-right: 8px;"}),(0,i.T)("span",{className:"fs-16 fw-7"},(0,a.A)("addMoreSeats")),(0,i.T)("img",{src:"/images/icon/up.svg",style:"margin-left: auto"})),(0,i.T)("div",(0,i.T)("div",{className:"seat-select"},(0,i.T)("span",{className:"seat-option",dataset:{value:"5"}},"5 seats"),(0,i.T)("span",{className:"seat-option",dataset:{value:"10"}},"10 seats"),(0,i.T)("span",{className:"seat-option",dataset:{value:"20"}},"20 seats"),(0,i.T)("span",{className:"seat-option seat-option-custom"},(0,i.T)("input",{type:"number",placeholder:"Custom",min:"1",max:"100"}))))),c=(t,e)=>(0,i.T)("div",{id:"summary-wrapper"},(0,i.T)("h3",(0,a.A)("orderSummary")),"giftcard"===t?(0,i.T)("div",{style:"display: flex; column-gap: 8px"},(0,i.T)("img",{src:"/images/checkout/icon/gift-card.png",height:45}),(0,i.T)("div",(0,i.T)("h4",(0,a.A)("pixlrGiftCard")),(0,i.T)("h6",(0,i.T)("span",{className:"bold"},(0,a.A)("purchaseFor")),(0,i.T)("span",{id:"summary-giftcard-to"})))):"","credits"===t?(0,i.T)("div",(0,i.T)("h4",(0,a.A)("generativeCredits")),(0,i.T)("h6",(0,a.A)("useCreditToGenerateAIAcrossTools"))):"",(0,i.T)("hr"),(0,i.T)("div",{style:"display: flex; flex-direction: column; row-gap: 14px"},"subscription"===t?(0,i.T)("div",{id:"summary-base",className:"summary-group inc"},(0,i.T)("div",{className:"desc"},(0,i.T)("h5",`${e.replace("Pixlr ","")} Subscription`),"Pixlr Plus"===e?(0,i.T)("ul",{className:"top-5"},(0,i.T)("li",(0,a.A)("addFreeUnlimitedSave")),(0,i.T)("li",{id:"summary-base-credits"})):"Pixlr Premium"===e?(0,i.T)("ul",{className:"top-5"},(0,i.T)("li",(0,a.A)("fullAccesstoPixlrAppAndAsset")),(0,i.T)("li",{id:"summary-base-credits"}),(0,i.T)("li",{id:"summary-base-credits-free-trial",style:"display: none"})):"Pixlr Team"===e?(0,i.T)("ul",{className:"top-5"},(0,i.T)("li",(0,a.A)("manageYourTeamMembersAndCollaborate")),(0,i.T)("li",{id:"summary-base-credits"}),(0,i.T)("li",(0,a.A)("fiveExtraSeatsIncluded"))):""),(0,i.T)("span",{id:"summary-base-value",className:"bold"},"9.99")):"","giftcard"===t?(0,i.T)("div",{id:"summary-giftcard",className:"summary-group"},(0,i.T)("h5",(0,a.A)("price")),(0,i.T)("span",{id:"summary-giftcard-value",className:"bold"},"x")):"","credits"===t?(0,i.T)("div",{id:"summary-credits",className:"summary-group"},(0,i.T)("h5",(0,i.T)("span",{id:"summary-credits-amount"})),(0,i.T)("span",{id:"summary-credits-value",className:"bold"},"x")):"",(0,i.T)("div",{id:"summary-balance",className:"summary-group"},(0,i.T)("h5",(0,a.A)("balanceCreditUpgrade")),(0,i.T)("span",{id:"summary-balance-value",className:"bold"},"x")),(0,i.T)("div",{id:"summary-promo",className:"summary-group"},(0,i.T)("div",{className:"desc"},(0,i.T)("h5",(0,a.A)("promoCode")),(0,i.T)("span",{id:"summary-promo-remarks",className:"color-g25 fw-4 fs-14"},"x")),(0,i.T)("span",{id:"summary-promo-value"},"x")),(0,i.T)("div",{id:"summary-seats",className:"summary-group"},(0,i.T)("div",{className:"desc"},(0,i.T)("h5",(0,a.A)("additionalSeats")),(0,i.T)("span",{id:"summary-seats-count",className:"color-g25 fw-4 fs-14"},"x5 seats")),(0,i.T)("span",{id:"summary-seats-value"},"x")),(0,i.T)("div",{id:"summary-tax",className:"summary-group"},(0,i.T)("h5","GST 9%"),(0,i.T)("span",{id:"summary-tax-value"},"x")),(0,i.T)("div",{id:"summary-trial",className:"summary-group"},(0,i.T)("div",{className:"desc"},(0,i.T)("h5",(0,a.A)("discount")),(0,i.T)("span",{id:"summary-trial-note",className:"color-g25 fw-4 fs-14"})),(0,i.T)("span","100%"))),(0,i.T)("hr"),(0,i.T)("div",{id:"summary-total",className:"summary-group inc"},(0,i.T)("div",{className:"desc"},(0,i.T)("h5",(0,a.A)("checkout-totalDue")," (",(0,i.T)("span",{className:"currency"},"USD"),")"),(0,i.T)("span",{id:"summary-total-tax",className:"color-g25 fw-4 fs-14",style:"display: none;"},"(incl. GST)")),(0,i.T)("span",{className:"total-price bold"},"x")),(0,i.T)("button",{id:"proceed-payment",disabled:!0},(0,a.A)("payNow")));var d=s(78508),u=s(98244),p=s(72284),g=s(3514),m=s(79453);class v extends p.A{constructor(t,e={}){var n;if(super(!0),this.checkoutOptions={checkoutMode:"checkout"},this.currency="USD",this.currencySymbol="$",this.freeTrial=!1,this.paymentData={currency:"USD",checkoutMethod:this.checkoutOptions.checkoutMode,billingAddress:{}},this.balanceCredit=0,this.selectedPayment="credit",this.tax={status:!1},this.genCredits=0,this.encryptedCardData={isValid:!1,paymentMethod:{}},this.loadSeatsUI=()=>{this.optionUI.append(l()),this.optionUI.append(r()),this.optionUI.append(h()),this.summaryUI.append(c(this.checkoutType,this.productName)),(0,i.Ay)("paypal-payment-option")&&((0,i.Ay)("paypal-payment-option").style.display="none"),this.loadAdyen(),this.loadEventListener()},this.loadCreditsUI=()=>{this.optionUI.append((0,i.T)("details",{open:!0,id:"wrapper-credit-option",className:"kort"},(0,i.T)("summary",{style:"display: flex; align-items: center;"},(0,i.T)("img",{src:"/images/checkout/icon/credits.svg",width:24,height:24,style:"margin-right: 8px;"}),(0,i.T)("span",{className:"fs-16 fw-7"},(0,a.A)("generativeCredits")),(0,i.T)("img",{src:"/images/icon/up.svg",style:"margin-left: auto"})),(0,i.T)("div",{style:"display: flex; flex-direction: column; row-gap: 16px"},(0,i.T)("h6",(0,a.A)("chooseAmount")),(0,i.T)("div",{className:"credit-select",style:"display: flex; flex-wrap: wrap; column-gap: 10px; row-gap: 8px"},(0,i.T)("span",{className:"credit-option",dataset:{value:"200"}},"200"),(0,i.T)("span",{className:"credit-option",dataset:{value:"500"}},"500"),(0,i.T)("span",{className:"credit-option",dataset:{value:"1000"}},"1000"),(0,i.T)("span",{className:"credit-option",dataset:{value:"2000"}},"2000"),(0,i.T)("span",{className:"credit-option",dataset:{value:"5000"}},"5000"))))),this.optionUI.append(r()),this.optionUI.append(h()),this.summaryUI.append(c(this.checkoutType,this.productName)),this.loadAdyen(),this.loadEventListener()},this.loadGiftCardUI=()=>{Promise.all([d.XC()]).then((([t])=>{var e,s;if(!t.status)throw new Error("Failed to get gift details");this.selectedGiftCard=t.data.find((t=>t.code===this.checkoutOptions.giftcard)),this.productName=this.selectedGiftCard.product,this.optionUI.append(r()),this.optionUI.append(h()),this.summaryUI.append(c(this.checkoutType,this.productName)),(0,i.Ay)("summary-giftcard-value").innerText=this.selectedGiftCard.amount.toFixed(2),null===(e=(0,i.Ay)("summary-giftcard"))||void 0===e||e.classList.add("inc"),(0,i.Ay)("summary-giftcard-to").innerText=(null===(s=this.checkoutOptions.isAGift)||void 0===s?void 0:s.to)?(0,a.A)("someoneElse"):(0,a.A)("myself"),this.loadAdyen(),this.loadEventListener()}))},this.loadEventListener=()=>{var t,e,s,a,n;null===(t=(0,i.Ay)("back-chckout"))||void 0===t||t.addEventListener("click",this.backPreviousPopup),document.querySelectorAll('input[name="payment"][type="radio"]').forEach((t=>{t.addEventListener("change",(()=>this.setPaymentMethod(t)))})),document.querySelectorAll(".plan-options").forEach((t=>{t.addEventListener("click",(()=>this.setPlan(t)))})),null===(e=(0,i.Ay)("promocode-submit"))||void 0===e||e.addEventListener("click",(()=>this.applyPromoCode())),null===(s=(0,i.Ay)("promocode-input"))||void 0===s||s.addEventListener("input",this.promoCodeOnInput),document.querySelectorAll(".seat-option").forEach((t=>{t.addEventListener("click",(()=>this.selectSeats(t)))})),document.querySelectorAll(".credit-option").forEach((t=>{t.addEventListener("click",(()=>this.selectCredit(t)))})),document.querySelectorAll("#billing-form input").forEach((t=>{t.addEventListener("keyup",(()=>{this.paymentData.billingAddress[t.id]=t.value,this.isReadyToPay()}))})),null===(a=(0,i.Ay)("country"))||void 0===a||a.addEventListener("change",this.updateCountry),this.populateCountry(),null===(n=(0,i.Ay)("proceed-payment"))||void 0===n||n.addEventListener("click",(()=>this.proceedPayment()))},this.selectCredit=t=>{document.querySelectorAll(".credit-option").forEach((e=>{e!==t&&e.classList.remove("active")})),t.classList.toggle("active"),t.classList.contains("active")&&t.dataset.value?this.genCredits=Number(t.dataset.value):this.genCredits=0,this.updatePrice()},this.selectSeats=t=>{if(document.querySelectorAll(".seat-option").forEach((e=>{e!==t&&e.classList.remove("active")})),t.classList.toggle("active"),t.classList.contains("active"))if(t.classList.contains("seat-option-custom")){const e=t.getElementsByTagName("input")[0];""===e.value?this.extraSeats=0:this.extraSeats=Number(e.value)}else t.dataset.value?this.extraSeats=Number(t.dataset.value):this.extraSeats=0;else this.extraSeats=0;this.updatePrice()},this.populateCountry=async()=>{const{data:t}=await d.X6();this.countryList=t;const e=(0,i.Ay)("country");for(const s in t.country){const a=(0,i.T)("option",{value:t.country[s]},t.country[s]);(null===m.N||void 0===m.N?void 0:m.N.country)===s&&(a.selected=!0,this.paymentData.billingAddress.country=t.country[s]),e.append(a)}this.updateCountry()},this.updateCountry=()=>{const t=(0,i.Ay)("country").value,e=Object.keys(this.countryList.country).find((e=>this.countryList.country[e]===t));this.paymentData.billingAddress.country=t,this.countryList.tax[e]?(this.tax.status=!0,this.tax.percentage=this.countryList.tax[e]):this.tax.status=!1,this.countryList.countryEU.some((t=>t===e))?(this.currency="EUR",this.currencySymbol="€"):(this.currency="USD",this.currencySymbol="$"),document.querySelectorAll(".currency").forEach((t=>t.innerHTML=this.currency)),document.querySelectorAll(".currency-symbol").forEach((t=>t.innerHTML=this.currencySymbol)),this.updatePrice()},this.applyPromoCode=async()=>{var t;const e=(0,i.Ay)("promocode-submit");if("true"===e.dataset.applied)return void this.removePromoCode();const s=(0,i.Ay)("promocode-input");let a=(null===(t=this.checkoutOptions)||void 0===t?void 0:t.code)?this.checkoutOptions.code:s.value.toUpperCase().trim();try{const t=await d.Pe(a,this.productName,this.splanId);if(!t.status)throw new Error("Invalid promocode!");this.appliedPromo=t.promo,s.readOnly=!0,e.innerText="Remove",e.dataset.applied="true",this.updatePrice()}catch({response:n,message:o}){this.removePromoCode(),(0,i.Ay)("promocode-error").style.display="block",setTimeout((()=>{(0,i.Ay)("promocode-error").style.display="none"}),1500)}},this.removePromoCode=()=>{const t=(0,i.Ay)("promocode-submit"),e=(0,i.Ay)("promocode-input");t.innerText="Apply",delete t.dataset.applied,this.appliedPromo=void 0,this.updatePrice(),e.readOnly=!1,e.value=""},this.promoCodeOnInput=t=>{const e=t.target;e.value=e.value.toUpperCase()},this.updatePrice=()=>{let t;"subscription"===this.checkoutType?t=this.selectedPlan.pricing.USD.amount:"giftcard"===this.checkoutType?t=this.selectedGiftCard.amount:("seats"===this.checkoutType||"credits"===this.checkoutType)&&(t=0);let e=t,s=0,n=0,o=0;if("subscription"===this.checkoutType?((0,i.Ay)("summary-base-value").innerText=t.toFixed(2),(0,i.Ay)("summary-base-credits").innerText=(0,a.A)("creditForAIGeneration",this.getCreditsByPlan()),this.freeTrial&&((0,i.Ay)("summary-base-credits-free-trial").innerText=(0,a.A)("creditForAIGenerationDuringTrial",250),(0,i.Ay)("summary-base-credits-free-trial").style.display="list-item")):"credits"===this.checkoutType&&(e=t=this.getCreditsByPrice(this.genCredits),(0,i.Ay)("summary-credits-amount").innerText=(0,a.A)("totalGenerativeCredits",this.genCredits.toFixed()),(0,i.Ay)("summary-credits-value").innerText=t.toFixed(2),(0,i.Ay)("summary-credits").classList.add("inc")),this.appliedPromo){const{productCode:e,productName:n,percentage:o,amount:r,code:h}=this.appliedPromo;(0,i.Ay)("summary-promo-remarks").innerText=o?(0,a.A)("discountPercentageOffFirstPayingMonth").replace("{discountAmount}",`${o}%`):(0,a.A)("discountAmountOnlyFirstPayingMonth").replace("{discountAmount",r.toFixed(2));n.includes(this.productName)&&e.includes(this.splanId)&&(o?s=t*o/100:r&&(s=r),(0,i.Ay)("summary-promo-value").innerText=`- ${s.toFixed(2)}`,(0,i.Ay)("summary-promo").classList.add("inc"))}else(0,i.Ay)("summary-promo").classList.remove("inc");if("Pixlr Team"!==this.productName&&"seats"!==this.checkoutType||!this.extraSeats)(0,i.Ay)("summary-seats").classList.remove("inc");else{const t=this.getSingleSeatPrice();n=this.extraSeats*t,(0,i.Ay)("summary-seats-count").innerText=`x${this.extraSeats} seats`,(0,i.Ay)("summary-seats-value").innerText=n.toFixed(2),(0,i.Ay)("summary-seats").classList.add("inc")}if(this.tax.status?(o=(t-s-this.balanceCredit+n)*(this.tax.percentage/100),(0,i.Ay)("summary-tax-value").innerHTML=o.toFixed(2),(0,i.Ay)("summary-total-tax").style.display="block",(0,i.Ay)("summary-tax").classList.add("inc")):((0,i.Ay)("summary-tax").classList.remove("inc"),(0,i.Ay)("summary-total-tax").style.display="none"),e=t-s-this.balanceCredit+n+o,this.freeTrial){let t=e;e=0;const s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=new Date;n.setDate(n.getDate()+7);const o=`${n.getDate()} ${s[n.getMonth()]} ${n.getFullYear()}`;(0,i.Ay)("proceed-payment").innerText=(0,a.A)("startTrial"),(0,i.Ay)("summary-trial-note").innerText=(0,a.A)("cancelAnytimeOrAutoRenewalForAmount",o,`${this.currencySymbol}${t.toFixed(2)}`),(0,i.Ay)("summary-trial").classList.add("inc")}else(0,i.Ay)("summary-trial").classList.remove("inc");document.querySelectorAll(".total-price").forEach((t=>t.innerHTML=e.toFixed(2)))},this.setPaymentMethod=t=>{let e=t.value;switch("saved-card"===t.dataset.value&&(e="saved-card"),e){case"paypal":this.selectedPayment="paypal",(0,i.Ay)("wrapper-billing-option").style.display="none",(0,i.Ay)("component-container").classList.add("blocked"),(0,i.Ay)("saved-cards").classList.add("blocked"),this.isReadyToPay();break;case"saved-card":if(this.selectedPayment="saved-card",this.selectedSavedCard=t.id,(0,i.Ay)("wrapper-billing-option").style.display="inline-flex",(0,i.Ay)("component-container").classList.add("blocked"),(0,i.Ay)("saved-cards").classList.remove("blocked"),t.className.includes("selected"))return t.classList.remove("selected"),void this.setPaymentMethod((0,i.Ay)("adyen-radio-option"));document.querySelectorAll(".saved-card-item").forEach((t=>{t.classList.remove("selected"),t.classList.add("blocked")})),t.classList.add("selected"),t.classList.remove("blocked"),this.isReadyToPay();break;default:this.selectedPayment="credit",(0,i.Ay)("wrapper-billing-option").style.display="inline-flex",(0,i.Ay)("component-container").classList.remove("blocked"),(0,i.Ay)("saved-cards").classList.remove("blocked"),this.isReadyToPay()}},this.setPlan=t=>{this.splanId=t.dataset.plan,this.selectedPlan=this.setPlanDetails(this.splanId),document.querySelector(".plan-options.selected").classList.remove("selected"),t.classList.add("selected"),this.updatePrice()},this.setPlanDetails=t=>this.subscriptionPlans.filter((e=>e.code===t))[0],this.proceedPayment=async()=>{if("paypal"===this.selectedPayment)return this.loadPaypal();const t=(0,i.Ay)("proceed-payment");if(t.disabled)return;t.disabled=!0;const e=`/checkout/payments/${this.checkoutType}`,s=this.getCheckoutData();try{const t=await d.In(e,"POST",s);"subscription"===this.checkoutType&&t.status&&this.affiliate(t.data),this.paymentResult(t),t.status&&("web"===this.checkoutOptions.platform?setTimeout((()=>{"seats"===this.checkoutType?window.location.href="/myaccount/?tab=team":"giftcard"===this.checkoutType?window.location.href="/myaccount/?tab=redeem":window.location.href="/myaccount/?tab=subscription"}),1500):setTimeout((()=>{null==this||this.cleanUp()}),2500))}catch(a){this.paymentResult({status:!1,message:a.message})}},this.paymentResult=t=>{var e;this.optionUI.style.display="none",this.summaryUI.style.display="none",null===(e=(0,i.Ay)("chckout-result"))||void 0===e||e.remove(),!1===t.status?this.setContent((0,i.T)("div",{id:"chckout-result"},(0,i.T)("img",{src:"/images/icon/red-cross.png",width:100,style:"margin-bottom: 20px"}),(0,i.T)("h2",{style:"margin-bottom: 10px"},(0,a.A)("paymentFailed")),(0,i.T)("p",(0,a.A)("paymentUnsuccessful")))):t.data.processing?(this.setContent((0,i.T)("div",{id:"chckout-result"},(0,i.T)("img",{src:"/images/myaccount/black-loading.gif",width:150}),(0,i.T)("h2",{style:"margin-bottom: 10px"},(0,a.A)("pleaseCompleteYourPaymentAtPaypal")),(0,i.T)("p",{style:"margin-bottom: 10px"},(0,a.A)("pleaseDoNotRefreshOrCloseThisPageWhilePaymentIsProcessing")),(0,i.T)("p",(0,a.A)("youWillAutomaticallyBeRedirectedToMyAccount")))),Object.assign(m.N,t.data.settings)):(this.setContent((0,i.T)("div",{id:"chckout-result"},(0,i.T)("img",{src:"/images/icon/green-tick.png",width:100,style:"margin-bottom: 20px"}),(0,i.T)("h2",{style:"margin-bottom: 10px"},(0,a.A)("paymentSuccessful")),(0,i.T)("p",(0,a.A)("youWillAutomaticallyBeRedirectedToMyAccount")))),Object.assign(m.N,t.data.settings))},this.loadAdyen=async()=>{var t;const[e]=await Promise.all([s.e(8636).then(s.bind(s,52455)).then((t=>t.default)),s.e(8636).then(s.bind(s,36971))]),{paymentMethods:a,paymentCards:n,adyenClientKey:o,proRatedSeats:r,affiliate:h}=await d.Wv({splan:"premium-monthly"}),l={locale:"en_US",environment:"pixlr.com"===window.location.hostname?"live":"test",clientKey:o,paymentMethodsResponse:a,onChange:this.handleOnChange};(null==a?void 0:a.storedPaymentMethods)&&n&&(((t,e)=>{const s=(0,i.Ay)("saved-cards");s.innerHTML="",t.forEach((t=>{if(!e.includes(t.id))return;const a=(0,i.T)("div",{id:t.id,className:"saved-card-item",dataset:{value:"saved-card"}},(0,i.T)("object",{data:`/images/checkout/${t.brand}.png`,type:"image/png",style:"margin-left: auto"},(0,i.T)("img",{src:`https://checkoutshopper-live.adyen.com/checkoutshopper/images/logos/${t.brand}.svg`,style:"margin-left: auto"})),(0,i.T)("div",{style:"display: flex; justify-content: space-between"},(0,i.T)("span","****"),(0,i.T)("span","****"),(0,i.T)("span","****"),(0,i.T)("span",`${t.lastFour}`)),(0,i.T)("div",(0,i.T)("span",{style:"font-size: 8px; margin-right: 8px"},"MM/YY"),(0,i.T)("span",{style:"font-size: 12px"},`${t.expiryMonth}/${t.expiryYear.substring(4,2)}`)));e[0]===t.id?s.prepend(a):s.append(a)}))})(a.storedPaymentMethods,n),document.querySelectorAll(".saved-card-item").forEach((t=>{t.addEventListener("click",(()=>{this.setPaymentMethod(t)}))}))),r&&console.log("check back here");new e(l).create("card",{hasHolderName:!0,holderNameRequired:!0}).mount("#component-container"),null===(t=(0,i.Ay)("chckout-loading"))||void 0===t||t.remove()},this.loadPaypal=async()=>{const t="/paypal/"+("subscription"===this.checkoutType?"subscriptions":"purchase"),e=this.getCheckoutData();try{const s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)}),a=await s.json();if(a.status){const t=800,e=650,s=(screen.width-t)/2,n=(screen.height-e)/4,o=window.open(a.redirectUrl,"Paypal Checkout",`resizable=yes,width=800,height=650,top=${n},left=${s}`);this.paymentResult({status:!0,data:{processing:!0}});"success"===(await async function(t,e=5e3,s=3e4){const i=(new Date).getTime()+s,a=(s,n)=>{Promise.resolve(t()).then((t=>{console.log(t);const o=(new Date).getTime();"success"===t.status?s(t):o<i||"pending"===t.status?setTimeout(a,e,s,n):n(new Error("AsyncPoller: reached timeout"))})).catch((t=>{n(t)}))};return new Promise(a)}((async()=>{try{const t=await d.sG(a.id,this.checkoutType);return Promise.resolve(t)}catch(t){return Promise.reject(t)}}),500,15e3)).status&&((0,i.Ay)("try-premium")&&((0,i.Ay)("try-premium").style.display="none"),o.close(),this.paymentResult({status:!0,data:{}}),setTimeout((()=>{var t;null==this||this.cleanUp(),"web"===(null===(t=this.checkoutOptions)||void 0===t?void 0:t.platform)&&(window.location.href="/myaccount/?tab=subscription")}),2500))}else this.paymentResult({status:!1,message:""})}catch(s){console.error(s),this.paymentResult({status:!1,message:""})}},this.handleOnChange=t=>{const{data:{paymentMethod:e},isValid:s}=t;this.encryptedCardData.isValid=s,this.encryptedCardData.paymentMethod=e,this.encryptedCardData.cardHolderName=document.getElementsByClassName("adyen-checkout__input--text")[0].value,this.isReadyToPay()},this.requiredBillingInput=["firstName","lastName","address","city","zipCode","state"],this.isReadyToPay=()=>{const{isValid:t,paymentMethod:e}=this.encryptedCardData,s=(0,i.Ay)("proceed-payment");try{if("paypal"===this.selectedPayment&&(s.disabled=!1),"credit"===this.selectedPayment){if(!t)throw!1;if(!this.encryptedCardData.cardHolderName.length)throw!1}const e=Object.values(this.paymentData.billingAddress).filter((t=>""!==t)).length;1===e&&(s.disabled=!1),1!==e&&this.requiredBillingInput.forEach((t=>{if(!this.paymentData.billingAddress[t])throw!1})),s.disabled=!1}catch(a){s.disabled=!0}},this.backPreviousPopup=()=>{if(this.cleanUp(),"premiumbounce"===this.checkoutOptions.bounceSource)new g.A(this.checkoutOptions.bounceType,"premium")},this.getCreditsByPrice=t=>{if(200===t)return 2.99;if(500===t)return 4.99;if(1e3===t)return 7.99;if(2e3===t)return 12.99;if(5e3===t)return 24.99;throw new Error("Invalid amount")},this.getCreditsByPlan=()=>"plus-monthly"===this.splanId?80:"plus-yearly"===this.splanId?960:"premium-monthly"===this.splanId?1e3:"premium-yearly"===this.splanId?12e3:"team-monthly"===this.splanId?1e3:"team-yearly"===this.splanId?12e3:void 0,this.getSingleSeatPrice=()=>{var t;if("seats"===this.checkoutType)return(null===(t=null===m.N||void 0===m.N?void 0:m.N.subscriptionCode)||void 0===t?void 0:t.includes("monthly"))?3.99:47.88;if("subscription"===this.checkoutType)return this.splanId.includes("monthly")?3.99:47.88;throw new Error("Configuration error...")},this.getCheckoutData=()=>{var t,e,s;const i={checkoutMethod:"checkout",billingAddress:null!==(e=null===(t=this.paymentData)||void 0===t?void 0:t.billingAddress)&&void 0!==e?e:{},currency:this.currency,promo:this.appliedPromo?this.appliedPromo.code:"",captchaToken:"!!"};return"upgrade"===(null===(s=this.checkoutOptions)||void 0===s?void 0:s.checkoutMode)&&(i.checkoutMethod="upgrade"),"subscription"===this.checkoutType?(i.splan=this.splanId,i.freeTrial=this.freeTrial):"giftcard"===this.checkoutType?(i.giftId=this.giftCardId,i.giftDetails=this.checkoutOptions.isAGift):"credits"===this.checkoutType&&(i.credits=this.genCredits),"credit"===this.selectedPayment?i.paymentMethod=this.encryptedCardData.paymentMethod:"saved-card"===this.selectedPayment&&this.selectedSavedCard&&(i.paymentCard=this.selectedSavedCard),"Pixlr Team"!==this.productName&&"seats"!==this.checkoutType||(i.seatsToAdd=this.extraSeats),i},this.loadAwin=()=>{this.dialog.append((0,i.T)("script",{src:"https://www.dwin1.com/65758.js",type:"text/javascript",defer:!0}))},this.affiliate=t=>{if(this.trackShareASale(t),t.awin){const{params:s}=t.awin;if(document.body.append((0,i.T)("img",{src:`https://www.awin1.com/sread.img?tt=ns&tv=2&merchant=65758&amount=${s.amount}&cr=${s.cr}&ref=${s.ref}&parts=DEFAULT:${s.saleAmount}&vc=${s.vc}&ch=${s.ch}&customeracquisition=${s.customeracquisition}`,width:0,height:0,style:{border:"none"}})),void 0!==e&&void 0!==e.Tracking){var e={};e.Tracking.Sale={},e.Tracking.Sale.amount=s.amount,e.Tracking.Sale.orderRef=s.ref,e.Tracking.Sale.parts=`DEFAULT:${s.amount}`,e.Tracking.Sale.voucher=s.vc,e.Tracking.Sale.currency=s.cr,e.Tracking.Sale.channel=s.ch,e.Tracking.Sale.customerAcquisition=s.customeracquisition,e.Tracking.run()}else{const t=(0,i.T)("script",{type:"text/javascript"});t.innerHTML=`\n                    //<![CDATA[ /*** Do not change ***/\n                        var AWIN = {};\n                        AWIN.Tracking = {};\n                        AWIN.Tracking.Sale = {};\n                        /*** Set your transaction parameters ***/\n                        AWIN.Tracking.Sale.amount = "${s.amount}";\n                        AWIN.Tracking.Sale.orderRef = "${s.ref}";\n                        AWIN.Tracking.Sale.parts = "DEFAULT:${s.amount}";\n                        AWIN.Tracking.Sale.voucher = "${s.vc}";\n                        AWIN.Tracking.Sale.currency = "${s.cr}";\n                        AWIN.Tracking.Sale.channel = "${s.ch}";\n                        AWIN.Tracking.Sale.customerAcquisition = "${s.customeracquisition}";\n                    //]]>\n                `,document.body.append(t),this.loadAwin()}}},this.trackShareASale=t=>{const{merchantReference:e,paidAmount:s,currency:i,sscid:a,newCustomer:n=0}=t;if(a){const t=document.createElement("img");t.id="_SHRSL_img_1",t.src=`https://www.shareasale.com/sale.cfm?tracking=${e}&amount=${s}&merchantID=94987&transtype=sale&sscidmode=6&sscid=${a}&currency=${i}&newcustomer=${n}`,t.style.width="1",t.style.height="1";const o=document.createElement("script");o.src="https://www.dwin1.com/19038.js",o.type="text/javascript",o.defer=!0,this.dialog.appendChild(t),this.dialog.appendChild(o)}},(0,u.A)("checkout",t),this.checkoutType=t,this.checkoutOptions=Object.assign(Object.assign({},this.checkoutOptions),e),s.e(7162).then(s.bind(s,81413)),this.dialog.id="chckout",this.setContent(`\n            <div id="chckout-loading">${(0,a.A)("pleaseWaitWhileCheckoutLoading")}</div>\n            <div id="chckout-options"></div>\n            <div id="chckout-summary"></div>\n        `),this.optionUI=(0,i.Ay)("chckout-options"),this.summaryUI=(0,i.Ay)("chckout-summary"),this.checkoutOptions.bounceSource&&this.optionUI.append((0,i.T)("img",{id:"back-chckout",src:"/img/icon/arrow-left-black.svg"})),"subscription"===this.checkoutType)this.splanId=null!==(n=this.checkoutOptions.plan)&&void 0!==n?n:"premium-monthly",this.splanId.includes("plus")?this.productName="Pixlr Plus":this.splanId.includes("premium")?this.productName="Pixlr Premium":this.splanId.includes("team")&&(this.productName="Pixlr Team"),this.freeTrial="checkout"===this.checkoutOptions.checkoutMode&&"Pixlr Premium"===this.productName&&m.N.eligibleForTrail,Promise.all([d.gs(),d.Vi(this.splanId)]).then((([t,e])=>{var s;if(!t.status)throw new Error("Failed to get plan details");if("upgrade"===this.checkoutOptions.checkoutMode&&e.status&&(this.balanceCredit=e.data.balanceCredit),this.subscriptionPlans=t.data,this.selectedPlan=this.setPlanDetails(this.splanId),this.optionUI.append(o(this.splanId,this.productName,this.subscriptionPlans)),"Pixlr Team"===this.productName&&this.optionUI.append(l()),this.optionUI.append(r()),this.optionUI.append(h()),this.optionUI.append((0,i.T)("details",{id:"wrapper-promo-option",className:"kort"},(0,i.T)("summary",{style:"display: flex; align-items: center;"},(0,i.T)("img",{src:"/images/checkout/icon/percent.svg",width:24,height:24,style:"margin-right: 8px;"}),(0,i.T)("span",{className:"fs-16 fw-7"},(0,a.A)("promoCode")),(0,i.T)("img",{src:"/images/icon/up.svg",style:"margin-left: auto"})),(0,i.T)("div",(0,i.T)("div",{id:"promo-section"},(0,i.T)("input",{id:"promocode-input",type:"text",placeholder:(0,a.A)("enterPromoCode")}),(0,i.T)("span",{id:"promocode-submit",className:"apply"},(0,a.A)("apply"))),(0,i.T)("p",{id:"promocode-error"},(0,a.A)("invalidPromoCode")),(0,i.T)("p",{className:"text-small",style:"margin-top: 8px"},(0,a.A)("promoCodeValidOneTimeOnly"))))),this.summaryUI.append(c(this.checkoutType,this.productName)),"upgrade"!==this.checkoutOptions.checkoutMode||e.status){if(("checkout"===this.checkoutOptions.checkoutMode&&"Pixlr Plus"===this.productName||"upgrade"===this.checkoutOptions.checkoutMode&&"premium-yearly"!==this.splanId)&&(null===(s=(0,i.Ay)("wrapper-promo-option"))||void 0===s||s.remove()),"upgrade"===this.checkoutOptions.checkoutMode&&e.status){document.querySelector("#chckout-planSelection .plan-options").style.display="none",(0,i.Ay)("summary-balance-value").innerText=`- ${e.data.balanceCredit.toFixed(2)}`,(0,i.Ay)("summary-balance").classList.add("inc")}(0,i.Ay)("paypal-payment-option")&&"Pixlr Team"===this.productName&&((0,i.Ay)("paypal-payment-option").style.display="none"),this.checkoutOptions.code&&((0,i.Ay)("promocode-input").value=this.checkoutOptions.code,this.applyPromoCode(),this.checkoutOptions.code=""),this.loadAdyen(),this.loadEventListener()}else this.paymentResult({status:!1,message:""})}));else if("giftcard"===this.checkoutType){if(this.giftCardId=this.checkoutOptions.giftcard,!this.giftCardId)throw new Error("Missing giftcard details!");this.loadGiftCardUI()}else"seats"===this.checkoutType?(this.loadSeatsUI(),this.selectSeats(document.querySelector(".seat-option"))):"credits"===this.checkoutType&&(this.loadCreditsUI(),this.selectCredit(document.querySelector(".credit-option")))}}},78832:(t,e,s)=>{s.d(e,{P2:()=>n});var i,a=s(54738);async function n(){try{return await h.open()}catch(t){return Promise.resolve(new d)}}class o{constructor(t){this.next=()=>this.queue.pop(),this.queue=[new a.wc];let e=this.queue[0];t.onsuccess=()=>{const s=t.result;s?(e.resolve({done:!1,value:s.value}),e=new a.wc,this.queue.unshift(e),s.continue()):e.resolve({done:!0,value:void 0})},t.onerror=()=>{e.reject(t.error)}}[Symbol.asyncIterator](){return this}}class r{constructor(t){this.inner=t}static bound(t,e,s=!1,i=!1){return new r(IDBKeyRange.bound(t,e,s,i))}static lowerBound(t,e){return new r(IDBKeyRange.lowerBound(t,e))}static upperBound(t,e){return new r(IDBKeyRange.upperBound(t,e))}static only(t){return new r(IDBKeyRange.only(t))}static unwrap(t){return t instanceof r?t.inner:t}}class h{constructor(t){this.underlying=t}static availiable(){return!navigator.userAgent.includes("Edge")&&!!window.indexedDB}transaction(t,...e){const s=this.underlying.transaction(e,t);return e.map((t=>new l(s.objectStore(t))))}}i=h,h.open=async()=>i.availiable()?new Promise(((t,e)=>{const s=window.indexedDB.open("pixlr",2);s.onupgradeneeded=t=>{const e=s.result;0===t.oldVersion?(e.createObjectStore("blobs"),e.createObjectStore("fonts"),e.createObjectStore("document-meta",{keyPath:"id"}),e.createObjectStore("document-selection"),e.createObjectStore("document-thumbnail"),e.createObjectStore("layer-meta",{keyPath:"id"}).createIndex("document","document"),e.createObjectStore("layer-mask"),e.createObjectStore("layer-bitmap")):e.deleteObjectStore("history")},s.onerror=t=>e(s.error),s.onsuccess=()=>t(new i(s.result))})):Promise.reject(new Error("Browser does not support indexedDB"));class l{constructor(t){this.underlying=t}get(t){return new Promise(((e,s)=>{const i=this.underlying.get(t);i.onsuccess=()=>e(i.result),i.onerror=()=>s(i.error)}))}getAll(t,e){return new Promise(((s,i)=>{const a=this.underlying.getAll(r.unwrap(t),e);a.onsuccess=()=>s(a.result),a.onerror=()=>i(a.error)}))}iterate(t,e){const s=this.underlying.openCursor(r.unwrap(t),e);return new o(s)}index(t){const e=this.underlying.index(t);return new c(e)}cursor(t,e,s){return new Promise(((i,a)=>{const n=this.underlying.openCursor(r.unwrap(e),s);n.onsuccess=()=>{const e=n.result;if(e){const s=t(e.value,e);"number"==typeof s?e.advance(s):!1!==s?e.continue():i()}else i()},n.onerror=()=>a(n.error)}))}put(t,e){return new Promise(((s,i)=>{const a=this.underlying.put(t,e);a.onsuccess=()=>{s()},a.onerror=()=>{i(a.error)}}))}add(t,e){return new Promise(((s,i)=>{const a=this.underlying.add(t,e);a.onsuccess=()=>{s()},a.onerror=()=>{i(a.error)}}))}clear(){return new Promise(((t,e)=>{let s=this.underlying.clear();s.onsuccess=()=>t(),s.onerror=()=>e(s.error)}))}count(t){return new Promise(((e,s)=>{let i;i=void 0===t?this.underlying.count():this.underlying.count(r.unwrap(t)),i.onsuccess=()=>e(i.result),i.onerror=()=>s(i.error)}))}delete(t){return new Promise(((e,s)=>{const i=this.underlying.delete(r.unwrap(t));i.onsuccess=()=>e(),i.onerror=()=>s(i.error)}))}}class c{constructor(t){this.underlying=t,this.name=t.name,this.keyPath=t.keyPath,this.multiEntry=t.multiEntry,this.unique=t.unique}get(t){return new Promise(((e,s)=>{const i=this.underlying.get(t);i.onsuccess=()=>e(i.result),i.onerror=()=>s(i.error)}))}getAll(t,e){return new Promise(((s,i)=>{const a=this.underlying.getAll(r.unwrap(t),e);a.onsuccess=()=>s(a.result),a.onerror=()=>i(a.error)}))}count(t){return new Promise(((e,s)=>{let i;i=void 0===t?this.underlying.count():this.underlying.count(r.unwrap(t)),i.onsuccess=()=>e(i.result),i.onerror=()=>s(i.error)}))}cursor(t,e,s){return new Promise(((i,a)=>{const n=this.underlying.openCursor(r.unwrap(e),s);n.onsuccess=()=>{const e=n.result;e?(t(e.value,e),e.continue()):i()},n.onerror=()=>a(n.error)}))}iterate(t,e){const s=this.underlying.openCursor(r.unwrap(t),e);return new o(s)}getAllKeys(t,e){return new Promise(((s,i)=>{const a=this.underlying.getAllKeys(r.unwrap(t),e);a.onsuccess=()=>s(a.result),a.onerror=()=>i(a.error)}))}}class d{transaction(t,...e){return e.map((t=>new u(t)))}}class u{constructor(t){this.name=t}index(t){return this}put(t,e){}add(t,e){}clear(){}delete(t){}async get(t){}async getAll(t,e){return[]}async count(t){return 0}async cursor(t,e,s){}iterate(t,e){return{next:()=>Promise.resolve({done:!0,value:void 0}),[Symbol.asyncIterator](){return this}}}}},42268:(t,e,s)=>{s.d(e,{Ay:()=>n,Bb:()=>l,J9:()=>h,T:()=>o,TT:()=>d,lR:()=>r,y8:()=>c});var i=s(21742),a=s(41915);function n(t){return document.getElementById(t)}function o(t,...e){const s=document.createElement(t);if(0===e.length)return s;const i=e[0],a=!("string"==typeof i||i instanceof HTMLElement),n=a?e.slice(1):e;if(a&&i){if(i.style){const t=i.style;delete i.style,"string"==typeof t?s.setAttribute("style",t):Object.assign(s.style,t)}if(i.dataset){const t=i.dataset;delete i.dataset,"object"==typeof t&&Object.entries(t).map((([t,e])=>s.setAttribute(`data-${t}`,e)))}i.tooltip&&s.setAttribute("tooltip",i.tooltip),i.flow&&s.setAttribute("flow",i.flow),Object.assign(s,i)}return s.append(...n.filter((t=>null!=t))),s}function r(t,e){const s=document.cookie.split(";").map((t=>t.trim().split("="))).find((([e,s])=>e===t));return s?s[1]:e}function h(t){return new Promise((e=>{const s=new IntersectionObserver((([t])=>{e(1===t.intersectionRatio),s.disconnect()}));s.observe(t)}))}function l(t,e,s,i){t.style.touchAction="none";const n=t=>{t.stopPropagation(),t.preventDefault(),s&&s(new a.A(t.clientX,t.clientY))},o=e=>{e.stopPropagation(),e.preventDefault(),i&&i(new a.A(e.clientX,e.clientY)),t.removeEventListener("pointermove",n,!0),t.removeEventListener("pointerup",o,!0),t.releasePointerCapture(e.pointerId)};t.addEventListener("pointerdown",(s=>{s.preventDefault(),s.button>0||(t.addEventListener("pointermove",n,!0),t.addEventListener("pointerup",o,!0),t.setPointerCapture(s.pointerId),e&&e(new a.A(s.clientX,s.clientY)))}),!0)}const c=(t="success",e="common-ServerError",s=3,a)=>{let r=e?(0,i.A)(e):"danger"==t?(0,i.A)("common-ServerError"):(0,i.A)("common-success");a&&(r=r.replace("{email}",a)),document.body.append(o("div",{id:"toast-box",className:`toast ${t}`},o("span",o("img",{src:`/images/icon/${t}_alert.svg`})),o("span",{className:"toast-text"},r),o("span",{className:`toast-close ${t}`,style:"line-height: 0;",onclick:()=>{var t;return null===(t=n("toast-box"))||void 0===t?void 0:t.remove()}},o("img",{style:"width: 14px;",src:"/images/icon/close.png"})))),setTimeout((()=>{var t;return null===(t=n("toast-box"))||void 0===t?void 0:t.remove()}),1e3*s)};function d(t,e,s,a=!1){let n=!1;if(e||(e=t.value),"email"===s)(e=e.trim()).match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||a&&""===e?(t.classList.remove("invalid"),t.nextElementSibling.style.display="none"):(n=!0,t.classList.add("invalid"),t.nextElementSibling.style.display="block");else if("password"===s){const s=t.nextElementSibling;e.length<8||e.length>50?(n=!0,t.classList.add("invalid"),s.style.display="block",e.length<8?s.innerHTML=(0,i.A)("common-MinPassword"):e.length>50&&(s.innerHTML=(0,i.A)("common-MaxPassword"))):e.indexOf("'")>-1||e.indexOf('"')>-1?(n=!0,t.classList.add("invalid"),s.style.display="block",s.innerHTML=(0,i.A)("common-InvalidSpecialChar")):(t.classList.remove("invalid"),s.style.display="none")}else if("code"===s){const s=t.nextElementSibling;6!==e.length?(t.classList.add("invalid"),s.style.display="block",n=!0):(t.classList.remove("invalid"),s.style.display="none"),setTimeout((()=>{t.classList.remove("invalid"),s.style.display="none"}),3e3)}return!n}},37699:(t,e,s)=>{s.d(e,{A:()=>l});var i=s(54738),a=s(78832),n=s(6395),o=s(89209);class r{constructor(t,e,s=!1,i="woff",a,n){this.name=t,this.short=e,this.premium=s,this.local=!!a,this.thumb=n,this.font=a,this.type=i}static async save(t){const e=await(0,a.P2)(),[s]=e.transaction("readwrite","fonts");await s.put(t,t.name)}static async delete(t){const e=await(0,a.P2)(),[s]=e.transaction("readwrite","fonts");await s.delete(t.name)}}class h{static async loadFontFromTemplate(t,e,s){var i,a;let n=null===(i=s.split(".")[0])||void 0===i?void 0:i.toLowerCase(),o=null===(a=s.split(".")[1])||void 0===a?void 0:a.toLowerCase();return await h.createLocalFontDesc(t,e,n,o)}static async loadFontFromUpload(t){var e,s;let i=null===(e=t.name.split(".")[0])||void 0===e?void 0:e.substring(0,50).replace(/[~`!@#$%^&*()+={}\[\];:\'\"<>.,\/\\\?]/g,"").replace(/-/g," ").replace(/   /g," ").replace(/  /g," "),a=null===(s=t.name.split(".")[1])||void 0===s?void 0:s.toLowerCase(),n=i.substring(0,20).replace(" ","").toLowerCase();if(i=(null==i?void 0:i.charAt(0).toUpperCase())+(null==i?void 0:i.slice(1)),h.fontList.find((t=>t.name===i)))return void document.dispatchEvent(new CustomEvent("notification",{detail:"Font already exists!"}));let o=a;switch(a){case"otf":o="opentype";break;case"ttf":o="truetype"}const r=new Blob([t],{type:"font/"+o});let l=await h.createLocalFontDesc(r,i,n,a);return l&&document.dispatchEvent(new CustomEvent("notification",{detail:"Font was added!"})),l}static async createLocalFontDesc(t,e,s,a){const n=new r(e,s,!1,a,t);try{await h.addToDOM(n)}catch(p){return console.log(p),void document.dispatchEvent(new CustomEvent("notification",{detail:"Failed to load font!"}))}let l=new o.A(e,56);l.height>72&&l.setSize(Math.floor(72/l.height*56));const c=i.VI(500,80),d=c.getContext("2d");d.font=l.getCssFont(),d.fillStyle="#ffffff",d.textBaseline="top",d.fillText(e,0,Math.round((80-l.height)/2)-l.ascent);var u;return n.thumb=await(u=c,new Promise(((t,e)=>{u.toBlob((e=>{t(e)}),"image/png")}))),await r.save(n),h.fontList.unshift(n),n}static async removeLocalFontDesc(t){let e=h.getFontDesc(t);e&&(await r.delete(e),h.fontList=h.fontList.filter((t=>t!==e)))}static async addToDOM(t){if(!t)return;const e=t.local?new FontFace(t.name,await(0,n.CB)(t.font)):new FontFace(t.name,`url(/font/${t.short}.woff) format('woff')`);if(document.fonts.has(e))return Promise.resolve(e);let s=await e.load();return document.fonts.add(s),s}static getFontDesc(t){return h.fontList.find((e=>e.name===t))}static async getFontFile(t){let e=this.getFontDesc(t);if(!e)return;if(e.local)return new File([e.font],e.name);let s=await fetch("/font/"+e.short+".woff").then((t=>t.blob()));return s?new File([s],e.short+".woff",{type:"font/woff"}):void 0}static async loadSaved(){const t=await(0,a.P2)(),[e]=t.transaction("readonly","fonts");return e.iterate()}}h.fontList=[new r("Arial","arial"),new r("Courier New","courier"),new r("Georgia","georgia"),new r("Trebuchet MS","trebuchet"),new r("Verdana","verdana"),new r("Aberus","aberus"),new r("Ablation","ablation",!0),new r("Adeft","adeft"),new r("Adelya","adelya",!0),new r("Adios Amigos","adios"),new r("Adolfine","adolfine"),new r("Agnostic","agnostic",!0),new r("Aiden","aiden"),new r("Amaranth","amaranth"),new r("Amateur Typewriter","amateur",!0),new r("Alder","alder",!0),new r("Almondia","almondia"),new r("Aloma Island","alomaisland",!0),new r("Alvida","alvida"),new r("Amoreiza","amoreiza"),new r("AmoretteLight","amorette"),new r("Angeleno Brush Script","angeleno",!0),new r("Antreas","antreas"),new r("Arm Race","arm"),new r("Artick","artick"),new r("Asap","asap"),new r("Atomsfer","atomosfer"),new r("Atthens","atthens"),new r("Avocado Sans","avocado",!0),new r("Baangkarr Press","baangkarr",!0),new r("Badstar","badstar",!0),new r("Bahram","bahram"),new r("Baileyns","baileyns"),new r("Barooduck","barooduck",!0),new r("Bearley","bearley"),new r("Beat","beat",!0),new r("BebasNeue","bebasneue"),new r("Bellquinas","bellquinas"),new r("Bengrraas","bengrraas"),new r("Beornheard","beornheard"),new r("Berretti","berretti"),new r("Biker New","biker",!0),new r("Blossom Berry Script","blossomberry",!0),new r("Boullervard","boullervard"),new r("Bondie","bondie",!0),new r("Bondrians","bondrians",!0),new r("Braga Deco","braga"),new r("Brave Hearted","brave"),new r("Bright Orchid","brightorchid",!0),new r("Brioche","brioche",!0),new r("Brocklyn","brocklyn"),new r("Bronzier","bronzier",!0),new r("Brooklyn","brooklyn",!0),new r("Brodetto","brodetto"),new r("Bronela","bronela",!0),new r("The Brownies","brownies"),new r("Bubbble Gum","bubbblegum",!0),new r("Brushcheetah","brushcheetah"),new r("Butternut Script","butternut",!0),new r("Caang","caang"),new r("Cakehtreuks","cakehtreuks"),new r("Cannoli Poke","cannoli",!0),new r("Camille","camille"),new r("Calamandria","calamandria"),new r("Caldwell","caldwell",!0),new r("Carafun","carafun"),new r("Carnavonts","carnavonts"),new r("Carvino","carvino"),new r("Cervantes","cervantes"),new r("Chaiaathah","chaiaathah",!0),new r("Chalkyal","chalkyal"),new r("Chiqarine","chiqarine"),new r("Chukies","chukies"),new r("Cincoyo","cincoyo"),new r("Clockwise","clockwise",!0),new r("Coast Redwood","coast"),new r("Colombo","colombo",!0),new r("College","college",!0),new r("Companion","companion"),new r("Corlombus","corlombus"),new r("Conseration","conseration",!0),new r("CuprumFFU","cuprum"),new r("Cupello sons","cupello",!0),new r("Costa Mala","costamala",!0),new r("Cozy","cozy",!0),new r("CreamyMoony","creamy"),new r("Cross Road","crossroad",!0),new r("Cross Road Slab","crossroadslab",!0),new r("Daddy Day","daddy"),new r("Dankduck","dankduck"),new r("Darbots","darbots",!0),new r("Davish","davish",!0),new r("Davish Rounded","davishround",!0),new r("Dear Journal","dearjournal",!0),new r("Delicious","delicious",!0),new r("Desmodus","desmodus"),new r("Desmosedici","desmosedici"),new r("Dhangdose","dhangdose"),new r("Dingle","dingle",!0),new r("Djangart Rough","djangart"),new r("Dolington","dolington",!0),new r("Doppelganger","doppelganger",!0),new r("Dorr","dorr",!0),new r("Dustin","dustin",!0),new r("Earth And Sky","earth"),new r("Easterica","easterica"),new r("Eastone","eastone"),new r("Eastwood","eastwood",!0),new r("Echizen","echizen"),new r("El-Karnito","elkarnito"),new r("Elliot","elliot"),new r("Elysian","elysian",!0),new r("Emery","emery"),new r("Empire View","empire"),new r("Eugiene","eugiene"),new r("Espano","espano",!0),new r("Erleane","erleane"),new r("Everleigh","everleigh",!0),new r("Exquisite","exquisite",!0),new r("Espano","espano",!0),new r("Farewell Angelina","angelina",!0),new r("Father and Son","father"),new r("Fatherly","fatherly"),new r("Fenord","fenord",!0),new r("Finland","finland",!0),new r("Flamingo","flamingo"),new r("FoxyMist","foxy"),new r("Forever Freedom","forever",!0),new r("Game On","game"),new r("Gamour","gamour",!0),new r("Gallerina","gallerina",!0),new r("Geronide","geronide",!0),new r("Geronide Stamp","geronidestamp",!0),new r("Gingle Snowland","ginglesnowland",!0),new r("Gingerbreads","gingerbreads"),new r("Gladiolusy","gladiolusy",!0),new r("Glamper","glamper",!0),new r("Goldie Dreambox","goldiedreambox",!0),new r("Gordon","gordon",!0),new r("Gorgeous","gorgeous",!0),new r("Gingerly","gingerly",!0),new r("Goorraatt","goorraatt"),new r("Grayson","grayson",!0),new r("Great Again","great"),new r("Grovana","grovana",!0),new r("Gustavo","gustavo"),new r("Haahloddoh","haahloddoh"),new r("Hadrea","hadrea"),new r("Hairmusk","hairmusk"),new r("Hakushou","hakushou"),new r("Harietta","harietta",!0),new r("Hattori Hanzo","hattori"),new r("Haystacks","haystacks",!0),new r("Heater","heater"),new r("Hedonist","hedonist",!0),new r("Hello Alpha","helloa"),new r("Hello Daddy","hellod",!0),new r("Hello People","hello"),new r("Hello Spring","hellospring",!0),new r("Hellowins","hellowins"),new r("Heypatricks","heypatricks"),new r("Highway","highway",!0),new r("Hippo Letto","hippo"),new r("Historia","historia",!0),new r("Hollawind","hollawind"),new r("Hodor","hodor",!0),new r("Honey","honey"),new r("Honeyspice","honeyspice",!0),new r("Huckleberries","huckleberries"),new r("Hymned Sans","hymnedsans",!0),new r("Hymned Script","hymnedscript",!0),new r("IacottNeue","iacottneue",!0),new r("Icebold","icebold",!0),new r("Inder","inder"),new r("Indigo","indigo",!0),new r("Irish gold","irishgold"),new r("Irishgreen","irishgreen"),new r("Its mine","itsmine"),new r("Jacinda","jacinda",!0),new r("Jared","jared"),new r("Jarots","jarots"),new r("Jomantara","jomantara"),new r("Josefin","josefin"),new r("Juneville","juneville"),new r("Jura","jura"),new r("Kajika","kajika"),new r("Kakamora","kakamora"),new r("Katey Blue","kateyblue",!0),new r("Keripik","keripik"),new r("Ketapang","ketapang"),new r("Kindel","kindel",!0),new r("Kingbirds","kingbirds",!0),new r("Laahleggek","laahleggek"),new r("Laborations","laborations"),new r("La Fiesta","lafiesta"),new r("Landon","landon"),new r("Landre","landre",!0),new r("Langley","langley"),new r("La Vonn","vonn"),new r("Laudya Bloods","laudya"),new r("Leaderson","leaderson"),new r("Leath","leath"),new r("Legendum","legendum"),new r("Leobronx","leobronx"),new r("Little Edelweiss","little"),new r("Little Girl","littlegirl"),new r("Lotus Eater","lotuseater",!0),new r("Lobster","lobster"),new r("Lovalicious","lovalicious",!0),new r("Loverstruck","loverstruck"),new r("MaaLLaangBronks","maallaangbronks"),new r("Madison","madison"),new r("Magic Winter","magicwinter"),new r("Magic Trick","magic"),new r("Mai Leho Bahhrala","maileho"),new r("Maldisa","maldisa"),new r("Malinsha","malinsha",!0),new r("Maple Leaves","mapleleaves",!0),new r("Maxton","maxton"),new r("Market","market"),new r("Marones","marones",!0),new r("Me and my dog","meandmydog",!0),new r("Meidy","meidy"),new r("Menighampiil","menighampiil"),new r("Mewton","mewton"),new r("Merry Merry","merrymerry",!0),new r("Molot","molot"),new r("Momday","momday"),new r("Moms Note","moms"),new r("Monday Lovers","monday"),new r("Monetta","monetta"),new r("Mongli","mongli"),new r("Montour","montour"),new r("Morissette Script","morissette"),new r("Mountain","mountain"),new r("Mooka","mooka",!0),new r("More Magic","moremagic",!0),new r("Morgana Sonz","morgana",!0),new r("Nature Force","natureforce",!0),new r("Ms Orange Sky","ms"),new r("Najova","najova"),new r("Natarajasana","natarajasana"),new r("Naville","naville"),new r("Neorah","neorah"),new r("New Autumn","new"),new r("No Siesta","nosiesta"),new r("Night Jump","nightjump"),new r("Notes","notes",!0),new r("NoFire","nofire"),new r("North Avellion","northavellion",!0),new r("Northern","northern"),new r("North High Shadow","northhighsdw",!0),new r("North High","northhigh",!0),new r("Novante","novante",!0),new r("Nunu","nunu"),new r("Offlander","offlander",!0),new r("Oliemolly","oliemolly",!0),new r("Oracles","oracles"),new r("Ostern","ostern"),new r("Otakaku","otakaku"),new r("Out Hill","out"),new r("Overdose","overdose"),new r("Paabaalioot","paabaalioot"),new r("Painted Gallery","paintedgallery",!0),new r("Pandoura","pandoura"),new r("PapaRocknRoll","papa"),new r("Paradise","paradise"),new r("Patlabour","patlabour",!0),new r("Peach Market","peachmarket",!0),new r("Peanut","peanut"),new r("Peony Rose","peonyrose",!0),new r("Perfect Thoughts","perfectthoughts",!0),new r("Pina Colada","pinacolada",!0),new r("Piqolo","piqolo"),new r("Pixelo","pixelo"),new r("Plunge","plunge"),new r("Pop Fist","pop"),new r("Ponch","ponch",!0),new r("Popera","popera"),new r("Powder","powder",!0),new r("Practish","practish"),new r("Print Clearly","print"),new r("Pulsate","pulsate",!0),new r("Qlassik","qlassik"),new r("quatro","quatro",!0),new r("Quattrocento","quattrocento"),new r("Queenata","queenata"),new r("Quella Script","quella"),new r("Questro","questro"),new r("Quickie Sweet","quickie"),new r("Quill & Ink","quillink"),new r("Quish","quish"),new r("Ranania","ranania"),new r("Rankings Caps","rankingscaps",!0),new r("Raroedette","raroedette"),new r("Rawwwing","rawwwing"),new r("Raquella","raquella"),new r("Reepouh","reepouh"),new r("Regan Slab","regan"),new r("Reewoooh","reewoooh",!0),new r("Reilly","reilly"),new r("Remembrance","remembrance",!0),new r("Retrocycles","retrocycles"),new r("Retros","retros"),new r("Revans","revans",!0),new r("Reynolds Square","reynoldssquare",!0),new r("Rhapsody","rhapsody"),new r("Riverside","riverside"),new r("Republiko","republiko",!0),new r("Rocky","rocky"),new r("Roars","roars"),new r("Rockford","rockford",!0),new r("Rockrace","rockrace",!0),new r("Romaniesta","romaniesta"),new r("Romelio","romelio"),new r("Roossooh","roossooh"),new r("Ropa","ropa"),new r("Rolves","rolves",!0),new r("Roque","roque"),new r("Rosario","rosario"),new r("Roundaries","roundaries"),new r("Rowan","rowan",!0),new r("Salmonberry","salmonberry",!0),new r("San Barley","san"),new r("Saqanone","saqanone"),new r("Sants","sants"),new r("Sanur beach","sanur"),new r("Scriptonesia","scriptonesia",!0),new r("Secretary Typewriter","secretary",!0),new r("Sedalia","sedalia",!0),new r("Search","search",!0),new r("Searchlight","searchlight",!0),new r("See De Mayo","see"),new r("Serenity","serenity"),new r("The Servant","servant"),new r("Sheraton","sheraton",!0),new r("Shoelaces","shoelaces",!0),new r("Silvertone","silvertone",!0),new r("Smoother","smoother",!0),new r("Spring Break","springbreak",!0),new r("Spotlights Thin","spotlightsthin",!0),new r("Spotlights Chunky","spotlightschunky",!0),new r("Squiborn","squiborn",!0),new r("Staatliches","staatliches"),new r("Stardust Moonlight","stardust"),new r("The Stoothgart","stoothgart"),new r("Summer Coconut","summer"),new r("Summer Joy","summerjoy"),new r("Summer Nude","summernude",!0),new r("Summer Peach","summerpeach"),new r("Summer Solstice","summersolstice",!0),new r("Summery","summery"),new r("Sun Again","sunagain"),new r("Sun Pepper","sun"),new r("Sun Streets","sunstreets"),new r("Sunny Bay","sunnybay",!0),new r("Sunshine Boy","sunshine"),new r("Super Slayers","super"),new r("Surface","surface"),new r("Sweeneey","sweeneey"),new r("Teaspoon","teaspoon"),new r("Tabu","tabu"),new r("Teodore","teodore",!0),new r("TeXGyreHeros","texgyreheros"),new r("The Brocker","brocker"),new r("The California","thecalifornia"),new r("The Harison","harison"),new r("The Love For Money","theloveformoney",!0),new r("The Mastiff","mastiff"),new r("The Patriot","patriot"),new r("The Pinta","pinta"),new r("The Roxv","roxv"),new r("The Rogue","rogue"),new r("The Stegris","thestegris",!0),new r("The Queen","queen"),new r("Thirtylane","thirtylane",!0),new r("Titian","titian"),new r("Todes","todes",!0),new r("Tropical Coast","tropicalcoast"),new r("Torberta","torberta"),new r("Twigs","twigs"),new r("Twirly Ballerina","twirly",!0),new r("Unreal","unreal"),new r("Vaganza","vaganza"),new r("Valeria","valeria",!0),new r("Valery","valery"),new r("Vignette","vignette"),new r("Von Everect","von"),new r("The Voyager","voyager",!0),new r("Wandering Flowers","wandering",!0),new r("Wargate","wargate",!0),new r("Western Shooter","westernshooter",!0),new r("West Java","westjava",!0),new r("Winter Sunrise","wintersunrise",!0),new r("White Wonder","whitewonder",!0),new r("Yanone Kaffeesatz","kaffeesatz"),new r("Wonderul Wilderness","wonderulwilderness",!0),new r("Yoseline","yoseline"),new r("Zombie Dust","zombie")],h.loadFont=t=>{let e=h.fontList.find((e=>e.name===t));if(e)return h.addToDOM(e)};const l=h},6395:(t,e,s)=>{async function i(t,e){return new Promise(((s,i)=>{var a=new XMLHttpRequest,n=!1;a.responseType="arraybuffer",a.withCredentials=!1,a.open("GET",t,!0),a.onprogress=function(t){t.lengthComputable?e&&e(t.loaded/t.total*100):n||(n=!0,e&&e(-1))},a.onloadend=function(){a.status.toString().match(/^2/)?(n||e&&e(100),s(new Blob([this.response],{type:a.getResponseHeader("Content-Type")}))):i(a)},a.send()}))}function a(t){return new Promise(((e,s)=>{let i=new Image;i.onload=()=>e(i),i.onerror=t=>s(t),i.src=t}))}function n(t){return new Promise(((e,s)=>{const i=new FileReader;i.onerror=()=>s(i.error),i.onloadend=()=>e(i.result),i.readAsArrayBuffer(t)}))}function o(t){return new Promise((async(e,s)=>{const i=URL.createObjectURL(t);let a=new Image;a.crossOrigin="Anonymous",a.onload=()=>{URL.revokeObjectURL(i),a.width+a.height==0?s("Could not open file!"):e(a)},a.onerror=function(){URL.revokeObjectURL(i),s("Could not open file!")},a.name=t instanceof File?t.name:"",a.src=i}))}s.d(e,{CB:()=>n,Ep:()=>o,kw:()=>a,yP:()=>i})},93771:(t,e,s)=>{s.d(e,{Tq:()=>D,XN:()=>M,h6:()=>I});var i=s(42268),a=s(54738),n=(s(63306),s(6395)),o=s(7324),r=s(40963),h=s(75307),l=s(15818),c=s(41915),d=s(30821),u=s(27500),p=s(98244),g=s(29755),m=s(22866),v=s(79453),y=s(37699),f=s(54127),w=s(86445),x=s(58489),b=s(39989),A=s(13947),k=s(16309),S=s(89209),E=s(14983),C=s(27029),T=s(14871),L=s(82857);function M(t,e=!1){return new Promise(((s,a)=>{(0,i.Ay)("browse")&&(0,i.Ay)("browse").remove();let n=document.createElement("input");n.id="browse",n.type="file",n.multiple=t,n.className="offscreen",e&&(n.accept="image/*",n.capture="camera"),n.addEventListener("change",(()=>{n.files.length>0?s(n.files):s(void 0),document.body.removeChild(n)}),!1),document.body.appendChild(n),n.click()}))}async function P(t){await async function(t,e,s=3e4){let n=!1;for(let i=0;i<document.head.childNodes.length;i++){const e=document.head.childNodes[i];if(e.nodeType===Node.ELEMENT_NODE&&e.getAttribute("src")===t){n=!0;break}}n||document.head.appendChild((0,i.T)("script",{src:t}));let o=0;for(;!e();){if(o>=s)throw new Error(`Timeout triggered when loading script ${t}`);const e=500;o+=e,await a.uk(e)}}("/js/psd.js",(()=>window.require&&window.require("psd")));const e=window.require("psd"),s=await new Response(t).arrayBuffer(),n=new e(new Uint8Array(s));return n.parse(),n}async function D(t,e,i=!0,o="add"){var l,c;if(e){const w=null!==(l=e.type)&&void 0!==l?l:"";(0,p.A)("open-file",w);try{switch(w){case"image/psd":case"application/psd":case"application/photoshop":case"application/x-photoshop":case"image/vnd.adobe.photoshop":(0,p.A)("open-file","image/psd"),await _(t,e,o);break;case"image/tiff":await async function(t,e,i){const a=await async function(t){const e=(await s.e(4990).then(s.t.bind(s,48593,23))).default,i=await(0,n.CB)(t);return e.initialize({TOTAL_MEMORY:2*i.byteLength}),new e({buffer:i})}(e);let o=e.name.replace(/^.*[\\\/]/,"");t.addImage(a.toCanvas(),o,"add")}(t,e);break;case"application/zip":(0,p.A)("open-file","application/zip"),await z(t,e,void 0,o);break;default:const l=null===(c=e.name)||void 0===c?void 0:c.toLowerCase();if(l){if(l.endsWith(".psd"))return(0,p.A)("open-file","image/psd"),void(await _(t,e,o));if(l.endsWith(".pxd"))return(0,p.A)("open-file","image/pxd"),void(await async function(t,e,i){document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));const{PXD:o}=await Promise.all([s.e(6825),s.e(9262)]).then(s.bind(s,82355)),h=await(0,n.CB)(e),l=o.decode(new Uint8Array(h)),c=new L.A(a.Os(),e.name,l.width,l.height,void 0,void 0,void 0,i);try{t.supressRender=!0,t.addTab(c,"document");for(let e=0;e<l.layers;e++){const e=l.takeNextLayer(),s=e.width,i=e.height;switch(e.kind){case"bitmap":case"shape":{if(0===s||0===i){const s=new b.A(a.Os(),e.name,void 0,void 0,!1);s.settings.opacity=e.alpha,s.settings.blendmode=e.blendMode,s.settings.visible=e.visible,s.settings.locked=e.locked,t.fresco.layers.push(s),e.free();continue}const n=a.Nw(s,i),o=n.getContext("2d"),h=e.takeCanvas();o.putImageData(new ImageData(h,s,i),0,0);const l=new b.A(a.Os(),e.name,n,new r.A(e.x,e.y,s,i,e.rotation),e.locked);l.settings.opacity=e.alpha,l.settings.blendmode=e.blendMode,l.settings.visible=e.visible;const c=e.takeMask();if(c.length>0){const t=a.Nw(s,i);t.getContext("2d").putImageData(new ImageData(c,s,i),0,0),l.mask=t,l.render()}t.fresco.layers.push(l);break}case"text":{const n=JSON.parse(e.meta),o=new S.A(n.textSettings.font,n.textSettings.size);Object.assign(o,n.textSettings);const h=new f.A(a.Os(),n.text,new r.A(e.x,e.y,s,i,e.rotation),o);h.settings.opacity=e.alpha,h.settings.blendmode=e.blendMode,h.settings.visible=e.visible,await y.A.loadFont(o.font),o.measureText(),await h.prepare(),t.fresco.layers.push(h)}}e.free()}}finally{l.free(),t.supressRender=!1,document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}return await t.syncDocument(t.fresco),t.selectLayer(t.fresco.layers[0]),t.setZoom("fit"),document.dispatchEvent(new CustomEvent("layerlist-update")),Promise.reject()}(t,e,o));if(l.endsWith(".pxz"))return(0,p.A)("open-file","image/pxz"),void(await z(t,e,void 0,o));if(l.endsWith(".svg")&&"frame"!==o)return(0,p.A)("open-file","image/svg+xml"),void(await async function(t,e,s=!0,i="add"){let a=await e.text();t.addSVGShape(a,e.name,i)}(t,e,i,o));if(l.endsWith(".otf")||l.endsWith(".ttf")||l.endsWith(".woff")||l.endsWith(".woff2"))return(0,p.A)("open-file","font/"+e.name.split(".")[1]),void(await y.A.loadFontFromUpload(e))}await async function(t,e,s=!0,i){const o=await(0,n.Ep)(e);let l,c,p="editor"===g.Ay.product&&s||"editor"!==g.Ay.product?"create":"layer";if(("express"===g.Ay.product||"designer"===g.Ay.product||"drop"===i)&&(p=s&&t.fresco?await(new u.A).init():t.fresco?"layer":"create","close"===p))return;if(g.Ay.askToPreResize&&"create"===p&&(o.width>2500||o.height>2500)){if([l,c]=await new d.A(o,await h.A.rotation(e)).init(),void 0===l)return}else l=r.A.bestFit(o.width,o.height,"premium"===(null===v.N||void 0===v.N?void 0:v.N.subscriptionAccess)?8196:4096,"premium"===(null===v.N||void 0===v.N?void 0:v.N.subscriptionAccess)?8196:4096).size(),c=0;let m=a.k8(o,l.width>l.height?l.width:l.height,c),y=e.name?e.name:o.src.replace(/^.*[\\\/]/,"");"create"===p&&t.addTab(new L.A(a.Os(),y,m.width,m.height,void 0,void 0,void 0,i),"image");t.addImage(m,y,i)}(t,e,i,o)}}catch(m){throw document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),m}}else document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}async function z(t,e,i,n){const{ZipReader:o}=await Promise.all([s.e(6825),s.e(9262)]).then(s.bind(s,82355));let r;try{t.supressRender=!0;let s=await e.arrayBuffer();r=new o(new Uint8Array(s));let l=r.readString("manifest.json"),d=JSON.parse(l);const u=new L.A(a.Os(),d.name,d.width,d.height,d.background,d.animation,i,n);t.addTab(u,"template"),document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));try{let e=r.readFile("thumbnail.webp"),s=await a.lz(new Blob([e.buffer]));t.renderPreview(s)}catch(h){console.log(h)}let p=await F(d,new c.A,r);t.fresco.layers.push(...p),await t.syncDocument(t.fresco)}catch(l){return console.log(l),void alert("Error while loading PXZ file :(")}finally{null==r||r.free(),t.supressRender=!1,document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}t.selectLayer(t.fresco.layers[0]),t.setZoom("fit"),document.dispatchEvent(new CustomEvent("layerlist-update"))}async function I(t,e){let s;document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));let i=new c.A;try{const a=await fetch(e),n=await a.json();i.x=Math.round((t.fresco.width-n.width)/2),i.y=Math.round((t.fresco.height-n.height)/2),s=await F(n,i)}catch(o){console.log(o),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}if(!s||0===s.length)return;const n=a.r0();s.forEach((t=>t.settings.link=n)),t.addLayer(s),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layerlist-update"))}async function F(t,e=new c.A,s,i){var h;let d=new Array;if(t.stack)for(let c=0;c<t.stack.length;c++){let u=t.stack[c];switch(u.type){case m.A.TYPE_IMAGE:case m.A.TYPE_ELEMENT:{let t,o=u.rect?new r.A(u.rect.x+e.x,u.rect.y+e.y,u.rect.w,u.rect.h,u.rect.r):void 0;if(void 0!==u.content)if(s){let e=s.readFile(u.content);e&&(t=await a.lz(new Blob([e.buffer])))}else{let e=await(0,n.yP)(i+u.content);e&&(t=await a.lz(e))}let h=new b.A(a.Os(),u.name,t,o,u.locked);if(void 0!==u.opacity&&(h.settings.opacity=u.opacity),void 0!==u.blendmode&&(h.settings.blendmode=u.blendmode),void 0!==u.locked&&(h.settings.locked=u.locked),void 0!==u.visible&&(h.settings.visible=u.visible),void 0!==u.animation&&(h.animation=u.animation),void 0!==u.macro&&(h.macro=u.macro),void 0!==u.mask&&s){let t=s.readFile(u.mask);t&&(h.mask=await a.lz(new Blob([t.buffer]))),h.render()}d.push(h);break}case m.A.TYPE_TEXT:{if(!u.format)continue;let t=new S.A(null===(h=u.format.font)||void 0===h?void 0:h.name,u.format.size);void 0!==u.format.align&&(t.align=u.format.align),void 0!==u.format.bold&&(t.bold=u.format.bold),void 0!==u.format.italic&&(t.italic=u.format.italic),void 0!==u.format.underline&&(t.underline=u.format.underline),void 0!==u.format.uppercase&&(t.uppercase=u.format.uppercase),void 0!==u.format.linespace&&(t.lineSpace=u.format.linespace),void 0!==u.format.letterspace&&(t.letterSpace=u.format.letterspace);let c=new f.A(a.Os(),u.content,new r.A(u.rect.x+e.x,u.rect.y+e.y,u.rect.w,u.rect.h,u.rect.r),t);if(void 0!==u.opacity&&(c.settings.opacity=u.opacity),void 0!==u.blendmode&&(c.settings.blendmode=u.blendmode),void 0!==u.locked&&(c.settings.locked=u.locked),void 0!==u.visible&&(c.settings.visible=u.visible),void 0!==u.animation&&(c.animation=u.animation),void 0!==u.macro&&(c.macro=u.macro),t.font){let e=y.A.getFontDesc(t.font);if(!e&&u.format.font.content){let t;t=s?new Blob([s.readFile(u.format.font.content)]):await(0,n.yP)(i+u.format.font.content),t&&(e=await y.A.loadFontFromTemplate(t,u.format.font.name,u.format.font.content))}else e&&await y.A.addToDOM(e);t.measureText()}if(u.style&&(u.style.curve&&(c.textSettings.curve=!0,void 0!==u.style.curve.type&&(c.textSettings.curveType=u.style.curve.type),void 0!==u.style.curve.amount&&(c.textSettings.curveAmount=u.style.curve.amount),void 0!==u.style.curve.spread&&(c.textSettings.curveSpread=u.style.curve.spread),void 0!==u.style.curve.flip&&(c.textSettings.curveFlip=u.style.curve.flip)),u.style.warp&&(c.textSettings.warp=!0,void 0!==u.style.warp.type&&(c.textSettings.warpType=u.style.warp.type),void 0!==u.style.warp.mode&&(c.textSettings.warpMode=u.style.warp.mode),void 0!==u.style.warp.edgesize&&(c.textSettings.warpEdgeSize=u.style.warp.edgesize),void 0!==u.style.warp.centersize&&(c.textSettings.warpCenterSize=u.style.warp.centersize),void 0!==u.style.warp.verticaloffset&&(c.textSettings.warpVerticalOffset=u.style.warp.verticaloffset),void 0!==u.style.warp.horizontaloffset&&(c.textSettings.warpHorizontalOffset=u.style.warp.horizontaloffset)),u.style.background&&(c.textSettings.background=!0,void 0!==u.style.background.color&&(c.textSettings.backgroundColor=u.style.background.color),void 0!==u.style.background.type&&(c.textSettings.backgroundType=u.style.background.type),void 0!==u.style.background.punch&&(c.textSettings.backgroundPunch=u.style.background.punch),void 0!==u.style.background.offset&&(c.textSettings.backgroundOffset=u.style.background.offset)),u.style.outline&&(c.textSettings.outline=!0,void 0!==u.style.outline.size&&(c.textSettings.outlineSize=u.style.outline.size),void 0!==u.style.outline.color&&(c.textSettings.outlineColor=u.style.outline.color),void 0!==u.style.outline.punch&&(c.textSettings.outlinePunch=u.style.outline.punch),void 0!==u.style.outline.distance&&(c.textSettings.outlineDistance=u.style.outline.distance),void 0!==u.style.outline.direction&&(c.textSettings.outlineDirection=u.style.outline.direction)),u.style.shadow&&(c.textSettings.shadow=!0,void 0!==u.style.shadow.blur&&(c.textSettings.shadowBlur=u.style.shadow.blur),void 0!==u.style.shadow.color&&(c.textSettings.shadowColor=u.style.shadow.color),void 0!==u.style.shadow.opacity&&(c.textSettings.shadowAlpha=u.style.shadow.opacity),void 0!==u.style.shadow.distance&&(c.textSettings.shadowDistance=u.style.shadow.distance),void 0!==u.style.shadow.direction&&(c.textSettings.shadowDirection=u.style.shadow.direction))),void 0!==u.format.fill){let t;switch(u.format.fill.type){case"color":t=new o.A(l.A.fromHEX(u.format.fill.value));break;case"gradient":t=new o.A(k.Ay.fromIGradient(u.format.fill.value));break;case"pattern":let e=u.format.fill.value;if(s)e.svg=s.readString(e.svg);else{let t=await(0,n.yP)(i+e.svg);t&&(e.svg=await t.text())}t=new o.A(await T.A.fromIPattern(e))}c.textSettings.fillType=t.getType(),c.textSettings.fillValue=t.getStringValue(),c.fill=t}await c.prepare(),c.settings.name=u.name,d.push(c);break}case m.A.TYPE_SHAPE:{let t=new E.A;if(t.variant=u.format?u.format.variant:"svg","svg"===t.variant){let e;if(u.content)if(s)e=s.readString(u.content);else{let t=await(0,n.yP)(i+u.content);t&&(e=await t.text())}if(!e)continue;t.content=e}"path"===t.variant&&(t.content=u.content),u.style&&(u.style.outline&&(void 0!==u.style.outline.size&&(t.outlineSize=u.style.outline.size),void 0!==u.style.outline.color&&(t.outlineColor=u.style.outline.color)),u.style.shadow&&(t.shadow=!0,void 0!==u.style.shadow.blur&&(t.shadowBlur=u.style.shadow.blur),void 0!==u.style.shadow.color&&(t.shadowColor=u.style.shadow.color),void 0!==u.style.shadow.opacity&&(t.shadowOpacity=u.style.shadow.opacity),void 0!==u.style.shadow.distance&&(t.shadowDistance=u.style.shadow.distance),void 0!==u.style.shadow.direction&&(t.shadowDirection=u.style.shadow.direction)));let h=new w.A(a.Os(),u.name,new r.A(u.rect.x+e.x,u.rect.y+e.y,u.rect.w,u.rect.h,u.rect.r),t);if(void 0!==u.opacity&&(h.settings.opacity=u.opacity),void 0!==u.blendmode&&(h.settings.blendmode=u.blendmode),void 0!==u.locked&&(h.settings.locked=u.locked),void 0!==u.visible&&(h.settings.visible=u.visible),void 0!==u.animation&&(h.animation=u.animation),void 0!==u.macro&&(h.macro=u.macro),void 0!==u.format){if(void 0!==u.format.fill){let t;switch(u.format.fill.type){case"color":t=new o.A(l.A.fromHEX(u.format.fill.value));break;case"gradient":t=new o.A(k.Ay.fromIGradient(u.format.fill.value));break;case"pattern":let e=u.format.fill.value;if(s)e.svg=s.readString(e.svg);else{let t=await(0,n.yP)(i+e.svg);t&&(e.svg=await t.text())}t=new o.A(await T.A.fromIPattern(e))}h.shapeSettings.fillType=t.getType(),h.shapeSettings.fillValue=t.getStringValue(),h.fill=t}u.format.radii&&(h.shapeSettings.radii=u.format.radii)}await h.prepare(),d.push(h);break}case m.A.TYPE_FRAME:{let t=new x.A(a.Os(),u.name,new r.A(u.rect.x+e.x,u.rect.y+e.y,u.rect.w,u.rect.h,u.rect.r));if(void 0!==u.opacity&&(t.settings.opacity=u.opacity),void 0!==u.blendmode&&(t.settings.blendmode=u.blendmode),void 0!==u.locked&&(t.settings.locked=u.locked),void 0!==u.visible&&(t.settings.visible=u.visible),void 0!==u.animation&&(t.animation=u.animation),void 0!==u.macro&&(t.macro=u.macro),u.frame&&(void 0!==u.frame.trim&&(t.trim=new r.A(u.frame.trim.x,u.frame.trim.y,u.frame.trim.w,u.frame.trim.h)),void 0!==u.frame.clip&&(t.frameSettings.clip=u.frame.clip)),u.content)if(s){let e=s.readFile(u.content);e&&(t.canvas=await a.lz(new Blob([e.buffer])))}else{let e=await(0,n.yP)(i+u.content);e&&(t.canvas=await a.lz(e))}u.style&&(u.style.outline&&(t.frameSettings.outline=!0,void 0!==u.style.outline.size&&(t.frameSettings.outlineSize=u.style.outline.size),void 0!==u.style.outline.color&&(t.frameSettings.outlineColor=u.style.outline.color)),u.style.shadow&&(t.frameSettings.shadow=!0,void 0!==u.style.shadow.blur&&(t.frameSettings.shadowBlur=u.style.shadow.blur),void 0!==u.style.shadow.color&&(t.frameSettings.shadowColor=u.style.shadow.color),void 0!==u.style.shadow.opacity&&(t.frameSettings.shadowOpacity=u.style.shadow.opacity),void 0!==u.style.shadow.distance&&(t.frameSettings.shadowDistance=u.style.shadow.distance),void 0!==u.style.shadow.direction&&(t.frameSettings.shadowDirection=u.style.shadow.direction))),t.prepare(),d.push(t);break}case m.A.TYPE_GROUP:{let t=new A.A(a.Os(),u.name,new C.A);void 0!==u.meta&&(void 0!==u.meta.color&&(t.groupSettings.color=u.meta.color),void 0!==u.meta.collapsed&&(t.groupSettings.collapsed=u.meta.collapsed),void 0!==u.meta.members&&(t.groupSettings.numberOfMembers=u.meta.members)),void 0!==u.opacity&&(t.settings.opacity=u.opacity),void 0!==u.locked&&(t.settings.locked=u.locked),void 0!==u.visible&&(t.settings.visible=u.visible),void 0!==u.animation&&(t.animation=u.animation),void 0!==u.macro&&(t.macro=u.macro);break}}}return d}async function _(t,e,s){document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));const i=await P(e),n=i.tree(),o=new L.A(a.Os(),e.name,i.header.cols,i.header.rows,void 0,void 0,void 0,s);try{t.supressRender=!0,t.addTab(o,"document");let e=n.descendants();for(let s=e.length-1;s>=0;s--){const i=e[s];if(!i.isGroup())try{const n=new r.A(i.layer.left,i.layer.top,i.layer.width,i.layer.height),o=i.get("typeTool");let h;if(o){const t=o.export();let e=t.font.sizes?t.font.sizes[0]:12;const s=t.font.name.trim(),i=new S.A(s.substr(0,s.length-1),e);h=new f.A(a.Os(),t.value.trim(),n.clone(),i),h.textSettings.fillType="color",h.textSettings.fillValue=new l.A(t.font.colors[0][0],t.font.colors[0][1],t.font.colors[0][2],t.font.colors[0][3]).toHEX(),h.prepare()}else{const t=await new Promise(((t,e)=>{const s=i.toPng();s.onload=()=>t(s),s.onerror=t=>e(t)}));let o=a.k8(t,4096);h=new b.A(a.Os(),i.layer.name,o,n,s==e.length-1)}const c={norm:"source-over",dark:"darken",lite:"lighten",hue:"hue",sat:"saturation",colr:"color",lum:"luminosity",mul:"multiply",scrn:"screen",diss:"source-over",over:"overlay",hLit:"hard-light",sLit:"soft-light",diff:"difference",smud:"exclusion",div:"color-doge",idiv:"color-burn",lbrn:"source-over",lddg:"source-over",vLit:"source-over",lLit:"source-over",pLit:"source-over",hMix:"source-over",pass:"source-over",dkCl:"source-over",lgCl:"source-over",fsub:"source-over",fdiv:"source-over"};h.settings.blendmode=c[i.layer.blendMode.blendKey]||"source-over",h.settings.visible=i.layer.visible,h.settings.opacity=i.layer.opacity/255,t.fresco.layers.push(h)}catch(h){console.log("pxd layer read",h)}}t.selectLayer(t.fresco.layers[0]),await t.syncDocument(t.fresco)}catch(h){throw t.close(o.id),h}finally{t.supressRender=!1,document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}t.setZoom("fit"),document.dispatchEvent(new CustomEvent("layerlist-update"))}},66718:(t,e,s)=>{s.d(e,{Ab:()=>f,D0:()=>m,EB:()=>x,IF:()=>v,gr:()=>y,zu:()=>g});var i=s(42268),a=s(54738),n=s(16309),o=s(98244),r=s(15818),h=s(22866),l=s(14871),c=s(56709),d=s(10122),u=s(37699),p=s(56479);function g(){return void 0!==window.showSaveFilePicker}async function m(t,e,s,i="image/png"){try{return await window.showSaveFilePicker({suggestedName:t+"."+e,types:[{description:s,accept:{[i]:["."+e]}}]})}catch(a){return console.log(a,a.name),"AbortError"!==a.name&&void 0}}async function v(t,e){try{const s=await t.createWritable();await s.write(e),await s.close()}catch(s){return console.log(s),!1}return!0}function y(t,e,s){let a=(0,i.T)("a",{id:"download-link"});window.document.body.append(a),a.download=e+"."+s,a.href=URL.createObjectURL(t),void 0===a.download?window.location=a.href:a.click(),a.remove()}async function f(t,e,i=t.fresco){const{ZipWriter:g}=await Promise.all([s.e(6825),s.e(9262)]).then(s.bind(s,82355)),m="pixel"!==e.unit,v=i.color&&"component"!==e.type?i.color:void 0;let y=(t,e)=>0==e?t:y(e,t%e),f=t=>m?t/i.width:t,x=t=>m?t/i.height:t;const b=y(i.width,i.height),A=m?i.width/b:i.width,k=m?i.height/b:i.height;let S={id:e.id,name:e.name,type:e.type,unit:e.unit,width:A,height:k,background:v,stack:new Array};i.animation&&(S.animation=i.animation);const E=new Array,C=new Array,T=t.getOutputCanvas(i);if("template"===e.type&&t.fresco===i){const e=a.tm(T,Math.round(i.width*(640/i.height)),640),n=await a.PG(e,{type:"image/webp",quality:.9});if(E.push(new File([n],"preview.webp")),t.fresco.hasAnimation()){const e=300/k,i=await function(t,e,i,n,r){return function(t){let e;try{return e=new window.VideoEncoder({output:()=>{},error:()=>{}}),e.configure({width:16,height:16,codec:t,hardwareAcceleration:"prefer-software",framerate:30,bitrate:4e6}),!0}catch(s){return!1}finally{null==e||e.close()}}("avc1.420034")?((0,o.A)("video-encode","fast"),function(t,e,i,n,o){let r,h;const l=new a.m$((()=>new Promise((async(a,l)=>{try{const{Mp4:d}=await Promise.all([s.e(6825),s.e(2355)]).then(s.bind(s,82355)),u=1e6;h=new d(u);const p=Math.round(u/e),g=new c.A(t,e,i,!1,n);let m=0,v=!1,y=null;r=new VideoEncoder({output:(t,e)=>{if(v)return void console.error("Unexpected frames to process");if(null===y&&"key"===t.type){const t=new Uint8Array(e.decoderConfig.description);y=h.addVideoTrack(e.decoderConfig.codedWidth,e.decoderConfig.codedHeight,t)}const s=new Uint8Array(t.byteLength);t.copyTo(s),h.addFrame(y,p*m,p,0,"key"===t.type,s),m+=1,o&&o(m/g.totalFrames),m===g.totalFrames&&(v=!0,a(new Blob([h.fetchFile()],{type:"video/mp4"})))},error:t=>{console.error(t),l(t)}});let f=await g.requestFrame();const x=w(f.width,f.height,e);for(r.configure({width:f.width,height:f.height,codec:"avc1.420034",hardwareAcceleration:"prefer-software",framerate:e,bitrate:x});f;){const t=new VideoFrame(f,{timestamp:p*(g.currentFrame-1),duration:p});r.encode(t),t.close(),f=await g.requestFrame()}await r.flush()}catch(d){console.error(d)}finally{try{null==r||r.close()}catch(u){}}}))),(()=>{try{null==r||r.close(),null==h||h.free()}catch(t){}}));return l}(t,e,i,n,r)):((0,o.A)("video-encode","slow"),function(t,e,s,i,n){const o=new p.Ug,r=new a.m$((async()=>{try{const h=new c.A(t,e,s,!1,i);let l,d,u=await h.requestFrame();for(;u;){const t=await a.PG(u,{type:"image/jpeg",quality:.92}),e=await new Promise(((e,s)=>{const i=new FileReader;i.onload=()=>e(new Uint8Array(i.result)),i.readAsArrayBuffer(t)}));if(r.isCanceled())throw new a.p3;o.send({type:"addFile",name:`${h.currentFrame}.jpeg`,data:e},[e.buffer]),l=u.width,d=u.height,n&&n(h.currentFrame/h.totalFrames/2),u=await h.requestFrame()}const p=w(l,d,e);for(o.send({type:"run",arguments:["-r",e.toFixed(0),"-f","image2","-s",`${l}x${d}`,"-i","%d.jpeg","-start_number","1","-vframes",h.totalFrames.toFixed(0),"-vcodec","libx264","-crf","23","-vb",p.toFixed(0),"-pix_fmt","yuv420p","-preset","ultrafast","out.mp4"]});;){const t=await o.receive();switch(t.type){case"progress":n&&n(t.frame/h.totalFrames/2+.5);break;case"result":return new Blob([t.data],{type:"video/mp4"})}}}finally{null==o||o.terminate()}}),(()=>{null==o||o.terminate()}));return r}(t,e,i,n,r))}(t,24,e,!0);E.push(new File([i],"preview.mp4"))}}const L="component"===e.type?480:350,M=a.tm(T,Math.round(i.width*(L/i.height)),L),P=await a.PG(M,{type:"image/webp",quality:.7});E.push(new File([P],"thumbnail.webp"));for(let s=0;s<i.layers.length;s++){let t=i.layers[s];if("document"!==e.type&&!t.settings.visible||!t.rect)continue;if("template"===e.type&&"group"===t.type)continue;const o=a.r0();let c={name:t.settings.name,type:t.type,rect:t.rect?{x:f(t.rect.x),y:x(t.rect.y),w:f(t.rect.width),h:x(t.rect.height),r:Number(t.rect.rotation.toFixed(2))}:void 0,blendmode:""!==t.settings.blendmode?t.settings.blendmode:void 0,opacity:Math.round(100*t.settings.opacity)/100,locked:t.settings.locked,visible:t.settings.visible,link:t.settings.link};switch(t.animation&&(c.animation=t.animation),t.macro&&(c.macro=t.macro),t.type){case h.A.TYPE_ELEMENT:case h.A.TYPE_IMAGE:c.type=h.A.TYPE_IMAGE;let s=t.canvas;if(t instanceof d.A&&t.rect&&s&&(t.rect.width===s.width&&t.rect.height===s.height||(s=a.tm(s,t.rect.width,t.rect.height))),t.mask){let e=a.r0();const s=await a.PG(t.mask,{type:"image/web",quality:.8});E.push(new File([s],e+".webp")),c.mask=e+".webp"}if(s){const t=await a.PG(s,{type:e.nonDestructive?"image/png":"image/webp",quality:e.quality});E.push(new File([t],o+(e.nonDestructive?".png":".webp"))),c.content=o+(e.nonDestructive?".png":".webp")}break;case h.A.TYPE_TEXT:let i=t,p=u.A.getFontDesc(i.textSettings.font);if(p&&!C.find((t=>t.name===p.name))&&C.push(p),c.content=i.text,c.format={size:x(i.textSettings.size),align:i.textSettings.align,bold:i.textSettings.bold,italic:i.textSettings.italic,underline:i.textSettings.underline,uppercase:i.textSettings.uppercase,linespace:i.textSettings.lineSpace,letterspace:i.textSettings.letterSpace,font:{name:i.textSettings.font,content:p?p.short+"."+p.type:""}},i.fill&&i.fill.value&&(c.format.fill={type:i.fill.getType()},i.fill.value instanceof r.A&&(c.format.fill.value=i.fill.value.toHEX()),i.fill.value instanceof n.Ay&&(c.format.fill.value=i.fill.value.toIGradient()),i.fill.value instanceof l.A)){let t=a.r0();E.push(new File([new Blob([i.fill.value.svg],{type:"image/svg+xml;charset=utf-8"})],t+".svg")),c.format.fill.value=i.fill.value.toIPattern(t+".svg")}(i.textSettings.curve||i.textSettings.warp||i.textSettings.background||i.textSettings.outline||i.textSettings.shadow)&&(c.style={},i.textSettings.warp&&(c.style.warp={type:i.textSettings.warpType,mode:i.textSettings.warpMode,edgesize:i.textSettings.warpEdgeSize,centersize:i.textSettings.warpCenterSize,verticaloffset:i.textSettings.warpVerticalOffset,horizontaloffset:i.textSettings.warpHorizontalOffset}),i.textSettings.curve&&(c.style.curve={type:i.textSettings.curveType,amount:i.textSettings.curveAmount,spread:i.textSettings.curveSpread,flip:i.textSettings.curveFlip}),i.textSettings.background&&(c.style.background={type:i.textSettings.backgroundType,color:i.textSettings.backgroundColor,punch:i.textSettings.backgroundPunch,offset:i.textSettings.backgroundOffset}),i.textSettings.outline&&(c.style.outline={size:i.textSettings.outlineSize,color:i.textSettings.outlineColor,punch:i.textSettings.outlinePunch,distance:i.textSettings.outlineDistance,direction:i.textSettings.outlineDirection}),i.textSettings.shadow&&(c.style.shadow={blur:i.textSettings.shadowBlur,color:i.textSettings.shadowColor,opacity:i.textSettings.shadowAlpha,distance:i.textSettings.shadowDistance,direction:i.textSettings.shadowDirection}));break;case h.A.TYPE_SHAPE:let g=t;if("svg"===g.shapeSettings.variant)g.shapeSettings.content&&(E.push(new File([new Blob([g.shapeSettings.content],{type:"image/svg+xml;charset=utf-8"})],o+".svg")),c.content=o+".svg"),c.format={variant:g.shapeSettings.variant};else if(c.content=g.shapeSettings.content,c.format={variant:g.shapeSettings.variant},0!==g.shapeSettings.radii&&(c.format.radii=g.shapeSettings.radii),g.fill&&g.fill.value&&(c.format.fill={type:g.fill.getType()},g.fill.value instanceof r.A&&(c.format.fill.value=g.fill.value.toHEX()),g.fill.value instanceof n.Ay&&(c.format.fill.value=g.fill.value.toIGradient()),g.fill.value instanceof l.A)){let t=a.r0();E.push(new File([new Blob([g.fill.value.svg],{type:"image/svg+xml;charset=utf-8"})],t+".svg")),c.format.fill.value=g.fill.value.toIPattern(t+".svg")}(g.shapeSettings.shadow||g.shapeSettings.outlineSize>0)&&(c.style={},g.shapeSettings.outlineSize>0&&(c.style.outline={size:g.shapeSettings.outlineSize,color:g.shapeSettings.outlineColor}),g.shapeSettings.shadow&&(c.style.shadow={blur:g.shapeSettings.shadowBlur,color:g.shapeSettings.shadowColor,opacity:g.shapeSettings.shadowOpacity,distance:g.shapeSettings.shadowDistance,direction:g.shapeSettings.shadowDirection}));break;case h.A.TYPE_FRAME:let m=t;if(m.canvas){!m.trim||m.trim.width===m.canvas.width&&m.trim.height===m.canvas.height||(m.canvas=a.tm(m.canvas,m.trim.width,m.trim.height));const t=await a.PG(m.canvas,{type:"image/web",quality:e.quality});E.push(new File([t],o+".webp")),c.content=o+".webp"}c.frame={trim:m.trim?{x:f(m.trim.x),y:x(m.trim.y),w:f(m.trim.width),h:x(m.trim.height),r:0}:void 0,clip:m.frameSettings.clip},(m.frameSettings.outline||m.frameSettings.shadow)&&(c.style={},m.frameSettings.outline&&(c.style.outline={size:m.frameSettings.outlineSize,color:m.frameSettings.outlineColor}),m.frameSettings.shadow&&(c.style.shadow={blur:m.frameSettings.shadowBlur,color:m.frameSettings.shadowColor,opacity:m.frameSettings.shadowOpacity,distance:m.frameSettings.shadowDistance,direction:m.frameSettings.shadowDirection}));break;case h.A.TYPE_GROUP:let v=t;c.meta={members:v.groupSettings.numberOfMembers,collapsed:v.groupSettings.collapsed,color:v.groupSettings.color}}S.stack.push(c)}let D=new g;D.writeString("manifest.json",JSON.stringify(S),!0);for(let s=0;s<E.length;s++){const t=E[s];let e=await t.arrayBuffer(),i=new Uint8Array(e);D.writeFile(t.name,i,t.name.endsWith(".svg"))}for(let s=0;s<C.length;s++){const t=C[s];let e=await u.A.getFontFile(t.name);if(e){let s=await e.arrayBuffer(),i=new Uint8Array(s);D.writeFile(t.short+"."+t.type,i,!0)}}const z=D.finish();return new Blob([z.buffer])}function w(t,e,s,i=.18){return Math.round(t*e*s*i)}async function x(t,e,i){const a=await s.e(885).then(s.bind(s,64772)),n=await a.PDFDocument.create(),o=n.addPage([t,e]),r=await n.embedJpg(await i.arrayBuffer());return o.drawImage(r,{x:0,y:0,width:t,height:e}),new Blob([await n.save()])}},57653:(t,e,s)=>{s.d(e,{A:()=>i});class i{constructor(t,e,s){this.framebuffer=t,this.renderbuffer=e,this.texture=s}destroy(t){t.deleteFramebuffer(this.framebuffer),t.deleteRenderbuffer(this.renderbuffer),t.deleteTexture(this.texture)}}},81718:(t,e,s)=>{s.d(e,{A:()=>a});var i=s(1177);class a{constructor(t,e,s){this.uniform={},this.attribute={},this.texture=new Map,this.program=t.createProgram(),t.attachShader(this.program,this.compile(t,e,t.VERTEX_SHADER)),t.attachShader(this.program,this.compile(t,s,t.FRAGMENT_SHADER)),t.linkProgram(this.program),t.useProgram(this.program),t.getProgramParameter(this.program,t.LINK_STATUS)||console.log(t.getProgramInfoLog(this.program));const a=this.collect(e,"attribute");for(const[i,l]of a)this.attribute[i]=t.getAttribLocation(this.program,i);let n=[];const o=this.collect(e,"uniform");for(const[i,l]of o)this.uniform[i]=t.getUniformLocation(this.program,i);const r=this.collect(s,"uniform");for(const[i,l]of r)this.uniform[i]=t.getUniformLocation(this.program,i),"sampler2D"===l&&n.push(i);for(var h in n){let e=n[h],s=t.getUniformLocation(this.program,e);"texture"===e?(t.uniform1i(s,0),this.texture.set(0,new i.A(e))):(t.uniform1i(s,1),this.texture.set(1,new i.A(e)))}}collect(t,e){const s=[],i=new RegExp("\\b"+e+" (\\w+) (\\w+)","ig");return t.replace(i,(function(t,e,i){return s.push([i,e]),t})),s}compile(t,e,s){var i=t.createShader(s);return t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(console.log(t.getShaderInfoLog(i)),console.log(e),null)}getTextureById(t){let e=null;return this.texture.forEach((function(s){s.id!==t||(e=s)})),e||(console.error("Having no texture that is named `%s`.",t),null)}destroy(t){t.deleteProgram(this.program),this.texture.forEach((function(e){e.destroy(t)})),this.texture.clear()}}},23556:(t,e,s)=>{s.d(e,{A:()=>m});var i=s(41915),a=s(15818),n=s(1177),o=s(81718),r=s(98244),h=s(52549),l=s(57653),c=s(59303),d=s(44448),u=s(94711),p=s(75281),g=s(54738);class m{constructor(t){this.drawShader=0,this.sourceTexture=null,this.vertexBuffer=null,this.debug=!1,this.lastInChain=!1,this.currentFramebufferIndex=0,this.tempFramebuffers={},this.width=-1,this.height=-1,this.lastTextureSlot=-1,this.handleContextLost=()=>{null==this.canvas&&(this.canvas=(0,g.Nw)(100,100)),this.initContext()},this.getError=()=>{this.debug&&this.ctx.getError()},this.addShader=(t,e,s=!1)=>{if("fill"==t&&0==e.amount||"toning"==t&&0==e.amount||"levels"==t&&e.isFlat()||null==e||0===e)this.removeShader(t,s);else{for(var i=0;i<this.chain.length;i++)if(this.chain[i].type===t&&this.chain[i].sidekick===s)return void(this.chain[i].value=e);this.chain.push(new v(t,e,s))}},this.getShaderValue=t=>{for(var e=0;e<this.chain.length;e++)if(this.chain[e].type==t)return this.chain[e].value},this.addPreset=(t,e=1)=>{const s=d.A.named(t);s&&(1!==e?s.forEach((t=>{switch(t.name){case"curves":{const s=t.value,i=p.X.createCurveSet(s);i.percent=e,this.addShader(t.name,i);break}case"levels":{const s=t.value,i=new u.A(Math.round(s.minin*e),Math.round(255-(255-s.maxin)*e));this.addShader(t.name,i);break}case"toning":{const s=t.value,i=new c.A(s.highlight,s.midtone,s.shadow,s.amount*e);this.addShader(t.name,i);break}case"fill":{const s=t.value,i=new h.A(s.color,s.blend,s.amount*e);this.addShader(t.name,i);break}default:this.addShader(t.name,t.value*e)}})):s.forEach((t=>this.addShader(t.name,t.value))))},this.removeShaderSidekick=()=>{let t=new Array;for(var e=0;e<this.chain.length;e++)this.chain[e].sidekick||t.push(this.chain[e]);this.chain=t},this.removeShader=(t,e=!1)=>{for(var s=0;s<this.chain.length;s++)if(this.chain[s].type===t&&this.chain[s].sidekick===e)return void this.chain.splice(s,1)},this.runShader=(t,e)=>{switch(t){case"vibrance":return this.vibrance(e);case"brightness":return this.brightness(e);case"temperature":return this.temperature(e);case"balance":return this.balance(e);case"tint":return this.tint(e);case"colorize":return this.colorize(e);case"grain":return this.grain(e);case"noise":return this.noise(e);case"vignette":return this.vignette(e);case"sharpen":return this.sharpen(e);case"blur":return this.blur(e);case"zoom":return this.zoom(e);case"bokeh":return this.bokeh(e);case"gaussian":return this.gaussian(e);case"motion":return this.motion(e);case"radial":return this.radial(e);case"smooth":return this.smooth(e);case"denoise":return this.denoise(e);case"contrast":return this.contrast(e);case"monochrome":return this.monochrome(e);case"desaturate":return this.desaturate();case"invert":return this.invert();case"exposure":return this.exposure(e);case"highlights":return this.highlights(e);case"shadows":return this.shadows(e);case"dehaze":return this.dehaze(e);case"curves":return this.curves(e);case"toning":return this.toning(e);case"lookup":return this.lookup(e);case"fill":return this.fill(e);case"bwpoint":return this.bwpoint(e);case"levels":return this.levels(e);case"multilevels":return this.multilevels(e);case"threshold":return this.threshold(e);case"alphaThreshold":return this.alphaThreshold(e);case"bloom":return this.bloom(e);case"glamour":return this.glamour(e);case"mimichdr":return this.mimicHDR(e);case"posterize":return this.posterize(e);case"fringe":return this.fringe(e);case"pixelate":return this.pixelate(e);case"clarity":return this.clarity(e);case"mosaic":return this.mosaic(e);case"polarcoordinates":return this.polarcoordinates(e);case"kaleidoscope":return this.kaleidoscope(e);case"reflect":return this.reflect(e);case"wave":return this.wave(e);case"fisheye":return this.fisheye(e);case"scanlines":return this.scanlines(e);case"dealiasing":return this.dealiasing();case"alpha-reset":return this.alphaReset();case"alpha-invert":return this.alphaInvert();case"alpha-mask":return this.alphaMask();case"alpha-shift-mask":return this.alphaShiftMask();case"outer-glow":return this.outerGlow(e);case"inner-glow":return this.innerGlow(e);case"sobel":return this.sobel();case"solarize":return this.solarize();case"halftone":return this.halftone(e);case"stroke":return this.stroke(e);case"bevel":return this.bevel(e);case"border":return this.border(e);case"rgb-split":return this.rgbSplit(e);case"slice":return this.slice(e);case"bleed":return this.bleed(e);case"interference":return this.interference(e);case"hue":return this.hue(e);case"hue-red":return this.hue(e,317,46);case"hue-yellow":return this.hue(e,17,106);case"hue-green":return this.hue(e,77,166);case"hue-cyan":return this.hue(e,137,226);case"hue-blue":return this.hue(e,197,286);case"hue-magenta":return this.hue(e,257,346);case"saturation":return this.saturation(e);case"saturation-red":return this.saturation(e,317,46);case"saturation-yellow":return this.saturation(e,17,106);case"saturation-green":return this.saturation(e,77,166);case"saturation-cyan":return this.saturation(e,137,226);case"saturation-blue":return this.saturation(e,197,286);case"saturation-magenta":return this.saturation(e,257,346);case"lightness":return this.lightness(e);case"lightness-red":return this.lightness(e,317,46);case"lightness-yellow":return this.lightness(e,17,106);case"lightness-green":return this.lightness(e,77,166);case"lightness-cyan":return this.lightness(e,137,226);case"lightness-blue":return this.lightness(e,197,286);case"lightness-magenta":return this.lightness(e,257,346);case"melt":return this.melt(e);case"gooey":return this.gooey(e);case"block":return this.block(e);case"curtain":return this.curtain(e);case"blinds":return this.blinds(e);case"wipe":return this.wipe(e);case"slot":return this.slot(e);case"split":return this.split(e);case"circular":return this.circular(e);case"ripple":return this.ripple(e);case"warp":return this.warp(e);case"swipe":return this.swipe(e);case"marquee":return this.marquee(e);default:return console.error("We don't have this type shader, "+t)}},this.reset=()=>{this.chain=[],this.compiledProgram.forEach((function(t){t.destroy(this.ctx)}),this),this.compiledProgram.clear(),this.sourceTexture&&(this.activeSourceTexture=void 0,this.sourceTexture.destroy(this.ctx),this.sourceTexture=null);for(let t in this.tempFramebuffers){this.tempFramebuffers[t].destroy(this.ctx)}this.tempFramebuffers={}},this.apply=(t,e=!1)=>{if(0==this.chain.length)return t;this.resize(t.width,t.height),this.drawShader=0,this.sourceTexture&&this.width==t.width&&this.height==t.height||(this.sourceTexture&&(this.sourceTexture.destroy(this.ctx),this.sourceTexture=null),this.sourceTexture=new n.A("texture"),this.sourceTexture.createTexture(this.ctx,t.width,t.height)),(t!==this.activeSourceTexture||e)&&(this.sourceTexture.uploadData(this.ctx,t),this.activeSourceTexture=t);for(var s=0;s<this.chain.length;s++)this.lastInChain=s==this.chain.length-1,this.runShader(this.chain[s].type,this.chain[s].value);return this.currentFramebufferIndex=0,this.canvas},this.resize=(t,e)=>{if(t!=this.width||e!=this.height){if(this.canvas.width=this.width=t,this.canvas.height=this.height=e,!this.vertexBuffer){var s=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,-1,1,0,1,1,-1,1,0,1,1,1,1]);this.ctx||this.initContext(),this.vertexBuffer=this.ctx.createBuffer(),this.ctx.bindBuffer(this.ctx.ARRAY_BUFFER,this.vertexBuffer),this.ctx.bufferData(this.ctx.ARRAY_BUFFER,s,this.ctx.STATIC_DRAW)}this.ctx.viewport(0,0,this.width,this.height);for(let t in this.tempFramebuffers){this.tempFramebuffers[t].destroy(this.ctx)}this.tempFramebuffers={}}},this.getTempFramebuffer=t=>(this.tempFramebuffers[t]=this.tempFramebuffers[t]||this.createFramebufferTexture(this.width,this.height),this.tempFramebuffers[t]),this.createFramebufferTexture=(t,e)=>{let s=this.ctx.createFramebuffer();this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,s);let i=this.ctx.createRenderbuffer();this.ctx.bindRenderbuffer(this.ctx.RENDERBUFFER,i),this.ctx.renderbufferStorage(this.ctx.RENDERBUFFER,this.ctx.DEPTH_COMPONENT16,t,e);let a=this.ctx.createTexture();return this.ctx.bindTexture(this.ctx.TEXTURE_2D,a),this.ctx.texImage2D(this.ctx.TEXTURE_2D,0,this.ctx.RGBA,t,e,0,this.ctx.RGBA,this.ctx.UNSIGNED_BYTE,null),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_MAG_FILTER,this.ctx.NEAREST),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_MIN_FILTER,this.ctx.NEAREST),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_WRAP_S,this.ctx.CLAMP_TO_EDGE),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_WRAP_T,this.ctx.CLAMP_TO_EDGE),this.ctx.framebufferTexture2D(this.ctx.FRAMEBUFFER,this.ctx.COLOR_ATTACHMENT0,this.ctx.TEXTURE_2D,a,0),this.ctx.framebufferRenderbuffer(this.ctx.FRAMEBUFFER,this.ctx.DEPTH_ATTACHMENT,this.ctx.RENDERBUFFER,i),this.ctx.bindTexture(this.ctx.TEXTURE_2D,null),this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null),new l.A(s,i,a)},this.draw=(t,e=!1)=>{if((this.chain.length<=1||this.lastInChain)&&!e)this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null);else{let t=this.getTempFramebuffer(this.currentFramebufferIndex);this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,t.framebuffer)}this.ctx.uniform4f(t.uniform.transform,1,1,0,0),this.ctx.clear(this.ctx.COLOR_BUFFER_BIT),this.ctx.clearColor(0,0,0,0),this.setTexture(t.texture),this.ctx.drawArrays(this.ctx.TRIANGLES,0,6),this.drawShader++,this.currentFramebufferIndex^=1,this.getError()},this.setTexture=t=>{let e=-1;t.forEach((function(t,s){if(this.ctx.activeTexture(this.ctx.TEXTURE0+s),0===s&&0===this.drawShader)this.ctx.bindTexture(this.ctx.TEXTURE_2D,this.sourceTexture.texture);else if(0===s){let t=1^this.currentFramebufferIndex,e=this.getTempFramebuffer(t);this.ctx.bindTexture(this.ctx.TEXTURE_2D,e.texture)}else this.ctx.bindTexture(this.ctx.TEXTURE_2D,t.texture);e=Math.max(e,s)}),this);for(let s=e+1;s<=this.lastTextureSlot;++s)this.ctx.activeTexture(this.ctx.TEXTURE0+s),this.ctx.bindTexture(this.ctx.TEXTURE_2D,null);this.lastTextureSlot=e},this.cleanUp=()=>{this.sourceTexture=null,this.canvas=null,this.ctx=null},this.compileShader=(t,e=this.VERTEX_IDENTITY)=>{let s=new o.A(this.ctx,e,t);var i=Float32Array.BYTES_PER_ELEMENT;return this.ctx.enableVertexAttribArray(s.attribute.apos),this.ctx.vertexAttribPointer(s.attribute.apos,2,this.ctx.FLOAT,!1,4*i,0*i),this.ctx.enableVertexAttribArray(s.attribute.auv),this.ctx.vertexAttribPointer(s.attribute.auv,2,this.ctx.FLOAT,!1,4*i,2*i),s},this.VERTEX_IDENTITY="\n        precision highp float;\n        attribute vec2 apos;\n        attribute vec2 auv;\n        varying vec2 uv;\n        uniform vec4 transform;\n\n        void main(void) {\n            uv = auv;\n            gl_Position = vec4(apos.x * transform.x + transform.z, apos.y * transform.y + transform.w, 0.0, 1.0);\n        }",this.FRAGMENT_IDENTITY="\n        precision highp float;\n        varying vec2 uv;\n        uniform sampler2D texture;\n\n        void main(void) {\n            gl_FragColor = texture2D(texture, uv);\n        }",this.GAUSSKERN_MAX=15,this.cloneChain=()=>{var t,e,s;const i=[];for(let a=0;a<this.chain.length;a++){const n=this.chain[a];let o;switch(n.type){case"curves":{const t=n.value,e=t.rgb.map((t=>t.clone())),s=t.red.map((t=>t.clone())),i=t.green.map((t=>t.clone())),a=t.blue.map((t=>t.clone()));o=new p.A(t.scale,e,s,i,a);break}case"levels":{const t=n.value;o=new u.A(t.minin,t.maxin,t.minout,t.maxout,t.midin,t.mid);break}case"toning":{const i=n.value;o=new c.A(null===(t=i.highlight)||void 0===t?void 0:t.clone(),null===(e=i.midtone)||void 0===e?void 0:e.clone(),null===(s=i.shadow)||void 0===s?void 0:s.clone(),i.amount);break}case"fill":{const t=n.value;o=new h.A(t.color.clone(),t.blend,t.amount);break}default:o=n.value}i.push(new v(n.type,o))}return i},this.chain=t||[],this.compiledProgram=new Map,this.canvas=(0,g.Nw)(100,100),this.initContext(),this.canvas.addEventListener("webglcontextlost",this.handleContextLost,!1)}initContext(){this.ctx=this.canvas.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1}),this.ctx||(this.canvas=(0,g.Nw)(100,100),this.ctx=this.canvas.getContext("webgl"),(0,r.A)("weg-gl-pre-error")),this.ctx||(console.log("Could not get shaders webgl canvas context!"),(0,r.A)("weg-gl-error"))}bevel(t){let e=this.compiledProgram.get("bevel");if(!e){let t="\n                precision highp float;\n\n                varying vec2 uv;\n                \n                uniform float zeroPoint;\n                uniform vec3 lightNormal;\n                uniform float dz;\n                uniform float size;\n\n                uniform vec4 lowColor;\n                uniform vec4 highColor;\n                \n                uniform sampler2D dist;\n                uniform sampler2D texture;\n                uniform vec2 px;\n\n                vec4 straightBlend(vec4 src, vec4 dst) {\n                    float alpha = src.a + dst.a * (1.0 - src.a);\n\n                    return vec4(\n                        ((src.rgb * src.a) + (dst.rgb * dst.a) * (1.0 - src.a)) / alpha,\n                        alpha\n                    );\n                }\n                \n                void main() {                    \n                    vec2 flipuv = vec2(uv.x, 1.0 - uv.y);\n                                         \n                    /* PER PIXEL OPS */\n                    float tl = clamp(0.0, size, texture2D(dist, flipuv + vec2(-px.x, -px.y)).a);\n                    float tm = clamp(0.0, size, texture2D(dist, flipuv + vec2(    0, -px.y)).a);\n                    float tr = clamp(0.0, size, texture2D(dist, flipuv + vec2( px.x, -px.y)).a);\n                \n                    float ml = clamp(0.0, size, texture2D(dist, flipuv + vec2(-px.x,     0)).a);\n                    float mr = clamp(0.0, size, texture2D(dist, flipuv + vec2( px.x,     0)).a);\n                \n                    float bl = clamp(0.0, size, texture2D(dist, flipuv + vec2(-px.x,  px.y)).a);\n                    float bm = clamp(0.0, size, texture2D(dist, flipuv + vec2(    0,  px.y)).a);\n                    float br = clamp(0.0, size, texture2D(dist, flipuv + vec2( px.x,  px.y)).a);\n                \n                    float dx = (tr + 2.0 * mr + br) - (tl + 2.0 * ml + bl);\n                    float dy = (bl + 2.0 * bm + br) - (tl + 2.0 * tm + tr);\n                \n                    vec3 surfaceNormal = vec3(dx, dy, dz);\n                    float norm = sqrt(dx*dx + dy*dy + dz*dz);\n                \n                    // Calculate incident light amount, range [-1, 0]\n                    float incidentLight = ((dot(surfaceNormal, lightNormal) / norm) - zeroPoint) - (1.0 - zeroPoint);\n                    \n                    vec4 slopes = mix(lowColor, highColor, 1.0 - abs(incidentLight));\n                    \n                    // Texture\n                    vec4 color = texture2D(texture, uv);\n\n                    // Bevel color, only use the the color where we need it\n                    float alpha = smoothstep(1e-5, dz + 8.0, distance(vec3(0.0,0.0,dz), surfaceNormal));\n                    vec4 bevelColor = vec4(slopes.rgb, slopes.a * alpha);\n\n                    gl_FragColor = straightBlend(\n                        bevelColor,\n                        color\n                    );\n                }";e=this.compileShader(t),this.compiledProgram.set("bevel",e)}this.ctx.useProgram(e.program);e.getTextureById("dist").setTexture(t.distanceMap);const s=Math.sin(t.lightElevation);this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(e.uniform.zeroPoint,s),this.ctx.uniform3f(e.uniform.lightNormal,Math.cos(t.lightElevation)*-Math.cos(t.lightAngle),Math.cos(t.lightElevation)*-Math.sin(t.lightAngle),s),this.ctx.uniform4f(e.uniform.lowColor,t.lowLightColor.r/255,t.lowLightColor.g/255,t.lowLightColor.b/255,t.lowOpacity),this.ctx.uniform4f(e.uniform.highColor,t.highLightColor.r/255,t.highLightColor.g/255,t.highLightColor.b/255,t.highOpacity),this.ctx.uniform1f(e.uniform.dz,1/t.depth),this.ctx.uniform1f(e.uniform.size,t.size),this.draw(e)}stroke(t){const e="stroke"+(t.cutout?"-cutout":"");let s=this.compiledProgram.get(e);if(!s){let i=`\n                precision highp float;\n\n                #define CUTOUT ${t.cutout?1:0}\n\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform sampler2D distanceMap;\n                            \n                uniform vec4 glowColor;\n                uniform float size;\n\n                vec4 straightBlend(vec4 src, vec4 dst) {\n                    float alpha = src.a + dst.a * (1.0 - src.a);\n\n                    return vec4(\n                        ((src.rgb * src.a) + (dst.rgb * dst.a) * (1.0 - src.a)) / alpha,\n                        alpha\n                    );\n                }\n\n                void main(void) {           \n                    vec2 flipped = vec2(uv.x, 1.0 - uv.y);\n\n                    float distance = texture2D(distanceMap, flipped).a;\n                    float gAlpha = 1.0-smoothstep(size - 3.0, size, distance);\n\n                    vec4 gColor = vec4(\n                        glowColor.rgb, \n                        gAlpha * glowColor.a\n                    );\n\n                    vec4 texColor = texture2D(texture, uv);\n\n                    #if CUTOUT == 1\n                        vec4 tran = vec4(0);\n                        gl_FragColor = mix(gColor, tran, texColor.a);\n                    #else\n                        gl_FragColor = straightBlend(texColor, gColor);                    \n                    #endif\n                }\n            `;s=this.compileShader(i),this.compiledProgram.set(e,s)}this.ctx.useProgram(s.program),this.ctx.uniform4f(s.uniform.glowColor,t.color.r/255,t.color.g/255,t.color.b/255,t.opacity);s.getTextureById("distanceMap").setTexture(t.distanceMap),this.ctx.uniform1f(s.uniform.size,t.size),this.draw(s)}innerGlow(t){let e=this.compiledProgram.get("innerglow");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform sampler2D distanceMap;\n                            \n                uniform vec4 glowColor;\n                uniform float size;\n                uniform float feather;\n\n                void main(void) {           \n                    vec2 flipped = vec2(uv.x, 1.0 - uv.y);\n\n                    float distance = texture2D(distanceMap, flipped).a;\n                    float balance = 1.0-smoothstep(size * (1.0-feather), size, distance);\n\n                    vec4 texColor = texture2D(texture, uv);\n\n                    vec4 gColor = vec4(\n                        glowColor.rgb, \n                        texColor.a\n                    );\n                       \n                    gl_FragColor = mix(texColor, gColor, balance * glowColor.a);\n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("innerglow",e)}this.ctx.useProgram(e.program),this.ctx.uniform4f(e.uniform.glowColor,t.color.r/255,t.color.g/255,t.color.b/255,t.opacity);e.getTextureById("distanceMap").setTexture(t.distanceMap),this.ctx.uniform1f(e.uniform.size,t.size),this.ctx.uniform1f(e.uniform.feather,t.feather),this.draw(e)}outerGlow(t){let e=this.compiledProgram.get("outerglow");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform sampler2D distanceMap;\n                            \n                uniform vec4 glowColor;\n                uniform float size;\n                uniform float feather;\n\n                vec4 straightBlend(vec4 src, vec4 dst) {\n                    float alpha = src.a + dst.a * (1.0 - src.a);\n\n                    return vec4(\n                        ((src.rgb * src.a) + (dst.rgb * dst.a) * (1.0 - src.a)) / alpha,\n                        alpha\n                    );\n                }\n                \n                void main(void) {           \n                    vec2 flipped = vec2(uv.x, 1.0 - uv.y);\n\n                    float distance = texture2D(distanceMap, flipped).a;\n                    float gAlpha = 1.0-smoothstep(size * (1.0-feather), size, distance);\n\n                    vec4 gColor = vec4(\n                        glowColor.rgb, \n                        gAlpha * glowColor.a\n                    );\n\n                    vec4 texColor = texture2D(texture, uv);\n                    \n                    gl_FragColor = straightBlend(texColor, gColor);                    \n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("outerglow",e)}this.ctx.useProgram(e.program),this.ctx.uniform4f(e.uniform.glowColor,t.color.r/255,t.color.g/255,t.color.b/255,t.opacity);e.getTextureById("distanceMap").setTexture(t.distanceMap),this.ctx.uniform1f(e.uniform.size,t.size),this.ctx.uniform1f(e.uniform.feather,t.feather),this.draw(e)}sobel(){let t=this.compiledProgram.get("sobel");if(!t){let e="\n                precision mediump float;\n\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n\n                uniform float m[3];\n                #define M_PI 3.1415926535897932384626433832795\n                #define GET_PIXEL(x,y) (texture2D(texture, uv + px*vec2(x,y)))\n\n                void main() {\n\n                    float dx = (length(GET_PIXEL(-1, -1)*m[0] +\n                                GET_PIXEL(-1,  0)*m[1] +\n                                GET_PIXEL(-1, +1)*m[2]) -\n                            length(GET_PIXEL(+1, -1)*m[0] +\n                                GET_PIXEL(+1,  0)*m[1] +\n                                GET_PIXEL(+1, +1)*m[2]));\n\n                    float dy = (length(GET_PIXEL(-1, -1)*m[0] +\n                                GET_PIXEL(0, -1)*m[1] +\n                                GET_PIXEL(+1, -1)*m[2]) -\n                            length(GET_PIXEL(-1, +1)*m[0] +\n                                GET_PIXEL(0, +1)*m[1] +\n                                GET_PIXEL(+1, +1)*m[2]));\n\n                    float theta = (atan(dy, dx) + M_PI) / (2.0*M_PI);\n\n                    gl_FragColor = vec4(length(vec2(dx, dy)), theta, 0.0, 1.0);\n                }";t=this.compileShader(e),this.compiledProgram.set("sobel",t)}if(this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform1fv(t.uniform.m,[1,2,1]),this.draw(t,!0),t=this.compiledProgram.get("sobelNMS"),!t){let e="\n                precision mediump float;\n\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n\n                #define M_PI 3.1415926535897932384626433832795\n\n                void main() {\n                    vec4 cc = texture2D(texture, uv);  \n                    float theta = degrees(cc.y*M_PI*2.0); \n                    int ax = 0, ay = 0; \n                    if ((theta >= 337.5) || (theta < 22.5)) { ax = 1; ay = 0; } \n                    else if ((theta >= 22.5) && (theta < 67.5)) { ax = 1; ay = 1; } \n                    else if ((theta >= 67.5) && (theta < 112.5)) { ax = 0; ay = 1; } \n                    else if ((theta >= 112.5) && (theta < 157.5)) { ax =-1; ay = 1; } \n                    else if ((theta >= 157.5) && (theta < 202.5)) { ax =-1; ay = 0; } \n                    else if ((theta >=202.5) && (theta < 247.5)) { ax =-1; ay =-1; } \n                    else if ((theta >=247.5) && (theta < 292.5)) { ax = 0; ay =-1; } \n                    else if ((theta >= 292.5) && (theta < 337.5)) { ax = 1; ay =-1; }\n                \n                    vec4 ca = texture2D(texture, uv + px*vec2(ax, ay));\n                    vec4 cb = texture2D(texture, uv + px*vec2(-ax, -ay));\n                    gl_FragColor = vec4((((cc.x <= ca.x) || (cc.x < cb.x)) ? vec3(0) : vec3(cc.x)), 1.0);\n                }";t=this.compileShader(e),this.compiledProgram.set("sobelNMS",t)}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.draw(t)}vibrance(t){let e=this.compiledProgram.get("vibrance");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n\n                    vec4 col = texture2D(texture, uv.xy);\n                    vec3 color = col.rgb;\n                \n                    float luminance = color.r*0.299 + color.g*0.587 + color.b*0.114;\n                    float mn = min(min(color.r, color.g), color.b);\n                    float mx = max(max(color.r, color.g), color.b);\n                    float sat = (1.0-(mx - mn)) * (1.0-mx) * luminance * 5.0;\n                    vec3 lightness = vec3((mn + mx)/2.0);\n                \n                    // vibrance\n                    color = mix(color, mix(color, lightness, -amount), sat);\n                \n                    // negative vibrance\n                    gl_FragColor = vec4(mix(color, lightness, (1.0-lightness)*(1.0-amount)/2.0*abs(amount)), col.a);\n                }";e=this.compileShader(t),this.compiledProgram.set("vibrance",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}brightness(t){let e;if(t>0){if(e=this.compiledProgram.get("brightness-up"),!e){let t="\n                    precision highp float;\n                    varying vec2 uv;\n                    uniform sampler2D texture;\n                    uniform float amount;\n\n                    #define PI 3.1415926535897932384626433832795\n\n                    void main() {\n                        vec4 color = texture2D(texture, uv);\n\n                        color.r = color.r + amount * sin(color.r * PI);\n                        color.g = color.g + amount * sin(color.g * PI);\n                        color.b = color.b + amount * sin(color.b * PI);\n\n                        gl_FragColor = color;\n                    }";e=this.compileShader(t),this.compiledProgram.set("brightness-up",e)}}else if(e=this.compiledProgram.get("brightness-down"),!e){let t="\n                    precision highp float;\n                    varying vec2 uv;\n                    uniform sampler2D texture;\n                    uniform float amount;\n\n                    void main() {\n                        vec4 color = texture2D(texture, uv);\n     \n                        color.r = (1.0 + amount) * color.r;\n                        color.g = (1.0 + amount) * color.g;\n                        color.b = (1.0 + amount) * color.b;\n\n                        gl_FragColor = color;\n                    }";e=this.compileShader(t),this.compiledProgram.set("brightness-down",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t>0?.35*t:.75*t),this.draw(e)}bwpoint(t){let e=this.compiledProgram.get("bwpoint");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                uniform float white;\n                uniform float black;\n\n                void main() {\n\n                    float bval = black / 255.0;\n                    float wval = (255.0 / (white - black));\n                \n                    vec3 color = texture2D(texture, uv).rgb;\n                    color = color * wval - (bval *  wval);\n\n                    gl_FragColor = vec4(color, texture2D(texture, uv).a);\n                }";e=this.compileShader(t),this.compiledProgram.set("bwpoint",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.black,t.black),this.ctx.uniform1f(e.uniform.white,t.white),this.draw(e)}dealiasing(){let t=this.compiledProgram.get("dealiasing");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.a = (color.a < 0.25) ? 0.0 : 1.0;\n                    gl_FragColor = color;\n                }";t=this.compileShader(e),this.compiledProgram.set("dealiasing",t)}this.ctx.useProgram(t.program),this.draw(t)}alphaInvert(){let t=this.compiledProgram.get("alpha-invert");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.a = 1.0 - color.a;\n                    gl_FragColor = color;\n                }";t=this.compileShader(e),this.compiledProgram.set("alpha-invert",t)}this.ctx.useProgram(t.program),this.draw(t)}alphaMask(){let t=this.compiledProgram.get("alpha-mask");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    gl_FragColor = vec4(0,0,0, texture2D(texture, uv).a);\n                }";t=this.compileShader(e),this.compiledProgram.set("alpha-mask",t)}this.ctx.useProgram(t.program),this.draw(t)}alphaShiftMask(){let t=this.compiledProgram.get("alpha-shift-mask");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    gl_FragColor = vec4(0,0,0, texture2D(texture, uv).r);\n                }";t=this.compileShader(e),this.compiledProgram.set("alpha-shift-mask",t)}this.ctx.useProgram(t.program),this.draw(t)}alphaReset(){let t=this.compiledProgram.get("alpha-reset");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    gl_FragColor = vec4(color.rgb, 1.0);\n                }";t=this.compileShader(e),this.compiledProgram.set("alpha-reset",t)}this.ctx.useProgram(t.program),this.draw(t)}border(t){let e=this.compiledProgram.get("border");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform float size;\n                uniform vec4 color;\n                uniform vec2 screen;\n                uniform vec2 px;\n\n                void main() {\n                    vec4 pixel = texture2D(texture, uv);\n\n                    if(uv.y <= size*px.y || uv.y >= (screen.y-size)*px.y ||\n                       uv.x <= size*px.x || uv.x >= (screen.x-size)*px.x) {\n                        gl_FragColor = color;\n                    } else {\n                        gl_FragColor = pixel;\n                    }\n                }";e=this.compileShader(t),this.compiledProgram.set("border",e)}let s=Math.round((this.width+this.height)/2*t.size);this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.size,s),this.ctx.uniform2f(e.uniform.screen,this.width,this.height),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.ctx.uniform4f(e.uniform.color,t.color.r/255,t.color.g/255,t.color.b/255,1),this.draw(e)}balance(t){let e=this.compiledProgram.get("balance");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                uniform float sr;\n                uniform float sg;\n                uniform float sb;\n                uniform float mr;\n                uniform float mg;\n                uniform float mb;\n                uniform float hr;\n                uniform float hg;\n                uniform float hb;\n                uniform float preserve;\n\n                #define PI 3.1415926535897932384626433832795\n\n                float Lum(vec4 c){\n                    return 0.299*c.r + 0.587*c.g + 0.114*c.b;\n                }\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    \n                    float olum = Lum(color);\n\n                    //highlight\n                    color.r = clamp(color.r + (hr * (exp(color.r) - 1.0)), 0.0, 1.0);\n                    color.g = clamp(color.g + (hg * (exp(color.g) - 1.0)), 0.0, 1.0);\n                    color.b = clamp(color.b + (hb * (exp(color.b) - 1.0)), 0.0, 1.0);\n\n                    //midtone\n                    color.r = clamp(color.r + (mr * 0.25) * sin(color.r * PI), 0.0, 1.0);\n                    color.g = clamp(color.g + (mg * 0.25) * sin(color.g * PI), 0.0, 1.0);\n                    color.b = clamp(color.b + (mb * 0.25) * sin(color.b * PI), 0.0, 1.0);\n\n                    //shadow\n                    color.r = clamp((1.0 - sr * 0.5) * color.r + (1.0 - (1.0 - sr * 0.5)), 0.0, 1.0);\n                    color.g = clamp((1.0 - sg * 0.5) * color.g + (1.0 - (1.0 - sg * 0.5)), 0.0, 1.0);\n                    color.b = clamp((1.0 - sb * 0.5) * color.b + (1.0 - (1.0 - sb * 0.5)), 0.0, 1.0);\n                    \n                    if(preserve == 1.0) {\n                        float nlum = Lum(color);\n                        color.rgb = color.rgb * (olum/nlum);\n                    }\n\n                    gl_FragColor = color;\n                }";e=this.compileShader(t),this.compiledProgram.set("balance",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.sr,t.shadowRed),this.ctx.uniform1f(e.uniform.sg,t.shadowGreen),this.ctx.uniform1f(e.uniform.sb,t.shadowBlue),this.ctx.uniform1f(e.uniform.mr,t.midtoneRed),this.ctx.uniform1f(e.uniform.mg,t.midtoneGreen),this.ctx.uniform1f(e.uniform.mb,t.midtoneBlue),this.ctx.uniform1f(e.uniform.hr,t.highlightRed),this.ctx.uniform1f(e.uniform.hg,t.highlightGreen),this.ctx.uniform1f(e.uniform.hb,t.highlightBlue),this.ctx.uniform1f(e.uniform.preserve,Number(t.preserve)),this.draw(e)}temperature(t){let e=this.compiledProgram.get("temperature");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.r = clamp(color.r + amount, 0.0, 1.0);\n                    color.b = clamp(color.b - amount, 0.0, 1.0);\n                    gl_FragColor = color;\n                }";e=this.compileShader(t),this.compiledProgram.set("temperature",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t/6),this.draw(e)}tint(t){let e=this.compiledProgram.get("tint");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.g = clamp(color.g + amount, 0.0, 1.0);\n                    gl_FragColor = color;\n                }";e=this.compileShader(t),this.compiledProgram.set("tint",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t/6),this.draw(e)}threshold(t){let e=this.compiledProgram.get("threshold");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n    \n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    float grayscale = (color.r + color.g + color.b) / 3.0;\n                    float grayValue = step(amount, grayscale);\n                    gl_FragColor = vec4(grayValue, grayValue, grayValue, color.a);\n                }";e=this.compileShader(t),this.compiledProgram.set("threshold",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}alphaThreshold(t){let e=this.compiledProgram.get("alphaThreshold");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.a = step(amount, color.a);\n                    gl_FragColor = vec4(color.r, color.g, color.b, color.a);\n                }";e=this.compileShader(t),this.compiledProgram.set("alphaThreshold",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}noise(t){let e=this.compiledProgram.get("noise");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                float random(vec2 p) {\n                    vec2 r = vec2(23.14069263277926,2.665144142690225);\n                    return fract(cos(mod(12345678.,256. * dot(p,r))));\n                }\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    float noise = (random(uv) -0.5)*amount;\n\n                    gl_FragColor = vec4(color.r+noise, color.g+noise, color.b+noise, color.a);\n                }";e=this.compileShader(t),this.compiledProgram.set("noise",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}halftone(t){let e=this.compiledProgram.get("halftone");if(!e){this.ctx.getExtension("OES_standard_derivatives");let t="\n                #ifdef GL_OES_standard_derivatives\n                #extension GL_OES_standard_derivatives : enable\n                #endif\n\n                precision highp float;                \n\n                uniform sampler2D texture;\n                uniform vec2 size;\n                uniform float frequency;\n  \n                varying vec2 uv; // Texcoords\n\n                float aastep(float threshold, float value) {\n                #ifdef GL_OES_standard_derivatives\n                    float afwidth = 0.7 * length(vec2(dFdx(value), dFdy(value)));\n                #else\n                    float afwidth = frequency * (1.0/size.x);\n                #endif\n                    return smoothstep(threshold-afwidth, threshold+afwidth, value);\n                }\n\n                // Explicit bilinear texture lookup to circumvent bad hardware precision.\n                // The extra arguments specify the dimension of the texture. (GLSL 1.30\n                // introduced textureSize() to get that information from the sampler.)\n                // 'dims' is the width and height of the texture, 'one' is 1.0/dims.\n                // (Precomputing 'one' saves two divisions for each lookup.)\n                vec4 texture2D_bilinear(sampler2D tex, vec2 st, vec2 dims, vec2 one) {\n                    vec2 uv = st * dims;\n                    vec2 uv00 = floor(uv - vec2(0.5)); // Lower left corner of lower left texel\n                    vec2 uvlerp = uv - uv00 - vec2(0.5); // Texel-local lerp blends [0,1]\n                    vec2 st00 = (uv00 + vec2(0.5)) * one;\n                    vec4 texel00 = texture2D(tex, st00);\n                    vec4 texel10 = texture2D(tex, st00 + vec2(one.x, 0.0));\n                    vec4 texel01 = texture2D(tex, st00 + vec2(0.0, one.y));\n                    vec4 texel11 = texture2D(tex, st00 + one);\n                    vec4 texel0 = mix(texel00, texel01, uvlerp.y); \n                    vec4 texel1 = mix(texel10, texel11, uvlerp.y); \n                    return mix(texel0, texel1, uvlerp.x);\n                }\n\n                vec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n                vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n                vec3 permute(vec3 x) { return mod289((( x * 34.0) + 1.0) * x); }\n                \n                float snoise(vec2 v) {\n                    const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                                        0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                                        -0.577350269189626,  // -1.0 + 2.0 * C.x\n                                        0.024390243902439); // 1.0 / 41.0\n                    // First corner\n                    vec2 i = floor(v + dot(v, C.yy) );\n                    vec2 x0 = v - i + dot(i, C.xx);\n                    // Other corners\n                    vec2 i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n                    vec4 x12 = x0.xyxy + C.xxzz;\n                    x12.xy -= i1;\n                    // Permutations\n                    i = mod289(i); // Avoid truncation effects in permutation\n                    vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n                                            + i.x + vec3(0.0, i1.x, 1.0 ));\n                    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),\n                                            dot(x12.zw,x12.zw)), 0.0);\n                    m = m*m; m = m*m;\n                    // Gradients\n                    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n                    vec3 h = abs(x) - 0.5;\n                    vec3 a0 = x - floor(x + 0.5);\n                    // Normalise gradients implicitly by scaling m\n                    m *= 1.792843 - 0.853735 * ( a0*a0 + h*h );\n                    // Compute final noise value at P\n                    vec3 g;\n                    g.x = a0.x * x0.x + h.x * x0.y;\n                    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n                    return 130.0 * dot(m, g);\n                }\n                \n                void main() {\n                    // Correct UVs for aspect ratio so we get round balls not squished\n                    vec2 auv = uv;\n                    auv.x *= size.x / size.y;\n\n                    vec3 color = texture2D_bilinear(texture, uv, size, 1.0 / size).rgb;\n\n                    float n = 0.1*snoise(auv*200.0); // Fractal noise\n                    n += 0.05*snoise(auv*400.0);\n                    n += 0.025*snoise(auv*800.0);\n\n                    vec3 white = vec3(n*0.2 + 0.97);\n                    vec3 black = vec3(n + 0.1);\n\n                    // Perform a rough RGB-to-CMYK conversion\n                    vec4 cmyk;\n                    cmyk.xyz = 1.0 - color;\n                    cmyk.w = min(cmyk.x, min(cmyk.y, cmyk.z)); // Create K\n                    cmyk.xyz -= cmyk.w; // Subtract K equivalent from CMY\n                \n                    // Distance to nearest point in a grid of\n                    // (frequency x frequency) points over the unit square\n                    vec2 Kst = frequency*mat2(0.707, -0.707, 0.707, 0.707)*auv;\n                    vec2 Kuv = 2.0*fract(Kst)-1.0;\n                    float k = aastep(0.0, sqrt(cmyk.w)-length(Kuv)+n);\n                    vec2 Cst = frequency*mat2(0.966, -0.259, 0.259, 0.966)*auv;\n                    vec2 Cuv = 2.0*fract(Cst)-1.0;\n                    float c = aastep(0.0, sqrt(cmyk.x)-length(Cuv)+n);\n                    vec2 Mst = frequency*mat2(0.966, 0.259, -0.259, 0.966)*auv;\n                    vec2 Muv = 2.0*fract(Mst)-1.0;\n                    float m = aastep(0.0, sqrt(cmyk.y)-length(Muv)+n);\n                    vec2 Yst = frequency*auv; // 0 deg\n                    vec2 Yuv = 2.0*fract(Yst)-1.0;\n                    float y = aastep(0.0, sqrt(cmyk.z)-length(Yuv)+n);\n                \n                    vec3 rgbscreen = 1.0 - 0.9*vec3(c,m,y) + n;\n                    rgbscreen = mix(rgbscreen, black, 0.85*k + 0.3*n);\n                \n                    #ifdef GL_OES_standard_derivatives\n                        float afwidth = 2.0 * frequency * max(length(dFdx(uv)), length(dFdy(uv)));\n                    #else\n                        float afwidth = frequency * (1.0/size.x);\n                    #endif\n                    \n                    float blend = smoothstep(0.7, 1.4, afwidth); \n                    gl_FragColor = vec4(mix(rgbscreen, color, blend), 1.0);\n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("halftone",e)}this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.size,this.width,this.height),this.ctx.uniform1f(e.uniform.frequency,Math.round(100*t)),this.draw(e)}vignette(t){let e=this.compiledProgram.get(t<0?"vignette-white":"vignette-black");if(!e){let s=["precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","uniform float size;","void main() {","vec4 color = texture2D(texture, uv);","float dist = distance(uv, vec2(0.5, 0.5));","float grd = smoothstep(0.8, size * 0.799, dist * (amount*0.6 + size*2.0));","color.rgb += vec3(1.0, 1.0, 1.0) * (1.0 - grd);","gl_FragColor = color;","}"].join("\n"),i=["precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","uniform float size;","void main() {","vec4 color = texture2D(texture, uv);","float dist = distance(uv, vec2(0.5, 0.5));","color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount*0.75 + size*2.0));","gl_FragColor = color;","}"].join("\n");e=this.compileShader(t<0?s:i),this.compiledProgram.set(t<0?"vignette-white":"vignette-black",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.size,.25),this.ctx.uniform1f(e.uniform.amount,t<0?-1*t:t),this.draw(e)}grain(t){let e=this.compiledProgram.get("grain");if(!e){let t=["precision highp float;","uniform sampler2D texture;","varying vec2 uv;","uniform float width;","uniform float height;","uniform float grainamount;","uniform float timer;","const float permTexUnit = 1.0/256.0;","const float permTexUnitHalf = 0.5/256.0;","float grainsize = 1.8;","float lumamount = 1.0;","vec4 rnm(in vec2 tc)","{","float noise =  sin(dot(tc + vec2(timer,timer),vec2(12.9898,78.233))) * 43758.5453;","float noiseR =  fract(noise)*2.0-1.0;","float noiseG =  fract(noise*1.2154)*2.0-1.0; ","float noiseB =  fract(noise*1.3453)*2.0-1.0;","float noiseA =  fract(noise*1.3647)*2.0-1.0;","return vec4(noiseR,noiseG,noiseB,noiseA);","}","float fade(in float t) {","return t*t*t*(t*(t*6.0-15.0)+10.0);","}","float pnoise3D(in vec3 p)","{","vec3 pi = permTexUnit*floor(p)+permTexUnitHalf;","vec3 pf = fract(p);","float perm00 = rnm(pi.xy).a ;","vec3  grad000 = rnm(vec2(perm00, pi.z)).rgb * 4.0 - 1.0;","float n000 = dot(grad000, pf);","vec3  grad001 = rnm(vec2(perm00, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n001 = dot(grad001, pf - vec3(0.0, 0.0, 1.0));","float perm01 = rnm(pi.xy + vec2(0.0, permTexUnit)).a ;","vec3  grad010 = rnm(vec2(perm01, pi.z)).rgb * 4.0 - 1.0;","float n010 = dot(grad010, pf - vec3(0.0, 1.0, 0.0));","vec3  grad011 = rnm(vec2(perm01, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n011 = dot(grad011, pf - vec3(0.0, 1.0, 1.0));","float perm10 = rnm(pi.xy + vec2(permTexUnit, 0.0)).a ;","vec3  grad100 = rnm(vec2(perm10, pi.z)).rgb * 4.0 - 1.0;","float n100 = dot(grad100, pf - vec3(1.0, 0.0, 0.0));","vec3  grad101 = rnm(vec2(perm10, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n101 = dot(grad101, pf - vec3(1.0, 0.0, 1.0));","float perm11 = rnm(pi.xy + vec2(permTexUnit, permTexUnit)).a ;","vec3  grad110 = rnm(vec2(perm11, pi.z)).rgb * 4.0 - 1.0;","float n110 = dot(grad110, pf - vec3(1.0, 1.0, 0.0));","vec3  grad111 = rnm(vec2(perm11, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n111 = dot(grad111, pf - vec3(1.0, 1.0, 1.0));","vec4 n_x = mix(vec4(n000, n001, n010, n011), vec4(n100, n101, n110, n111), fade(pf.x));","vec2 n_xy = mix(n_x.xy, n_x.zw, fade(pf.y));","float n_xyz = mix(n_xy.x, n_xy.y, fade(pf.z));","return n_xyz;","}","vec2 coordRot(in vec2 tc, in float angle)","{","float aspect = width/height;","float rotX = ((tc.x*2.0-1.0)*aspect*cos(angle)) - ((tc.y*2.0-1.0)*sin(angle));","float rotY = ((tc.y*2.0-1.0)*cos(angle)) + ((tc.x*2.0-1.0)*aspect*sin(angle));","rotX = ((rotX/aspect)*0.5+0.5);","rotY = rotY*0.5+0.5;","return vec2(rotX,rotY);","}","void main() ","{","vec3 rotOffset = vec3(1.425,3.892,5.835);","vec2 rotCoordsR = coordRot(uv, timer + rotOffset.x);","vec3 noise = vec3(pnoise3D(vec3(rotCoordsR*vec2(width/grainsize,height/grainsize),0.0)));","vec4 tex = texture2D(texture, uv);","vec3 col = tex.rgb;","vec3 lumcoeff = vec3(0.299,0.587,0.114);","float luminance = mix(0.0,dot(col, lumcoeff),lumamount);","float lum = smoothstep(0.2,0.0,luminance);","lum += luminance;","noise = mix(noise,vec3(0.0),pow(lum,4.0));","col = col+noise*grainamount;","gl_FragColor =  vec4(col, tex.w);","}"].join("\n");e=this.compileShader(t),this.compiledProgram.set("grain",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.width,this.width),this.ctx.uniform1f(e.uniform.height,this.height),this.ctx.uniform1f(e.uniform.grainamount,t/10),this.draw(e)}sharpen(t){let e=this.compiledProgram.get("sharpen");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n                uniform float m[9];\n                uniform float amount;\n\n                void main(void) {\n                    vec4 c11 = texture2D(texture, uv - px); // top left\n                    vec4 c12 = texture2D(texture, vec2(uv.x, uv.y - px.y)); // top center\n                    vec4 c13 = texture2D(texture, vec2(uv.x + px.x, uv.y - px.y)); // top right\n\n                    vec4 c21 = texture2D(texture, vec2(uv.x - px.x, uv.y) ); // mid left\n                    vec4 c22 = texture2D(texture, uv); // mid center\n                    vec4 c23 = texture2D(texture, vec2(uv.x + px.x, uv.y) ); // mid right\n\n                    vec4 c31 = texture2D(texture, vec2(uv.x - px.x, uv.y + px.y) ); // bottom left\n                    vec4 c32 = texture2D(texture, vec2(uv.x, uv.y + px.y) ); // bottom center\n                    vec4 c33 = texture2D(texture, uv + px ); // bottom right\n\n                    vec4 color = \n                        c11 * m[0] + c12 * m[1] + c13 * m[2] +\n                        c21 * m[3] + c22 * m[4] + c23 * m[5] +\n                        c31 * m[6] + c32 * m[7] + c33 * m[8];\n\n                    gl_FragColor = color * amount + (c22 * (1.0 - amount));\n                }";e=this.compileShader(t),this.compiledProgram.set("sharpen",e)}let s=new Float32Array([-1,-1,-1,-1,9,-1,-1,-1,-1]);this.ctx.useProgram(e.program),this.ctx.uniform1fv(e.uniform.m,s),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(e.uniform.amount,t/2),this.draw(e)}blur(t,e=!1){let s=this.compiledProgram.get("blur");if(!s){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 size;\n                float random(vec3 scale, float seed) {\n                    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n                }\n                void main() {\n                    vec4 color = vec4(0.0);\n                    float total = 0.0;\n                    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n                    for (float t = -30.0; t <= 30.0; t++) {\n                        float percent = (t + offset - 0.5) / 30.0;\n                        float weight = 1.0 - abs(percent);\n                        vec4 sample = texture2D(texture, uv + size * percent);\n                        sample.rgb *= sample.a;\n                        color += sample * weight;\n                        total += weight;\n                    }\n                    gl_FragColor = color / total;\n                    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n                }";s=this.compileShader(t),this.compiledProgram.set("blur",s)}let i=40*t/this.canvas.width,a=40*t/this.canvas.height;this.ctx.useProgram(s.program),this.ctx.uniform2f(s.uniform.size,0,a),this.draw(s,!0),this.ctx.uniform2f(s.uniform.size,i,0),this.draw(s,e)}zoom(t){let e=this.compiledProgram.get("zoom");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                uniform vec2 center;\n                uniform float amount;\n                uniform vec2 px;\n                \n                float random(vec3 scale, float seed) {\n                    /* use the fragment position for a different seed per-pixel */                    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n                }\n                void main() {\n                    vec4 color = vec4(0.0);\n                    float total = 0.0;\n                    vec2 toCenter = (center - uv) * px;\n                    \n                    /* randomize the lookup values to hide the fixed number of samples */\n                    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n                    \n                    for (float t = 0.0; t <= 40.0; t++) {\n                        float percent = (t + offset) / 40.0;\n                        float weight = 4.0 * (percent - percent * percent);\n                        vec4 sample = texture2D(texture, uv + toCenter * percent * amount / px);\n                        \n                        /* switch to pre-multiplied alpha to correctly blur transparent images */\n                        sample.rgb *= sample.a;\n                        \n                        color += sample * weight;\n                        total += weight;\n                    }\n                    gl_FragColor = color / total;\n                    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n                }";e=this.compileShader(t),this.compiledProgram.set("zoom",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t.amount),this.ctx.uniform2f(e.uniform.center,t.x,t.y),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.draw(e)}makeKernel(t){const e=this.GAUSSKERN_MAX+Number(!(1&this.GAUSSKERN_MAX)),s=Math.sqrt(2*Math.PI)*t,i=2*t*t;var a,n,o=~~(e/2),r=new Float32Array(e);for(n=0,a=-o;n<e;a++,n++)r[n]=Math.exp(-a*a/i)/s;return r}scaleKernel(t){const e=t.reduce(((t,e)=>t+e))||1;return t.map((t=>t/e))}gaussian(t){const e=this.makeKernel(10*t),s=e.length+Number(!(1&e.length));let i=this.compiledProgram.get(`guass-${s}`);if(!i){let t=`\n                precision mediump float;\n                #define KERNEL_SIZE ${s}\n                #define KERNEL_HALF KERNEL_SIZE / 2\n                // our texture\n                varying vec2 uv;\n                uniform vec2 px;\n                uniform sampler2D texture;\n                uniform float kernel[KERNEL_SIZE];\n                void main() {\n                    vec4 result = vec4(0.0);\n                    for (int i = 0; i < KERNEL_SIZE; i++) {\n                        result += texture2D(texture, uv + px*vec2(i - KERNEL_HALF))*kernel[i];\n                    }\n                    gl_FragColor = result;\n                }\n            `;i=this.compileShader(t),this.compiledProgram.set(`guass-${s}`,i)}this.ctx.useProgram(i.program),this.ctx.uniform2f(i.uniform.px,0,1/this.height),this.ctx.uniform1fv(i.uniform.kernel,this.scaleKernel(e)),this.draw(i,!0),this.ctx.uniform2f(i.uniform.px,1/this.width,0),this.draw(i)}radial(t){let e=this.compiledProgram.get("radial");if(!e){let t="\n                precision highp float;\n                const float PI = 3.1415926535897932384626433832795;\n                const float samples = 100.;\n\n                uniform sampler2D texture;\n\n                varying vec2 uv;\n                uniform vec2 center;\n                uniform vec2 resolution;\n\n                uniform float amount;\n                uniform int direction;\n                uniform int symmetry;\n               \n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                vec2 rotateUV(vec2 uv, mat2 transform, vec2 centerc) {\n                    uv -= centerc;\n                    uv = transform * uv;\n                    uv += centerc;\n                    return uv;\n                }\n             \n                void main(void) {\n                    float ar = resolution.x / resolution.y;\n                    vec2 uvc = uv;\n                    vec2 centerc = center;\n\n                    if (symmetry == 1)\n                    {\n                        if (resolution.x > resolution.y) {\n                            centerc.y /= ar;\n                            uvc.y /= ar;\n                        }\n                        else {\n                            centerc.x *= ar;\n                            uvc.x *= ar;\n                        }\n                    }\n\n                    vec2 coordcw = uvc;\n                    vec2 coordccw = uvc;\n                    vec4 FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n                    vec2 toCenter = uvc - centerc;\n                    float endsamples = 0.;\n\n                    float a = amount / samples;\n\n                    mat2 matcw = rotate2d(-a * PI / 180.);\n                    mat2 matccw = rotate2d(a * PI / 180.);\n\n                    for (float i = 0.; i < samples; i+=1.) {\n                        if (direction == 1 || direction == 2) {\n                            coordccw = rotateUV(coordccw, matccw, centerc);\n                            FragColor += texture2D(texture, coordccw);\n                            endsamples += 1.;\n                        }\n\n                        if (direction == 0 || direction == 2) {\n                            coordcw = rotateUV(coordcw, matcw, centerc);\n                            FragColor += texture2D(texture, coordcw);\n                            endsamples += 1.;\n                        }\n                    }\n                    FragColor /= endsamples;\n                    gl_FragColor = FragColor;\n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("radial",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,180*t.amount),this.ctx.uniform2f(e.uniform.center,t.x,t.y),this.ctx.uniform1i(e.uniform.direction,t.direction),this.ctx.uniform2f(e.uniform.resolution,this.width,this.height),this.ctx.uniform1i(e.uniform.symmetry,t.symmetry?1:0),this.draw(e)}motion(t){let e=this.compiledProgram.get("motion");if(!e){let t="\n                precision mediump float;\n                uniform float KERNEL_SIZE;\n                varying vec2 uv;\n                uniform vec2 resolution;\n                uniform sampler2D texture;\n                uniform float angle;\n\n                bool outOfRange(vec2 uv) {\n                    return uv.x < 0. || uv. y < 0. || uv.x > 1. || uv.y > 1.;\n                }\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n                void main() {\n                    vec4 result = vec4(0.0);\n                    vec2 resol = vec2 (1./resolution.x, 0.);//1./resolution.y);\n                    resol = rotate2d(angle) * resol;\n                    float divcnt = 1.;\n                    for (float i=1.; i <= 100.; i+=1.) {\n                        vec2 before = uv - resol * i;\n                        if (!outOfRange(before)) {\n                            result += texture2D(texture, before);\n                            divcnt += 1.;\n                        }\n                        vec2 after = uv + resol * i;\n                        if (!outOfRange(after)) {\n                            result += texture2D(texture, after);\n                            divcnt += 1.;\n                        }\n                        if (i >= KERNEL_SIZE) break;\n                    }\n                    result += texture2D(texture, uv);\n                    result /= divcnt;\n                    gl_FragColor = result;\n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("motion",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.KERNEL_SIZE,100*t.amount),this.ctx.uniform1f(e.uniform.angle,t.angle),this.ctx.uniform2f(e.uniform.resolution,this.width,this.height),this.draw(e)}clarity(t){let e=this.compiledProgram.get("clarity");if(!e){const t="\n                #define GLSLIFY 1\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 px;\n                           \n                float Lum(vec3 c){\n                    return 0.299*c.r + 0.587*c.g + 0.114*c.b;\n                }\n                float BlendOverlayf(float base, float blend){\n                    return (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)));\n                }\n                vec3 BlendOverlay(vec3 base, vec3 blend){\n                    return vec3(BlendOverlayf(base.r, blend.r), BlendOverlayf(base.g, blend.g), BlendOverlayf(base.b, blend.b));\n                }\n                float BlendVividLightf(float base, float blend){\n                    float BlendColorBurnf = (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n                    float BlendColorDodgef =  (((2.0 * (blend - 0.5)) == 1.0) ? (2.0 * (blend - 0.5)) : min(base / (1.0 - (2.0 * (blend - 0.5))), 1.0));\n                    return ((blend < 0.5) ? BlendColorBurnf : BlendColorDodgef);\n                }\n                vec3 BlendVividLight(vec3 base, vec3 blend){\n                    return vec3(BlendVividLightf(base.r, blend.r), BlendVividLightf(base.g, blend.g), BlendVividLightf(base.b, blend.b));\n                }\n\n                float normpdf(in float x, in float sigma) {\n                    return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;\n                }\n\n                vec3 blurMap() {\n                    //declare stuff\n                    const int mSize = 11;\n                    const int kSize = (mSize-1)/2;\n                    float kernel[mSize];\n                    vec3 final_colour = vec3(0.0);\n                    \n                    //create the 1-D kernel\n                    float sigma = 7.0;\n                    float Z = 0.0;\n                    for (int j = 0; j <= kSize; ++j){\n                        kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), sigma);\n                    }\n                    \n                    //get the normalization factor (as the gaussian has been clamped)\n                    for (int j = 0; j < mSize; ++j){\n                        Z += kernel[j];\n                    }\n                    \n                    //read out the texels\n                    for (int i=-kSize; i <= kSize; ++i){\n                        for (int j=-kSize; j <= kSize; ++j){\n                            final_colour += kernel[kSize+j] * kernel[kSize+i] * texture2D(texture, (uv.xy + vec2(float(i),float(j))*px)).rgb;\n                        }\n                    }\n                    return vec3(final_colour/(Z*Z));\n                }\n    \n                void main() {\n\n                    vec4 base4 = texture2D(texture, uv.xy);\n                    \n                    vec3 blurMap = blurMap();\n                    vec3 base = base4.rgb;\n                    \n                    float intensity = (amount < 0.0) ? (amount / 2.0) : amount;\n                    float lum = Lum(base);\n                  \n                    vec3 col = vec3(lum);\n                    vec3 mask = vec3(1.0 - pow(lum, 1.8));\n                    // invert blurred texture\n                    vec3 layer = vec3(1.0 - Lum(blurMap));\n                    vec3 detail = clamp(BlendVividLight(col, layer), 0.0, 1.0);\n                    // we get negative detail by inverting the detail layer\n                    vec3 inverse = mix(1.0 - detail, detail, (intensity+1.0)/2.0);\n                  \n                    gl_FragColor = vec4(BlendOverlay(base, mix(vec3(0.5), inverse, mask)), base4.a);       \n                }";e=this.compileShader(t),this.compiledProgram.set("clarity",e)}this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(e.uniform.amount,2*t),this.draw(e)}smooth(t){let e=this.compiledProgram.get("smooth");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n                uniform float m[9];\n                uniform float amount;\n\n                void main(void) {\n                    vec4 c11 = texture2D(texture, uv - px);\n                    vec4 c12 = texture2D(texture, vec2(uv.x, uv.y - px.y));\n                    vec4 c13 = texture2D(texture, vec2(uv.x + px.x, uv.y - px.y));\n\n                    vec4 c21 = texture2D(texture, vec2(uv.x - px.x, uv.y) );\n                    vec4 c22 = texture2D(texture, uv);\n                    vec4 c23 = texture2D(texture, vec2(uv.x + px.x, uv.y) );\n\n                    vec4 c31 = texture2D(texture, vec2(uv.x - px.x, uv.y + px.y) );\n                    vec4 c32 = texture2D(texture, vec2(uv.x, uv.y + px.y) );\n                    vec4 c33 = texture2D(texture, uv + px );\n\n                    vec4 color = \n                        c11 * m[0] + c12 * m[1] + c13 * m[2] +\n                        c21 * m[3] + c22 * m[4] + c23 * m[5] +\n                        c31 * m[6] + c32 * m[7] + c33 * m[8];\n\n                    gl_FragColor = color * amount + (c22 * (1.0 - amount));\n                }";e=this.compileShader(t),this.compiledProgram.set("smooth",e)}let s=new Float32Array([1/16,2/16,1/16,2/16,.25,2/16,1/16,2/16,1/16]);this.ctx.useProgram(e.program),this.ctx.uniform1fv(e.uniform.m,s),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}denoise(t){const e=Math.round(30*t[0]);let s=this.compiledProgram.get("denoise"+e);if(!s){let t="\n                precision mediump float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                \n                uniform float sigma;\n                uniform float threshold;\n                uniform vec2 resolution;\n\n                #define INV_SQRT_OF_2PI 0.39894228040143267793994605993439  // 1.0/SQRT_OF_2PI\n                #define INV_PI 0.31830988618379067153776752674503\n                #define RADIUS %radius%.0\n              \n                void main(void) {\n\n                       float invSigmaQx2 = .5 / (sigma * sigma);      // 1.0 / (sigma^2 * 2.0)\n                       float invSigmaQx2PI = INV_PI * invSigmaQx2;    // 1.0 / (sqrt(PI) * sigma)\n                       \n                       float invThresholdSqx2 = .5 / (threshold * threshold);     // 1.0 / (sigma^2 * 2.0)\n                       float invThresholdSqrt2PI = INV_SQRT_OF_2PI / threshold;   // 1.0 / (sqrt(2*PI) * sigma)\n                       \n                       vec4 center = texture2D(texture,uv); \n                       \n                       float zBuff = 0.0;\n                       vec4 aBuff = vec4(0.0);\n                       \n                       for(float x=-RADIUS; x <= RADIUS; x++) {\n                           float pt = sqrt(RADIUS*RADIUS-x*x);  // pt = yRadius: have circular trend\n                           for(float y=-RADIUS; y <= RADIUS; y++) {\n   \n                               if(y >= pt || y <= pt) {\n   \n                                   vec2 d = vec2(x,y)/resolution;\n                       \n                                   float blurFactor = exp( -dot(d , d) * invSigmaQx2 ) * invSigmaQx2;\n                                   \n                                   vec4 pxx =  texture2D(texture,uv+d);\n                       \n                                   vec4 dC = pxx-center;\n                                   float deltaFactor = exp( -dot(dC, dC) * invThresholdSqx2) * invThresholdSqrt2PI * blurFactor;\n                                                       \n                                   zBuff += deltaFactor;\n                                   aBuff += deltaFactor*pxx;\n                               }\n                           }\n                       }\n                       gl_FragColor = aBuff/zBuff;\n                } ";s=this.compileShader(t.replace(/%radius%/g,e.toString())),this.compiledProgram.set("denoise"+e,s)}this.ctx.useProgram(s.program),this.ctx.uniform1f(s.uniform.sigma,e/3),this.ctx.uniform1f(s.uniform.threshold,t[1]),this.ctx.uniform2f(s.uniform.resolution,this.width,this.height),this.draw(s)}colorMatrix(t){let e=new Float32Array(t);e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255;let s=this.compiledProgram.get("colormatrix");if(!s){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float m[20];\n\n                void main(void) {\n                    vec4 c = texture2D(texture, uv);\n                    gl_FragColor.r = m[0] * c.r + m[1] * c.g + m[2] * c.b + m[3] * c.a + m[4];\n                    gl_FragColor.g = m[5] * c.r + m[6] * c.g + m[7] * c.b + m[8] * c.a + m[9];\n                    gl_FragColor.b = m[10] * c.r + m[11] * c.g + m[12] * c.b + m[13] * c.a + m[14];\n                    gl_FragColor.a = m[15] * c.r + m[16] * c.g + m[17] * c.b + m[18] * c.a + m[19];\n                } ";s=this.compileShader(t),this.compiledProgram.set("colormatrix",s)}this.ctx.useProgram(s.program),this.ctx.uniform1fv(s.uniform.m,e),this.draw(s)}colorMatrixRange(t,e,s){let i=new Float32Array(t);i[4]/=255,i[9]/=255,i[14]/=255,i[19]/=255;let a=this.compiledProgram.get("colormatrix-range");if(!a){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float m[20];\n                uniform float from;\n                uniform float to;\n\n                vec3 rgb2hsv(vec3 c) {\n                    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n                    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n                    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n                \n                    float d = q.x - min(q.w, q.y);\n                    float e = 1.0e-10;\n                    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n                }\n\n                void main(void) {\n                    vec4 c = texture2D(texture, uv);\n                    vec3 hsv = rgb2hsv(c.rgb);\n\n                    gl_FragColor = c;\n\n                    if((hsv.x >= from && hsv.x <= to) || (to < from && (hsv.x >= from || hsv.x <= to))) {\n\n                        float blend = 1.0;\n                        float grad = 29.0/360.0;\n\n                        float distFrom = distance(hsv.x, from);\n                        float distTo = distance(hsv.x, to);\n\n                        if(distFrom <= grad) blend = distFrom / grad;\n                        if(distTo <= grad) blend = distTo / grad;\n\n                        vec4 b = vec4(\n                            m[0] * c.r + m[1] * c.g + m[2] * c.b + m[3] * c.a + m[4],\n                            m[5] * c.r + m[6] * c.g + m[7] * c.b + m[8] * c.a + m[9],\n                            m[10] * c.r + m[11] * c.g + m[12] * c.b + m[13] * c.a + m[14],\n                            m[15] * c.r + m[16] * c.g + m[17] * c.b + m[18] * c.a + m[19]);\n                        \n                        gl_FragColor = mix(c, b, blend);\n                    }\n                } ";a=this.compileShader(t),this.compiledProgram.set("colormatrix-range",a)}this.ctx.useProgram(a.program),this.ctx.uniform1fv(a.uniform.m,i),this.ctx.uniform1f(a.uniform.from,e/360),this.ctx.uniform1f(a.uniform.to,s/360),this.draw(a)}desaturate(){this.saturation(-1)}invert(){this.colorMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0])}contrast(t){let e=t+1,s=-128*(e-1);this.colorMatrix([e,0,0,0,s,0,e,0,0,s,0,0,e,0,s,0,0,0,1,0])}hue(t,e,s){let i=this.compiledProgram.get("hue"+(e?"-range":""));if(!i){let t="\n            precision highp float;\n            varying vec2 uv;\n            \n            uniform sampler2D texture;\n            uniform float rotation;\n            uniform float from;\n            uniform float to;\n            \n            vec3 rgb2hsv(vec3 c) {\n                vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n                vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n                vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n            \n                float d = q.x - min(q.w, q.y);\n                float e = 1.0e-10;\n                return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n            }\n            vec3 hsv2rgb(vec3 c) {\n                vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n                vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n                return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n            }";t+=e?"\n                void main() {\n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    vec3 hsv = rgb2hsv(base.rgb);\n\n                    gl_FragColor = base;\n\n                    if((hsv.x >= from && hsv.x <= to) || (to < from && (hsv.x >= from || hsv.x <= to))) {\n\n                        float blend = 1.0;\n                        float grad = 29.0/360.0;\n\n                        float distFrom = distance(hsv.x, from);\n                        float distTo = distance(hsv.x, to);\n\n                        if(distFrom <= grad) blend = distFrom / grad;\n                        if(distTo <= grad) blend = distTo / grad;\n                        \n                        hsv.x += rotation * blend;\n                        \n                        gl_FragColor.rgb = hsv2rgb(hsv);\n                    }\n                }":"\n                void main() {\n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    vec3 hsv = rgb2hsv(base.rgb);\n\n                    hsv.x += rotation;\n\n                    gl_FragColor = vec4(hsv2rgb(hsv), base.a);\n                }",i=this.compileShader(t),this.compiledProgram.set("hue"+(e?"-range":""),i)}this.ctx.useProgram(i.program),this.ctx.uniform1f(i.uniform.rotation,t/360),e&&(this.ctx.uniform1f(i.uniform.from,e/360),this.ctx.uniform1f(i.uniform.to,s/360)),this.draw(i)}saturation(t,e,s){let i=2*t/3+1,a=-.5*(i-1);e?this.colorMatrixRange([i,a,a,0,0,a,i,a,0,0,a,a,i,0,0,0,0,0,1,0],e,s):this.colorMatrix([i,a,a,0,0,a,i,a,0,0,a,a,i,0,0,0,0,0,1,0])}lightness(t,e,s){t*=255,e?this.colorMatrixRange([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0],e,s):this.colorMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0])}colorize(t){this.fill(new h.A(a.A.fromHSB(t,1,1),"color",1))}exposure(t){let e=this.compiledProgram.get("exposure");if(!e){let t=["#define GLSLIFY 1","precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","const float epsilon = 0.000001;","const float mx = 1.0 - epsilon;","const mat3 matRGBtoROMM = mat3(0.5293459296226501, 0.3300727903842926, 0.14058130979537964, 0.09837432950735092, 0.8734610080718994, 0.028164653107523918, 0.01688321679830551, 0.11767247319221497, 0.8654443025588989);","const mat3 matROMMtoRGB = mat3(2.0340757369995117, -0.727334201335907, -0.3067416846752167, -0.22881317138671875, 1.2317301034927368, -0.0029169507324695587, -0.008569774217903614, -0.1532866358757019, 1.1618564128875732);","float ramp(in float t){","t *= 2.0;","if (t >= 1.0) {","t -= 1.0;","t = log(0.5) / log(0.5*(1.0-t) + 0.9332*t);","}","return clamp(t, 0.001, 10.0);","}","vec3 rgb2hsv(in vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(in vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}","vec3 setHue(in vec3 res, in vec3 base) {","vec3 hsv = rgb2hsv(base);","vec3 res_hsv = rgb2hsv(res);","return hsv2rgb(vec3(hsv.x, res_hsv.y, res_hsv.z));","}","void main() {","lowp vec4 col = texture2D(texture, uv.xy);","vec3 base = col.rgb * matRGBtoROMM;","float a = abs(amount) * col.a + epsilon;","float v = pow(2.0, a*2.0+1.0)-2.0;","float m = mx - exp(-v);","vec3 res = (amount > 0.0) ? (1.0 - exp(-v*base)) / m : log(1.0-base*m) / -v;","res = mix(base, res, min(a*100.0, 1.0));","res = setHue(res, base);","res = pow(res, vec3(ramp(1.0 - (0.0 * col.a + 1.0) / 2.0)));","res = res * matROMMtoRGB;","gl_FragColor = vec4(res, col.a);","}"].join("\n");e=this.compileShader(t),this.compiledProgram.set("exposure",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}highlights(t){let e=this.compiledProgram.get("highlights");if(!e){let t=["#define GLSLIFY 1","precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","const float epsilon = 0.000001;","const float mx = 1.0 - epsilon;","const float PI = 3.1415926535897932384626433832795;","const mat3 matRGBtoROMM = mat3(0.5293459296226501, 0.3300727903842926, 0.14058130979537964, 0.09837432950735092, 0.8734610080718994, 0.028164653107523918, 0.01688321679830551, 0.11767247319221497, 0.8654443025588989);","const mat3 matROMMtoRGB = mat3(2.0340757369995117, -0.727334201335907, -0.3067416846752167, -0.22881317138671875, 1.2317301034927368, -0.0029169507324695587, -0.008569774217903614, -0.1532866358757019, 1.1618564128875732);","float luma_romm(in vec3 color){","return dot(color, vec3(0.242655, 0.755158, 0.002187));","}","float luma(in vec3 color){","return dot(color, vec3(0.298839, 0.586811, 0.11435));","}","vec3 rgb2hsv(in vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(in vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}","vec3 setHue(in vec3 res, in vec3 base) {","vec3 hsv = rgb2hsv(base);","vec3 res_hsv = rgb2hsv(res);","return hsv2rgb(vec3(hsv.x, res_hsv.y, res_hsv.z));","}","float gaussian(in float x) {","return 1.0 - exp(-PI*2.0*x*x);","}","void main() {","lowp vec4 col = texture2D(texture, uv.xy);","lowp vec3 map = col.rgb;","vec3 base = col.rgb * matRGBtoROMM;","float base_lum = luma(col.rgb);","float map_lum = luma_romm(map * matRGBtoROMM);","float exposure = mix(amount, 0.0, 1.0 - map_lum) * col.a;","float a = abs(exposure) * col.a + epsilon;","float v = pow(2.0, a+1.0)-2.0;","float m = mx - exp(-v);","vec3 res = (exposure > 0.0) ? (1.0 - exp(-v*base)) / m : log(1.0-base*m) / -v;","res = mix(base, res, min(a*100.0, 1.0));","res = setHue(res, base);","res = res * matROMMtoRGB;","gl_FragColor = vec4(res, col.a);","}"].join("\n");e=this.compileShader(t),this.compiledProgram.set("highlights",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}shadows(t){let e=this.compiledProgram.get("shadows");if(!e){let t=["#define GLSLIFY 1","precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","const float epsilon = 0.000001;","const float mx = 1.0 - epsilon;","const float PI = 3.1415926535897932384626433832795;","const mat3 matRGBtoROMM = mat3(0.5293459296226501, 0.3300727903842926, 0.14058130979537964, 0.09837432950735092, 0.8734610080718994, 0.028164653107523918, 0.01688321679830551, 0.11767247319221497, 0.8654443025588989);","const mat3 matROMMtoRGB = mat3(2.0340757369995117, -0.727334201335907, -0.3067416846752167, -0.22881317138671875, 1.2317301034927368, -0.0029169507324695587, -0.008569774217903614, -0.1532866358757019, 1.1618564128875732);","float luma_romm(in vec3 color){","return dot(color, vec3(0.242655, 0.755158, 0.002187));","}","float luma(in vec3 color){","return dot(color, vec3(0.298839, 0.586811, 0.11435));","}","vec3 rgb2hsv(in vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(in vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}","vec3 setHue(in vec3 res, in vec3 base) {","vec3 hsv = rgb2hsv(base);","vec3 res_hsv = rgb2hsv(res);","return hsv2rgb(vec3(hsv.x, res_hsv.y, res_hsv.z));","}","float gaussian(in float x) {","return 1.0 - exp(-PI*2.0*x*x);","}","void main() {","lowp vec4 col = texture2D(texture, uv.xy);","lowp vec3 map = col.rgb;","vec3 base = col.rgb * matRGBtoROMM;","float base_lum = luma(col.rgb);","float map_lum = luma_romm(map * matRGBtoROMM);","float exposure = mix(0.0, amount, 1.0 - map_lum) * col.a;","float a = abs(exposure) * col.a + epsilon;","float v = pow(2.0, a+1.0)-2.0;","float m = mx - exp(-v);","vec3 res = (exposure > 0.0) ? (1.0 - exp(-v*base)) / m : log(1.0-base*m) / -v;","res = mix(base, res, min(a*100.0, 1.0));","res = setHue(res, base);","res = res * matROMMtoRGB;","gl_FragColor = vec4(res, col.a);","}"].join("\n");e=this.compileShader(t),this.compiledProgram.set("shadows",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}dehaze(t){let e=this.compiledProgram.get("dehaze");if(!e){let t="\n\n                #define GLSLIFY 1;\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform float amount;  // -1.0 ~ 1.0\n\n                uniform vec2 size;\n\n                float hazeMap(vec4 base) {\n                    vec3 color = vec3(1.0, 1.0, 1.0);\n                    vec2 step = vec2(1.0 / size.xy);\n                    const int patchRadius = 1; // the half size for shift in 3 x 3 patch.\n                    for (int i = -patchRadius; i <= patchRadius; ++i) {\n                       for (int j = -patchRadius; j <= patchRadius; ++j) {\n                           vec2 uv = clamp(uv + (vec2(i, j) * step), 0.0, 1.0);\n                           color = min(color, base.rgb);\n                        }\n                    }\n                    return min(color.r, min(color.g, color.b));\n                }\n\n                void main() {\n                    \n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    lowp float haze = hazeMap(base);\n\n                    float transmission = 1.0 - 0.95 * haze;\n                    const float A = 0.95; //0.95 intensity. We can consider to collect 0.1% brightest pixel from the dark channel image.\n                    const float t0 = 0.1; //0.1 in the paper, we can increase it for solving the color bleeding.\n                    float t = mix(1.0, max(t0, transmission), amount);\n                    vec3 J = (base.rgb - A) / t + A;\n                    gl_FragColor = vec4(J, base.a);\n                }";e=this.compileShader(t),this.compiledProgram.set("dehaze",e)}this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.size,this.width,this.height),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}solarize(){this.paletteMap||(this.paletteMap=new ImageData(256,1));for(let t=0;t<256;++t){let e=255*(t/255>.5?2*(t/255-.5):2*(.5-t/255));e=e>255?255:e<0?0:e,this.paletteMap.data[4*t]=this.paletteMap.data[4*t+1]=this.paletteMap.data[4*t+2]=e}this.mapping(this.paletteMap)}monochrome(t){let e=this.compiledProgram.get("monochrome");if(!e){let t="\n            precision highp float;\n            varying vec2 uv;\n            \n            uniform sampler2D texture;\n\n            uniform float r;\n            uniform float g;\n            uniform float b;\n            \n            float luma(vec3 color) {\n                return dot(color, vec3(r, g, b));\n            }\n            void main() {\n                lowp vec4 base = texture2D(texture, uv.xy);\n                float avg = luma(base.rgb);\n\n                gl_FragColor = vec4(avg, avg, avg, base.a);\n            }";e=this.compileShader(t),this.compiledProgram.set("monochrome",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.r,t.r),this.ctx.uniform1f(e.uniform.g,t.g),this.ctx.uniform1f(e.uniform.b,t.b),this.draw(e)}curves(t){this.paletteMap||(this.paletteMap=new ImageData(256,1)),void 0!==t.preset&&(t=p.X.createCurveSet(t)),p.A.fillPaletteMap(t,this.paletteMap),this.mapping(this.paletteMap)}levels(t){this.paletteMap||(this.paletteMap=new ImageData(256,1)),u.A.fillPaletteMap(t,this.paletteMap),this.mapping(this.paletteMap)}multilevels(t){this.paletteMap||(this.paletteMap=new ImageData(256,1)),u.A.fillRGBPaletteMap(t[0].isFlat()?void 0:t[0],t[1].isFlat()?void 0:t[1],t[2].isFlat()?void 0:t[2],this.paletteMap),this.mapping(this.paletteMap)}mapping(t){let e=this.compiledProgram.get("mapping");if(!e){let t="\n                #define GLSLIFY 1\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform sampler2D paletteMap;\n\n                void main() {\n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    float r = texture2D(paletteMap, vec2(base.r, 0)).r;\n                    float g = texture2D(paletteMap, vec2(base.g, 0)).g;\n                    float b = texture2D(paletteMap, vec2(base.b, 0)).b;\n                    gl_FragColor = vec4(r, g, b, base.a);\n                }";e=this.compileShader(t),this.compiledProgram.set("mapping",e)}this.ctx.useProgram(e.program);let s=e.getTextureById("paletteMap");s.createTexture(this.ctx,t.width,t.height),s.uploadData(this.ctx,t),this.draw(e)}lookup(t){let e=this.compiledProgram.get("lookup");if(!e){let t="\n            precision highp float;\n            varying vec2 uv;\n\n            uniform sampler2D texture;\n            uniform sampler2D paletteMap;\n            \n            float luma(vec3 color) {\n                return dot(color, vec3(0.299, 0.587, 0.114));\n            }\n\n            void main() {\n                lowp vec4 base = texture2D(texture, uv.xy);\n                float avg = luma(base.rgb);\n                float r = texture2D(paletteMap, vec2(avg, 0)).r;\n                float g = texture2D(paletteMap, vec2(avg, 0)).g;\n                float b = texture2D(paletteMap, vec2(avg, 0)).b;\n                gl_FragColor = vec4(r, g, b, base.a);\n            }";e=this.compileShader(t),this.compiledProgram.set("lookup",e)}this.ctx.useProgram(e.program);let s=e.getTextureById("paletteMap");s.createTexture(this.ctx,t.width,t.height),s.uploadData(this.ctx,t),this.draw(e)}toning(t){this.paletteMap||(this.paletteMap=new ImageData(256,1)),c.A.fillPaletteMap(t,this.paletteMap);let e=this.compiledProgram.get("toning");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform sampler2D paletteMap;\n\n                uniform float amount;\n                \n                float luma(vec3 color) {\n                    return dot(color, vec3(0.299, 0.587, 0.114));\n                }\n\n                void main() {\n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    float avg = luma(base.rgb);\n                    float r = texture2D(paletteMap, vec2(avg, 0)).r;\n                    float g = texture2D(paletteMap, vec2(avg, 0)).g;\n                    float b = texture2D(paletteMap, vec2(avg, 0)).b;\n                    gl_FragColor = mix(base, vec4(r, g, b, base.a), amount);\n                }";e=this.compileShader(t),this.compiledProgram.set("toning",e)}this.ctx.useProgram(e.program);let s=e.getTextureById("paletteMap");s.createTexture(this.ctx,this.paletteMap.width,this.paletteMap.height),s.uploadData(this.ctx,this.paletteMap),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}fill(t){let e=this.compiledProgram.get("fill-"+t.blend);if(!e){let s="";switch(t.blend){case"color":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        vec3 blendColor(vec3 base, vec3 blend) {\n                            vec3 color = vec3(blend.rgb);\n                            base.r = base.r * 0.30 + base.g * 0.59 + base.b * 0.11;\n                            \n                            vec3 power = (color.r+color.g+color.b) * 0.3333 - color;\n                            base.rgb = pow(base.rrr, 1.0 + power);\n\n                            return base;\n                        }\n                        vec3 blendColor(vec3 base, vec3 blend, float opacity) {\n                            return (blendColor(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendColor(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"soft-light":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendSoftLight(float base, float blend) {\n                            return (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n                        }\n                        vec3 blendSoftLight(vec3 base, vec3 blend) {\n                            return vec3(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b));\n                        }\n                        vec3 blendSoftLight(vec3 base, vec3 blend, float opacity) {\n                            return (blendSoftLight(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendSoftLight(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"hard-light":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendOverlay(float base, float blend) {\n                            return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n                        }\n                        vec3 blendOverlay(vec3 base, vec3 blend) {\n                            return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n                        }\n                        vec3 blendHardLight(vec3 base, vec3 blend) {\n                            return blendOverlay(blend,base);\n                        }\n                        vec3 blendHardLight(vec3 base, vec3 blend, float opacity) {\n                            return (blendHardLight(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendHardLight(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"vivid-light":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendColorBurn(float base, float blend) {\n                            return (blend==0.0)?blend:max((1.0-((1.0-base)/blend)),0.0);\n                        }\n                        float blendColorDodge(float base, float blend) {\n                            return (blend==1.0)?blend:min(base/(1.0-blend),1.0);\n                        }\n                        float blendVividLight(float base, float blend) {\n                            return (blend<0.5)?blendColorBurn(base,(2.0*blend)):blendColorDodge(base,(2.0*(blend-0.5)));\n                        }\n                        vec3 blendVividLight(vec3 base, vec3 blend) {\n                            return vec3(blendVividLight(base.r,blend.r),blendVividLight(base.g,blend.g),blendVividLight(base.b,blend.b));\n                        }\n                        vec3 blendVividLight(vec3 base, vec3 blend, float opacity) {\n                            return (blendVividLight(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendVividLight(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"overlay":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendOverlay(float base, float blend) {\n                            return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n                        }\n                        vec3 blendOverlay(vec3 base, vec3 blend) {\n                            return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n                        }\n                        vec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n                            return (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendOverlay(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"multiply":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        vec3 blendMultiply(vec3 base, vec3 blend) {\n                            return base*blend;\n                        }\n                        vec3 blendMultiply(vec3 base, vec3 blend, float opacity) {\n                            return (blendMultiply(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendMultiply(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"color-dodge":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        float blendColorDodge(float base, float blend) {\n                            return (blend==1.0)?blend:min(base/(1.0-blend),1.0);\n                        }\n                        vec3 blendColorDodge(vec3 base, vec3 blend) {\n                            return vec3(blendColorDodge(base.r,blend.r),blendColorDodge(base.g,blend.g),blendColorDodge(base.b,blend.b));\n                        }\n                        vec3 blendColorDodge(vec3 base, vec3 blend, float opacity) {\n                            return (blendColorDodge(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendColorDodge(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"color-burn":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        float blendColorBurn(float base, float blend) {\n                            return (blend==0.0)?blend:max((1.0-((1.0-base)/blend)),0.0);\n                        }\n                        vec3 blendColorBurn(vec3 base, vec3 blend) {\n                            return vec3(blendColorBurn(base.r,blend.r),blendColorBurn(base.g,blend.g),blendColorBurn(base.b,blend.b));\n                        }\n                        vec3 blendColorBurn(vec3 base, vec3 blend, float opacity) {\n                            return (blendColorBurn(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendColorBurn(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"screen":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        float blendScreen(float base, float blend) {\n                            return 1.0-((1.0-base)*(1.0-blend));\n                        }\n                        vec3 blendScreen(vec3 base, vec3 blend) {\n                            return vec3(blendScreen(base.r,blend.r),blendScreen(base.g,blend.g),blendScreen(base.b,blend.b));\n                        }\n                        vec3 blendScreen(vec3 base, vec3 blend, float opacity) {\n                            return (blendScreen(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendScreen(base.rgb, color.rgb, amount), base.a);\n                        }";break;default:s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = mix(base, color, amount);\n                        }"}e=this.compileShader(s),this.compiledProgram.set("fill-"+t.blend,e)}this.ctx.useProgram(e.program),this.ctx.uniform4f(e.uniform.color,t.color.r/255,t.color.g/255,t.color.b/255,1),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}glamour(t){let e=this.compiledProgram.get("glamour");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 px;\n\n                float normpdf(in float x, in float sigma) {\n                    return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;\n                }\n\n                vec3 blurMap() {\n                    //declare stuff\n                    const int mSize = 11;\n                    const int kSize = (mSize-1)/2;\n                    float kernel[mSize];\n                    vec3 final_colour = vec3(0.0);\n                    \n                    //create the 1-D kernel\n                    float sigma = 7.0;\n                    float Z = 0.0;\n                    for (int j = 0; j <= kSize; ++j){\n                        kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), sigma);\n                    }\n                    \n                    //get the normalization factor (as the gaussian has been clamped)\n                    for (int j = 0; j < mSize; ++j){\n                        Z += kernel[j];\n                    }\n                    \n                    //read out the texels\n                    for (int i=-kSize; i <= kSize; ++i){\n                        for (int j=-kSize; j <= kSize; ++j){\n                            final_colour += kernel[kSize+j] * kernel[kSize+i] * texture2D(texture, (uv.xy + vec2(float(i),float(j))*px)).rgb;\n                        }\n                    }\n                    return vec3(final_colour/(Z*Z));\n                }\n\n                float luma(vec3 color) {\n                    return dot(color, vec3(0.299, 0.587, 0.114));\n                }\n\n                void main() {\n                    \n                    vec4 base = texture2D(texture, uv);\n                    vec3 color = blurMap();\n                    \n                    color = vec3(luma(color));\n\n                    color = vec3(\n                        (base.r <= 0.5) ? (2.0 * base.r * color.r) : (1.0 - 2.0 * (1.0 - base.r) * (1.0 - color.r)),\n                        (base.g <= 0.5) ? (2.0 * base.g * color.g) : (1.0 - 2.0 * (1.0 - base.g) * (1.0 - color.g)),\n                        (base.b <= 0.5) ? (2.0 * base.b * color.b) : (1.0 - 2.0 * (1.0 - base.b) * (1.0 - color.b))\n                    );\n                \n                    gl_FragColor = mix(base, vec4(color, base.a), amount);\n                }";e=this.compileShader(t),this.compiledProgram.set("glamour",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.draw(e)}kaleidoscope(t){let e=this.compiledProgram.get("kaleidoscope");if(!e){let t="\n                precision mediump float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n\n                uniform sampler2D texture;\n                uniform vec2 resolution;\n\n                uniform float u_stretch;\n                uniform float u_position;\n                uniform float u_amount;\n\n                int modwhole(float a, float b) {\n                    float m = mod(a, b);\n\n                    return int (m+.5);\n                }\n\n                void main(void) {\n                    int numOfAxis = int(u_amount);\n                    float angleFrac = (2. * PI) / float ( 2 * numOfAxis);\n\n                    vec2 uvc = uv;\n                    uvc -= .5;\n\n                    // Convert to Polar\n                    float phi = abs(atan(uvc.x, uvc.y));\n                    float r = length(uvc);\n\n                    int count = int(phi / angleFrac);\n\n                    phi = mod(phi, angleFrac);\n                    if (modwhole (float(count), 2.) == 1) {\n                        phi = angleFrac - phi;\n                    }\n\n                    // from polar coordiantes\n                    float x = r * cos(phi);\n                    float y = r * sin(phi);\n\n                    float stretch = 1. + (1. - u_stretch);\n                    float position = u_position * PI * .5;\n\n                    uvc = vec2(x, y) * stretch + sin(position);\n\n                    if (uvc.x < 0.) uvc.x += 1.;\n                    if (uvc.x > 1.) uvc.x -= 1.;\n                \n                    if (uvc.y < 0.) uvc.y += 1.;\n                    if (uvc.y > 1.) uvc.y -= 1.;\n\n                    gl_FragColor = texture2D (texture, uvc);\n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("kaleidoscope",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.u_amount,t.amount),this.ctx.uniform1f(e.uniform.u_stretch,t.stretch),this.ctx.uniform1f(e.uniform.u_position,t.position),this.ctx.uniform2f(e.uniform.resolution,this.width,this.height),this.draw(e)}polarcoordinates(t){let e=this.compiledProgram.get("polarcoordinates");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n                #define PI_2 6.2831\n\n                uniform sampler2D texture;\n                uniform int flip;\n                uniform float overlap;\n                uniform float rotate;\n                uniform vec2 resolution;\n                uniform int symmetry;\n\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                vec2 squareImage(vec2 uv) {\n                    // Aspect Ratio\n                    float ar = resolution.x / resolution.y;\n\n                    // Square the image at the center if rectangular\n                    if (symmetry == 1) {\n                        if (resolution.x > resolution.y) {\n                            float leftEdge = (1.0-1.0/ar) * 0.5;\n                            float rightEdge = 1.0 - leftEdge;\n\n                            if (uv.x < leftEdge) {\n                                uv = vec2(0, uv.y); // Fill in the left edge\n                            } else if (uv.x > rightEdge) {\n                                uv = vec2(1, uv.y); // Fill in the right edge\n                            }\n                            else {\n                                uv.x -= leftEdge; // Square the image on X\n                                uv.x *= ar;\n                            }\n                        } else if (resolution.y > resolution.x) {\n                            float bottomEdge = (1.0-ar) * 0.5;\n                            float topEdge = 1.0 - bottomEdge;\n\n                            if (uv.y < bottomEdge) {\n                                uv = vec2(uv.x, 0); // Fill in the bottom edge\n                            } else if (uv.y > topEdge) {\n                                uv = vec2(uv.x, 1); // Fill in the top edge\n                            }\n                            else {\n                                uv.y -= bottomEdge; // Square the image on Y\n                                uv.y /= ar;\n                            }\n                        }\n                    }\n                    return uv;\n                }\n\n                void main(void) {           \n                    // Square the image\n                    vec2 uvc = squareImage(uv);\n\n                    // Bring uv coordinates to center 0.5\n                    uvc = uvc-0.5;\n\n                    // Rotate uv by angle\n                    uvc = rotate2d( rotate ) * uvc;\n\n                    // Cartesian to polar\n                    float r = length(uvc) * 2.0;\n                    float a = atan(uvc.x, uvc.y);\n\n                    // Move from -PI -> PI to 0 -> 1\n                    vec2 uvp = vec2(a / (PI_2 + overlap) + 0.5, r);\n\n                    // Flip the image by 180 degrees\n                    uvp = flip == 1 ? 1.0 - uvp : uvp;\n\n                    // Compute color\n                    gl_FragColor = texture2D(texture, uvp);\n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("polarcoordinates",e)}this.ctx.useProgram(e.program),this.ctx.uniform1i(e.uniform.flip,t.flip?1:0),this.ctx.uniform1i(e.uniform.symmetry,t.symmetry?1:0),this.ctx.uniform1f(e.uniform.overlap,t.overlap),this.ctx.uniform1f(e.uniform.rotate,t.rotate),this.ctx.uniform2f(e.uniform.resolution,this.width,this.height),this.draw(e)}fisheye(t){let e=this.compiledProgram.get("fisheye");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n\n                uniform sampler2D texture;\n                uniform vec2 center;\n                uniform float amount;\n                uniform float aperture;\n                uniform int edgeFill;\n                uniform vec2 resolution;\n\n                vec2 edgeFillReflect(vec2 uvc) {\n                    if (uvc.x < 0.) uvc.x = -uvc.x;\n                    if (uvc.y < 0.) uvc.y = -uvc.y;\n                    if (uvc.x > 1.) uvc.x = 2. - uvc.x;\n                    if (uvc.y > 1.) uvc.y = 2. - uvc.y;\n\n                    return uvc;\n                }\n\n                vec2 edgeFillRepeat(vec2 uvc) {\n                    if (uvc.x < 0.) uvc.x = 1. + uvc.x;\n                    if (uvc.y < 0.) uvc.y = 1. + uvc.y;\n                    if (uvc.x > 1.) uvc.x = uvc.x - 1.;\n                    if (uvc.y > 1.) uvc.y = uvc.y - 1.;\n\n                    return uvc;\n                }\n\n                int edgeFillNone(vec2 uvc) {\n                    if (uvc.x < 0. || uvc.y < 0. || uvc.x > 1. || uvc.y > 1.) {\n                        return 1;\n                    }\n                    return 0;\n                }\n\n                void main(void) {\n\n                    // Normalized device space i.e. range of [-1, 1]\n                    vec2 ndcPos = uv * 2. - center * 2.;\n\n                    // Aspect ratio of the viewport\n                    float aspect = resolution.x / resolution.y;\n\n                    // Relationship between the radius of the perimeter circle (r or half_dist) and\n                    // the angle (eye_angle): \n                    // Bisect the isosceles triangle\n                    float eye_angle = abs(aperture);\n                    float half_angle = eye_angle / 2.;\n                    float half_dist = tan(half_angle);\n\n                    // With the aspect ratio of the viewport (aspect)\n                    vec2 vp_scale = vec2(aspect, 1.);\n                    vec2 P = ndcPos * vp_scale;\n\n                    // Diameter or the length of the viewport\n                    float vp_dia = length(vp_scale);\n\n                    // Relative distance to the center of the viewport\n                    float rel_dist = length(P) / vp_dia;\n\n                    // Relative position of the point P in relation to the aspect ratio\n                    vec2 rel_P = normalize(P) / normalize(vp_scale);\n\n                    vec2 pos_prj = ndcPos;\n                    if (aperture > 0.) {\n                        // Projection from spherical surface to the place\n                        float beta = rel_dist * half_angle;\n                        pos_prj = rel_P * tan(beta) / half_angle * pow(.9, amount * 5.);\n                    } else if (aperture < 0.) {\n                        // Projection from the plane to the spherical surface\n                        float beta = atan(rel_dist * half_dist);\n                        pos_prj = rel_P * beta / half_angle * pow(.9, amount * 5.);\n                    }\n\n                    vec2 uv_prj = pos_prj * .5 + center;\n\n                    // Return transparent if no edge fill\n                    if (edgeFill == 0) {\n                        if (edgeFillNone(uv_prj) == 1) {\n                            discard;\n                        }\n                    }\n                    if (edgeFill == 1) {\n                        uv_prj = edgeFillReflect(uv_prj);\n                    } \n                    if (edgeFill == 2) {\n                        uv_prj = edgeFillRepeat(uv_prj);\n                    }\n\n                    gl_FragColor = texture2D(texture, uv_prj);\n                }";e=this.compileShader(t),this.compiledProgram.set("fisheye",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t.amount),this.ctx.uniform1f(e.uniform.aperture,t.aperture),this.ctx.uniform2f(e.uniform.center,t.x,t.y),this.ctx.uniform1i(e.uniform.edgeFill,t.edgeFill),this.ctx.uniform2f(e.uniform.resolution,this.width,this.height),this.draw(e)}wave(t){let e=this.compiledProgram.get("wave");if(!e){let t="\n                precision mediump float;\n                uniform int type;\n                uniform float amplitude;\n                uniform float scale;\n                varying vec2 uv;\n                uniform int edgeApprox;\n                // uniform vec2 resolution;\n                uniform sampler2D texture;\n                uniform float rotate;\n                #define PI 3.14159265359\n\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                float cot(float angle) {\n                    return cos(angle) / sin(angle);\n                }\n\n                float sinewave(float rad) {\n                    return amplitude * sin(scale * 2. * PI * rad);\n                }\n\n                float trianglewave(float rad) {\n                    return amplitude * 2. / PI * asin(sin(scale * 2. * PI * rad));\n                }\n\n                float squarewave(float rad) {\n                    return amplitude * sign(sin(scale * 2. * PI * rad));\n                }\n\n                void main() {\n                    vec2 uvc = uv;\n\n                    uvc -= 0.5;\n                    uvc = rotate2d(-rotate) * uvc;\n\n                    if (type == 0) {\n                        // sine wave\n                        uvc.y = sinewave(uvc.x) + uvc.y;\n                    } else if (type == 1) {\n                        // triangular wave\n                        uvc.y = trianglewave(uvc.x) + uvc.y;\n                    } else if (type == 2) {\n                        // square wave\n                        uvc.y = squarewave(uvc.x) + uvc.y;\n                    } else {\n                        // sawtooth wave\n                        // uvc.y = amplitude * 2. / PI * atan(cot(scale * 2. * PI * uvc.x));\n                    }\n                    \n                    uvc = rotate2d(rotate) * uvc;\n                    uvc += 0.5;\n                    \n                    // Clamp\n                    // uvc = clamp(uvc, 0., 1.);\n\n                    if (edgeApprox == 2) {\n                        // Repeat acros the edges with the opposite side color\n                        if (uvc.x < 0.) uvc.x = 1. + uvc.x;\n                        if (uvc.y < 0.) uvc.y = 1. + uvc.y;\n                        if (uvc.x > 1.) uvc.x = uvc.x - 1.;\n                        if (uvc.y > 1.) uvc.y = uvc.y - 1.;\n                    } else if (edgeApprox == 1) {\n                        // Approximate (natural) around the edges with the reflection color\n                        if (uvc.x < 0.) uvc.x = -uvc.x;\n                        if (uvc.y < 0.) uvc.y = -uvc.y;\n                        if (uvc.x > 1.) uvc.x = 2. - uvc.x;\n                        if (uvc.y > 1.) uvc.y = 2. - uvc.y;    \n                    } else {\n                        // Don't approximate, render transparent\n                        if (uvc.x < 0. || uvc.x > 1. || \n                            uvc.y < 0. || uvc.y > 1.) {\n                            gl_FragColor = vec4 (0.0, 0.0, 0.0, 0.0);\n                            return;\n                        }    \n                    }\n\n                    gl_FragColor = texture2D(texture, uvc);\n                    return;\n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("wave",e)}this.ctx.useProgram(e.program),this.ctx.uniform1i(e.uniform.type,t.type),this.ctx.uniform1f(e.uniform.amplitude,t.amplitude),this.ctx.uniform1f(e.uniform.scale,t.scale),this.ctx.uniform1f(e.uniform.rotate,t.rotate),this.ctx.uniform1i(e.uniform.edgeApprox,t.edgeApprox),this.draw(e)}reflect(t){let e=this.compiledProgram.get("reflect");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n                #define PI_2 6.2831\n\n                uniform sampler2D texture;\n                uniform int type;\n                uniform vec2 resolution;\n                uniform vec2 center;\n                uniform vec2 offset;\n\n                // constant integers for directions\n                const int RIGHT = 1, LEFT = -1, ZERO = 0;\n\n                const float ALMOST_ZERO = 0.00001;\n\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                vec2 squareImage(vec2 uv) {\n                    // return uv;\n\n                    float ar = resolution.x / resolution.y;\n\n                    if (resolution.x > resolution.y) {\n                        uv.y /= ar;\n                    }\n                    else {\n                        uv.x *= ar;\n                    }\n                    return uv;\n                }\n\n                vec2 squareImagereverse(vec2 uv) {\n                    float ar = resolution.x / resolution.y;\n\n                    if (resolution.x > resolution.y) {\n                        uv.y /= ar;\n                        uv.y += (1. - 1./ar) * 0.5;\n                    }\n                    else {\n                        uv.x *= ar;\n                        uv.x += (1. - ar) * 0.5;\n                    }\n                    return uv;\n                }\n\n                int direction(vec2 A, vec2 B, vec2 P) {\n                    // subtracting co-ordinates of point A from\n                    // B and P, to make A as origin\n                    B.x -= A.x;\n                    B.y -= A.y;\n                    P.x -= A.x;\n                    P.y -= A.y;\n                \n                    // Determining cross Product\n                    float cross_product = B.x * P.y - B.y * P.x;\n                \n                    // return RIGHT if cross product is positive\n                    if (cross_product > ALMOST_ZERO)\n                        return LEFT;\n                \n                    // return LEFT if cross product is negative\n                    if (cross_product < -ALMOST_ZERO)\n                        return RIGHT;\n                \n                    // return ZERO if cross product is zero.\n                    return ZERO;\n                }\n                \n                vec2 reflectmagic(vec2 uvc, int reflectfrom, mat2 transf, vec2 A, vec2 B, vec2 center) {\n\n                    vec2 cent = center - 0.5;\n                    uvc -= center;\n\n                    int dircent = direction(A, B, cent);\n                    int diruv = direction(A, B, uvc);\n\n                    uvc = dircent >= ZERO && diruv >= ZERO || dircent == LEFT && diruv == LEFT ? transf * uvc : uvc;\n\n                    uvc += center;\n\n                    uvc -= 0.5;\n\n                    if (reflectfrom == LEFT) {\n                        uvc = dircent >= ZERO ? uvc : transf * uvc;\n                    } else {\n                        uvc = dircent == LEFT ? uvc : transf * uvc;\n                    }\n\n                    uvc += 0.5;\n\n                    return uvc;\n                }\n\n                vec2 reflectx(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(-1., 0., 0., 1.);     \n\n                    vec2 A = vec2 (0., -1.);\n                    vec2 B = vec2 (0., 1.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, center);\n                }\n\n                vec2 reflecty(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(1., 0., 0., -1.);    \n\n                    vec2 A = vec2 (-1., 0.);\n                    vec2 B = vec2 (1., 0.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, center);\n                }\n\n                vec2 reflectxequalminusy(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(0., 1., 1., 0.);\n\n                    vec2 A = vec2 (-1., -1.);\n                    vec2 B = vec2 (1., 1.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, vec2(center.x, 1.-center.x));\n                }\n\n                vec2 reflectxequaly(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(0., -1., -1., 0.);\n\n                    vec2 A = vec2 (-1., 1.);\n                    vec2 B = vec2 (1., -1.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, vec2(center.x, center.x));\n                }\n\n                vec2 reflect(vec2 uvc) {\n                    //reflect-type-minus-x\n                    if (type == 1) {\n                        uvc = reflectx(uvc, LEFT);\n                    }\n                    //reflect-type-minus-y\n                    else if (type == 2) {\n                        uvc = reflecty(uvc, LEFT);\n                    }\n                    //reflect-type-plus-x\n                    if (type == 3) {\n                        uvc = reflectx(uvc, RIGHT);\n                    }\n                    //reflect-type-plus-y\n                    else if (type == 4) {\n                        uvc = reflecty(uvc, RIGHT);\n                    }\n                    //reflect-type-minus-x-minus-y\n                    else if (type == 5) {\n                        uvc = reflectx(uvc, LEFT);\n                        uvc = reflecty(uvc, LEFT);\n                    }\n                    //reflect-type-minus-x-plus-y\n                    else if (type == 6) {\n                        uvc = reflectx(uvc, LEFT);\n                        uvc = reflecty(uvc, RIGHT);\n                    }\n                    //reflect-type-plus-x-plus-y\n                    else if (type == 7) {\n                        uvc = reflectx(uvc, RIGHT);\n                        uvc = reflecty(uvc, RIGHT);\n                    }\n                    //reflect-type-plus-x-minus-y\n                    else if (type == 8) {\n                        uvc = reflectx(uvc, RIGHT);\n                        uvc = reflecty(uvc, LEFT);\n                    }\n                    //reflect-type-above-x-equalto-y\n                    else if (type == 9) {\n                        uvc = reflectxequalminusy(uvc, LEFT);\n                    }\n                    // reflect-type-below-x-equalto-minus-y\n                    else if (type == 10) {\n                        uvc = reflectxequaly(uvc, RIGHT);\n                    }\n                    // reflect-type-above-x-equalto-minus-y\n                    else if (type == 11) {\n                        uvc = reflectxequaly(uvc, LEFT);\n                    }\n                    // reflect-type-below-x-equalto-y\n                    else if (type == 12) {\n                        uvc = reflectxequalminusy(uvc, RIGHT);\n                    }\n                    return uvc;\n                }\n\n                void main(void) {\n                    vec2 uvc = reflect(uv) - offset;\n                    gl_FragColor = texture2D(texture, uvc);\n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("reflect",e)}this.ctx.useProgram(e.program),this.ctx.uniform1i(e.uniform.type,t.type),this.ctx.uniform2f(e.uniform.center,t.x,t.y),this.ctx.uniform2f(e.uniform.offset,t.xo,t.yo),this.ctx.uniform2f(e.uniform.resolution,this.width,this.height),this.draw(e)}bloom(t){let e=this.compiledProgram.get("bloom");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 px;\n                float thresh = .5;\n                \n                void main() {\n                    vec4 sum = vec4(0);\n                \n                    // mess of for loops due to gpu compiler/hardware limitations\n                    int j=-2;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=-1;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=0;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=1;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=2;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    sum/=25.0;\n                \n                    gl_FragColor= texture2D(texture, uv);\n                \n                    // use the blurred colour if it's bright enough\n                    if (length(sum) > thresh) {\n                        gl_FragColor += sum*amount;\n                    }\n                }";e=this.compileShader(t),this.compiledProgram.set("bloom",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.draw(e)}posterize(t){let e=this.compiledProgram.get("posterize");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                float areas = 256.0 / amount;\n                float values = 255.0 / (amount - 1.0);\n                \n                void main() {\n                    vec4 px = texture2D(texture, uv);\n\n                    px.r = floor(values * floor((px.r*255.0) / areas))/255.0;\n                    px.g = floor(values * floor((px.g*255.0) / areas))/255.0;\n                    px.b = floor(values * floor((px.b*255.0) / areas))/255.0;\n\n                    gl_FragColor = px;\n                }";e=this.compileShader(t),this.compiledProgram.set("posterize",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,100*t+1),this.draw(e)}fringe(t){let e=this.compiledProgram.get("fringe");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 amount;\n\n                void main() {\n                    vec2 dir = uv - vec2( .5 );\n                    float d = .7 * length( dir );\n                    normalize( dir );\n                    vec2 value = d * dir * amount;\n                \n                    vec4 c1 = texture2D( texture, uv - value);\n                    vec4 c2 = texture2D( texture, uv );\n                    vec4 c3 = texture2D( texture, uv + value);\n                    \n                    gl_FragColor = vec4( c1.r, c2.g, c3.b, c1.a + c2.a + c3.b);\n                }";e=this.compileShader(t),this.compiledProgram.set("fringe",e)}this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.amount,t,t),this.draw(e)}rgbSplit(t){let e=0,s=0,i=0;const a=t.distance;switch(t.type){case"red-blue":e=a,i=-a;break;case"green-red":e=-a,s=a;break;case"blue-green":s=-a,i=a;break;case"red":e=a;break;case"green":s=a;break;case"blue":i=a}let n=this.compiledProgram.get("rgb-split");if(!n){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                uniform vec2 r;\n                uniform vec2 g;\n                uniform vec2 b;\n\n                void main() {\n                \n                    vec4 px = texture2D(texture, uv);\n\n                    vec4 c1 = texture2D( texture, uv - r);\n                    vec4 c2 = texture2D( texture, uv - g);\n                    vec4 c3 = texture2D( texture, uv - b);\n                    \n                    gl_FragColor = mix(px, vec4( c1.r, c2.g, c3.b, (c1.a + c2.a + c3.a)/3.0), amount);\n                }";n=this.compileShader(t),this.compiledProgram.set("rgb-split",n)}this.ctx.useProgram(n.program),this.ctx.uniform1f(n.uniform.amount,t.amount);var o=t.direction*Math.PI/180,r=Math.cos(o),h=Math.sin(o);this.ctx.uniform2f(n.uniform.r,r*e,h*e),this.ctx.uniform2f(n.uniform.g,r*s,h*s),this.ctx.uniform2f(n.uniform.b,r*i,h*i),this.draw(n)}interference(t){let e=this.compiledProgram.get("interference");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float seed;\n                uniform float amount;\n                uniform int direction;\n\n                float rand(vec2 co){\n                    return fract(sin(dot(co.xy, vec2(12.9898,78.233)*3.141)) * 43758.5453);\n                }\n\n                void main() {\n\n                    float rand1 = rand(vec2(seed,seed));\n                    float rand2 = rand(vec2(seed,rand1));\n                \n                    float rand1xy = rand(vec2(rand1*uv.x,rand2*uv.y));\n                    float rand2xy = rand(vec2(rand1*uv.y,rand2*uv.x));\n                  \n                    float rand1x = rand(vec2(rand1*uv.x,rand2));\n                    float rand2x = rand(vec2(rand1x,rand1x));     \n\n                    float rand1y = rand(vec2(rand1*uv.y,rand2));\n                    float rand2y = rand(vec2(rand1y,rand1y));                       \n                    \n                    if(direction == 0) {\n                        if(rand2y/100.0 > rand1y) {\n                            if(rand2xy < 0.3) gl_FragColor = vec4(rand1xy, rand1xy, rand1xy, 0.0);\n                            else gl_FragColor = texture2D(texture, uv);\n                        }\n                        else {\n                            gl_FragColor = texture2D(texture, vec2(uv.x + rand1y * amount, uv.y));\n                        }\n                    } else {\n                        if(rand2x/100.0 > rand1x) {\n                            if(rand2xy < 0.3) gl_FragColor = vec4(rand1xy, rand1xy, rand1xy, 0.0);\n                            else gl_FragColor = texture2D(texture, uv);\n                        }\n                        else {\n                            gl_FragColor = texture2D(texture, vec2(uv.x, uv.y + rand1x * amount));\n                        }\n                    }\n                }";e=this.compileShader(t),this.compiledProgram.set("interference",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.seed,t.seed),this.ctx.uniform1f(e.uniform.amount,t.amount/15),this.ctx.uniform1i(e.uniform.direction,t.direction?1:0),this.draw(e)}bleed(t){let e=this.compiledProgram.get("bleed");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float seed;\n                uniform float block;\n                uniform float amplitude;\n              \n                float rand(vec2 n) { \n                    return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n                }\n                float randomRange (in vec2 sd, in float min, in float max) {\n                    return min + rand(sd) * (max - min);\n                }\n                float insideRange(float v, float bottom, float top) {\n                   return step(bottom, v) - step(top, v);\n                }\n\n                float noise(vec2 uv, float blockiness){   \n                    vec2 lv = fract(uv);\n                    vec2 id = floor(uv);\n                    \n                    float n1 = rand(id);\n                    float n2 = rand(id+vec2(1,0));\n                    float n3 = rand(id+vec2(0,1));\n                    float n4 = rand(id+vec2(1,1));\n                    \n                    vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);\n\n                    return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);\n                }\n\n                float fbm(vec2 uv, int count, float blockiness, float complexity) {\n                    float val = 0.0;\n                    float amp = 0.5;\n                    \n                    for (int i = 0; i < 1000; i++) {\n                        if(i == count) break;\n                        \n                        val += amp * noise(uv, blockiness);\n                        amp *= 0.5;\n                        uv *= complexity;    \n                    }  \n                    return val;\n                }\n\n                const float shift = 2.0; //2\n\n                void main()\n                {\n                    vec4 px = texture2D(texture, uv);\n\n                    for (float i = 0.0; i < 20.0; i += 1.0) {\n\n                        float sliceY = rand(vec2(seed, 2035.0 + float(i)));\n                        float sliceX = rand(vec2(seed, 3234.0 + float(i)));\n\n                        float sliceH = rand(vec2(seed, 2035.0 - float(i))) * 0.1;\n                        float sliceW = rand(vec2(seed, 3234.0 + float(i))) * 1.5;\n\n                        if(insideRange(uv.y, sliceY, fract(sliceY+sliceH)) == 1.0 && insideRange(uv.x, sliceX, fract(sliceX+sliceW)) == 1.0){\n                           \n                            vec2 id = floor(uv * 5.0);\n        \n                            // Generate shift amplitude\n                            float shift = amplitude * fbm(uv, int(id * 6.), shift, block);\n                            //float shift = randomRange(vec2(seed, 5234.0 + float(i)), -amplitude, amplitude);\n        \n                            float r = texture2D(texture, vec2(uv.x + shift, uv.y)).r * (1. - shift) ;\n                            float g = texture2D(texture, vec2(uv.x - shift, uv.y)).g * (1. - shift) + rand(id) * shift;\n                            float b = texture2D(texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);\n        \n                            px = mix(vec4(r, g, b, px.a), px, 0.5);\n                        }\n                        gl_FragColor = px;\n                    }\n                }";e=this.compileShader(t),this.compiledProgram.set("bleed",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.seed,t.seed),this.ctx.uniform1f(e.uniform.amplitude,t.amplitude),this.ctx.uniform1f(e.uniform.block,t.block),this.draw(e)}slice(t){let e=this.compiledProgram.get("slice");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float seed;\n                uniform float amount;\n                uniform float distance;\n                uniform int line;\n\n                //2D (returns 0 - 1)\n                float random2d(vec2 n) { \n                    return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n                }\n                float randomRange (in vec2 sd, in float min, in float max) {\n                    return min + random2d(sd) * (max - min);\n                }\n                \n                // return 1 if v inside 1d range\n                float insideRange(float v, float bottom, float top) {\n                   return step(bottom, v) - step(top, v);\n                }\n                  \n                void main() {\n                  \n                    vec4 px = texture2D(texture, uv);\n\n                    for (float i = 0.0; i < 100.0; i += 1.0) {\n\n                        if(i == amount) break;\n\n                        float sliceY = random2d(vec2(seed, 2035.0 + float(i)));\n                        float sliceX = random2d(vec2(seed, 5234.0 + float(i)));\n\n                        float sliceH = random2d(vec2(seed, 2035.0 - float(i))) * 0.1;\n                        float sliceW = random2d(vec2(seed, 5234.0 + float(i))) * 1.5;\n\n                        float hOffset = randomRange(vec2(seed, 2035.0 + float(i)), -distance*.5, distance*.5);\n                        float wOffset = randomRange(vec2(seed, 5234.0 + float(i)), -distance, distance);\n\n                        vec2 uvOff = uv;\n                        uvOff.x += wOffset;\n                        uvOff.y += hOffset;\n\n                        if(insideRange(uv.y, sliceY, fract(sliceY+sliceH)) == 1.0 && (line == 1 || insideRange(uv.x, sliceX, fract(sliceX+sliceW)) == 1.0)){\n                            px = texture2D(texture, uvOff);\n                        }\n                    }\n                    gl_FragColor = px;\n                }";e=this.compileShader(t),this.compiledProgram.set("slice",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.seed,t.seed),this.ctx.uniform1f(e.uniform.amount,t.amount),this.ctx.uniform1f(e.uniform.distance,t.distance/3),this.ctx.uniform1i(e.uniform.line,t.line?1:0),this.draw(e)}mimicHDR(t){let e=this.compiledProgram.get("mimicHDR");if(!e){const t="\n                precision highp float;\n\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform sampler2D blurMap;\n\n                uniform float amount;\n                uniform float contra;\n                \n                float blendSoftLight(float base, float blend) {\n                    return (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n                }\n                vec4 blendSoftLight(vec4 base, vec4 blend) {\n                    return vec4(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b), base.a);\n                }\n\n                float blendOverlay(float base, float blend) {\n                    return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n                }\n                vec4 blendOverlay(vec4 base, vec4 blend) {\n                    return vec4(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b), base.a);\n                }\n               \n                void main() {\n                    vec4 px = texture2D(texture, uv);\n                    vec4 blur = texture2D(blurMap, uv);\n\n                    vec4 blend = blendOverlay(px, blur);\n                    blend = mix(blend, blendSoftLight(px, blend), contra);\n\n                    gl_FragColor = mix(px, blend, amount);\n                }";e=this.compileShader(t),this.compiledProgram.set("mimicHDR",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t.amount),this.ctx.uniform1f(e.uniform.contra,t.contra);let s=e.getTextureById("blurMap");s.createTexture(this.ctx,t.blurMap.width,t.blurMap.height),s.uploadData(this.ctx,t.blurMap),this.draw(e)}pixelate(t){let e=this.compiledProgram.get("pixelate");if(!e){const t="\n                precision highp float;\n                varying vec2 uv;\n                uniform vec2 resolution;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    float d = 1.0 / amount;\n                    float ar = resolution.x / resolution.y;\n                    float u = floor( uv.x / d ) * d + d*0.5;\n                    d = ar / amount;\n                    float v = floor( uv.y / d ) * d + d*0.5;\n                    gl_FragColor = texture2D(texture, vec2( u, v ) );\n                }";e=this.compileShader(t),this.compiledProgram.set("pixelate",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,4*(100-100*t)),this.ctx.uniform2f(e.uniform.resolution,this.width,this.height),this.draw(e)}scanlines(t){let e=this.compiledProgram.get("scanlines");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform float size;\n\n                uniform int colorize;\n                uniform int direction;\n\n                void main() {\n                    \n                    vec2 sl;\n                    vec4 scanlines;\n                    vec4 color = texture2D(texture, uv);\n\n                    if(direction == 0) {\n                        sl = vec2(sin(uv.y * size), cos(uv.y * size)) * amount;\n                    }\n                    else {\n                        sl = vec2(sin(uv.x * size), cos(uv.x * size)) * amount;\n                    }\n\n                    if(colorize == 1) {\n                        scanlines = vec4(sl.x, sl.y, sl.x, 1.0);\n                    } \n                    else {\n                        scanlines = vec4(sl.x, sl.x, sl.x, 1.0);\n                    }\n\n                    gl_FragColor = vec4(color.r + scanlines.r, color.g + scanlines.g, color.b + scanlines.b, color.a);\n                }";e=this.compileShader(t),this.compiledProgram.set("scanlines",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.size,t.direction?Math.round(this.height/t.size):Math.round(this.width/t.size)),this.ctx.uniform1f(e.uniform.amount,t.amount),this.ctx.uniform1i(e.uniform.colorize,t.colorize?1:0),this.ctx.uniform1i(e.uniform.direction,t.direction?1:0),this.draw(e)}mosaic(t){let e=this.compiledProgram.get("mosaic");if(!e){const t="\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform vec2 num;\n                \n                void main()\n                {\n                    vec2 uv = uv;\n                    vec2 uv2 = floor(uv*num)/num;\n                    uv -= uv2;\n                    uv *= num;\n                    gl_FragColor = texture2D(texture, \n                                    uv2 + vec2(step(1.0-uv.y,uv.x)/(2.0*num.x),\n                                    step(uv.x,uv.y)/(2.0*num.y)));\n                }";e=this.compileShader(t),this.compiledProgram.set("mosaic",e)}let s=Math.round(100*(1-t)),i=Math.round(this.height/this.width*s);this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.num,s,i),this.draw(e)}bokeh(t){let e=this.compiledProgram.get("bokeh-"+t.type);if(!e){let s="";switch(t.type){case"circle":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n                        \n                        #define PI 3.1415926538\n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n                            float myx = spread*2.0;\n\n                            vec3 mcol = vec3(0.0);\n                            vec3 avg  = vec3(0.0);                          \n                            float rc = 0.0;\n\n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    float l = length(vec2(x-spread,y-spread));\n                                    if(l <= spread)\n                                    {\n                                        vec3 col = texture2D(texture, uv + px * vec2(x-spread,y-spread) * 2.0).rgb;\n                                        mcol = max(mcol, col);\n                                        avg += col;\n                                        rc += 1.0;\n                                    }\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / rc, mcol, amount), 1.0);\n                        }";break;case"square":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n\n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n                            float myx = spread*2.0;\n\n                            vec3 mcol = vec3(0.0);\n                            vec3 avg = vec3(0.0);\n        \n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    vec3 col = texture2D(texture, uv + px * vec2(x-spread,y-spread) * 2.0).rgb;\n                                    mcol = max(mcol, col);\n                                    avg += col;\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / (myx * myx), mcol, amount), 1.0);\n                        }";break;case"hexagon":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n                        \n                        #define PI 3.1415926538\n                        #define PI2 6.283185308\n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n                            float myx = spread*2.0;\n\n                            vec3 mcol = vec3(0.0);\n                            vec3 avg  = vec3(0.0);\n                            float rc = 0.0;\n        \n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    vec2 pt = vec2(x-spread, y-spread);\n        \n                                    float an = 0.33 + atan(pt.x, pt.y); //0.33 Angle\n                                    float ngon = cos(an - (PI2 * floor((PI + 6.0 * an) / PI2)) / 6.0) / cos(PI / 6.0); //6 corners\n                                    float ngonSdf = ngon * length(pt) - spread;\n                            \n                                    if(ngonSdf <= 0.0) {\n                                        vec3 col = texture2D(texture, uv + px * vec2(x-spread, y-spread) * 2.0).rgb;\n                                        mcol = max(mcol, col);\n                                        avg += col;\n                                        rc += 1.0;\n                                    }\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / rc, mcol, amount), 1.0);\n                        }";break;case"cross":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n                        \n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n        \n                            vec3 mcol = vec3(0.0);\n                            vec3 avg  = vec3(0.0);\n                            float rc = 0.0;\n        \n                            float myx = spread*2.0;\n                            float low = spread*.7;\n                            float high = spread*1.3;\n        \n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    if((y > low && y < high) || (x > low && x < high))\n                                    {\n                                        vec3 col = texture2D(texture, uv + px * vec2(x-spread,y-spread) * 2.0).rgb;\n                                        mcol = max(mcol, col);\n                                        avg += col;\n                                        rc += 1.0;\n                                    }\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / rc, mcol, amount), 1.0);\n                        }"}e=this.compileShader(s),this.compiledProgram.set("bokeh-"+t.type,e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.size,t.size),this.ctx.uniform1f(e.uniform.amount,t.amount),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.draw(e)}art(t){let e=this.compiledProgram.get("art");if(!e){let t=["precision highp float;","uniform sampler2D texture;","varying vec2 uv;","void main() {","vec4 color, tmp, add;","vec2 uv = uv + vec2( sin( uv.y * 100.0 ), sin( uv.x * 100.0 )) * 0.0005;","color = texture2D( texture, uv );","add = tmp = texture2D( texture, uv + vec2( 0.0015, 0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( -0.0015, 0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( -0.0015, -0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0.0015, -0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0.002, 0.0 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( -0.002, 0.0 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0, 0.002 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0, -0.002 ));","if( tmp.r < color.r ) color = tmp;","uv = (uv - vec2(0.5)) * vec2(0.7);","gl_FragColor = vec4(mix(color.rgb * color.rgb * vec3(1.8), color.ggg * color.ggg - vec3(0.4), vec3(dot(uv, uv))), 1.0);","}"].join("\n");e=this.compileShader(t),this.compiledProgram.set("art",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.screenWidth,this.canvas.width),this.ctx.uniform1f(e.uniform.screenHeight,this.canvas.height),this.ctx.uniform1f(e.uniform.sampleDistance,t),this.ctx.uniform1f(e.uniform.waveFactor,.01),this.draw(e)}melt(t){let e=this.compiledProgram.get("melt");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 center;\n              \n                float rand(vec2 co){\n                    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n                }\n                vec3 mod289(vec3 x) {\n                    return x - floor(x * (1.0 / 289.0)) * 289.0;\n                }\n                  \n                vec2 mod289(vec2 x) {\n                    return x - floor(x * (1.0 / 289.0)) * 289.0;\n                }\n                  \n                vec3 permute(vec3 x) {\n                    return mod289(((x*34.0)+1.0)*x);\n                }\n                  \n                float snoise(vec2 v) {\n\n                    const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                                        0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                                       -0.577350269189626,  // -1.0 + 2.0 * C.x\n                                        0.024390243902439); // 1.0 / 41.0\n                  // First corner\n                    vec2 i  = floor(v + dot(v, C.yy) );\n                    vec2 x0 = v -   i + dot(i, C.xx);\n                  \n                  // Other corners\n                    vec2 i1;\n                    i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n                    vec4 x12 = x0.xyxy + C.xxzz;\n                    x12.xy -= i1;\n                  \n                  // Permutations\n                    i = mod289(i); // Avoid truncation effects in permutation\n                    vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n                          + i.x + vec3(0.0, i1.x, 1.0 ));\n                  \n                    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n                    m = m*m ;\n                    m = m*m ;\n                                   \n                    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n                    vec3 h = abs(x) - 0.5;\n                    vec3 ox = floor(x + 0.5);\n                    vec3 a0 = x - ox;\n                  \n                    m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n                  \n                  // Compute final noise value at P\n                    vec3 g;\n                    g.x  = a0.x  * x0.x  + h.x  * x0.y;\n                    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n                    return 130.0 * dot(m, g);\n                }\n\n                void main() {\n                    vec4 px = texture2D(texture, uv);\n                    \n                    float opacity = 0.0;\n\n                    if(amount == 0.0 || amount == 1.0) {\n                        opacity = amount;\n                    } \n                    else {\n                        if(center.x == 0.5) {\n                            float dist = distance(center, uv)- amount*exp(snoise(vec2(uv.x, 0.0)));\n                            float r = amount - rand(vec2(uv.x, 0.1));\n                            opacity = dist <= r ? 1.0 : (amount*amount*amount);\n                        }\n                        else {\n                            float dist = distance(center, uv)- amount*exp(snoise(vec2(0.0, uv.y)));\n                            float r = amount - rand(vec2(0.1, uv.y));\n                            opacity = dist <= r ? 1.0 : (amount*amount*amount);\n                        }   \n                    }\n                    gl_FragColor = vec4(px.rgb, px.a * (1.0 - opacity));\n                }";e=this.compileShader(t),this.compiledProgram.set("melt",e)}this.ctx.useProgram(e.program);let s=new i.A(.5,.5);switch(t.direction){case"down":s.y=0;break;case"right":s.x=1;break;case"left":s.x=0;break;case"up":s.y=1}this.ctx.uniform2f(e.uniform.center,s.x,s.y),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}gooey(t){let e=this.compiledProgram.get("gooey");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                // http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\n                float random(vec2 co) {\n\n                    highp float a = 12.9898; //seed;\n                    highp float b = 78.233;\n                    highp float c = 43758.5453;\n                    highp float dt= dot(co.xy ,vec2(a,b));\n                    highp float sn= mod(dt,3.14);\n                    return fract(sin(sn) * c);\n                }\n\n                // 2D Noise based on Morgan McGuire @morgan3d\n                // https://www.shadertoy.com/view/4dS3Wd\n                float noise (in vec2 st) {\n\n                    vec2 i = floor(st);\n                    vec2 f = fract(st);\n\n                    // Four corners in 2D of a tile\n                    float a = random(i);\n                    float b = random(i + vec2(1.0, 0.0));\n                    float c = random(i + vec2(0.0, 1.0));\n                    float d = random(i + vec2(1.0, 1.0));\n\n                    // Cubic Hermine Curve.  Same as SmoothStep()\n                    vec2 u = f*f*(3.0-2.0*f);\n\n                    // Mix 4 coorners porcentages\n                    return mix(a, b, u.x) +\n                            (c - a)* u.y * (1.0 - u.x) +\n                            (d - b) * u.x * u.y;\n                }\n\n                void main() {\n\n                    vec4 col = texture2D(texture, uv);\n                    float n = noise(uv * 10.0); //scale\n                    \n                    float p = mix(-0.01, 1.0 + 0.01, amount);\n                    float lower = p - 0.01;\n                    float higher = p + 0.01;\n                    \n                    float opacity = smoothstep(lower, higher, n);\n                    \n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }";e=this.compileShader(t),this.compiledProgram.set("gooey",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}block(t){let e=this.compiledProgram.get("block");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                float rand (vec2 co) {\n                    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n                }\n\n                void main() {\n                    vec4 col = texture2D(texture, uv);\n                    \n                    float r = rand(floor(vec2(10.0) * uv)); //size\n                    float opacity = smoothstep(0.0, -0.5, r - (amount * (1.0 + 0.5)));\n                   \n                    gl_FragColor = vec4(col.rgb, col.a * (1.0 - opacity));\n                }";e=this.compileShader(t),this.compiledProgram.set("block",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}curtain(t){let e=this.compiledProgram.get("curtain-"+t.direction);if(!e){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                void main() {\n                    vec2 p = uv;\n                    vec4 col = vec4(0);\n                ";"horizontal"===t.direction?s+="                    \n                        if(2.0 * abs(p.x-0.5) - amount > 0.0) {\n                            p = p + (p.x > 0.5 ? -1.0 : 1.0) * vec2(0.5*amount, 0.0);\n                            col = texture2D(texture, p);\n                        }\n                    ":s+="\n                        if(2.0 * abs(p.y-0.5) - amount > 0.0) {\n                            p = p + (p.y > 0.5 ? -1.0 : 1.0) * vec2(0.0, 0.5*amount);\n                            col = texture2D(texture, p);\n                        }\n                    ",s+="\n                    gl_FragColor = col;\n                }",e=this.compileShader(s),this.compiledProgram.set("curtain-"+t.direction,e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}blinds(t){let e=this.compiledProgram.get("blinds-"+t.direction);if(!e){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                void main() {\n                    vec4 col = texture2D(texture, uv);\n                ";switch(t.direction){case"up":s+="float opacity = step(smoothstep(-0.5, 0.0, (1.0 - uv.y) - amount * (1.0 + 0.5)), fract(12.0 * uv.y));";break;case"right":s+="float opacity = step(smoothstep(-0.5, 0.0, (1.0 - uv.x) - amount * (1.0 + 0.5)), fract(12.0 * uv.x));";break;case"left":s+="float opacity = step(smoothstep(-0.5, 0.0, uv.x - amount * (1.0 + 0.5)), fract(12.0 * uv.x));";break;case"down":s+="float opacity = step(smoothstep(-0.5, 0.0, uv.y - amount * (1.0 + 0.5)), fract(12.0 * uv.y));"}s+="\n                    gl_FragColor = vec4(col.rgb, col.a * (1.0 - opacity));\n                }",e=this.compileShader(s),this.compiledProgram.set("blinds-"+t.direction,e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}wipe(t){let e=this.compiledProgram.get("wipe-"+t.direction);if(!e){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                void main() {\n                    vec4 col = texture2D(texture, uv);\n                ";switch(t.direction){case"down":s+="float opacity = 1.0 - step(uv.y, amount);";break;case"right":s+="float opacity = step(uv.x, 1.0 - amount);";break;case"left":s+="float opacity = 1.0 - step(uv.x, amount);";break;case"up":s+="float opacity = step(uv.y, 1.0 - amount);"}s+="\n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }",e=this.compileShader(s),this.compiledProgram.set("wipe-"+t.direction,e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}swipe(t){let e=this.compiledProgram.get("swipe-"+t.direction);if(!e){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec4 color; \n              \n                void main() {\n\n                ";switch(t.direction){case"down":s+="\n                        if(amount > 0.5) gl_FragColor = vec4(color.rgb, 1.0 - step(1.0 + uv.y, amount*2.0));\n                        else gl_FragColor = step(uv.y, amount*2.0) == 1.0 ? color : texture2D(texture, uv);\n                    }";break;case"right":s+="\n                        if(amount > 0.5) gl_FragColor = vec4(color.rgb, 1.0 - step(2.0 - uv.x, amount*2.0));\n                        else gl_FragColor = step(1.0 - uv.x, amount*2.0) == 1.0 ? color : texture2D(texture, uv);\n                    }";break;case"left":s+="\n                        if(amount > 0.5) gl_FragColor = vec4(color.rgb, 1.0 - step(1.0 + uv.x, amount*2.0));\n                        else gl_FragColor = step(uv.x, amount*2.0) == 1.0 ? color : texture2D(texture, uv);\n                    }";break;case"up":s+="\n                        if(amount > 0.5) gl_FragColor = vec4(color.rgb, 1.0 - step(2.0 - uv.y, amount*2.0));\n                        else gl_FragColor = step(1.0 - uv.y, amount*2.0) == 1.0 ? color : texture2D(texture, uv);\n                    }"}e=this.compileShader(s),this.compiledProgram.set("swipe-"+t.direction,e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t.amount),this.ctx.uniform4f(e.uniform.color,t.color.r/255,t.color.g/255,t.color.b/255,1),this.draw(e)}slot(t){let e=this.compiledProgram.get("slot");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 dir;\n\n                void main() {\n                   \n                    vec2 p = uv + amount * sign(dir);\n                    vec2 f = fract(p);\n                    float opacity = step(0.0, p.y) * step(p.y, 1.0) * step(0.0, p.x) * step(p.x, 1.0);\n                   \n                    vec4 col = texture2D(texture, p);\n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }";e=this.compileShader(t),this.compiledProgram.set("slot",e)}let s=new i.A(0,0);switch(t.direction){case"down":s.y=-1;break;case"right":s.x=1;break;case"left":s.x=-1;break;case"up":s.y=1}this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.dir,s.x,s.y),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}marquee(t){let e=this.compiledProgram.get("marquee");if(!e){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 dir;\n\n                void main() {\n                   \n                    vec2 p = uv + amount * sign(dir);\n                ";switch(t.direction){case"up":s+="if(p.y < 0.0) p.y += 1.0;";break;case"down":s+="if(p.y > 1.0) p.y -= 1.0;";break;case"right":s+="if(p.x < 0.0) p.x += 1.0;";break;case"left":s+="if(p.x > 1.0) p.x -= 1.0;"}s+="\n         \n                    gl_FragColor = texture2D(texture, p);\n                }",e=this.compileShader(s),this.compiledProgram.set("marquee",e)}let s=new i.A(0,0);switch(t.direction){case"up":s.y+=-1;break;case"down":s.y+=1;break;case"right":s.x+=-1;break;case"left":s.x+=1}this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.dir,s.x,s.y),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}split(t){let e=this.compiledProgram.get("split-"+t.direction);if(!e){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform float sections;\n\n                void main() {\n                    vec2 p = uv;\n                ";"horizontal"===t.direction?s+="float num = floor(uv.y*sections);\n                    float odd = num - (2.0 * floor(num/2.0));\n                    p.x = uv.x + amount*sign(odd-0.5);\n             \n                    float opacity = (p.x * (1.0-step(odd,0.5)*2.0) - sign(odd) > 0.0) ? 0.0 : 1.0;\n                    ":s+="float num = floor(uv.x*sections);\n                    float odd = num - (2.0 * floor(num/2.0));\n                    p.y = uv.y + amount*sign(odd-0.5);\n             \n                    float opacity = (p.y * (1.0-step(odd,0.5)*2.0) - sign(odd) > 0.0) ? 0.0 : 1.0;\n                    ",s+="vec4 col = texture2D(texture, p);\n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }",e=this.compileShader(s),this.compiledProgram.set("split-"+t.direction,e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.sections,t.sections),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}circular(t){let e=this.compiledProgram.get("circular");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                const float PI = 3.141592653589;\n\n                void main() {\n                    vec4 col = texture2D(texture, uv);\n\n                    vec2 p = uv*2.-1.;\n                    float opacity = smoothstep(0.0, 0.5, atan(p.y,p.x) - (amount-.5) * PI * 2.5);\n                   \n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }";e=this.compileShader(t),this.compiledProgram.set("circular",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}ripple(t){let e=this.compiledProgram.get("ripple");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    \n                    vec2 dir = uv - vec2(.5);\n                    float dist = length(dir);\n                    vec2 offset = dir * (sin(amount * dist * 100.0 - amount * 40.0) + 0.5) / 30.0; //100 amp 40 speed\n\n                    float opacity = smoothstep(0.2, 1.0, amount);\n\n                    vec4 px = texture2D(texture, uv + offset);                   \n                    gl_FragColor = vec4(px.rgb, px.a * (1.0 - opacity));\n                }";e=this.compileShader(t),this.compiledProgram.set("ripple",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}warp(t){let e=this.compiledProgram.get("warp-"+t.direction);if(!e){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n            ";switch(t.direction){case"up":s+="float x = smoothstep(0.0, 1.0, (amount*2.0 + uv.y-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(1.0-x)+0.5);";break;case"right":s+="float x = smoothstep(0.0, 1.0, (amount*2.0 + uv.x-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(1.0-x)+0.5);";break;case"left":s+="float x = smoothstep(0.0, 1.0, ((1.0-amount)*2.0 + uv.x-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(x)+0.5);";break;case"down":s+="float x = smoothstep(0.0, 1.0, ((1.0-amount)*2.0 + uv.y-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(x)+0.5);"}s+="\n                gl_FragColor = vec4(col.rgb, col.a * (1.0 - amount));\n            }",e=this.compileShader(s),this.compiledProgram.set("warp-"+t.direction,e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}}class v{constructor(t,e,s=!1){this.type=t,this.value=e,this.sidekick=s}}},1177:(t,e,s)=>{s.d(e,{A:()=>i});class i{constructor(t){this.id=t,this.texture=null}createTexture(t,e,s){this.texture=t.createTexture(),this.width=e,this.height=s}uploadData(t,e,s=t.NEAREST){t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,4),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)}setTexture(t){this.texture=t}destroy(t){t.deleteTexture(this.texture)}}},85499:(t,e,s)=>{s.d(e,{t:()=>d});var i=s(54738),a=s(53900),n=s(40963),o=s(41915),r=s(65209),h=s(54127),l=s(39989),c=s(58489);async function d(t,e){var s,d,u,p;const g=new Date;switch(e.type){case"bitmapChange":{const t=e.layer,s=i.ON(e.layer.canvas,e.patchRect),a=t.rect?t.rect.clone():void 0;let o=i.oM(t.mask);if(e.patch){const s=e.rect,n=!!t.canvas;t.extendCanvas(s),n&&(e.patchRect.x+=a.x-t.rect.x,e.patchRect.y+=a.y-t.rect.y);if(t.canvas.getContext("2d").putImageData(e.patch,e.patchRect.x,e.patchRect.y),e.rect.width<t.rect.width||e.rect.height<t.rect.height){const a=i.Nw(e.rect.width,e.rect.height);a.getContext("2d").drawImage(t.canvas,t.rect.x-e.rect.x,t.rect.y-e.rect.y),e.patchRect.x+=t.rect.x-s.x,e.patchRect.y+=t.rect.y-s.y,t.canvas=a,t.rect=s}}else t.canvas=null,t.rect=new n.A(0,0,0,0);return e.mask&&(t.mask=e.mask),t.render(),e.layer.syncRequested=g,{type:"bitmapChange",layer:t,rect:a,kind:e.kind,patch:s,patchRect:e.patchRect.clone(),mask:o}}case"bitmapSwitch":{const t=e.layer,s=i.oM(e.layer.canvas),a=e.layer.trim?e.layer.trim.clone():e.layer.rect.clone();return t.switchCanvas(e.canvas,e.rect),t.render(),e.layer.syncRequested=g,{type:"bitmapSwitch",kind:e.kind,layer:t,rect:a,canvas:s}}case"selectionAndBitmapSwitch":{const a=e.layer,n=i.oM(e.layer.canvas),o=a.rect.clone();a.switchCanvas(e.canvas,e.rect),a.render(),e.layer.syncRequested=g;const r=i.oM(null===(s=null==t?void 0:t.selection)||void 0===s?void 0:s.mask);return e.selection?(t.addSelection(),t.selection.setMask(e.selection),{type:"selectionAndBitmapSwitch",kind:e.kind,selection:r,layer:a,rect:o,canvas:n}):(t.removeSelection(),{type:"selectionAndBitmapSwitch",kind:e.kind,selection:r,layer:a,rect:o,canvas:n})}case"addLayer":return t.layers.splice(e.order,0,e.layer),{type:"addLayer",kind:e.kind,layer:e.layer};case"deleteLayer":return t.deleteLayerById(e.layer.id),e;case"order":return t.changeLayerOrder(e.to,e.from),e;case"layerSettings":{const t=Object.assign({},e.layer.settings);return e.layer.settings=e.settings,e.layer.syncRequested=g,{type:"layerSettings",kind:e.kind,layer:e.layer,settings:t}}case"textChange":{const t=e.layer.text;return e.layer.setText(e.text),e.layer.syncRequested=g,{type:"textChange",layer:e.layer,text:t}}case"textSettings":{const t=e.layer.textSettings.clone();return e.layer.textSettings=e.settings,e.layer.textSettings.measureText(),await e.layer.prepare(!0),e.layer.syncRequested=g,{type:"textSettings",kind:e.kind,layer:e.layer,settings:t}}case"background":{const s=t.color;return t.color=e.color,{type:"background",color:s}}case"mask":{let t;const s=e.layer.hasMask();if(!s&&e.patch&&e.layer.addMask(),e.patch){const a=e.layer.mask.getContext("2d");s&&(t=i.ON(e.layer.mask,new n.A(e.rect.x,e.rect.y,e.patch.width,e.patch.height))),a.putImageData(e.patch,e.rect.x,e.rect.y)}else e.layer.removeMask();return e.layer.render(),e.layer.syncRequested=g,{type:"mask",layer:e.layer,rect:e.rect,patch:t}}case"maskInvert":return e.layer.invertMask(),e.layer.render(),e.layer.syncRequested=g,{type:"maskInvert",layer:e.layer};case"adjust":{const t=e.shaders.cloneChain();return e.shaders.chain=e.chain,{type:"adjust",layer:e.layer,kind:e.kind,chain:t,shaders:e.shaders}}case"glitch":{const t=e.shaders.cloneChain();return e.shaders.chain=e.chain,{type:"glitch",layer:e.layer,kind:e.kind,chain:t,shaders:e.shaders}}case"effect":{let t,s;return e.tool.marked&&(t=e.tool.marked.name,s=e.tool.marked.value),e.tool.shaders.reset(),e.name?(e.tool.shaders.addPreset(e.name,e.value),e.tool.marked=new r.A(e.name,e.value)):e.tool.marked=void 0,{type:"effect",layer:e.layer,kind:e.kind,tool:e.tool,name:t,value:s}}case"arrange":switch(e.layer.syncRequested=g,e.action.type){case"rect":{const t=e.layer.rect.clone();return e.layer.rect=e.action.rect,e.layer instanceof h.A&&(t.height=e.layer.textSettings.size,e.layer.rect.height!==e.layer.textSettings.size&&e.layer.setTextSize(e.layer.rect.height)),e.layer instanceof c.A&&e.layer.trimOnResize(t),e.layer instanceof l.A||e.layer.render(),{type:"arrange",layer:e.layer,kind:e.kind,action:{type:"rect",rect:t}}}case"trim":{const t=e.layer.trim.clone();return e.layer.trim=e.action.rect,e.layer.render(),{type:"arrange",layer:e.layer,kind:e.kind,action:{type:"trim",rect:t}}}case"trans":{const t=i.oM(e.layer.canvas),s=i.oM(e.layer.mask),a=e.layer.rect.clone();return e.layer.canvas=e.action.data,e.layer.mask=e.action.mask,e.layer.rect=e.action.rect,e.layer.render(),{type:"arrange",layer:e.layer,kind:e.kind,action:{type:"trans",data:t,mask:s,rect:a}}}}case"arrangeStack":{let t=e.stack,s=e.rects,i=new Array;for(let e=0;e<t.length;e++){let a=t[e],n=a.rect?a.rect.clone():void 0;a.rect=s[e],a instanceof h.A&&(n.height=a.textSettings.size,a.rect.height!==a.textSettings.size&&a.setTextSize(a.rect.height)),a instanceof c.A&&a.trimOnResize(n),i.push(n),a.syncRequested=g,a.render()}return{type:"arrangeStack",id:e.id,kind:"arrange",stack:e.stack,rects:i}}case"link":{let t=e.stack,s=new Array;for(let e=0;e<t.length;e++)s.push({layer:t[e].layer,link:null!==(d=t[e].layer.settings.link)&&void 0!==d?d:""}),t[e].layer.settings.link=t[e].link,t[e].layer.syncRequested=g;return{type:"link",kind:e.kind,stack:s}}case"flipLayer":return e.layer.flip(e.vertical),e.layer.render(),e.layer.syncRequested=g,{type:"flipLayer",layer:e.layer,vertical:e.vertical};case"rotateLayer":return e.layer.rotate(!e.counterClock),e.layer.render(),e.layer.syncRequested=g,{type:"rotateLayer",layer:e.layer,counterClock:!e.counterClock};case"crop":{const s=new o.A(-e.offset.x,-e.offset.y),r=new a.A(t.width,t.height);let h;if(t.crop(new n.A(e.offset.x,e.offset.y,e.size.width,e.size.height)),e.straighten){const s=t.layers[0];h=i.oM(s.canvas),s.syncRequested=g,s.canvas=e.straighten,s.rect=new n.A(0,0,s.canvas.width,s.canvas.height),t.width=s.rect.width,t.height=s.rect.height}return t.layers.forEach((t=>t.syncRequested=g)),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"crop",offset:s,size:r,straighten:h}}case"pageSize":{const s=new a.A(t.width,t.height);return t.size(e.size.width,e.size.height,!1,e.anchor),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageSize",anchor:e.anchor,size:s}}case"pageResize":{const s=new a.A(t.width,t.height),i=t.layers.map((t=>t.clone(!0)));t.width=e.size.width,t.height=e.size.height;for(let a=0;a<e.layers.length;a++){const s=e.layers[a];s.syncRequested=g,t.replaceLayer(s),s.render()}return t.selection&&t.selection.resize(t.width,t.height),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageResize",size:s,layers:i}}case"flip":return t.flip(e.vertical),t.layers.forEach((t=>t.syncRequested=g)),{type:"flip",vertical:e.vertical};case"rotate":return t.rotate(e.counterClock),document.dispatchEvent(new CustomEvent("reset-viewport")),t.layers.forEach((t=>t.syncRequested=g)),{type:"rotate",counterClock:e.counterClock};case"selectionChange":{const s=t.selection?i.oM(t.selection.mask):void 0;return e.selection?(t.addSelection(),t.selection.setMask(e.selection),Object.assign(Object.assign({},e),{selection:s})):(t.removeSelection(),Object.assign(Object.assign({},e),{selection:s}))}case"merge":{const s=e.from.map((e=>t.layers.find((t=>t.id===e.id)))),i=e.from,a=t.layers.map((t=>t.id));return t.layers=t.layers.filter((t=>!i.includes(t))),t.layers.splice(e.order,0,e.target),t.getSelected()&&!t.hasLayer(t.getSelected())&&t.selectLayerById(e.target.id),{type:"merge",kind:e.kind,target:e.target,order:a,layers:s}}case"rasterize":{const s=t.layers.findIndex((t=>t.id===e.newId));if(s<0)return;const[i]=t.layers.splice(s,1,e.layer);return(null===(u=null==t?void 0:t.getSelected())||void 0===u?void 0:u.id)===i.id&&t.selectLayerById(e.layer.id),{type:"rasterize",layer:i,kind:e.kind,newId:e.layer.id}}case"convertSelectionToMask":{const s=t.selection.mask;return e.layer.addMask(),e.layer.mask.getContext("2d").drawImage(t.selection.mask,-e.layer.rect.x,-e.layer.rect.y),e.layer.render(),t.removeSelection(),e.layer.syncRequested=g,{type:"convertSelectionToMask",layer:e.layer,selection:s}}case"convertMaskToSelection":{const s=e.layer.mask;return e.layer.removeMask(),t.addSelection(),t.selection.setMask(e.selection),e.layer.syncRequested=g,{type:"convertMaskToSelection",layer:e.layer,mask:s}}case"applyMask":{const t=e.layer.canvas,s=e.layer.mask;let i=e.layer.rect.clone();return e.layer.render(),e.layer.canvas=e.layer.baked,e.layer.removeMask(),e.layer.shrinkWrap(),e.layer.syncRequested=g,{type:"applyMask",layer:e.layer,canvas:t,mask:s,rect:i}}case"frameContent":{let t,s;return e.layer.canvas&&(t=i.oM(e.layer.canvas),s=null===(p=e.layer.trim)||void 0===p?void 0:p.clone()),e.layer.canvas=e.canvas,e.layer.trim=e.trim,e.layer instanceof c.A&&e.layer.render(),{type:"frameContent",kind:e.kind,layer:e.layer,canvas:t,trim:s}}case"frameSettings":{const t=e.layer.frameSettings.clone();return e.layer.frameSettings=e.settings,e.layer.prepare(),e.layer.syncRequested=g,{type:"frameSettings",kind:e.kind,layer:e.layer,settings:t}}case"shapeSettings":{const t=e.layer.shapeSettings.clone();return e.layer.shapeSettings=e.settings,await e.layer.prepare(),e.layer.syncRequested=g,{type:"shapeSettings",kind:e.kind,layer:e.layer,settings:t}}case"groupSettings":{const t=e.layer.groupSettings.clone();return e.layer.groupSettings=e.settings,e.layer.syncRequested=g,{type:"groupSettings",kind:e.kind,layer:e.layer,settings:t}}case"pageAnimation":{const s=t.animation?t.animation:void 0;return t.animation=e.animation,{type:"pageAnimation",kind:e.kind,animation:s}}case"layerAnimation":{const t=e.layer.animation?e.layer.animation:void 0;return e.layer.animation=e.animation,e.layer.syncRequested=g,{type:"layerAnimation",kind:e.kind,layer:e.layer,animation:t}}default:throw new Error("No handler for this redo type")}}},95251:(t,e,s)=>{s.d(e,{J:()=>d});var i=s(21742),a=s(54738),n=s(98244),o=s(29755),r=s(5865),h=s(85499),l=s(97317),c=s(39989);class d{constructor(t,e,s=!1){this.fresco=t,this.undoStack=[],this.redoStack=[],this.ignore=!1,this.disable=()=>{this.ignore=!0},this.enable=()=>{this.ignore=!1},this.dispatchHistoryStatus=()=>{document.dispatchEvent(new CustomEvent("history-update",{detail:{atStart:this.undoStack.length<=1,atEnd:0===this.redoStack.length}}))},this.undo=async()=>{if(!this.ignore&&0!==this.undoStack.length&&"open"!==this.undoStack[this.undoStack.length-1].data.type)try{this.ignore=!0;const{local:t,data:e}=this.undoStack.pop(),s=await(0,r.Z)(this.fresco,e);s&&(this.redoStack.push({local:t,data:s}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layerlist-update")),document.dispatchEvent(new CustomEvent("layer-select")),(0,n.A)("undo")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)("titleUndo")})),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),this.dispatchHistoryStatus()}finally{this.ignore=!1}},this.redo=async()=>{if(!this.ignore&&0!==this.redoStack.length)try{this.ignore=!0;const{local:t,data:e}=this.redoStack.pop(),s=await(0,h.t)(this.fresco,e);s&&(this.undoStack.push({local:t,data:s}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layerlist-update")),document.dispatchEvent(new CustomEvent("layer-select")),(0,n.A)("redo")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)("titleRedo")})),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco}))}finally{this.ignore=!1,this.dispatchHistoryStatus()}},this.hasChanges=()=>this.undoStack.length>1||this.redoStack.length>0,this.getActiveTransaction=()=>this.transaction,this.redos=t=>this.redoStack.filter((e=>e.local===t)).reverse().map((t=>t.data)),this.undos=t=>this.undoStack.filter((e=>e.local===t)).map((t=>t.data)),this.add=t=>{if(this.ignore)return;if(!(0,l.T)(this.fresco,t))return;this.validateTransaction(t);const e=o.Ay.maxHistoryUndos;!this.transaction&&this.undoStack.length>=e&&(this.undoStack=this.undoStack.slice(this.undoStack.length+1-e)),this.undoStack.push({local:!!this.transaction,data:t}),this.redoStack=[],this.dispatchHistoryStatus(),"open"!==t.type&&document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),(this.undoStack.length<1||!this.undoStack[this.undoStack.length-1].local)&&document.dispatchEvent(new CustomEvent("layerlist-update"))},this.validateTransaction=t=>{if("arrange"===t.type&&"transform"!==t.kind||"arrangeStack"===t.type||"adjust"===t.type||"glitch"===t.type||"effect"===t.type||"textSettings"===t.type||"frameSettings"===t.type||"shapeSettings"===t.type||"pageAnimation"===t.type||"layerAnimation"===t.type){const e="pageAnimation"===t.type?"page":"arrangeStack"===t.type?t.id:t.layer.id;this.transaction&&this.transaction.id!==t.type+"-"+e&&this.commitTransaction(!0),this.transaction||(this.transaction={id:t.type+"-"+e,type:t.type})}else this.commitTransaction(!0)},this.abortTransaction=()=>{this.transaction&&(this.transaction=void 0,this.redoStack=this.redoStack.filter((t=>!t.local)),this.undoStack=this.undoStack.filter((t=>!t.local)),this.dispatchHistoryStatus())},this.commitTransaction=(t=!1)=>{if(!this.transaction)return;const e=new Date;this.transaction=void 0;const s=this.undoStack.filter((t=>t.local));if(0===s.length)return;this.undoStack=this.undoStack.filter((t=>!t.local)),this.redoStack=[];let i=s[0].data,n=!1;switch(i.type){case"arrange":{const t=i.layer,s=i.action.rect;if(t instanceof c.A&&t.wouldApplyTransform()){const e=a.oM(t.canvas),i=a.oM(t.mask);t.applyTransform(o.Ay.smoothScaling),this.undoStack.push({local:!1,data:{type:"arrange",kind:"transform",layer:t,action:{type:"trans",data:e,mask:i,rect:s}}})}else this.undoStack.push({local:!1,data:{type:"arrange",kind:"arrange",layer:t,action:{type:"rect",rect:s}}});t.syncRequested=e,n=!0;break}case"arrangeStack":{let t=i.stack,s=i.rects,r=Array(),h=Array();for(let i=0;i<t.length;i++){let n=t[i],l=s[i];if(n instanceof c.A&&n.wouldApplyTransform()){const t=a.oM(n.canvas),e=a.oM(n.mask);n.applyTransform(o.Ay.smoothScaling),this.undoStack.push({local:!1,data:{type:"arrange",kind:"transform",layer:n,action:{type:"trans",data:t,mask:e,rect:l}}})}else r.push(n),h.push(l);n.syncRequested=e}r.length>1?this.undoStack.push({local:!1,data:{type:"arrangeStack",id:i.id,kind:"arrange",stack:r,rects:h}}):1===r.length&&this.undoStack.push({local:!1,data:{type:"arrange",kind:"arrange",layer:r[0],action:{type:"rect",rect:h[0]}}}),n=!0;break}case"glitch":case"effect":case"adjust":break;case"textSettings":{const t=i.layer,s=i.settings;this.undoStack.push({local:!1,data:{type:"textSettings",kind:"settings",layer:t,settings:s}}),t.syncRequested=e,n=!0;break}case"frameSettings":{const t=i.layer,s=i.settings;this.undoStack.push({local:!1,data:{type:"frameSettings",kind:"settings",layer:t,settings:s}}),t.syncRequested=e,n=!0;break}case"shapeSettings":{const t=i.layer,s=i.settings;this.undoStack.push({local:!1,data:{type:"shapeSettings",kind:"settings",layer:t,settings:s}}),t.syncRequested=e,n=!0;break}case"pageAnimation":{const t=i.animation;this.undoStack.push({local:!1,data:{type:"pageAnimation",kind:"",animation:t}}),n=!0;break}case"layerAnimation":{const t=i.layer,s=i.animation;this.undoStack.push({local:!1,data:{type:"layerAnimation",kind:"",layer:t,animation:s}}),t.syncRequested=e,n=!0;break}}n&&!t&&(document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),document.dispatchEvent(new CustomEvent("layerlist-update"))),this.dispatchHistoryStatus()},s?this.ignore=!0:(this.add({type:"open",kind:e}),this.dispatchHistoryStatus())}async jump(t){if(!this.ignore&&0!==t)try{if(this.ignore=!0,document.dispatchEvent(new CustomEvent("render-enabled",{detail:!1})),t<0){const e=Math.min(this.undoStack.length,Math.abs(t));for(let t=0;t<e;t++){const{local:t,data:e}=this.undoStack.pop(),s=await(0,r.Z)(this.fresco,e);s&&this.redoStack.push({local:t,data:s})}e>0&&((0,n.A)("undo"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)("titleUndo")})))}else{const e=Math.min(this.redoStack.length,t);for(let t=0;t<e;t++){const{local:t,data:e}=this.redoStack.pop(),s=await(0,h.t)(this.fresco,e);s&&this.undoStack.push({local:t,data:s})}e>0&&((0,n.A)("redo"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)("titleRedo")})))}document.dispatchEvent(new CustomEvent("render-enabled",{detail:!0})),document.dispatchEvent(new CustomEvent("layerlist-update")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco}))}finally{this.ignore=!1,document.dispatchEvent(new CustomEvent("render-enabled",{detail:!0})),this.dispatchHistoryStatus()}}}},5865:(t,e,s)=>{s.d(e,{Z:()=>d});var i=s(54738),a=s(53900),n=s(40963),o=s(41915),r=s(65209),h=s(54127),l=s(39989),c=s(58489);async function d(t,e){var s,d,u,p,g;const m=new Date;switch(e.type){case"bitmapChange":{if(!t.hasLayer(e.layer))return;const s=e.layer,a=s.rect?s.rect.clone():void 0;let o,r=i.oM(s.mask);if(s.canvas){o=s.canvas.getContext("2d").getImageData(e.patchRect.x,e.patchRect.y,e.patchRect.width,e.patchRect.height)}if(e.patch){const t=e.rect,n=!!s.canvas;s.extendCanvas(t);const o=s.canvas.getContext("2d");if(n&&(e.patchRect.x+=a.x-s.rect.x,e.patchRect.y+=a.y-s.rect.y),o.putImageData(e.patch,e.patchRect.x,e.patchRect.y),e.rect.width<s.rect.width||e.rect.height<s.rect.height){const a=i.Nw(e.rect.width,e.rect.height);a.getContext("2d").drawImage(s.canvas,s.rect.x-e.rect.x,s.rect.y-e.rect.y),e.patchRect.x+=s.rect.x-t.x,e.patchRect.y+=s.rect.y-t.y,s.canvas=a,s.rect=t}}else s.canvas=null,s.rect=new n.A(0,0,0,0);return e.mask&&(s.mask=e.mask),s.render(),e.layer.syncRequested=m,{type:"bitmapChange",kind:e.kind,layer:s,rect:a,patch:o,patchRect:e.patchRect.clone(),mask:r}}case"bitmapSwitch":{const t=i.oM(e.layer.canvas),s=e.layer.trim?e.layer.trim.clone():e.layer.rect.clone();return e.layer.switchCanvas(e.canvas,e.rect),e.layer.render(),e.layer.syncRequested=m,{type:"bitmapSwitch",kind:e.kind,layer:e.layer,rect:s,canvas:t}}case"selectionAndBitmapSwitch":{const a=i.oM(e.layer.canvas),n=e.layer.rect.clone();e.layer.switchCanvas(e.canvas,e.rect),e.layer.render(),e.layer.syncRequested=m;const o=i.oM(null===(s=null==t?void 0:t.selection)||void 0===s?void 0:s.mask);return t.addSelection(),t.selection.setMask(e.selection),{type:"selectionAndBitmapSwitch",kind:e.kind,selection:o,layer:e.layer,rect:n,canvas:a}}case"addLayer":{const s=t.layerNr(e.layer.id),i=t.deleteLayerById(e.layer.id);return{type:"addLayer",kind:e.kind,layer:i,order:s}}case"deleteLayer":return t.layers.splice(e.index,0,e.layer),e;case"order":return t.changeLayerOrder(e.to,e.from),e;case"layerSettings":{const t=Object.assign({},e.layer.settings);return e.layer.settings=e.settings,e.layer.syncRequested=m,{type:"layerSettings",kind:e.kind,layer:e.layer,settings:t}}case"textChange":{const t=e.layer.text;return e.layer.setText(e.text),e.layer.syncRequested=m,{type:"textChange",layer:e.layer,text:t}}case"textSettings":{const t=e.layer.textSettings.clone();return e.layer.textSettings=e.settings,e.layer.textSettings.measureText(),await e.layer.prepare(!0),e.layer.syncRequested=m,{type:"textSettings",kind:e.kind,layer:e.layer,settings:t}}case"background":{const s=t.color;return t.color=e.color,{type:"background",color:s}}case"mask":{const t=e.layer;let s;const i=t.hasMask();if(!i&&e.patch&&e.layer.addMask(),e.patch){const a=e.patch,n=t.mask.getContext("2d");i&&(s=n.getImageData(e.rect.x,e.rect.y,e.rect.width,e.rect.height)),n.putImageData(a,e.rect.x,e.rect.y)}else{if(i){s=t.mask.getContext("2d").getImageData(0,0,t.mask.width,t.mask.height)}e.layer.removeMask()}return t.render(),e.layer.syncRequested=m,{type:"mask",layer:t,rect:e.patch&&e.rect?e.rect:new n.A(0,0,t.canvas.width,t.canvas.height),patch:s}}case"maskInvert":return e.layer.invertMask(),e.layer.render(),e.layer.syncRequested=m,{type:"maskInvert",layer:e.layer};case"adjust":{const t=e.shaders.cloneChain();return e.shaders.chain=e.chain,{type:"adjust",layer:e.layer,kind:e.kind,chain:t,shaders:e.shaders}}case"glitch":{const t=e.shaders.cloneChain();return e.shaders.chain=e.chain,{type:"glitch",layer:e.layer,kind:e.kind,chain:t,shaders:e.shaders}}case"effect":{let t,s;return e.tool.marked&&(t=e.tool.marked.name,s=e.tool.marked.value),e.tool.shaders.reset(),e.name?(e.tool.shaders.addPreset(e.name,e.value),e.tool.marked=new r.A(e.name,e.value)):e.tool.marked=void 0,{type:"effect",layer:e.layer,kind:e.kind,tool:e.tool,name:t,value:s}}case"arrange":switch(e.layer.syncRequested=m,e.action.type){case"rect":{const t=e.layer.rect.clone();return e.layer.rect=e.action.rect,e.layer instanceof h.A&&(t.height=e.layer.textSettings.size,e.layer.rect.height!==e.layer.textSettings.size&&e.layer.setTextSize(e.layer.rect.height)),e.layer instanceof c.A&&e.layer.trimOnResize(t),e.layer instanceof l.A||e.layer.render(),{type:"arrange",kind:e.kind,action:{type:"rect",rect:t},layer:e.layer}}case"trim":{const t=e.layer.trim.clone();return e.layer.trim=e.action.rect,e.layer.render(),{type:"arrange",kind:e.kind,action:{type:"trim",rect:t},layer:e.layer}}case"trans":{const t=i.oM(e.layer.canvas),s=i.oM(e.layer.mask),a=e.layer.rect.clone();return e.layer.canvas=e.action.data,e.layer.mask=e.action.mask,e.layer.rect=e.action.rect,e.layer.render(),{type:"arrange",layer:e.layer,kind:e.kind,action:{type:"trans",data:t,mask:s,rect:a}}}}case"arrangeStack":{let t=e.stack,s=e.rects,i=new Array;for(let e=0;e<t.length;e++){let a=t[e],n=a.rect?a.rect.clone():void 0;a.rect=s[e],a instanceof h.A&&(n.height=a.textSettings.size,a.rect.height!==a.textSettings.size&&a.setTextSize(a.rect.height)),a instanceof c.A&&a.trimOnResize(n),i.push(n),a.syncRequested=m,a.render()}return{type:"arrangeStack",id:e.id,kind:"arrange",stack:e.stack,rects:i}}case"link":{let t=e.stack,s=new Array;for(let e=0;e<t.length;e++)s.push({layer:t[e].layer,link:null!==(d=t[e].layer.settings.link)&&void 0!==d?d:""}),t[e].layer.settings.link=t[e].link,t[e].layer.syncRequested=m;return{type:"link",kind:e.kind,stack:s}}case"flipLayer":return e.layer.flip(e.vertical),e.layer.render(),e.layer.syncRequested=m,{type:"flipLayer",layer:e.layer,vertical:e.vertical};case"rotateLayer":return e.layer.rotate(!e.counterClock),e.layer.render(),e.layer.syncRequested=m,{type:"rotateLayer",layer:e.layer,counterClock:!e.counterClock};case"crop":{const s=new o.A(-e.offset.x,-e.offset.y),r=new a.A(t.width,t.height);let h;if(t.crop(new n.A(e.offset.x,e.offset.y,e.size.width,e.size.height)),e.straighten){const s=t.layers[0];h=i.oM(s.canvas),s.syncRequested=m,s.canvas=e.straighten,s.rect=new n.A(0,0,s.canvas.width,s.canvas.height),t.width=s.rect.width,t.height=s.rect.height}return t.layers.forEach((t=>t.syncRequested=m)),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"crop",offset:s,size:r,straighten:h}}case"pageSize":{const s=new a.A(t.width,t.height);return t.size(e.size.width,e.size.height,!1,e.anchor),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageSize",anchor:e.anchor,size:s}}case"pageResize":{const s=new a.A(t.width,t.height),i=t.layers.map((t=>t.clone(!0)));t.width=e.size.width,t.height=e.size.height;for(let a=0;a<e.layers.length;a++){const s=e.layers[a];s.syncRequested=m,t.replaceLayer(s),s.render()}return t.selection&&t.selection.resize(t.width,t.height),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageResize",size:s,layers:i}}case"flip":return t.flip(e.vertical),t.layers.forEach((t=>t.syncRequested=m)),{type:"flip",vertical:e.vertical};case"rotate":return t.rotate(!e.counterClock),document.dispatchEvent(new CustomEvent("reset-viewport")),t.layers.forEach((t=>t.syncRequested=m)),{type:"rotate",counterClock:e.counterClock};case"selectionChange":{const s=t.selection?i.oM(t.selection.mask):void 0;return e.selection?(t.addSelection(),t.selection.setMask(e.selection),Object.assign(Object.assign({},e),{selection:s})):(t.removeSelection(),Object.assign(Object.assign({},e),{selection:s}))}case"merge":{const s=t.layers.findIndex((t=>t===e.target));if(s<0)return;const[i]=t.layers.splice(s,1);return e.layers.forEach((s=>{const i=e.order.findIndex((t=>t===s.id));i<0?t.layers.push(s):t.layers.splice(i,0,s)})),t.getSelected()&&!t.hasLayer(t.getSelected())&&t.selectLayerById(e.layers[0].id),{type:"merge",kind:e.kind,target:i,from:e.layers,order:s}}case"rasterize":{const s=t.layers.findIndex((t=>t.id===e.newId));if(s<0)return;const[i]=t.layers.splice(s,1,e.layer);return(null===(u=null==t?void 0:t.getSelected())||void 0===u?void 0:u.id)===i.id&&t.selectLayerById(e.layer.id),{type:"rasterize",layer:i,kind:e.kind,newId:e.layer.id}}case"convertSelectionToMask":{const s=e.layer.mask;return e.layer.removeMask(),e.layer.syncRequested=m,t.addSelection(),t.selection.mask=e.selection,t.selection.ctx=e.selection.getContext("2d"),t.selection.createOutline(),{type:"convertSelectionToMask",layer:e.layer,mask:s}}case"convertMaskToSelection":{const s=t.selection.mask;return t.removeSelection(),e.layer.mask=e.mask,e.layer.render(),e.layer.syncRequested=m,{type:"convertMaskToSelection",layer:e.layer,selection:s}}case"applyMask":return e.layer.canvas=e.canvas,e.layer.mask=e.mask,e.layer.rect=null===(p=e.rect)||void 0===p?void 0:p.clone(),e.layer.render(),e.layer.syncRequested=m,{type:"applyMask",layer:e.layer};case"frameContent":{let t,s;return e.layer.canvas&&(t=i.oM(e.layer.canvas),s=null===(g=e.layer.trim)||void 0===g?void 0:g.clone()),e.layer.canvas=e.canvas,e.layer.trim=e.trim,e.layer.render(),{type:"frameContent",kind:e.kind,layer:e.layer,canvas:t,trim:s}}case"frameSettings":{const t=e.layer.frameSettings.clone();return e.layer.frameSettings=e.settings,e.layer.prepare(),e.layer.syncRequested=m,{type:"frameSettings",kind:e.kind,layer:e.layer,settings:t}}case"shapeSettings":{const t=e.layer.shapeSettings.clone();return e.layer.shapeSettings=e.settings,await e.layer.prepare(),e.layer.syncRequested=m,{type:"shapeSettings",kind:e.kind,layer:e.layer,settings:t}}case"groupSettings":{const t=e.layer.groupSettings.clone();return e.layer.groupSettings=e.settings,e.layer.syncRequested=m,{type:"groupSettings",kind:e.kind,layer:e.layer,settings:t}}case"pageAnimation":{const s=t.animation?t.animation:void 0;return t.animation=e.animation,{type:"pageAnimation",kind:e.kind,animation:s}}case"layerAnimation":{const t=e.layer.animation?e.layer.animation:void 0;return e.layer.animation=e.animation,e.layer.syncRequested=m,{type:"layerAnimation",kind:e.kind,layer:e.layer,animation:t}}default:throw new Error("No handler for this undo type")}}},97317:(t,e,s)=>{s.d(e,{T:()=>h});var i=s(98244),a=s(54127),n=s(58489),o=s(86445),r=s(10122);function h(t,e){const s=new Date;switch(e.type){case"open":return(0,i.A)("open",e.kind),!0;case"addLayer":return(0,i.A)("layer-add",e.layer.type),!0;case"bitmapSwitch":case"bitmapChange":return(0,i.A)(e.kind),e.layer.syncRequested=s,!0;case"flipLayer":return(0,i.A)("layer-flip"),e.layer.syncRequested=s,!0;case"rotateLayer":return(0,i.A)("layer-rotate"),e.layer.syncRequested=s,!0;case"frameContent":return(0,i.A)("frame-content"),e.layer.syncRequested=s,!0;case"frameSettings":return!e.layer.frameSettings.equalTo(e.settings)&&((0,i.A)("frame-settings"),e.layer.syncRequested=s,!0);case"order":return(0,i.A)("layer-order"),!0;case"layerSettings":return(0,i.A)("layer-settings",e.kind),e.layer.syncRequested=s,!0;case"deleteLayer":return(0,i.A)(e.layer.type+"-delete"),!0;case"textChange":return e.layer.text!==e.text&&((0,i.A)("text-change"),e.layer.syncRequested=s,!0);case"textSettings":return!e.layer.textSettings.equalTo(e.settings)&&((0,i.A)("text-settings"),e.layer.syncRequested=s,!0);case"shapeSettings":return!e.layer.shapeSettings.equalTo(e.settings)&&((0,i.A)("shape-settings"),e.layer.syncRequested=s,!0);case"groupSettings":return!e.layer.groupSettings.equalTo(e.settings)&&((0,i.A)("group-settings"),e.layer.syncRequested=s,!0);case"pageAnimation":return t.animation!==e.animation;case"layerAnimation":return e.layer.animation!==e.animation&&(e.layer.syncRequested=s,!0);case"mask":return(0,i.A)("mask"),e.layer.syncRequested=s,!0;case"crop":return(0,i.A)("crop"),t.layers.forEach((t=>t.syncRequested=s)),!0;case"background":return(0,i.A)("background"),!0;case"maskInvert":return(0,i.A)("mask-invert"),e.layer.syncRequested=s,!0;case"arrange":switch(e.action.type){case"rect":if(e.layer.rect.equalTo(e.action.rect))return!1;break;case"trim":if(e.layer.trim.equalTo(e.action.rect))return!1}return(0,i.A)("arrange"),!0;case"arrangeStack":{let t=!1;for(let s=0;s<e.stack.length;s++)e.stack[s].rect&&!e.stack[s].rect.equalTo(e.rects[s])&&(t=!0);return(0,i.A)("arrangeStack"),t}case"link":(0,i.A)("link");for(let t=0;t<e.stack.length;t++)e.stack[t].layer.syncRequested=s;return!0;case"pageSize":return(0,i.A)("page-size"),t.layers.forEach((t=>t.syncRequested=s)),!0;case"pageResize":return(0,i.A)("page-resize"),e.layers.forEach((t=>t.syncRequested=s)),!0;case"flip":return(0,i.A)("flip",e.vertical?"vertical":"horizontal"),t.layers.forEach((t=>t.syncRequested=s)),!0;case"rotate":return(0,i.A)("rotate",e.counterClock?"left":"right"),t.layers.forEach((t=>t.syncRequested=s)),!0;case"merge":return(0,i.A)("merge-layers",e.kind),!0;case"adjust":return(0,i.A)("adjust",e.kind),!0;case"effect":return(0,i.A)("effect",e.name),!0;case"glitch":return(0,i.A)("glitch",e.kind),!0;case"selectionChange":case"selectionAndBitmapSwitch":return(0,i.A)("selection",e.kind),!0;case"rasterize":return(0,i.A)("rasterize",e.layer.type),e.layer instanceof r.A||(e.layer instanceof a.A||(e.layer instanceof n.A||(e.layer instanceof o.A||(console.warn("Tried to rasterize an unknown layer type"),!1))));case"convertSelectionToMask":return(0,i.A)("selection-to-mask"),e.layer.syncRequested=s,!0;case"convertMaskToSelection":return(0,i.A)("mask-to-selection"),e.layer.syncRequested=s,!0;case"applyMask":return(0,i.A)("apply-mask"),e.layer.syncRequested=s,!0;default:return!1}}},21742:(t,e,s)=>{function i(t,...e){if(!I18N_STRINGS)return t;let s=I18N_STRINGS[t];if(s||(console.log("No translation for key",t),s=t),!e||0===e.length)return s;let i=0;return s.replace(/%(\d+\$)?(s|d|f){1}/gm,((t,...s)=>{const[a,n]=s,o=a?parseInt(a.slice(0,-1),10):i++;switch(n){case"d":const s=e[o];return"number"!=typeof s?"NaN":s.toFixed(0);case"s":const i=e[o];return i?i.toString():t;default:return t}}))}s.d(e,{A:()=>i})},44448:(t,e,s)=>{s.d(e,{A:()=>l});var i=s(15818),a=s(65209),n=s(52549),o=s(59303),r=s(94711),h=s(75281);class l{static init(){l.presets||(l.grouping={"b-w":["agnes","conny","gordon","harrison","henry","logan","olay","porter","sampi","tom","vinny"],friends:["aladin","alex","amber","anne","antonio","bob","greg","hagrid","harry","ivan","jean","josh","karen","lucas","melissa","peter","salomon","sara","sophia","tony"],instage:["borg","carl","coco","doris","doug","earl","sun","blues","country","lemonpell","tiny dc","minker"],retro:["vib","ranguit","rangeen","creamlow","sven","yenely","ragwarm","greered","danligter","garage"],tuning:["punch","bright","contrast","vivid","clairify"],portrait:["matte","deep","film","sunny","gritty"],food:["berry","ensalat","morning","corn","sharp"],urban:["cement","style","mold","shimmer","stalker","sham"],nature:["beach","flower","forest"],colors:["strawberry","clementine","pear","apple","blueberry","grapes","dragon","superone","tonola","reddish","fellowing","grassland","springs","justblues","bluesteel","flowerpot","stinker","violiin","blupur","beyllo","wifortress"],artzy:["poster","glitch","mozak","frank","pinvet","night vision","darkstreet","blomberg","lolita","atonic"]},l.presets={flower:[new a.A("vibrance",.2),new a.A("saturation",.1),new a.A("temperature",.1)],forest:[new a.A("saturation",-.2),new a.A("vibrance",1),new a.A("clarity",.2),new a.A("temperature",.16),new a.A("tint",.2),new a.A("curves",new h.X([[0,0,65,52,173,190,236,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]]))],beach:[new a.A("saturation",.2),new a.A("vibrance",.2),new a.A("curves",new h.X([[0,0,68,56,199,208,255,255],[0,0,255,255],[0,0,98,97,196,201,255,255],[0,0,87,85,201,182,255,255]])),new a.A("temperature",.1)],sham:[new a.A("saturation",-.3),new a.A("fill",new n.A(new i.A(153,221,255),"overlay",.3)),new a.A("curves",new h.X([[60,31,191,217],[0,0,120,134,255,255],[0,0,255,255],[0,0,120,144,255,255]]))],stalker:[new a.A("curves",new h.X([[62,64,190,191],[0,0,133,125,255,255],[0,0,54,65,209,208,255,255],[60,62,96,99,240,230,255,255]])),new a.A("contrast",.1),new a.A("saturation",-.2)],shimmer:[new a.A("temperature",-.2),new a.A("tint",-.12),new a.A("fill",new n.A(new i.A(190,11,255),"screen",.12)),new a.A("curves",new h.X([[8,23,244,227],[0,0,255,255],[0,0,131,124,255,255],[0,0,149,112,255,255]]))],mold:[new a.A("curves",new h.X([[65,64,233,233],[0,0,138,121,255,255],[0,0,60,75,184,184,255,255],[0,0,64,75,181,176,255,255]])),new a.A("contrast",.1),new a.A("saturation",-.12)],style:[new a.A("curves",new h.X([[0,0,73,74,191,177,235,221,255,255],[0,26,89,64,121,126,180,213,255,255],[0,0,71,50,190,210,255,255],[61,64,112,97,199,198,255,255]])),new a.A("vibrance",-.1),new a.A("saturation",-.4),new a.A("temperature",.1)],cement:[new a.A("curves",new h.X([[0,0,73,74,191,177,235,221,255,255],[0,0,255,255],[0,0,60,54,198,210,255,255],[0,0,73,37,150,149,199,198,255,255]])),new a.A("vibrance",-.1),new a.A("saturation",-.1)],sharp:[new a.A("curves",new h.X([[0,0,42,20,199,218,224,246,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new a.A("vibrance",.1),new a.A("sharpen",.1),new a.A("clarity",.1)],corn:[new a.A("temperature",.1),new a.A("vibrance",.3),new a.A("contrast",.1),new a.A("curves",new h.X([[0,0,66,78,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]]))],morning:[new a.A("tint",.18),new a.A("temperature",.1),new a.A("highlights",.08),new a.A("levels",new r.A(0,245,0,255)),new a.A("curves",new h.X([[64,64,150,181,254,255],[0,0,122,138,255,255],[0,0,255,255],[0,0,255,255]])),new a.A("fill",new n.A(new i.A(194,120,41),"overlay",.2))],ensalat:[new a.A("highlights",.2),new a.A("shadows",-.2),new a.A("brightness",.1),new a.A("levels",new r.A(10,245,0,255)),new a.A("curves",new h.X([[0,0,135,119,191,193,255,255],[0,0,255,255],[0,0,129,121,255,255],[0,0,255,255]])),new a.A("clarity",.2),new a.A("sharpen",.15)],berry:[new a.A("vibrance",.44),new a.A("curves",new h.X([[0,0,62,66,121,135,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new a.A("contrast",.2),new a.A("highlights",.4),new a.A("shadows",-.2),new a.A("levels",new r.A(20,255,0,255))],gritty:[new a.A("saturation",-.4),new a.A("levels",new r.A(20,255,0,255)),new a.A("curves",new h.X([[0,0,50,33,128,112,190,215,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new a.A("clarity",1),new a.A("grain",.3)],sunny:[new a.A("fill",new n.A(new i.A(255,194,96),"overlay",.2)),new a.A("temperature",.1),new a.A("glamour",.4),new a.A("clarity",.3)],film:[new a.A("sharpen",.2),new a.A("glamour",.5),new a.A("grain",.5),new a.A("highlights",-.2),new a.A("shadows",-.2),new a.A("saturation",-.2)],matte:[new a.A("curves",new h.X([[0,50,38,56,79,82,152,153,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new a.A("contrast",.12),new a.A("saturation",-.1)],deep:[new a.A("curves",new h.X([[0,0,117,99,191,198,255,255],[0,0,71,38,177,209,255,255],[0,0,236,255],[0,28,75,101,190,171,254,233]])),new a.A("saturation",-.3)],aladin:[new a.A("curves",new h.X([[0,0,255,255],[0,52,87,99,255,255],[0,0,106,107,194,190,254,212],[0,0,166,129,254,142]]))],amber:[new a.A("curves",new h.X([[0,0,255,255],[0,0,98,150,255,255],[0,0,138,117,255,255],[0,128,254,129]])),new a.A("saturation",-.3),new a.A("levels",new r.A(20,235,0,255))],anne:[new a.A("contrast",.25),new a.A("curves",new h.X([[0,0,255,255],[0,0,78,66,135,171,255,255],[0,0,99,87,180,208,255,255],[0,0,94,93,171,161,255,255]]))],antonio:[new a.A("glamour",.8)],alex:[new a.A("glamour",.6)],bob:[new a.A("saturation",-.6),new a.A("highlights",.5)],greg:[new a.A("curves",new h.X([[0,0,255,255],[0,0,74,50,181,198,255,255],[0,0,61,41,108,170,158,207,254,208],[0,0,83,56,168,204,255,255]]))],hagrid:[new a.A("vibrance",.9),new a.A("saturation",.1),new a.A("clarity",.5),new a.A("shadows",-.3)],harry:[new a.A("fill",new n.A(new i.A(214,178,119),"overlay",.7)),new a.A("grain",.5)],ivan:[new a.A("fill",new n.A(new i.A(255,0,68),"overlay",.4)),new a.A("shadows",.15),new a.A("levels",new r.A(6,255,0,255))],jean:[new a.A("levels",new r.A(56,233,0,255)),new a.A("saturation",-1),new a.A("tint",.1),new a.A("exposure",.78),new a.A("bloom",.1)],josh:[new a.A("curves",new h.X([[0,0,78,52,175,207,255,255],[0,0,255,255],[0,0,255,255],[0,64,87,129,254,193]]))],karen:[new a.A("curves",new h.X([[0,0,255,255],[0,0,89,144,255,255],[0,0,138,112,255,255],[0,0,162,88,255,255]]))],lucas:[new a.A("tint",1),new a.A("saturation",-.85),new a.A("contrast",.4),new a.A("shadows",1),new a.A("temperature",.1)],melissa:[new a.A("curves",new h.X([[0,0,255,255],[0,62,255,255],[0,0,255,255],[0,61,254,193]]))],peter:[new a.A("curves",new h.X([[0,0,255,255],[0,6,31,20,65,26,87,51,195,190,254,230],[0,11,24,27,102,131,189,195,255,255],[0,40,126,148,254,177]]))],salomon:[new a.A("curves",new h.X([[0,0,255,255],[0,0,83,50,177,213,255,255],[0,0,69,55,186,205,255,255],[11,56,254,212]])),new a.A("contrast",-.2)],sara:[new a.A("vibrance",1),new a.A("contrast",.1),new a.A("highlights",.3)],sophia:[new a.A("curves",new h.X([[0,0,255,255],[0,0,140,116,222,254],[0,0,70,59,182,201,255,255],[0,29,252,227]])),new a.A("saturation",.3)],tony:[new a.A("curves",new h.X([[0,0,255,255],[0,0,92,42,218,252],[0,0,73,75,157,194,255,255],[0,27,254,227]]))],agnes:[new a.A("desaturate",1),new a.A("contrast",.4)],conny:[new a.A("saturation",-.55),new a.A("temperature",.25),new a.A("brightness",-.25),new a.A("levels",new r.A(14,233,0,255)),new a.A("exposure",.35),new a.A("highlights",-.9)],gordon:[new a.A("desaturate",1),new a.A("temperature",.7),new a.A("tint",.3),new a.A("saturation",-.2)],harrison:[new a.A("toning",new o.A(new i.A(255,240,215),void 0,new i.A(48,26,24),1)),new a.A("grain",.2)],henry:[new a.A("toning",new o.A(new i.A(255,240,215),void 0,new i.A(48,26,24),1)),new a.A("saturation",-.5)],logan:[new a.A("glamour",.5),new a.A("tint",.4),new a.A("saturation",-.35),new a.A("toning",new o.A(new i.A(255,240,215),void 0,new i.A(48,26,24),.8))],olay:[new a.A("saturation",-1),new a.A("grain",.5),new a.A("vignette",.5)],porter:[new a.A("saturation",-1),new a.A("vignette",.4),new a.A("levels",new r.A(50,205))],tom:[new a.A("desaturate",1)],sampi:[new a.A("toning",new o.A(new i.A(255,228,196),void 0,new i.A(0,0,0),1)),new a.A("levels",new r.A(0,217,0,255)),new a.A("temperature",.3)],vinny:[new a.A("curves",new h.X([[0,0,133,111,255,255],[0,0,255,255],[0,0,255,255],[0,0,133,138,255,255]])),new a.A("vibrance",-1),new a.A("saturation",1),new a.A("temperature",.8),new a.A("contrast",-.1),new a.A("highlights",.1)],borg:[new a.A("curves",new h.X([[0,0,255,255],[0,0,94,66,227,255],[0,0,93,94,179,198,255,255],[0,19,254,228]])),new a.A("fill",new n.A(new i.A(204,255,0),"",.1))],carl:[new a.A("curves",new h.X([[0,0,255,255],[0,0,93,64,227,255],[0,0,93,94,181,189,255,255],[0,19,254,228]])),new a.A("vignette",.3),new a.A("contrast",.15),new a.A("saturation",-.3)],coco:[new a.A("curves",new h.X([[0,0,255,255],[0,0,64,97,255,255],[0,0,142,122,255,255],[0,0,144,112,255,255]]))],doris:[new a.A("curves",new h.X([[0,0,255,255],[0,0,78,48,177,209,255,255],[0,0,92,94,179,208,255,255],[0,52,254,215]])),new a.A("saturation",-.2)],doug:[new a.A("curves",new h.X([[0,0,255,255],[0,64,255,255],[0,0,255,255],[1,64,252,193]])),new a.A("highlights",.5),new a.A("shadows",-.3)],earl:[new a.A("vignette",.4),new a.A("curves",new h.X([[0,0,255,255],[0,0,222,254],[0,47,223,254],[0,129,222,255]])),new a.A("fill",new n.A(new i.A(247,218,174),"multiply",.8))],sun:[new a.A("fill",new n.A(new i.A(251,242,163),"multiply",.8)),new a.A("vignette",-.25)],blues:[new a.A("curves",new h.X([[0,0,255,255],[0,0,77,54,181,207,255,255],[0,0,73,51,180,209,255,255],[0,0,54,75,201,185,255,255]]))],country:[new a.A("curves",new h.X([[0,0,84,74,115,105,255,255],[0,0,73,80,93,124,255,255],[0,0,50,34,93,105,119,142,255,255],[0,0,85,85,125,112,255,255]]))],lemonpell:[new a.A("curves",new h.X([[0,36,80,84,156,190,255,255],[0,0,255,255],[0,0,103,105,158,176,255,255],[0,19,107,83,198,196,255,255]]))],"tiny dc":[new a.A("curves",new h.X([[0,0,255,255],[0,0,79,46,199,217,255,255],[9,1,110,126,254,232],[0,46,92,103,191,158,254,205]])),new a.A("grain",.3)],minker:[new a.A("toning",new o.A(new i.A(255,216,153),void 0,new i.A(26,0,77),.8)),new a.A("levels",new r.A(0,247,8,255)),new a.A("brightness",.14),new a.A("contrast",.4),new a.A("vibrance",.5)],superone:[new a.A("toning",new o.A(new i.A(255,216,153),void 0,new i.A(77,0,51),.8)),new a.A("levels",new r.A(50,175,0,255))],tonola:[new a.A("toning",new o.A(new i.A(221,255,153),void 0,new i.A(77,0,51),.8)),new a.A("levels",new r.A(26,213,0,255)),new a.A("saturation",.36),new a.A("temperature",.22)],reddish:[new a.A("toning",new o.A(new i.A(255,214,147),void 0,new i.A(110,37,0),.8)),new a.A("contrast",.3),new a.A("highlights",1)],fellowing:[new a.A("toning",new o.A(new i.A(255,216,153),void 0,new i.A(77,47,0),.8)),new a.A("levels",new r.A(24,203,0,255)),new a.A("contrast",.14),new a.A("saturation",.3),new a.A("temperature",.18)],grassland:[new a.A("toning",new o.A(new i.A(221,255,153),void 0,new i.A(0,77,25),.7)),new a.A("levels",new r.A(18,227,0,255)),new a.A("contrast",.16)],springs:[new a.A("toning",new o.A(new i.A(221,255,153),void 0,new i.A(0,26,38),1)),new a.A("highlights",1),new a.A("levels",new r.A(40,155,0,255)),new a.A("shadows",1)],justblues:[new a.A("toning",new o.A(new i.A(198,236,255),void 0,new i.A(26,0,77),.79)),new a.A("levels",new r.A(16,189,0,255)),new a.A("saturation",.2),new a.A("contrast",.2)],bluesteel:[new a.A("toning",new o.A(new i.A(255,216,153),void 0,new i.A(26,0,77),.8)),new a.A("levels",new r.A(0,215,12,255))],flowerpot:[new a.A("toning",new o.A(new i.A(255,153,221),void 0,new i.A(51,77,0),.8)),new a.A("levels",new r.A(22,215,0,255)),new a.A("vignette",-.2)],stinker:[new a.A("toning",new o.A(new i.A(255,216,153),void 0,new i.A(26,0,77),.8)),new a.A("levels",new r.A(0,247,8,255)),new a.A("brightness",.14),new a.A("contrast",.4)],violiin:[new a.A("contrast",.32),new a.A("toning",new o.A(new i.A(195,166,255),void 0,new i.A(33,0,0),1)),new a.A("levels",new r.A(22,223,0,255)),new a.A("exposure",.22),new a.A("brightness",.12)],blupur:[new a.A("toning",new o.A(new i.A(255,153,221),void 0,new i.A(7,68,97),.8)),new a.A("vibrance",.7),new a.A("contrast",.3)],beyllo:[new a.A("vibrance",1),new a.A("saturation",1),new a.A("temperature",-.55),new a.A("tint",.1),new a.A("levels",new r.A(0,255,24,249)),new a.A("toning",new o.A(new i.A(255,213,0),void 0,new i.A(125,3,84),.76)),new a.A("curves",new h.X([[0,0,255,255],[0,0,131,115,255,255],[0,0,136,128,255,255],[0,0,122,145,255,255]])),new a.A("vignette",.28)],wifortress:[new a.A("toning",new o.A(new i.A(108,206,255),void 0,new i.A(0,26,38),1)),new a.A("highlights",1),new a.A("levels",new r.A(40,155,0,255)),new a.A("shadows",1)],vib:[new a.A("vibrance",.1),new a.A("saturation",.5),new a.A("brightness",.1),new a.A("temperature",.5),new a.A("levels",new r.A(12,253,0,255)),new a.A("highlights",.2),new a.A("curves",new h.X([[0,0,255,255],[0,0,70,80,198,181,255,255],[0,0,140,135,255,255],[0,0,74,96,200,172,255,255]])),new a.A("toning",new o.A(new i.A(255,238,210),void 0,new i.A(54,6,6),.07)),new a.A("contrast",-.1)],ranguit:[new a.A("saturation",.22),new a.A("temperature",.96),new a.A("tint",-.28),new a.A("contrast",.14),new a.A("brightness",-.2),new a.A("levels",new r.A(0,237,56,255)),new a.A("toning",new o.A(new i.A(221,255,153),void 0,new i.A(41,35,33),.26))],rangeen:[new a.A("vibrance",1),new a.A("saturation",.46),new a.A("temperature",.36),new a.A("levels",new r.A(0,251,14,255)),new a.A("shadows",.34),new a.A("highlights",.12),new a.A("toning",new o.A(new i.A(121,255,224),void 0,new i.A(245,22,107),.12)),new a.A("contrast",-.1),new a.A("curves",new h.X([[0,0,144,152,255,255],[0,0,136,107,255,255],[0,0,115,102,255,255],[0,0,106,91,255,255]]))],creamlow:[new a.A("vibrance",.82),new a.A("saturation",-.24),new a.A("temperature",1),new a.A("tint",.78),new a.A("contrast",-.3),new a.A("levels",new r.A(40,247,0,255)),new a.A("highlights",.64),new a.A("toning",new o.A(new i.A(221,255,153),void 0,new i.A(145,39,9),.29)),new a.A("curves",new h.X([[0,0,5,13,78,83,172,162,255,255],[0,0,255,255],[0,0,131,120,255,255],[0,0,68,61,175,184,255,255]]))],sven:[new a.A("vibrance",.7),new a.A("temperature",.5),new a.A("tint",.3),new a.A("exposure",.2),new a.A("contrast",-.2),new a.A("levels",new r.A(4,255,0,235)),new a.A("highlights",-.3),new a.A("shadows",.3),new a.A("grain",.3),new a.A("vignette",.45)],yenely:[new a.A("tint",.5),new a.A("levels",new r.A(0,235,20,255)),new a.A("saturation",-.62),new a.A("contrast",-.3),new a.A("shadows",-.6),new a.A("curves",new h.X([[0,0,148,105,255,255],[0,0,92,79,128,227,255,255],[0,0,74,103,119,172,255,255],[0,0,111,148,255,255]])),new a.A("highlights",1),new a.A("brightness",.14),new a.A("temperature",.3),new a.A("vibrance",1),new a.A("exposure",-.1)],ragwarm:[new a.A("temperature",.62),new a.A("levels",new r.A(32,255,0,243)),new a.A("highlights",-.14),new a.A("vignette",.28),new a.A("toning",new o.A(new i.A(153,255,187),void 0,new i.A(21,55,143),.07)),new a.A("curves",new h.X([[0,0,126,125,255,255],[0,0,255,255],[0,0,130,121,255,255],[0,0,138,124,255,255]]))],greered:[new a.A("vibrance",.32),new a.A("temperature",.4),new a.A("tint",-.5),new a.A("brightness",.24),new a.A("contrast",-.1),new a.A("vignette",.31),new a.A("shadows",.38)],danligter:[new a.A("saturation",.86),new a.A("temperature",-1),new a.A("tint",-.92),new a.A("brightness",.22),new a.A("exposure",.22),new a.A("contrast",.1),new a.A("levels",new r.A(0,239,0,255)),new a.A("highlights",-.12),new a.A("dehaze",-.12),new a.A("toning",new o.A(new i.A(255,216,153),void 0,new i.A(0,52,77),.14)),new a.A("curves",new h.X([[0,0,255,255],[0,0,96,115,162,194,255,255],[0,0,101,97,185,189,255,255],[0,0,144,130,222,228,255,255]]))],garage:[new a.A("tint",.6),new a.A("saturation",-.04),new a.A("shadows",-1),new a.A("grain",.42),new a.A("glamour",.3)],strawberry:[new a.A("fill",new n.A(new i.A(255,0,0),"soft-light",.5))],clementine:[new a.A("fill",new n.A(new i.A(255,158,0),"soft-light",.5))],pear:[new a.A("fill",new n.A(new i.A(170,255,0),"soft-light",.5))],apple:[new a.A("fill",new n.A(new i.A(0,255,85),"soft-light",.5))],blueberry:[new a.A("fill",new n.A(new i.A(0,170,255),"soft-light",.5))],grapes:[new a.A("fill",new n.A(new i.A(85,0,255),"soft-light",.5))],dragon:[new a.A("fill",new n.A(new i.A(255,0,170),"soft-light",.5))],punch:[new a.A("curves",new h.X([[0,0,80,64,173,193,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new a.A("vibrance",.5)],bright:[new a.A("highlights",-.3),new a.A("shadows",.5),new a.A("levels",new r.A(0,215,10,255))],contrast:[new a.A("contrast",.2),new a.A("highlights",.2),new a.A("levels",new r.A(20,215,0,255)),new a.A("shadows",.4)],vivid:[new a.A("vibrance",.4),new a.A("shadows",.25)],clairify:[new a.A("clarity",.6),new a.A("sharpen",.1),new a.A("glamour",.2)],poster:[new a.A("posterize",.08)],glitch:[new a.A("slice",{seed:86,amount:4,distance:.12,line:!0}),new a.A("bleed",{seed:58,amplitude:.05,block:1.2})],mozak:[new a.A("mosaic",.5),new a.A("fringe",.2)],frank:[new a.A("fringe",.4)],pinvet:[new a.A("bloom",.33),new a.A("invert",1),new a.A("pixelate",.7)],blomberg:[new a.A("bloom",.33),new a.A("invert",1),new a.A("tint",1),new a.A("temperature",-.8),new a.A("saturation",-.5)],lolita:[new a.A("fill",new n.A(new i.A(255,153,153),"vivid-light",1))],atonic:[new a.A("curves",new h.X([[0,0,255,255],[6,235,246,4],[131,3,138,255],[1,42,251,213]]))],"night vision":[new a.A("fill",new n.A(new i.A(30,255,0),"multiply",1)),new a.A("levels",new r.A(0,183,0,255)),new a.A("vignette",.85),new a.A("grain",.6)],darkstreet:[new a.A("temperature",-1),new a.A("highlights",.58),new a.A("shadows",-1),new a.A("levels",new r.A(100,249,0,255)),new a.A("grain",1),new a.A("exposure",-1)],splash:[new a.A("desaturate",1)],blur:[new a.A("blur",.5)],zoom:[new a.A("zoom",{x:.5,y:.5,amount:.2})],spin:[new a.A("radial",{amount:.08,x:.5,y:.5,direction:2,symmetry:!1})],motion:[new a.A("motion",{amount:.7,angle:Math.PI/1.8*.23})],mozaik:[new a.A("mosaic",.5)],pixel:[new a.A("pixelate",.7)]})}static named(t){return l.init(),this.presets[t]}static firstInGroup(t){return l.init(),l.grouping[t][0]}static groupLength(t){return l.grouping[t].length}static groups(){l.init();const t=[];for(const e in l.grouping)t.push(e);return t}static names(t){l.init();const e=[];for(const s in l.grouping[t])e.push(l.grouping[t][s]);return e}}},59350:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(42268),a=s(54738),n=s(15818),o=s(41915),r=s(71499);class h{constructor(t){this.getSettingsString=()=>JSON.stringify(this.settings),this.setSettingsString=t=>{this.settings=a.bD(r.A,JSON.parse(t)),this.generate()},this.getStep=()=>Math.round(this.settings.distance*this.settings.size),this.getCursorImage=(t,e=new n.A(255,255,255,255))=>{if(!(this.canvas.width*t>512||this.canvas.height*t>512))return this.generatetOutline(t,e)},this.generateBasic=(t,e)=>{let s=this.settings.softness;if(this.settings.size<3){if(1===this.settings.size||s<.25)return this.canvas.width=this.settings.size,this.canvas.height=this.settings.size,this.context.fillStyle=t.toRGBA(),void this.context.fillRect(0,0,this.canvas.width,this.canvas.height);s-=.25}const i=this.settings.size,a=(i%2?i:i+1)/2;let n,r,h,l,c,d,u,p,g,m=0,v=0,y=new o.A(0,0),f=new o.A(0,0);switch(d=Math.sin(this.settings.angle*Math.PI/180),c=Math.cos(this.settings.angle*Math.PI/180),g=a*this.settings.aspect,y.x=c*a,y.y=d*a*-1,f.x=d*g,f.y=c*g,this.settings.type){case"circle":m=Math.ceil(Math.sqrt(y.x*y.x+f.x*f.x)),v=Math.ceil(Math.sqrt(y.y*y.y+f.y*f.y));break;case"square":m=Math.ceil(Math.abs(y.x)+Math.abs(f.x)),v=Math.ceil(Math.abs(y.y)+Math.abs(f.y));break;case"diamond":m=Math.ceil(Math.max(Math.abs(y.x),Math.abs(f.x))),v=Math.ceil(Math.max(Math.abs(y.y),Math.abs(f.y)))}this.settings.spikes>2&&(m=v=Math.ceil(Math.sqrt(a*a+g*g)),f.x=d*a,f.y=c*a),this.canvas.width=2*m+1,this.canvas.height=2*v+1;const w=this.lookupTable(a,s);u=Math.cos(-2*Math.PI/this.settings.spikes),p=Math.sin(-2*Math.PI/this.settings.spikes);const x=this.context.canvas.width,b=this.context.getImageData(0,0,x,this.context.canvas.height);for(h=-v;h<=v;++h)for(r=-m;r<=m;++r){let s=0,i=c*r-d*h,o=Math.abs(d*r+c*h);if(this.settings.spikes>2){let t,e,s=Math.atan2(o,i);for(;s>Math.PI/this.settings.spikes;)e=i,t=o,i=u*e-p*t,o=p*e+u*t,s-=2*Math.PI/this.settings.spikes}switch(o/=this.settings.aspect,this.settings.type){case"circle":s=Math.sqrt(i*i+o*o);break;case"square":s=Math.max(Math.abs(i),Math.abs(o));break;case"diamond":s=Math.abs(i)+Math.abs(o)}n=s<a+1?w[Math.floor(4*s)]:0,e&&(n=n<64?0:255),l=4*((h+v)*x+(r+m)),b.data[l]=t.r,b.data[l+1]=t.g,b.data[l+2]=t.b,b.data[l+3]=n}this.context.putImageData(b,0,0)},this.generateCustom=(t,e)=>{},this.canvas=(0,i.T)("canvas"),this.settings=t,this.context=this.canvas.getContext("2d",{willReadFrequently:!0}),this.generate()}generate(t=new n.A,e=!1){"custom"===this.settings.type?this.generateCustom(t,e):this.generateBasic(t,e)}generatetOutline(t=1,e=new n.A(255,255,255,255)){const s=Math.round(this.canvas.width*t)||1,i=Math.round(this.canvas.height*t)||1;let o=a.VI(s+2,i+2);const r=o.getContext("2d");r.fillStyle=e.toRGBA(),r.shadowColor=new n.A(0,0,0).toRGBA(),r.shadowBlur=1,s>20&&i>20&&(r.fillRect(~~(s/2)-3,~~(i/2),8,2),r.fillRect(~~(s/2),~~(i/2)-3,2,8));let h,l,c,d,u,p=1!=t?a.H5(this.canvas,s,i,!1).getContext("2d").getImageData(0,0,s,i):this.context.getImageData(0,0,s,i);for(let a=0;a<i;++a){l=!0,c=Boolean(p.data[a*s*4+3]<64);for(let t=0;t<s;++t)h=l,l=c,c=t+1===s||p.data[4*(a*s+t+1)+3]<64,l||(d=a-1<0||p.data[4*((a-1)*s+t)+3]<64,u=a+1===i||p.data[4*((a+1)*s+t)+3]<64,(h||d||c||u)&&r.fillRect(t+1,a+1,1,1))}if(s<=20&&i<=20){const t=a.VI(33,33),s=t.getContext("2d");s.drawImage(o,Math.floor((33-o.width)/2),Math.floor((33-o.height)/2)),s.fillStyle=e.toRGBA(),s.shadowColor=new n.A(0,0,0).toRGBA(),s.shadowBlur=1,s.fillRect(2,15,4,2),s.fillRect(26,15,4,2),s.fillRect(15,2,2,4),s.fillRect(15,26,2,4),o=t}return o}lookupTable(t,e){const s=new Array;let i,a,n=0;const o=new Array(4),r=Math.round(t+1),h=4*Math.ceil(1+Math.sqrt(r*r*2));let l;for(a=e<4e-7?1e6:.4/e,l=0;l<4;l++)i=Math.abs((l+.5)/4-.5),o[l]=i>t?0:this.gaussian(Math.pow(i/t,a)),n+=o[l];for(l=0;i<t||n>1e-5;i+=1/4){n-=o[l%4],o[l%4]=i>t?0:this.gaussian(Math.pow(i/t,a)),n+=o[l%4];let e=Math.floor(63.75*n);s[l++]=Math.max(0,e)}for(;l<h;)s[l++]=0;return s}gaussian(t){return t<-.5?2*(t=-1-t)*t:t<.5?1-2*t*t:2*(t=1-t)*t}}},71499:(t,e,s)=>{s.d(e,{A:()=>a});class i{constructor(t="circle",e=40,s=.2,i=1,a=0,n=1,o=2,r=.2,h=void 0){this.type=t,this.size=e,this.softness=s,this.opacity=i,this.angle=a,this.aspect=n,this.spikes=o,this.distance=r,this.source=h}}i.isEqual=(t,e)=>!(!t||!e)&&(t.type===e.type&&t.size===e.size&&t.softness===e.softness&&t.angle===e.angle&&t.aspect===e.aspect&&t.spikes===e.spikes&&t.source===e.source);const a=i},94711:(t,e,s)=>{s.d(e,{A:()=>i});class i{constructor(t=0,e=255,s=0,i=255,a=1,n=.5){this.minin=t,this.maxin=e,this.minout=s,this.maxout=i,this.midin=a,this.mid=n,this.map=t=>(t=(t-this.minin)/(this.maxin-this.minin),t=Math.pow(t,this.midin),(t=this.minout+t*(this.maxout-this.minout))>this.maxout?t=this.maxout:t<this.minout&&(t=this.minout),Math.round(t))}reset(){this.minout=0,this.maxout=255,this.midin=1,this.minin=0,this.maxin=255,this.mid=.5}isFlat(){return Boolean(0==this.minout&&255==this.maxout&&.5==this.mid&&0==this.minin&&255==this.maxin)}setMid(t){this.mid=(t-this.minin)/(this.maxin-this.minin),this.midin=this.midToIn(this.mid)}midToIn(t){return Math.min(Math.max(Math.pow(9.99,2*t-1),.1),9.99)}static fillPaletteMap(t,e){for(let s=0;s<256;++s){let i=t.map(s);e.data[4*s]=i,e.data[4*s+1]=i,e.data[4*s+2]=i}}static fillRGBPaletteMap(t,e,s,i){for(let a=0;a<256;++a)i.data[4*a]=t?t.map(a):a,i.data[4*a+1]=e?e.map(a):a,i.data[4*a+2]=s?s.map(a):a}}},95009:(t,e,s)=>{s.d(e,{A:()=>i});class i{constructor(t,e){var s,i,a,n,o,r,h,l,c,d,u,p,g;if(null!=t&&null!=e){for(l=t.length-1,n=[],u=[],h=[],d=[],p=[],i=[],s=[],a=[],r=[],c=[],o=0;0<=l?o<l:o>l;0<=l?o+=1:o-=1)n[o]=t[o+1]-t[o],r[o]=e[o+1]-e[o],c[o]=r[o]/n[o];for(o=1;1<=l?o<l:o>l;1<=l?o+=1:o-=1)u[o]=3/n[o]*(e[o+1]-e[o])-3/n[o-1]*(e[o]-e[o-1]);for(h[0]=1,d[0]=0,p[0]=0,o=1;1<=l?o<l:o>l;1<=l?o+=1:o-=1)h[o]=2*(t[o+1]-t[o-1])-n[o-1]*d[o-1],d[o]=n[o]/h[o],p[o]=(u[o]-n[o-1]*p[o-1])/h[o];for(h[l]=1,p[l]=0,i[l]=0,o=g=l-1;g<=0?o<=0:o>=0;g<=0?o+=1:o-=1)i[o]=p[o]-d[o]*i[o+1],s[o]=(e[o+1]-e[o])/n[o]-n[o]*(i[o+1]+2*i[o])/3,a[o]=(i[o+1]-i[o])/(3*n[o]);this.x=t.slice(0,l+1),this.a=e.slice(0,l),this.b=s,this.c=i.slice(0,l),this.d=a}}interpolate(t){var e,s,i;for(s=i=this.x.length-1;(i<=0?s<=0:s>=0)&&!(this.x[s]<=t);i<=0?s+=1:s-=1);return e=t-this.x[s],this.a[s]+this.b[s]*e+this.c[s]*Math.pow(e,2)+this.d[s]*Math.pow(e,3)}}},75281:(t,e,s)=>{s.d(e,{A:()=>o,X:()=>n});var i=s(41915),a=s(95009);class n{constructor(t){this.preset=t}static createCurveSet(t){const e=new Array,s=new Array,a=new Array,n=new Array;for(let o=0;o<t.preset[0].length;o+=2)e.push(new i.A(t.preset[0][o],t.preset[0][o+1]));for(let o=0;o<t.preset[1].length;o+=2)s.push(new i.A(t.preset[1][o],t.preset[1][o+1]));for(let o=0;o<t.preset[2].length;o+=2)a.push(new i.A(t.preset[2][o],t.preset[2][o+1]));for(let o=0;o<t.preset[3].length;o+=2)n.push(new i.A(t.preset[3][o],t.preset[3][o+1]));return new o(1,e,s,a,n)}}class o{constructor(t=255,e=[],s=[],i=[],a=[]){this.scale=t,this.rgb=e,this.red=s,this.green=i,this.blue=a,this.percent=1}static getInterpolation(t,e){let s=[],i=[],n=new Float32Array(256);for(var o=0;o<e.length;o++)s.push(e[o].x*t),i.push(e[o].y*t);let r=new a.A(s,i);for(var h=0;h<Math.ceil(s[0]);h++)n[h]=i[0];for(h=Math.ceil(s[0]);h<Math.ceil(s[s.length-1]);h++)n[h]=r.interpolate(h);for(h=Math.ceil(s[s.length-1]);h<256;h++)n[h]=i[i.length-1];return n}static fillPaletteMap(t,e){let s=o.getInterpolation(t.scale,t.rgb),i=o.getInterpolation(t.scale,t.red),a=o.getInterpolation(t.scale,t.green),n=o.getInterpolation(t.scale,t.blue);for(let o=0;o<256;++o){let r=o-s[o];e.data[4*o]=o-Math.round((o-(i[o]-r))*t.percent),e.data[4*o+1]=o-Math.round((o-(a[o]-r))*t.percent),e.data[4*o+2]=o-Math.round((o-(n[o]-r))*t.percent)}}}},52549:(t,e,s)=>{s.d(e,{A:()=>i});class i{constructor(t,e,s){this.color=t,this.blend=e,this.amount=s}}},26651:(t,e,s)=>{s.d(e,{A:()=>y});var i=s(42268),a=s(21742),n=s(54738),o=s(53900),r=s(40963),h=s(7245),l=s(41915),c=s(29755),d=s(22866),u=s(21404),p=s(54127),g=s(58489),m=s(39989),v=s(21079);class y{constructor(t,e){this.addPointer=t=>{this.pointers.push(t),this.stage.raster.setPointerCapture(t)},this.removePointer=t=>{for(let e=0;e<this.pointers.length;e++)if(this.pointers[e]===t){this.pointers.splice(e,1);break}this.stage.raster.releasePointerCapture(t)},this.addListener=()=>{this.stage.raster.addEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.addEventListener("pointermove",this.pointerMove,!1),this.stage.raster.addEventListener("pointerup",this.pointerUp,!1),this.raster.addEventListener("dblclick",this.dblClick,!1),this.raster.addEventListener("contextmenu",this.contextMenu,!0),document.addEventListener("viewport-render",this.render,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1)},this.removeListener=()=>{this.ctx.clearRect(0,0,this.raster.width,this.raster.width),this.stage.raster.removeEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.removeEventListener("pointermove",this.pointerMove,!1),this.stage.raster.removeEventListener("pointerup",this.pointerUp,!1),this.raster.removeEventListener("dblclick",this.dblClick,!1),this.raster.removeEventListener("contextmenu",this.contextMenu,!0),document.removeEventListener("viewport-render",this.render,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1)},this.pointerDown=t=>{if(t.stopPropagation(),!this.stage.coating.override&&1===t.button)return this.stage.coating.setPan(this.stage.coating.raster,!0),this.stage.coating.panDown(t),!1;if(this.stage.coating.override||t.button>0)return;this.isShiftDown=t.shiftKey,this.addPointer(t.pointerId);const e=c.Ay.isHDPI?2:1;1===this.pointers.length&&this.down(new l.A(t.offsetX*e,t.offsetY*e),t.shiftKey||t.ctrlKey,t.altKey,t.ctrlKey,t.pointerType)},this.pointerMove=t=>{t.stopPropagation(),this.isShiftDown=t.shiftKey;const e=c.Ay.isHDPI?2:1;this.pointers.length<2&&this.move(new l.A(t.offsetX*e,t.offsetY*e),t.pointerType)},this.pointerUp=t=>{t.stopPropagation(),this.removePointer(t.pointerId);const e=c.Ay.isHDPI?2:1;this.up(new l.A(t.offsetX*e,t.offsetY*e),t.pointerType)},this.supress=t=>{t&&!this.supressed?(this.raster.style.cursor="unset",this.supressed=!0,this.removeListener()):!t&&this.supressed&&(this.supressed=!1,this.addListener())},this.keyDown=t=>{if(!(document.getElementsByClassName("modal").length>0||"INPUT"===document.activeElement.nodeName||"TEXTAREA"===document.activeElement.nodeName||"SELECT"===document.activeElement.nodeName||"ArrowUp"!==t.key&&"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key)){let e=t.shiftKey?10:1,s="ArrowLeft"===t.key||"ArrowRight"===t.key?"ArrowLeft"===t.key?-e:e:0,i="ArrowUp"===t.key||"ArrowDown"===t.key?"ArrowUp"===t.key?-e:e:0;this.step(s,i)}},this.keyUp=t=>{},this.contextMenu=t=>{if(c.Ay.canTouch&&this.stage.canvas.clientWidth<420)return;if(t.preventDefault(),t.stopPropagation(),"SIMPLE"===this.mode)return;const e=new l.A(t.clientX-this.raster.offsetLeft,t.clientY-this.raster.offsetTop),s=this.stage.fresco.getSelectedStack();if(0===s.length)return;const i=new Array;if(1===s.length){const t=s[0];t.type===d.A.TYPE_TEXT&&i.push(new v.kt((0,a.A)("titleEditText"),(()=>this.dblClick())),new v.kt((0,a.A)("titleRasterizeLayer"),(()=>this.stage.rasterize())),new v.kt),t.type!==d.A.TYPE_SHAPE&&t.type!==d.A.TYPE_ELEMENT||i.push(new v.kt((0,a.A)("titleRasterizeLayer"),(()=>this.stage.rasterize())),new v.kt),t.type===d.A.TYPE_FRAME&&i.push(new v.kt(t.canvas?(0,a.A)("titleChangeImage"):(0,a.A)("titleAddImage"),(()=>this.stage.browseFrameImage())),new v.kt(t.editMode?(0,a.A)("titlePositionFrame"):(0,a.A)("titlePositionContent"),t.canvas?this.dblClick:void 0),new v.kt((0,a.A)("titleAutoFitContent"),t.canvas?()=>this.stage.fitFrameContent():void 0),new v.kt((0,a.A)("titleRasterizeLayer"),t.canvas?()=>this.stage.rasterize():void 0),new v.kt((0,a.A)("titleRemoveFrameImage"),t.canvas?()=>this.stage.deleteLayer(!0):void 0),new v.kt),i.push(new v.kt((0,a.A)("titleHideLayer"),(()=>this.stage.changeVisible(t,!1))),new v.kt((0,a.A)("titleLockLayer"),(()=>this.stage.changeLocked(t,!0)))),t.hasLink()&&i.push(new v.kt((0,a.A)("titleUnlinkLayer"),(()=>this.stage.linkLayer()))),i.push(new v.kt,new v.kt((0,a.A)("titleCutLayer"),(()=>this.stage.cutLayer()),"Ctrl + X"),new v.kt((0,a.A)("titleCopyLayer"),(()=>this.stage.copyLayer()),"Ctrl + C"),new v.kt((0,a.A)("titlePasteLayer"),(()=>document.dispatchEvent(new CustomEvent("paste-menu"))),"Ctrl + V"),new v.kt((0,a.A)("titleDuplicateLayer"),(()=>this.stage.duplicateLayer()),"Ctrl + D"),new v.kt((0,a.A)("titleDeleteLayer"),(()=>this.stage.deleteLayer()),"DEL")),t instanceof m.A&&t.hasMask()&&i.push(new v.kt,new v.kt((0,a.A)("titleLayerApplyMask"),(()=>this.stage.maskApply())),new v.kt((0,a.A)("titleLayerDeleteMask"),(()=>this.stage.maskDelete())))}else i.push(new v.kt(this.stage.fresco.isSelectedLinked()?(0,a.A)("titleUnlinkLayers"):(0,a.A)("titleLinkLayers"),(()=>this.stage.linkLayer())),new v.kt,new v.kt((0,a.A)("titleCutLayers"),(()=>this.stage.cutLayer()),"Ctrl + X"),new v.kt((0,a.A)("titleCopyLayers"),(()=>this.stage.copyLayer()),"Ctrl + C"),new v.kt((0,a.A)("titlePasteLayers"),Array.isArray(this.stage.clipboard)?()=>this.stage.pasteLayer():void 0,"Ctrl + V"),new v.kt((0,a.A)("titleDuplicateLayers"),(()=>this.stage.duplicateLayer()),"Ctrl + D"),new v.kt((0,a.A)("titleDeleteLayers"),(()=>this.stage.deleteLayer()),"DEL"));const n=this.getLayersAt(e);if(n.length>1){const t=new Array;n.forEach((e=>{t.push(new v.kt(e.settings.name,(()=>this.stage.selectLayerById(e.id))))})),i.push(new v.kt,new v.kt((0,a.A)("titleSelectLayer"),void 0,void 0,void 0,t))}new v.Ay(new l.A(t.clientX,t.clientY),i)},this.setMode=t=>{this.mode=t,"ARRANGE"===this.mode||"SIMPLE"===this.mode?this.defaultCursor="unset":"TEXT"===this.mode?this.defaultCursor="text":this.defaultCursor="crosshair",this.render()},this.down=async(t,e,s,i,a)=>{if("INPUT"===document.activeElement.nodeName&&"radio"!==document.activeElement.getAttribute("type")||"SELECT"===document.activeElement.nodeName)return;"mouse"!==a&&this.move(t,a),this.isDown=!0,this.layerOver=void 0,this.downPoint=this.stage.translateRasterToFresco(t,void 0,!1);let n=this.stage.fresco.getSelectedLinkedStack();const o=n.length>1||1===n.length&&("TEXT"===this.mode&&n[0].type===d.A.TYPE_TEXT||"FRAME"===this.mode&&n[0].type===d.A.TYPE_FRAME||"SHAPE"===this.mode&&n[0].type===d.A.TYPE_SHAPE);if(!this.isControl(n,t)&&c.Ay.autoSelect){let s=this.getLayerAt(t);!this.stage.fresco.isSelectedById(null==s?void 0:s.id)||i?(this.stage.selectLayer(s,e,i,!0),n=this.stage.fresco.getSelectedLinkedStack(),this.method="move"):window.requestAnimationFrame(this.render)}if(n.length>0){s&&(await this.stage.duplicateLayer(!1),n=this.stage.fresco.getSelectedLinkedStack());let t=1===n.length;if(!t||this.shouldReformLayer(n[0])){let e,s;if(t&&n[0].editMode&&n[0]instanceof g.A?(this.anchorAlt=this.getAnchor(n[0].trim,n[0].trim.center(),0),this.downRect=[n[0].trim.clone()]):this.downRect=this.stage.fresco.getStackRect(n),t)s=n[0].rect.center(),e=n[0].editMode?n[0].trim:n[0].rect,e.rotation=n[0].rect.rotation;else{for(let t of n)t.rect&&(e=r.A.merge(e,t.rect.getRotatedBounds()));s=e?e.center():void 0}if("rotate"===this.method)this.raster.style.cursor="grabbing",this.downRotation=180/Math.PI*Math.atan2(this.downPoint.y-s.y,this.downPoint.x-s.x)-e.rotation;else if("move"!==this.method){let t,i;switch(this.method){case"nw-resize":i=e.topLeft(),t=e.bottomRight();break;case"n-resize":i=new l.A(s.x,e.y),t=new l.A(s.x,e.bottom());break;case"ne-resize":i=e.topRight(),t=e.bottomLeft();break;case"e-resize":i=new l.A(e.right(),s.y),t=new l.A(e.x,s.y);break;case"se-resize":i=e.bottomRight(),t=e.topLeft();break;case"s-resize":case"t-resize":i=new l.A(s.x,e.bottom()),t=new l.A(s.x,e.y);break;case"sw-resize":i=e.bottomLeft(),t=e.topRight();break;case"w-resize":i=new l.A(e.x,s.y),t=new l.A(e.right(),s.y)}this.downControl=this.rotatePoint(i,s,360-e.rotation),this.downAnchor=this.rotatePoint(t,s,360-e.rotation)}else this.downControl=e.topLeft()}}this.proxy&&(0===n.length||1===n.length&&!this.shouldReformLayer(n[0]))?this.proxy(t,o):(0===n.length||1===n.length&&n[0].settings.locked)&&(this.downPoint=t,this.method="select")},this.move=(t,e)=>{if(this.stage.fresco)if(this.isDown)this.stage.fresco.isSelectedLinkedStack()&&this.downRect.length>0?this.moveStack(t):this.stage.fresco.hasSelected()&&this.downRect.length>0?this.moveSingle(t):"select"===this.method&&(this.stage.coating.ctx.lineWidth=2,this.stage.coating.ctx.strokeStyle=n.bi,this.stage.coating.ctx.clearRect(0,0,this.stage.coating.ctx.canvas.width,this.stage.coating.ctx.canvas.height),this.stage.coating.ctx.strokeRect(this.downPoint.x,this.downPoint.y,t.x-this.downPoint.x,t.y-this.downPoint.y));else{if("INPUT"===document.activeElement.nodeName||"TEXTAREA"===document.activeElement.nodeName||"SELECT"===document.activeElement.nodeName)return void(this.raster.style.cursor="unset");let e=this.stage.fresco.getSelectedLinkedStack();if(this.isControl(e,t))this.layerOver&&(this.layerOver=void 0,window.requestAnimationFrame(this.render));else if(c.Ay.autoSelect){let e=this.getLayerAt(t);if(this.layerOver&&this.layerOver===e)return;this.raster.style.cursor=this.method=e?"move":"ARRANGE"===this.mode||"SIMPLE"===this.mode?"unset":this.defaultCursor,e&&!this.stage.fresco.isSelectedLinkedById(e.id)?(this.layerOver=e,window.requestAnimationFrame(this.render)):this.layerOver&&(this.layerOver=void 0,window.requestAnimationFrame(this.render))}else 1!==e.length||e[0].settings.locked?this.raster.style.cursor=this.method=this.defaultCursor:this.raster.style.cursor=this.method="move"}},this.moveSingle=t=>{const e=this.stage.translateRasterToFresco(t,void 0,!1),s=this.stage.fresco.getSelected();if(this.shouldReformLayer(s)){if("move"===this.method){if(s instanceof g.A)if(s.editMode&&s.trim){const t=this.rotatePoint(e,s.rect.center(),s.rect.rotation),i=this.rotatePoint(this.downPoint,s.rect.center(),s.rect.rotation);s.position(Math.round(this.downControl.x+(t.x-i.x)),Math.round(this.downControl.y+(t.y-i.y)))}else s.position(Math.round(this.downControl.x+(e.x-this.downPoint.x)),Math.round(this.downControl.y+(e.y-this.downPoint.y)));else{if(this.isShiftDown){const t=Math.abs(this.downPoint.x-e.x),s=Math.abs(this.downPoint.y-e.y);(t>4||s>4)&&(t<s?(e.x=this.downPoint.x,this.method="vertical"):(e.y=this.downPoint.y,this.method="horizontal"))}s.position(Math.round(this.downControl.x+(e.x-this.downPoint.x)),Math.round(this.downControl.y+(e.y-this.downPoint.y)))}this.checkMoveGuides()}else if("vertical"===this.method)this.isShiftDown||(this.method="move"),s.position(void 0,Math.round(this.downControl.y+(e.y-this.downPoint.y))),this.checkMoveGuides();else if("horizontal"===this.method)this.isShiftDown||(this.method="move"),s.position(Math.round(this.downControl.x+(e.x-this.downPoint.x)),void 0),this.checkMoveGuides();else if("rotate"===this.method){const t=s.rect.center();let i=180/Math.PI*Math.atan2(e.y-t.y,e.x-t.x)-this.downRotation;this.isShiftDown&&(i=11.25*Math.round(i/11.25)),i<0?i+=360:i>=360&&(i-=360),s.rect.rotation=i}else{let t=e.neg(this.downPoint),i=this.downAnchor,a=this.downControl.add(t);if(a=this.checkReformGuides(a),0!==s.rect.rotation){const t=new l.A((i.x+a.x)/2,(i.y+a.y)/2);a=this.rotatePoint(a,t,s.rect.rotation),i=this.rotatePoint(i,t,s.rect.rotation)}let n=(void 0!==this.constrain?this.constrain:!this.isShiftDown)?this.downRect[0].getAspect():0;switch(this.method){case"nw-resize":case"w-resize":s.calculate(a,i,n);break;case"ne-resize":s.calculate(new l.A(i.x,a.y),new l.A(a.x,i.y),n);break;case"sw-resize":s.calculate(new l.A(a.x,i.y),new l.A(i.x,a.y),n);break;case"se-resize":case"e-resize":s.calculate(i,a,n);break;case"t-resize":let t=a.y-i.y;t<10&&(t=10),s.rect.height=Math.round(t),s.rect.width=Math.round(this.downRect[0].width*(t/this.downRect[0].height))}if(s.editMode&&s instanceof g.A){let t=this.anchorAlt.neg(this.getAnchor(s.trim,s.trim.center(),0));s.trim.x=Math.round(s.trim.x+t.x),s.trim.y=Math.round(s.trim.y+t.y)}else{let t=this.downAnchor.neg(this.getAnchor(s.rect,s.rect.center(),s.rect.rotation));s.rect.x=Math.round(s.rect.x+t.x),s.rect.y=Math.round(s.rect.y+t.y)}"t-resize"===this.method&&s instanceof p.A?s.scaleBect(s.rect.height/this.downRect[0].height):!s.editMode&&s instanceof g.A?s.scaleTrim(s.rect.width/this.downRect[0].width,s.rect.height/this.downRect[0].height):s.render()}window.requestAnimationFrame((()=>{this.stage.render(),this.render()})),document.dispatchEvent(new CustomEvent("layer-arrange"))}},this.moveStack=t=>{const e=this.stage.translateRasterToFresco(t,void 0,!1),s=this.stage.fresco.getSelectedLinkedStack();if("move"===this.method){if(this.isShiftDown){const t=Math.abs(this.downPoint.x-e.x),s=Math.abs(this.downPoint.y-e.y);(t>4||s>4)&&(t<s?(e.x=this.downPoint.x,this.method="vertical"):(e.y=this.downPoint.y,this.method="horizontal"))}for(let t=0;t<s.length;t++)this.downRect[t]&&s[t].position(Math.round(this.downRect[t].x+(e.x-this.downPoint.x)),Math.round(this.downRect[t].y+(e.y-this.downPoint.y)));this.checkMoveGuides()}else if("vertical"===this.method){this.isShiftDown||(this.method="move");for(let t=0;t<s.length;t++)this.downRect[t]&&s[t].position(void 0,Math.round(this.downRect[t].y+(e.y-this.downPoint.y)));this.checkMoveGuides()}else if("horizontal"===this.method){this.isShiftDown||(this.method="move");for(let t=0;t<s.length;t++)this.downRect[t]&&s[t].position(Math.round(this.downRect[t].x+(e.x-this.downPoint.x)),void 0);this.checkMoveGuides()}else{let t=e.neg(this.downPoint),i=this.downControl.add(t);i=this.checkReformGuides(i);let a=r.A.calculate(this.downAnchor,this.downControl),n=r.A.calculate(this.downAnchor,i,a.getAspect());n.width<4&&(n.width=4);let o=n.getComparedScale(a),h=this.downAnchor.neg(this.getAnchor(n,n.center(),0));n.x+=h.x,n.y+=h.y;for(let e=0;e<s.length;e++){let t=this.downRect[e];if(t){let i=s[e];i.rect.x=Math.round(n.x+(t.x-a.x)*o.width),i.rect.y=Math.round(n.y+(t.y-a.y)*o.height),i.rect.width=Math.round(t.width*o.width),i.rect.height=Math.round(t.height*o.height),i.rect.width<1&&(i.rect.width=1),i.rect.height<1&&(i.rect.height=1),i instanceof p.A?i.scaleBect(o.width):i instanceof g.A?i.scaleTrim(o.width,o.height):i.render()}}}window.requestAnimationFrame((()=>{this.stage.render(),this.render()})),document.dispatchEvent(new CustomEvent("layer-arrange"))},this.getAnchor=(t,e,s)=>{let i;switch(this.method){case"nw-resize":i=t.bottomRight();break;case"n-resize":i=new l.A(e.x,t.bottom());break;case"ne-resize":i=t.bottomLeft();break;case"e-resize":i=new l.A(t.x,e.y);break;case"se-resize":default:i=t.topLeft();break;case"s-resize":case"t-resize":i=new l.A(e.x,t.y);break;case"sw-resize":i=t.topRight();break;case"w-resize":i=new l.A(t.right(),e.y)}return this.rotatePoint(i,e,360-s)},this.rotatePoint=(t,e,s)=>0!==s&&360!==s&&e?(this.matrix.reset(),this.matrix.translate(e),this.matrix.rotateDegree(s),this.matrix.invert(),this.matrix.transformPoint(t).add(e)):t,this.up=(t,e)=>{if(this.isDown)if(this.downRect.length>0)this.downPoint.equalTo(this.stage.translateRasterToFresco(t,void 0,!1))||this.commitHistory();else if("select"===this.method){const e=this.stage.translateToRect(this.downPoint,t,!1,!0),s=this.getLayersInside(e);s.length>0&&this.stage.selectLayerStack(s,this.isShiftDown,!0)}"rotate"===this.method&&(this.raster.style.cursor="grab"),this.isDown=!1,this.layerOver=void 0,this.downPoint=void 0,this.downControl=void 0,this.downAnchor=void 0,this.downRect=[],this.guides=[],window.requestAnimationFrame((()=>{this.stage.render(),this.render()}))},this.commitHistory=(t=this.method)=>{const e=this.stage.fresco.getSelectedStack();if(this.historyRect){let t;1===e.length?t=e[0].editMode&&e[0]instanceof g.A?e[0].trim:e[0].rect:e.forEach((e=>{e.rect&&(t=r.A.merge(t,e.rect.getRotatedBounds()))}));const s=t.equalTo(this.historyRect);if(this.historyRect=void 0,s)return}for(let s=0;s<e.length;s++){let i=e[s];if(i instanceof p.A&&this.downRect[s]){let t=i.rect.height/this.downRect[s].height;this.downRect[s].height=i.textSettings.size,"w-resize"!==this.method&&"e-resize"!==this.method&&1!==t&&i.setHeightScale(t)}else"move"!==t&&i instanceof g.A&&!i.editMode&&i.trimOnResize(this.downRect[s])}e.length>0&&(1===e.length?this.stage.history.add({type:"arrange",kind:"rotate"===t?"rotate":"move"===t||"vertical"===t||"horizontal"===t?"move":"resize",layer:e[0],action:{type:e[0].editMode?"trim":"rect",rect:this.downRect[0]}}):this.stage.history.add({type:"arrangeStack",id:this.stage.fresco.getStackHashId(),kind:"rotate"===t?"rotate":"move"===t||"vertical"===t||"horizontal"===t?"move":"resize",stack:Array.from(e),rects:this.downRect})),"move"!==t&&this.stage.fresco.getSelectedStack().forEach((t=>{t.render()})),document.dispatchEvent(new CustomEvent("layer-arrange"))},this.beginHistory=()=>{let t=this.stage.fresco.getSelectedLinkedStack();if(1===t.length)this.downRect=[t[0].editMode&&t[0]instanceof g.A?t[0].trim.clone():t[0].rect.clone()],this.historyRect=this.downRect[0];else{this.downRect=this.stage.fresco.getStackRect(t);for(let e of t)e.rect&&(this.historyRect=r.A.merge(this.historyRect,e.rect.getRotatedBounds()))}},this.inputRotation=t=>{const e=this.stage.fresco.getSelected();e&&e.rect&&(e.rect.rotation=t,window.requestAnimationFrame((()=>{this.stage.render(),this.render()})))},this.inputSize=(t,e)=>{let s=new o.A;if(!this.historyRect)return s;t&&(t=Math.min(t,9999)),e&&(e=Math.min(e,9999));let i=this.stage.fresco.getSelectedLinkedStack();if(1===i.length){let a=i[0];t&&a.setWidth(t,this.constrain?this.historyRect.getAspect():0),e&&a.setHeight(e,this.constrain?this.historyRect.getAspect():0),s=a.editMode?a.trim.size():a.rect.size();let n=new o.A(a.rect.width/this.historyRect.width,a.rect.height/this.historyRect.height);e&&a instanceof p.A?a.scaleBect(n.height):a instanceof g.A&&!a.editMode?a.scaleTrim(n.width,n.height):a.render()}else{let a=this.historyRect,n=this.historyRect.clone();t&&(n.width=t,n.height=Math.round(n.width/a.getAspect())),e&&(n.height=e,n.width=Math.round(n.height*a.getAspect()));let o=n.getComparedScale(a);for(let t=0;t<i.length;t++){let e=this.downRect[t];if(e){let s=i[t];s.rect.x=Math.round(n.x+(e.x-a.x)*o.width),s.rect.y=Math.round(n.y+(e.y-a.y)*o.height),s.rect.width=Math.round(e.width*o.width),s.rect.height=Math.round(e.height*o.height),s.rect.width<1&&(s.rect.width=1),s.rect.height<1&&(s.rect.height=1),s instanceof p.A?s.scaleBect(o.width):s instanceof g.A?s.scaleTrim(o.width,o.height):s.render()}}s.width=n.width,s.height=n.height}return window.requestAnimationFrame((()=>{this.stage.render(),this.render()})),s},this.inputPosition=(t,e)=>{let s=this.stage.fresco.getSelectedLinkedStack();if(1===s.length)s[0].position(t,e);else{t-=this.historyRect.x,e-=this.historyRect.y;for(let i=0;i<s.length;i++){let a=this.downRect[i];s[i].position(a.x+t,a.y+e)}}window.requestAnimationFrame((()=>{this.stage.render(),this.render()}))},this.step=(t,e)=>{const s=this.stage.fresco.getSelectedLinkedStack();if(0!==s.length&&!this.historyRect&&!this.isDown){if(1===s.length){const i=s[0].editMode?s[0].trim.clone():s[0].rect.clone();s[0].position(i.x+t,i.y+e),this.stage.history.add({type:"arrange",kind:"move",layer:s[0],action:{type:s[0].editMode?"trim":"rect",rect:i}})}else{let i=this.stage.fresco.getStackRect(s);for(let a of s)this.shouldReformLayer(a)&&a.position(a.rect.x+t,a.rect.y+e);this.stage.history.add({type:"arrangeStack",id:this.stage.fresco.getStackHashId(s),kind:"move",stack:Array.from(s),rects:i})}document.dispatchEvent(new CustomEvent("layer-arrange")),window.requestAnimationFrame((()=>{this.stage.render(),this.render()}))}},this.render=()=>{if(!this.stage||!this.stage.fresco||this.stage.supressRender)return;let t,e;this.ctx.clearRect(0,0,this.raster.width,this.raster.height);let s=c.Ay.isHDPI?4:2,i=c.Ay.isHDPI?4:2,a=c.Ay.isHDPI?2:1,o=c.Ay.isHDPI?20:10,h=c.Ay.isHDPI?10:5;if(this.ctx.lineWidth=i,this.layerOver){if(this.ctx.strokeStyle=n.YD,t=this.stage.getLayerLocationRect(this.layerOver),0!==t.rotation){let e=t.center();this.ctx.translate(e.x,e.y),this.ctx.rotate(t.rotation*Math.PI/180),t.x-=e.x,t.y-=e.y}c.Ay.isHDPI?this.ctx.strokeRect(t.x,t.y,t.width,t.height):this.ctx.strokeRect(t.x-1,t.y-1,t.width+2,t.height+2),this.ctx.setTransform(1,0,0,1,0,0)}let l=this.stage.fresco.getSelectedLinkedStack();if(l.length>0){let t=1===l.length;if(t&&!this.shouldReformLayer(l[0]))return;let u,p,m=!0,v=n.bi,y=n.q5;if(t?l[0].editMode&&l[0]instanceof g.A?(u=this.stage.getLayerLocationTrim(l[0]),e=this.stage.getLayerLocationRect(l[0]),p=e.center(),v=n.Sg,m=!1):(u=this.stage.getLayerLocationRect(l[0]),p=u.center()):(l.forEach((t=>{let e=this.stage.getLayerLocationRect(t);e&&(u=r.A.merge(u,e.getRotatedBounds()))})),p=u.center(),m=!1),!u)return;if(u.width<20||u.height<20?(o=6,h=3):(u.width<40||u.height<40)&&(o=8,h=4),0!==u.rotation&&(this.ctx.translate(p.x,p.y),this.ctx.rotate(u.rotation*Math.PI/180),u.x-=p.x,u.y-=p.y,e&&(e.x-=p.x,e.y-=p.y),p.x=0,p.y=0),e&&(this.ctx.lineWidth=2,this.ctx.strokeStyle=n.KP,this.ctx.strokeRect(e.x-2,e.y-2,e.width+2,e.height+2),this.ctx.lineWidth=i),this.ctx.strokeStyle=v,this.ctx.fillStyle=y,c.Ay.isHDPI?this.ctx.strokeRect(u.x,u.y,u.width,u.height):this.ctx.strokeRect(u.x-1,u.y-1,u.width+2,u.height+2),!this.isDown||"unset"===this.method)if(m&&(this.ctx.fillStyle=v,this.ctx.fillRect(u.x+u.width/2-a,u.y-o-h,i,o+h),this.ctx.beginPath(),this.ctx.arc(u.x+u.width/2,u.y-2*o,h+s,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.closePath(),this.ctx.fillStyle=y,this.ctx.beginPath(),this.ctx.arc(u.x+u.width/2,u.y-2*o,h,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.closePath()),t&&l[0].type===d.A.TYPE_TEXT){let t=Math.round(.5*u.height);this.ctx.fillStyle=y,this.ctx.strokeStyle=v,c.Ay.isHDPI?(this.drawHandle(this.ctx,u.x-5,u.y+(u.height-t)/2,10,t,5),this.drawHandle(this.ctx,u.x+u.width-5,u.y+(u.height-t)/2,10,t,5),u.width>80&&this.drawHandle(this.ctx,p.x-40,u.y+u.height-5,80,10,5)):(this.drawHandle(this.ctx,u.x-4,u.y+(u.height-t)/2,6,t,3),this.drawHandle(this.ctx,u.x+u.width-2,u.y+(u.height-t)/2,6,t,3),u.width>40&&this.drawHandle(this.ctx,p.x-20,u.y+u.height-2,40,6,3))}else this.ctx.fillStyle=v,u.height>10&&(this.ctx.fillRect(u.x-h,u.y+u.height-h,o,o),this.ctx.fillRect(u.x+u.width-h,u.y-h,o,o)),this.ctx.fillRect(u.x-h,u.y-h,o,o),this.ctx.fillRect(u.x+u.width-h,u.y+u.height-h,o,o),this.ctx.fillStyle=y,u.height>10&&(this.ctx.fillRect(u.x-h+s,u.y+u.height-h+s,o-2*s,o-2*s),this.ctx.fillRect(u.x+u.width-h+s,u.y-h+s,o-2*s,o-2*s)),this.ctx.fillRect(u.x-h+s,u.y-h+s,o-2*s,o-2*s),this.ctx.fillRect(u.x+u.width-h+s,u.y+u.height-h+s,o-2*s,o-2*s);this.ctx.setTransform(1,0,0,1,0,0)}this.guides&&this.guides.length>0&&(this.ctx.lineWidth=c.Ay.isHDPI?2:1,c.Ay.isHDPI||this.ctx.translate(.5,.5),this.guides.forEach((t=>{t.soft?this.ctx.strokeStyle=n.RZ:this.ctx.strokeStyle=n.Al,this.ctx.beginPath(),this.ctx.moveTo(t.start.x,t.start.y),this.ctx.lineTo(t.end.x,t.end.y),this.ctx.stroke()})),this.ctx.setTransform(1,0,0,1,0,0))},this.drawHandle=(t,e,s,i,a,n=0)=>{t.beginPath(),t.moveTo(e+n,s),t.lineTo(e+i-n,s),t.quadraticCurveTo(e+i,s,e+i,s+n),t.lineTo(e+i,s+a-n),t.quadraticCurveTo(e+i,s+a,e+i-n,s+a),t.lineTo(e+n,s+a),t.quadraticCurveTo(e,s+a,e,s+a-n),t.lineTo(e,s+n),t.quadraticCurveTo(e,s,e+n,s),t.closePath(),t.fill(),t.stroke()},this.isControl=(t,e)=>{if(0===t.length)return!1;let s,i,a=1===t.length,o=c.Ay.isHDPI?c.Ay.canTouch?44:32:16,h=.5*o;if(a&&t[0].editMode&&t[0]instanceof g.A?(s=this.stage.getLayerLocationTrim(t[0]),i=this.stage.getLayerLocationRect(t[0]).center()):(a?s=this.stage.getLayerLocationRect(t[0]):t.forEach((t=>{let e=this.stage.getLayerLocationRect(t);e&&(s=r.A.merge(s,e.getRotatedBounds()))})),i=s?s.center():void 0),s){if((s.width<40||s.height<40)&&(h/=2,o/=2),e=this.rotatePoint(e,i,s.rotation),a&&t[0].type===d.A.TYPE_TEXT){if(n.HO(s.x-h,s.y,o,s.height,e.x,e.y))return this.raster.style.cursor=this.getRotatedCursor(90,s.rotation),this.method="w-resize",!0;if(n.HO(s.x+s.width-h,s.y,o,s.height,e.x,e.y))return this.raster.style.cursor=this.getRotatedCursor(270,s.rotation),this.method="e-resize",!0;const t=c.Ay.isHDPI?80:40;if(s.width>t&&n.HO(i.x-.5*t,s.y+s.height-h,t,o,e.x,e.y))return this.raster.style.cursor=this.getRotatedCursor(0,s.rotation),this.method="t-resize",!0}else{if(s.height>10){if(n.HO(s.x+s.width-h,s.y-h,o,o,e.x,e.y))return this.raster.style.cursor=this.getRotatedCursor(45,s.rotation),this.method="ne-resize",!0;if(n.HO(s.x-h,s.y+s.height-h,o,o,e.x,e.y))return this.raster.style.cursor=this.getRotatedCursor(225,s.rotation),this.method="sw-resize",!0}if(n.HO(s.x-h,s.y-h,o,o,e.x,e.y))return this.raster.style.cursor=this.getRotatedCursor(315,s.rotation),this.method="nw-resize",!0;if(n.HO(s.x+s.width-h,s.y+s.height-h,o,o,e.x,e.y))return this.raster.style.cursor=this.getRotatedCursor(135,s.rotation),this.method="se-resize",!0}return!(!a||t[0].editMode||!n.HO(s.x+s.width/2-h,s.y-(c.Ay.isHDPI?40:20)-h,o,o,e.x,e.y))&&(this.raster.style.cursor="grab",this.method="rotate",!0)}},this.getRotatedCursor=(t,e)=>{let s=t+e;s<0&&(s+=360),s>360&&(s-=360),s+=22.5;let i=7;for(;i>0&&!(s>45*i&&s<360);)i--;return["n","ne","e","se","s","sw","w","nw"][i]+"-resize"},this.checkReformGuides=t=>{var e,s;if(this.guides=[],c.Ay.showGuides||c.Ay.snapToGuides){const i=this.stage.fresco.getSelectedLinkedStack(),a=5/this.stage.zoom,n=c.Ay.snapToGuides,o=c.Ay.showGuides;let h=1===i.length&&i[0].editMode&&i[0].trim;const d=h?i[0].rect:new r.A(0,0,this.stage.fresco.width,this.stage.fresco.height),u=h?360-i[0].rect.rotation:0,p=d.center(),g=h?this.rotatePoint(t,p,1===i.length?i[0].rect.rotation:0):t;if(!h){const s=this.stage.fresco.getNotSelectedStack(i);for(let i=0;i<s.length;i++){const r=s[i].rect;if(r&&0===r.rotation&&s[i].settings.visible){if(this.willSnap(g.x,r.x,a)&&(n&&(t.x=r.x),o)){const t="ne-resize"===this.method||"se-resize"===this.method||"e-resize"===this.method;this.addGuide(new l.A(r.x,r.y),new l.A(r.x,r.bottom()),void 0,0,!0,new l.A(t?0:-1,-1),new l.A(t?0:-1,0))}if(this.willSnap(g.x,r.right(),a)&&(n&&(t.x=r.right()),o)){const t="nw-resize"===this.method||"sw-resize"===this.method||"w-resize"===this.method;this.addGuide(new l.A(r.right(),r.y),new l.A(r.right(),r.bottom()),void 0,0,!0,new l.A(t?-1:0,-1),new l.A(t?-1:0,0))}if(null!==(e=!this.constrain)&&void 0!==e?e:this.isShiftDown){if(this.willSnap(g.y,r.y,a)&&(n&&(t.y=r.y),o)){const t="sw-resize"===this.method||"se-resize"===this.method;this.addGuide(new l.A(r.x,r.y),new l.A(r.right(),r.y),void 0,0,!0,new l.A(-1,t?0:-1),new l.A(0,t?0:-1))}if(this.willSnap(g.y,r.bottom(),a)&&(n&&(t.y=r.bottom()),o)){const t="ne-resize"===this.method||"nw-resize"===this.method;this.addGuide(new l.A(r.x,r.bottom()),new l.A(r.right(),r.bottom()),void 0,0,!0,new l.A(-1,t?-1:0),new l.A(0,t?-1:0))}}}}}this.willSnap(g.x,d.x,a)&&(n&&(t.x=h?this.rotatePoint(new l.A(d.x,g.y),p,u).x:d.x),o&&this.addGuide(new l.A(d.x,d.y),new l.A(d.x,d.bottom()),p,u,!1,new l.A(-1,-1),new l.A(-1,0))),this.willSnap(g.x,d.right(),a)&&(n&&(t.x=h?this.rotatePoint(new l.A(d.right(),g.y),p,u).x:d.right()),o&&this.addGuide(new l.A(d.right(),d.y),new l.A(d.right(),d.bottom()),p,u,!1,new l.A(0,-1))),(null!==(s=!this.constrain)&&void 0!==s?s:this.isShiftDown)&&(this.willSnap(g.y,d.top(),a)&&(n&&(t.y=h?this.rotatePoint(new l.A(g.x,d.top()),p,u).y:d.top()),o&&this.addGuide(new l.A(d.x,d.y),new l.A(d.right(),d.y),p,u,!1,new l.A(-1,-1),new l.A(0,-1))),this.willSnap(g.y,d.bottom(),a)&&(n&&(t.y=h?this.rotatePoint(new l.A(g.x,d.bottom()),p,u).y:d.bottom()),o&&this.addGuide(new l.A(d.x,d.bottom()),new l.A(d.right(),d.bottom()),p,u,!1,new l.A(-1))))}return t},this.checkMoveGuides=()=>{if(this.guides=[],c.Ay.showGuides||c.Ay.snapToGuides){const t=this.stage.fresco.getSelectedLinkedStack(),e=this.stage.fresco.getNotSelectedStack(t),s=5/this.stage.zoom,i=c.Ay.snapToGuides,a=c.Ay.showGuides;let n,o,h;if(1===t.length&&t[0].editMode?(n=t[0].getGlobalTrim(),o=t[0].rect,h=360-o.rotation):(o=new r.A(0,0,this.stage.fresco.width,this.stage.fresco.height),t.forEach((t=>{t.rect&&(n=r.A.merge(n,t.rect.getRotatedBounds()))}))),!n)return;let d=new l.A(0,0);const u=n.center(),p=20/this.stage.zoom;for(let r=0;r<e.length;r++){const t=e[r].rect;if(t&&0===t.rotation&&e[r].settings.visible){const e=t.center();if(this.willSnap(n.x,t.x,s)&&(d.x=n.x-t.x,a)){const s=(t.y<n.y?t.y:n.y)-p,i=(t.y+t.height>n.y+n.height?t.y+t.height:n.y+n.height)+p;this.addGuide(new l.A(t.x,s),new l.A(t.x,i),e,h,!0,new l.A(-1),new l.A(-1))}if(this.willSnap(n.x,t.x+t.width,s)&&(d.x=n.x-(t.x+t.width),a)){const s=(t.y<n.y?t.y:n.y)-p,i=(t.y+t.height>n.y+n.height?t.y+t.height:n.y+n.height)+p;this.addGuide(new l.A(t.x+t.width,s),new l.A(t.x+t.width,i),e,h,!0,new l.A(-1),new l.A(-1))}if(this.willSnap(n.x+n.width,t.x,s)&&(d.x=n.x+n.width-t.x,a)){const s=(t.y<n.y?t.y:n.y)-p,i=(t.y+t.height>n.y+n.height?t.y+t.height:n.y+n.height)+p;this.addGuide(new l.A(t.x,s),new l.A(t.x,i),e,h,!0)}if(this.willSnap(n.x+n.width,t.x+t.width,s)&&(d.x=n.x+n.width-(t.x+t.width),a)){const s=(t.y<n.y?t.y:n.y)-p,i=(t.y+t.height>n.y+n.height?t.y+t.height:n.y+n.height)+p;this.addGuide(new l.A(t.x+t.width,s),new l.A(t.x+t.width,i),e,h,!0)}if(this.willSnap(n.y,t.y,s)&&(d.y=n.y-t.y,a)){const s=(t.x<n.x?t.x:n.x)-p,i=(t.x+t.width>n.x+n.width?t.x+t.width:n.x+n.width)+p;this.addGuide(new l.A(s,t.y),new l.A(i,t.y),e,h,!0,new l.A(0,-1),new l.A(0,-1))}if(this.willSnap(n.y,t.y+t.height,s)&&(d.y=n.y-(t.y+t.height),a)){const s=(t.x<n.x?t.x:n.x)-p,i=(t.x+t.width>n.x+n.width?t.x+t.width:n.x+n.width)+p;this.addGuide(new l.A(s,t.y+t.height),new l.A(i,t.y+t.height),e,h,!0,new l.A(0,-1),new l.A(0,-1))}if(this.willSnap(n.y+n.height,t.y,s)&&(d.y=n.y+n.height-t.y,a)){const s=(t.x<n.x?t.x:n.x)-p,i=(t.x+t.width>n.x+n.width?t.x+t.width:n.x+n.width)+p;this.addGuide(new l.A(s,t.y),new l.A(i,t.y),e,h,!0)}if(this.willSnap(n.y+n.height,t.y+t.height,s)&&(d.y=n.y+n.height-(t.y+t.height),a)){const s=(t.x<n.x?t.x:n.x)-p,i=(t.x+t.width>n.x+n.width?t.x+t.width:n.x+n.width)+p;this.addGuide(new l.A(s,t.y+t.height),new l.A(i,t.y+t.height),e,h,!0)}if(this.willSnap(u.x,e.x,s)&&(d.x=n.x-Math.round(e.x-n.width/2),a)){const s=(t.y<n.y?t.y:n.y)-p,i=(t.y+t.height>n.y+n.height?t.y+t.height:n.y+n.height)+p;this.addGuide(new l.A(Math.floor(e.x),s),new l.A(Math.floor(e.x),i),e,h,!0)}if(this.willSnap(u.y,e.y,s)&&(d.y=n.y-Math.round(e.y-n.height/2),a)){const s=(t.x<n.x?t.x:n.x)-p,i=(t.x+t.width>n.x+n.width?t.x+t.width:n.x+n.width)+p;this.addGuide(new l.A(s,Math.floor(e.y)),new l.A(i,Math.floor(e.y)),e,h,!0)}}}const g=o.center();this.willSnap(u.x,g.x,s)&&(d.x=n.x-Math.round(g.x-n.width/2),a&&this.addGuide(new l.A(Math.floor(g.x),o.y),new l.A(Math.floor(g.x),o.bottom()),g,h)),this.willSnap(u.y,g.y,s)&&(d.y=n.y-Math.round(g.y-n.height/2),a&&this.addGuide(new l.A(o.x,Math.floor(g.y)),new l.A(o.right(),Math.floor(g.y)),g,h)),this.willSnap(n.x,o.x,s)&&(d.x=n.x-o.x,a&&this.addGuide(new l.A(o.x,o.y),new l.A(o.x,o.bottom()),g,h,!1,new l.A(-1,-1),new l.A(-1,0))),this.willSnap(n.right(),o.right(),s)&&(d.x=n.x-(o.right()-n.width),a&&this.addGuide(new l.A(o.right(),o.y),new l.A(o.right(),o.bottom()),g,h,!1,new l.A(0,-1))),this.willSnap(n.y,o.y,s)&&(d.y=n.y-o.y,a&&this.addGuide(new l.A(o.x,o.y),new l.A(o.right(),o.y),g,h,!1,new l.A(-1,-1),new l.A(0,-1))),this.willSnap(n.bottom(),o.bottom(),s)&&(d.y=n.y-(o.bottom()-n.height),a&&this.addGuide(new l.A(o.x,o.bottom()),new l.A(o.right(),o.bottom()),g,h,!1,new l.A(-1))),!i||0===d.x&&0===d.y||(1===t.length&&t[0].editMode?t[0].position(t[0].trim.x-d.x,t[0].trim.y-d.y):t.forEach((t=>{this.shouldReformLayer(t)&&t.position(t.rect.x-d.x,t.rect.y-d.y)})))}},this.addGuide=(t,e,s,i=0,a=!1,n,o)=>{0!==i&&(t=this.rotatePoint(t,s,i),e=this.rotatePoint(e,s,i)),t=this.stage.translateFrescoToRaster(t).add(n),e=this.stage.translateFrescoToRaster(e).add(o),this.guides.push(new h.A(t,e,a))},this.willSnap=(t,e,s)=>t<e+s&&t>e-s,this.shouldReformLayer=t=>{if(t&&t.settings.visible&&!t.settings.locked&&t.rect){if("ARRANGE"!==this.mode&&"SIMPLE"!==this.mode){if("TEXT"===this.mode&&t.type!==d.A.TYPE_TEXT)return;if("FRAME"===this.mode&&t.type!==d.A.TYPE_FRAME)return;if("SHAPE"===this.mode&&t.type!==d.A.TYPE_SHAPE)return}return!0}},this.getLayerAt=t=>{if(this.stage.fresco&&this.stage.fresco.layers.length>0)for(let e=this.stage.fresco.layers.length-1;e>=0;e--){if(!this.shouldReformLayer(this.stage.fresco.layers[e]))continue;let s,i;if(this.stage.fresco.layers[e].editMode&&this.stage.fresco.layers[e]instanceof g.A?(s=this.stage.getLayerLocationTrim(this.stage.fresco.layers[e]),i=this.stage.getLayerLocationRect(this.stage.fresco.layers[e]).center()):(s=this.stage.getLayerLocationRect(this.stage.fresco.layers[e]),i=s?s.center():void 0),s&&s.isInside(this.rotatePoint(t,i,s.rotation)))return this.stage.fresco.layers[e]}},this.getLayersAt=t=>{const e=new Array;if(this.stage.fresco&&this.stage.fresco.layers.length>0)for(let s=this.stage.fresco.layers.length-1;s>=0;s--){if("TEXT"===this.mode&&this.stage.fresco.layers[s].type!==d.A.TYPE_TEXT)continue;if("FRAME"===this.mode&&this.stage.fresco.layers[s].type!==d.A.TYPE_FRAME)continue;if("SHAPE"===this.mode&&this.stage.fresco.layers[s].type!==d.A.TYPE_SHAPE)continue;let i,a;if(this.stage.fresco.layers[s].editMode&&this.stage.fresco.layers[s]instanceof g.A?(i=this.stage.getLayerLocationTrim(this.stage.fresco.layers[s]),a=this.stage.getLayerLocationRect(this.stage.fresco.layers[s]).center()):(i=this.stage.getLayerLocationRect(this.stage.fresco.layers[s]),a=i?i.center():void 0),i&&i.isInside(this.rotatePoint(t,a,i.rotation))&&e.push(this.stage.fresco.layers[s]),e.length>5)break}return e},this.getLayersInside=t=>{const e=new Array;if(this.stage.fresco&&this.stage.fresco.layers.length>0)for(let s=this.stage.fresco.layers.length-1;s>=0;s--){const i=this.stage.getLayerLocationRect(this.stage.fresco.layers[s]);i&&t.contains(i)&&e.push(this.stage.fresco.layers[s])}return e},this.dblClick=()=>{let t=this.stage.fresco.getSelected();if(t instanceof p.A){if((0,i.Ay)("floating-text-input"))return;t.settings.visible=!1,this.removeListener(),this.stage.render(),this.render(),this.stage.supressRender=!0;let e=this.stage.getLayerLocationRect(t);c.Ay.isHDPI&&(e=e.scale(.5)),e.y+e.height>this.raster.offsetHeight&&(e.y=this.raster.offsetHeight-e.height-20),e.y<20&&(e.y=20),e.width>this.raster.offsetWidth&&(e.width=this.raster.offsetWidth-40),e.x+e.width>this.raster.offsetWidth&&(e.x=this.raster.offsetWidth-e.width-20),e.x<20&&(e.x=20);let s=document.createElement("textarea");s.id="floating-text-input",s.style.top=e.y+this.raster.offsetTop+"px",s.style.left=e.x+this.raster.offsetLeft+"px",s.style.width=e.width+"px",s.style.color="#111";let a=t.textSettings,o=n.qE(Math.round(a.size*this.stage.zoom),12,100);c.Ay.isHDPI&&(o*=.5),s.style.font=a.getCssFont(o),s.style.letterSpacing=Math.floor(a.letterSpace*(o/2.2))+"px",s.style.textAlign=a.align,s.value=t.text;const r=()=>window.setTimeout((()=>{let t=s.cloneNode();t.style.visibility="false",s.parentNode.insertBefore(t,s),t.style.height="auto",t.value=s.value;let e=t.scrollTop+t.scrollHeight+16;s.offsetTop+e>document.body.offsetHeight-20&&(e=document.body.offsetHeight-20-s.offsetTop,s.style.overflowY="auto"),s.style.height=e+"px",s.parentNode.removeChild(t)}),0);s.addEventListener("input",(()=>{r()}),!0),document.body.appendChild(s),window.setTimeout((()=>{r(),s.focus(),s.select()}),10),document.addEventListener("mousedown",this.outsideTextClick,!0)}else t instanceof g.A&&!t.settings.locked&&(t.canvas&&t.trim?(t.editMode=!t.editMode,window.requestAnimationFrame(this.render),document.dispatchEvent(new CustomEvent("layer-select"))):this.stage.browseFrameImage())},this.outsideTextClick=t=>{let e=(0,i.Ay)("floating-text-input");if(t.target!==e){t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault(),this.stage.supressRender=!1;let s=this.stage.fresco.getSelected();if(s instanceof p.A){s.settings.visible=!0;let t=s.text;s.setText(e.value),this.stage.history.add({type:"textChange",layer:s,text:t})}this.addListener(),document.removeEventListener("mousedown",this.outsideTextClick,!0),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("text-change")),e.remove()}},this.cleanUp=()=>{this.proxy=void 0,this.removeListener(),this.raster.style.cursor="unset",this.matrix=void 0,this.raster=void 0,this.stage=void 0,this.ctx=void 0},this.stage=t,this.ctx=t.coating.ctx,this.raster=t.coating.raster,this.pointers=new Array,this.matrix=new u.A,this.downRect=[],this.guides=[],this.addListener(),this.setMode(e)}}},22656:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(54738),a=s(40963),n=s(23556),o=s(41915),r=s(66495);class h{constructor(t,e){this.setMask=t=>{this.mask=t,this.ctx=this.mask.getContext("2d",{willReadFrequently:!0}),this.createOutline()},this.isSelected=t=>{var e;return!!(null===(e=this.bounds)||void 0===e?void 0:e.isInside(t))&&this.ctx.getImageData(t.x,t.y,1,1).data[3]>=64},this.applyOffset=()=>{let t=i.oM(this.mask);this.ctx.clearRect(0,0,this.mask.width,this.mask.height),this.ctx.drawImage(t,this.offset.x,this.offset.y),this.offset.x=this.offset.y=0,this.createOutline()},this.editRectangle=(t,e,s)=>{let a=i.Nw(this.mask.width,this.mask.height),n=a.getContext("2d");r.A.fill(n,"rectangle",t.topLeft(),t.bottomRight()),n=void 0,this.drawOnMask(a,e,!1,s)},this.editEllipse=(t,e,s,a)=>{let n=i.Nw(this.mask.width,this.mask.height),o=n.getContext("2d");r.A.fill(o,"ellipse",t.topLeft(),t.bottomRight()),o=void 0,this.drawOnMask(n,e,s,a)},this.editBezier=(t,e,s,a)=>{let n=i.Nw(this.mask.width,this.mask.height),o=n.getContext("2d");o.beginPath(),o.moveTo(t[0].x,t[0].y);for(let i=1;i<t.length;i+=2)i+1===t.length?o.lineTo(t[i].x,t[i].y):o.quadraticCurveTo(t[i+1].x,t[i+1].y,t[i].x,t[i].y);o.fill(),o=void 0,this.drawOnMask(n,e,s,a)},this.editPolygon=(t,e,s,a)=>{let n=i.Nw(this.mask.width,this.mask.height),o=n.getContext("2d");o.beginPath(),o.moveTo(t[0].x,t[0].y),t.forEach((t=>o.lineTo(t.x,t.y))),o.fill(),o=void 0,this.drawOnMask(n,e,s,a)},this.drawOnMask=(t,e=0,s=!1,i=!1,a=new o.A(0,0))=>{if(e>0){let s=new n.A;s.addShader("blur",e),t=s.apply(t)}else if(s){let e=new n.A;e.addShader("dealiasing",!0),t=e.apply(t)}this.ctx.save(),i&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.drawImage(t,a.x,a.y),this.ctx.restore(),this.createOutline()},this.selectAll=()=>{this.ctx.fillRect(0,0,this.mask.width,this.mask.height),this.createOutline()},this.invert=()=>{const t=new n.A([]);t.addShader("alpha-invert",1),this.mask=i.oM(t.apply(this.mask)),this.ctx=this.mask.getContext("2d",{willReadFrequently:!0}),this.createOutline()},this.size=(t,e)=>{const s=i.Nw(t,e);this.ctx=s.getContext("2d",{willReadFrequently:!0});const a=Math.round(.5*(s.width-this.mask.width)),n=Math.round(.5*(s.height-this.mask.height));this.ctx.drawImage(this.mask,a,n),this.mask=s,this.createOutline()},this.resize=(t,e)=>{this.mask=i.H5(this.mask,t,e),this.ctx=this.mask.getContext("2d",{willReadFrequently:!0}),this.createOutline()},this.createOutline=()=>{let t=this.ctx.getImageData(0,0,this.mask.width,this.mask.height);if(this.bounds=i.zR(t),!this.bounds)return;let e=this.bounds.top(),s=this.bounds.left(),a=this.bounds.right(),n=this.bounds.bottom(),o=this.mask.width,r=this.mask.height;this.outline=new Array;let h,l,c,d,u,p=-1;for(let i=e;i<n;++i){l=0===s||t.data[4*(i*o+s-1)+3]<64,c=t.data[4*(i*o+s)+3]<64;for(let e=s;e<a;++e)h=l,l=c,c=e+1===o||t.data[4*(i*o+e+1)+3]<64,l||(p=-1,d=i-1<0||t.data[4*((i-1)*o+e)+3]<64,u=i+1===r||t.data[4*((i+1)*o+e)+3]<64,h&&d&&c&&u?p=8:h&&d&&u?p=9:c&&d&&u?p=10:c&&d&&h?p=11:c&&u&&h?p=12:h&&c?p=13:u&&d?p=14:h&&d?p=0:d&&c?p=2:h&&u?p=5:u&&c?p=7:d?p=1:h?p=3:c?p=4:u&&(p=6),-1!==p&&this.outline.push(e,i,p))}},this.clear=()=>{this.ctx.clearRect(0,0,this.mask.width,this.mask.height),this.outline=new Array},this.reset=()=>{this.ctx.clearRect(0,0,this.mask.width,this.mask.height),this.outline=new Array,this.offset=new o.A,this.bounds=new a.A},this.cleanUp=()=>{this.outline=void 0,this.offset=void 0,this.bounds=void 0,this.mask=void 0,this.ctx=void 0},this.mask=i.Nw(t,e),this.offset=new o.A,this.bounds=new a.A,this.ctx=this.mask.getContext("2d",{willReadFrequently:!0})}}},8594:(t,e,s)=>{s.d(e,{A:()=>l});var i=s(21742),a=s(75770),n=s(54738),o=s(41915),r=s(29755),h=s(21079);class l extends a.A{constructor(t,e){super(t,e),this.moveLock="none",this.contextMenu=t=>{t.preventDefault(),t.stopPropagation(),this.stage.coating.frozen||new h.Ay(new o.A(t.clientX,t.clientY),[new h.kt((0,i.A)("titleSelectAll"),(()=>this.stage.selectionAll()),"Ctrl + A"),new h.kt((0,i.A)("titleSelectPixels"),(()=>this.stage.selectionPixels())),new h.kt((0,i.A)("titleSelectDeselect"),this.stage.fresco.hasSelection()?()=>this.stage.selectionDeselect():void 0,"Ctrl + D"),new h.kt((0,i.A)("titleSelectInvert"),this.stage.fresco.hasSelection()?()=>this.stage.selectionInvert():void 0,"Ctrl + I"),new h.kt,new h.kt((0,i.A)("titleCut"),this.stage.fresco.hasSelection()?()=>document.dispatchEvent(new CustomEvent("cut-menu")):void 0,"Ctrl + X"),new h.kt((0,i.A)("titleCopy"),this.stage.fresco.hasSelection()?()=>()=>document.dispatchEvent(new CustomEvent("copy-menu")):void 0,"Ctrl + C"),new h.kt((0,i.A)("titlePaste"),(()=>document.dispatchEvent(new CustomEvent("paste-menu"))),"Ctrl + V"),new h.kt((0,i.A)("titleClear"),this.stage.fresco.hasSelection()?()=>document.dispatchEvent(new CustomEvent("clear-menu")):void 0,"DEL")])},this.pointerDown=t=>{if(t.stopPropagation(),this.stage.coating.override||t.button>0)return;this.isDown=!0,this.addPointer(t.pointerId);const e=r.Ay.isHDPI?2:1;1===this.pointers.length&&this.preDown(new o.A(t.offsetX*e,t.offsetY*e),t.pointerType,t.pressure)},this.pointerMove=t=>{t.stopPropagation();const e=r.Ay.isHDPI?2:1;let s=new o.A(t.offsetX*e,t.offsetY*e);if(t.buttons||!this.isDown||this.noGoZone)if(this.isDown)this.preMove(s);else{if(this.stage.fresco.hasSelection()){let t=this.stage.translateRasterToFresco(s);if("new"===this.mode&&this.stage.fresco.selection.isSelected(t))return void(this.stage.raster.style.cursor="move")}this.stage.raster.style.cursor="crosshair"}else this.pointerUp(t)},this.pointerUp=t=>{t.stopPropagation();const e=r.Ay.isHDPI?2:1;this.preUp(new o.A(t.offsetX*e,t.offsetY*e))},this.setHistory=()=>{var t,e,s;this.snapshot=n.oM(null===(s=null===(e=null===(t=this.stage)||void 0===t?void 0:t.fresco)||void 0===e?void 0:e.selection)||void 0===s?void 0:s.mask)},this.addHistory=(t=this.name)=>{this.stage.history.add({type:"selectionChange",kind:t,selection:this.snapshot}),this.snapshot=void 0},this.addMoveListeners=()=>{this.stage.raster.addEventListener("pointerup",this.pointerUp,!1)},this.removeMoveListeners=()=>{this.stage.raster.removeEventListener("pointerup",this.pointerUp,!1)},this.superClean=()=>{this.removeDownListeners(),this.stage.raster.removeEventListener("pointermove",this.pointerMove,!1),this.stage.raster.removeEventListener("contextmenu",this.contextMenu,!0)},this.addDownListeners(),this.stage.raster.addEventListener("pointermove",this.pointerMove,!1),this.stage.raster.addEventListener("contextmenu",this.contextMenu,!0),this.stage.raster.style.cursor="crosshair"}preDown(t,e,s){if(this.isDown=!0,this.isMoving=!1,this.downPoint=t,this.stage.fresco.hasSelection()){let e=this.stage.translateRasterToFresco(t);this.isMoving="new"===this.mode&&this.stage.fresco.selection.isSelected(e)}this.isMoving?(this.setHistory(),this.stage.coating.freeze(!0),this.addMoveListeners()):this.down(t,e,s)}preMove(t,e,s){if(this.isMoving){if(this.isShiftDown&&"none"===this.moveLock){const e=Math.abs(this.downPoint.x-t.x),s=Math.abs(this.downPoint.y-t.y);(e>4||s>4)&&(e<s?(t.x=this.downPoint.x,this.moveLock="vertical"):(t.y=this.downPoint.y,this.moveLock="horizontal"))}this.isShiftDown||(this.moveLock="none"),"vertical"!==this.moveLock&&(this.stage.fresco.selection.offset.x=Math.round((t.x-this.downPoint.x)/this.stage.zoom)),"horizontal"!==this.moveLock&&(this.stage.fresco.selection.offset.y=Math.round((t.y-this.downPoint.y)/this.stage.zoom)),window.requestAnimationFrame((()=>this.stage.coating.render()))}else this.move(t,e,s)}preUp(t){this.isMoving?(this.isDown=!1,this.isMoving=!1,this.moveLock="none",this.stage.coating.freeze(!1),this.removeMoveListeners(),0===this.stage.fresco.selection.offset.x&&0===this.stage.fresco.selection.offset.y||(this.stage.fresco.selection.applyOffset(),this.addHistory("move"))):this.up(t)}}},59303:(t,e,s)=>{s.d(e,{A:()=>i});class i{constructor(t,e,s,i=1){this.highlight=t,this.midtone=e,this.shadow=s,this.amount=i}static fillPaletteMap(t,e){if(t.midtone){for(let s=0;s<128;s++){let i=s/127;e.data[4*s]=Math.round(t.midtone.r*i+t.shadow.r*(1-i)),e.data[4*s+1]=Math.round(t.midtone.g*i+t.shadow.g*(1-i)),e.data[4*s+2]=Math.round(t.midtone.b*i+t.shadow.b*(1-i))}for(let s=128;s<256;s++){let i=(s-127)/128;e.data[4*s]=Math.round(t.highlight.r*i+t.midtone.r*(1-i)),e.data[4*s+1]=Math.round(t.highlight.g*i+t.midtone.g*(1-i)),e.data[4*s+2]=Math.round(t.highlight.b*i+t.midtone.b*(1-i))}}else for(let s=0;s<256;++s){let i=s/255;e.data[4*s]=Math.round(t.highlight.r*i+t.shadow.r*(1-i)),e.data[4*s+1]=Math.round(t.highlight.g*i+t.shadow.g*(1-i)),e.data[4*s+2]=Math.round(t.highlight.b*i+t.shadow.b*(1-i))}}}},75770:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(41915),a=s(29755);class n{constructor(t,e){this.applyClick=()=>{document.dispatchEvent(new CustomEvent("tool-apply"))},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.addPointer=t=>{this.pointers.push(t),this.stage.raster.setPointerCapture(t)},this.removePointer=t=>{for(let e=0;e<this.pointers.length;e++)if(this.pointers[e]===t.pointerId){this.pointers.splice(e,1);break}this.stage.raster.releasePointerCapture(t.pointerId)},this.pointerDown=t=>{if(t.stopPropagation(),this.stage.coating.override||t.button>0)return;this.isDown=!0,this.addPointer(t.pointerId);const e=a.Ay.isHDPI?2:1;1===this.pointers.length&&this.down(new i.A(t.offsetX*e,t.offsetY*e),t.pointerType,t.pressure)},this.pointerMove=t=>{t.stopPropagation();const e=a.Ay.isHDPI?2:1;this.pointers.length<2&&this.move(new i.A(t.offsetX*e,t.offsetY*e),t.pointerType,t.pressure)},this.pointerUp=t=>{t.stopPropagation(),this.isDown=!1;const e=a.Ay.isHDPI?2:1;this.up(new i.A(t.offsetX*e,t.offsetY*e))},this.dblClick=t=>{t.stopPropagation();const e=a.Ay.isHDPI?2:1;this.dbl(new i.A(t.offsetX*e,t.offsetY*e))},this.addDownListeners=()=>{this.stage.raster.addEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.addEventListener("pointerup",this.removePointer,!1)},this.removeDownListeners=()=>{for(let t=0;t<this.pointers.length;t++)this.stage.raster.releasePointerCapture(this.pointers[t]);this.stage.raster.removeEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.removeEventListener("pointerup",this.removePointer,!1)},this.addMoveListeners=()=>{this.stage.raster.addEventListener("pointermove",this.pointerMove,!1),this.stage.raster.addEventListener("pointerup",this.pointerUp,!1)},this.removeMoveListeners=()=>{this.stage.raster.removeEventListener("pointermove",this.pointerMove,!1),this.stage.raster.removeEventListener("pointerup",this.pointerUp,!1)},this.down=(t,e,s)=>{},this.move=(t,e,s)=>{},this.dbl=t=>{},this.up=t=>{},this.apply=()=>{},this.cancel=()=>{},this.cleanUp=()=>{},this.name=t,this.stage=e,this.pointers=new Array}}},15818:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(54738);class a{constructor(t,e,s){this.h=t,this.s=e,this.b=s}toColor(){let t,e,s,i,a,o,r,h;if(0==this.b)t=0,e=0,s=0;else if(0==this.s)t=e=s=this.b;else switch(i=this.h/60,a=i-Math.floor(i),o=this.b*(1-this.s),h=this.b*(1-this.s*a),r=this.b*(1-this.s*(1-a)),Math.floor(i)){case 0:case 6:t=this.b,e=r,s=o;break;case 1:t=h,e=this.b,s=o;break;case 2:t=o,e=this.b,s=r;break;case 3:t=o,e=h,s=this.b;break;case 4:t=r,e=o,s=this.b;break;case 5:t=this.b,e=o,s=h}return new n(Math.round(255*t),Math.round(255*e),Math.round(255*s))}toHEX(){const t=this.toColor(),e=t=>{const e=t.toString(16);return 1===e.length?"0"+e:e};return`#${e(t.r)}${e(t.g)}${e(t.b)}`}}class n{constructor(t=255,e=255,s=255,n=255){this.isEqual=t=>!!t&&(this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a),this.toHEX=()=>{const t=t=>{const e=t.toString(16);return 1===e.length?"0"+e:e};return`#${t(this.r)}${t(this.g)}${t(this.b)}`},this.toHEXA=()=>{const t=t=>{const e=t.toString(16);return 1===e.length?"0"+e:e};return`#${t(this.r)}${t(this.g)}${t(this.b)}${t(this.a)}`},this.toRGBA=(t=this.a)=>`rgba(${this.r},${this.g},${this.b},${t/255})`,this.toHSB=()=>{let t,e,s,i=Math.min(this.r,this.g,this.b),n=Math.max(this.r,this.g,this.b);s=n/255;let o=n-i;return o?(e=o/n,t=this.r==n?(this.g-this.b)/o*60:this.g==n?60*(2+(this.b-this.r)/o):60*(4+(this.r-this.g)/o),t>360?t-=360:t<0&&(t+=360)):t=e=0,new a(t,e,s)},this.r=i.qE(t,0,255),this.g=i.qE(e,0,255),this.b=i.qE(s,0,255),this.a=i.qE(n,0,255)}rotateHue(t){let e,s,i,a=Math.min(this.r,this.g,this.b),o=Math.max(this.r,this.g,this.b);e=o/255;var r=o-a;return r?(s=r/o,i=this.r==o?(this.g-this.b)/r*60:this.g==o?60*(2+(this.b-this.r)/r):60*(4+(this.r-this.g)/r)):i=s=0,i+=t,i>360?i-=360:i<0&&(i+=360),360===i&&(i=0),n.fromHSB(i,s,e)}static fromRGB(t){if(/^#[0-9A-F]{6}$/i.test(t))return n.fromHEX(t);let e=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return!e||e.length<4?new n:new n(Number(e[1]),Number(e[2]),Number(e[3]))}static fromHEXA(t){let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return!e||e.length<4?new n:new n(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),parseInt(e[4],16))}static fromHEX(t,e=255){let s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return!s||s.length<3?new n:new n(parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16),e)}static fromHSB(t,e,s){let i,a,o,r,h,l,c,d;if(0==s)i=0,a=0,o=0;else if(0==e)i=a=o=s;else switch(r=t/60,h=r-Math.floor(r),l=s*(1-e),d=s*(1-e*h),c=s*(1-e*(1-h)),Math.floor(r)){case 0:case 6:i=s,a=c,o=l;break;case 1:i=d,a=s,o=l;break;case 2:i=l,a=s,o=c;break;case 3:i=l,a=d,o=s;break;case 4:i=c,a=l,o=s;break;case 5:i=s,a=l,o=d}return new n(Math.round(255*i),Math.round(255*a),Math.round(255*o))}clone(){return new n(this.r,this.g,this.b,this.a)}}},75307:(t,e,s)=>{s.d(e,{A:()=>i});class i{static rotation(t){return new Promise(((e,s)=>{const i=new FileReader;i.onload=t=>{t.target||e(0);const s=t.target,i=new DataView(s.result);65496!==i.getUint16(0,!1)&&e(0);const a=i.byteLength;let n=2;for(;n<a;){i.getUint16(n+2,!1)<=8&&e(0);const t=i.getUint16(n,!1);if(n+=2,65505===t){1165519206!==i.getUint32(n+=2,!1)&&e(0);const t=18761===i.getUint16(n+=6,!1);n+=i.getUint32(n+4,t);const s=i.getUint16(n,t);n+=2;for(let a=0;a<s;a++)if(274===i.getUint16(n+12*a,t)){switch(i.getUint16(n+12*a+8,t)){case 8:e(-90);break;case 6:e(90);break;case 3:e(180);break;default:e(0)}return}}else{if(65280&~t)break;n+=i.getUint16(n,!1)}}e(0)},i.readAsArrayBuffer(t)}))}}},7324:(t,e,s)=>{s.d(e,{A:()=>h});var i,a=s(15818),n=s(16309),o=s(14871);class r{constructor(t){this.value=t,this.getType=()=>this.value instanceof a.A?"color":this.value instanceof n.Ay?"gradient":this.value instanceof o.A?"pattern":void 0,this.getStringValue=()=>this.value instanceof a.A?this.value.toHEX():this.value instanceof n.Ay||this.value instanceof o.A?this.value.toJSON():void 0,this.getCssValue=()=>this.value instanceof a.A?this.value.toHEX():this.value instanceof n.Ay||this.value instanceof o.A?this.value.toCSS():void 0,this.addToCanvasFillStyle=(t,e=0,s=0)=>{this.value instanceof a.A?t.fillStyle=this.value.toHEX():this.value instanceof n.Ay?t.fillStyle=this.value.createCanvasGradient(t,e,s):this.value instanceof o.A&&(t.fillStyle=this.value.createCanvasPattern(t))},this.addToCanvasStrokeStyle=(t,e=0,s=0)=>{this.value instanceof a.A?t.strokeStyle=this.value.toHEX():this.value instanceof n.Ay?t.strokeStyle=this.value.createCanvasGradient(t,e,s):this.value instanceof o.A&&(t.strokeStyle=this.value.createCanvasPattern(t))}}}i=r,r.fromString=async(t,e)=>{let s;return"color"===t&&/^#[0-9A-F]{6}$/i.test(e)?s=new i(a.A.fromHEX(e)):"gradient"===t?s=new i(n.Ay.fromJSON(e)):"pattern"===t&&(s=new i(await o.A.fromJSON(e))),s};const h=r},16309:(t,e,s)=>{s.d(e,{Ay:()=>r,mR:()=>n});var i=s(54738),a=s(15818);class n{constructor(t,e,s=135,i="linear"){this.colors=t,this.positions=e,this.direction=s,this.type=i,this.toCSS=()=>{let t="linear-gradient("+this.direction+"deg";for(let e=0;e<this.colors.length;++e)t+=", "+a.A.fromHEXA(this.colors[e]).toRGBA()+" "+(100*this.positions[e]).toFixed(0)+"%";return t+=")",t}}}class o{constructor(t,e,s){this.id=t,this.color=e,this.position=s}}class r{constructor(){this.direction=0,this.type="linear",this.addStop=(t,e)=>{e=i.qE(e,0,1);const s=new o(i.r0(),t,e);return this.stops.push(s),this.sort(),s},this.removeStop=t=>{const e=this.stops.findIndex((e=>e.id===t));return-1!==e&&this.stops.splice(e,1),this.sort(),this.stops[0].id},this.getStop=t=>{let e;return this.stops.forEach((s=>{s.id===t&&(e=s)})),e},this.sort=()=>{this.stops.sort(((t,e)=>t.position-e.position))},this.toCSS=()=>{let t="linear-gradient(to right";for(let e=0;e<this.stops.length;++e)t+=", "+this.stops[e].color.toRGBA()+" "+(100*this.stops[e].position).toFixed(0)+"%";return t+=")",t},this.toJSON=()=>JSON.stringify(this.toIGradient()),this.toIGradient=()=>{let t=new Array;return this.stops.forEach((e=>{t.push({id:e.id,color:e.color.toHEXA(),position:e.position})})),{type:this.type,direction:this.direction,stops:t}},this.createCanvasGradient=(t,e=0,s=0)=>{let i;if("linear"===this.type){const a=(this.direction-90)*Math.PI/180,n=t.canvas.width,o=t.canvas.height;if(n<1||o<1)return;const r=Math.sqrt(n*n+o*o)/2,h=Math.asin(o/2/r);let l=(a%(2*Math.PI)+4*Math.PI)%(2*Math.PI);l>Math.PI&&(l-=Math.PI),l>Math.PI/2&&l<=Math.PI&&(l=Math.PI/2-(l-Math.PI/2));let c=Math.PI/2-h-Math.abs(l),d=Math.abs(h-Math.abs(l)),u=Math.max(Math.cos(d)*n,Math.cos(c)*o)/2,p=Math.cos(a)*u,g=Math.sin(a)*u;i=t.createLinearGradient(n/2+p+e,o/2+g+s,n/2-p+e,o/2-g+s)}else{let a=t.canvas.width/2,n=t.canvas.height/2,o=Math.max(t.canvas.width,t.canvas.height)/2;i=t.createRadialGradient(a+e,n+s,0,a+e,n+s,o)}return this.addStopToCanvasGradient(i),i},this.addStopToCanvasGradient=(t,e=!1)=>{for(let s=0;s<this.stops.length;++s)t.addColorStop(this.stops[s].position,this.stops[s].color.toRGBA(e?255-this.stops[s].color.a:this.stops[s].color.a))},this.stops=new Array}static fromJSON(t){let e=JSON.parse(t);return r.fromIGradient(e)}static fromIGradient(t){const e=new r;if(e.type=t.type&&"radial"===t.type?"radial":"linear",e.direction=t.direction,t.stops)for(let s=0;s<t.stops.length;++s){let i="string"==typeof t.stops[s].color?a.A.fromHEXA(t.stops[s].color):new a.A(t.stops[s].color.r,t.stops[s].color.g,t.stops[s].color.b,t.stops[s].color.a);e.addStop(i,t.stops[s].position)}return e}static fromPreset(t){const e=new r;for(let s=0;s<t.colors.length;++s)e.addStop(a.A.fromHEXA(t.colors[s]),t.positions[s]);return e.direction=t.direction+180,e.type=t.type,e}static fromColors(t,e){const s=new r;return s.addStop(t,0),s.addStop(e,1),s}}},7245:(t,e,s)=>{s.d(e,{A:()=>i});class i{constructor(t,e,s=!1){this.start=t,this.end=e,this.soft=s}}},21404:(t,e,s)=>{s.d(e,{A:()=>a});var i=s(41915);class a{constructor(t=1,e=0,s=0,i=1,n=0,o=0){this.a=t,this.b=e,this.c=s,this.d=i,this.e=n,this.f=o,this.reset=()=>{this.a=this.d=1,this.b=this.c=this.e=this.f=0},this.translate=t=>{this.transform(1,0,0,1,t.x,t.y)},this.rotate=t=>{let e=Math.cos(t),s=Math.sin(t);this.transform(e,s,-s,e,0,0)},this.rotateDegree=function(t){this.rotate(.017453292519943295*t)},this.transform=(t,e,s,i,a,n)=>{const o=this.a,r=this.b,h=this.c,l=this.d,c=this.e,d=this.f;this.a=o*t+h*e,this.b=r*t+l*e,this.c=o*s+h*i,this.d=r*s+l*i,this.e=o*a+h*n+c,this.f=r*a+l*n+d},this.invert=()=>{let t=this.a,e=this.b,s=this.c,i=this.d,n=this.e,o=this.f,r=(new a,t*i-e*s);this.a=i/r,this.b=-e/r,this.c=-s/r,this.d=t/r,this.e=(s*o-i*n)/r,this.f=-(t*o-e*n)/r}}transformPoint(t){return new i.A(t.x*this.a+t.y*this.c+this.e,t.x*this.b+t.y*this.d+this.f)}}},14871:(t,e,s)=>{s.d(e,{A:()=>r});var i,a=s(54738),n=s(6395);class o{constructor(t,e=1,s=0){this.svg=t,this.scale=e,this.direction=s,this.createCanvasPattern=t=>{let e;if(1!==this.scale){let s=a.Nw(Math.round(this.image.width*this.scale),Math.round(this.image.height*this.scale));s.getContext("2d").drawImage(this.image,0,0,s.width,s.height),e=t.createPattern(s,"repeat")}else e=t.createPattern(this.image,"repeat");return 0!==this.direction&&e.setTransform((new DOMMatrix).rotate(this.direction)),e},this.toCSS=()=>"url(data:image/svg+xml;base64,"+btoa(this.svg)+")",this.toJSON=()=>JSON.stringify(this.toIPattern())}toIPattern(t=this.svg){return{svg:t,scale:this.scale,direction:this.direction}}}i=o,o.fromIPattern=async t=>{let e=new i(t.svg,t.scale,t.direction),s=new Blob([e.svg],{type:"image/svg+xml"});return e.image=await(0,n.Ep)(s),e},o.fromJSON=async t=>{let e=JSON.parse(t);return i.fromIPattern(e)};const r=o},41915:(t,e,s)=>{s.d(e,{A:()=>i});class i{constructor(t=0,e=0){this.x=t,this.y=e}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}angleTo(t){let e=-(this.x-t.x),s=this.y-t.y,i=360-Math.atan2(s,e)*(180/Math.PI);return i<0&&(i+=360),i>360&&(i-=360),i}dot(t){return this.x*t.x+this.y*t.y}lengthSQ(){return this.dot(this)}length(){return Math.sqrt(this.lengthSQ())}hypot2(){return this.dot(this)}hypot(){return Math.hypot(this.x,this.y)}add(t){return t?t instanceof i?new i(this.x+t.x,this.y+t.y):new i(this.x+t,this.y+t):this}neg(t){return t instanceof i?new i(this.x-t.x,this.y-t.y):new i(this.x-t,this.y-t)}mul(t){return t instanceof i?new i(this.x*t.x,this.y*t.y):new i(this.x*t,this.y*t)}rotateAround(t,e){let s=Math.sin(e),a=Math.cos(e),n=this.x-t.x,o=this.y-t.y,r=n*s+o*a;return new i(n*a-o*s+t.x,r+t.y)}equalTo(t){return this.x===t.x&&this.y===t.y}clone(){return new i(this.x,this.y)}}},40963:(t,e,s)=>{s.d(e,{A:()=>o});var i=s(21404),a=s(41915),n=s(53900);class o{constructor(t=0,e=0,s=0,i=0,a=0){this.x=t,this.y=e,this.width=s,this.height=i,this.rotation=a}left(){return this.x}right(){return this.x+this.width}top(){return this.y}bottom(){return this.y+this.height}size(){return new n.A(this.width,this.height)}center(){return new a.A(this.x+this.width/2,this.y+this.height/2)}topLeft(){return new a.A(this.x,this.y)}topRight(){return new a.A(this.right(),this.y)}bottomLeft(){return new a.A(this.x,this.bottom())}bottomRight(){return new a.A(this.right(),this.bottom())}setTop(t){this.height=this.y+this.height-t,this.y=t}setLeft(t){this.width=this.x+this.width-t,this.x=t}setRight(t){this.width=Math.round(t-this.x)}setBottom(t){this.height=Math.round(t-this.y)}setCenter(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}setCenterX(t){this.x=t-.5*this.width}setCenterY(t){this.y=t-.5*this.height}moveRight(t){this.x=Math.round(t-this.width)}moveBottom(t){this.y=Math.round(t-this.height)}isSet(){return this.x>0||this.y>0||this.width>0||this.height>0||this.rotation>0}isInside(t){return t.x>=this.x&&t.x<this.x+this.width&&t.y>=this.y&&t.y<this.y+this.height}contains(t){return!!(t&&t.x>=this.x&&t.y>=this.y&&t.bottom()<=this.bottom()&&t.right()<=this.right())}equalTo(t){return!!t&&(this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.rotation===t.rotation)}clone(){return new o(this.x,this.y,this.width,this.height,this.rotation)}scale(t){return new o(Math.round(this.x*t),Math.round(this.y*t),Math.round(this.width*t),Math.round(this.height*t),this.rotation)}flipWidthAndHeight(){return new o(this.y,this.x,this.height,this.width)}union(t){if(!t)return this;const e=Math.min(this.x,t.x),s=Math.min(this.y,t.y),i=Math.max(this.x+this.width,t.x+t.width),a=Math.max(this.y+this.height,t.y+t.height);return new o(e,s,i-e,a-s)}intersect(t){let e=Math.max(this.x,t.x),s=Math.min(this.x+this.width,t.x+t.width);if(s<=e)return;let i=Math.max(this.y,t.y),a=Math.min(this.y+this.height,t.y+t.height);return a<=i?void 0:new o(e,i,s-e,a-i)}rebase(t,e){return new o(Math.round(this.x-t),Math.round(this.y-e),Math.round(this.width),Math.round(this.height))}gridAlign(){return new o(Math.floor(this.x),Math.floor(this.y),Math.ceil(this.width),Math.ceil(this.height))}getRotatedBounds(){if(0===this.rotation)return this;let t=new i.A,e=this.center();t.translate(e),t.rotate(this.rotation*Math.PI/180),t.invert();const s=t.transformPoint(this.topLeft()),a=t.transformPoint(this.topRight()),n=t.transformPoint(this.bottomLeft()),r=t.transformPoint(this.bottomRight());let h=o.fromPoints([s,a,n,r]);return h.x=Math.round(h.x+e.x),h.y=Math.round(h.y+e.y),h.rotation=this.rotation,h}rotatedSize(t){const e=this.width,s=this.height,i=(t,e)=>{var s=t[0].x,i=t[0].y,n=t[1].x,o=t[1].y,r=e[0].x,h=e[0].y,l=e[1].x,c=e[1].y;return new a.A(((s*o-i*n)*(r-l)-(s-n)*(r*c-h*l))/((s-n)*(h-c)-(i-o)*(r-l)),((s*o-i*n)*(h-c)-(i-o)*(r*c-h*l))/((s-n)*(h-c)-(i-o)*(r-l)))};let o,r,h,l,c,d,u;var p=t*(Math.PI/180),g=[new a.A(0,0),new a.A(e,0),new a.A(e,s),new a.A(0,s)],m=((t,e)=>{for(var s=new Array,i=0;i<t.length;++i)s.push(new a.A(t[i].x*Math.cos(e)-t[i].y*Math.sin(e),t[i].x*Math.sin(e)+t[i].y*Math.cos(e)));return s})(g=((t,e,s)=>{for(var i=new Array,n=0;n<t.length;++n)i.push(new a.A(t[n].x+e,t[n].y+s));return i})(g,-e/2,-s/2),p);return t>=0?(o=[new a.A(0,0),new a.A(-e/2,-s/2)],h=[m[0],m[3]],d=i(o,h),r=[new a.A(0,0),new a.A(e/2,-s/2)],l=[m[0],m[1]],u=i(r,l)):(o=[new a.A(0,0),new a.A(e/2,-s/2)],h=[m[1],m[2]],u=i(o,h),r=[new a.A(0,0),new a.A(-e/2,-s/2)],l=[m[0],m[1]],d=i(r,l)),c=new a.A(Math.max(d.x,-u.x),Math.max(d.y,u.y)),new n.A(Math.round(-c.x-c.x),Math.round(-c.y-c.y))}pad(t){return new o(this.x-t,this.y-t,this.width+2*t,this.height+2*t)}getAspect(){return this.width/this.height}getComparedScale(t){if(t)return new n.A(this.width/t.width,this.height/t.height)}static calculate(t,e,s=0){if(!t||!e)return;let i=new o;return i.x=Math.round(t.x<e.x?t.x:e.x),i.y=Math.round(t.y<e.y?t.y:e.y),i.width=Math.round(t.x<e.x?e.x-i.x:t.x-i.x),i.height=0!==s?Math.round(i.width/s):Math.round(t.y<e.y?e.y-i.y:t.y-i.y),i}static merge(t,e){if(!t&&!e)return;if(t&&!e)return t;if(!t&&e)return e;const s=Math.round(Math.min(t.x,e.x)),i=Math.round(Math.min(t.y,e.y)),a=Math.round(Math.max(t.x+t.width,e.x+e.width)),n=Math.round(Math.max(t.y+t.height,e.y+e.height));return new o(s,i,a-s,n-i)}static fillFit(t,e,s,i,a=!1){let n=1;return n=t/e<s/i?s/t:i/e,a&&n>1&&(n=1),new o(Math.round((s-t*n)/2),Math.round((i-e*n)/2),Math.round(t*n),Math.round(e*n))}static bestFit(t,e,s,i,a=!1){let n=1;return n=t/e>s/i?s/t:i/e,n>1&&!a&&(n=1),new o(Math.round((s-t*n)/2),Math.round((i-e*n)/2),Math.round(t*n),Math.round(e*n))}static fromPoints(t){let e=t[0].x,s=t[0].x,i=t[0].y,a=t[0].y;return t.forEach((t=>{e=Math.min(t.x,e),s=Math.max(t.x,s),i=Math.min(t.y,i),a=Math.max(t.y,a)})),new o(Math.round(e),Math.round(i),Math.round(s-e),Math.round(a-i))}static fromPointRects(t,e,s){let i=t[0].x,a=t[0].x+e,n=t[0].y,r=t[0].y+s;return t.forEach((t=>{i=Math.min(t.x,i),a=Math.max(t.x+e,a),n=Math.min(t.y,n),r=Math.max(t.y+s,r)})),new o(i,n,a-i,r-n)}}},67983:(t,e,s)=>{s.d(e,{A:()=>i});class i{constructor(t,e,s){this.start=t,this.stop=e,this.row=s}}},65209:(t,e,s)=>{s.d(e,{A:()=>i});class i{constructor(t,e){this.name=t,this.value=e}}},66495:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(40963);class a{static roundRect(t,e,s,i,a,n=0){const o=Math.min(i/2,a/2,n);t instanceof Path2D||t.beginPath(),t.moveTo(e+o,s),t.lineTo(e+i-o,s),t.quadraticCurveTo(e+i,s,e+i,s+o),t.lineTo(e+i,s+a-o),t.quadraticCurveTo(e+i,s+a,e+i-o,s+a),t.lineTo(e+o,s+a),t.quadraticCurveTo(e,s+a,e,s+a-o),t.lineTo(e,s+o),t.quadraticCurveTo(e,s,e+o,s),t.closePath()}static cutRect(t,e,s,i,a,n=0){const o=Math.min(i/2,a/2,n);t.beginPath(),t.moveTo(e+o,s),t.lineTo(e+i-o,s),t.lineTo(e+i,s+o),t.lineTo(e+i,s+a-o),t.lineTo(e+i-o,s+a),t.lineTo(e+o,s+a),t.lineTo(e,s+a-o),t.lineTo(e,s+o),t.lineTo(e+o,s),t.closePath()}}a.ellipse=(t,e,s)=>{let i=.5*(s.x-e.x),a=.5*(s.y-e.y),n=e.x+i,o=e.y+a,r=.01,h=r,l=2*Math.PI-r;for(t.beginPath(),t.moveTo(n+i*Math.cos(0),o+a*Math.sin(0));h<l;h+=r)t.lineTo(n+i*Math.cos(h),o+a*Math.sin(h));t.closePath()},a.triangle=(t,e,s)=>{t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(s.x,s.y),t.lineTo(e.x-(s.x-e.x),s.y),t.lineTo(e.x,e.y),t.closePath()},a.star=(t,e,s)=>{let i=Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2));t.beginPath(),t.translate(e.x,e.y),t.moveTo(0,0-i);for(var a=0;a<5;a++)t.rotate(Math.PI/5),t.lineTo(0,0-.5*i),t.rotate(Math.PI/5),t.lineTo(0,0-i);t.translate(-e.x,-e.y)},a.heart=(t,e,s)=>{let i=Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2)),a=.8*i;t.save(),t.translate(e.x,e.y-i/2),t.rotate(45*Math.PI/180),t.beginPath(),t.moveTo(0,0),t.bezierCurveTo(-a,0,-a,i,0,i),t.lineTo(i,i),t.lineTo(i,0),t.bezierCurveTo(i,-a,0,-a,0,0),t.closePath(),t.restore()},a.rectangle=(t,e,s,i,a)=>{t.beginPath(),t.moveTo(e,s),t.lineTo(e+i,s),t.lineTo(e+i,s+a),t.lineTo(e,s+a),t.lineTo(e,s),t.closePath()},a.line=(t,e,s)=>{t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(s.x,s.y)},a.bezier=(t,e,s,i)=>{t.beginPath(),t.moveTo(e.x,e.y),t.quadraticCurveTo(i.x,i.y,s.x,s.y)},a.arc=(t,e,s)=>{t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI)},a.fill=(t,e,s,n,o)=>{switch(e){case"rectangle":t.fillRect(s.x,s.y,n.x-s.x,n.y-s.y);break;case"rounded":const e=i.A.fromPoints([s,n]);a.roundRect(t,e.x,e.y,e.width,e.height,o),t.fill();break;case"ellipse":a.ellipse(t,s,n),t.fill();break;case"triangle":a.triangle(t,s,n),t.fill();break;case"star":a.star(t,s,n),t.fill();break;case"heart":a.heart(t,s,n),t.fill();break;case"line":a.line(t,s,n),t.stroke()}},a.stroke=(t,e,s,n,o)=>{switch(e){case"rectangle":t.strokeRect(s.x,s.y,n.x-s.x,n.y-s.y);break;case"rounded":const e=i.A.fromPoints([s,n]);a.roundRect(t,e.x,e.y,e.width,e.height,o),t.stroke();break;case"ellipse":a.ellipse(t,s,n),t.stroke();break;case"triangle":a.triangle(t,s,n),t.stroke();break;case"star":a.star(t,s,n),t.stroke();break;case"heart":a.heart(t,s,n),t.stroke();break;case"line":a.line(t,s,n),t.stroke()}};const n=a},53900:(t,e,s)=>{s.d(e,{A:()=>i});class i{constructor(t=0,e=0){this.width=t,this.height=e}}},68187:(t,e,s)=>{s.d(e,{E:()=>o});var i=s(29755),a=s(93771),n=s(63306);function o(t){const{port1:e,port2:s}=new MessageChannel;e.onmessage=async e=>{const s=e.ports[0];switch(e.data.op){case"open":{const i=e.data.buffer,n=new File([new Blob([i])],e.data.name);await a.Tq(t,n,void 0,"api"),t.fresco.saveMethod=s;break}case"open-url":{const o=e.data.url;new n.A({title:o.substring(o.lastIndexOf("/")+1),referrer:i.Ay.referrer}).load("/proxy/?url="+encodeURIComponent(o)).then((async e=>{await a.Tq(t,e,void 0,"api"),t.fresco.saveMethod=s}));break}default:console.error(`Unknown op ${e.data.op}`)}},window.parent.postMessage({op:"ready"},i.Ay.messageOrigin,[s])}},9810:(t,e,s)=>{s.d(e,{A:()=>l});var i=s(54738),a=s(42268),n=s(41915),o=s(15818),r=s(21404),h=s(29755);class l{constructor(t){this.zoomor=!1,this.hypo=void 0,this.cursorPos=new n.A(-999,-999),this.lastPos=new n.A(-999,-999),this.ants=Array(!0,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1),this.hide=()=>{this.raster.style.display="none"},this.show=()=>{this.raster.style.display="block"},this.drawDropPreviewRect=(t,e)=>{this.ctx.save(),this.ctx.strokeStyle=i.YD,this.clear();const s=this.stage.rasterRect,a=this.stage.zoom,n=e.rect.width*a,o=e.rect.height*a;this.ctx.strokeRect(t.x-s.x-n/2,t.y-s.y-o/2,n,o),this.dirty=!0,this.ctx.restore()},this.setPan=(t=this.raster,e=!1)=>{this.override||(this.byMouse=e,this.override=!0,t.addEventListener("mousedown",this.panDown,!1),t.classList.add("grab"),this.stage.resetAnchor(),this.cursorImage&&(0,a.Ay)("cursor-image")&&this.cursorImage.remove())},this.removePan=(t=this.raster)=>{(0,a.Ay)("color-picker-quick")||(this.override=!1,t.classList.remove("grab"),t.removeEventListener("mousedown",this.panDown,!1),this.cursorImage&&((0,a.Ay)("workspace").appendChild(this.cursorImage),this.positionCursorImage()))},this.panDown=t=>{t.stopPropagation(),this.stage.resetAnchor(),this.downPoint=new n.A(t.clientX,t.clientY),this.downAnchor=this.stage.anchor.clone(),document.addEventListener("mousemove",this.panMove,!0),document.addEventListener("mouseup",this.panUp,!0)},this.panMove=t=>{let e=~~((t.clientX-this.downPoint.x)/this.stage.zoom),s=~~((t.clientY-this.downPoint.y)/this.stage.zoom);this.stage.setAnchor(new n.A(this.downAnchor.x-e,this.downAnchor.y-s)),this.stage.updateViewport()},this.panUp=t=>{document.removeEventListener("mousemove",this.panMove,!0),document.removeEventListener("mouseup",this.panUp,!0),this.byMouse&&this.removePan()},this.setPicker=(t=this.raster)=>{var e;if(this.override)return;this.override=!0,t.addEventListener("mousedown",this.pickerDown,!1),t.addEventListener("mousemove",this.pickerMove,!1),t.classList.add("crosshair");const s=this.lastPos.clone(),l=new r.A;let c=null!==(e=(0,a.Ay)("color-picker-quick"))&&void 0!==e?e:(0,a.T)("div",{id:"color-picker-quick"});for(let i=0;i<h.Ay.oldColor.length;i++){l.reset(),l.rotateDegree(14*-i);let t=l.transformPoint(new n.A(-100,0));t.x+=s.x+20,t.y+=s.y-46;let e=(0,a.T)("div",{className:"color-pod small floater"});e.style.backgroundColor=h.Ay.oldColor[i],e.style.left=t.x+"px",e.style.top=t.y+"px",e.addEventListener("mousemove",(t=>{this.lastPos.x=t.clientX,this.lastPos.y=t.clientY,this.pickerPreview(this.lastPos.clone()),this.preview.style.backgroundColor=t.currentTarget.style.backgroundColor})),e.addEventListener("click",(t=>{let e=o.A.fromRGB(t.currentTarget.style.backgroundColor);this.preview.style.backgroundColor=e.toHEX(),document.dispatchEvent(new CustomEvent("set-color",{detail:e}))})),c.append(e)}(0,a.Ay)("workspace").appendChild(c),this.pickerCanvas=i.oM(document.getElementsByClassName("canvas")[0]),this.pickerCanvasCTX=this.pickerCanvas.getContext("2d",{willReadFrequently:!0}),this.preview=document.createElement("div"),this.preview.id="color-picker-preview",this.preview.style.display="none",(0,a.Ay)("workspace").appendChild(this.preview),this.cursorImage&&(0,a.Ay)("cursor-image")&&this.cursorImage.remove(),this.pickerPreview(s)},this.updateHistoryPods=()=>{var t=(0,a.Ay)("color-picker-quick").children;for(let e=0;e<t.length;e++)t[e].style.backgroundColor=h.Ay.oldColor[e]},this.pickerMove=t=>{this.lastPos.x=t.clientX,this.lastPos.y=t.clientY,this.pickerPreview(this.lastPos.clone())},this.pickerPreview=t=>{if(this.preview.style.top=t.y-50+"px",this.preview.style.left=t.x+10+"px",this.preview.style.display="block",t.x-=this.stage.canvas.offsetLeft,t.y-=this.stage.canvas.offsetTop,t.x<0||t.y<0||t.x>this.stage.canvas.width||t.y>this.stage.canvas.height)return void(this.preview.style.display="none");let e=this.pickerCanvasCTX.getImageData(t.x,t.y,1,1).data;this.preview.style.backgroundColor=new o.A(e[0],e[1],e[2]).toHEX()},this.pickerDown=t=>{let e=new n.A(t.clientX-this.stage.canvas.offsetLeft,t.clientY-this.stage.canvas.offsetTop);if(e.x<0||e.y<0||e.x>this.stage.canvas.width||e.y>this.stage.canvas.height)return;let s=this.pickerCanvasCTX.getImageData(e.x,e.y,1,1).data;const i=new o.A(s[0],s[1],s[2]);this.updateColorHistory(i),this.updateHistoryPods(),document.dispatchEvent(new CustomEvent("set-color",{detail:i}))},this.updateColorHistory=t=>{let e=t.toHEX(),s=h.Ay.oldColor.findIndex((t=>t===e));s>-1?h.Ay.oldColor.splice(0,0,h.Ay.oldColor.splice(s,1)[0]):(h.Ay.oldColor.pop(),h.Ay.oldColor.unshift(e)),(0,h.ZC)("oldColor",h.Ay.oldColor)},this.removePicker=(t=this.raster)=>{var e;this.override&&(this.override=!1,t.classList.remove("crosshair"),t.removeEventListener("mousedown",this.pickerDown,!1),t.removeEventListener("mousemove",this.pickerMove,!1),this.preview.remove(),null===(e=(0,a.Ay)("color-picker-quick"))||void 0===e||e.remove(),this.cursorImage&&(this.stage.workspace.appendChild(this.cursorImage),this.positionCursorImage()),this.pickerCanvasCTX=void 0,this.pickerCanvas=void 0)},this.setCursorImage=t=>{this.cursorImage&&(0,a.Ay)("cursor-image")&&(this.cursorImage.remove(),this.cursorImage=void 0),this.raster.style.cursor=t?"none":"crosshair",t&&(this.cursorImage=t,this.cursorImage.id="cursor-image",h.Ay.isHDPI&&(this.cursorImage.style.width=~~(this.cursorImage.width/2)+"px",this.cursorImage.style.height=~~(this.cursorImage.height/2)+"px"),this.cursorImage.style.transform="translate(-50%, -50%)",this.stage.workspace.appendChild(this.cursorImage),this.positionCursorImage())},this.positionCursorImage=()=>{this.cursorImage&&(this.cursorImage.style.left=this.cursorPos.x+this.raster.offsetLeft+"px",this.cursorImage.style.top=this.cursorPos.y+this.raster.offsetTop+"px")},this.removeCursorImage=()=>{this.raster.style.cursor="unset",this.cursorImage&&(this.cursorImage.remove(),this.cursorImage=void 0,this.cursorPos.x=this.cursorPos.y=-999)},this.animateCursorTap=()=>{if(h.Ay.performanceMode)return;const t=(0,a.T)("div",{className:"click-effect"});t.style.top=this.cursorPos.y+this.stage.rasterRect.y+"px",t.style.left=this.cursorPos.x+this.stage.rasterRect.x+"px",t.addEventListener("animationend",(()=>t.remove())),this.stage.workspace.appendChild(t)},this.throttle=0,this.mouseWheel=t=>{if("none"!==h.Ay.scrollMode&&(t.preventDefault(),t.stopPropagation(),this.throttle+20<Date.now())){if(this.throttle=Date.now(),this.stage.supressRender=!0,"zoom"===h.Ay.scrollMode&&!t.shiftKey||"move"===h.Ay.scrollMode&&t.shiftKey){const e=this.stage.getViewPort().center(),s=new n.A(t.clientX-this.stage.rasterRect.x,t.clientY-this.stage.rasterRect.y),i=this.stage.translateRasterToFresco(s);this.stage.setFluidZoom(t.deltaY<0);const a=this.stage.translateRasterToFresco(s);this.stage.setAnchor(new n.A(e.x+(i.x-a.x),e.y+(i.y-a.y)))}else{const e=this.stage.anchor.add(new n.A(t.deltaX,t.deltaY));this.stage.setAnchor(e)}this.stage.supressRender=!1,this.stage.updateViewport()}},this.mouseMove=t=>{this.lastPos.x=t.clientX,this.lastPos.y=t.clientY,this.cursorPos.x=t.clientX-this.stage.rasterRect.x,this.cursorPos.y=t.clientY-this.stage.rasterRect.y,this.cursorImage&&this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:this.stage.translateRasterToFresco(this.cursorPos)}))},this.mouseLeave=t=>{this.cursorPos.x=this.cursorPos.y=-999,this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:void 0}))},this.touchMove=t=>{if(t.targetTouches.length>1){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let e=Math.hypot(t.targetTouches[0].pageX-t.targetTouches[1].pageX,t.targetTouches[0].pageY-t.targetTouches[1].pageY);if(void 0===this.hypo)return this.hypo=e,this.downPoint=new n.A((t.targetTouches[0].pageX+t.targetTouches[1].pageX)/2,(t.targetTouches[0].pageY+t.targetTouches[1].pageY)/2),this.stage.resetAnchor(),void(this.downAnchor=this.stage.anchor.clone());if(this.hypo-e<-20||this.hypo-e>20)this.stage.setFluidZoom(Boolean(e>this.hypo)),this.hypo=e;else{const e=new n.A((t.targetTouches[0].pageX+t.targetTouches[1].pageX)/2,(t.targetTouches[0].pageY+t.targetTouches[1].pageY)/2),s=h.Ay.isHDPI?.5*this.stage.zoom:this.stage.zoom,i=Math.round(e.x-this.downPoint.x)/s,a=Math.round(e.y-this.downPoint.y)/s;this.stage.setAnchor(new n.A(this.downAnchor.x-i,this.downAnchor.y-a)),this.stage.updateViewport()}}else this.lastPos.x=t.targetTouches[0].pageX,this.lastPos.y=t.targetTouches[0].pageY,this.cursorPos.x=t.targetTouches[0].pageX-this.stage.rasterRect.x,this.cursorPos.y=t.targetTouches[0].pageY-this.stage.rasterRect.y,this.cursorImage&&this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:this.stage.translateRasterToFresco(this.cursorPos)}))},this.touchEnd=t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),this.hypo=void 0,this.downPoint=void 0,this.downAnchor=void 0,this.cursorPos.x=this.cursorPos.y=-999,this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:void 0}))},this.freeze=(t=!0)=>{this.frozen=t,t||this.render()},this.sleep=()=>{this.sleeping=!0,this.clear(!0)},this.wake=()=>{this.sleeping=!1,this.render()},this.so=7,this.render=(t,e=!0)=>{if(e&&this.clear(),this.sleeping)return;if(window.clearTimeout(this.timer),!this.stage||!this.stage.fresco||this.stage.supressRender)return;if(!this.stage.fresco.hasSelection())return void(t&&this.ctx.putImageData(t,0,0));let s,i,a,n,o,r=this.stage.zoom,h=this.stage.fresco.selection,l=this.stage.getViewPort(),c=this.stage.offset.x>0?this.stage.offset.x:0,d=this.stage.offset.y>0?this.stage.offset.y:0;if(t||(t=this.getImageData()),r>1){var u=Math.ceil(r)-1;for(let e=0,r=0,c=h.outline.length;e<c;e+=3)if(a=h.outline[e],n=h.outline[e+1],o=h.outline[e+2],a+h.offset.x>=l.x&&a+h.offset.x<l.x+l.width&&n+h.offset.y>=l.y&&n+h.offset.y<l.y+l.height)switch(s=Math.round((a+h.offset.x)*this.stage.zoom)+this.stage.offset.x,i=Math.round((n+h.offset.y)*this.stage.zoom)+this.stage.offset.y,o){case 0:for(this.drawAnt(s,i,t),r=1;r<=u;++r)this.drawAnt(s+r,i,t),this.drawAnt(s,i+r,t);break;case 1:for(r=0;r<=u;++r)this.drawAnt(s+r,i,t);break;case 2:for(s+=u,this.drawAnt(s,i,t),r=1;r<=u;++r)this.drawAnt(s-r,i,t),this.drawAnt(s,i+r,t);break;case 3:for(r=0;r<=u;++r)this.drawAnt(s,i+r,t);break;case 4:for(s+=u,r=0;r<=u;++r)this.drawAnt(s,i+r,t);break;case 5:for(i+=u,this.drawAnt(s,i,t),r=1;r<=u;++r)this.drawAnt(s,i-r,t),this.drawAnt(s+r,i,t);break;case 6:for(i+=u,r=0;r<=u;++r)this.drawAnt(s+r,i,t);break;case 7:for(s+=u,i+=u,this.drawAnt(s,i,t),r=1;r<=u;++r)this.drawAnt(s,i-r,t),this.drawAnt(s-r,i,t);break;case 8:for(this.drawAnt(s,i,t),this.drawAnt(s+u,i+u,t),r=1;r<=u;++r)this.drawAnt(s+r,i,t),this.drawAnt(s,i+r,t),this.drawAnt(s+u,i-r+u,t),this.drawAnt(s-r+u,i+u,t);break;case 9:for(this.drawAnt(s,i,t),r=1;r<=u;++r)this.drawAnt(s+r,i,t),this.drawAnt(s,i+r,t),this.drawAnt(s+r,i+u,t);break;case 10:for(s+=u,i+=u,this.drawAnt(s,i,t),r=1;r<=u;++r)this.drawAnt(s+r-u,i-u,t),this.drawAnt(s,i-r,t),this.drawAnt(s-r,i,t);break;case 11:for(r=0;r<=u;++r)this.drawAnt(s+r,i,t),this.drawAnt(s,i+r,t),this.drawAnt(s+u,i+r,t);break;case 12:for(r=0;r<=u;++r)this.drawAnt(s+r,i+u,t),this.drawAnt(s,i+r,t),this.drawAnt(s+u,i+r,t);break;case 13:for(r=0;r<=u;++r)this.drawAnt(s,i+r,t),this.drawAnt(s+u,i+r,t);break;case 14:for(r=0;r<=u;++r)this.drawAnt(s+r,i,t),this.drawAnt(s+r,i+u,t)}}else for(let p=0,g=h.outline.length;p<g;p+=3)a=h.outline[p],n=h.outline[p+1],o=h.outline[p+2],s=Math.round((a+h.offset.x-l.x)*r)+c,i=Math.round((n+h.offset.y-l.y)*r)+d,this.drawAnt(s,i,t);this.ctx.putImageData(t,0,0),this.dirty=!0,this.frozen||(this.timer=window.setTimeout((()=>{--this.so<0&&(this.so=7),this.frozen||this.render()}),400))},this.drawAnt=(t,e,s)=>{if(e=~~e,(t=~~t)>=0&&e>=0&&t<this.raster.width&&e<this.raster.height){let i=4*(e*this.raster.width+t);this.ants[(t+this.so)%8*8+e%8]?(s.data[i]=0,s.data[i+1]=0,s.data[i+2]=0,s.data[i+3]=255):(s.data[i]=255,s.data[i+1]=255,s.data[i+2]=255,s.data[i+3]=255)}},this.clear=(t=!1)=>{(t||this.dirty)&&(this.ctx&&this.ctx.clearRect(0,0,this.raster.width,this.raster.height),this.dirty=!1)},this.stage=t,this.raster=t.raster,this.ctx=this.raster.getContext("2d",{willReadFrequently:!0}),this.ctx.imageSmoothingEnabled=!1,this.raster.addEventListener("mousemove",this.mouseMove,!0),this.raster.addEventListener("mouseout",this.mouseLeave,!0),this.raster.addEventListener("touchmove",this.touchMove,{passive:!1}),this.raster.addEventListener("touchend",this.touchEnd,{passive:!1}),this.raster.addEventListener("wheel",this.mouseWheel,{passive:!1}),this.raster.addEventListener("contextmenu",(t=>{t.preventDefault()}),!1),"editor"===h.Ay.product&&document.addEventListener("viewport-render",(()=>this.render()),!1)}getImageData(){return this.ctx.getImageData(0,0,this.raster.width,this.raster.height)}drawAntPolygon(t){this.clear(),t.length>0&&(this.ctx.save(),this.ctx.lineWidth=1,this.ctx.translate(.5,.5),this.ctx.strokeStyle="#ffffff",this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y),t.forEach((t=>{this.ctx.lineTo(t.x,t.y)})),this.ctx.stroke(),this.ctx.strokeStyle="#000000",this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y),t.forEach((t=>{this.ctx.lineTo(t.x,t.y)})),this.ctx.stroke(),this.ctx.restore(),this.dirty=!0),this.render(void 0,!1)}drawAntBezier(t){if(this.clear(),t.length>0){this.ctx.save(),this.ctx.lineWidth=1,this.ctx.translate(.5,.5),this.ctx.strokeStyle="#ffffff",this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e+=2)e+1===t.length?this.ctx.lineTo(t[e].x,t[e].y):this.ctx.quadraticCurveTo(t[e+1].x,t[e+1].y,t[e].x,t[e].y);this.ctx.stroke(),this.ctx.strokeStyle="#000000",this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e+=2)e+1===t.length?this.ctx.lineTo(t[e].x,t[e].y):this.ctx.quadraticCurveTo(t[e+1].x,t[e+1].y,t[e].x,t[e].y);this.ctx.stroke(),this.ctx.restore(),this.dirty=!0}this.render(void 0,!1)}drawAntRectangle(t){this.clear();let e=this.getImageData();for(var s=0;s<t.height;++s)this.drawAnt(t.x,t.y+s,e),this.drawAnt(t.right()-1,t.y+s,e);for(var i=0;i<t.width;++i)this.drawAnt(t.x+i,t.y,e),this.drawAnt(t.x+i,t.bottom()-1,e);this.dirty=!0,this.render(e,!1)}drawAntEllipse(t){this.clear();let e=this.getImageData();var s,i,a,n,o,r,h,l,c,d,u,p,g,m,v,y,f=t.width%2==0?1:0,w=t.height%2==0?1:0;s=.5*t.width,h=0,l=i=.5*t.height,u=(c=s*s)*(1-(i<<1))+(m=(d=i*i)<<1),p=d-(g=c<<1)*((i<<1)-1),a=3*m,n=y=d<<2,o=(v=c<<2)*(i-1),r=g*((i<<1)-3),this.drawAnt(t.x+h+s-f,t.y+l+i-w,e),this.drawAnt(t.x-h+s,t.y+l+i-w,e),this.drawAnt(t.x-h+s,t.y-l+i,e),this.drawAnt(t.x+h+s-f,t.y-l+i,e);do{u<0?(u+=a,p+=n,a+=y,n+=y,h++):p<0?(u+=a-o,a+=y,o-=v,p+=n-r,n+=y,r-=v,h++,l--):(u-=o,o-=v,p-=r,r-=v,l--),this.drawAnt(t.x+h+s-f,t.y+l+i-w,e),this.drawAnt(t.x-h+s,t.y+l+i-w,e),this.drawAnt(t.x-h+s,t.y-l+i,e),this.drawAnt(t.x+h+s-f,t.y-l+i,e)}while(l>0);this.dirty=!0,this.render(e,!1)}cleanUp(){window.clearTimeout(this.timer)}}},80953:(t,e,s)=>{s.d(e,{l:()=>x,z:()=>b});var i=s(78832),a=s(54738),n=s(6395),o=s(40963),r=s(54127),h=s(39989),l=s(58489),c=s(86445),d=s(10122),u=s(22866),p=s(89209),g=s(35475),m=s(14983),v=s(37699),y=s(52038),f=s(27029),w=s(13947);class x{constructor(t,e,s,i,a,n,o){this.name=e,this.width=s,this.height=i,this.color=a,this.animation=o,this.templateMeta=n,this.id=t,this.lastModified=new Date,this.pinned=!1,this.timeoutId=null}async restore(t){const e=await(0,i.P2)();try{const[s,i]=e.transaction("readonly","layer-meta","document-selection"),[n,r]=await Promise.all([s.index("document").getAll(this.id),i.get(this.id)]);this.order||(this.order=n.sort(((t,e)=>t.order-e.order)).map((t=>t.id)));let h=[];if(this.order.forEach((t=>{const e=n.find((e=>e.id===t));e&&("bitmap"===e.type&&(e.type=u.A.TYPE_IMAGE),e.settings.rotation&&e.rect&&void 0===e.rect.rotation&&(e.rect.rotation=e.settings.rotation),e.rect&&void 0===e.rect.rotation&&(e.rect=new o.A(e.rect.x,e.rect.y,e.rect.width,e.rect.height,0)),h.push(e))})),h.length!==n.length){console.warn("Had layers that could not be sorted, this is a problem");const t=n.filter((t=>!this.order.includes(t.id)));h=h.concat(t)}if(r){t.addSelection();const e=t.selection;e.mask=await a.lz(r),e.ctx=e.mask.getContext("2d"),e.createOutline()}const l=await Promise.all(h.map((async t=>{const s=a.bD(b,t),[i,n]=e.transaction("readonly","layer-bitmap","layer-mask"),[o,r]=await Promise.all([i.get(s.id),n.get(s.id)]);return s.toLayer(o,r)})));l.forEach((e=>t.layers.push(e)))}catch(s){throw console.error("Restore",s),s}}async save(){const t=await(0,i.P2)(),[e]=t.transaction("readwrite","document-meta");await e.put(this)}async remove(){const t=await(0,i.P2)(),[e,s,a,n,o,r]=t.transaction("readwrite","document-meta","document-thumbnail","document-selection","layer-meta","layer-mask","layer-bitmap"),h=[e.delete(this.id),s.delete(this.id),a.delete(this.id)],l=await n.index("document").getAll(this.id);for(let i=0;i<l.length;i++){const t=l[i];h.push(n.delete(t.id)),h.push(r.delete(t.id)),h.push(o.delete(t.id))}await Promise.all(h)}async pendingRemove(t){const e=setTimeout((async()=>{await this.remove(),t(null,this)}),5e3);this.timeoutId=e}async undoRemove(){clearTimeout(this.timeoutId)}static async saveOrder(t){const e=t.layers.map((t=>t.id)),s=await(0,i.P2)(),[a]=s.transaction("readwrite","document-meta"),n=await a.get(t.id);n.order=e,await a.put(n)}static async duplicate(t){const e=await(0,i.P2)(),[s,n,o,r,h,l]=e.transaction("readwrite","document-meta","document-thumbnail","document-selection","layer-meta","layer-mask","layer-bitmap"),c=a.Os(),d=[(async()=>{const e=await n.get(t);e&&await n.add(e,c)})(),(async()=>{const e=await o.get(t);e&&await o.add(e,c)})()],u=await r.index("document").getAll(t),p={};for(let i=0;i<u.length;i++){const t=u[i],e=t.id,s=a.Os();p[e]=s,d.push((async()=>{t.id=s,t.document=c,await r.add(t)})(),(async()=>{const t=await l.get(e);t&&await l.add(t,s)})(),(async()=>{const t=await h.get(e);t&&await h.add(t,s)})())}d.push((async()=>{const e=await s.get(t);e.id=c,e.pinned=!1,e.order=e.order.map((t=>p[t])),e.lastModified=new Date,await s.add(e)})()),await Promise.all(d)}static async deleteAll(){const t=await(0,i.P2)(),[e]=t.transaction("readwrite","document-meta"),s=await e.getAll();for(let i=0;i<s.length;i++){const t=a.bD(x,s[i]);t.pinned||await t.remove()}}async getThumbnail(){const t=await(0,i.P2)(),[e]=t.transaction("readonly","document-thumbnail"),s=await e.get(this.id);return s?"string"==typeof s?(0,n.kw)(s):(0,n.Ep)(s):Promise.resolve(void 0)}static async getAll(){const t=await(0,i.P2)(),[e]=t.transaction("readonly","document-meta");return(await e.getAll()).map((t=>a.bD(x,t)))}static async history(){return x.getAll().then((t=>t.sort(((t,e)=>t.lastModified===e.lastModified?0:t.lastModified<e.lastModified?1:-1))))}static async getByID(t){const e=await(0,i.P2)(),[s]=e.transaction("readonly","document-meta"),n=await s.get(t);return a.bD(x,n)}async pin(){this.pinned=!0,await this.save()}async unpin(){this.pinned=!1,await this.save()}}class b{constructor(t,e){this.order=0,this.id=t.id,this.type=t.type,this.document=e,this.settings=t.settings,this.animation=t.animation,this.rect=t.rect,this.trim=t.trim,t instanceof r.A&&(this.textSettings=t.textSettings,this.text=t.text),t instanceof d.A&&(this.url=t.url,this.variant=t.variant,this.scalemethod=t.scalemethod),t instanceof c.A&&(this.shapeSettings=t.shapeSettings),t instanceof l.A&&(this.frameSettings=t.frameSettings),t instanceof w.A&&(this.groupSettings=t.groupSettings)}async toLayer(t,e){const s="string"==typeof t?await a.$e(t):await a.lz(t),i="string"==typeof e?await a.$e(e):await a.lz(e);switch(this.type){case u.A.TYPE_IMAGE:{const t=new h.A(this.id,this.settings.name,s,a.bD(o.A,this.rect),this.settings.locked);return i&&(t.mask=i,t.render()),t.settings=this.settings,t.animation=a.bD(y.A,this.animation),t}case u.A.TYPE_ELEMENT:{const t=new d.A(this.id,this.settings.name,s,this.url,this.variant,this.settings.blendmode,this.scalemethod);return t.settings=this.settings,t.rect=a.bD(o.A,this.rect),t.animation=a.bD(y.A,this.animation),t}case u.A.TYPE_TEXT:{const t=new r.A(this.id,this.text,a.bD(o.A,this.rect),a.bD(p.A,this.textSettings));return t.settings=this.settings,t.animation=a.bD(y.A,this.animation),await v.A.loadFont(this.textSettings.font),await t.prepare(),t}case u.A.TYPE_SHAPE:{const t=new c.A(this.id,this.settings.name,a.bD(o.A,this.rect),a.bD(m.A,this.shapeSettings));return t.settings=this.settings,t.animation=a.bD(y.A,this.animation),await t.prepare(),t}case u.A.TYPE_FRAME:{const t=new l.A(this.id,this.settings.name,a.bD(o.A,this.rect),a.bD(g.A,this.frameSettings));return t.canvas=s,t.settings=this.settings,t.trim=a.bD(o.A,this.trim),t.animation=a.bD(y.A,this.animation),t.canvas&&t.render(),t}case u.A.TYPE_GROUP:{const t=new w.A(this.id,this.settings.name,a.bD(f.A,this.groupSettings));return t.settings=this.settings,t.animation=a.bD(y.A,this.animation),t}}}static async delete(t){const e=await(0,i.P2)();let[s,a,n]=e.transaction("readwrite","layer-bitmap","layer-meta","layer-mask");await Promise.all([s.delete(t),a.delete(t),n.delete(t)])}static async sync(t,e){if(!e.hasLayer(t))throw new Error("This is probably a bug, cant create layermeta from layer not in the fresco");const s=new b(t,e.id);let n=!1;if(t.type===u.A.TYPE_IMAGE||t.type===u.A.TYPE_ELEMENT?n=t.rect&&t.rect.isSet()&&!!t.canvas||!t.rect&&!t.canvas:t.type===u.A.TYPE_FRAME&&(n=t.trim&&t.trim.isSet()&&!!t.canvas||!t.trim&&!t.canvas),n){const[e,n]=await Promise.all([a.PG(t.canvas),a.PG(t.mask)]),o=await(0,i.P2)();let[r,h,l]=o.transaction("readwrite","layer-bitmap","layer-meta","layer-mask");await Promise.all([h.put(s),e?r.put(e,s.id):r.delete(s.id),n?l.put(n,s.id):l.delete(s.id)])}else{const t=await(0,i.P2)();let[e]=t.transaction("readwrite","layer-meta");await e.put(s)}t.syncLatest=new Date}}},10122:(t,e,s)=>{s.d(e,{A:()=>c});var i=s(22866),a=s(54738),n=s(40963),o=s(41915),r=s(39989),h=s(52038);class l extends i.A{constructor(t=a.Os(),e,s,c,d,u="",p=l.SCALE_METHOD_NONE){super(i.A.TYPE_ELEMENT),this.id=t,this.rotateAndFit=(t,e)=>{this.settings.locked&&this.variant===l.VARIANT_OVERLAY?(this.rotate(t),this.calculate(new o.A(0,0),new o.A(e.width,e.height),0)):this.rect.rotation+=t?-90:90},this.calculate=(t,e,s)=>{this.rect.x=Math.round(t.x),this.rect.y=Math.round(t.y),this.rect.width=Math.round(e.x-t.x),this.rect.width<10&&(this.rect.width=10),0!==s?this.rect.height=Math.round(this.rect.width/s):(this.rect.height=Math.round(e.y-t.y),this.rect.height<10&&(this.rect.height=10))},this.rasterize=()=>{const t=new r.A(a.Os(),this.settings.name,a.oM(this.canvas),this.rect.clone(),this.settings.locked);return t.settings=Object.assign({},this.settings),t.applyTransform(),t},this.clone=(t=!1)=>{let e=new l(t?this.id:a.Os(),this.settings.name,a.oM(this.canvas),this.url,this.variant,this.settings.blendmode,this.scalemethod);return e.settings=Object.assign({},this.settings),e.rect=this.rect.clone(),e.animation=h.A.clone(this.animation),t&&(e.id=this.id,e.settings.name=this.settings.name),e},this.url=c,this.canvas=s,this.variant=d,this.scalemethod=p,this.settings.name=e,this.settings.blendmode=u,this.rect=new n.A(0,0,s.width,s.height)}}l.VARIANT_OVERLAY="overlay",l.VARIANT_STICKER="sticker",l.SCALE_METHOD_STRETCH="stretch",l.SCALE_METHOD_FILL="fill",l.SCALE_METHOD_NONE="none";const c=l},58489:(t,e,s)=>{s.d(e,{A:()=>d});var i=s(22866),a=s(54738),n=s(40963),o=s(15818),r=s(41915),h=s(39989),l=s(35475),c=s(52038);class d extends i.A{constructor(t=a.Os(),e,s,u=new l.A){super(i.A.TYPE_FRAME),this.id=t,this.prepare=()=>{this.setPath()},this.calculate=(t,e,s)=>{this.editMode&&this.trim?(this.trim.x=Math.round(t.x),this.trim.y=Math.round(t.y),this.trim.width=Math.round(e.x-t.x),this.trim.height=0===s?Math.round(e.y-t.y):Math.round(this.trim.width/(this.canvas.width/this.canvas.height)),this.trim.width<10&&(this.trim.width=10),this.trim.height<10&&(this.trim.height=10)):(this.rect.x=Math.round(t.x),this.rect.y=Math.round(t.y),this.rect.width=Math.round(e.x-t.x),this.rect.height=0!==s?Math.round(this.rect.width/s):Math.round(e.y-t.y),this.rect.width<10&&(this.rect.width=10),this.rect.height<10&&(this.rect.height=10))},this.setWidth=(t,e)=>{this.rect&&(t<1&&(t=1),this.editMode&&this.trim?(this.trim.width=t,0!==e&&(this.trim.height=Math.round(this.trim.width/(this.canvas.width/this.canvas.height)))):(this.rect.width=t,0!==e&&(this.rect.height=this.rect.width*e)),this.render())},this.setHeight=(t,e)=>{this.rect&&(t<1&&(t=1),this.editMode&&this.trim?(this.trim.height=t,0!==e&&(this.trim.height=Math.round(this.trim.height/(this.canvas.height/this.canvas.width)))):(this.rect.height=t,0!==e&&(this.rect.width=this.rect.height/e)),this.render())},this.position=(t,e)=>{this.rect&&(this.editMode?(this.trim&&(void 0!==t&&(this.trim.x=t),void 0!==e&&(this.trim.y=e)),this.render()):(void 0!==t&&(this.rect.x=t),void 0!==e&&(this.rect.y=e),this.bect.x=this.rect.x-(this.bect.width-this.rect.width)/2,this.bect.y=this.rect.y-(this.bect.height-this.rect.height)/2))},this.scale=(t,e)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*t),this.rect.y=Math.round(this.rect.y*e),this.rect.width=Math.round(this.rect.width*t),this.rect.height=Math.round(this.rect.height*e),this.trim&&(this.trim.x=Math.round(this.trim.x*t),this.trim.y=Math.round(this.trim.y*e),this.trim.width=Math.round(this.trim.width*t),this.trim.height=Math.round(this.trim.height*e)),this.frameSettings.outlineSize>0&&(this.frameSettings.outlineSize=Math.round(this.frameSettings.outlineSize*t)),this.frameSettings.shadow&&(this.frameSettings.shadowDistance=Math.round(100*this.frameSettings.shadowDistance*t)/100,this.frameSettings.shadowBlur=Math.round(100*this.frameSettings.shadowBlur*t)/100),this.render())},this.rotate=t=>{this.rect.rotation+=t?-90:90},this.flip=t=>{this.canvas&&(this.canvas=a.yz(this.canvas,t),this.render())},this.setPath=(t=this.frameSettings.clip,e=!1)=>{e||(this.frameSettings.clip=t),this.path2D=new Path2D(t),this.render()},this.setOutline=(t,e,s)=>{this.frameSettings.outline=t,this.frameSettings.outlineSize=e,this.frameSettings.outlineColor=s,this.render()},this.setShadow=(t,e,s,i,a,n)=>{this.frameSettings.shadow=t,this.frameSettings.shadowBlur=e,this.frameSettings.shadowOpacity=s,this.frameSettings.shadowColor=i,this.frameSettings.shadowDistance=a,this.frameSettings.shadowDirection=n,this.render()},this.setFrameSettings=t=>{this.frameSettings=t,this.render()},this.setContent=t=>{this.canvas=t,this.fitContent()},this.trimOnResize=t=>{if(!this.trim)return;let e=this.rect.getComparedScale(t);this.trim.x=Math.round(this.trim.x*e.width),this.trim.y=Math.round(this.trim.y*e.height),this.trim.width=Math.round(this.trim.width*e.width),this.trim.height=Math.round(this.trim.height*e.height)},this.fitContent=()=>{this.canvas?this.trim=n.A.fillFit(this.canvas.width,this.canvas.height,this.rect.width,this.rect.height):this.trim=void 0,this.render()},this.getGlobalTrim=()=>{if(this.trim)return new n.A(this.rect.x+this.trim.x,this.rect.y+this.trim.y,this.trim.width,this.trim.height,this.rect.rotation)},this.scaleTrim=(t,e)=>{if(this.trim){let s=this.trim.clone();this.trim.x=Math.round(this.trim.x*t),this.trim.y=Math.round(this.trim.y*e),this.trim.width=Math.round(this.trim.width*t),this.trim.height=Math.round(this.trim.height*e),this.trim.width<1&&(this.trim.width=1),this.trim.height<1&&(this.trim.height=1),this.trim=s}this.render()},this.render=()=>{this.frameSettings.clip;if(this.bect=this.rect.clone(),this.frameSettings.shadow){let t=100*this.frameSettings.shadowBlur;t+=Math.abs(100*this.frameSettings.shadowDistance),this.bect.width+=2*t,this.bect.height+=2*t,this.bect.x-=t,this.bect.y-=t}const t=this.baked.getContext("2d");this.baked.width!==this.bect.width||this.baked.height!==this.bect.height?(this.baked.height=this.bect.height,this.baked.width=this.bect.width):t.clearRect(0,0,this.baked.width,this.baked.height);const e=new Path2D;let s=t.lineWidth=this.frameSettings.outline?Math.round(100*this.frameSettings.outlineSize):this.canvas?0:2;if(this.path2D&&e.addPath(this.path2D,(new DOMMatrix).scale((this.rect.width-s)/100,(this.rect.height-s)/100)),t.save(),t.translate(this.rect.x-this.bect.x+s/2,this.rect.y-this.bect.y+s/2),this.canvas)this.frameSettings.outline?(t.strokeStyle=this.frameSettings.outlineColor,t.lineWidth=s,this.frameSettings.shadow&&this.shadowContext(t),t.fill(e),t.stroke(e)):this.frameSettings.shadow&&(this.shadowContext(t),t.fill(e)),t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0,t.clip(e),t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high",t.drawImage(this.canvas,this.trim.x-s/2,this.trim.y-s/2,this.trim.width,this.trim.height);else{t.save(),this.frameSettings.outline?t.strokeStyle=this.frameSettings.outlineColor:t.strokeStyle="#ccc",t.fillStyle="rgba(0, 0, 0, 0.3)",this.frameSettings.shadow&&this.shadowContext(t),t.fill(e),t.stroke(e),t.restore();const s=new r.A(Math.round(this.bect.width/2),Math.round(this.bect.height/2));let i=20;t.lineWidth=8,this.rect.width>500&&this.rect.height>500&&(t.lineWidth=16,i=40),t.strokeStyle="rgba(255, 255, 255, 0.5)",t.beginPath(),t.moveTo(s.x-i,s.y),t.lineTo(s.x+i,s.y),t.moveTo(s.x,s.y-i),t.lineTo(s.x,s.y+i),t.closePath(),t.stroke()}t.restore()},this.shadowContext=t=>{const e=o.A.fromHEX(this.frameSettings.shadowColor,Math.round(255*this.frameSettings.shadowOpacity)).toRGBA();var s=(this.frameSettings.shadowDirection-90)*Math.PI/180,i=Math.cos(s)*this.frameSettings.shadowDistance,a=Math.sin(s)*this.frameSettings.shadowDistance;t.fillStyle=e,t.shadowColor=e,t.shadowBlur=100*this.frameSettings.shadowBlur,t.shadowOffsetX=100*i,t.shadowOffsetY=100*a},this.replaceCanvas=t=>{const e=this.canvas.getContext("2d");e.save(),e.globalCompositeOperation="copy",e.drawImage(t,0,0),e.restore()},this.switchCanvas=(t,e)=>{this.canvas=t,this.trim=e.clone(),this.render()},this.rasterize=()=>{let t=this.baked?this.baked:this.canvas,e=this.bect?this.bect.clone():this.rect.clone();const s=new h.A(a.Os(),this.settings.name,t,e,this.settings.locked);return s.settings=Object.assign({},this.settings),s.applyTransform(),s},this.clone=(t=!1)=>{var e;let s=new d(t?this.id:a.Os(),this.settings.name,this.rect.clone(),this.frameSettings.clone());return s.settings=Object.assign({},this.settings),s.animation=c.A.clone(this.animation),s.trim=null===(e=this.trim)||void 0===e?void 0:e.clone(),s.canvas=a.oM(this.canvas),s.render(),t&&(s.id=this.id,s.settings.name=this.settings.name),s},this.rect=s,this.settings.name=e,this.frameSettings=u,this.baked=a.Nw(s.width,s.height),this.prepare()}}},35475:(t,e,s)=>{s.d(e,{A:()=>i});class i{constructor(){this.clip="M 0,0 H 100 V 100 H 0 Z",this.clipSize=0,this.outline=!1,this.outlineColor="#555555",this.outlineSize=.3,this.shadow=!1,this.shadowBlur=.3,this.shadowOpacity=.8,this.shadowColor="#000000",this.shadowDistance=.3,this.shadowDirection=180}clone(){const t=Object.create(i.prototype);return Object.assign(t,this)}equalTo(t){return!!t&&(this.clip===t.clip&&this.outline===t.outline&&this.outlineSize===t.outlineSize&&this.outlineColor===t.outlineColor&&this.shadow===t.shadow&&this.shadowBlur===t.shadowBlur&&this.shadowColor===t.shadowColor&&this.shadowOpacity===t.shadowOpacity&&this.shadowDistance===t.shadowDistance&&this.shadowDirection===t.shadowDirection)}}},82857:(t,e,s)=>{s.d(e,{A:()=>l});var i=s(22866),a=s(40963),n=s(54738),o=s(58489),r=s(56480),h=s(22656);class l{constructor(t,e,s,r,h,c,d,u){this.saveMethod="normal",this.block=!1,this.layerAddedCounterForUserEase=0,this.savedTimesCounterForUserEase=0,this.setBlock=(t=!1)=>{this.block=t||Boolean(!!this.templateMeta&&this.templateMeta.locked)},this.unblock=()=>{this.block=!1,this.templateMeta&&(this.templateMeta.locked=!1)},this.getSelected=()=>1!==this.selected.length?void 0:this.selected[0],this.getSelectedStack=()=>this.selected,this.getSelectedLinkedStack=()=>this.selectedLinked,this.updateSelectedLinkedStack=()=>{let t=new Set;for(let s of this.selected)s.hasLink()&&t.add(s.settings.link);let e=this.layers.filter((e=>t.has(e.settings.link)));this.selectedLinked=[...new Set([...this.selected,...e])]},this.getNotSelectedStack=(t=this.selected)=>this.layers.filter((e=>!t.includes(e))),this.getStackRect=(t=this.selected)=>{let e=new Array;for(let s of t)e.push(s.rect?s.rect.clone():void 0);return e},this.getStackBounds=(t=this.selected)=>{let e;if(1===t.length)e=t[0].editMode&&t[0]instanceof o.A?t[0].trim.clone():t[0].rect?t[0].rect.clone():void 0;else for(let s of t)s.rect&&(e=a.A.merge(e,s.rect.getRotatedBounds()));return e},this.getStackId=(t=this.selected)=>{let e=new Array;return t.forEach((t=>{e.push(t.id)})),e},this.getStackHashId=(t=this.selected)=>{if(0===t.length)return;if(1===t.length)return t[0].id;let e=this.getStackId(t).join(),s=0;for(let i=0;i<e.length;i++)s=(s<<5)-s+e.charCodeAt(i),s|=0;return s.toString()},this.getLayerById=t=>{let e;return this.layers.forEach((s=>{s.id===t&&(e=s)})),e},this.hasSelected=()=>this.selected.length>0,this.isSelectedStack=()=>this.selected.length>1,this.isSelectedLinkedStack=()=>this.selectedLinked.length>1,this.isSelectedType=t=>1===this.selected.length&&this.selected[0].type===t,this.isSelectedImageWithCanvas=()=>(!this.selected||1===this.selected.length)&&(this.selected[0].type===i.A.TYPE_IMAGE&&!!this.selected[0].canvas),this.isSelectedShaderbleWithCanvas=()=>(!this.selected||1===this.selected.length)&&((this.selected[0].type===i.A.TYPE_IMAGE||this.selected[0].type===i.A.TYPE_FRAME||this.selected[0].type===i.A.TYPE_ELEMENT)&&!!this.selected[0].canvas),this.isSelectedById=t=>{if(t)return-1!==this.selected.findIndex((e=>e.id===t))},this.isSelectedLinkedById=t=>{if(t)return-1!==this.selectedLinked.findIndex((e=>e.id===t))},this.selectLayerById=(t,e=!1,s=!1)=>{this.selected[0]&&(this.selected[0].editMode=!1);let a=!1;return t?e?this.isSelectedById(t)?s&&(this.unselectLayerById(t),a=!0):(this.selected.push(this.getLayerById(t)),a=!0):this.isSelectedById(t)&&1===this.selected.length||(this.selected=[this.getLayerById(t)],a=!0):0!==this.layers.length&&this.layers[0].settings.locked&&this.layers[0].type===i.A.TYPE_IMAGE?0===this.selected.length||1===this.selected.length&&this.selected[0]===this.layers[0]||(this.selected=[this.layers[0]],a=!0):0!==this.selected.length&&(this.selected=[],a=!0),this.selected.length>1&&this.selected.sort(((t,e)=>this.layers.indexOf(t)-this.layers.indexOf(e))),this.updateSelectedLinkedStack(),a},this.unselectLayerById=t=>{const e=this.selected.findIndex((e=>e.id===t));return-1!==e?(this.selected.splice(e,1),!0):(this.updateSelectedLinkedStack(),!1)},this.unselectLayers=()=>{this.selected=[],this.selectedLinked=[]},this.selectLayerStack=(t,e=!1)=>{this.selected=t,this.updateSelectedLinkedStack()},this.deleteLayerById=t=>{const e=this.layers.findIndex((e=>e.id===t));let s;return-1!==e&&(s=this.layers[e],this.layers.splice(e,1),this.unselectLayerById(t)),!this.hasSelected()&&this.layers.length>0&&(this.selected=[this.layers[e>0?e-1:0]]),this.updateSelectedLinkedStack(),s},this.clone=t=>{const e=(0,n.Q5)(this.name),s=new l(t||n.Os(),e,this.width,this.height,this.color,this.animation,this.templateMeta,this.source);return s.layers=this.layers.map((t=>t.clone())),s},this.cleanUp=()=>{this.saveMethod instanceof MessagePort&&(this.saveMethod.postMessage("close"),this.saveMethod.close())},this.id=t,this.name=e,this.width=s,this.height=r,this.color=h,this.animation=c,this.templateMeta=d,this.source=u,this.layers=[],this.selected=[],this.selectedLinked=[],this.setBlock()}addScratch(){return this.scratch||(this.scratch=new r.A),this.scratch}removeScratch(){this.scratch=void 0}hasScratch(){return!!this.scratch&&"none"!==this.scratch.renderMode}addSelection(){this.selection||(this.selection=new h.A(this.width,this.height))}clearSelection(){this.selection&&this.selection.clear()}removeSelection(){this.selection&&(this.selection.cleanUp(),this.selection=void 0)}hasSelection(){return this.selection&&this.selection.bounds&&this.selection.outline&&this.selection.outline.length>0}hasAnimation(){if(this.animation)return!0;for(const t of this.layers)if(t.animation&&!t.animation.block)return!0;return!1}hasLayers(){return this.layers.length>0}hasLayer(t){return this.layerNr(t.id)>=0}numLayers(){return this.layers.length}numSelected(){return this.selected.length}isSelectedLinked(){return this.selected.filter((t=>t.hasLink())).length===this.selected.length}nextAddedLayerNumber(){return this.numLayers()>this.layerAddedCounterForUserEase&&(this.layerAddedCounterForUserEase=this.numLayers()),(this.layerAddedCounterForUserEase+1).toString()}lockedBackground(){return this.layers.length>0&&this.layers[0].settings.locked&&this.layers[0].type===i.A.TYPE_IMAGE}selectedLayerNr(){if(0===this.selected.length)return-1;if(1===this.selected.length)return this.layerNr(this.selected[0].id);let t=0;return this.selected.forEach((e=>{t=Math.max(t,this.layerNr(e.id))})),t}layerNr(t){return this.layers.findIndex((e=>e.id===t))}changeLayerOrder(t,e){this.layers.splice(e,0,this.layers.splice(t,1)[0])}rotate(t){let e=this.width;this.width=this.height,this.height=e;for(let s=0;s<this.layers.length;s++)this.layers[s].rotate(t),this.layers[s].render()}flip(t){for(let e=0;e<this.layers.length;e++)this.layers[e].type===i.A.TYPE_IMAGE&&(this.layers[e].flip(t),this.layers[e].render())}straighten(t,e,s){if(this.lockedBackground()){let i=this.layers[0];i.rect.rotation=t,i.rect.x=-(i.rect.width-e)/2,i.rect.y=-(i.rect.height-s)/2}this.width=e,this.height=s}crop(t){this.width=t.width,this.height=t.height;for(let e=0;e<this.layers.length;e++)this.layers[e].rect&&(this.layers[e].rect.x-=t.x,this.layers[e].rect.y-=t.y,this.layers[e].render());this.selection&&this.selection.size(this.width,this.height)}setSize(t,e){this.width=t,this.height=e}resize(t,e,s){let i=t/this.width,a=e/this.height;this.width=t,this.height=e;for(let n=0;n<this.layers.length;n++)this.layers[n].scale(i,a,s);this.selection&&this.selection.resize(this.width,this.height)}size(t,e,s,i){let a=s?t:t-this.width,n=s?e:e-this.height;if(this.width=s?this.width+t:t,this.height=s?this.height+e:e,"TL"!=i){"CL"!=i&&"BL"!=i||(a=0),"TC"!=i&&"CC"!=i&&"BC"!=i||(a=Math.round(a/2)),"TC"!=i&&"TR"!=i||(n=0),"CL"!=i&&"CC"!=i&&"CR"!=i||(n=Math.round(n/2));for(let t=0;t<this.layers.length;t++)this.layers[t].rect&&(this.layers[t].rect.x+=a,this.layers[t].rect.y+=n,this.layers[t].render())}this.selection&&this.selection.size(this.width,this.height)}addLayer(t){this.layerAddedCounterForUserEase++;let e=this.selectedLayerNr();return e>-1?this.layers.splice(e+1,0,t):this.layers.push(t),this.selected=[t],this.updateSelectedLinkedStack(),t}replaceLayer(t){const e=this.layers.findIndex((e=>e.id===t.id));this.layers[e]=t;const s=this.selected.findIndex((e=>e.id===t.id));-1!==s&&(this.selected[s]=t),this.updateSelectedLinkedStack()}}},13947:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(22866),a=s(54738);class n extends i.A{constructor(t=a.Os(),e,s){super(i.A.TYPE_GROUP),this.id=t,this.settings.name=e,this.groupSettings=s}}},27029:(t,e,s)=>{s.d(e,{A:()=>i});class i{constructor(){this.color="",this.collapsed=!1,this.numberOfMembers=0}clone(){const t=Object.create(i.prototype);return Object.assign(t,this)}equalTo(t){return!!t&&(this.collapsed===t.collapsed&&this.numberOfMembers===t.numberOfMembers)}}},39989:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(22866),a=s(54738),n=s(40963),o=s(52038);class r extends i.A{constructor(t=a.Os(),e,s,h,l=!1){super(i.A.TYPE_IMAGE),this.id=t,this.calculate=(t,e,s)=>{this.canvas&&(this.rect.x=Math.round(t.x),this.rect.y=Math.round(t.y),this.rect.width=Math.round(e.x-t.x),this.rect.width<10&&(this.rect.width=10),0!==s?this.rect.height=Math.round(this.rect.width/s):(this.rect.height=Math.round(e.y-t.y),this.rect.height<10&&(this.rect.height=10)))},this.scale=(t,e,s)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*t),this.rect.y=Math.round(this.rect.y*e),this.rect.width=Math.round(this.rect.width*t),this.rect.height=Math.round(this.rect.height*e),this.applyTransform(s))},this.wouldApplyTransform=()=>!(!this.canvas||!this.rect)&&(0!==this.rect.rotation||this.rect.width!==this.canvas.width||this.rect.height!==this.canvas.height),this.applyStraighten=t=>{this.canvas=a.oc(this.canvas,this.rect.rotation,t),this.mask&&(this.mask=a.oc(this.mask,this.rect.rotation,t)),this.rect=t,this.render()},this.applyTransform=(t=!0)=>{if(!this.wouldApplyTransform())return!1;if(this.rect.width===this.canvas.width&&this.rect.height===this.canvas.height||(this.canvas=t?a.tm(this.canvas,this.rect.width,this.rect.height):a.B3(this.canvas,this.rect.width,this.rect.height),this.mask&&(this.mask=a.tm(this.mask,this.rect.width,this.rect.height))),0!==this.rect.rotation){this.rect=this.rect.getRotatedBounds(),this.canvas=a.oc(this.canvas,this.rect.rotation,this.rect),this.mask&&(this.mask=a.oc(this.mask,this.rect.rotation,this.rect));let t=a.TL(this.canvas);t.equalTo(new n.A(0,0,this.canvas.width,this.canvas.height))||(this.canvas=a.bK(this.canvas,t),this.mask&&(this.mask=a.bK(this.mask,t)),this.rect.width=t.width,this.rect.height=t.height,this.rect.x+=t.x,this.rect.y+=t.y),this.rect.rotation=0}return this.render(),!0},this.switchCanvas=(t,e)=>{this.mask&&!this.rect.equalTo(e)&&(this.mask=a.p(this.mask,this.rect,e)),this.canvas=t,this.rect=e.clone()},this.extendCanvas=t=>{if(!this.canvas)return this.rect=t,void(this.canvas=a.Nw(t.width,t.height));let e=this.rect.union(t);this.rect.equalTo(e)||(this.canvas=a.p(this.canvas,this.rect,e),this.mask&&(this.mask=a.p(this.mask,this.rect,e)),this.rect=e)},this.hasMask=()=>!!this.mask,this.addMask=(t="clear")=>{if(this.mask=a.Nw(this.canvas.width,this.canvas.height),"fill"===t){this.mask.getContext("2d").fillRect(0,0,this.mask.width,this.mask.height)}},this.invertMask=()=>{if(this.mask){let t=a.Nw(this.mask.width,this.mask.height),e=t.getContext("2d");e.save(),e.fillRect(0,0,t.width,t.height),e.globalCompositeOperation="xor",e.drawImage(this.mask,0,0),e.restore(),this.mask=t}},this.removeMask=()=>{this.mask=void 0,this.baked=void 0},this.render=()=>{if(this.mask){if(!this.canvas)return;this.baked&&this.baked.width===this.canvas.width&&this.baked.height===this.canvas.height||(this.baked=a.Nw(this.canvas.width,this.canvas.height));var t=this.baked.getContext("2d");t.save(),t.globalCompositeOperation="copy",t.drawImage(this.canvas,0,0),t.globalCompositeOperation="destination-in",t.drawImage(this.mask,0,0),t.restore(),t=void 0}},this.shrinkWrap=()=>{const t=a.TL(this.canvas);if(!t)return this.canvas=void 0,this.mask=void 0,this.baked=void 0,this.rect=void 0,!0;if(!t.equalTo(this.rect)){const e=a.Nw(t.width,t.height);return e.getContext("2d").drawImage(this.canvas,-t.x,-t.y),this.canvas=e,this.rect=t.rebase(-this.rect.x,-this.rect.y),this.mask&&(this.mask=a.y2(this.mask,t)),!0}return!1},this.rasterize=()=>this.clone(),this.clone=(t=!1)=>{var e;let s=new r(t?this.id:a.Os(),this.settings.name,a.oM(this.canvas),null===(e=this.rect)||void 0===e?void 0:e.clone(),!1);return s.settings=Object.assign({},this.settings),t||(s.settings.locked=!1),s.animation=o.A.clone(this.animation),this.baked&&(s.baked=a.oM(this.baked)),this.hasMask()&&(s.mask=a.oM(this.mask)),s},this.canvas=s,this.rect=h,this.settings.name=e,this.settings.locked=l}}},22866:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(54738);class a{constructor(t){this.settings={opacity:1,blendmode:"",locked:!1,visible:!0,name:"",link:""},this.hasLink=()=>this.settings.link&&""!==this.settings.link,this.rotate=t=>{this.canvas&&(this.canvas=i.SE(this.canvas,t?-90:90),this.mask&&(this.mask=i.SE(this.mask,t?-90:90)),this.rect=this.rect.flipWidthAndHeight())},this.flip=t=>{this.canvas&&(this.canvas=i.yz(this.canvas,t),this.mask&&(this.mask=i.yz(this.mask,t)))},this.setWidth=(t,e)=>{this.rect&&(t<1&&(t=1),this.rect.width=t,0!==e&&(this.rect.height=Math.round(this.rect.width/e),this.rect.height<1&&(this.rect.height=1)))},this.setHeight=(t,e)=>{this.rect&&(t<1&&(t=1),this.rect.height=t,0!==e&&(this.rect.width=Math.round(this.rect.height*e),this.rect.width<1&&(this.rect.width=1)))},this.position=(t,e)=>{this.rect&&(void 0!==t&&(this.rect.x=t),void 0!==e&&(this.rect.y=e))},this.scale=(t,e,s)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*t),this.rect.y=Math.round(this.rect.y*e),this.rect.width=Math.round(this.rect.width*t),this.rect.height=Math.round(this.rect.height*e),this.rect.width<0&&(this.rect.width=1),this.rect.height<0&&(this.rect.height=1))},this.setRect=t=>{this.bect?this.bect=t:this.rect=t},this.getRect=()=>this.bect?this.bect:this.rect,this.getCanvas=()=>this.transient?this.transient:this.baked?this.baked:this.canvas,this.setAltCanvas=()=>{this.transient=i.oM(this.canvas)},this.replaceCanvas=t=>{this.canvas?this.canvas.width===t.width&&this.canvas.height===t.height||(this.canvas.width=t.width,this.canvas.height=t.height):this.canvas=i.Nw(this.rect.width,this.rect.height);const e=this.canvas.getContext("2d");e.save(),e.imageSmoothingEnabled=!1,e.globalCompositeOperation="copy",e.drawImage(t,0,0),e.restore()},this.extendCanvas=t=>{},this.switchCanvas=(t,e)=>{},this.render=(t=!1)=>{},this.calculate=(t,e,s)=>{},this.rasterize=()=>{},this.clone=(t=!1)=>{},this.id=i.Os(),this.type=t}}a.TYPE_GROUP="group",a.TYPE_SCRATCH="scratch",a.TYPE_ELEMENT="element",a.TYPE_IMAGE="image",a.TYPE_SHAPE="shape",a.TYPE_FRAME="frame",a.TYPE_TEXT="text";const n=a},56480:(t,e,s)=>{s.d(e,{A:()=>o});var i=s(54738),a=s(22866),n=s(41915);class o extends a.A{constructor(){super(a.A.TYPE_SCRATCH),this.renderMode="none",this.setRenderMode=t=>{this.renderMode=t},this.calculate=(t,e,s)=>{this.canvas&&(this.rect.x=Math.round(t.x),this.rect.y=Math.round(t.y),this.rect.width=Math.round(e.x-t.x),this.rect.width<10&&(this.rect.width=10),0!==s?this.rect.height=Math.round(this.rect.width/s):(this.rect.height=Math.round(e.y-t.y),this.rect.height<10&&(this.rect.height=10)))},this.clear=t=>{t?i.tN(this.canvas,t,new n.A(0,0)):this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.baked&&this.btx.clearRect(0,0,this.baked.width,this.baked.height)},this.addBake=()=>{this.baked=i.oM(this.canvas),this.btx=this.baked.getContext("2d"),this.btx.imageSmoothingEnabled=!1},this.getCanvas=()=>this.baked?this.baked:this.canvas,this.applySelection=t=>{if(t.fresco.hasSelection()){let e=this.baked?this.btx:this.ctx;e.save(),this.baked&&(e.globalCompositeOperation="copy",e.drawImage(this.canvas,0,0)),e.globalCompositeOperation="destination-in",e.drawImage(t.fresco.selection.mask,-this.rect.x,-this.rect.y),e.restore()}},this.drawCanvas=(t,e="source-over",s=1)=>{t&&(this.ctx.save(),this.ctx.save(),this.ctx.globalAlpha=s,this.ctx.globalCompositeOperation=e,this.ctx.drawImage(t,0,0,t.width,t.height),this.ctx.restore())},this.drawToLayer=(t,e="source-over",s=1)=>{if(t&&t.canvas&&t.rect)if(t.type===a.A.TYPE_FRAME){this.canvas.width===t.canvas.width&&this.canvas.height===t.canvas.height||(t.canvas.width=this.canvas.width,t.canvas.height=this.canvas.height);const e=t.canvas.getContext("2d");e.imageSmoothingEnabled=!1,e.clearRect(0,0,t.canvas.width,t.canvas.height),e.drawImage(this.canvas,0,0)}else{const i=t.canvas.getContext("2d");if(i.save(),i.globalAlpha=s,i.imageSmoothingEnabled=!1,i.globalCompositeOperation=e,this.rect.rotation){i.imageSmoothingQuality="high",i.imageSmoothingEnabled=!0;let t=this.rect.x+.5*this.rect.width,e=this.rect.y+.5*this.rect.height;i.save(),i.translate(t,e),i.rotate(this.rect.rotation*Math.PI/180),i.drawImage(this.baked?this.baked:this.canvas,-.5*this.rect.width,-.5*this.rect.height,this.rect.width,this.rect.height),i.restore()}else i.drawImage(this.baked?this.baked:this.canvas,Math.round(this.rect.x-t.rect.x),Math.round(this.rect.y-t.rect.y),this.rect.width,this.rect.height);i.restore()}}}setTarget(t,e,s,a){this.id=t,this.rect=e.clone(),this.renderMode=s,this.canvas=a?i.oM(a):i.Nw(e.width,e.height),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.baked=void 0,this.btx=void 0}}},86445:(t,e,s)=>{s.d(e,{A:()=>p});var i=s(54738),a=s(22866),n=s(7324),o=s(40963),r=s(15818),h=s(41915),l=s(66495),c=s(39989),d=s(6395),u=s(52038);class p extends a.A{constructor(t=i.Os(),e,s,g){super(a.A.TYPE_SHAPE),this.id=t,this.prepare=async()=>{if("svg"===this.shapeSettings.variant&&!this.image){let t=new Blob([this.shapeSettings.content],{type:"image/svg+xml"});this.image=await(0,d.Ep)(t),this.rect||(this.rect=new o.A(0,0,this.image.width,this.image.height))}"path"===this.shapeSettings.variant&&(this.path2D=new Path2D(this.shapeSettings.content)),this.shapeSettings.fillType&&(this.fill=await n.A.fromString(this.shapeSettings.fillType,this.shapeSettings.fillValue),document.dispatchEvent(new CustomEvent("layer-select"))),"line"===this.shapeSettings.variant&&this.shapeSettings.outlineSize!==this.rect.height&&(this.rect.height=this.shapeSettings.outlineSize),this.canvas||(this.canvas=i.Nw(this.rect.width,this.rect.height)),this.render()},this.setVariant=t=>{switch(t){case"rounded":this.shapeSettings.variant="rounded";break;case"rectangle":this.shapeSettings.variant="rectangle";break;case"ellipse":this.shapeSettings.variant="ellipse";break;case"line":this.shapeSettings.variant="line"}this.render()},this.setPath=(t,e=!1)=>{e||(this.shapeSettings.content=t),this.shapeSettings.variant="path",this.path2D=new Path2D(t),this.render()},this.setFill=(t,e=!1)=>{this.fill=t,e||(this.shapeSettings.fillType=this.fill?t.getType():void 0,this.shapeSettings.fillValue=this.fill?t.getStringValue():void 0),this.render()},this.setOutline=(t,e)=>{this.shapeSettings.outlineSize=t,this.shapeSettings.outlineColor=e,"line"===this.shapeSettings.variant&&(this.rect.height=0===t?1:t),this.render()},this.setShadow=(t,e,s,i,a,n)=>{this.shapeSettings.shadow=t,this.shapeSettings.shadowBlur=e,this.shapeSettings.shadowOpacity=s,this.shapeSettings.shadowColor=i,this.shapeSettings.shadowDistance=a,this.shapeSettings.shadowDirection=n,this.render()},this.setRadii=t=>{this.shapeSettings.radii=t,this.render()},this.render=(t=!1)=>{if(!this.canvas)return;const e=this.canvas.getContext("2d");if(this.canvas.width!==this.rect.width||this.canvas.height!==this.rect.height?(this.canvas.height=this.rect.height,this.canvas.width=this.rect.width):e.clearRect(0,0,this.canvas.width,this.canvas.height),"svg"===this.shapeSettings.variant)return e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high",void e.drawImage(this.image,0,0,this.rect.width,this.rect.height);if("line"===this.shapeSettings.variant)e.fillStyle=this.shapeSettings.outlineColor,e.fillRect(0,0,this.rect.width,this.rect.height);else{e.save();let t,s=2*this.shapeSettings.outlineSize,i=this.shapeSettings.outlineSize,a=this.rect.width-s,n=this.rect.height-s,o=i>0,r=!(!this.fill||!this.fill.value);switch(e.lineWidth=s,e.strokeStyle=this.shapeSettings.outlineColor,this.shapeSettings.variant){case"path":t=new Path2D,t.addPath(this.path2D,(new DOMMatrix).scale(a/100,n/100)),e.translate(i,i);break;case"rounded":l.A.roundRect(e,i,i,a,n,this.shapeSettings.radii);break;case"rectangle":l.A.rectangle(e,i,i,a,n);break;case"ellipse":l.A.ellipse(e,new h.A(i,i),new h.A(i+a,i+n))}o&&t?e.stroke(t):o&&e.stroke(),r?this.fill.addToCanvasFillStyle(e):(e.fillStyle="#ffffff",e.globalCompositeOperation="destination-out"),t?e.fill(t):e.fill(),e.restore()}if(this.shapeSettings.shadow){this.baked||(this.baked=i.Nw(100,100));var s=100*this.shapeSettings.shadowBlur;s+=Math.abs(100*this.shapeSettings.shadowDistance),this.bect=new o.A(this.rect.x-s,this.rect.y-s,this.rect.width+2*s,this.rect.height+2*s,this.rect.rotation),this.baked.width=this.bect.width,this.baked.height=this.bect.height;let t=this.baked.getContext("2d");var a=(this.shapeSettings.shadowDirection-90)*Math.PI/180,n=Math.cos(a)*this.shapeSettings.shadowDistance,c=Math.sin(a)*this.shapeSettings.shadowDistance;t.save(),t.shadowColor=r.A.fromHEX(this.shapeSettings.shadowColor,Math.round(255*this.shapeSettings.shadowOpacity)).toRGBA(),t.shadowBlur=100*this.shapeSettings.shadowBlur,t.shadowOffsetX=100*n,t.shadowOffsetY=100*c,t.drawImage(this.canvas,s,s),t.restore()}else this.baked=void 0,this.bect=void 0},this.calculate=(t,e,s)=>{"line"===this.shapeSettings.variant?(this.rect.x=Math.round(t.x),this.rect.width=Math.round(e.x-t.x)):(this.rect.x=Math.round(t.x),this.rect.y=Math.round(t.y),this.rect.width=Math.round(e.x-t.x),this.rect.width<2&&(this.rect.width=2),0!==s?this.rect.height=Math.round(this.rect.width/s):(this.rect.height=Math.round(e.y-t.y),this.rect.height<2&&(this.rect.height=2)))},this.position=(t,e)=>{this.rect&&(void 0!==t&&(this.rect.x=t),void 0!==e&&(this.rect.y=e),this.bect&&(this.bect.x=this.rect.x-(this.bect.width-this.rect.width)/2,this.bect.y=this.rect.y-(this.bect.height-this.rect.height)/2))},this.scale=(t,e)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*t),this.rect.y=Math.round(this.rect.y*e),this.rect.width=Math.round(this.rect.width*t),this.rect.height=Math.round(this.rect.height*e),this.rect.width<0&&(this.rect.width=1),this.rect.height<0&&(this.rect.height=1),this.shapeSettings.outlineSize>0&&(this.shapeSettings.outlineSize=Math.round(this.shapeSettings.outlineSize*t)),this.shapeSettings.shadow&&(this.shapeSettings.shadowDistance=Math.round(100*this.shapeSettings.shadowDistance*t)/100,this.shapeSettings.shadowBlur=Math.round(100*this.shapeSettings.shadowBlur*t)/100),this.render())},this.rotate=t=>{this.rect.rotation+=t?-90:90},this.rasterize=()=>{let t=this.baked?this.baked:this.canvas,e=this.bect?this.bect.clone():this.rect.clone();const s=new c.A(i.Os(),this.settings.name,t,e,this.settings.locked);return s.settings=Object.assign({},this.settings),s.applyTransform(),s},this.clone=(t=!1)=>{let e=new p(t?this.id:i.Os(),this.settings.name,this.rect.clone(),this.shapeSettings.clone());return e.settings=Object.assign({},this.settings),e.animation=u.A.clone(this.animation),e.prepare(),e},this.rect=s,this.settings.name=e,this.shapeSettings=g}}},14983:(t,e,s)=>{s.d(e,{A:()=>i});class i{constructor(){this.radii=0,this.outlineSize=0,this.outlineColor="#555555",this.shadow=!1,this.shadowBlur=.3,this.shadowOpacity=.8,this.shadowColor="#000000",this.shadowDistance=.3,this.shadowDirection=180}clone(){const t=Object.create(i.prototype);return Object.assign(t,this)}equalTo(t){return!!t&&(this.variant===t.variant&&this.radii===t.radii&&this.content===t.content&&this.fillType===t.fillType&&this.fillValue===t.fillValue&&this.outlineSize===t.outlineSize&&this.outlineColor===t.outlineColor&&this.shadow===t.shadow&&this.shadowBlur===t.shadowBlur&&this.shadowColor===t.shadowColor&&this.shadowOpacity===t.shadowOpacity&&this.shadowDistance===t.shadowDistance&&this.shadowDirection===t.shadowDirection)}}},59857:(t,e,s)=>{s.d(e,{A:()=>z});var i=s(21742),a=s(42268),n=s(78832),o=s(98244),r=s(29755),h=s(93771),l=s(82857),c=s(9810),d=s(26931),u=s(38665),p=s(54738),g=s(53900),m=s(40963),v=s(41915),y=s(22866),f=s(23556),w=s(54127),x=s(58489),b=s(39989),A=s(86445),k=s(10122),S=s(89209),E=s(14983),C=s(79453),T=s(95251),L=s(80953),M=s(13947),P=s(27029);class D{constructor(t,e,s=!1){this.zoom=1,this.zoomMode="fit",this.anchor=new v.A(0,0),this.fresco=t,this.history=new T.J(t,e,s)}}class z{constructor(t){this.tabLimit=10,this.showTabs=!1,this.bounds="editor"===r.Ay.product?20:40,this.syncDisabled=!1,this.supressRender=!1,this.zoom=1,this.zoomMode="fit",this.createBGPattern=()=>{let t="#2D2F34",e="#1D2023";switch(r.Ay.workspace){case"iron":t="#2d2d2d",e="#3e3e3e";break;case"steel":t="#f5f5f5",e="#b6b6b6";break;case"light":t="#ffffff",e="#cccccc"}let s=p.VI(20,20),i=s.getContext("2d");i.fillStyle=t,i.fillRect(0,0,20,20),i.fillStyle=e,i.fillRect(10,0,10,10),i.fillRect(0,10,10,10),this.ptn=this.ctx.createPattern(s,"repeat")},this.doSync=t=>{t instanceof CustomEvent&&this.syncDocument(t.detail)},this.doRender=t=>{t instanceof CustomEvent&&(this.supressRender=!1===t.detail)},this.touch=()=>{document.documentElement.classList.add("touch"),document.removeEventListener("touchstart",this.touch,!1),r.Ay.canTouch=!0},this.notify=t=>{document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)(t)}))},this.syncQueue=0,this.browseFrameImage=async()=>{await h.XN(!1,!0).then((async t=>{document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));for(let e=0;e<t.length;e++)await h.Tq(this,t[e],!1,"frame");document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}))},this.setFrameContent=t=>{var e;const s=this.fresco.getSelected();let i,a;s.canvas&&(i=p.oM(s.canvas),a=null===(e=s.trim)||void 0===e?void 0:e.clone()),s.setContent(t),s.editMode=!1;const n=i?t?"replace":"delete":"add";this.history.add({type:"frameContent",kind:n,layer:s,canvas:i,trim:a}),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layerlist-update"))},this.fitFrameContent=()=>{var t;const e=this.fresco.getSelected();if(e instanceof x.A){let s=null===(t=e.trim)||void 0===t?void 0:t.clone();e.fitContent(),this.history.add({type:"arrange",layer:e,kind:"fitContent",action:{type:"trim",rect:s}})}document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layerlist-update"))},this.addLayer=t=>{for(let e=0;e<t.length;e++)this.fresco.addLayer(t[e]),this.history.add({type:"addLayer",kind:"add"+t[e].type,layer:t[e]});this.fresco.selectLayerStack(t)},this.addCopiedLayer=async t=>{let e,s=new Array,a=new m.A(0,0,this.fresco.width,this.fresco.height),n=this.fresco.getStackBounds(t);n&&!a.contains(n)&&(e=new v.A(Math.round((a.width-n.width)/2),Math.round((a.height-n.height)/2)));for(let o=0;o<t.length;o++){let a=t[o].clone();-1===a.settings.name.indexOf((0,i.A)("copy"))&&(a.settings.name+=" "+(0,i.A)("copy")),a.settings.link="",e&&(a.rect.x=a.rect.x-n.x+e.x,a.rect.y=a.rect.y-n.y+e.y),a instanceof A.A||a instanceof w.A||a instanceof x.A?await a.prepare():a.render(),this.fresco.addLayer(a),this.history.add({type:"addLayer",kind:"paste"+a.type,layer:a}),s.push(a)}this.fresco.selectLayerStack(s),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.duplicateLayer=async(t=!0)=>{let e=this.fresco.getSelectedStack();if(0===e.length)return;let s=new Array;for(let a=0;a<e.length;a++){let t=e[a].clone();-1===t.settings.name.indexOf((0,i.A)("copy"))&&(t.settings.name+=" "+(0,i.A)("copy")),t.settings.link="",t instanceof A.A||t instanceof w.A||t instanceof x.A?await t.prepare():t.render(),this.fresco.addLayer(t),this.history.add({type:"addLayer",kind:"duplicate"+t.type,layer:t}),s.push(t)}this.fresco.selectLayerStack(s),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),t&&this.notify("duplicated")},this.deleteLayer=(t=!1)=>{let e=this.fresco.getSelectedStack();if(0!==e.length){if(1===e.length&&e[0]instanceof x.A&&(t||e[0].editMode))this.setFrameContent(void 0);else{this.fresco.getStackId().forEach((t=>{const e=this.fresco.layerNr(t),s=this.fresco.deleteLayerById(t);this.history.add({type:"deleteLayer",layer:s,index:e})})),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))}this.notify("deleted")}},this.linkLayer=()=>{let t=this.fresco.getSelectedStack();if(0===t.length||1===t.length&&!t[0].hasLink())return;let e="add";const s=new Array,i=p.r0(),a=t.filter((t=>!t.hasLink()));if(a.length===t.length)t.forEach((t=>{var e;s.push({layer:t,link:null!==(e=t.settings.link)&&void 0!==e?e:""}),t.settings.link=i}));else if(0===a.length){e="remove";const i=new Set;t.forEach((t=>{var e;i.add(t.settings.link),s.push({layer:t,link:null!==(e=t.settings.link)&&void 0!==e?e:""}),t.settings.link=""})),i.forEach((t=>{var e;const i=this.fresco.layers.filter((e=>e.settings.link===t));1===i.length&&(s.push({layer:i[0],link:null!==(e=i[0].settings.link)&&void 0!==e?e:""}),i[0].settings.link="")}))}else{const e=new Set;if(t.forEach((t=>{e.add(t.settings.link)})),1===e.entries.length){let t=[...e][0];a.forEach((e=>{var i;s.push({layer:e,link:null!==(i=e.settings.link)&&void 0!==i?i:""}),e.settings.link=t}))}else t.forEach((t=>{var e;s.push({layer:t,link:null!==(e=t.settings.link)&&void 0!==e?e:""}),t.settings.link=i})),e.forEach((t=>{var e;const i=this.fresco.layers.filter((e=>e.settings.link===t));1===i.length&&(s.push({layer:i[0],link:null!==(e=i[0].settings.link)&&void 0!==e?e:""}),i[0].settings.link="")}))}s.length>0&&this.history.add({type:"link",kind:e,stack:s}),this.fresco.updateSelectedLinkedStack(),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.selectLayer=(t,e=!1,s=!1,i=!1)=>{this.selectLayerById(t?t.id:void 0,e,s,i)},this.selectLayerStack=(t,e=!1,s=!1)=>{this.fresco.selectLayerStack(t,e),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.selectLayerById=(t,e=!1,s=!1,i=!1)=>{this.fresco.selectLayerById(t,e,s)&&(document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),i&&document.dispatchEvent(new CustomEvent("layer-marked")))},this.unselectLayerById=t=>{this.fresco.unselectLayerById(t)&&(document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")))},this.isSelectedLayerShaderble=()=>{var t;const e=null===(t=this.fresco)||void 0===t?void 0:t.getSelected();return e&&(e.type===y.A.TYPE_IMAGE||e.type===y.A.TYPE_FRAME||e.type===y.A.TYPE_ELEMENT)&&!!e.canvas},this.mergeDown=()=>{if(!this.fresco.getSelected())return;const t=this.fresco.getSelected(),e=this.fresco.layers.findIndex((e=>t.id===e.id)),s=this.fresco.layers.map((t=>t.id));if(e<1)return void this.notify("noMerger");const i=this.fresco.layers[e-1],a=t.rect?t.rect.getRotatedBounds():void 0,n=i.rect?i.rect.getRotatedBounds():void 0,o=a?a.union(n):n;let r;if(o){r=p.Nw(o.width,o.height);const e=r.getContext("2d");this.renderLayer(e,i,!1,o.topLeft()),this.renderLayer(e,t,!1,o.topLeft())}const h=new b.A(p.Os(),t.settings.name,r,o,i.settings.locked),l=this.fresco.layers.splice(e-1,2,h);this.fresco.selectLayerById(h.id),document.dispatchEvent(new CustomEvent("layerlist-update")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"merge",kind:"down",layers:l,order:s,target:h}),this.notify("layersMerged")},this.mergeVisible=()=>{const t=this.fresco.layers.findIndex((t=>t.settings.visible)),e=this.fresco.layers.map((t=>t.id));if(t<0)return void this.notify("noMerge");const s=this.fresco.layers[t];let i=this.getOutputCanvas();const a=new b.A(p.Os(),s.settings.name,i,new m.A(0,0,i.width,i.height),!0),n=this.fresco.layers.filter((t=>t.settings.visible));this.fresco.layers=this.fresco.layers.filter((t=>!t.settings.visible)),this.fresco.layers.splice(t,0,a),this.fresco.selectLayerById(a.id),document.dispatchEvent(new CustomEvent("layerlist-update")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"merge",kind:"visible",order:e,layers:n,target:a}),this.notify("layersMerged")},this.mergeFlatten=()=>{let t=this.getOutputCanvas();const e=new b.A(p.Os(),(0,i.A)("background"),t,new m.A(0,0,t.width,t.height),!0),s=this.fresco.layers.slice(),a=this.fresco.layers.map((t=>t.id));this.fresco.layers=[e],this.fresco.selectLayerById(e.id),document.dispatchEvent(new CustomEvent("layerlist-update")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"merge",kind:"flatten",layers:s,order:a,target:e}),this.notify("imageFlattend")},this.moveUp=()=>{if(this.fresco.getSelected()){let t=this.fresco.selectedLayerNr(),e=t+1;(0!=t||!this.fresco.lockedBackground())&&e<this.fresco.numLayers()&&this.changeOrder(t,e)}},this.moveDown=()=>{if(this.fresco.getSelected()){let t=this.fresco.selectedLayerNr(),e=t-1;(e>0||!this.fresco.lockedBackground()&&1==t)&&this.changeOrder(t,e)}},this.changeOrder=(t,e)=>{this.fresco.changeLayerOrder(t,e),this.render(),this.history.add({type:"order",from:t,to:e})},this.changeVisible=(t,e)=>{if(!t)return;const s=Object.assign({},t.settings);t.settings.visible=e,this.history.add({type:"layerSettings",kind:"visible",layer:t,settings:s}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeLocked=(t,e)=>{if(t||(t=this.fresco.getSelected()),!t)return;const s=Object.assign({},t.settings);t.settings.locked=e,this.history.add({type:"layerSettings",kind:"locked",layer:t,settings:s}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.changeCollapsed=t=>{const e=t.groupSettings.clone();t.groupSettings.collapsed=!t.groupSettings.collapsed,this.history.add({type:"groupSettings",kind:"collapse",layer:t,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.unblock=()=>{var t;this.fresco.unblock(),null===(t=(0,a.Ay)("premium-unlock-message"))||void 0===t||t.remove(),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.rasterize=()=>{let t=this.fresco.getSelectedStack();if(0===t.length)return;let e=new Array;for(let s=0;s<t.length;s++){let i=t[s];if(i instanceof b.A||i instanceof x.A&&!i.canvas){e.push(i);continue}const a=this.fresco.layers.findIndex((t=>t.id===i.id)),n=i.rasterize();this.fresco.layers.splice(a,1,n),this.history.add({type:"rasterize",kind:i.type,newId:n.id,layer:i}),e.push(n)}e.length>0?(this.fresco.selectLayerStack(e),this.notify("layerRasterized")):this.notify("noRasterization"),document.dispatchEvent(new CustomEvent("layerlist-update")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.cutLayer=()=>{let t=this.fresco.getSelectedStack();if(t.length>0){let e=new Array;t.forEach((t=>{e.push(t.clone())})),this.clipboard=e,this.clipboardSize=this.fresco.getStackBounds(e).size(),this.deleteLayer(),this.notify("cut")}},this.copyLayer=()=>{let t=this.fresco.getSelectedStack();if(t.length>0){let e=new Array;t.forEach((t=>{e.push(t.clone())})),this.clipboard=e,this.clipboardSize=this.fresco.getStackBounds(e).size(),this.notify("copy")}},this.pasteLayer=()=>{Array.isArray(this.clipboard)?(this.addCopiedLayer(this.clipboard),this.notify("paste")):document.dispatchEvent(new CustomEvent("viewport-render"))},this.pasteFromSelection=()=>{if(this.fresco.hasSelection()){let t=this.copy();t instanceof HTMLCanvasElement?(this.addImage(p.oM(t),(this.fresco,this.fresco.nextAddedLayerNumber()),"paste"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)("paste")})),this.selectionDeselect()):this.notify("selectionEmpty")}else this.notify("selectionEmpty")},this.cut=()=>{if(!this.fresco.hasSelection())return void this.cutLayer();let t=this.copy();return t?(this.clear("cut"),this.selectionDeselect(),t):void 0},this.copy=()=>{if(!this.fresco)return;if(!this.fresco.hasSelection()&&this.fresco.hasSelected())return void this.copyLayer();const t=this.fresco.getSelected();if(!t||!t.rect||!t.rect.isSet())return void this.notify("selectionEmpty");let e=this.fresco.selection.bounds.intersect(t.rect);if(e){let s=p.Nw(e.width,e.height),i=s.getContext("2d");i.drawImage(t.baked?t.baked:t.canvas,t.rect.x-e.x,t.rect.y-e.y);const a=new v.A(-e.x,-e.y);return i.save(),i.globalCompositeOperation="destination-in",i.drawImage(this.fresco.selection.mask,a.x,a.y),i.restore(),i=void 0,s}this.notify("selectionEmpty")},this.clear=(t="clear")=>{if(!this.fresco||!this.fresco.hasSelection())return!1;if(!this.fresco.isSelectedImageWithCanvas())return this.notify("notAImageLayer"),!1;const e=this.fresco.getSelected();let s=this.fresco.selection.bounds.intersect(e.rect);if(!s)return void this.notify("selectionEmpty");s=s.rebase(e.rect.x,e.rect.y);const i=p.ON(e.canvas,s),a=e.rect.clone();let n=e.canvas.getContext("2d");return n.save(),n.globalCompositeOperation="destination-out",n.drawImage(this.fresco.selection.mask,-e.rect.x,-e.rect.y),n.restore(),n=void 0,e.shrinkWrap(),e.render(),e.rect&&(s=s.rebase(e.rect.x-a.x,e.rect.y-a.y)),this.history.add({type:"bitmapChange",kind:t,layer:e,patchRect:s,rect:a,patch:i}),this.render(),!0},this.primeCut=(t=!0)=>{if(!this.fresco||!this.fresco.hasSelection())return[void 0,void 0];const e=this.fresco.getSelected();if(!e||!e.rect)return this.notify("noLayerSelected"),[void 0,void 0];const s=this.fresco.selection.bounds.intersect(e.rect);if(s){let i=p.Nw(s.width,s.height),a=i.getContext("2d");return a.drawImage(e.canvas,e.rect.x-s.x,e.rect.y-s.y),a.save(),a.globalCompositeOperation="destination-in",a.drawImage(this.fresco.selection.mask,-s.x,-s.y),a.restore(),a=void 0,t&&(a=e.canvas.getContext("2d"),a.save(),a.globalCompositeOperation="destination-out",a.drawImage(this.fresco.selection.mask,-e.rect.x,-e.rect.y),a.restore(),a=void 0,e.render()),[i,s]}return this.notify("selectionEmpty"),[void 0,void 0]},this.selectionSave=()=>{this.fresco&&this.fresco.selection&&((0,a.Ay)("selection-restore").classList.remove("disabled"),this.selection=p.oM(this.fresco.selection.mask),this.notify("selectionSaved"))},this.selectionRestore=()=>{var t,e;this.selection&&(this.history.add({type:"selectionChange",kind:"restore",selection:p.oM(null===(e=null===(t=this.fresco)||void 0===t?void 0:t.selection)||void 0===e?void 0:e.mask)}),this.fresco.addSelection(),this.fresco.selection.drawOnMask(this.selection,0,!1,!1),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionAll=()=>{var t,e;this.fresco&&(this.history.add({type:"selectionChange",kind:"all",selection:p.oM(null===(e=null===(t=this.fresco)||void 0===t?void 0:t.selection)||void 0===e?void 0:e.mask)}),this.fresco.addSelection(),this.fresco.selection.selectAll(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionDeselect=()=>{var t,e;this.fresco&&this.fresco.selection&&(this.history.add({type:"selectionChange",kind:"deselect",selection:p.oM(null===(e=null===(t=this.fresco)||void 0===t?void 0:t.selection)||void 0===e?void 0:e.mask)}),this.fresco.removeSelection(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionInvert=()=>{var t,e;this.fresco&&this.fresco.hasSelection()&&(this.history.add({type:"selectionChange",kind:"invert",selection:p.oM(null===(e=null===(t=this.fresco)||void 0===t?void 0:t.selection)||void 0===e?void 0:e.mask)}),this.fresco.selection.invert(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionPixels=()=>{var t,e;const s=this.fresco.getSelected();if(!s||!s.canvas)return;this.history.add({type:"selectionChange",kind:"pixels",selection:p.oM(null===(e=null===(t=this.fresco)||void 0===t?void 0:t.selection)||void 0===e?void 0:e.mask)}),this.fresco.addSelection(),this.fresco.clearSelection();let i=new f.A;i.addShader("alpha-mask",1);const a=i.apply(s.canvas);this.fresco.selection.drawOnMask(a,0,!1,!1,s.rect.topLeft()),i.cleanUp(),i=void 0,document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.selectionSubject=async()=>{var t,e;const s=this.fresco.getSelected();if(!s||!s.canvas)return;document.dispatchEvent(new CustomEvent("loading",{detail:"start"})),this.history.add({type:"selectionChange",kind:"subject",selection:p.oM(null===(e=null===(t=this.fresco)||void 0===t?void 0:t.selection)||void 0===e?void 0:e.mask)}),this.fresco.addSelection(),this.fresco.clearSelection();const i=await(0,u.P)(s.canvas),a=new f.A;a.addShader("alpha-shift-mask",!0);const n=a.apply(p.k8(i,1080)),o=p.Nw(s.canvas.width,s.canvas.height);o.getContext("2d").drawImage(n,0,0,o.width,o.height),this.fresco.selection.drawOnMask(o,0,!1,!1,s.rect.topLeft()),a.cleanUp(),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.selectionConvert=()=>{if(!this.fresco.isSelectedImageWithCanvas())return;if(!this.fresco.hasSelection())return;const t=this.fresco.getSelected(),e=p.oM(this.fresco.selection.mask);t.addMask(),t.mask.getContext("2d").drawImage(this.fresco.selection.mask,-t.rect.x,-t.rect.y),this.fresco.removeSelection(),this.history.add({type:"convertSelectionToMask",layer:t,selection:e}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.maskAdd=()=>{if(!this.fresco.isSelectedImageWithCanvas())return;const t=this.fresco.getSelected();this.history.add({type:"mask",layer:t,rect:t.rect.clone()}),t.addMask(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.maskApply=()=>{if(!this.fresco.isSelectedImageWithCanvas())return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)("noCutout")}));const t=this.fresco.getSelected(),e=t.mask,s=t.canvas,a=t.rect.clone();t.render(),t.canvas=t.baked,t.removeMask(),t.shrinkWrap(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)("maskApplied")})),this.history.add({type:"applyMask",layer:t,canvas:s,mask:e,rect:a})},this.maskInvert=()=>{if(!this.fresco.isSelectedImageWithCanvas())return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)("noCutout")}));const t=this.fresco.getSelected();t.hasMask()?(t.invertMask(),t.render(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)("invert")})),document.dispatchEvent(new CustomEvent("layer-select")),this.history.add({type:"maskInvert",layer:t})):document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)("noCutout")}))},this.maskDelete=()=>{if(!this.fresco.getSelected())return;const t=this.fresco.getSelected();if(!t.hasMask())return;const e=p.ON(t.mask);t.removeMask(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)("reset")})),this.history.add({type:"mask",layer:t,rect:new m.A(0,0,e.width,e.height),patch:e})},this.maskExtract=()=>{const t=this.fresco.getSelected();if(t&&t.mask){let e=p.oM(t.canvas),s=e.getContext("2d");s.save(),s.globalCompositeOperation="destination-in",s.drawImage(t.mask,0,0),s.restore(),s=void 0;let a=p.TL(t.mask),n=p.Nw(a.width,a.height);s=n.getContext("2d"),s.drawImage(e,-a.x,-a.y),this.addImage(n,"Cutout","extract"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)("layerCreated")}))}else document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)("noCutout")}))},this.maskConvert=()=>{const t=this.fresco.getSelected();if(!t||!t.hasMask())return;const e=t.mask;this.fresco.addSelection(),this.fresco.selection.drawOnMask(t.mask,0,!1,!1,t.rect.topLeft()),t.removeMask(),this.history.add({type:"convertMaskToSelection",layer:t,mask:e}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.resize=(t,e,s,i)=>{this.canvas.height=this.raster.height=r.Ay.isHDPI?2*i:i,this.canvas.width=this.raster.width=r.Ay.isHDPI?2*s:s,this.canvas.style.left=this.raster.style.left=t+"px",this.canvas.style.top=this.raster.style.top=e+"px",this.canvas.style.width=this.raster.style.width=s+"px",this.canvas.style.height=this.raster.style.height=i+"px";let a=this.raster.getBoundingClientRect();this.rasterRect=new m.A(a.x,a.y,a.width,a.height),this.setZoom(this.zoomMode)},this.setZoomStep=(t,e=1)=>{this.fresco&&(1===e&&(this.zoom=Math.round(10*this.zoom)/10),this.zoom+=t?this.zoom>=5?1*e:.1*e:this.zoom>=6?-1*e:-.1*e,this.zoom=p.qE(this.zoom,.1,50),this.zoomMode="free",this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change")))},this.setFluidZoom=t=>{if(!this.fresco)return;const e=r.Ay.isHDPI?.1:.12;this.zoomMode="free",this.zoom+=t?this.zoom*e:-this.zoom*e,this.zoom=p.qE(this.zoom,.1,50),this.zoom>.95&&this.zoom<1.05&&(this.zoom=1),this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change"))},this.resetZoom=()=>{this.setZoom(this.zoomMode)},this.setZoom=t=>{this.fresco&&("fit"===t?(this.zoomMode="fit",this.zoom=p.yu(this.fresco.width,this.fresco.height,this.raster.width-2*this.bounds,this.raster.height-2*this.bounds),this.anchor.x=Math.round(this.fresco.width/2),this.anchor.y=Math.round(this.fresco.height/2)):"fill"===t?(this.zoomMode="fill",this.zoom=p.aE(this.fresco.width,this.fresco.height,this.raster.width,this.raster.height),this.anchor.x=Math.round(this.fresco.width/2),this.anchor.y=Math.round(this.fresco.height/2)):"free"!==t&&(this.zoomMode="free",this.zoom=Number.parseFloat(t),this.zoom=p.qE(this.zoom,.1,50)),this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change")))},this.setAnchor=t=>{this.anchor.x=p.qE(t.x,0,this.fresco.width),this.anchor.y=p.qE(t.y,0,this.fresco.height)},this.resetAnchor=()=>{this.setAnchor(this.getViewPortAnchor())},this.updateViewport=()=>{if(!this.fresco)return;const t=this.fresco.width*this.zoom,e=this.fresco.height*this.zoom,s=.5*(this.canvas.width-t),i=.5*(this.canvas.height-e),a=t<this.canvas.width?t:this.canvas.width,n=e<this.canvas.height?e:this.canvas.height,o=s<0?0:s,h=i<0?0:i;this.viewClip=new m.A(~~o,~~h,~~a,~~n),this.offset=new v.A(this.viewClip.x,this.viewClip.y),this.overshot=new v.A;const l=r.Ay.isHDPI?500:250;if(0===this.offset.x){let e=this.anchor.x*this.zoom-this.canvas.width/2,s=t-this.canvas.width;if(this.offset.x=-p.qE(e,0,s),e<0){let t=p.qE(-1*e,0,l);this.viewClip.width=this.canvas.width-t,this.viewClip.x=t,this.offset.x+=t,this.overshot.x=t}if(e>s){let t=p.qE(e-s,0,l);this.viewClip.width=this.canvas.width-t,this.offset.x-=t,this.overshot.x=-t}}if(0===this.offset.y){let t=this.anchor.y*this.zoom-this.canvas.height/2,e=this.fresco.height*this.zoom-this.canvas.height;if(this.offset.y=-p.qE(t,0,e),t<0){let e=p.qE(-1*t,0,l);this.viewClip.height=this.canvas.height-e,this.viewClip.y=e,this.offset.y+=e,this.overshot.y=e}if(t>e){let s=p.qE(t-e,0,l);this.viewClip.height=this.canvas.height-s,this.offset.y-=s,this.overshot.y=-s}}this.supressRender||document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("viewport-update"))},this.getViewPort=()=>new m.A(this.offset.x>0?0:-1*~~(this.offset.x/this.zoom),this.offset.y>0?0:-1*~~(this.offset.y/this.zoom),Math.ceil(this.viewClip.width/this.zoom),Math.ceil(this.viewClip.height/this.zoom)),this.getViewPortAnchor=()=>{let t=new v.A;return t.x=(this.offset.x>0?-this.offset.x/this.zoom:this.offset.x/this.zoom*-1)+this.canvas.width/this.zoom/2,t.y=(this.offset.y>0?-this.offset.y/this.zoom:this.offset.y/this.zoom*-1)+this.canvas.height/this.zoom/2,t},this.getLayerLocationRect=t=>{if(t.rect)return new m.A(Math.round(t.rect.x*this.zoom+this.offset.x),Math.round(t.rect.y*this.zoom+this.offset.y),Math.round(t.rect.width*this.zoom),Math.round(t.rect.height*this.zoom),t.rect.rotation)},this.getLayerLocationTrim=t=>{if(!t.trim)return;let e=t.getGlobalTrim();return new m.A(Math.round(e.x*this.zoom+this.offset.x),Math.round(e.y*this.zoom+this.offset.y),Math.round(e.width*this.zoom),Math.round(e.height*this.zoom),e.rotation)},this.translateToRect=(t,e,s,i)=>{if(s){const s=t.x-e.x,i=t.y-e.y;let a=Math.sqrt(s*s+i*i)/Math.sqrt(2);e.x=t.x+(s>0?-a:a),e.y=t.y+(i>0?-a:a)}let a=t.x<e.x?t.x:e.x,n=t.y<e.y?t.y:e.y,o=t.x<e.x?e.x:t.x,r=t.y<e.y?e.y:t.y;return t=this.translateRasterToFresco(new v.A(a,n),void 0,!0),(e=this.translateRasterToFresco(new v.A(o,r),void 0,!1)).x=Math.ceil(e.x),e.y=Math.ceil(e.y),i&&(t=this.translateFrescoToRaster(t),e=this.translateFrescoToRaster(e)),new m.A(t.x,t.y,e.x-t.x,e.y-t.y)},this.translateRasterToFresco=(t,e=void 0,s=!0)=>{let i=(t.x-this.offset.x)/this.zoom,a=(t.y-this.offset.y)/this.zoom;return e&&(i-=e.x,a-=e.y),s?new v.A(Math.floor(i),Math.floor(a)):new v.A(i,a)},this.translateFrescoToRaster=(t,e)=>{let s=t.x,i=t.y;return e&&(s+=e.x,i+=e.y),s=Math.round(s*this.zoom)+this.offset.x,i=Math.round(i*this.zoom)+this.offset.y,new v.A(s,i)},this.animationId=0,this.isAnimating=!1,this.playAnimation=(t=24,e=new Array)=>{if(this.isAnimating)return;this.animators=e,0===this.animators.length&&(this.animators=d.A.bakeAnimators(this.fresco));let s=0;for(const i of this.animators)s=Math.max(s,i.getDuration()),i.prepare(new g.A(this.fresco.width,this.fresco.height));if(s>0){this.coating.hide(),this.isAnimating=!0,document.dispatchEvent(new CustomEvent("animation-play",{detail:s}));let e=0,i=performance.now(),a=performance.now();const n=1e3/t,o=Math.ceil((s+50)/1e3)*t,r=()=>{const t=performance.now(),s=t-i;s>n&&(e++,i=t-s%n,this.stepAnimation(i-a)),e>o?this.finnishAnimation():this.animationId=window.requestAnimationFrame(r)};r()}},this.stepAnimation=t=>{if(!this.animators)return;const e=new g.A(this.fresco.width,this.fresco.height);for(const s of this.animators)s.step(t,e);document.dispatchEvent(new CustomEvent("animation-step",{detail:t})),this.render()},this.stopAnimation=()=>{window.cancelAnimationFrame(this.animationId),this.finnishAnimation()},this.finnishAnimation=()=>{if(this.isAnimating){if(this.animators)for(const t of this.animators)t.finish();this.isAnimating=!1,this.coating.show(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("animation-stop"))}},this.render=()=>{if(!this.supressRender)if(this.fresco){if(this.ctx&&(this.ctx=this.canvas.getContext("2d")),this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.ctx.rect(this.viewClip.x,this.viewClip.y,this.viewClip.width,this.viewClip.height),this.ctx.clip(),this.ctx.fillStyle=this.fresco.color?this.fresco.color:this.ptn,this.ctx.fillRect(this.viewClip.x,this.viewClip.y,this.viewClip.width,this.viewClip.height),this.ctx.translate(this.offset.x,this.offset.y),this.ctx.scale(this.zoom,this.zoom),this.isAnimating)for(var t=0;t<this.fresco.layers.length;t++){const e=this.fresco.layers[t];e.settings.visible&&(e.transform?this.renderTransformedLayer(this.ctx,e):this.renderLayer(this.ctx,e,this.zoom<1))}else for(let t=0;t<this.fresco.layers.length;t++){const e=this.fresco.layers[t];e.settings.visible&&(this.fresco.hasScratch()&&this.fresco.scratch.id===e.id?("over"===this.fresco.scratch.renderMode&&this.renderLayer(this.ctx,e,this.zoom<1),this.renderLayer(this.ctx,this.fresco.scratch,this.zoom<1)):this.renderLayer(this.ctx,e,this.zoom<1))}if(this.ctx.restore(),this.fresco.block){this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over";let t=this.canvas.width<this.canvas.height?this.canvas.height:this.canvas.width;this.ctx.drawImage(this.premiumGrid,0,this.canvas.height-t,t,t)}}else this.fresco||(this.canvas.width=1,this.canvas.height=1)},this.renderOutputFrame=(t,e,s=!1)=>{t.save(),t.clearRect(0,0,t.canvas.width,t.canvas.height),s||(t.fillStyle=this.fresco.color?this.fresco.color:"#000000",t.fillRect(0,0,t.canvas.width,t.canvas.height)),t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high";for(var i=0;i<this.fresco.layers.length;i++){const s=this.fresco.layers[i];(e||s.settings.visible)&&(s.transform?this.renderTransformedLayer(t,s):this.renderLayer(t,s,!1))}t.restore()},this.renderTransformedLayer=(t,e)=>{var s;if((e.canvas||e.baked)&&e.rect){t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high",t.globalAlpha=e.settings.opacity*(null!==(s=e.transform.opacity)&&void 0!==s?s:1),t.globalCompositeOperation=""===e.settings.blendmode?"source-over":e.settings.blendmode;try{t.save();const s=e.bect?e.bect:e.rect,i=e.transient?e.transient:e.baked?e.baked:e.canvas;let a=s.x+.5*s.width+e.transform.offset.x,n=s.y+.5*s.height+e.transform.offset.y;t.translate(a,n),a=-.5*s.width,n=-.5*s.height,e.rect.rotation&&t.rotate(e.rect.rotation*Math.PI/180),e.transform.rotation&&(t.translate(s.width*(e.transform.rAnchor.x-.5),s.height*(e.transform.rAnchor.y-.5)),t.rotate(e.transform.rotation*Math.PI/180),a=-s.width*e.transform.rAnchor.x,n=-s.height*e.transform.rAnchor.y),!e.transform.scale||1===e.transform.scale.x&&1===e.transform.scale.y||(t.translate(s.width*(e.transform.sAnchor.x-.5),s.height*(e.transform.sAnchor.y-.5)),t.scale(e.transform.scale.x,e.transform.scale.y),a=-s.width*e.transform.sAnchor.x,n=-s.height*e.transform.sAnchor.y),t.drawImage(i,a,n,s.width,s.height),t.restore()}catch(i){console.log(i)}}},this.renderLayer=(t,e,s,i)=>{if((e.canvas||e.baked)&&e.rect){t.imageSmoothingQuality="high",t.globalAlpha=e.settings.opacity,t.imageSmoothingEnabled=s||0!==e.rect.rotation,t.globalCompositeOperation=""===e.settings.blendmode?"source-over":e.settings.blendmode;try{const s=e.bect?e.bect:e.rect,a=e.transient?e.transient:e.baked?e.baked:e.canvas;if(e.rect.rotation){let n=s.x+.5*s.width,o=s.y+.5*s.height;i&&(n-=i.x,o-=i.y),t.save(),t.translate(n,o),t.rotate(e.rect.rotation*Math.PI/180),t.drawImage(a,-.5*s.width,-.5*s.height,s.width,s.height),t.restore()}else{let e=s.x,n=s.y;i&&(e-=i.x,n-=i.y),t.drawImage(a,e,n,s.width,s.height)}}catch(a){console.log(a)}}},this.renderPreview=t=>{this.ctx&&t&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(t,this.viewClip.x,this.viewClip.y,this.viewClip.width,this.viewClip.height))},this.getThumbnail=()=>{if(this.canvas)return this.getOutputCanvas(this.fresco,p.aE(this.fresco.width,this.fresco.height,200,180))},this.getSingleLayerOutputCanvas=()=>{const t=this.fresco.getSelected();if(!t||!t.canvas)return;let e=p.Nw(this.fresco.width,this.fresco.height),s=e.getContext("2d");return this.renderLayer(s,t,!1),s=null,e},this.getOutputCanvas=(t=this.fresco,e=1,s,i)=>{if(e>1&&(e=1),!i){i=p.VI(Math.round(t.width*e),Math.round(t.height*e)).getContext("2d")}i.save(),i.scale(e,e),t.color||s?(i.fillStyle=t.color?t.color:s,i.fillRect(0,0,i.canvas.width,i.canvas.height)):i.clearRect(0,0,i.canvas.width,i.canvas.height);for(var a=0;a<t.layers.length;a++){const s=t.layers[a];s.settings.visible&&this.renderLayer(i,s,e<1)}return i.restore(),i.canvas},this.layerDragMove=()=>{this.layerDrag.fresco!==this.fresco.id&&this.coating.drawDropPreviewRect(this.layerDrag.position,this.layerDrag.layer)},this.layerDragDrop=()=>{const t=this.layerDrag;if(t.fresco===this.fresco.id)return;const e=this.layerDrag.layer.clone(),s=new v.A(t.position.x-this.rasterRect.x,t.position.y-this.rasterRect.y),i=this.translateRasterToFresco(s);e.rect.x=i.x-t.layer.rect.width/2,e.rect.y=i.y-t.layer.rect.height/2,e.settings.link="",this.fresco.addLayer(e),this.coating.clear(),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layerlist-update")),this.history.add({type:"addLayer",kind:"duplicate"+e.type,layer:e})},this.close=t=>{this.stopAnimation(),void 0===t&&this.fresco&&(t=this.fresco.id);const e=this.tabs.findIndex((e=>e.fresco.id===t)),s=this.fresco&&this.fresco.id===t;if(!(e<0)){if(this.tabs.splice(e,1).forEach((t=>t.fresco.cleanUp())),1===this.tabs.length&&r.Ay.api&&(this.showTabs=!1,document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("resize"))),0===this.tabs.length)return this.history=null,this.fresco=null,this.showTabs=!1,this.coating.clear(),this.render(),document.dispatchEvent(new CustomEvent("tool-apply")),document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("history-update")),document.dispatchEvent(new CustomEvent("viewport-update")),void document.dispatchEvent(new CustomEvent("layerlist-update"));if(s){const t=Math.min(e,this.tabs.length-1);this.select(this.tabs[t].fresco.id)}else document.dispatchEvent(new CustomEvent("fresco-select"))}},this.cleanUp=()=>{document.removeEventListener("viewport-render",this.render,!1),document.removeEventListener("sync-document",this.doSync,!1),document.removeEventListener("layer-drag-move",this.layerDragMove,!1),document.removeEventListener("layer-drag-drop",this.layerDragDrop,!1),document.removeEventListener("render-enabled",this.doRender,!1),document.removeEventListener("reset-viewport",this.resetZoom,!1),document.removeEventListener("unblock-viewport",this.unblock,!1),document.removeEventListener("touchstart",this.touch,!1)},this.workspace=t,this.tabs=[],document.addEventListener("touchstart",this.touch,!1),r.Ay.isHDPI=matchMedia("(-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2), (min-resolution: 192dpi)").matches&&!r.Ay.performanceMode&&document.body.clientWidth<650,r.Ay.isSafari=navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"),r.Ay.isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent),r.Ay.isIOS&&document.documentElement.classList.add("ios"),this.canvas=this.workspace.querySelector(".canvas"),this.canvas||(this.canvas=(0,a.T)("canvas",{className:"canvas"}),t.appendChild(this.canvas)),this.canvas.width=this.canvas.height=1,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.createBGPattern(),this.raster=this.workspace.querySelector(".raster"),this.raster||(this.raster=(0,a.T)("canvas",{className:"raster"}),t.appendChild(this.raster)),this.anchor=new v.A(0,0),this.offset=new v.A(0,0),this.coating=new c.A(this),document.addEventListener("viewport-render",this.render,!1),document.addEventListener("sync-document",this.doSync,!1),document.addEventListener("layer-drag-move",this.layerDragMove,!1),document.addEventListener("layer-drag-drop",this.layerDragDrop,!1),document.addEventListener("render-enabled",this.doRender,!1),document.addEventListener("reset-viewport",this.resetZoom,!1),document.addEventListener("unblock-viewport",this.unblock,!1),"premium"!==(null===C.N||void 0===C.N?void 0:C.N.subscriptionAccess)&&(this.premiumGrid=(0,a.T)("img",{src:"/img/misc/premium-grid.svg"}))}async syncDocument(t){var e,s,i;if(!(!t||this.syncQueue>0||this.syncDisabled||r.Ay.api)&&(!t.templateMeta||this.history.hasChanges()))try{this.syncQueue++;let a,o=new Date;t.id===(null===(e=this.fresco)||void 0===e?void 0:e.id)&&(a=await p.PG(this.getThumbnail()));const r=t.layers.map((t=>t.id)),h=await p.PG(null===(s=null==t?void 0:t.selection)||void 0===s?void 0:s.mask),l=await(0,n.P2)(),[c,d,u,g]=l.transaction("readwrite","document-meta","document-thumbnail","document-selection","layer-meta");let m=p.bD(L.l,await c.get(t.id));m||(m=new L.l(t.id,t.name,t.width,t.height,t.color,t.templateMeta,t.animation)),m.lastModified=o,m.width=t.width,m.color=t.color,m.height=t.height,m.selected=null===(i=null==t?void 0:t.getSelected())||void 0===i?void 0:i.id,m.templateMeta=t.templateMeta,m.animation=t.animation,m.order=r;const[v]=await Promise.all([g.index("document").getAllKeys(t.id),a?d.put(a,t.id):void 0,h?u.put(h,t.id):u.delete(t.id),c.put(m)]),y=v.filter((e=>!t.layers.some((t=>t.id===e)))),f=t.layers.filter((t=>!v.includes(t.id)));await Promise.all(f.map((e=>L.z.sync(e,t)))),await Promise.all(y.map((async t=>L.z.delete(t))));const w=t.layers.filter((t=>t.syncRequested&&(!t.syncLatest||t.syncRequested>t.syncLatest)));await Promise.all(w.map((e=>L.z.sync(e,t)))),document.cookie="has-history=true; path=/; SameSite=Strict; expires=Fri, 31 Dec 9999 23:59:59 GMT"}finally{this.syncQueue--}}createNew(t,e,s,i){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),this.addTab(new l.A(p.Os(),t,e,s,i),"create"),this.addEmpty(),this.setZoom("fit"),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}))}async openFromHistory(t,e){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),t.templateMeta&&t.templateMeta.premium&&"premium"===(null===C.N||void 0===C.N?void 0:C.N.subscriptionAccess)&&(t.templateMeta.locked=!1);const s=new l.A(t.id,t.name,t.width,t.height,t.transparent?void 0:t.color,t.animation,t.templateMeta);this.addTab(s,"document"),this.setZoom("fit"),this.renderPreview(e),this.supressRender=!0,document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));try{await t.restore(s),s.layers.length>0&&this.selectLayer(s.layers[0])}catch(i){console.log(i)}document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),this.supressRender=!1,document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("layerlist-update")),document.dispatchEvent(new CustomEvent("selection-update")),document.dispatchEvent(new CustomEvent("resize")),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}))}addGroup(){let t="Group "+this.fresco.nextAddedLayerNumber();const e=new P.A;this.fresco.numSelected()>1&&(e.numberOfMembers=this.fresco.numSelected());let s=new M.A(p.Os(),t,e);return this.fresco.addLayer(s),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layerlist-update")),this.history.add({type:"addLayer",kind:"group",layer:s}),s}addEmpty(){let t="Layer "+this.fresco.nextAddedLayerNumber(),e=new b.A(p.Os(),t);return this.fresco.addLayer(e),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layerlist-update")),this.history.add({type:"addLayer",kind:"addemptyimage",layer:e}),e}addImage(t,e,s){if(document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),this.fresco||this.addTab(new l.A(p.Os(),e,t.width,t.height,void 0,void 0,void 0,s),"image"),"frame"===s&&this.fresco.getSelected()instanceof x.A)return void this.setFrameContent(t);const a=0===this.fresco.layers.length;let n=this.fresco.addLayer(new b.A(p.Os(),a?(0,i.A)("background"):e,t,new m.A(0,0,t.width,t.height),a));if(a)this.setZoom("fit"),this.syncDocument(this.fresco);else{let t=this.getViewPort().center();n.rect.x=Math.round(t.x-n.rect.width/2),n.rect.y=Math.round(t.y-n.rect.height/2),this.history.add({type:"addLayer",kind:s+"image",layer:n})}return document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layerlist-update")),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),r.Ay.tool&&(document.dispatchEvent(new CustomEvent("select-tool",{detail:r.Ay.tool})),r.Ay.tool=void 0),n}async addSVGShape(t,e,s){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}));let i=new E.A;i.variant="svg",i.content=t;let a=new A.A(p.Os(),e,void 0,i);if(await a.prepare(),this.fresco||this.addTab(new l.A(p.Os(),a.settings.name,a.rect.width,a.rect.height,void 0,void 0,void 0,s),"shape"),this.fresco.addLayer(a),1===this.fresco.layers.length)this.setZoom("fit"),this.syncDocument(this.fresco);else{let t=this.getViewPort().center();a.rect.x=Math.round(t.x-a.rect.width/2),a.rect.y=Math.round(t.y-a.rect.height/2),this.history.add({type:"addLayer",kind:s+"shape",layer:a})}return document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layerlist-update")),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),r.Ay.tool&&(document.dispatchEvent(new CustomEvent("select-tool",{detail:r.Ay.tool})),r.Ay.tool=void 0),a}async addShape(t,e,s="add"){t||(t=new m.A(Math.round(this.fresco.width/4),Math.round(this.fresco.height/4),Math.round(this.fresco.width/2),Math.round(this.fresco.height/2))),e||((e=new E.A).variant="rectangle",e.fillType="color",e.fillValue="#444444");let a=(0,i.A)("shape")+" "+this.fresco.nextAddedLayerNumber(),n=new A.A(p.Os(),a,t,e);return await n.prepare(),this.fresco.addLayer(n),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"addLayer",kind:s+"shape",layer:n}),n}addElement(t,e,s,i,a){let n;if((0,o.A)("add-element",s),a!==k.A.SCALE_METHOD_NONE)if((this.fresco.height>this.fresco.width&&t.height<t.width||this.fresco.width>this.fresco.height&&t.width<t.height)&&(t=p.SE(t,90)),n=new k.A(p.Os(),e,t,s,"overlay",i,a),a==k.A.SCALE_METHOD_FILL){let e=m.A.fillFit(t.width,t.height,this.fresco.width,this.fresco.height);n.calculate(new v.A(e.x,e.y),new v.A(e.right(),e.bottom()),0)}else n.calculate(new v.A(0,0),new v.A(this.fresco.width,this.fresco.height),0);else{let o=m.A.bestFit(t.width,t.height,this.fresco.width,this.fresco.height);(t.height>this.fresco.height||t.width>this.fresco.width)&&(t=p.tm(t,o.width,o.height)),n=new k.A(p.Os(),e,t,s,"sticker",i,a),n.rect.x=o.x,n.rect.y=o.y}return this.fresco.addLayer(n),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layerlist-update")),this.history.add({type:"addLayer",kind:"addelement",layer:n}),n}async addText(t,e,s,i="add"){if(!t||!e||!s){t="Lorem ipsum ..",(s=new S.A("Verdana",40)).fillType="color",s.fillValue="#ffffff";let i=this.getViewPort();e=new m.A(Math.round(i.x+(i.width-Math.round(i.width/1.2))/2),Math.round(i.y+i.height/2.5),Math.round(i.width/1.2),40)}const a=new w.A(p.Os(),t,e,s);return await a.prepare(),this.fresco.addLayer(a),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"addLayer",kind:i+"text",layer:a}),a}addFrame(t){t||(t=new m.A(Math.round(this.fresco.width/4),Math.round(this.fresco.height/4),Math.round(this.fresco.width/2),Math.round(this.fresco.height/2)));let e=(0,i.A)("frame")+" "+this.fresco.nextAddedLayerNumber();const s=new x.A(p.Os(),e,t);return this.fresco.addLayer(s),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"addLayer",kind:"addframe",layer:s}),s}crop(t){const e=new g.A(this.fresco.width,this.fresco.height),s=new v.A(-t.x,-t.y);this.fresco.crop(t),this.updateViewport(),this.history.add({type:"crop",offset:s,size:e})}flip(t){this.fresco.flip(t),this.render(),this.history.add({type:"flip",vertical:t})}rotate(t){this.fresco.rotate(t),this.updateViewport(),this.history.add({type:"rotate",counterClock:t})}rotateSelected(t){const e=this.fresco.getSelected();e?e.settings.locked?this.notify("layer locked"):(this.history.add({type:"rotateLayer",layer:e,counterClock:t}),e.rotate(t),document.dispatchEvent(new CustomEvent("viewport-render"))):this.notify("no layer selected")}flipSelected(t){if(!this.isSelectedLayerShaderble())return void this.notify("onlyImageLayer");const e=this.fresco.getSelected();e.settings.locked?this.notify("layerLocked"):(this.history.add({type:"flipLayer",layer:e,vertical:t}),e.flip(t),e.render(),this.render())}straighten(t){if(!this.fresco.lockedBackground())return;const e=this.fresco.layers[0].rect.rotatedSize(t);this.fresco.straighten(t,e.width,e.height),this.updateViewport()}addTab(t,e,s=!0,i=!1,a=!1){i||document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}));const n=new D(t,e,a);this.tabs.push(n),s&&(this.fresco=n.fresco,this.history=n.history,this.setZoom("fit"),n.zoom=this.zoom,n.zoomMode=this.zoomMode,n.anchor=this.anchor,document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("layerlist-update")),this.history.dispatchHistoryStatus()),this.tabs.length>this.tabLimit&&this.close(this.tabs[0].fresco.id),this.tabs.length>1&&(this.showTabs=!0),document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("resize"))}select(t){this.stopAnimation();const e=this.tabs.find((e=>e.fresco.id===t));if(!e)return;const s=this.tabs.find((t=>{var e;return t.fresco.id===(null===(e=this.fresco)||void 0===e?void 0:e.id)}));s&&(s.zoom=this.zoom,s.zoomMode=this.zoomMode,s.anchor=this.anchor.clone()),this.fresco=e.fresco,this.history=e.history,this.zoom=e.zoom,this.zoomMode=e.zoomMode,this.anchor=e.anchor,this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change")),document.dispatchEvent(new CustomEvent("layerlist-update")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("resize")),this.history.dispatchHistoryStatus()}duplicate(t){const e=this.tabs.find((e=>e.fresco.id===t));if(!e)return;const s=e.fresco.clone();this.addTab(s,"image"),this.syncDocument(s)}}},54127:(t,e,s)=>{s.d(e,{A:()=>u});var i=s(54738),a=s(22866),n=s(7324),o=s(40963),r=s(15818),h=s(41915),l=s(39989),c=s(89209),d=s(52038);class u extends a.A{constructor(t=i.Os(),e,s,p){super(a.A.TYPE_TEXT),this.id=t,this.prepare=async(t=!1)=>{this.fill&&!t||(this.fill=await n.A.fromString(this.textSettings.fillType,this.textSettings.fillValue),document.dispatchEvent(new CustomEvent("layer-select"))),this.setText()},this.setText=(t=this.text)=>{this.text=t,this.settings.name=t.substring(0,25)+"..",this.textSettings.uppercase?this.words=this.text.replace(/[\n]/g," §§§ ").toUpperCase().split(" "):this.words=this.text.replace(/[\n]/g," §§§ ").split(" "),this.render()},this.setTextSize=t=>{this.textSettings.setSize(t),this.render()},this.setLineSpace=t=>{this.textSettings.lineSpace=t,this.render()},this.setLetterSpace=t=>{this.textSettings.letterSpace=t,this.render()},this.setTextFill=(t,e=!1)=>{this.fill=t,e||(this.textSettings.fillType=t.getType(),this.textSettings.fillValue=t.getStringValue()),this.render()},this.setTextFont=(t,e=!1)=>{this.textSettings.setFont(t),this.render(e)},this.setTextUpperCase=t=>{this.textSettings.uppercase=t,this.setText(this.text)},this.setTextItalic=t=>{this.textSettings.italic=t,this.setText(this.text)},this.setTextBold=t=>{this.textSettings.bold=t,this.setText(this.text)},this.setTextUnderline=t=>{this.textSettings.underline=t,this.setText(this.text)},this.setTextAlign=t=>{this.textSettings.align=t,this.render()},this.setCurve=(t,e,s,i,a)=>{this.textSettings.curve=t,this.textSettings.curveType=e,this.textSettings.curveAmount=s,this.textSettings.curveSpread=i,this.textSettings.curveFlip=a,this.render()},this.setWarp=(t,e,s,i,a,n,o)=>{this.textSettings.warp=t,this.textSettings.warpType=e,this.textSettings.warpMode=s,this.textSettings.warpEdgeSize=i,this.textSettings.warpCenterSize=a,this.textSettings.warpHorizontalOffset=n,this.textSettings.warpVerticalOffset=o,this.render()},this.setBackground=(t,e,s,i,a)=>{this.textSettings.background=t,this.textSettings.backgroundType=e,this.textSettings.backgroundColor=s,this.textSettings.backgroundPunch=i,this.textSettings.backgroundOffset=a,this.render()},this.setOutline=(t,e,s,i,a,n)=>{this.textSettings.outline=t,this.textSettings.outlineSize=e,this.textSettings.outlineColor=s,this.textSettings.outlinePunch=i,this.textSettings.outlineDistance=a,this.textSettings.outlineDirection=n,this.render()},this.setShadow=(t,e,s,i,a,n)=>{this.textSettings.shadow=t,this.textSettings.shadowBlur=e,this.textSettings.shadowAlpha=s,this.textSettings.shadowColor=i,this.textSettings.shadowDistance=a,this.textSettings.shadowDirection=n,this.render()},this.setTextSettings=t=>{this.textSettings=t,this.render()},this.setCanvasStyle=()=>{var t;this.ctx.textBaseline="top",this.ctx.font=this.textSettings.getCssFont(),this.ctx.strokeStyle=this.textSettings.outlineColor,this.ctx.lineWidth=Math.round(this.textSettings.outlineSize*this.textSettings.padding),this.ctx.lineJoin="miter",this.ctx.miterLimit=2,null===(t=this.fill)||void 0===t||t.addToCanvasFillStyle(this.ctx)},this.isPunchOut=!1,this.isWordBackground=!1,this.render=(t=!1)=>{this.isPunchOut=void 0===this.fill||this.textSettings.background&&this.textSettings.backgroundPunch||this.textSettings.outline&&this.textSettings.outlinePunch,this.isWordBackground=this.textSettings.background&&this.textSettings.backgroundType===c.A.BACKGROUND_WORD;let e=this.textSettings.padding;this.canvas||(this.canvas=i.Nw(50,50)),this.ctx||(this.ctx=this.canvas.getContext("2d")),this.setCanvasStyle();const s=new h.A;if(this.textSettings.outline&&this.textSettings.outlineDistance>0){const t=(this.textSettings.outlineDirection-90)*Math.PI/180;s.x=Math.cos(t)*this.textSettings.outlineDistance*e,s.y=Math.sin(t)*this.textSettings.outlineDistance*e}const a=this.textSettings.getLineSpacing();let n=this.textSettings.height+e+a,l=this.textSettings.background?Math.round(this.textSettings.backgroundOffset*e):0;this.textSettings.background&&this.textSettings.backgroundType!==c.A.BACKGROUND_FULL&&(n+=2*e);let d=this.splitTextIntoLines(n);this.setCanvasSize(d.length,a),this.setCanvasStyle();let u=!1;if(this.textSettings.curve&&"arc"===this.textSettings.curveType){if(u=!0,0!==this.textSettings.curveAmount){const t=this.textSettings.getLetterSpacing();let[e,s]=this.calculateArcRadius(),i=(e-this.textSettings.height/2)*Math.PI*2;u=(this.ctx.measureText(" ").width+t)/i*Math.PI*2<5e-4}this.textSettings.curveAmount<=0&&!u&&(d=d.reverse())}for(let i=0;i<d.length;i++){if(""===d[i])continue;const t=this.lineWidth(d[i]);this.textSettings.curve&&!u?this.drawCurveLine(d[i],e+i*n,t,l,s):this.drawLine(d[i],e+i*n,t,l,s,u)}if(this.textSettings.warp){this.transient=i.oM(this.canvas),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high";let t=this.textSettings.warpMode,s="angular"===this.textSettings.warpType,a=this.textSettings.background||this.textSettings.outline?0:e,n=this.transient.width,o=this.transient.height-2*a,r=o+o*this.textSettings.warpEdgeSize,h=o+o*this.textSettings.warpCenterSize,l=n*(.5+.5*this.textSettings.warpHorizontalOffset),c=n*(1-(.5+.5*this.textSettings.warpHorizontalOffset)),d=180/(2*l),u=180/(2*c),p=0,g=o*this.textSettings.warpVerticalOffset;if("upper"===t)g<0?(this.rect.height=Math.max(Math.abs(g)+r,h),p-=g):this.rect.height=Math.max(g+h,r);else if("lower"===t)g*=-1,p=Math.max(r,h-g)-o,this.rect.height=g<=0?Math.max(Math.abs(g)+h,r):Math.max(g+r,h);else if("middle"===t){g*=.75,p=.5*(Math.max(r,h)-o);let t=.5*(r-h),e=Math.max(h,r);if(g<0){let t=.5*(r-h),e=Math.max(h,r);t+h+Math.abs(g)>e?(this.rect.height=t+h+Math.abs(g),p-=t+g,t<0&&(p+=t)):(this.rect.height=e,h>r&&(p-=g))}else t+h+g>e?(this.rect.height=t+h+g,t<0&&(p+=t)):(this.rect.height=e,h>r&&(p-=g))}for(this.rect.height+=2*a,this.canvas.width=this.rect.width,this.canvas.height=this.rect.height;n--;){let e=0;e=n>l?s?1-(n-l)/c:Math.sin((c-(n-l))*u*Math.PI/180):s?1-(l-n)/l:Math.sin(n*d*Math.PI/180);let i=(1-e)*r+h*e,m=e*g,v="upper"===t?0:"lower"===t?o-i:.5*(o-i);this.ctx.drawImage(this.transient,n,a,1,o,n,a+m+v+p,1,i)}this.transient=void 0}if(this.textSettings.shadow&&!t){this.baked||(this.baked=i.Nw(100,100));let t=this.baked.getContext("2d");if(this.bect=new o.A(this.rect.x-4*e,this.rect.y-4*e,this.rect.width+8*e,this.rect.height+8*e,this.rect.rotation),this.baked.width=this.bect.width,this.baked.height=this.bect.height,this.textSettings.shadow){t.save();var p=(this.textSettings.shadowDirection-90)*Math.PI/180,g=Math.cos(p)*this.textSettings.shadowDistance,m=Math.sin(p)*this.textSettings.shadowDistance;t.shadowBlur=this.textSettings.shadowBlur*this.textSettings.padding*2,t.shadowOffsetX=g*this.textSettings.padding*2,t.shadowOffsetY=m*this.textSettings.padding*2,t.shadowColor=r.A.fromHEX(this.textSettings.shadowColor,Math.round(255*this.textSettings.shadowAlpha)).toRGBA(),t.drawImage(this.canvas,4*e,4*e),t.restore()}}else this.baked=void 0,this.bect=void 0},this.scaleBect=t=>{if(this.bect){const e=4*this.textSettings.padding*t;this.bect=new o.A(this.rect.x-e,this.rect.y-e,this.rect.width+2*e,this.rect.height+2*e,this.rect.rotation),this.bect.width<1&&(this.bect.width=1),this.bect.height<1&&(this.bect.height=1)}},this.setCanvasSize=(t,e)=>{if(this.textSettings.background&&this.textSettings.backgroundType!==c.A.BACKGROUND_FULL?this.rect.height=(this.textSettings.height+3*this.textSettings.padding)*t+e*(t-1)-this.textSettings.padding:this.rect.height=(this.textSettings.height+this.textSettings.padding)*t+e*(t-1)+this.textSettings.padding,this.textSettings.curve)switch(this.textSettings.curveType){case"arc":let t=this.calculateArcHeight();this.rect.height+=t;break;case"circle":this.rect.height=this.rect.width;break;case"half":this.rect.height=Math.round(this.rect.width/2)}this.canvas.width=this.rect.width,this.canvas.height=this.rect.height,this.textSettings.background&&this.textSettings.backgroundType===c.A.BACKGROUND_FULL&&(this.ctx.fillStyle=this.textSettings.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height))},this.splitTextIntoLines=t=>{let e="",s=new Array,i=this.textSettings.curve?this.curveMaxWidth(0,t):this.rect.width;for(var a=0;a<this.words.length;a++){let n=""!==e?e+" "+this.words[a]:this.words[a];if("§§§"===this.words[a]||this.lineWidth(n)>i&&n!==this.words[a]){if(s.push(e),e="§§§"===this.words[a]?"":this.words[a],this.textSettings.curve&&(i=this.curveMaxWidth(s.length,t),i<0))return s}else e=n}return s.push(e),s},this.lineWidth=t=>{let e=0,s=this.textSettings.getLineSpacing(),i=this.textSettings.getLetterSpacing();if(this.isWordBackground){let a=t.split(" ").filter((t=>t));for(let t=0;t<a.length;t++)e+=this.measureTextWidth(a[t],i,!0)+2*this.textSettings.padding,e+=this.textSettings.padding+s;this.textSettings.curve&&"circle"===this.textSettings.curveType||(e-=this.textSettings.padding+s)}else this.textSettings.curve&&"circle"===this.textSettings.curveType?(e=this.measureTextWidth(t,i,!1),e+=this.measureTextWidth(" ",i,!1)):(e=this.measureTextWidth(t,i,!0),e+=2*this.textSettings.padding);return e},this.curveMaxWidth=(t,e)=>{if("arc"===this.textSettings.curveType){if(0===this.textSettings.curveAmount)return this.rect.width;let[t,s]=this.calculateArcRadius();return this.textSettings.curveAmount<0&&(s+=-e/4),s}if("circle"===this.textSettings.curveType){let s=this.rect.width/2-this.textSettings.padding-t*e;return s<e?-1:s*Math.PI*2}{let s=this.rect.width/2-t*e-(this.textSettings.background?this.textSettings.padding:0);return s<e?-1:s*Math.PI}},this.calculateArcHeight=()=>Math.round(this.rect.width/5*Math.abs(this.textSettings.curveAmount)),this.calculateArcRadius=()=>{let t=this.calculateArcHeight(),e=new h.A(0,t),s=new h.A(this.rect.width/2,0),i=new h.A(this.rect.width,t),a=(s.y-e.y)/(s.x-e.x),n=(i.y-s.y)/(i.x-s.x),o=-1*((a*n*(e.y-i.y)+n*(e.x+s.x)-a*(s.x+i.x))/(2*(n-a))-(e.x+s.x)/2)/a+(e.y+s.y)/2;return[o,Math.atan2(this.rect.width/2,o-t)*o*2]},this.drawHalfLine=(t,e,s,i,a)=>{var n;const o=this.textSettings.curveFlip,r=this.textSettings.curveSpread,h=this.textSettings.getLineSpacing(),l=this.textSettings.getLetterSpacing();let d=!1,u=this.rect.width/2-e,p=u*Math.PI*2;if(this.textSettings.background)if(this.textSettings.backgroundType===c.A.BACKGROUND_LINE){let t=u-this.textSettings.height/2;t>0&&(this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding,this.ctx.beginPath(),this.ctx.ellipse(this.rect.width/2,o?0:this.rect.width/2,t,t,0,Math.PI,0,o),this.ctx.stroke(),this.ctx.restore())}else if(this.textSettings.backgroundType===c.A.BACKGROUND_WORD){let e=r?-p/4:-s/2,a=(p/2-s)/t.replace(/\s/g,"").length;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding;let n=t.split(" ").filter((t=>t));for(var g=0;g<n.length;g++){let t=this.measureTextWidth(n[g],l,!0);r&&(t+=a*n[g].length);let s=u-this.textSettings.height/2;if(s<this.textSettings.height)continue;let c=(t+2*this.textSettings.padding)/p*360*(Math.PI/180),d=e/p*360*(Math.PI/180),m=o?90:270,v=m*(Math.PI/180)+(o?-d:d),y=m*(Math.PI/180)+(o?-(c+d):c+d);if(this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,o?0:this.rect.width/2,s,v,y,o),this.ctx.stroke(),this.textSettings.underline){const a=Math.ceil(.06*this.textSettings.height),n=Math.round(this.textSettings.padding+l);this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=a,d=(e+n)/p*360*(Math.PI/180),c=(t-2*l)/p*360*(Math.PI/180),v=m*(Math.PI/180)+(o?-d:d),y=m*(Math.PI/180)+(o?-(c+d):c+d);const r=Math.round(.5*(this.textSettings.baseline+a)+i);this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,o?0:this.rect.width/2,s+(o?r:-r),v,y,o),this.ctx.stroke(),this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding}e+=Math.round(t+3*this.textSettings.padding+h)}this.ctx.restore(),d=!0}let m=0;if(r){m=(p/2-s)/(d?t.replace(/\s/g,"").length:t.length+1)/2,s=d?p/2:p/2-2*m}if(this.textSettings.underline&&!this.isWordBackground){let t=u-this.textSettings.height/2;if(t<this.textSettings.height){const e=Math.ceil(.06*this.textSettings.height);let a=(s-2*Math.round(this.textSettings.padding+l))/(u*Math.PI*2)*360*(Math.PI/180/2),n=o?90:270,r=n*(Math.PI/180)-a,h=n*(Math.PI/180)+a;const c=Math.round(.5*(this.textSettings.baseline+e)+i);this.ctx.save(),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=e,this.ctx.beginPath(),o?this.ctx.arc(this.rect.width/2,0,t+c,r,h):this.ctx.arc(this.rect.width/2,this.rect.width/2,t-c,r,h),this.ctx.stroke(),this.ctx.restore()}}if(this.ctx.save(),t.length>0){const e=.5*this.rect.width,r=o?0:.5*this.rect.width;null===(n=this.fill)||void 0===n||n.addToCanvasFillStyle(this.ctx,-e,-r),this.ctx.translate(e,r);let c=o?u-this.textSettings.height-this.textSettings.ascent:-u-this.textSettings.ascent;this.ctx.textAlign="center";let g=o?-1:1,y=d?2*l+2*this.textSettings.padding:2*this.textSettings.padding+2*l;this.ctx.rotate((s-y)/p*Math.PI*-g),this.ctx.textAlign="center";for(var v=0;v<t.length;v++){if(d&&" "===t[v]){if(v>0&&" "===t[v-1])continue;this.ctx.rotate((3*this.textSettings.padding+h+l)/p*(2*Math.PI)*g);continue}let e=this.ctx.measureText(t[v]).width/2;this.ctx.rotate((e+m)/p*Math.PI*2*g),this.drawChar(t[v],0,c+i,a),this.ctx.rotate((e+l+m)/p*Math.PI*2*g)}}this.ctx.restore()},this.drawCircleLine=(t,e,s,i,a)=>{var n;const o=this.textSettings.curveFlip,r=this.textSettings.curveSpread,h=this.textSettings.getLineSpacing(),l=this.textSettings.getLetterSpacing();let d=!1,u=this.rect.width/2-e,p=u*Math.PI*2;if(this.textSettings.background)if(this.textSettings.backgroundType===c.A.BACKGROUND_LINE){let t=u-this.textSettings.height/2;t>this.textSettings.height&&(this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding,this.ctx.beginPath(),this.ctx.ellipse(this.rect.width/2,this.rect.width/2,t,t,0,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore())}else if(this.textSettings.backgroundType===c.A.BACKGROUND_WORD){let e=r?this.textSettings.padding/2+h/2-p/2:this.textSettings.padding/2+h/2-s/2,a=(p-s)/t.replace(/\s/g,"").length;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding;let n=t.split(" ").filter((t=>t));for(var g=0;g<n.length;g++){let t=this.measureTextWidth(n[g],l,!0);r&&(t+=a*n[g].length);let s=u-this.textSettings.height/2;if(s<this.textSettings.height)continue;let c=(t+2*this.textSettings.padding)/p*360*(Math.PI/180),d=e/p*360*(Math.PI/180),m=o?90:270,v=m*(Math.PI/180)+(o?-d:d),y=m*(Math.PI/180)+(o?-(c+d):c+d);if(this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,this.rect.width/2,s,v,y,o),this.ctx.stroke(),this.textSettings.underline){const a=Math.ceil(.06*this.textSettings.height),n=Math.round(this.textSettings.padding+l);this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=a,d=(e+n)/p*360*(Math.PI/180),c=(t-2*l)/p*360*(Math.PI/180),v=m*(Math.PI/180)+(o?-d:d),y=m*(Math.PI/180)+(o?-(c+d):c+d);const r=Math.round(.5*(this.textSettings.baseline+a)+i);this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,this.rect.width/2,s+(o?r:-r),v,y,o),this.ctx.stroke(),this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding}e+=Math.round(t+3*this.textSettings.padding+h)}this.ctx.restore(),d=!0}let m=0;if(r){m=(p-s)/(d?t.replace(/\s/g,"").length:t.length+1)/2,s=d?p:p-2*m}if(this.textSettings.underline&&!this.isWordBackground){let t=u-this.textSettings.height/2;if(t>this.textSettings.height){const e=Math.ceil(.06*this.textSettings.height);let a=(s-2*Math.round(this.textSettings.padding+l))/(u*Math.PI*2)*360*(Math.PI/180/2),n=o?90:270,r=n*(Math.PI/180)-a,h=n*(Math.PI/180)+a;const c=Math.round(.5*(this.textSettings.baseline+e)+i);this.ctx.save(),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=e,this.ctx.beginPath(),o?this.ctx.arc(this.rect.width/2,this.rect.width/2,t+c,r,h):this.ctx.arc(this.rect.width/2,this.rect.width/2,t-c,r,h),this.ctx.stroke(),this.ctx.restore()}}if(this.ctx.save(),t.length>0){const e=.5*this.rect.width,r=.5*this.rect.height;null===(n=this.fill)||void 0===n||n.addToCanvasFillStyle(this.ctx,-e,-r),this.ctx.translate(e,r);let c=o?u-this.textSettings.height-this.textSettings.ascent:-u-this.textSettings.ascent,g=o?-1:1,y=d?2*l+3*this.textSettings.padding+h:this.measureTextWidth(" ",l,!0);this.ctx.rotate((s-y)/p*Math.PI*-g),this.ctx.textAlign="center";for(var v=0;v<t.length;v++){if(d&&" "===t[v]){if(v>0&&" "===t[v-1])continue;this.ctx.rotate((3*this.textSettings.padding+h+l)/p*(2*Math.PI)*g);continue}let e=this.ctx.measureText(t[v]).width/2;this.ctx.rotate((e+m)/p*Math.PI*2*g),this.drawChar(t[v],0,c+i,a),this.ctx.rotate((e+l+m)/p*Math.PI*2*g)}}this.ctx.restore()},this.drawArcLine=(t,e,s,i,a)=>{var n;const o=this.textSettings.getLineSpacing(),r=this.textSettings.getLetterSpacing();let[h,l]=this.calculateArcRadius(),d=h-e,u=d*Math.PI*2,p=this.textSettings.curveAmount<0,g=!1;if(this.textSettings.background)if(this.textSettings.backgroundType===c.A.BACKGROUND_WORD){let e=-s/2;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding;let a=t.split(" ").filter((t=>t));for(var m=0;m<a.length;m++){let t=this.measureTextWidth(a[m],r,!0),s=d-this.textSettings.height/2;if(s<this.textSettings.height)continue;let n=(t+2*this.textSettings.padding)/u*360*(Math.PI/180),l=e/u*360*(Math.PI/180),c=p?this.canvas.height-h:h,g=p?90:270,v=g*(Math.PI/180)+(p?-l:l),y=g*(Math.PI/180)+(p?-(n+l):n+l);if(this.ctx.beginPath(),p?this.ctx.arc(this.rect.width/2,c,s,y,v):this.ctx.arc(this.rect.width/2,c,s,v,y),this.ctx.stroke(),this.textSettings.underline){const a=Math.ceil(.06*this.textSettings.height),o=Math.round(this.textSettings.padding+r);this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=a,l=(e+o)/u*360*(Math.PI/180),n=(t-2*r)/u*360*(Math.PI/180),v=g*(Math.PI/180)+(p?-l:l),y=g*(Math.PI/180)+(p?-(n+l):n+l);const h=Math.round(.5*(this.textSettings.baseline+a)+i);this.ctx.beginPath(),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),p?this.ctx.arc(this.rect.width/2,c,s+h,y,v):this.ctx.arc(this.rect.width/2,c,s-h,v,y),this.ctx.stroke(),this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding}e+=Math.round(t+3*this.textSettings.padding+o)}this.ctx.restore(),g=!0}else if(this.textSettings.backgroundType===c.A.BACKGROUND_LINE){let t=d-this.textSettings.height/2;if(t>this.textSettings.height){let e=s/(d*Math.PI*2)*360*(Math.PI/180/2),i=p?this.canvas.height-h:h,a=p?90:270,n=a*(Math.PI/180)-e,o=a*(Math.PI/180)+e;this.ctx.save(),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding,this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,i,t,n,o),this.ctx.stroke(),this.ctx.restore()}}if(this.textSettings.underline&&!this.isWordBackground){let t=d-this.textSettings.height/2;if(t>this.textSettings.height){const e=Math.ceil(.06*this.textSettings.height);let a=(s-2*Math.round(this.textSettings.padding+r))/(d*Math.PI*2)*360*(Math.PI/180/2),n=p?this.canvas.height-h:h,o=p?90:270,l=o*(Math.PI/180)-a,c=o*(Math.PI/180)+a;const u=Math.round(.5*(this.textSettings.baseline+e)+i);this.ctx.save(),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=e,this.ctx.beginPath(),p?this.ctx.arc(this.rect.width/2,n,t+u,l,c):this.ctx.arc(this.rect.width/2,n,t-u,l,c),this.ctx.stroke(),this.ctx.restore()}}if(this.ctx.save(),t.length>0){let e=p?-1:1,l=p?d-this.textSettings.height-this.textSettings.ascent:-d-this.textSettings.ascent;this.ctx.textAlign="center";const c=.5*this.ctx.canvas.width,m=p?this.canvas.height-h:h;this.ctx.translate(c,m),null===(n=this.fill)||void 0===n||n.addToCanvasFillStyle(this.ctx,-c,-m),this.ctx.rotate((s-2*r-2*this.textSettings.padding)/u*Math.PI*-e);for(var v=0;v<t.length;v++){if(g&&" "===t[v]){if(v>0&&" "===t[v-1])continue;this.ctx.rotate((3*this.textSettings.padding+o+r)/u*(2*Math.PI)*e);continue}let s=this.ctx.measureText(t[v]).width;s/u*Math.PI*2>5e-4?(this.ctx.rotate(s/2/u*Math.PI*2*e),this.drawChar(t[v],0,l+i,a),this.ctx.rotate((s/2+r)/u*Math.PI*2*e)):(this.drawChar(t[v],s/2,l+i,a),this.ctx.rotate((s+r)/u*Math.PI*2*e))}}this.ctx.restore()},this.drawLine=(t,e,s,i,a,n=!1)=>{var o,r;let h=0,l=0;const d=this.textSettings.getLineSpacing(),u=this.textSettings.getLetterSpacing(),p=Math.ceil(.06*this.textSettings.height),g=Math.round(this.textSettings.padding+u),m=t.split(" ");if("center"==this.textSettings.align?h=Math.round((this.rect.width-s)/2):"right"==this.textSettings.align?h=Math.round(this.rect.width-s):"justify"==this.textSettings.align&&m.length>1&&s/this.rect.width>.7&&(l=this.isWordBackground?(this.rect.width-s)/(t.split(" ").filter((t=>t)).length-1):(this.rect.width-s)/(m.length-1),s=this.rect.width),this.textSettings.background&&this.textSettings.backgroundType===c.A.BACKGROUND_LINE&&(this.ctx.fillStyle=this.textSettings.backgroundColor,this.ctx.fillRect(h,e-this.textSettings.padding,Math.round(s),this.textSettings.height+2*this.textSettings.padding),null===(o=this.fill)||void 0===o||o.addToCanvasFillStyle(this.ctx)),this.textSettings.underline&&!this.isWordBackground){const t=Math.ceil(.06*this.textSettings.height),a=Math.round(this.textSettings.padding+u);this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.fillRect(h+a,e+this.textSettings.baseline+t+i,s-2*a,t),this.ctx.globalCompositeOperation="source-over"}if(0!==l||this.isWordBackground){let t=this.ctx.measureText(" ").width;for(let s=0;s<m.length;s++){const n=this.measureTextWidth(m[s],u,!0);if(this.isWordBackground){if(!m[s])continue;this.ctx.fillStyle=this.textSettings.backgroundColor,this.ctx.fillRect(h,e-this.textSettings.padding,Math.round(n+2*this.textSettings.padding),this.textSettings.height+2*this.textSettings.padding),null===(r=this.fill)||void 0===r||r.addToCanvasFillStyle(this.ctx),t=3*this.textSettings.padding+d,this.textSettings.underline&&(this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.fillRect(h+g,e+this.textSettings.baseline+p+i,Math.round(n+2*this.textSettings.padding)-2*g,p),this.ctx.globalCompositeOperation="source-over")}0===u?this.drawText(m[s],h+this.textSettings.padding+u,e-this.textSettings.ascent+i,a):this.drawSpacedText(m[s],h+this.textSettings.padding+u,e-this.textSettings.ascent+i,u,a),h+=Math.round(n+t+l)}}else 0!==u||n?this.drawSpacedText(t,h+this.textSettings.padding+u,e-this.textSettings.ascent+i,u,a):this.drawText(t,h+this.textSettings.padding+u,e-this.textSettings.ascent+i,a)},this.drawSpacedText=(t,e,s,i,a)=>{let n=0,o="";for(;n<t.length;)o=t[n++],this.drawChar(o,e,s,a),e+=this.ctx.measureText(o).width+i},this.drawText=(t,e,s,i)=>{this.textSettings.outline&&0===i.x&&0===i.y&&this.ctx.strokeText(t,e,s),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.fillText(t,e,s),this.ctx.globalCompositeOperation="source-over",!this.textSettings.outline||0===i.x&&0===i.y||this.ctx.strokeText(t,e+i.x,s+i.y)},this.drawChar=(t,e,s,i)=>{this.textSettings.outline&&0===i.x&&0===i.y&&this.ctx.strokeText(t,e,s),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.fillText(t,e,s),this.ctx.globalCompositeOperation="source-over",!this.textSettings.outline||0===i.x&&0===i.y||this.ctx.strokeText(t,e+i.x,s+i.y)},this.measureTextWidth=(t,e,s)=>{if(!t)return 0;let i=0;if(0!==e){for(let e=0;e<t.length;e++)i+=this.ctx.measureText(t[e]).width;i+=t.length*e}else i=this.ctx.measureText(t).width;return s&&(i+=e),i},this.position=(t,e)=>{this.rect&&(void 0!==t&&(this.rect.x=t),void 0!==e&&(this.rect.y=e),this.bect&&(this.bect.x=this.rect.x-4*this.textSettings.padding,this.bect.y=this.rect.y-4*this.textSettings.padding))},this.scale=(t,e)=>{this.textSettings.setSize(Math.round(this.textSettings.size*e)),this.rect.x=Math.round(this.rect.x*t),this.rect.y=Math.round(this.rect.y*e),this.rect.width=Math.round(this.rect.width*t),this.render()},this.calculate=(t,e)=>{this.rect.x=Math.round(t.x),this.rect.width=Math.round(e.x-t.x),this.rect.width<20&&(this.rect.width=20),this.render()},this.setWidth=t=>{this.rect.width=Math.round(t),this.rect.width<20&&(this.rect.width=20),this.render()},this.getHeight=()=>this.textSettings.height,this.setHeightScale=t=>{let e=Math.round(this.textSettings.size*t);this.setTextSize(e>1e3?1e3:e)},this.rotate=t=>{this.rect.rotation+=t?-90:90},this.rasterize=()=>{let t=this.baked?this.baked:this.canvas,e=this.bect?this.bect.clone():this.rect.clone();const s=new l.A(i.Os(),this.settings.name,t,e,this.settings.locked);return s.settings=Object.assign({},this.settings),s.applyTransform(),s},this.clone=(t=!1)=>{let e=new u(t?this.id:i.Os(),this.text,this.rect.clone(),this.textSettings.clone());return e.settings=Object.assign({},this.settings),e.animation=d.A.clone(this.animation),e.rect=this.rect.clone(),e.canvas=i.oM(this.canvas),e.prepare(),e},this.textSettings=p,this.text=e,this.rect=s}drawCurveLine(t,e,s,i,a){switch(this.textSettings.curveType){case"arc":this.drawArcLine(t,e,s,i,a);break;case"circle":this.drawCircleLine(t,e,s,i,a);break;case"half":this.drawHalfLine(t,e,s,i,a)}}}},89209:(t,e,s)=>{s.d(e,{A:()=>o});var i=s(42268),a=s(54738);class n{constructor(t,e,s=!0){this.lineSpace=0,this.letterSpace=0,this.bold=!1,this.italic=!1,this.uppercase=!1,this.underline=!1,this.align="center",this.curve=!1,this.curveAmount=0,this.curveType="arc",this.curveFlip=!1,this.curveSpread=!1,this.warp=!1,this.warpEdgeSize=0,this.warpCenterSize=0,this.warpHorizontalOffset=0,this.warpVerticalOffset=0,this.warpType=n.WARP_CIRCULAR,this.warpMode=n.WARP_UPPER,this.background=!1,this.backgroundOffset=0,this.backgroundPunch=!1,this.backgroundColor="#555555",this.backgroundType=n.BACKGROUND_FULL,this.outline=!1,this.outlinePunch=!1,this.outlineColor="#555555",this.outlineSize=.3,this.outlineDistance=0,this.outlineDirection=305,this.shadow=!1,this.shadowBlur=.3,this.shadowColor="#000000",this.shadowAlpha=.6,this.shadowDistance=.3,this.shadowDirection=160,this.font=t,this.size=e,s&&this.measureText()}setSize(t){this.size=t,this.measureText()}setFont(t){this.font=t,this.measureText()}measureText(){if(this.size<1)return;var t=document.createElement("canvas");t.width=20*this.size,t.height=Math.round(2*this.size);const e=t.getContext("2d",{willReadFrequently:!0});e.textBaseline="top",e.fillStyle="white",e.font=this.getCssFont(),e.fillText("SfTgMjkHpqLRnliIFIABCDEFGIJKNOPQSUVXYZabcdeghmnorstuvxyz",0,Math.round(.5*this.size));const s=a.zR(e.getImageData(0,0,t.width,t.height));if(s){this.ascent=s.y-Math.round(.5*this.size),this.height=s.height,e.clearRect(0,0,t.width,t.height),e.fillText("SMOP",0,Math.round(.5*this.size));const i=a.zR(e.getImageData(0,0,t.width,t.height));this.baseline=i.height}this.height<=0&&this.measureTextFallback(),this.padding=Math.round(.2*this.height)}measureTextFallback(){var t=document.createElement("span");t.innerHTML="ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz",t.style.fontFamily=this.font,t.style.fontSize=this.size+"px";var e=document.createElement("div");e.style.display="inline-block",e.style.width="1px",e.style.height="0px";var s=document.createElement("div");s.appendChild(t),s.appendChild(e),(0,i.Ay)("workspace").appendChild(s);try{e.style.verticalAlign="baseline",this.ascent=e.offsetTop-t.offsetTop+1,e.style.verticalAlign="bottom",this.height=e.offsetTop-t.offsetTop+1,this.baseline=this.height}finally{s.remove()}}getLineSpacing(){var t;return Math.ceil(this.height*Number(null!==(t=this.lineSpace)&&void 0!==t?t:0))}getLetterSpacing(){var t;return Math.ceil(this.height/2*Number(null!==(t=this.letterSpace)&&void 0!==t?t:0))}getCssFont(t=this.size){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+t+"px "+this.font}clone(){const t=Object.create(n.prototype);return Object.assign(t,this)}equalTo(t){return!!t&&(this.font===t.font&&this.size===t.size&&this.lineSpace===t.lineSpace&&this.letterSpace===t.letterSpace&&this.bold===t.bold&&this.italic===t.italic&&this.underline===t.underline&&this.uppercase===t.uppercase&&this.fillType===t.fillType&&this.fillValue===t.fillValue&&this.align===t.align&&this.curve===t.curve&&this.curveAmount===t.curveAmount&&this.curveType===t.curveType&&this.curveSpread===t.curveSpread&&this.curveFlip===t.curveFlip&&this.warp===t.curve&&this.warpMode===t.warpMode&&this.warpType===t.warpType&&this.warpEdgeSize===t.warpEdgeSize&&this.warpCenterSize===t.warpCenterSize&&this.warpHorizontalOffset===t.warpHorizontalOffset&&this.warpVerticalOffset===t.warpVerticalOffset&&this.background===t.background&&this.backgroundPunch===t.backgroundPunch&&this.backgroundColor===t.backgroundColor&&this.backgroundType===t.backgroundType&&this.outline===t.outline&&this.outlinePunch===t.outlinePunch&&this.outlineSize===t.outlineSize&&this.outlineColor===t.outlineColor&&this.outlineDistance===t.outlineDistance&&this.outlineDirection===t.outlineDirection&&this.shadow===t.shadow&&this.shadowBlur===t.shadowBlur&&this.shadowColor===t.shadowColor&&this.shadowAlpha===t.shadowAlpha&&this.shadowDistance===t.shadowDistance&&this.shadowDirection===t.shadowDirection)}}n.BACKGROUND_FULL="full",n.BACKGROUND_LINE="line",n.BACKGROUND_WORD="word",n.WARP_CIRCULAR="circular",n.WARP_ANGULAR="angular",n.WARP_UPPER="upper",n.WARP_MIDDLE="middle",n.WARP_LOWER="lower";const o=n},29755:(t,e,s)=>{s.d(e,{Ay:()=>p,Lr:()=>l,P2:()=>c,ZC:()=>o,oY:()=>r,pp:()=>h});var i=s(42268),a=s(98244),n=s(41915);function o(t,e){(0,a.A)("setting-"+t,e.toString());const s=window.localStorage.getItem("user-settings"),i=JSON.parse(s||"{}");u[t]=i[t]=e,window.localStorage.setItem("user-settings",JSON.stringify(i)),document.dispatchEvent(new CustomEvent("user-setting-updated",{detail:t}))}function r(t){let e=t.toHEX(),s=u.oldColor.findIndex((t=>t===e));s>-1?u.oldColor.splice(0,0,u.oldColor.splice(s,1)[0]):(u.oldColor.pop(),u.oldColor.unshift(e)),o("oldColor",u.oldColor)}function h(){let t=1,e=d();u.ddid&&""!==u.ddid&&-1!==u.ddid.indexOf(":")&&Number(u.ddid.split(":")[0])===e&&(t=Number(u.ddid.split(":")[1])+1),o("ddid",e+":"+t),(0,a.A)("daily-saves",t.toString())}function l(){if(u.ddid&&""!==u.ddid&&-1!==u.ddid.indexOf(":")&&Number(u.ddid.split(":")[0])===d()){let t=Number(u.ddid.split(":")[1]);return t<=0&&(t=666),t}return 0}function c(){return l()>=3}function d(){let t=new Date;return(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())-Date.UTC(t.getFullYear(),0,0))/24/60/60/1e3}const u=function(){const t={product:"web",debug:"",cdnUrl:"",isIOS:!1,isHDPI:!1,isSafari:!1,canTouch:!1,accent:"default",workspace:"default",allTooltip:!1,autoSelect:!0,showGuides:!0,snapToGuides:!0,smoothScaling:!0,askToPreResize:!0,useLegacySave:!1,performanceMode:!1,scrollMode:"zoom",maxHistoryUndos:25,boxBarXState:"maximized",panelFloating:!1,panelNavigator:!0,panelLayer:!0,panelHistory:!0,barQuicklink:!0,mainColor:"#ffffff",altColor:"#000000",oldColor:["#A8534B","#EC9D75","#F9D697","#DCE6A7","#9ADFB0","#57CBAB","#38A793","#5A5E5A"],gradients:[],dialogPos:new n.A(0,0),adyenClientKey:"",lastNewsCheck:"1970-01-01T00:00:00Z",ddid:""};return Object.assign(t,(()=>{const t=window.localStorage.getItem("user-settings");return JSON.parse(t||"{}")})()),Object.assign(t,(()=>{const t=new URL(window.location.href),e={};return t.searchParams.forEach(((t,s)=>{e[s]=t})),e})()),Object.assign(t,(()=>{const t=(0,i.Ay)("config_data");if(t&&t.innerText){let t=JSON.parse((0,i.Ay)("config_data").innerText);return(0,i.Ay)("config_data").remove(),t}return{}})()),t}(),p=u},9720:(t,e,s)=>{s.d(e,{A:()=>c});var i=s(42268),a=s(98244),n=s(29755),o=s(96160),r=s(50295),h=s(68150),l=s(3514);class c{constructor(){var t,e,s,c,d,u,p,g,m;this.pollNews=async()=>{const t=new Date(n.Ay.lastNewsCheck);this.news=await fetch(`https://pixlr.com/api/news/poll/?target=web&from=${t.toISOString()}&limit=5`).then((t=>t.json()));const e=await this.news;!1!==e.status?(e.data.unread>0&&!e.data.pop&&(0,i.Ay)("head-news").append((0,i.T)("span",{id:"noti-red-dot"})),"web"!==n.Ay.product&&!n.Ay.api&&e.data.pop&&new o.A(e.data.news.docs)):console.error(e.message)},this.newsClick=async()=>{var t;(0,a.A)("news-click");const e=await this.news;!1!==e.status&&e.data.news.docs.length?(null===(t=(0,i.Ay)("noti-red-dot"))||void 0===t||t.remove(),new o.A(e.data.news.docs)):document.dispatchEvent(new CustomEvent("notification",{detail:"No news :/"}))},document.documentElement.classList.add(n.Ay.workspace,n.Ay.accent),null===(t=(0,i.Ay)("head-login"))||void 0===t||t.addEventListener("click",(()=>new r.A)),null===(e=(0,i.Ay)("plug-login"))||void 0===e||e.addEventListener("click",(()=>new r.A)),null===(s=(0,i.Ay)("head-menu-login"))||void 0===s||s.addEventListener("click",(()=>new r.A)),null===(c=(0,i.Ay)("head-news"))||void 0===c||c.addEventListener("click",this.newsClick,!0),null===(d=(0,i.Ay)("head-menu-news"))||void 0===d||d.addEventListener("click",this.newsClick,!0),null===(u=(0,i.Ay)("head-settings"))||void 0===u||u.addEventListener("click",(()=>new h.A)),null===(p=(0,i.Ay)("head-menu-settings"))||void 0===p||p.addEventListener("click",(()=>new h.A)),null===(g=(0,i.Ay)("head-premium"))||void 0===g||g.addEventListener("click",(()=>new l.A("splash","premium"))),null===(m=(0,i.Ay)("plug-premium"))||void 0===m||m.addEventListener("click",(()=>new l.A("plug","premium"))),this.pollNews()}}},90593:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(54738),a=s(42903);class n extends a.A{constructor(t){super(t,"auto");let e=i.tn(this.selected.canvas);this.shaders.addShader("bwpoint",{black:e.x,white:e.y});let s=i.T6(this.selected.canvas);s<.7&&this.shaders.addShader("vibrance",.7-s),this.apply()}}},72357:(t,e,s)=>{s.d(e,{A:()=>a});var i=s(42903);class a extends i.A{constructor(t){super(t,"bw"),this.shaders.addShader("saturation",-1),this.shaders.addShader("contrast",.2),this.shaders.addShader("exposure",.1),this.shaders.addShader("clarity",.1),this.apply()}}},64872:(t,e,s)=>{s.d(e,{A:()=>a});var i=s(42903);class a extends i.A{constructor(t){super(t,"desaturate"),this.shaders.addShader("desaturate",1),this.apply()}}},57906:(t,e,s)=>{s.d(e,{A:()=>a});var i=s(42903);class a extends i.A{constructor(t){super(t,"invert"),this.shaders.addShader("invert",1),this.apply()}}},9735:(t,e,s)=>{s.d(e,{A:()=>a});var i=s(42903);class a extends i.A{constructor(t){super(t,"pop"),this.shaders.addShader("highlights",.5),this.shaders.addShader("shadows",-.5),this.shaders.addShader("vibrance",.5),this.shaders.addShader("saturation",.2),this.shaders.addShader("exposure",.2),this.shaders.addShader("clarity",.2),this.apply()}}},48373:(t,e,s)=>{s.d(e,{A:()=>a});var i=s(42903);class a extends i.A{constructor(t){super(t,"sobel"),this.shaders.addShader("sobel",1),this.apply()}}},59423:(t,e,s)=>{s.d(e,{A:()=>a});var i=s(42903);class a extends i.A{constructor(t){super(t,"solarize"),this.shaders.addShader("solarize",1),this.apply()}}},72284:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(42268),a=s(54738);class n{constructor(t=!0){this.scopedId=t=>`${this.mid}-${t}`,this.setContent=(...t)=>{t[0]instanceof HTMLElement?this.content.append(...t):this.content.innerHTML+=t[0]},this.keyDown=t=>{"Escape"!==t.key&&"Esc"!==t.key||this.cleanUp()},this.cleanUp=()=>{document.removeEventListener("keydown",this.keyDown,!1),this.dialog.classList.remove("ani"),this.modal.classList.remove("dim"),setTimeout((()=>{this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null}),200)},this.mid=a.r0(),this.modal=(0,i.T)("div",{id:"modal-"+this.mid,className:"modal"}),document.body.appendChild(this.modal),this.dialog=(0,i.T)("div",{className:"announce"}),this.modal.appendChild(this.dialog),this.content=(0,i.T)("div",{className:"content"}),this.dialog.append((0,i.T)("div",{id:"announce-close"+this.mid,className:"announce-close",onclick:()=>this.cleanUp()},(0,i.T)("img",{src:"/img/icon/close.svg"})),this.content),document.addEventListener("keydown",this.keyDown,!1),setTimeout((()=>this.dialog.classList.add("ani")),5),t&&setTimeout((()=>this.modal.classList.add("dim")),5)}}},50295:(t,e,s)=>{s.d(e,{A:()=>o});var i=s(42268),a=s(72284),n=s(11839);class o extends a.A{constructor(t={}){super(!0),this.setContent('\n            <div id="entry-pop-right" class="half">\n                <h1 class="large center top-20"><strong>Hi there!</strong></h1>\n                <h3 class="center top-10">Welcome to Pixlr, so happy to see you!</h3>\n                <div id="entry-auth-holder" class="top-20"></div>\n            </div>\n            ');let e=(0,i.T)("div",{id:"entry-pop-left",className:"hero"});this.dialog.insertBefore(e,this.content),this.auth=new n.Ay(Object.assign(Object.assign({},t),{view:"chooser",holder:(0,i.Ay)("entry-auth-holder")}))}}},96160:(t,e,s)=>{s.d(e,{A:()=>c});var i=s(21742),a=s(42268),n=s(72284),o=s(98244),r=s(79453),h=s(3514),l=s(29755);class c extends n.A{constructor(t){var e,s;if(super(),this.selectedIndex=0,this.dialog.classList.add("news-dialog"),t.length>1){const s=t=>t.length>50?t.slice(0,50)+"…":t,n=t.map(((e,i)=>(0,a.T)("a",{id:`news-menu-item-${i}`,className:i===this.selectedIndex?"item selected":"item",href:"javascript:;",onclick:()=>{var e;(0,a.Ay)(`news-menu-item-${this.selectedIndex}`).classList.remove("selected"),(0,a.Ay)(`news-menu-item-${i}`).classList.add("selected"),(0,a.Ay)("news-current").replaceWith(d(t[i])),this.selectedIndex=i,null===(e=(0,a.Ay)("new-checkout-cta"))||void 0===e||e.addEventListener("click",(()=>{new h.A("news","premium"),this.cleanUp()})),(0,o.A)("news-select")}},(0,a.T)("div",s(e.title)))));this.setContent((0,a.T)("div",{className:"news-split"},(0,a.T)("div",{className:"news-menu"},(0,a.T)("div",{className:"headline"},(0,i.A)("whatsNew")),(0,a.T)("div",{},...n)),(0,a.T)("div",{className:"news-body"},d(t[this.selectedIndex])))),null===(e=(0,a.Ay)("new-checkout-cta"))||void 0===e||e.addEventListener("click",(()=>{new h.A("news","premium"),this.cleanUp()}))}else this.dialog.classList.add("single-news"),this.setContent(d(t[0])),null===(s=(0,a.Ay)("new-checkout-cta"))||void 0===s||s.addEventListener("click",(()=>{new h.A("news","premium"),this.cleanUp()}));(0,l.ZC)("lastNewsCheck",(new Date).toISOString())}}function d(t,e){const s=new Date(t.publishDate);let i;if(t.video){const s=()=>{const e=Math.max(360,n.getBoundingClientRect().height),s=`https://www.youtube.com/embed/${t.video}?autoplay=1&modestbranding=1`;i.style.height=e+"px",n.style.filter="blur(6px)",(0,o.A)("news-play"),i.append((0,a.T)("div",{className:"player-container"},(0,a.T)("iframe",{width:"640",height:"360",src:s,className:"player",allow:"autoplay"})))};let n=(0,a.T)("img",{className:"news-cover",src:t.cover,onload:e}),r=(0,a.T)("div",{className:"play-button",onclick:s},(0,a.T)("img",{src:"/img/icon/play-circle.svg"}));i=(0,a.T)("div",{className:"cover-stack"},n,r)}else i=(0,a.T)("img",{className:"news-cover",src:t.cover,onload:e});return(0,a.T)("div",{id:"news-current"},i,(0,a.T)("div",{className:"news-content"},(0,a.T)("div",{className:"news-title"},(0,a.T)("div",{className:"news-date"},(0,a.T)("span",`${s.toLocaleDateString()}`)),(0,a.T)("span",{className:"news-headline"},t.title)),(0,a.T)("div",{className:"news-text"},t.text),t.checkoutCta&&"free"===(null===r.N||void 0===r.N?void 0:r.N.subscriptionAccess)?(0,a.T)("a",{className:"button med",style:"margin-left:auto;",id:"new-checkout-cta",dataset:t.ctaDataset||{}},r.N?"GET A SUBSCRIPTION":"SIGN UP NOW!"):t.urlWeb?(0,a.T)("a",{className:"button med",style:"margin-left:auto;",href:t.urlWeb,target:"_blank",onmousedown:()=>{(0,o.A)("news-url-web")}},t.cta):""))}},3514:(t,e,s)=>{s.d(e,{A:()=>d});var i=s(42268),a=s(21742),n=s(50295),o=s(72284),r=s(98244),h=s(29755),l=s(79453),c=s(96703);class d extends o.A{constructor(t,e){super(!0),(0,r.A)("bounce",t),this.content.id="bounce-content",this.content.style.flexDirection="column";const s=!(!l.N||"plus"!==l.N.subscriptionAccess);"save"===e?this.setContent(`\n                <div id="bounce-top">\n                    <h1 class="top-20">${(0,a.A)("bounceSnap")}</h1>\n                    <p class="top-20">${(0,a.A)("bounceLowPrice","0.99")}</p>\n\n                    <p id="do-login" style="display:none">${(0,a.A)("common-alreadyMember")} <a id="login-link">${(0,a.A)("common-loginHere")}</a></p>\n                </div>\n            `):this.setContent(`\n                <div id="bounce-top">\n                    <h1 class="top-20">${(0,a.A)("bounceTitle")}</h1>\n                    <p class="top-20">${(0,a.A)("bounceFeaturePitch")}</p>\n                </div>\n            `),this.setContent(`\n\n            <div class="paywal-plan">\n\n                <div id="subscribe-plus" class="plan">\n                    <div class="plan-details">\n                        <h2><img src="/img/misc/plus-icon.svg" alt="plus icon" style="width: 24px;"> ${(0,a.A)("plus")}</h2>\n\n                        <p>${(0,a.A)("bouncePlusDesc")}</p>\n                        <ul class="top-10">\n                            <li>${(0,a.A)("bounceAdFree")}</li>\n                            <li>${(0,a.A)("bounceUnlimitedSaves")}</li>\n                            <li>${(0,a.A)("bounceCreditsIncluded").replace("{number}","80")}</li> \n                        </ul>\n\n                        <h2 class="top-20">$0.99</h2>\n                        <div>USD /${(0,a.A)("month")}</div>\n\n                        ${s?`<div class="button large disabled w-100 rounded top-30" style="color: #000;cursor: not-allowed !important;">${(0,a.A)("currentPlan")}</div>`:`<div class="button large white w-100 rounded top-30">${(0,a.A)("subscribeNow")}</div>`}\n                    </div>\n                </div>\n\n                <div id="subscribe-premium" class="plan popular">\n                    <div class="plan-header">\n                        ${(0,a.A)("mostPopular")}\n                    </div>\n                    <div class="plan-details">\n                        <h2><img src="/img/misc/premium-icon.svg" alt="premium icon" style="width: 24px;"> ${(0,a.A)("premium")}</h2>\n\n                        <p>${(0,a.A)("bouncePremiumDesc")}</p>\n                        <ul class="top-10">\n                            <li>${(0,a.A)("bounceAdFree")}</li>\n                            <li>${(0,a.A)("bounceUnlimitedSaves")}</li>\n                            <li>${(0,a.A)("bounceCreditsIncluded").replace("{number}","1000")}</li> \n                            <li>${(0,a.A)("bouncePrivateMode")}</li>\n                            <li>${(0,a.A)("bounceBigLibrary")}</li>\n                        </ul>\n\n                        <h2 class="top-20">$4.90</h2>\n                        <div>USD /${(0,a.A)("month")}</div>\n\n                        <div class="button w-100 large rounded top-30" style="background:#111;">\n                        ${s?(0,a.A)("upgradeNow"):!l.N||l.N.eligibleForTrail?(0,a.A)("try30DaysFree"):(0,a.A)("subscribeNow")}\n                        </div>\n                    </div>\n                </div>\n\n                <div id="subscribe-team" class="plan">\n                    <div class="plan-details">\n                        <h2><img src="/img/misc/team-icon.svg" alt="team icon"> ${(0,a.A)("team")}</h2>\n\n                        <p>${(0,a.A)("bounceTeamDesc")}</p>\n                        <ul class="top-10">\n                            <li>${(0,a.A)("bounceAdFree")}</li>\n                            <li>${(0,a.A)("bounceUnlimitedSaves")}</li>\n                            <li>${(0,a.A)("pricingFiveSeats")}</li>\n                            <li>${(0,a.A)("pricingCreditsMemberIncluded").replace("{number}","1000")}</li> \n                        </ul>\n\n                        <h2 class="top-20">$9.91</h2>\n                        <div>USD /${(0,a.A)("month")}</div>\n\n                        <div class="button large white rounded w-100 top-30">${s?(0,a.A)("upgradeNow"):(0,a.A)("subscribeNow")}</div>\n                    </div>\n                </div>\n            </div>\n\n            <p class="center pad-15">${(0,a.A)("unsureWhichSubscriptionToGet",`<a href="/pricing" target="_blank">${(0,a.A)("pricingPage")}</a>`)} ${(0,a.A)("freeForEducation",`<a href="/learn/education/" class="anchor" target="_blank">${(0,a.A)("education")}</a>`)}</p>\n            \n        `),"save"!==e||l.N||((0,i.Ay)("do-login").style.display="block",(0,i.Ay)("login-link").addEventListener("click",(()=>{this.cleanUp(),new n.A}))),(0,i.Ay)("subscribe-plus").addEventListener("click",(()=>{s||(this.cleanUp(),l.N?new c.A("subscription",{platform:h.Ay.product,plan:"plus-monthly",bounceSource:"premiumbounce"}):new n.A)})),(0,i.Ay)("subscribe-premium").addEventListener("click",(()=>{this.cleanUp(),l.N?new c.A("subscription",{platform:h.Ay.product,plan:"premium-monthly",bounceSource:"premiumbounce"}):new n.A})),(0,i.Ay)("subscribe-team").addEventListener("click",(()=>{this.cleanUp(),l.N?new c.A("subscription",{platform:h.Ay.product,plan:"team-monthly",bounceSource:"premiumbounce"}):new n.A}))}}},85337:(t,e,s)=>{s.d(e,{A:()=>g});var i=s(54738),a=s(42268),n=s(40963),o=s(21742),r=s(41915),h=s(82042),l=s(59350),c=s(21404),d=s(81937),u=s(71499);class p{constructor(t,e){this.stage=t,this.angleChange=()=>{let t=Number(this.angle.value.replace("°",""));t<0&&(t=0),t>360&&(t=360),this.brush.settings.angle=Math.round(t),this.updatePreview(!1)},this.updatePreview=t=>{this.brush.settings.softness=this.softness.getValue(),this.brush.settings.distance=this.distance.getValue(),this.brush.settings.size=this.size.getValue()>125&&t?125:this.size.getValue(),this.brush.generate();const e=this.preview.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height);const s=n.A.bestFit(this.brush.canvas.width,this.brush.canvas.height,e.canvas.width,e.canvas.height);e.drawImage(this.brush.canvas,s.x,s.y,s.width,s.height),this.renderStroke(),this.renderOutline()},this.renderOutline=()=>{const t=this.raster.getContext("2d");t.clearRect(0,0,120,120),t.save(),t.translate(60,60),t.rotate(-this.brush.settings.angle*Math.PI/180);const e=45,s=Math.round(90*this.brush.settings.aspect)/2;t.lineWidth=2,t.fillStyle="#999",t.strokeStyle="#444",t.beginPath(),t.moveTo(0,s),t.lineTo(0,-s),t.stroke(),t.beginPath(),t.moveTo(e,0),t.lineTo(-45,0),t.stroke(),t.lineWidth=2,t.strokeStyle="#999",t.beginPath(),t.ellipse(0,0,e,s,0,0,2*Math.PI),t.stroke(),t.beginPath(),t.ellipse(0,s,6,6,0,0,2*Math.PI),t.fill(),t.beginPath(),t.ellipse(0,-s,6,6,0,0,2*Math.PI),t.fill(),t.beginPath(),t.moveTo(50,-6),t.lineTo(50,6),t.lineTo(58,0),t.lineTo(50,-6),t.fill(),t.restore()},this.renderStroke=()=>{var t=this.stroke.getContext("2d");t.imageSmoothingQuality="high",t.imageSmoothingEnabled=!0;const e=n.A.bestFit(this.brush.canvas.width,this.brush.canvas.height,30,30),s=Math.floor(this.brush.getStep()*(e.width/this.brush.canvas.width))||1;var i=0,a=2*Math.PI/((t.canvas.width-40)/s);let o=~~(e.width/2),r=~~(e.height/2);t.clearRect(0,0,t.canvas.width,t.canvas.height);for(let n=20;n<=t.canvas.width-20;n+=s)t.drawImage(this.brush.canvas,n-o,30-12*Math.sin(i)-r,e.width,e.height),i+=a},this.setUp=()=>{let t=this.brushpod.container.getBoundingClientRect(),e=this.stage.workspace.getBoundingClientRect();this.modal.addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault(),t.target===t.currentTarget&&this.cleanUp()}),!1),this.container.style.top=t.bottom-3-e.y+"px",this.container.style.left=t.x-e.x+"px",this.container.style.height="450px",this.container.style.display="flex",this.size=new h.A("brush-size",{label:(0,o.A)("size"),range:[1,100,1e3],step:[1,10],stops:[0,.4,1],defaultValue:this.brush.settings.size,labelFormat:t=>t+"px",onChange:()=>{this.updatePreview(!0)},onEnd:()=>{this.updatePreview(!1)}}),this.softness=new h.A("brush-softness",{label:(0,o.A)("softness"),defaultValue:this.brush.settings.softness,labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100,onChange:()=>{this.updatePreview(!0)},onEnd:()=>{this.updatePreview(!1)}}),this.distance=new h.A("brush-step",{range:[0,3],label:(0,o.A)("step"),defaultValue:this.brush.settings.distance,labelParse:t=>parseInt(t,1)/100,labelFormat:t=>(100*t).toFixed(0)+"%",onChange:()=>{this.updatePreview(!0)},onEnd:()=>{this.updatePreview(!1)}}),this.angle=(0,a.Ay)("brush-angle"),this.angle.value=this.brush.settings.angle+"°",this.angle.addEventListener("input",this.angleChange,!0),this.raster.addEventListener("mousedown",this.rasterDown,!1),this.populatePresets(),this.updatePreview(!1)},this.rasterDown=t=>{const e=this.raster.getBoundingClientRect(),s=new r.A(t.clientX-Math.round(e.x),t.clientY-Math.round(e.y));this.matrix=new c.A,this.matrix.reset(),this.matrix.translate(new r.A(60,60)),this.matrix.rotate(-this.brush.settings.angle*Math.PI/180),this.matrix.invert(),this.down=this.matrix.transformPoint(s),this.down.x>40&&this.down.y>-10&&this.down.y<10?this.target="rotate":this.down.x>-10&&this.down.x<10&&(this.target="size",this.down=s),void 0!==this.target&&(document.addEventListener("mousemove",this.rasterMove,!1),document.addEventListener("mouseup",this.rasterUp,!1))},this.rasterMove=t=>{const e=this.raster.getBoundingClientRect();let s=new r.A(t.clientX-Math.round(e.x),t.clientY-Math.round(e.y));if("size"===this.target)this.matrix.reset(),this.matrix.translate(new r.A(60,60)),this.matrix.rotate(-this.brush.settings.angle*Math.PI/180),this.matrix.invert(),s=this.matrix.transformPoint(s),this.brush.settings.aspect=i.qE(Math.abs(s.y)/45,.1,1);else{let t=-180/Math.PI*Math.atan2(s.y-60,s.x-60);t>360?t-=360:t<0&&(t+=360),this.brush.settings.angle=t,this.angle.value=Math.round(this.brush.settings.angle)+"°"}this.updatePreview(!1)},this.rasterUp=t=>{this.down=void 0,this.target=void 0,this.matrix=void 0,document.removeEventListener("mousemove",this.rasterMove,!1),document.removeEventListener("mouseup",this.rasterUp,!1)},this.populatePresets=()=>{this.addPresetCollection("basic-circle",(0,o.A)("basicCircular"),!1,[new u.A("circle",1,.02),new u.A("circle",5,.02),new u.A("circle",10,.02),new u.A("circle",15,.02),new u.A("circle",20,.02),new u.A("circle",30,.02),new u.A("circle",50,.02),new u.A("circle",70,.02),new u.A("circle",100,.01),new u.A("circle",200,.01),new u.A("circle",400,.01),new u.A("circle",500,.01),new u.A("circle",5,.25),new u.A("circle",10,.25),new u.A("circle",20,.25),new u.A("circle",30,.25),new u.A("circle",40,.25),new u.A("circle",50,.25),new u.A("circle",70,.25),new u.A("circle",100,.25),new u.A("circle",150,.25),new u.A("circle",200,.25),new u.A("circle",400,.25),new u.A("circle",500,.25),new u.A("circle",5,.5),new u.A("circle",10,.5),new u.A("circle",20,.5),new u.A("circle",30,.5),new u.A("circle",40,.5),new u.A("circle",50,.5),new u.A("circle",70,.5),new u.A("circle",100,.5),new u.A("circle",150,.5),new u.A("circle",200,.5),new u.A("circle",400,.5),new u.A("circle",500,.5)]),this.addPresetCollection("basic-shapes",(0,o.A)("basicShapes"),!1,[new u.A("square",4,0),new u.A("square",6,0),new u.A("square",10,0),new u.A("square",20,0),new u.A("square",30,0),new u.A("square",50,0),new u.A("square",70,0),new u.A("square",100,0),new u.A("square",200,0),new u.A("square",300,0),new u.A("square",400,0),new u.A("square",500,0),new u.A("diamond",50,.8),new u.A("diamond",100,.8),new u.A("diamond",100,.8,1,0,.5,5),new u.A("diamond",100,.8,1,0,.25,7),new u.A("diamond",100,.01,1,45,.25,4,1.5),new u.A("diamond",100,.01,1,0,.25,5,1.5),new u.A("diamond",100,.01,1,0,.25,6,1.5),new u.A("diamond",100,.01,1,0,.25,7,1.5),new u.A("circle",10,.1,1,60,.2,2,.07),new u.A("circle",20,.1,1,60,.2,2,.07),new u.A("circle",50,.1,1,60,.2,2,.07),new u.A("circle",100,.1,1,60,.2,2,.07),new u.A("square",100,.8,1,0,.5,5),new u.A("square",100,.8,1,0,.25,7),new u.A("square",100,.01,1,45,.25,4,1.5),new u.A("square",100,.01,1,0,.25,5,1.5),new u.A("square",100,.01,1,0,.25,6,1.5),new u.A("square",100,.01,1,0,.25,7,1.5),new u.A("square",100,.01,1,0,1,5,1.5),new u.A("square",100,.01,1,0,1,6,1.5),new u.A("square",100,.01,1,0,1,7,1.5),new u.A("circle",100,.01,1,0,.25,5,1.5),new u.A("circle",100,.01,1,0,.25,6,1.5),new u.A("circle",100,.01,1,0,.25,7,1.5)])},this.addPresetCollection=(t,e,s,n)=>{const o=(0,a.T)("div"),r=(0,a.T)("div",{className:"toggle"}),h=(0,a.Ay)("brush-editor-presets-ss-content").hasChildNodes()?"subline top-10":"subline";o.append((0,a.T)("input",{type:"checkbox",className:"toggle-check",checked:!0,id:"brush-pack-"+t}),(0,a.T)("label",{className:h,htmlFor:"brush-pack-"+t},e,(0,a.T)("span",{className:"arrow"})),r);const c=new l.A(new u.A);n.forEach((t=>{const e=(0,a.T)("div",{className:"brush-setting-pod"});e.setAttribute("data",JSON.stringify(t)),e.addEventListener("click",this.selectPreset,!0),e.appendChild((0,a.T)("span",{},t.size.toString())),t.size>30&&(t.size=30),c.settings=t,c.generate();const s=i.oM(c.canvas);s.classList.add("ic"),e.appendChild(s),r.append(e)})),(0,a.Ay)("brush-editor-presets-ss-content").append(o)},this.selectPreset=t=>{var e;null===(e=this.selected)||void 0===e||e.classList.remove("active"),this.selected=t.currentTarget,this.selected.classList.add("active"),this.brush.setSettingsString(this.selected.getAttribute("data")),this.size.setValue(this.brush.settings.size),this.softness.setValue(this.brush.settings.softness),this.distance.setValue(this.brush.settings.distance),this.angle.value=Math.round(this.brush.settings.angle)+"°",this.updatePreview(!1)},this.resizeStart=t=>{this.down=new r.A(this.container.clientHeight,t.y)},this.resizeMove=t=>{const e=this.down.x+(t.y-this.down.y);this.container.style.height=(e<320?320:e)+"px"},this.cleanUp=()=>{this.angle.removeEventListener("input",this.angleChange,!0),this.raster.removeEventListener("mousedown",this.rasterDown,!1),this.brushpod.update(),this.size.cleanUp(),this.softness.cleanUp(),this.distance.cleanUp(),this.container.remove(),this.modal.remove()},this.brushpod=e,this.brush=e.brush,this.modal=this.stage.workspace.appendChild((0,a.T)("div",{id:"brush-editor-modal",className:"modal"}));let s=(0,a.T)("div",{className:"tab-10"}),p=(0,a.T)("div",{style:"flex-grow:1"});this.presets=(0,a.T)("div",{id:"brush-editor-presets",className:"brush-editor-presets"}),this.container=(0,a.T)("div",{id:"brush-editor",className:"brush-editor"},(0,a.T)("div",{id:"brush-editor-top",className:"brush-editor-top"},s,p),this.presets),this.stage.workspace.appendChild(this.container),this.preview=(0,a.T)("canvas",{id:"brush-preview",className:"brush-preview ic",width:120,height:120}),this.raster=(0,a.T)("canvas",{id:"brush-raster",className:"brush-raster ic",width:120,height:120}),this.stroke=(0,a.T)("canvas",{id:"brush-stroke",className:"brush-stroke ic",width:252,height:60});const g=(0,a.T)("div",{className:"switch-icon-field stretch",style:"display:none"},(0,a.T)("input",{type:"radio",id:"brush-shape-circle",name:"brush-shape",value:"circle"}),(0,a.T)("label",{htmlFor:"brush-shape-circle"},(0,a.T)("img",{src:"/img/icon/type-circle.svg",className:"ic"})),(0,a.T)("input",{type:"radio",id:"brush-shape-square",name:"brush-shape",value:"square"}),(0,a.T)("label",{htmlFor:"brush-shape-square"},(0,a.T)("img",{src:"/img/icon/type-square.svg",className:"ic"})),(0,a.T)("input",{type:"radio",id:"brush-shape-diamond",name:"brush-shape",value:"diamond"}),(0,a.T)("label",{htmlFor:"brush-shape-diamond"},(0,a.T)("img",{src:"/img/icon/type-diamond.svg",className:"ic"})));s.append((0,a.T)("div",{style:"display:flex;width:"},(0,a.T)("div",{className:"brush-preview-holder"},this.preview),(0,a.T)("div",{className:"brush-raster-holder"},this.raster)),(0,a.T)("div",{className:"brush-stroke-holder"},this.stroke),g,(0,a.T)("input",{id:"brush-angle",type:"text",style:"padding:0px !important;width:30px !important;height:14px !important;font-size:10px;display:block;position:absolute;top:117px;right:12px;border:none !important;background:none !important;text-align:right;"})),p.append((0,a.T)("div",{style:"height:122px;",className:"brush-control-holder"},(0,a.T)("div",{id:"brush-size"}),(0,a.T)("div",{id:"brush-softness",className:"top-4"}))),p.append((0,a.T)("div",{style:"height:62px;margin-top:10px",className:"brush-control-holder"},(0,a.T)("div",{id:"brush-step"}))),new d.A(this.presets);const m=(0,a.T)("img",{id:"brush-resize",src:"/img/icon/three-dot.svg",className:"resize ic"});(0,a.Bb)(m,this.resizeStart,this.resizeMove),this.container.append(m),this.setUp()}}class g{constructor(t,e,s,o){this.stage=t,this.stepSoftness=t=>{this.brush.settings.softness=i.qE(this.brush.settings.softness+t,0,1),this.brush.generate(),this.update()},this.stepSize=t=>{this.brush.settings.size=i.qE(this.brush.settings.size+t,1,999),this.brush.generate(),this.update()},this.update=(t=!0)=>{let e=this.preview.getContext("2d");e.imageSmoothingQuality="high",e.imageSmoothingEnabled=!0,e.clearRect(0,0,e.canvas.width,e.canvas.height);const s=n.A.bestFit(this.brush.canvas.width,this.brush.canvas.height,e.canvas.width,e.canvas.height);e.drawImage(this.brush.canvas,s.x,s.y,s.width,s.height),this.size.innerText=this.brush.settings.size.toString(),t&&this.callback&&this.callback(this.brush)},this.toggle=()=>{new p(this.stage,this)},this.cleanUp=()=>{this.container.setAttribute("data",this.brush.getSettingsString()),this.container.removeEventListener("click",this.toggle,!1)},this.name=e,this.brush=s,this.callback=o,this.container=(0,a.Ay)(e),this.container.hasChildNodes()?(this.preview=(0,a.Ay)(e+"-canvas"),this.size=(0,a.Ay)(e+"-size"),this.container.hasAttribute("data")&&this.brush.setSettingsString(this.container.getAttribute("data"))):(this.container.classList.add("brush-pod"),this.preview=(0,a.T)("canvas",{id:e+"-canvas",width:32,height:32,className:"ic"}),this.container.append(this.preview),this.size=(0,a.T)("div",{id:e+"-size"}),this.container.append((0,a.T)("div",{id:e+"-hold"},this.size,(0,a.T)("img",{id:e+"-more",src:"/img/icon/more.svg",className:"ic"})))),this.container.addEventListener("click",this.toggle,!1),this.update(!1)}}},8689:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(42268),a=s(15818),n=s(51787),o=s(29755);class r{constructor(t,e,s,r,h=!1,l=!1,c=!0){this.previewColor=t=>{this.setColor(t),this.preview&&this.preview(this.color)},this.callbackColor=t=>{this.setColor(t),(0,o.oY)(t),this.callback&&this.callback(this.color)},this.setColor=t=>{var e,s,i,n;t?(t instanceof a.A?this.color=t:this.color=a.A.fromHEX(t),(null!==(e=this.holder)&&void 0!==e?e:this.container).classList.remove("empty"),(null!==(s=this.holder)&&void 0!==s?s:this.container).style.backgroundColor=this.color.toHEX()):(this.color=void 0,(null!==(i=this.holder)&&void 0!==i?i:this.container).classList.add("empty"),(null!==(n=this.holder)&&void 0!==n?n:this.container).style.backgroundColor="unset")},this.getColor=()=>this.color,this.picker=()=>{new n.A(this.container,this.color,this.callbackColor,this.previewColor,this.canBeEmpty,this.showPick)},this.cleanUp=()=>{this.container.removeEventListener("click",this.picker,!1)},this.preview=r,this.callback=s,this.canBeEmpty=h,this.showPick=c,this.container=(0,i.Ay)(t),this.container.classList.add("color-pod"),this.container.addEventListener("click",this.picker,!1),l&&(this.container.classList.add("dodrop"),this.container.hasChildNodes()?this.holder=(0,i.Ay)(t+"-holder"):(this.holder=(0,i.T)("div",{id:t+"-holder"}),this.container.appendChild(this.holder))),this.setColor(e)}}},74785:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(54738),a=s(41915),n=s(29755),o=s(15818),r=s(42268);class h{constructor(t,e,s,h=!1,l=!0,c=!1,d){var u,p;if(this.activeColorPick=async t=>{if((0,r.Ay)("modal-color-select"))return;this.colorPreview=(0,r.T)("div",{className:"color-selector-preview",style:"display:none;"});const e=(0,r.T)("div",{id:"modal-color-select",style:"cursor:crosshair;",className:"modal"},this.colorPreview);e.addEventListener("click",this.removeColorPicker,!0),e.addEventListener("mousemove",this.pickerPreviewColor,!0),document.body.appendChild(e);const s=document.getElementsByClassName("canvas");for(var a=0;a<s.length;a++)if(await(0,r.J9)(s[a])){this.stageCRect=s[a].getBoundingClientRect(),this.stageCanvas=i.oM(s[a]);break}if(!this.stageCanvas){let t=document.getElementsByClassName("canvas")[0];this.stageCRect=t.getBoundingClientRect(),this.stageCanvas=i.oM(t)}this.stageCanvasCTX=this.stageCanvas.getContext("2d")},this.pickerPreviewColor=t=>{if(!this.stageCanvas)return;let e=new a.A(t.clientX,t.clientY);this.colorPreview.style.top=e.y-60+"px",this.colorPreview.style.left=e.x+10+"px",this.colorPreview.style.display="block";const s=n.Ay.isHDPI?2:1;if(e.x=(e.x-this.stageCRect.left)*s,e.y=(e.y-this.stageCRect.top)*s,e.x<0||e.y<0||e.x>this.stageCRect.width*s||e.y>this.stageCRect.height*s)return void(this.colorPreview.style.display="none");let i=this.stageCanvasCTX.getImageData(e.x,e.y,1,1).data;this.colorPreview.style.backgroundColor=new o.A(i[0],i[1],i[2]).toHEX()},this.removeColorPicker=t=>{(0,r.Ay)("modal-color-select").remove(),this.colorPreview=null;let e=new a.A(t.clientX,t.clientY);const s=n.Ay.isHDPI?2:1;if(e.x=(e.x-this.stageCRect.left)*s,e.y=(e.y-this.stageCRect.top)*s,e.x<0||e.y<0||e.x>this.stageCRect.width*s||e.y>this.stageCRect.height*s)return;let i=this.stageCanvasCTX.getImageData(e.x,e.y,1,1).data,h=new o.A(i[0],i[1],i[2]);this.setHex(h.toHEX(),!0),this.updateColor(!0)},this.satMouseDown=t=>{t.stopPropagation(),document.addEventListener("mousemove",this.satMouseMove,!0),document.addEventListener("mouseup",this.satMouseUp,!0);var e=this.satSlide.getBoundingClientRect(),s=t.pageX-e.left,i=t.pageY-e.top;this.selectSat(s,i)},this.satMouseMove=t=>{t.stopPropagation();var e=this.satSlide.getBoundingClientRect(),s=t.pageX-e.left,i=t.pageY-e.top;this.selectSat(s,i)},this.satMouseUp=t=>{t.stopPropagation(),document.removeEventListener("mousemove",this.satMouseMove,!0),document.removeEventListener("mouseup",this.satMouseUp,!0)},this.satTouchStart=t=>{t.stopPropagation(),document.addEventListener("touchmove",this.satTouchMove,{passive:!1}),document.addEventListener("touchend",this.satTouchEnd,{passive:!1});var e=this.satSlide.getBoundingClientRect(),s=t.targetTouches[0].pageX-e.left,i=t.targetTouches[0].pageY-e.top;this.selectSat(s,i)},this.satTouchMove=t=>{t.stopPropagation();var e=this.satSlide.getBoundingClientRect(),s=t.targetTouches[0].pageX-e.left,i=t.targetTouches[0].pageY-e.top;this.selectSat(s,i)},this.satTouchEnd=t=>{t.stopPropagation(),document.removeEventListener("touchmove",this.satTouchMove),document.removeEventListener("touchend",this.satTouchEnd)},this.selectSat=(t,e)=>{t=i.qE(t,0,this.width),e=i.qE(e,0,this.height),this.hsb.s=t/this.width,this.hsb.b=1-e/this.height,this.setSat(),this.updateColor()},this.setSat=()=>{this.satKnob.style.left=this.hsb.s*this.width-9+"px",this.satKnob.style.top=(1-this.hsb.b)*this.height-9+"px"},this.hueMouseDown=t=>{t.stopPropagation(),document.addEventListener("mousemove",this.hueMouseMove,!0),document.addEventListener("mouseup",this.hueMouseUp,!0);var e=this.hueSlide.getBoundingClientRect(),s=t.pageX-e.left;this.selectHue(s)},this.hueMouseMove=t=>{t.stopPropagation();var e=this.hueSlide.getBoundingClientRect(),s=t.pageX-e.left;this.selectHue(s)},this.hueMouseUp=t=>{t.stopPropagation(),document.removeEventListener("mousemove",this.hueMouseMove,!0),document.removeEventListener("mouseup",this.hueMouseUp,!0)},this.hueTouchStart=t=>{t.stopPropagation(),this.hueSlide.addEventListener("touchmove",this.hueTouchMove,{passive:!1}),document.addEventListener("touchend",this.hueTouchEnd,{passive:!1});var e=t.target.getBoundingClientRect(),s=t.targetTouches[0].pageX-e.left;this.selectHue(s)},this.hueTouchMove=t=>{t.stopPropagation();var e=t.target.getBoundingClientRect(),s=t.targetTouches[0].pageX-e.left;this.selectHue(s)},this.hueTouchEnd=t=>{t.stopPropagation(),this.hueSlide.removeEventListener("touchmove",this.hueTouchMove),document.removeEventListener("touchend",this.hueTouchEnd)},this.selectHue=t=>{t=i.qE(t,0,this.width),this.hsb.h=Math.round(t/this.width*360),this.setHue(),this.updateColor()},this.setHue=()=>{this.hueKnob.style.left=this.hsb.h/360*this.width-2+"px";let t=this.satSlide.getContext("2d");t.fillStyle=o.A.fromHSB(this.hsb.h,1,1).toHEX(),t.fillRect(0,0,this.satSlide.width,this.satSlide.height);var e=t.createLinearGradient(0,0,this.satSlide.width,0);e.addColorStop(0,"rgba(255,255,255,1)"),e.addColorStop(1,"rgba(255,255,255,0)"),t.fillStyle=e,t.fillRect(0,0,this.satSlide.width,this.satSlide.height);var s=t.createLinearGradient(0,0,0,this.satSlide.height);s.addColorStop(0,"rgba(0,0,0,0)"),s.addColorStop(1,"rgba(0,0,0,1)"),t.fillStyle=s,t.fillRect(0,0,this.satSlide.width,this.satSlide.height)},this.selectPod=t=>{var e;let s=t.currentTarget;if(s.classList.contains("selected")&&!this.extended)"block"==this.selector.style.display?this.selector.style.display="none":(this.selector.style.display="block",this.setHex(s.getAttribute("data")));else{if(null===(e=this.selected)||void 0===e||e.classList.remove("selected"),this.selected=s,this.selected.classList.add("selected"),this.selector.style.display="block","empty"===s.getAttribute("data"))return this.color=void 0,void(this.callback&&this.callback(void 0));this.setHex(s.getAttribute("data"),!0)}},this.updateColor=(t=!0,e=!0)=>{clearTimeout(this.setTimer),this.color=o.A.fromHSB(this.hsb.h,this.hsb.s,this.hsb.b);const s=this.color.toHEX();this.hexInput.value=s,e&&this.selected&&(this.selected.classList.contains("empty")&&(this.selected.classList.remove("selected"),this.selected=this.selected.nextElementSibling,this.selected.classList.add("selected")),this.selected.setAttribute("data",s),this.selected.style.backgroundColor=s),this.setTimer=setTimeout((()=>{this.callback&&t&&this.callback(this.color)}),50)},this.hexInputInput=t=>{/^#[0-9A-F]{6}$/i.test(this.hexInput.value)&&this.setHex(this.hexInput.value,!1)},this.hexInputBlur=t=>{/^#[0-9A-F]{6}$/i.test(this.hexInput.value)?this.setHex(this.hexInput.value,!0):this.hexInput.value=this.getHex()},this.setColor=(t,e=!1)=>{this.hsb=t.toHSB(),this.setHue(),this.setSat(),this.updateColor(e,!0)},this.setHex=(t,e=!1)=>this.setColor(o.A.fromHEX(t),e),this.getHex=()=>this.color.toHEX(),this.getColor=()=>this.color,this.color=e,this.holder=t,this.callback=s,this.height=120,this.extended=c,this.holder.innerHTML="",this.width=d||this.holder.getBoundingClientRect().width,this.selector=(0,r.T)("div",{className:"color-selector"}),c){if(this.presets=(0,r.T)("div",{className:"color-selector-presets"}),h){let t=(0,r.T)("div",{className:"color-pod square empty"});t.addEventListener("click",this.selectPod,!1),t.setAttribute("data","empty"),this.color||(t.classList.add("selected"),this.selected=t),this.presets.appendChild(t)}let t=[...n.Ay.oldColor.slice(),"#ffffff","#888888","#000000"];for(let e=0;e<t.length;++e){let s=(0,r.T)("div",{className:"color-pod square"});s.addEventListener("click",this.selectPod,!1),s.style.backgroundColor=t[e],s.setAttribute("data",t[e]),this.presets.appendChild(s),0!==e||c||(this.selected=s,s.classList.add("selected"))}this.presets.classList.add("top-10"),this.holder.append(this.selector,(0,r.T)("div",{className:"splitter top-10"}),this.presets)}else this.holder.append(this.selector);let g=(0,r.T)("div",{className:"color-selector-sat",style:"width:"+this.width+"px; height:"+this.height+"px;"});this.selector.appendChild(g),this.satSlide=i.VI(this.width,this.height),this.satSlide.addEventListener("mousedown",this.satMouseDown,!1),this.satSlide.addEventListener("touchstart",this.satTouchStart,{passive:!1}),this.satSlide.classList.add("color-selector-sat-slide"),g.appendChild(this.satSlide),this.satKnob=document.createElement("div"),this.satKnob.classList.add("color-selector-sat-knob","ic"),g.appendChild(this.satKnob);let m=document.createElement("div");m.classList.add("color-selector-hue"),m.style.width=this.width+"px",this.selector.appendChild(m),this.hueSlide=document.createElement("div"),this.hueSlide.style.width=this.width+"px",this.hueSlide.addEventListener("mousedown",this.hueMouseDown,!1),this.hueSlide.addEventListener("touchstart",this.hueTouchStart,{passive:!1}),this.hueSlide.classList.add("color-selector-hue-slide"),m.appendChild(this.hueSlide),this.hueKnob=document.createElement("div"),this.hueKnob.classList.add("color-selector-hue-knob","ic"),m.appendChild(this.hueKnob);let v=(0,r.T)("div",{className:"color-selector-bar"});if(!c){if(h){let t=(0,r.T)("div",{className:"color-pod empty"});t.addEventListener("click",this.selectPod,!1),t.setAttribute("data","empty"),this.color||(this.selected=t),v.appendChild(t)}let t=(0,r.T)("div",{className:"color-pod"});t.addEventListener("click",this.selectPod,!1),v.appendChild(t),h&&!this.color||(this.selected=t)}if(this.hexInput=(0,r.T)("input",{type:"text",spellcheck:!1,maxLength:7,style:"width:90px;text-transform:uppercase;"}),this.hexInput.addEventListener("input",this.hexInputInput,!1),this.hexInput.addEventListener("blur",this.hexInputBlur,!1),v.appendChild(this.hexInput),l){let t=(0,r.T)("div",{className:"icon-button",style:"margin-left:auto;"},(0,r.T)("img",{src:"/img/tool/picker.svg",className:"ic"}));t.addEventListener("click",this.activeColorPick,!1),v.appendChild(t)}this.selector.appendChild(v),this.hsb=o.A.fromHEX(null!==(p=null===(u=this.color)||void 0===u?void 0:u.toHEX())&&void 0!==p?p:"#ffffff").toHSB(),this.setHue(),this.setSat(),this.updateColor(!1,!!this.color),this.color=e}}},21079:(t,e,s)=>{s.d(e,{Ay:()=>o,K5:()=>n,kt:()=>a});var i=s(42268);class a{constructor(t,e,s,i,a){this.name=t,this.callback=e,this.short=s,this.icon=i,this.sub=a}}class n extends a{constructor(){super()}}class o{constructor(t,e,s=!1){this.addItem=(t,e)=>{if(t.name)if(t.sub){const s=(0,i.T)("ul"),a=(0,i.T)("li",{className:"more"},t.icon?(0,i.T)("img",{src:t.icon}):"",t.name,s);for(const e of t.sub)this.addItem(e,s);e.append(a)}else t.callback?e.appendChild((0,i.T)("li",{onclick:()=>{t.callback(),this.cleanUp()}},t.icon?(0,i.T)("img",{src:t.icon}):"",t.name,t.short?(0,i.T)("span",{},t.short):"")):e.appendChild((0,i.T)("li",{className:"disabled"},t.icon?(0,i.T)("img",{src:t.icon}):"",t.name,t.short?(0,i.T)("span",{},t.short):""));else e.appendChild((0,i.T)("li",{className:"split"}))},this.cleanUp=()=>{this.holder.removeEventListener("mouseleave",this.cleanUp),this.holder.remove(),this.holder=void 0,this.id=void 0},this.id=Math.round(99999999999999*Math.random()).toString(),this.holder=(0,i.T)("div",{id:this.id,className:"overflow-menu-holder"}),this.holder.addEventListener("contextmenu",(t=>(t.stopPropagation(),t.preventDefault(),!1))),this.holder.style.display="block",this.holder.style.left=s?t.x-235+"px":t.x-5+"px",this.list=(0,i.T)("ul",{className:"overflow-menu"}),this.holder.appendChild(this.list);for(const i of e)this.addItem(i,this.list);this.holder.addEventListener("mouseleave",this.cleanUp);const a="none"===(0,i.Ay)("splash").style.display?(0,i.Ay)("workspace"):(0,i.Ay)("splash");a.appendChild(this.holder),t.y+this.holder.clientHeight>a.scrollHeight?this.holder.style.top=t.y+5-this.holder.clientHeight+"px":this.holder.style.top=t.y-5+"px"}}},27500:(t,e,s)=>{s.d(e,{A:()=>o});var i=s(42268),a=s(21742),n=s(26806);class o extends n.A{constructor(){super((0,a.A)("dialogChoiceTitle"),!0),this.init=()=>new Promise(((t,e)=>{const s=this.content.querySelector("#open-as-new"),i=this.content.querySelector("#open-in-current");this.cancel=()=>{this.cleanUp(),t("close")},s.onclick=()=>{this.cleanUp(),t("create")},i.onclick=()=>{this.cleanUp(),t("layer")}})),this.setContent(`    \n            ${(0,a.A)("dialogChoiceHeadline")}\n            <ul class="push-buttons top-20" style="text-align: center">\n                <li id="open-as-new">\n                    <img src="/img/icon/document-new.svg" class="ic" />\n                    <span>${(0,a.A)("createNew")}</span>\n                </li>\n                <li id="open-in-current">\n                    <img src="/img/icon/document-add.svg" class="ic" />\n                    <span>${(0,a.A)("addCurrent")}</span>\n                </li>\n            </ul>\n        `),(0,i.Ay)("dialog-buttons"+this.mid).style.display="none"}}},86344:(t,e,s)=>{s.d(e,{A:()=>d});var i=s(42268),a=s(21742),n=s(26806),o=s(54738),r=s(40963),h=s(98244),l=s(23556),c=s(38665);class d extends n.A{constructor(t){super((0,a.A)("dialogAiCutoutTitle")),this.interupt=!1,this.run=async()=>{try{let t=this.stage.fresco.getSelected();const e=o.ON(t.mask),s=await(0,c.P)(t.canvas);if(this.interupt)return;const i=o.k8(s,1080);t.addMask();const a=new l.A;a.addShader("alpha-shift-mask",!0);t.mask.getContext("2d").drawImage(a.apply(i),0,0,t.mask.width,t.mask.height),t.render(),this.stage.render(),this.stage.history.add({type:"mask",layer:t,rect:new r.A(0,0,t.mask.width,t.mask.height),patch:e}),this.cleanUp()}catch(t){console.error(t),(0,i.Ay)("ai-icon").src="/img/icon/ai-err.svg",(0,i.Ay)("dialog-cancel"+this.mid).innerText=(0,a.A)("close"),(0,i.Ay)("ai-load").style.display="none",(0,i.Ay)("ai-message").innerText=window.navigator.onLine?(0,a.A)("genericError"):(0,a.A)("genericOffline")}},this.cancel=()=>{this.interupt=!0,this.cleanUp()},this.stage=t,this.dialog.style.width="300px",this.dialog.style.maxWidth="300px",this.setContent('\n            <img src="/img/icon/ai.svg" id="ai-icon" class="ic">\n            <div id="ai-load" class="ai-load"><div class="dot-floating"></div></div> \n            <div id="ai-message" class="top-20">Machines are doing their thing, please wait ..</div>\n        '),(0,i.Ay)("dialog-apply"+this.mid).style.display="none",(0,h.A)("run-ai-cutout"),this.run()}}},37694:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(42268),a=s(21742),n=s(26806),o=s(53900),r=s(79453);class h extends n.A{constructor(t){super((0,a.A)("dialogCanvasResizeTitle")),this.anchorChange=t=>{let e=t.currentTarget,s=(0,i.Ay)("anchor-grid").getElementsByClassName("box");for(var a=0;a<s.length;a++)s[a].classList.remove("selected");e.classList.add("selected"),this.anchor=e.getAttribute("data")},this.changecanvasRelative=()=>{let t=(0,i.Ay)("canvas-size-width"),e=(0,i.Ay)("canvas-size-height");(0,i.Ay)("canvas-size-relative").checked?(t.value="0",e.value="0"):(t.value=this.stage.fresco.width.toString(),e.value=this.stage.fresco.height.toString())},this.apply=()=>{let t=Number((0,i.Ay)("canvas-size-width").value),e=Number((0,i.Ay)("canvas-size-height").value),s=(0,i.Ay)("canvas-size-relative").checked;const a=new o.A(this.stage.fresco.width,this.stage.fresco.height);this.stage.fresco.size(t,e,s,this.anchor),this.stage.history.add({type:"pageSize",anchor:this.anchor,size:a}),this.stage.updateViewport(),document.dispatchEvent(new CustomEvent("layer-arrange")),this.cleanUp()},this.stage=t,this.maxSize=(null===r.N||void 0===r.N?void 0:r.N.subscription)?8192:4096,this.setContent(`\n            <label class="split">${(0,a.A)("width")} <input type="number" id="canvas-size-width"/></label>\n            <label class="split top-10">${(0,a.A)("height")} <input type="number" id="canvas-size-height"/></label>\n        \n            <input type="checkbox" id="canvas-size-relative" />\n            <label class="switch top-20" for="canvas-size-relative">${(0,a.A)("dialogResizeRelative")}<span></span></label>\n        \n            <label class="split top-20">${(0,a.A)("anchor")}\n                <div id="anchor-grid" class="anchor-grid">\n                    <div class="row">\n                        <div data="TL" class="box"></div>\n                        <div data="TC" class="box"></div>\n                        <div data="TR" class="box"></div>\n                    </div>\n                    <div class="row">\n                        <div data="CL" class="box"></div>\n                        <div data="CC" class="box selected"></div>\n                        <div data="CR" class="box"></div>\n                    </div>\n                    <div class="row">\n                        <div data="BL" class="box"></div>\n                        <div data="BC" class="box"></div>\n                        <div data="BR" class="box"></div>\n                    </div>\n                </div>\n            </label>\n            <div class="top-20"></div>\n        `),(0,i.Ay)("canvas-size-width").value=this.stage.fresco.width.toString(),(0,i.Ay)("canvas-size-height").value=this.stage.fresco.height.toString(),(0,i.Ay)("canvas-size-relative").addEventListener("input",this.changecanvasRelative,!1);let e=(0,i.Ay)("anchor-grid").getElementsByClassName("box");for(var s=0;s<e.length;s++)e[s].addEventListener("click",this.anchorChange,!1);this.anchor="CC"}}},96785:(t,e,s)=>{s.d(e,{A:()=>c});var i=s(21742),a=s(26806),n=s(42268),o=s(54738),r=s(15818),h=s(41915),l=s(29755);class c extends a.A{constructor(t,e,s){super((0,i.A)("titleColorPicker"),!1),this.hue=0,this.sat=0,this.bri=1,this.setHistory=t=>{let e=r.A.fromRGB(t.currentTarget.style.backgroundColor);this.setColor(e)},this.pickerPreviewColor=t=>{let e=new h.A(t.clientX,t.clientY);this.colorPreview.style.top=e.y-50+"px",this.colorPreview.style.left=e.x+10+"px",this.colorPreview.style.display="block";const s=l.Ay.isHDPI?2:1;if(e=new h.A((t.clientX-this.stageC.offsetLeft)*s,(t.clientY-this.stageC.offsetTop)*s),t.target!==this.modal||e.x<0||e.y<0||e.x>this.stageC.width||e.y>this.stageC.height)return void(this.colorPreview.style.display="none");let i=this.stageCanvasCTX.getImageData(e.x,e.y,1,1).data;this.colorPreview.style.backgroundColor=new r.A(i[0],i[1],i[2]).toHEX()},this.pickerPreviewLeave=()=>{this.colorPreview.style.display="none"},this.pickerSetColor=t=>{const e=l.Ay.isHDPI?2:1;let s=new h.A((t.clientX-this.stageC.offsetLeft)*e,(t.clientY-this.stageC.offsetTop)*e);if(t.target!==this.modal||s.x<0||s.y<0||s.x>this.stageC.width||s.y>this.stageC.height)return;let i=this.stageCanvasCTX.getImageData(s.x,s.y,1,1).data;this.setColor(new r.A(i[0],i[1],i[2]))},this.satMouseDown=t=>{t.stopPropagation(),document.addEventListener("mousemove",this.satMouseMove,!0),document.addEventListener("mouseup",this.satMouseUp,!0);var e=this.satSlide.getBoundingClientRect(),s=t.pageX-e.left,i=t.pageY-e.top;this.selectSat(s,i)},this.satMouseMove=t=>{t.stopPropagation();var e=this.satSlide.getBoundingClientRect(),s=t.pageX-e.left,i=t.pageY-e.top;this.selectSat(s,i)},this.satMouseUp=t=>{t.stopPropagation(),document.removeEventListener("mousemove",this.satMouseMove,!0),document.removeEventListener("mouseup",this.satMouseUp,!0)},this.satTouchStart=t=>{t.stopPropagation(),document.addEventListener("touchmove",this.satTouchMove,!0),document.addEventListener("touchend",this.satTouchEnd,!0);var e=this.satSlide.getBoundingClientRect(),s=t.targetTouches[0].pageX-e.left,i=t.targetTouches[0].pageY-e.top;this.selectSat(s,i)},this.satTouchMove=t=>{t.stopPropagation();var e=this.satSlide.getBoundingClientRect(),s=t.targetTouches[0].pageX-e.left,i=t.targetTouches[0].pageY-e.top;this.selectSat(s,i)},this.satTouchEnd=t=>{t.stopPropagation(),document.removeEventListener("touchmove",this.satTouchMove,!0),document.removeEventListener("touchend",this.satTouchEnd,!0)},this.selectSat=(t,e)=>{t=o.qE(t,0,256),e=o.qE(e,0,256),this.sat=t/256,this.bri=1-e/256,this.setSatKnob(),this.calculateColor()},this.setSatKnob=()=>{this.satKnob.style.left=256*this.sat-9+"px",this.satKnob.style.top=256*(1-this.bri)-9+"px"},this.hueMouseDown=t=>{t.stopPropagation(),document.addEventListener("mousemove",this.hueMouseMove,!0),document.addEventListener("mouseup",this.hueMouseUp,!0);var e=this.hueSlide.getBoundingClientRect();this.selectHue(t.pageY-e.top)},this.hueMouseMove=t=>{t.stopPropagation();var e=this.hueSlide.getBoundingClientRect();this.selectHue(t.pageY-e.top)},this.hueMouseUp=t=>{t.stopPropagation(),document.removeEventListener("mousemove",this.hueMouseMove,!0),document.removeEventListener("mouseup",this.hueMouseUp,!0)},this.hueTouchStart=t=>{t.stopPropagation(),this.hueSlide.addEventListener("touchmove",this.hueTouchMove,!0),document.addEventListener("touchend",this.hueTouchEnd,!0);var e=t.target.getBoundingClientRect();this.selectHue(t.targetTouches[0].pageY-e.top)},this.hueTouchMove=t=>{t.stopPropagation();var e=t.target.getBoundingClientRect();this.selectHue(t.targetTouches[0].pageY-e.top)},this.hueTouchEnd=t=>{t.stopPropagation(),this.hueSlide.removeEventListener("touchmove",this.hueTouchMove,!0),document.removeEventListener("touchend",this.hueTouchEnd,!0)},this.selectHue=t=>{t=o.qE(t,0,256),this.hue=Math.round(359-t/256*359),this.setHueKnob(),this.calculateColor()},this.setHueKnob=()=>{this.hueKnob.style.top=252-this.hue/359*254+"px";let t=this.satSlide.getContext("2d");t.fillStyle=r.A.fromHSB(this.hue,1,1).toHEX(),t.fillRect(0,0,this.satSlide.width,this.satSlide.height);var e=t.createLinearGradient(0,0,this.satSlide.width,0);e.addColorStop(0,"rgba(255,255,255,1)"),e.addColorStop(1,"rgba(255,255,255,0)"),t.fillStyle=e,t.fillRect(0,0,this.satSlide.width,this.satSlide.height);var s=t.createLinearGradient(0,0,0,this.satSlide.height);s.addColorStop(0,"rgba(0,0,0,0)"),s.addColorStop(1,"rgba(0,0,0,1)"),t.fillStyle=s,t.fillRect(0,0,this.satSlide.width,this.satSlide.height)},this.calculateColor=()=>{this.color=r.A.fromHSB(this.hue,this.sat,this.bri);var t=document.activeElement;this.hexInput.value=this.color.toHEX(),t!==this.hueInput&&(this.hueInput.value=Math.round(this.hue).toString()),t!==this.satInput&&(this.satInput.value=Math.round(100*this.sat).toString()),t!==this.briInput&&(this.briInput.value=Math.round(100*this.bri).toString()),t!==this.redInput&&(this.redInput.value=this.color.r.toString()),t!==this.greenInput&&(this.greenInput.value=this.color.g.toString()),t!==this.blueInput&&(this.blueInput.value=this.color.b.toString()),this.selected.style.backgroundColor=this.color.toRGBA(),this.preview&&o.sg("preview",50,(()=>{this.preview(this.color)}))},this.hexInputChange=t=>{/^#[0-9A-F]{6}$/i.test(this.hexInput.value)&&this.setColor(r.A.fromHEX(this.hexInput.value))},this.hueInputChange=t=>{this.hue=o.qE(parseInt(this.hueInput.value),0,359),this.setHueKnob(),this.calculateColor()},this.satInputChange=t=>{this.sat=o.qE(parseInt(this.satInput.value),0,100)/100,this.setSatKnob(),this.calculateColor()},this.briInputChange=t=>{this.bri=o.qE(parseInt(this.briInput.value),0,100)/100,this.setSatKnob(),this.calculateColor()},this.redInputChange=t=>{this.color.r=o.qE(parseInt(this.redInput.value),0,255),this.setColor(this.color)},this.greenInputChange=t=>{this.color.g=o.qE(parseInt(this.greenInput.value),0,255),this.setColor(this.color)},this.blueInputChange=t=>{this.color.b=o.qE(parseInt(this.blueInput.value),0,255),this.setColor(this.color)},this.setColor=t=>{this.color=null!=t?t:new r.A;let e=Math.min(this.color.r,this.color.g,this.color.b),s=Math.max(this.color.r,this.color.g,this.color.b);this.bri=s/255;var i=s-e;i?(this.sat=i/s,this.color.r==s?this.hue=(this.color.g-this.color.b)/i*60:this.color.g==s?this.hue=60*(2+(this.color.b-this.color.r)/i):this.hue=60*(4+(this.color.r-this.color.g)/i),this.hue>360?this.hue-=360:this.hue<0&&(this.hue+=360),360===this.hue&&(this.hue=0)):this.hue=this.sat=0,this.setHueKnob(),this.setSatKnob(),this.calculateColor()},this.getColor=()=>this.color,this.getHex=()=>this.color.toHEX(),this.cancel=()=>{this.preview&&this.preview(this.current),this.cleanUp()},this.apply=()=>{this.callback&&(this.preview&&this.preview(this.current),(0,l.oY)(this.color),this.callback(this.color)),this.cleanUp()},this.cleanUp=()=>{document.dispatchEvent(new CustomEvent("viewport-render")),(0,n.Ay)("color-picker-history").querySelectorAll(".color-pod").forEach((t=>t.removeEventListener("click",this.setHistory))),this.satSlide.removeEventListener("mousedown",this.satMouseDown,!1),this.satSlide.removeEventListener("touchstart",this.satTouchStart),this.hueSlide.removeEventListener("mousedown",this.hueMouseDown,!1),this.hueSlide.removeEventListener("touchstart",this.hueTouchStart),this.hexInput.removeEventListener("input",this.hexInputChange,!1),this.hueInput.removeEventListener("input",this.hueInputChange,!1),this.satInput.removeEventListener("input",this.satInputChange,!1),this.briInput.removeEventListener("input",this.briInputChange,!1),this.redInput.removeEventListener("input",this.redInputChange,!1),this.greenInput.removeEventListener("input",this.greenInputChange,!1),this.blueInput.removeEventListener("input",this.blueInputChange,!1),this.modal.removeEventListener("mousedown",this.pickerSetColor,!0),this.modal.removeEventListener("mousemove",this.pickerPreviewColor,!0),this.modal.removeEventListener("mouseleave",this.pickerPreviewLeave,!0),document.removeEventListener("keydown",this.keyDown,!1),this.stageCanvasCTX=void 0,this.stageCanvas=void 0,this.stageC=void 0,this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.preview=s,this.callback=e,this.dialog.style.width="500px",this.dialog.style.minWidth="500px",this.content.style.paddingBottom="10px",(0,n.Ay)("dialog-apply"+this.mid).innerText=(0,i.A)("ok"),this.setContent('\n            <div id="color-picker-selector">\n                <div id="color-picker-sat">\n                    <canvas id="color-picker-sat-slide"></canvas>\n                    <div id="color-picker-sat-knob" class="ic"></div>\n                </div>\n                <div id="color-picker-hue">\n                    <div id="color-picker-hue-slide"></div>\n                    <div id="color-picker-hue-knob" class="ic"></div>\n                </div>\n                <div id="color-picker-etc">\n                    <div id="color-picker-new"></div>\n                    <div id="color-picker-current"></div>\n\n                    <div id="color-picker-inputs">\n                        <div>\n                            <div>H:<input type="number"id="picker-input-hue"></div>\n                            <div>S:<input type="number"id="picker-input-sat"></div>\n                            <div>B:<input type="number"id="picker-input-bri"></div>\n                        </div>\n                        <div>\n                            <div>R:<input type="number"id="picker-input-red"></div>\n                            <div>G:<input type="number"id="picker-input-green"></div>\n                            <div>B:<input type="number"id="picker-input-blue"></div>\n                        </div>\n                    </div>\n                    <div id="color-picker-hex">\n                        HEX:<input type="text" spellcheck="false" maxlength="7" id="picker-input-hex">\n                    </div>\n                 </div>\n            </div>\n        ');let a=(0,n.T)("div",{id:"color-picker-history",className:"color-pod-list"});(0,n.Ay)("dialog-buttons"+this.mid).prepend(a),l.Ay.oldColor.forEach((t=>{let e=(0,n.T)("div",{className:"color-pod small"});e.style.backgroundColor=t,a.append(e)})),(0,n.Ay)("color-picker-history").querySelectorAll(".color-pod").forEach((t=>t.addEventListener("click",this.setHistory))),this.selected=(0,n.Ay)("color-picker-new"),this.selector=(0,n.Ay)("color-picker-selector"),this.satSlide=(0,n.Ay)("color-picker-sat-slide"),this.satKnob=(0,n.Ay)("color-picker-sat-knob"),this.hueSlide=(0,n.Ay)("color-picker-hue-slide"),this.hueKnob=(0,n.Ay)("color-picker-hue-knob"),this.satSlide.addEventListener("mousedown",this.satMouseDown,!1),this.satSlide.addEventListener("touchstart",this.satTouchStart,{passive:!1}),this.hueSlide.addEventListener("mousedown",this.hueMouseDown,!1),this.hueSlide.addEventListener("touchstart",this.hueTouchStart,{passive:!1}),this.hexInput=(0,n.Ay)("picker-input-hex"),this.hexInput.addEventListener("input",this.hexInputChange,!1),this.hueInput=(0,n.Ay)("picker-input-hue"),this.hueInput.addEventListener("input",this.hueInputChange,!1),this.satInput=(0,n.Ay)("picker-input-sat"),this.satInput.addEventListener("input",this.satInputChange,!1),this.briInput=(0,n.Ay)("picker-input-bri"),this.briInput.addEventListener("input",this.briInputChange,!1),this.redInput=(0,n.Ay)("picker-input-red"),this.redInput.addEventListener("input",this.redInputChange,!1),this.greenInput=(0,n.Ay)("picker-input-green"),this.greenInput.addEventListener("input",this.greenInputChange,!1),this.blueInput=(0,n.Ay)("picker-input-blue"),this.blueInput.addEventListener("input",this.blueInputChange,!1),this.modal.style.cursor="crosshair",this.colorPreview=(0,n.T)("div",{id:"color-picker-preview",style:"display:none"}),this.modal.appendChild(this.colorPreview),this.modal.addEventListener("mousedown",this.pickerSetColor,!0),this.modal.addEventListener("mousemove",this.pickerPreviewColor,!0),this.modal.addEventListener("mouseleave",this.pickerPreviewLeave,!0),this.stageC=document.getElementsByClassName("canvas")[0],this.stageCanvas=o.oM(this.stageC),this.stageCanvasCTX=this.stageCanvas.getContext("2d",{willReadFrequently:!0}),(0,n.Ay)("color-picker-current").style.backgroundColor=t?t.toHEX():"#ffffff",this.current=t,this.setColor(t)}}},97266:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(26806),a=s(42268);class n extends i.A{constructor(t,e,s,i,n){super(t,!0),this.init=()=>new Promise(((t,e)=>{this.cancel=()=>{this.cleanUp(),t(!1)},this.condition=()=>{this.cleanUp(),t(void 0)},this.apply=()=>{this.cleanUp(),t(!0)}})),this.setContent((0,a.T)("p",e)),s&&((0,a.Ay)("dialog-apply"+this.mid).innerText=s),i&&((0,a.Ay)("dialog-cancel"+this.mid).innerText=i),n&&(0,a.Ay)("dialog-cancel"+this.mid).before((0,a.T)("a",{id:"dialog-condition"+this.mid,className:"button negative",style:"margin-right:auto",onclick:()=>this.condition()},n))}}},26806:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(21742),a=s(54738),n=s(41915),o=s(29755),r=s(42268);class h{constructor(t,e=!0,s=!1){this.setContent=(...t)=>{t[0]instanceof HTMLElement?this.content.append(...t):this.content.innerHTML+=t[0],this.position()},this.disableApply=()=>{const t=(0,r.Ay)("dialog-apply"+this.mid);t.classList.add("disabled"),t.onclick=void 0},this.enableApply=()=>{const t=(0,r.Ay)("dialog-apply"+this.mid);t.classList.remove("disabled"),t.onclick=()=>this.apply()},this.disableCancel=()=>{const t=(0,r.Ay)("dialog-cancel"+this.mid);t.classList.add("disabled"),t.onclick=void 0},this.enableCancel=()=>{const t=(0,r.Ay)("dialog-cancel"+this.mid);t.classList.remove("disabled"),t.onclick=()=>this.cancel()},this.position=()=>{this.dialog.style.left=Math.round((this.modal.offsetWidth-this.dialog.offsetWidth)/2+o.Ay.dialogPos.x)+"px",this.dialog.style.top=Math.round((this.modal.offsetHeight-this.dialog.offsetHeight)/2+o.Ay.dialogPos.y)+"px";let t=this.dialog.getBoundingClientRect(),e=this.modal.getBoundingClientRect();t.bottom>e.bottom&&(this.dialog.style.top=e.height-t.height<0?"0px":e.height-t.height+"px"),t.right>e.right&&(this.dialog.style.left=e.width-t.width<0?"0px":e.width-t.width+"px"),this.dialog.offsetTop<0&&(this.dialog.style.top="0px"),this.dialog.offsetLeft<0&&(this.dialog.style.left="0px")},this.dragStart=t=>{this.p=t,this.d=new n.A(this.dialog.offsetLeft,this.dialog.offsetTop)},this.dragMove=t=>{this.dialog.style.left=Math.round(this.d.x+(t.x-this.p.x))+"px",this.dialog.style.top=Math.round(this.d.y+(t.y-this.p.y))+"px"},this.dragEnd=t=>{o.Ay.dialogPos.x=Math.round(this.dialog.offsetLeft-(this.modal.offsetWidth-this.dialog.offsetWidth)/2),o.Ay.dialogPos.y=Math.round(this.dialog.offsetTop-(this.modal.offsetHeight-this.dialog.offsetHeight)/2)},this.resizeStart=t=>{this.d=new n.A(this.dialog.clientHeight,t.y)},this.resizeMove=t=>{const e=this.d.x+(t.y-this.d.y);this.dialog.style.height=(e<320?320:e)+"px"},this.keyDown=t=>{27!=t.keyCode||"none"===(0,r.Ay)("dialog-cancel"+this.mid).style.display?13!=t.keyCode||"none"===(0,r.Ay)("dialog-apply"+this.mid).style.display||t.shiftKey||(0,r.Ay)("dialog-apply"+this.mid).classList.contains("disabled")||this.apply():this.cancel()},this.condition=()=>{this.cleanUp()},this.cancel=()=>{this.cleanUp()},this.apply=()=>{this.cleanUp()},this.mid=a.r0(),this.modal=(0,r.T)("div",{id:"modal-"+this.mid,className:"modal"}),e&&this.modal.classList.add("dim"),document.body.appendChild(this.modal),this.dialog=(0,r.T)("div",{className:"dialog"}),this.modal.appendChild(this.dialog),this.content=(0,r.T)("div",{className:"content"});const h=(0,r.T)("div",{id:"dialog-title"+this.mid,className:"title"},t);if(document.body.clientWidth>=650&&(0,r.Bb)(h,this.dragStart,this.dragMove,this.dragEnd),this.dialog.append(h,(0,r.T)("img",{id:"dialog-close"+this.mid,className:"close ic",src:"/img/icon/close.svg",onclick:()=>this.cancel()}),(0,r.T)("div",{id:"dialog-splitter"+this.mid,className:"splitter"}),this.content,(0,r.T)("div",{className:"buttons",id:"dialog-buttons"+this.mid},(0,r.T)("a",{id:"dialog-cancel"+this.mid,className:"button negative",onclick:()=>this.cancel()},(0,i.A)("cancel")),(0,r.T)("a",{id:"dialog-apply"+this.mid,className:"button positive",onclick:()=>this.apply()},(0,i.A)("apply")))),s){const t=(0,r.T)("img",{id:"resize-"+this.mid,src:"/img/icon/three-dot.svg",className:"resize ic"});(0,r.Bb)(t,this.resizeStart,this.resizeMove),this.dialog.append(t)}document.addEventListener("keydown",this.keyDown,!1)}cleanUp(){document.removeEventListener("keydown",this.keyDown,!1),this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null}}},87852:(t,e,s)=>{s.d(e,{A:()=>d});var i=s(21742),a=s(26806),n=s(42268),o=s(54738),r=s(98244),h=s(29755),l=s(79453),c=s(66718);class d extends a.A{constructor(t){var e;super((0,i.A)("errorReport")),this.stage=t,this.hide=()=>{this.modal.style.display="none"},this.show=()=>{this.modal.style.display="flex"},this.apply=async()=>{this.disableApply(),this.disableCancel();try{const t=new FormData;if(t.append("email",(0,n.Ay)(`email-${this.mid}`).value),t.append("platform",function(){const t=[navigator.userAgent,`Product: ${h.Ay.product}`],e=navigator.userAgentData;if(e){const s=e.brands.map((t=>`${t.brand}: ${t.version}`));s.push(`Platform: ${e.platform}`),s.push(`Mobile: ${e.mobile}`),t.push(s.join("\n"))}const s=navigator.deviceMemory;s&&t.push(`Main memory: ${s}`);return t.join("\n\n")}()),t.append("description",(0,n.Ay)(`description-${this.mid}`).value),(0,n.Ay)(`include-doc-${this.mid}`).checked){const e=await(0,c.Ab)(this.stage,{id:this.stage.fresco.id,name:"document",quality:.8,nonDestructive:!1,type:"document",unit:"pixel"});t.append("document",e,"document.pxd")}const e=(0,n.Ay)(`screenshot-canvas-${this.mid}`);if(e){const s=await new Promise((t=>e.toBlob(t,"image/jpeg",80)));t.append("screenshot",s,"screenshot.jpg")}await fetch("/api/error-report",{method:"POST",body:t});this.cleanUp()}catch(t){this.enableApply(),this.enableCancel(),console.error(t)}},(0,r.A)("error-report");(0,n.Ay)("dialog-apply"+this.mid).innerHTML=(0,i.A)("send"),this.dialog.style.width="800px",this.dialog.style.maxWidth="800px",this.setContent(`\n            <div style="display: flex;gap: 20px">\n                <section>\n                    <div id="screenshot-${this.mid}" class="error-report-screenshot">   \n                        <div id="error-report-screenoverlay-${this.mid}" class="error-report-screenoverlay">                     \n                            <button id="takescreen-${this.mid}" class="button positive">Take screenshot</button>\n                            OR\n                            <label id="upload-${this.mid}" for="fileupload-${this.mid}" class="button">Upload image</label>\n                            <input id="fileupload-${this.mid}" type="file" hidden accept="image/*" />\n                        </div>\n                    </div>         \n                </section>\n\n                <section>\n                    <div>\n                        <label>Email</label>\n                        <input id="email-${this.mid}" style="width: 100%" type="text" value="${null!==(e=null===l.N||void 0===l.N?void 0:l.N.email)&&void 0!==e?e:""}">\n                    </div>\n\n                    <div class="top-20">\n                        <label>Description</label>\n                        <small>Explain the problem you are having in English, if you know the steps needed to encounter the issue please include that as well.</small>\n                        <textarea id="description-${this.mid}" style="width:100%" rows="10"></textarea>\n                    </div>\n\n                    <div class="top-20">\n                        <input id="include-doc-${this.mid}" type="checkbox">\n                        <label class="switch" for="include-doc-${this.mid}">\n                            Include current document\n                            <span></span>\n                        </label>\n                        <small>By including your current document we will be able to see your work, it does however make it easier for us to solve your problem.</small>\n                    </div>\n                </section>\n            </div>\n        `),this.descriptionInput=(0,n.Ay)(`description-${this.mid}`),this.emailInput=(0,n.Ay)(`email-${this.mid}`),this.descriptionInput.addEventListener("keydown",(t=>{"Enter"===t.key&&t.stopPropagation()})),this.emailInput.addEventListener("keydown",(t=>{"Enter"===t.key&&t.stopPropagation()}));const s=(0,n.Ay)(`fileupload-${this.mid}`);s.addEventListener("change",(async()=>{var t;const e=s.files[0],i=o.oM(await o.lz(e),!0);i.id=`screenshot-canvas-${this.mid}`,null===(t=(0,n.Ay)(`screenshot-canvas-${this.mid}`))||void 0===t||t.remove(),(0,n.Ay)(`screenshot-${this.mid}`).appendChild(i),(0,n.Ay)(`error-report-screenoverlay-${this.mid}`).classList.add("with-image")})),(0,n.Ay)(`takescreen-${this.mid}`).addEventListener("click",(()=>{this.takeScreenshot()}))}async takeScreenshot(){var t;try{this.hide();const e=document.createElement("video"),s=await navigator.mediaDevices.getDisplayMedia({preferCurrentTab:!0});e.srcObject=s,await e.play(),e.pause();const i=(0,n.T)("canvas",{width:e.videoWidth,height:e.videoHeight,id:`screenshot-canvas-${this.mid}`});i.getContext("2d").drawImage(e,0,0),s.getTracks().forEach((t=>t.stop())),null===(t=(0,n.Ay)(`screenshot-canvas-${this.mid}`))||void 0===t||t.remove(),(0,n.Ay)(`screenshot-${this.mid}`).appendChild(i),(0,n.Ay)(`error-report-screenoverlay-${this.mid}`).classList.add("with-image")}catch(e){console.log(e)}finally{this.show()}}}},27982:(t,e,s)=>{s.d(e,{A:()=>g});var i=s(21742),a=s(42268),n=s(26806),o=s(7324),r=s(16309),h=s(15818),l=s(14871),c=s(58354),d=s(74785),u=s(53872),p=s(29755);class g extends n.A{constructor(t,e,s){super((0,i.A)("fill"),!1),this.setSectionEvent=t=>{let e=t.target;this.setSection(e.value)},this.setSection=(t="color")=>{switch(this.holder.innerHTML="",this.patternselector=void 0,this.colorselector=void 0,this.gradselector=void 0,(0,a.Ay)("fill-type-"+t).checked=!0,t){case"color":this.colorselector=new d.A(this.holder,void 0,this.setFill,!0,!0,!0);break;case"gradient":this.gradselector=new c.A(this.holder,void 0,this.setFill,!0);break;case"pattern":this.patternselector=new u.A(this.holder,this.setFill)}this.fill&&(this.patternselector&&this.fill.value instanceof l.A&&this.patternselector.setPattern(this.fill.value),this.colorselector&&this.fill.value instanceof h.A&&this.colorselector.setColor(this.fill.value),this.gradselector&&this.fill.value instanceof r.Ay&&this.gradselector.setGrad(this.fill.value))},this.setFill=t=>{this.fill=new o.A(t),this.preview&&this.preview(this.fill)},this.cancel=()=>{this.callback&&this.callback(this.initial),this.cleanUp()},this.apply=()=>{this.callback&&(this.fill&&this.fill.value instanceof h.A&&(0,p.oY)(this.fill.value),this.callback(this.fill)),this.cleanUp()},this.fill=t,this.initial=t,this.preview=s,this.callback=e,this.dialog.style.width="340px",this.content.style.paddingBottom="0px",(0,a.Ay)("dialog-apply"+this.mid).innerText=(0,i.A)("ok");let n=(0,a.T)("div",{style:"position:relative"});this.holder=(0,a.T)("div",{id:"fill-selector-presets",className:"top-10"}),this.setContent(n,(0,a.T)("div",{className:"splitter top-10"}),this.holder),n.innerHTML+=`\n        <div id="fill-type" class="switch-field stretch">\n            <input type="radio" id="fill-type-color" name="fill-type" value="color"/><label for="fill-type-color">${(0,i.A)("color")}</label>\n            <input type="radio" id="fill-type-gradient" name="fill-type" value="gradient" /><label for="fill-type-gradient">${(0,i.A)("gradient")}</label>\n            <input type="radio" id="fill-type-pattern" name="fill-type" value="pattern" /><label for="fill-type-pattern">${(0,i.A)("pattern")}</label>\n        </div>\n        `,(0,a.Ay)("fill-type-color").addEventListener("change",this.setSectionEvent,!0),(0,a.Ay)("fill-type-gradient").addEventListener("change",this.setSectionEvent,!0),(0,a.Ay)("fill-type-pattern").addEventListener("change",this.setSectionEvent,!0),this.setSection(null==t?void 0:t.getType()),this.position()}}},91601:(t,e,s)=>{s.d(e,{A:()=>l});var i=s(42268),a=s(21742),n=s(26806),o=s(53900),r=s(54738),h=s(79453);class l extends n.A{constructor(t){super((0,a.A)("dialogImageResizeTitle")),this.imageSizeInputChange=t=>{let e,s,a,n=t.currentTarget;(0,i.Ay)("image-resize-constrain").checked&&("image-resize-width"==n.id?(e=r.qE(Number(n.value),1,this.maxSize),a=e/this.stage.fresco.width,s=Math.round(a*this.stage.fresco.height),(0,i.Ay)("image-resize-height").value=s.toString()):(s=r.qE(Number(n.value),1,this.maxSize),a=s/this.stage.fresco.height,e=Math.round(a*this.stage.fresco.width),(0,i.Ay)("image-resize-width").value=e.toString()),n!=document.activeElement&&((0,i.Ay)("image-resize-width").value=e.toString(),(0,i.Ay)("image-resize-height").value=s.toString()))},this.apply=()=>{setTimeout((()=>{const t=Number((0,i.Ay)("image-resize-width").value),e=Number((0,i.Ay)("image-resize-height").value),s=new o.A(this.stage.fresco.width,this.stage.fresco.height),a=(0,i.Ay)("image-resize-smooth").checked,n=this.stage.fresco.layers.map((t=>t.clone(!0)));this.stage.fresco.resize(t,e,a),this.stage.history.add({type:"pageResize",size:s,layers:n}),this.stage.updateViewport(),document.dispatchEvent(new CustomEvent("layer-arrange")),this.cleanUp()}),500)},this.stage=t,this.maxSize=(null===h.N||void 0===h.N?void 0:h.N.subscription)?8192:4096,this.setContent(`\n            <label class="split">${(0,a.A)("width")} <input type="number" id="image-resize-width"/></label>\n            <label class="split top-10">${(0,a.A)("height")} <input type="number" id="image-resize-height"/></label>\n        \n            <input type="checkbox" checked id="image-resize-constrain" />\n            <label class="switch top-30" for="image-resize-constrain">${(0,a.A)("dialogResizeContrain")}<span></span></label>\n            \n            <input type="checkbox" checked id="image-resize-smooth" />\n            <label class="switch top-10" for="image-resize-smooth">${(0,a.A)("dialogResizeSmoothing")}<span></span></label>\n        \n            <div class="top-20"></div>\n        `);let e=(0,i.Ay)("image-resize-width");e.addEventListener("input",this.imageSizeInputChange,!1),e.addEventListener("change",this.imageSizeInputChange,!1),e.value=this.stage.fresco.width.toString();let s=(0,i.Ay)("image-resize-height");s.addEventListener("change",this.imageSizeInputChange,!1),s.addEventListener("input",this.imageSizeInputChange,!1),s.value=this.stage.fresco.height.toString()}}},63306:(t,e,s)=>{s.d(e,{A:()=>l});var i=s(42268),a=s(21742),n=s(26806),o=s(98244),r=s(6395);class h extends n.A{constructor(t={}){super((0,a.A)("dialogLoadTitle")),this.load=async t=>{(0,o.A)("load-url");const e=(0,i.Ay)("load-message");try{this.cancel=()=>{throw h.CANCEL};const s=this.settings.title||(0,a.A)("image"),n=this.settings.referrer||(0,a.A)("source");e.innerText=(0,a.A)("dialogLoadLoadingFrom",s.toLowerCase(),n.toLowerCase());const o=await(0,r.yP)(t,(t=>{const e=(0,i.Ay)("load-progress");-1==t?e.removeAttribute("value"):e.value=t})),l=new File([o],this.settings.title||t.substring(t.lastIndexOf("/")+1),{type:o.type});return this.cleanUp(),l}catch(s){if(s===h.CANCEL)return void this.cleanUp();(0,i.Ay)("load-progress")&&(e.innerText=(0,a.A)("dialogLoadError"),(0,i.Ay)("load-progress").style.display="none",this.cancel=()=>{this.cleanUp()})}},this.settings=t,this.setContent('\n            <p id="load-message"></p><br />\n\n            <progress id="load-progress" value="0" max="100" style="width: 100%;"></progress>\n            <br><br>\n        '),(0,i.Ay)("dialog-apply"+this.mid).style.display="none";(0,i.Ay)("load-message").innerText=(0,a.A)("dialogLoadPrepare")}}h.CANCEL=new Error("CANCEL");const l=h},51668:(t,e,s)=>{s.d(e,{A:()=>c});var i=s(21742),a=s(26806),n=s(42268),o=s(15818),r=s(81937),h=s(79453),l=s(74785);class c extends a.A{constructor(t){if(super((0,i.A)("createNew"),!0,document.body.clientWidth>=650),this.selectType=t=>{let e=t.currentTarget;this.setType(e.id.replace("tab-",""))},this.setType=t=>{switch(this.type&&(this.holder.innerHTML="",(0,n.Ay)("tab-"+this.type).classList.remove("selected")),(0,n.Ay)("tab-"+t).classList.add("selected"),this.type=t,this.type){case"recommended":if(this.stage.clipboardSize){let t=this.stage.clipboardSize;this.addBox((0,i.A)("clipboard"),t.width,t.height,"/img/icon/new-cutout.svg")}this.addBox((0,i.A)("social-media-post"),1080,1080,"/img/icon/category/social.svg"),this.addBox((0,i.A)("social-media-story"),1080,1920,"/img/icon/category/social.svg"),this.addBox("Web med",1600,900,"/img/icon/category/web.svg"),this.addBox("Thumb 720p",1280,720,"/img/icon/category/video.svg"),this.addBox("Wide 1080p",1920,1080,"/img/icon/category/video.svg"),this.addBox("Art grid",1e3,1e3,"/img/icon/category/art.svg"),this.addBox("12 mpx 4:3",4032,3024,"/img/icon/category/landscape.svg"),this.addBox("8 mpx 4:3",3264,2448,"/img/icon/category/landscape.svg");break;case"photo":this.addBox("12 mpx 4:3",4032,3024,"/img/icon/category/landscape.svg"),this.addBox("8 mpx 4:3",3264,2448,"/img/icon/category/landscape.svg"),this.addBox("Landscape 3x2 in",900,600,"/img/icon/category/landscape.svg"),this.addBox("Landscape 6x4 in",1800,1200,"/img/icon/category/landscape.svg"),this.addBox("Landscape 7x5 in",2100,1500,"/img/icon/category/landscape.svg"),this.addBox("Landscape 10x8 in",3e3,2400,"/img/icon/category/landscape.svg"),this.addBox("Portrait 2x3 in",600,900,"/img/icon/category/portrait.svg"),this.addBox("Portrait 4x6 in",1200,1800,"/img/icon/category/portrait.svg"),this.addBox("Portrait 5x7 in",1500,2100,"/img/icon/category/portrait.svg"),this.addBox("Portrait 8x10 in",2400,3e3,"/img/icon/category/portrait.svg");break;case"social":this.addBox((0,i.A)("instagram-square"),1080,1080,"/img/icon/category/instagram.svg"),this.addBox((0,i.A)("instagram-post"),1080,1350,"/img/icon/category/instagram.svg"),this.addBox((0,i.A)("instagram-story"),1080,1920,"/img/icon/category/instagram.svg"),this.addBox((0,i.A)("facebook-post"),1200,630,"/img/icon/category/facebook.svg"),this.addBox((0,i.A)("facebook-story"),1080,1920,"/img/icon/category/facebook.svg"),this.addBox((0,i.A)("facebook-cover"),851,315,"/img/icon/category/facebook.svg"),this.addBox((0,i.A)("facebook-profile"),850,850,"/img/icon/category/facebook.svg"),this.addBox((0,i.A)("twitter-post"),1600,900,"/img/icon/category/twitter.svg"),this.addBox((0,i.A)("twitter-cover"),1500,500,"/img/icon/category/twitter.svg"),this.addBox((0,i.A)("twitter-profile"),400,400,"/img/icon/category/twitter.svg"),this.addBox((0,i.A)("youtube-profile"),800,800,"/img/icon/category/youtube.svg"),this.addBox((0,i.A)("youtube-thumbnail"),1280,720,"/img/icon/category/youtube.svg"),this.addBox((0,i.A)("youtube-channel-art"),2048,1152,"/img/icon/category/youtube.svg"),this.addBox((0,i.A)("pinterest-pin"),1e3,1500,"/img/icon/category/pinterest.svg"),this.addBox((0,i.A)("pinterest-square-pin"),1e3,1e3,"/img/icon/category/pinterest.svg"),this.addBox((0,i.A)("pinterest-long-pin"),1e3,2100,"/img/icon/category/pinterest.svg");break;case"print":this.addBox("Letter 8 x 11 in",2400,3300,"/img/icon/category/paper.svg"),this.addBox("Legal 8 x 14 in",2400,4200,"/img/icon/category/paper.svg",!0),this.addBox("Tabloid 11 x 17 in",3300,5100,"/img/icon/category/paper.svg",!0),this.addBox("A3 297 x 420 mm",3508,4961,"/img/icon/category/paper.svg",!0),this.addBox("A4 210 x 297 mm",2480,3508,"/img/icon/category/paper.svg"),this.addBox("A5 148 x 210 mm",1748,2480,"/img/icon/category/paper.svg"),this.addBox("A6 105 x 148 mm",1240,1748,"/img/icon/category/paper.svg"),this.addBox((0,i.A)("business-card"),1050,600,"/img/icon/category/business-card.svg"),this.addBox((0,i.A)("flyer")+" 4.25 x 5.5 in",1275,1650,"/img/icon/category/flyer.svg"),this.addBox((0,i.A)("flyer")+" 5.5 x 8.5 in",1650,2550,"/img/icon/category/flyer.svg"),this.addBox((0,i.A)("flyer")+" 8.5 x 11 in",2550,3300,"/img/icon/category/flyer.svg"),this.addBox((0,i.A)("brochure")+" 8.5 x 11 in",2550,3300,"/img/icon/category/flyer.svg"),this.addBox((0,i.A)("brochure")+" 8.5 x 14 in",2550,4200,"/img/icon/category/flyer.svg",!0),this.addBox((0,i.A)("brochure")+" 11 x 17 in",3300,5100,"/img/icon/category/flyer.svg",!0),this.addBox((0,i.A)("invitation")+" 4 x 6 in",384,576,"/img/icon/category/invitation.svg"),this.addBox((0,i.A)("invitation")+" 5 x 7 in",480,672,"/img/icon/category/invitation.svg");break;case"web":this.addBox("Web 1994",800,600,"/img/icon/category/web.svg"),this.addBox("Web 2004",1280,720,"/img/icon/category/web.svg"),this.addBox("Web 2012",1366,768,"/img/icon/category/web.svg"),this.addBox("Web 2016",1440,900,"/img/icon/category/web.svg"),this.addBox("Web 2020",1920,1200,"/img/icon/category/web.svg"),this.addBox("Icon 16",16,16,"/img/icon/category/icon.svg"),this.addBox("Icon 32",32,32,"/img/icon/category/icon.svg"),this.addBox("Icon 64",64,64,"/img/icon/category/icon.svg"),this.addBox("Icon 512",512,512,"/img/icon/category/icon.svg"),this.addBox("Icon 1024",1024,1024,"/img/icon/category/icon.svg");break;case"video":this.addBox("360p",640,360,"/img/icon/category/video.svg"),this.addBox("480p",854,480,"/img/icon/category/video.svg"),this.addBox("720p",1280,720,"/img/icon/category/video.svg"),this.addBox("1080p HD",1920,1080,"/img/icon/category/video.svg"),this.addBox("1440p 2K",2560,1440,"/img/icon/category/video.svg"),this.addBox("4K UHD",3840,2160,"/img/icon/category/video.svg")}},this.presetChange=t=>{let e=t.currentTarget,s=(0,n.Ay)("ceate-new-outer").getElementsByClassName("new-box");for(var i=0;i<s.length;i++)s[i].classList.remove("selected");e.classList.add("selected");let a=e.getAttribute("data").split(":");(0,n.Ay)("new-canvas-width").value=a[0],(0,n.Ay)("new-canvas-height").value=a[1]},this.addBox=(t,e,s,i,a=!1)=>{let o=(0,n.T)("div",{className:"new-box",style:"width:"+this.boxSize+"px"},(0,n.T)("div",{className:"holder"},(0,n.T)("img",{src:i})),(0,n.T)("span",{},t),(0,n.T)("small",{},e+"x"+s+" px"));a&&o.classList.add("premium"),o.addEventListener("click",this.presetChange,!1),o.setAttribute("data",e+":"+s),this.holder.appendChild(o)},this.apply=async()=>{let t=(0,n.Ay)("new-canvas-width").value,e=(0,n.Ay)("new-canvas-height").value,s=Number.isNaN(Number(t))?600:Number(t),i=Number.isNaN(Number(e))?600:Number(e),a="premium"===(null===h.N||void 0===h.N?void 0:h.N.subscriptionAccess)?8192:4096;s>a&&(s=a),i>a&&(i=a);let o=(0,n.Ay)("new-canvas-name").value,r=!(0,n.Ay)("new-canvas-background").checked;this.stage.createNew(o,s,i,r?void 0:this.backgroundColor.getHex()),this.cleanUp()},this.stage=t,(0,n.Ay)("dialog-apply"+this.mid).innerText=(0,i.A)("create"),(0,n.Ay)("dialog-buttons"+this.mid).style.marginTop="0px",document.body.clientWidth>=650){this.dialog.style.width="90%",this.dialog.style.maxWidth="1200px",this.dialog.style.height=document.body.offsetHeight-300+"px",this.content.style.padding="0",this.content.style.height="1vh",this.content.style.display="flex",this.content.style.position="relative",this.content.style.flexDirection="column",this.setContent(`\n\n                <ul id="preset-type" class="tab-list top-10" style="flex: 0 1 auto;margin-left:20px;margin-right:20px;margin-bottom:10px">\n                    <li id="tab-recommended">${(0,i.A)("recommended")}</li>\n                    <li id="tab-photo">${(0,i.A)("photo")}</li>\n                    <li id="tab-social">${(0,i.A)("social")}</li>\n                    <li id="tab-web">${(0,i.A)("web")}</li>\n                    <li id="tab-print">${(0,i.A)("print")}</li>\n                    <li id="tab-video">${(0,i.A)("video")}</li>\n                </ul>\n                <div class="flex" style="position:relative;height:calc(100% - 58px);margin:0px 20px;">\n\n                    <div id="ceate-new-outer" style="flex-grow:2">\n                        <div id="create-new-content" class="new-holder">\n\n                        </div>\n                    </div>\n                    <div style="flex: 0 0 auto;flex-basis:220px;width:220px;min-width:220px;margin-left:10px;overflow:hidden;">\n                        <label for="new-canvas-name">${(0,i.A)("name")}</label>\n                        <input type="text" style="width: 100%;" id="new-canvas-name" value="${(0,i.A)("untitled")}" />\n\n                        <label class="split top-20">${(0,i.A)("width")} <input type="number" id="new-canvas-width" value="1920"/></label>\n                        <label class="split">${(0,i.A)("height")} <input type="number" id="new-canvas-height" value="1080"/></label>\n                        <label class="top-10" style="text-align:right;font-size:10px;float:none;clear: both;">${(0,i.A)("max")}<span id="new-max-size">4096 x 4096 px</span></label>\n\n                        <input type="checkbox" class="toggle-check" id="new-canvas-background" />\n                        <label class="switch subline top-20" for="new-canvas-background">${(0,i.A)("background")}<span></span><span class="arrow"></span></label>\n                        <div class="toggle">\n                            <div id="new-canvas-background-color-picker" class="color-picker top-0"></div>\n                        </div>\n                    </div>\n                <div>\n                \n            `),this.holder=(0,n.Ay)("create-new-content");let t=(0,n.Ay)("preset-type").getElementsByTagName("li");for(var e=0;e<t.length;e++)t[e].addEventListener("click",this.selectType,!1);let s=this.holder.clientWidth,a=Math.floor(s/125);this.boxSize=Math.floor(125+(s-125*a)/a),new r.A((0,n.Ay)("ceate-new-outer")),this.setType("recommended")}else this.setContent(`\n\n                <label for="new-canvas-name">${(0,i.A)("name")}</label>\n                <input type="text" style="width: 100%;" id="new-canvas-name" value="${(0,i.A)("untitled")}" />\n\n                <label class="split top-20">${(0,i.A)("width")} <input type="number" id="new-canvas-width" value="1920"/></label>\n                <label class="split">${(0,i.A)("height")} <input type="number" id="new-canvas-height" value="1080"/></label>\n                <label class="top-10" style="text-align:right;font-size:10px;float:none;clear: both;">${(0,i.A)("max")}<span id="new-max-size">4096 x 4096 px</span></label>\n\n                <input type="checkbox" class="toggle-check" id="new-canvas-background" />\n                <label class="switch subline top-20" for="new-canvas-background">${(0,i.A)("background")}<span></span><span class="arrow"></span></label>\n                <div class="toggle">\n                    <div id="new-canvas-background-color-picker" class="color-picker top-0"></div>\n                </div>\n            `);this.backgroundColor=new l.A((0,n.Ay)("new-canvas-background-color-picker"),new o.A,void 0,!1,!1),"premium"===(null===h.N||void 0===h.N?void 0:h.N.subscriptionAccess)&&((0,n.Ay)("new-max-size").innerText="8192 x 8192 px"),this.position()}}},16377:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(42268),a=s(21742),n=s(63306),o=s(26806),r=s(93771);class h extends o.A{constructor(t,e=!0){super((0,a.A)("dialogOpenURLTitle")),this.apply=async()=>{let t=(0,i.Ay)("image-url").value;if(this.cleanUp(),""!==t){const e=t.substring(t.lastIndexOf("/")+1);t="https://pixlr.com/proxy/?url="+encodeURIComponent(t);const s=new n.A({title:e});let i=await s.load(t);r.Tq(this.stage,i,this.askToAdd)}},this.stage=t,this.askToAdd=e,this.setContent(`\n            <label>${(0,a.A)("dialogOpenURLHeadline")}</label>\n            <input type="url" id="image-url" style="width: 100%" placeholder='https://example.com/this-image.jpg' />\n        `),(0,i.Ay)("dialog-apply"+this.mid).innerText=(0,a.A)("load"),setTimeout((()=>{(0,i.Ay)("image-url").focus()}),300)}}},36854:(t,e,s)=>{s.d(e,{A:()=>l});var i=s(21742),a=s(42268),n=s(26806),o=s(15818),r=s(74785),h=s(29755);class l extends n.A{constructor(t){super((0,i.A)("titlePageColor"),!1),this.change=t=>{this.stage.fresco.color=t?t.toHEX():void 0,window.requestAnimationFrame((()=>{this.stage.render()}))},this.apply=()=>{this.stage.history.add({type:"background",color:this.current}),this.stage.fresco.color&&(0,h.oY)(o.A.fromHEX(this.stage.fresco.color)),this.cleanUp()},this.cancel=()=>{this.stage.fresco.color=this.current,document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.cleanUp()},this.dialog.style.maxWidth="380px",this.stage=t,this.current=this.stage.fresco.color;const e=(0,a.T)("div",{});this.setContent(e),this.colorselector=new r.A(e,this.current?o.A.fromHEX(this.current):void 0,this.change,!0,!0,!0),this.position()}}},68150:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(42268),a=s(21742),n=s(26806),o=s(29755);class r extends n.A{constructor(){super((0,a.A)("titlePreferences"),!1),this.getLanguage=()=>{const t=location.pathname.split("/");return t[1]&&2===t[1].length?t[1]:"us"},this.setLanguage=t=>{const e=location.pathname.split("/");e[1]&&2===e[1].length?e[1]=t:e.splice(1,0,t),location.href=e.join("/")},this.dialog.style.maxWidth="440px",this.setContent(`\n\n                <label class="split" for="settings-language">${(0,a.A)("language")}\n                <div class="select top-0" style="width:auto">\n                    <select id="settings-language">\n                        <option value="us">English</option>\n                        <option value="id">Bahasa Indonesia</option>\n                        <option value="ml">Bahasa Melayu</option>\n                        <option value="cz">Čeština</option>\n                        <option value="dk">Dansk</option>\n                        <option value="de">Deutsch</option>\n                        <option value="es">Español</option>\n                        <option value="ph">Filipino</option>\n                        <option value="fr">Français</option>\n                        <option value="hr">Hrvatski</option>\n                        <option value="it">Italiano</option>\n                        <option value="nl">Nederlands</option>\n                        <option value="no">Norsk</option>\n                        <option value="pl">Polski</option>\n                        <option value="pt">Português</option>\n                        <option value="br">Português (Brasileiro)</option>\n                        <option value="ro">Romanian</option>\n                        <option value="rs">Србија</option>\n                        <option value="ru">Русский</option>\n                        <option value="fi">Suomi</option>\n                        <option value="se">Svenska</option>\n                        <option value="tr">Türkçe</option>\n                        <option value="vn">Tiếng Việt</option>\n                        <option value="th">ไทย</option>\n                        <option value="gr">Ελληνικά</option>\n                        <option value="kr">한국어</option>\n                        <option value="jp">日本語</option>\n                        <option value="cn">中文</option>\n                        <option value="tw">繁體中文</option>\n                    </select> \n                </div>\n            </label>\n\n            <div class="splitter small top-10"></div>\n\n            <label class=" top-10">${(0,a.A)("viewOBarAccent")}</label>\n            <div id="preference-accent" class="top-4 color-pod-list" style="gap:3px;">\n                <div class="color-pod small" data="ash" style="background-color:#383E42"></div>\n                <div class="color-pod small" data="brown" style="background-color:#715649"></div>\n                <div class="color-pod small" data="coral" style="background-color:#F3764C"></div>\n                <div class="color-pod small" data="pink" style="background-color:#F17686"></div>\n                <div class="color-pod small" data="rose" style="background-color:#FE5151"></div>\n                <div class="color-pod small" data="red" style="background-color:#BA2B46"></div>\n                <div class="color-pod small" data="plum" style="background-color:#5A354F"></div>\n                <div class="color-pod small" data="maroon" style="background-color:#A82068"></div>\n                <div class="color-pod small" data="purple" style="background-color:#7D4199"></div>\n                <div class="color-pod small" data="lavender" style="background-color:#6D5DD2"></div>\n                <div class="color-pod small" data="denim" style="background-color:#496171"></div>\n                <div class="color-pod small" data="blue" style="background-color:#0099CC"></div>\n                <div class="color-pod small" data="teal" style="background-color:#00A5A5"></div>\n                <div class="color-pod small" data="green" style="background-color:#48B07B"></div>\n                <div class="color-pod small" data="lime" style="background-color:#95C20F"></div>\n                <div class="color-pod small" data="mustard" style="background-color:#F5BB00"></div>\n            </div>\n\n            <label class="top-16">${(0,a.A)("viewOBarWorkspace")}</label>\n            <div id="preference-workspace" class="color-selector-presets extended top-4" style="width:200px">\n                <div data="dark" class="color-pod square" style="background-color: #232529"></div>\n                <div data="iron" class="color-pod square" style="background-color: #606060"></div>\n                <div data="steel" class="color-pod square" style="background-color: #999999"></div>\n                <div data="light" class="color-pod square" style="background-color: #cccccc"></div>\n            </div>\n\n            <a id="preference-theme-reset" class="link top-20" style="display:inline-block;">${(0,a.A)("reset")}</a>\n\n        `);let t=o.Ay.accent,e=(0,i.Ay)("preference-accent").getElementsByTagName("div");for(var s=0;s<e.length;s+=1)e[s].addEventListener("click",(e=>{document.documentElement.classList.remove(t),t=e.currentTarget.getAttribute("data"),document.documentElement.classList.add(t),document.dispatchEvent(new CustomEvent("layerlist-update")),(0,o.ZC)("accent",t)}));let n=o.Ay.workspace,r=(0,i.Ay)("preference-workspace").getElementsByTagName("div");for(s=0;s<r.length;s+=1)r[s].addEventListener("click",(t=>{document.documentElement.classList.remove(n),n=t.currentTarget.getAttribute("data"),document.documentElement.classList.add(n),(0,o.ZC)("workspace",n)}));(0,i.Ay)("preference-theme-reset").addEventListener("click",(()=>{(0,o.ZC)("workspace","default"),(0,o.ZC)("accent","default"),document.documentElement.className=""}));const h=(0,i.Ay)("settings-language");h.value=this.getLanguage(),h.onchange=()=>this.setLanguage(h.value),(0,i.Ay)("dialog-apply"+this.mid).style.display="none",(0,i.Ay)("dialog-cancel"+this.mid).innerText=(0,a.A)("close")}}},30821:(t,e,s)=>{s.d(e,{A:()=>c});var i=s(42268),a=s(21742),n=s(26806),o=s(54738),r=s(53900),h=s(79453),l=s(29755);class c extends n.A{constructor(t,e){if(super((0,a.A)("dialogPreResizeTitle")),this.rotation=0,this.size=1920,this.init=()=>new Promise(((t,e)=>{this.apply=()=>{(0,i.Ay)("preresize-never-ask-again").checked&&(0,l.ZC)("askToPreResize",!1);const e=new r.A(Number((0,i.Ay)("pre-resize-width").value),Number((0,i.Ay)("pre-resize-height").value)),s=(0,i.Ay)("pre-resize-auto-rotate").checked?this.rotation:0;this.cleanUp(),t([e,s])},this.cancel=()=>{this.cleanUp(),t([void 0,void 0])}})),this.presetChange=t=>{let e=t.currentTarget,s=(0,i.Ay)("pre-resize-preset").getElementsByTagName("li");for(var a=0;a<s.length;a++)s[a].classList.remove("selected");e.classList.add("selected"),this.size=Number(e.getAttribute("data")),this.setSize()},this.imageSizeInputChange=t=>{let e,s,a=t.currentTarget;"pre-resize-width"===a.id?(e=o.qE(Number(a.value),1,this.width),s=Math.round(e/this.width*this.height)):(s=o.qE(Number(a.value),1,this.height),e=Math.round(s/this.height*this.width)),(0,i.Ay)("pre-resize-height").value=s.toString(),(0,i.Ay)("pre-resize-width").value=e.toString()},this.setSize=()=>{let t=(0,i.Ay)("pre-resize-width"),e=(0,i.Ay)("pre-resize-height");this.width>this.height?(t.value=this.size.toString(),e.value=Math.round(this.size/this.width*this.height).toString()):(e.value=this.size.toString(),t.value=Math.round(this.size/this.height*this.width).toString())},"premium"===(null===h.N||void 0===h.N?void 0:h.N.subscriptionAccess)?this.dialog.style.maxWidth="560px":this.dialog.style.maxWidth="480px",this.image=t,90===e||-90===e?(this.height=t.width,this.width=t.height):(this.width=t.width,this.height=t.height),this.rotation=e,this.setContent(`\n            <span style="display: block;">${(0,a.A)("dialogPreResizeInfo1")} (<span id="pre-resize-start"></span>) ${(0,a.A)("dialogPreResizeInfo2")}</span>\n\n            <input type="checkbox" id="preresize-never-ask-again" />\n            <label class="switch top-10" for="preresize-never-ask-again">${(0,a.A)("neverAskMeAgain")}<span></span></label>\n\n            <span id="pre-resize-auto-rotate-setting" style="display:none;">\n                <input type="checkbox" checked id="pre-resize-auto-rotate" />\n                <label class="switch top-20" for="pre-resize-auto-rotate">${(0,a.A)("dialogPreResizeExif")}<span></span></label>\n            </span>\n        \n            <ul id="pre-resize-preset" class="push-buttons top-20">\n                <li id="pre-resize-original" data="4096"><img src="/img/icon/layer-image.svg" class="ic"><span>${(0,a.A)("original")}<br /><small id="pre-resize-uhd-size">Max 3840 px</small></span></li>\n                <li id="pre-resize-uhd" data="3840"><img src="/img/icon/size-uhd.svg" class="ic"><span>${(0,a.A)("sizeUltraHD")}<br /><small>Max 3840 px</small></span></li>\n                <li id="pre-resize-fhd" data="1920" class="selected"><img src="/img/icon/size-fhd.svg" class="ic"><span>${(0,a.A)("sizeFullHD")}<br /><small>Max 1920 px</small></span></li>\n                <li id="pre-resize-uhd" data="1280"><img src="/img/icon/size-web.svg" class="ic"><span>${(0,a.A)("sizeWeb")}<br /><small>Max 1280 px</small></span></li>\n            </ul>\n\n            <div class="top-20" style="text-align:right;line-height:32px;">${(0,a.A)("newSize")}<input type="number" style="text-align:center;margin-left:16px" id="pre-resize-width"/> x <input type="number" style="text-align:center" id="pre-resize-height"/></div>\n        `),this.maxSize="premium"===(null===h.N||void 0===h.N?void 0:h.N.subscriptionAccess)?8192:4096,"premium"===(null===h.N||void 0===h.N?void 0:h.N.subscriptionAccess)?(this.width<3840&&this.height<3840&&((0,i.Ay)("pre-resize-uhd").style.display="none"),(0,i.Ay)("pre-resize-original").setAttribute("data",Math.min(Math.max(this.width,this.height),this.maxSize).toString()),(0,i.Ay)("pre-resize-uhd-size").innerText=(0,a.A)("dialogPreResizeMaxSize",Math.min(Math.max(this.width,this.height),this.maxSize))):this.width<3840&&this.height<3840?((0,i.Ay)("pre-resize-uhd").style.display="none",(0,i.Ay)("pre-resize-original").setAttribute("data",Math.max(this.width,this.height).toString()),(0,i.Ay)("pre-resize-uhd-size").innerText=(0,a.A)("dialogPreResizeMaxSize",Math.max(this.width,this.height))):(0,i.Ay)("pre-resize-original").style.display="none",0!==e){let t=(0,i.Ay)("pre-resize-auto-rotate-setting");t.style.display="block",t.addEventListener("change",(()=>{let t=(0,i.Ay)("pre-resize-width"),e=(0,i.Ay)("pre-resize-height");const s=t.value;t.value=e.value,e.value=s}),!1)}(0,i.Ay)("pre-resize-start").innerText=this.width.toString()+" x "+this.height.toString();let s=(0,i.Ay)("pre-resize-preset").getElementsByTagName("li");for(var n=0;n<s.length;n++)s[n].addEventListener("click",this.presetChange,!1);this.setSize(),(0,i.Ay)("pre-resize-width").addEventListener("change",this.imageSizeInputChange,!1),(0,i.Ay)("pre-resize-height").addEventListener("change",this.imageSizeInputChange,!1)}}},30973:(t,e,s)=>{s.d(e,{A:()=>v});var i=s(21742),a=s(26806),n=s(82042),o=s(42268),r=s(54738),h=s(98244),l=s(79453),c=s(72284),d=s(11839),u=s(3514),p=s(29755);class g extends c.A{constructor(){super(!0),(0,h.A)("after_save"),this.dialog.style.maxWidth="420px",this.setContent(`\n            <div id="after-content" style="padding:20px 0 20px;display:flex;position:relative;flex-direction:column;align-items:center;min-height:420px;">\n\n                <div style="padding:30px 30px 0px 30px;">\n                    <h2 class="split">${(0,i.A)("common-success")} <span style="font-weight:bold;font-size:small">${(0,p.Lr)()}/3  ${(0,i.A)("common-freeSave")}</span></h2>\n                    <div id="after-save-message" style="padding-top:16px"></div>\n\n                    <button id="premium-go-now" style="display:none;margin-top:140px;" class="button large w-100">${(null===l.N||void 0===l.N?void 0:l.N.eligibleForTrail)?(0,i.A)("try30DayFreePremium"):(0,i.A)("subscribeNow")}</button>\n                </div>\n\n                <div id="after-entry" class="top-20"></div>\n            </div>\n        `),this.dialog.style.overflow="unset",l.N?(this.dialog.append((0,o.T)("div",{className:"premium-plug"},(0,o.T)("img",{src:"/img/icon/premium.svg"}))),(0,o.Ay)("premium-go-now").addEventListener("click",(async()=>{this.cleanUp(),new u.A("afterSave","premium")}),!0),(0,o.Ay)("after-save-message").innerText=(0,i.A)("common-afterFileSaveTryPremium"),(0,o.Ay)("premium-go-now").style.display="block"):(new d.Ay({holder:(0,o.Ay)("after-entry")}),this.dialog.append((0,o.T)("div",{className:"user-plug"},(0,o.T)("img",{src:"/img/icon/user.svg"}))),(0,o.Ay)("after-save-message").innerText=(0,i.A)("common-afterFileSaveRegister"))}}var m=s(66718);class v extends a.A{constructor(t,e){if(super((0,i.A)("dialogSaveTitle"),!0),this.setType=t=>{const e=t.currentTarget.getAttribute("data");this.changeType(e)},this.changeType=(t,e=!1)=>{if(!e&&this.type===t)return;let s;if("jpg"===t){s=Number((0,o.Ay)("jpg-width").value)/this.stage.fresco.width}this.type&&(0,o.Ay)("type-"+this.type).classList.remove("active"),(0,o.Ay)("type-"+t).classList.add("active"),this.type=t,this.canvas.remove();let i="jpg"===this.type||"pdf"===this.type||"png"===this.type&&!(0,o.Ay)("png-transparent").checked||"webp"===this.type&&!(0,o.Ay)("webp-transparent").checked;this.canvas=this.stage.getOutputCanvas(this.stage.fresco,s,i?"#ffffff":void 0),(null===l.N||void 0===l.N?void 0:l.N.subscription)||(this.canvas.oncontextmenu=()=>!1),(0,o.Ay)("save-file-prop").innerHTML=this.canvas.width+" x "+this.canvas.height+"px",(0,o.Ay)("save-file-type").innerHTML="."+this.type,(0,o.Ay)("save-preview").prepend(this.canvas),this.renderBlob()},this.jpgSizeChange=t=>{let e=t.currentTarget;if(""!==e.value){if("jpg-width"===e.id){const t=r.qE(Number(e.value),1,this.canvas.width),s=Math.round(t/this.stage.fresco.width*this.stage.fresco.height);(0,o.Ay)("jpg-height").value=s.toString()}else{const t=r.qE(Number(e.value),1,this.canvas.width),s=Math.round(t/this.stage.fresco.height*this.stage.fresco.width);(0,o.Ay)("jpg-width").value=s.toString()}r.sg("save",500,(()=>this.changeType("jpg",!0)))}},this.renderBlob=async()=>{if((0,o.Ay)("save-file-size").innerText=(0,i.A)("dialogSaveCalculate"),"pxz"===this.type)return this.blob=void 0,void((0,o.Ay)("save-file-size").innerText=`Format: ${this.type}`);if("pdf"===this.type)return void this.canvas.toBlob((t=>{this.blob=t,(0,o.Ay)("save-file-size").innerText=`Format: ${this.type}, size: ${r.Ov(t.size+1024)}`}),"image/jpeg",.95);const t="image/"+this.type.replace("jpg","jpeg"),e="jpg"===this.type?this.jpgquality.getValue():"webp"===this.type?this.webpquality.getValue():1;this.canvas.toBlob((t=>{this.blob=t,(0,o.Ay)("save-file-size").innerText=`Format: ${this.type}, size: ${r.Ov(t.size)}`}),t,e)},this.applyAPI=async(t="client")=>{let e=this.stage.fresco.name,s=this.stage.fresco.saveMethod;const i=this.type;let a=(0,o.Ay)("save-file-name").value||this.stage.fresco.name||"Untitled";if("pxz"===i){this.setMessage("Creating your PXZ file","You've selected a large file format, please wait while we create the file for you.");try{this.blob=await(0,m.Ab)(this.stage,{id:this.stage.fresco.id,name:e,quality:1,nonDestructive:(0,o.Ay)("save-pxz-ndestuctive").checked,type:"document",unit:"pixel"})}catch(h){return console.error(h),void this.setMessage("Error when creating PXZ file")}}const n=p.Ay.follow,r=new File([this.blob],a+"."+i,{type:`image/${this.type}`});if(s instanceof MessagePort)s.postMessage(r);else if(s instanceof URL&&n){const t=(0,o.T)("form");t.method="post",t.action=s.toString(),t.enctype="multipart/form-data",document.body.append(t),t.addEventListener("formdata",(t=>{t.formData.append("file",r)})),t.submit()}else if(s instanceof URL&&!n){const e=new FormData;e.append("file",r),this.setMessage("Saving",`Uploading image to ${t}, please wait...`);try{const i=await fetch(s,{method:"post",body:e});if(i.status>=200&&i.status<300)throw new Error("non 2xx status");let a=`<p>The image was saved to ${t}</p> <div class="buttons center"><a class="button positive xlarge" href=" ${(await i.json()).savedUrl} ">View</a></div>`;this.setMessage("Save completed",a),(0,o.Ay)("dialog-close"+this.mid).style.display="none"}catch(l){this.setMessage("Error",`Failed to save to ${t}, please try again.`)}}},this.apply=async()=>{const t=this.type;let e,s=(0,o.Ay)("save-file-name").value||this.stage.fresco.name||"Untitled";if((0,h.A)("save-file",t),!this.useLegacySave&&this.stage.fresco.savedTimesCounterForUserEase>0&&(s+="("+this.stage.fresco.savedTimesCounterForUserEase+")"),this.stage.fresco.savedTimesCounterForUserEase++,!this.useLegacySave){let i="image/jpeg",a="Jpg image";switch(t){case"pxz":i="application/pxz",a="Pixlr document";break;case"png":i="image/png",a="PNG image";break;case"webp":i="image/webp",a="WebP image"}if(e=await(0,m.D0)(s,t,a,i),!1===e)return}if("pdf"===t){this.setMessage("Creating your PDF file","You've selected a large file format, please wait while we create the file for you.");try{this.blob=await(0,m.EB)(this.stage.fresco.width,this.stage.fresco.height,this.blob)}catch(a){return console.error(a),void this.setMessage("Error when creating PDF file")}}if("pxz"===t){this.setMessage("Creating your PXZ file","You've selected a large file format, please wait while we create the file for you.");try{this.blob=await(0,m.Ab)(this.stage,{id:this.stage.fresco.id,name:s,quality:1,nonDestructive:(0,o.Ay)("save-pxz-ndestuctive").checked,type:"document",unit:"pixel"})}catch(a){return console.error(a),void this.setMessage("Error when creating PXZ file")}}if(this.blob){if(e){await(0,m.IF)(e,new File([this.blob],s+"."+t))||(0,m.gr)(new File([this.blob],s+"."+t),s,t)}else(0,m.gr)(new File([this.blob],s+"."+t),s,t);this.cleanUp(),"pxz"!==t&&(0,p.pp)(),(null===l.N||void 0===l.N?void 0:l.N.subscription)?document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)("fileSaved")})):new g}},this.setWorking=()=>{(0,o.Ay)("dialog-apply"+this.mid).style.display="none",(0,o.Ay)("dialog-api-apply")&&((0,o.Ay)("dialog-api-apply").style.display="none"),(0,o.Ay)("save-settings").style.display="none",(0,o.Ay)("save-working").style.display="block"},this.setMessage=(t,e="")=>{(0,o.Ay)("dialog-apply"+this.mid).style.display="none",(0,o.Ay)("dialog-api-apply")&&((0,o.Ay)("dialog-api-apply").style.display="none"),(0,o.Ay)("save-working").style.display="none",(0,o.Ay)("save-settings").style.display="none",(0,o.Ay)("save-message").style.display="block",(0,o.Ay)("save-message-title").innerText=t,(0,o.Ay)("save-message-body").innerHTML=e,(0,o.Ay)("dialog-cancel"+this.mid).innerText=(0,i.A)("close")},this.dialog.id="save-dialog",t.fresco.block)return void this.cleanUp();if(!(null===l.N||void 0===l.N?void 0:l.N.subscription)&&(0,p.P2)())return this.cleanUp(),void new u.A("save","save");this.stage=t,this.dialog.style.maxWidth="820px",this.dialog.style.minHeight="600px",this.content.classList.add("flex"),this.useLegacySave=p.Ay.useLegacySave||!(0,m.zu)(),(0,o.Ay)("dialog-apply"+this.mid).innerText=this.useLegacySave?(0,i.A)("save"):(0,i.A)("saveAs"),(0,o.Ay)("dialog-buttons"+this.mid).style.paddingTop="0px",this.setContent(`\n        <section id="save-preview">\n            <div id="save-file-size" class="top-10"></div>\n            <div id="save-file-prop"></div>\n        </section>\n        <section id="save-section">\n            <div id="save-message" style="display:none;">\n                <h2 id="save-message-title"></h2>\n                <p id="save-message-body"></p>\n            </div>\n            <div id="save-working" style="display:none;">\n                <h2>${(0,i.A)("working")}...</h2>\n                \n                <div class="progress-bar top-20">\n                    <span id="save-progress" class="inner"></span>\n                </div>\n            </div>\n\n            <div id="save-settings">\n\n                <div id="file-name-section" style="display:none;padding-bottom:20px">\n                    <label>${(0,i.A)("name")}</label>\n                    <div style="display:flex">\n                        <input type="text" id="save-file-name" style="width:280px" />\n                        <div id="save-file-type" style="padding-left:10px;line-height:32px;"></div>\n                    </div>\n                </div>\n\n                <div id="type-jpg" data="jpg" class="option-task">\n                    <img src="/img/icon/file-jpg.svg" class="type ic">\n                    <div class="name">JPG <span>${(0,i.A)("smallFilesPerfect")}</span></div>\n                    <div class="settings">\n                        <div id="jpg-quality"></div>\n\n                        <div id="jpg-quality-switch" class="switch-field stretch top-10">\n                            <input type="radio" id="jpg-quality-low" name="jpg-quality-preset" value="50"/><label for="jpg-quality-low">${(0,i.A)("dialogSaveLow")}</label>\n                            <input type="radio" id="jpg-quality-med" name="jpg-quality-preset" value="70" /><label for="jpg-quality-med">${(0,i.A)("dialogSaveMed")}</label>\n                            <input type="radio" id="jpg-quality-high" name="jpg-quality-preset" value="90" checked /><label for="jpg-quality-high">${(0,i.A)("dialogSaveHigh")}</label>\n                        </div>\n\n                        <label class="split top-20">${(0,i.A)("width")} <input type="number" id="jpg-width" value="${t.fresco.width}"/></label>\n                        <label class="split top-5">${(0,i.A)("height")} <input type="number" id="jpg-height" value="${t.fresco.height}"/></label>\n                    </div>\n                </div>\n\n                <div id="type-png" data="png" class="option-task">\n                    <img src="/img/icon/file-png.svg" class="type ic">\n                    <div class="name">PNG<span>${(0,i.A)("largeAndLossless")}</span></div>\n                    <div class="settings">\n                        <input type="checkbox" id="png-transparent" checked>\n                        <label class="switch" for="png-transparent">${(0,i.A)("transparent")}<span></span></label>\n                    </div>\n                </div>\n\n                <div id="type-webp" data="webp" class="option-task">\n                    <img src="/img/icon/file-webp.svg" class="type ic">\n                    <div class="name">WebP<span>${(0,i.A)("modrenFormatSuitable")}</span></div>\n                    <div class="settings">\n                        <div id="webp-quality"></div>\n\n                        <div id="webp-quality-switch" class="switch-field stretch top-10">\n                            <input type="radio" id="webp-quality-low" name="webp-quality-preset" value="50"/><label for="webp-quality-low">${(0,i.A)("dialogSaveLow")}</label>\n                            <input type="radio" id="webp-quality-med" name="webp-quality-preset" value="70" /><label for="webp-quality-med">${(0,i.A)("dialogSaveMed")}</label>\n                            <input type="radio" id="webp-quality-high" name="webp-quality-preset" value="90" checked /><label for="webp-quality-high">${(0,i.A)("dialogSaveHigh")}</label>\n                        </div>\n\n                        <input type="checkbox" id="webp-transparent" checked>\n                        <label class="switch top-20" for="webp-transparent">${(0,i.A)("transparent")}<span></span></label>\n                    </div>\n                </div>\n\n                <div id="type-pdf" data="pdf" class="option-task">\n                    <img src="/img/icon/file-pdf.svg" class="type ic">\n                    <div class="name">PDF <span>${(0,i.A)("bestForFlyersAndMarketing")}.</span></div>\n                </div>\n\n                <div id="type-pxz" data="pxz" class="option-task">\n                    <img src="/img/icon/file-pxz.svg" class="type ic">\n                    <div class="name">PXZ <span>${(0,i.A)("completePixlrDocument")}</span></div>\n                    <div class="settings">\n                        <input type="checkbox" id="save-pxz-ndestuctive" />\n                        <label class="switch top-10" for="save-pxz-ndestuctive">${(0,i.A)("dialogSaveNonDestructive")}<span></span></label>\n                        <p>${(0,i.A)("dialogSavePXZDescription")}</p>\n                    </div>\n                </div>\n            </div>\n        </section>\n        `),this.useLegacySave?(0,o.Ay)("file-name-section").style.display="block":document.body.offsetWidth>=650&&(0,o.Ay)("dialog-buttons"+this.mid).prepend((0,o.T)("div",{style:"cursor:pointer;margin-right:auto;",onclick:()=>{document.dispatchEvent(new CustomEvent("preferences")),this.cleanUp()}},(0,i.A)("issuesSavingUseLegacy"))),document.body.clientWidth<650&&((0,o.Ay)("dialog-title"+this.mid).innerHTML+=":",(0,o.Ay)("dialog-title"+this.mid).appendChild((0,o.Ay)("save-file-size"))),this.canvas=this.stage.getOutputCanvas(),this.hasWebP=-1!==r.VI(5,5).toDataURL("image/webp").indexOf("webp"),this.type=e||(r.P1(this.canvas)?"png":"jpg"),(0,o.Ay)("type-"+this.type).append((0,o.T)("div",{className:"reko"},(0,i.A)("recommend"))),(0,o.Ay)("type-jpg").addEventListener("click",this.setType),(0,o.Ay)("type-png").addEventListener("click",this.setType),(0,o.Ay)("type-webp").addEventListener("click",this.setType),(0,o.Ay)("type-pdf").addEventListener("click",this.setType),(0,o.Ay)("type-pxz").addEventListener("click",this.setType);let s=this.stage.fresco.name?this.stage.fresco.name.lastIndexOf("."):-1;(0,o.Ay)("save-file-name").value=-1!==s?this.stage.fresco.name.substring(0,s):this.stage.fresco.name||"Untitled",this.jpgquality=new n.A("jpg-quality",{range:[.01,1],defaultValue:.9,step:.001,label:(0,i.A)("quality"),labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100,onEnd:t=>{t<.5?(0,o.Ay)("jpg-quality-low").checked=!0:t<.8?(0,o.Ay)("jpg-quality-med").checked=!0:(0,o.Ay)("jpg-quality-high").checked=!0,this.renderBlob()}});let a=(0,o.Ay)("jpg-quality-switch").getElementsByTagName("input");for(var c=0;c<a.length;c++)a[c].addEventListener("change",(t=>{let e=t.currentTarget;this.jpgquality.setValue(Number(e.value)/100),this.renderBlob()}),!1);let d=(0,o.Ay)("jpg-width");d.addEventListener("change",this.jpgSizeChange,!1),d.addEventListener("input",this.jpgSizeChange,!1);let v=(0,o.Ay)("jpg-height");v.addEventListener("change",this.jpgSizeChange,!1),v.addEventListener("input",this.jpgSizeChange,!1),this.webpquality=new n.A("webp-quality",{range:[.01,1],defaultValue:.9,step:.001,label:(0,i.A)("quality"),labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100,onEnd:t=>{t<.5?(0,o.Ay)("webp-quality-low").checked=!0:t<.8?(0,o.Ay)("webp-quality-med").checked=!0:(0,o.Ay)("webp-quality-high").checked=!0,this.renderBlob()}}),a=(0,o.Ay)("webp-quality-switch").getElementsByTagName("input");for(c=0;c<a.length;c++)a[c].addEventListener("change",(t=>{let e=t.currentTarget;this.webpquality.setValue(Number(e.value)/100),this.renderBlob()}),!1);(0,o.Ay)("webp-transparent").addEventListener("change",(()=>this.changeType("webp",!0))),(0,o.Ay)("png-transparent").addEventListener("change",(()=>this.changeType("png",!0)));"normal"!==this.stage.fresco.saveMethod&&((0,o.Ay)("dialog-apply"+this.mid).after((0,o.T)("a",{id:"dialog-api-apply",className:"button positive",onclick:()=>this.applyAPI()},p.Ay.icon?(0,o.T)("img",{src:p.Ay.icon}):void 0,(0,i.A)("save"))),(0,o.Ay)("dialog-apply"+this.mid).style.display="none",p.Ay.target&&((0,o.Ay)("dialog-api-apply").style.display="inline-block")),this.changeType(this.type,!0)}}},2215:(t,e,s)=>{s.d(e,{A:()=>c});var i=s(21742),a=s(26806),n=s(42268),o=s(54738),r=s(22866),h=s(23556),l=s(58489);class c extends a.A{constructor(t,e,s=!1,a=!0,c=0){super(e,!1,s),this.isMasked=!1,this.createCombinationMask=t=>{if(this.selected.type===r.A.TYPE_FRAME||!this.stage.fresco.hasSelection()&&!t)return;let e=this.selected;if(!this.stage.fresco.hasSelection()&&!e.hasMask())return;let s=o.Nw(e.canvas.width,e.canvas.height),i=s.getContext("2d");return this.stage.fresco.hasSelection()&&i.drawImage(this.stage.fresco.selection.mask,-e.rect.x,-e.rect.y),t&&e.hasMask()&&(i.save(),this.stage.fresco.hasSelection()&&(i.globalCompositeOperation="destination-in"),i.drawImage(this.selected.mask,0,0),i.restore()),i=void 0,s},this.compareDown=()=>{this.scratch.canvas=this.cache,window.requestAnimationFrame((()=>this.stage.render()))},this.compareUp=()=>{this.scratch.canvas=this.shaders.apply(this.cache),window.requestAnimationFrame((()=>this.stage.render()))},this.change=(t,e)=>{this.selected.canvas&&(this.kind||(this.kind=t),this.shaders.addShader(t,e),setTimeout((()=>{this.scratch.canvas=this.shaders.apply(this.cache),window.requestAnimationFrame((()=>this.stage.render()))}),0))},this.cancel=()=>{this.cleanUp()},this.apply=()=>{if(this.scratch&&this.shaders.chain.length>0){const e=this.selected.trim?this.selected.trim.clone():this.selected.rect.clone(),s=o.oM(this.selected.canvas);this.stage.history.add({type:"bitmapSwitch",kind:this.kind,layer:this.selected,rect:e,canvas:s});let i=this.createCombinationMask(!1);if(i){this.cache=o.oM(this.selected.canvas);var t=this.cache.getContext("2d");t.save(),t.globalCompositeOperation="destination-in",t.drawImage(i,0,0),t.restore(),t=null,this.isMasked=!0}else this.cache=this.selected.canvas,this.isMasked=!1;this.scratch.canvas=this.shaders.apply(this.cache),this.scratch.drawToLayer(this.selected,this.isMasked?"source-over":"copy",1),this.selected.render()}this.cleanUp()},this.cleanUp=()=>{this.stage.coating.freeze(!1),this.stage.fresco.removeScratch(),document.removeEventListener("keydown",this.keyDown,!1),this.compare.removeEventListener("mousedown",this.compareDown,!0),this.compare.removeEventListener("mouseup",this.compareUp,!0),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.selected=void 0,this.shaders.cleanUp(),this.shaders=void 0,this.dialog.remove(),this.dialog=void 0,this.modal.remove(),this.modal=void 0},this.stage=t,this.stage.coating.freeze(!0),this.shaders=new h.A,this.selected=this.stage.fresco.getSelected(),this.compare=(0,n.T)("div",{className:"icon-button compare"},(0,n.T)("img",{src:"/img/icon/compare.svg",className:"ic"})),this.compare.setAttribute("tooltip",(0,i.A)("compare")),this.compare.setAttribute("flow","down"),this.compare.addEventListener("mousedown",this.compareDown,!0),this.compare.addEventListener("mouseup",this.compareUp,!0),(0,n.Ay)("dialog-buttons"+this.mid).prepend(this.compare);let d=this.createCombinationMask(a);if(d){this.cache=o.oM(this.selected.canvas);var u=this.cache.getContext("2d");u.save(),u.globalCompositeOperation="destination-in",u.drawImage(d,0,0),u.restore(),u=null,this.isMasked=!0}else this.cache=this.selected.canvas;const p=(this.selected.trim&&this.selected instanceof l.A?this.selected.getGlobalTrim():this.selected.rect).pad(c);if(c>0){const t=o.Nw(p.width,p.height);t.getContext("2d").drawImage(this.cache,c,c),this.cache=t}this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,p,this.isMasked?"over":"replace"),this.scratch.settings.blendmode=this.selected.settings.blendmode,this.scratch.settings.opacity=this.selected.settings.opacity,this.scratch.canvas=this.cache}}},6709:(t,e,s)=>{s.d(e,{A:()=>y});var i=s(21742),a=s(26806),n=s(42268),o=s(40963),r=s(53900),h=s(54738),l=s(41915),c=s(22866),d=s(81937),u=s(54127),p=s(58489),g=s(39989),m=s(86445),v=s(10122);class y extends a.A{constructor(t){super((0,i.A)("dialogResizeTitle"),!0,!0),this.rotate=!1,this.constrain=!0,this.messy=!1,this.saving=!1,this.method="fill",this.selectPreset=t=>{if(this.saving)return;let e=t.currentTarget.getAttribute("data");if(-1!==e.indexOf(":")){const t=Number(e.split(":")[0]),s=Number(e.split(":")[1]);let i=this.source.width,a=this.source.height;i=a=i>a?i:a,t/s>1?a=Math.floor(a/(t/s)):i=Math.floor(i/(s/t)),this.setSize(i,a)}else{const t=e.split("x");this.setSize(Number(t[0]),Number(t[1]))}},this.changeContraint=t=>{this.saving||(this.constrain=!this.constrain,(0,n.Ay)("resize-size-lock").style.display=this.constrain?"block":"none",(0,n.Ay)("resize-size-vs").style.display=this.constrain?"none":"block",(0,n.Ay)("toggle-resize-constraint").checked=this.constrain)},this.changeRotate=t=>{this.saving||(this.rotate=!this.rotate,this.calculateResize())},this.changeMethod=()=>{this.method=(0,n.Ay)("resize-method-fill").checked?"fill":"fit",this.calculateResize()},this.setSize=(t,e)=>{this.target.width=t,this.target.height=e,(0,n.Ay)("resize-width").value=t.toString(),(0,n.Ay)("resize-height").value=e.toString(),this.calculateResize()},this.sizeInputChange=t=>{if(this.saving)return;let e=null==t?void 0:t.currentTarget;if("resize-width"==e.id){if(this.target.width=h.qE(Number(e.value),1,this.maxSize),this.constrain){let t=this.target.width/this.source.width;this.target.height=Math.round(t*this.source.height),(0,n.Ay)("resize-height").value=this.target.height.toString()}}else if(this.target.height=h.qE(Number(e.value),1,this.maxSize),this.constrain){let t=this.target.height/this.source.height;this.target.width=Math.round(t*this.source.width),(0,n.Ay)("resize-width").value=this.target.width.toString()}e!=document.activeElement&&((0,n.Ay)("resize-width").value=this.target.width.toString(),(0,n.Ay)("resize-height").value=this.target.height.toString()),h.sg("resize",250,this.calculateResize)},this.calculateResize=(t=!1)=>{if(console.log(this.method),!this.saving||t){if(this.reset(),this.target.width!==this.source.width||this.target.height!==this.source.height){Math.round(this.target.width/this.source.width*1e3)===Math.round(this.target.height/this.source.height*1e3)?this.calculateScaleResize():this.calculateSmartResize(),this.messy=!0}this.preview.width=this.target.width,this.preview.height=this.target.height,(0,n.Ay)("preview-scale-label").innerText=(this.preview.offsetWidth/this.target.width*100).toFixed(1)+"%",this.stage.renderOutputFrame(this.ctx,!1,void 0===this.stage.fresco.color)}},this.calculateScaleResize=()=>{let t=new l.A(this.target.width/this.source.width,this.target.height/this.source.height);for(const e of this.stage.fresco.layers)if(e.rect){let s=t.x,i=t.y;if(e.rect.rotation){let a=e.rect.rotation>180?e.rect.rotation-180:e.rect.rotation,n=Math.abs(90-a)/90;s=t.x*n+t.y*(1-n),i=t.y*n+t.x*(1-n)}e.rect.x=0+Math.round(e.rect.x*t.x),e.rect.y=0+Math.round(e.rect.y*t.y),s!==i&&e instanceof u.A?(e.rect.x+=.5*Math.round(e.rect.width*s-e.rect.width*i),e.rect.width=Math.round(e.rect.width*i),e.rect.height=Math.round(e.rect.height*i)):(e.rect.width=Math.round(e.rect.width*s),e.rect.height=Math.round(e.rect.height*i)),e.rect.width<1&&(e.rect.width=1),e.rect.height<1&&(e.rect.height=1),e instanceof u.A?e.scaleBect(i):e instanceof p.A?e.scaleTrim(s,i):e.render()}},this.calculateSmartResize=()=>{const t=this.target.width===this.target.height?"square":this.target.width>this.target.height?"landscape":"portrait",e=this.source.width===this.source.height?"square":this.source.width>this.source.height?"landscape":"portrait";if(e===t||"square"===e||"square"===t){const t=new l.A(this.target.width/this.source.width,this.target.height/this.source.height);for(const e of this.stage.fresco.layers)if(e.rect)if(e.rect.width>=this.source.width&&e.rect.height>=this.source.height&&(e.type===c.A.TYPE_SHAPE||e.type===c.A.TYPE_IMAGE||e.type===c.A.TYPE_FRAME))e instanceof p.A?(e.rect.x=e.rect.y=0,e.rect.width=this.target.width,e.rect.height=this.target.height,e.fitContent()):("fill"===this.method?e.rect=o.A.fillFit(e.rect.width,e.rect.height,this.target.width,this.target.height):e.rect=o.A.bestFit(e.rect.width,e.rect.height,this.target.width,this.target.height,!0),e.render());else{const s=this.source.width>this.source.height?.2*this.source.width:.2*this.source.height;this.positionAndScaleLayer(e,t,s)}}else{const e=new Array,s=new Array,i=new Array;for(const r of this.stage.fresco.layers)if(r.rect)if(r.rect.width>=.65*this.source.width&&r.rect.height>=.65*this.source.height&&(r.type===c.A.TYPE_SHAPE||r.type===c.A.TYPE_IMAGE||r.type===c.A.TYPE_ELEMENT||r.type===c.A.TYPE_FRAME))if(this.rotate){let t=new l.A(this.target.width/this.source.height,this.target.height/this.source.width);if(r instanceof g.A||r instanceof v.A){let e=t.x<t.y?t.y:t.x;r.rect.width>=this.source.width&&r.rect.height>=this.source.height&&(e=t.x>t.y?t.y:t.x);let s=r.rect.center();r.rect.width=Math.round(r.rect.width*e),r.rect.height=Math.round(r.rect.height*e),r.rect.setCenter(new l.A(Math.round(s.y*t.x),Math.round(s.x*t.y))),r.rect.rotation+=90}else r.rect=r.rect.flipWidthAndHeight(),r.rect.x=Math.floor(r.rect.x*t.x),r.rect.y=Math.floor(r.rect.y*t.y),r.rect.width=Math.round(r.rect.width*t.x),r.rect.height=Math.round(r.rect.height*t.y),r instanceof p.A?r.fitContent():r.render()}else"fill"===this.method?r.rect=o.A.fillFit(r.rect.width,r.rect.height,this.target.width,this.target.height):r.rect=o.A.bestFit(r.rect.width,r.rect.height,this.target.width,this.target.height,!0),r instanceof p.A?r.fitContent():r.render();else{let a=r.rect.center();"portrait"===t?a.x>.45*this.source.width&&a.x<.55*this.source.width?i.push(r):a.x>=.5*this.source.width?(r.rect.x-=.5*this.source.width,s.push(r)):e.push(r):a.y>=.5*this.source.height?(r.rect.y-=.5*this.source.height,s.push(r)):e.push(r)}const a=this.stage.fresco.getStackBounds(e),n=this.stage.fresco.getStackBounds(s),h=this.stage.fresco.getStackBounds(i);if("portrait"===t){const t=.2*this.source.height;let o=new r.A(.5*this.source.width,this.source.height),c=new r.A(this.target.width,.5*this.target.height);if(a){let s=new l.A(c.width/o.width,c.height/o.height);a.x>0&&a.width<1.5*o.width?s.x=c.width/(a.width+2*a.x):a.x<=0&&a.width>.5*o.width&&(s.x=s.x=c.width/a.width);for(const i of e)this.positionAndScaleLayer(i,s,t)}if(n){let e=0,i=new l.A(c.width/o.width,c.height/o.height);n.x>=0&&n.right()<=o.width&&n.width<1.5*o.width?(e=o.width-n.right()-n.x,i.x=c.width/(n.width+2*(o.width-n.right()))):n.x<=0&&n.width>.5*o.width&&(e=Math.abs(n.x),i.x=c.width/(n.width-(n.right()-o.width)));for(const a of s)a.rect.x+=e,this.positionAndScaleLayer(a,i,t),a.rect.y+=.5*this.target.height,a.bect&&(a.bect.y+=.5*this.target.height)}if(h){let t=h.width/this.source.width>.5?.95*this.target.width/h.width:this.target.width/(.5*this.source.width);for(const e of i){let s=e.rect.center();e.rect.width=Math.round(e.rect.width*t),e.rect.height=Math.round(e.rect.height*t),e.rect.width<1&&(e.rect.width=1),e.rect.height<1&&(e.rect.height=1),e.rect.setCenter(new l.A(this.target.width*(s.x/this.source.width),.25*this.target.height+.5*this.target.height*(s.y/this.source.height))),e instanceof u.A?e.scaleBect(t):e instanceof p.A?e.scaleTrim(t,t):e.render()}}}else{let t=0;const i=.2*this.source.width;let o=new r.A(this.source.width,.5*this.source.height),h=new r.A(.5*this.target.width,this.target.height);if((a&&!n||!a&&n)&&(t=a?.5*o.width:-.5*o.width),a){let s=0,n=new l.A(h.width/o.width,h.height/o.height);a.y>0&&a.height<1.5*o.height?n.y=h.height/(a.height+2*a.y):a.y>0&&a.height>1.5*o.height?s=-1*a.y:a.y<=0&&a.height>.5*o.height&&(n.y=n.y=h.height/a.height);for(const a of e)a.rect.y+=s,a.rect.x+=t,this.positionAndScaleLayer(a,n,i,!0)}if(n){let e=0,a=new l.A(h.width/o.width,h.height/o.height);n.y<0&&(e=Math.abs(n.y),n.y+=e),n.height-e>o.height&&(n.height=o.height+e),n.height>=o.height?a.y=h.height/n.height:e+=.5*(o.height-n.height);for(const n of s)n.rect.y+=e,n.rect.x+=t,this.positionAndScaleLayer(n,a,i,!0),n.rect.x+=.5*this.target.width,n.bect&&(n.bect.x+=.5*this.target.width)}}}},this.positionAndScaleLayer=(t,e,s,i=!1)=>{const a=e.x>e.y?e.y:e.x;if(this.willScaleUniform(t,s))t.rect.x=Math.floor(t.rect.x*e.x),t.rect.y=Math.floor(t.rect.y*e.y),t.rect.width=Math.round(t.rect.width*e.x),t.rect.height=Math.round(t.rect.height*e.y),t.rect.width<1&&(t.rect.width=1),t.rect.height<1&&(t.rect.height=1),t instanceof p.A?t.fitContent():t.render();else{const s=t.rect.center();t.rect.width=Math.round(t.rect.width*a),t.rect.height=Math.round(t.rect.height*a),t.rect.width<1&&(t.rect.width=1),t.rect.height<1&&(t.rect.height=1),i?(t.rect.y=Math.floor(t.rect.y*e.y),t.rect.setCenterX(Math.round(s.x*e.x))):t.rect.setCenter(new l.A(Math.round(s.x*e.x),Math.round(s.y*e.y))),t instanceof u.A?t.scaleBect(a):t instanceof p.A?t.scaleTrim(a,a):t.render()}},this.willScaleUniform=(t,e)=>(t instanceof p.A||t instanceof m.A)&&(t.rect.width>e||t.rect.height>e)&&!(t instanceof m.A&&("svg"===t.shapeSettings.variant||"ellipse"===t.shapeSettings.variant)),this.reset=()=>{if(this.messy){for(let t=0;t<this.stage.fresco.layers.length;++t)this.stage.fresco.layers[t].rect&&(this.stage.fresco.layers[t].rect=this.rOrg[t].clone(),this.stage.fresco.layers[t].trim&&(this.stage.fresco.layers[t].trim=this.tOrg[t].clone()),this.stage.fresco.layers[t].render());this.messy=!1}},this.cancel=()=>{this.reset(),this.cleanUp()},this.apply=()=>{if(this.saving)return;this.saving=!0,this.reset();const t=new r.A(this.source.width,this.source.height);this.stage.fresco.setSize(this.target.width,this.target.height),this.stage.fresco.selection&&this.stage.fresco.selection.size(this.target.width,this.target.height);const e=this.stage.fresco.layers.map((t=>(t.syncRequested=new Date,t.clone(!0))));this.calculateResize(!0);for(const s of this.stage.fresco.layers)s instanceof g.A&&s.applyTransform(!0);this.stage.history.add({type:"pageResize",size:t,layers:e}),this.stage.updateViewport(),document.dispatchEvent(new CustomEvent("layerlist-update")),document.dispatchEvent(new CustomEvent("layer-arrange")),this.cleanUp()},this.stage=t,this.maxSize=8192,this.rOrg=new Array,this.tOrg=new Array;for(let i of this.stage.fresco.layers)this.rOrg.push(i.rect?i.rect.clone():void 0),this.tOrg.push(i.trim?i.trim.clone():void 0);this.source=new r.A(this.stage.fresco.width,this.stage.fresco.height),this.target=new r.A(this.stage.fresco.width,this.stage.fresco.height),this.dialog.style.width="90%",this.dialog.style.height="80%",this.dialog.style.maxWidth="1200px",this.content.style.flex="1",this.content.style.height="1px",this.content.style.padding="0px",this.content.style.display="flex",this.content.style.position="relative",this.setContent(`\n            <div id="resize-settings" style="flex:0 0 auto;width:320px;position:relative;overflow: hidden;">\n\n                <div id="resize-settings-inner" style="padding:20px;overflow: hidden;">\n\n                    <div style="display: flex; line-height: 28px;">\n                        <div style="flex-grow:1">\n                            <label class="split" style="height: 36px!important;">${(0,i.A)("width")} <input type="number" id="resize-width"/></label>\n                            <label class="split" style="height: 36px!important;">${(0,i.A)("height")} <input type="number" id="resize-height"/></label>\n                        </div>\n                        <div style="width:30px">\n                            <div id="resize-constraint" class="constraint">\n                                <div class="constraint-lock" flow="left" tooltip="${(0,i.A)("toggleConstraint")}">\n                                    <img src="/img/icon/locked.svg" id="resize-size-lock" width="16" height="16" loading="lazy" class="ic tiny-icon">\n                                    <img src="/img/icon/x.svg" id="resize-size-vs" width="16" height="16" loading="lazy" style="display:none" class="ic tiny-icon">\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <input type="checkbox" checked id="toggle-resize-constraint" />\n                    <label class="switch top-10" for="toggle-resize-constraint">${(0,i.A)("dialogResizeLock")}<span></span></label>\n            \n                    <div class="splitter small top-20"></div>\n\n                    <div class="split top-20">\n                        <label>${(0,i.A)("method")}</label>\n                        <div class="switch-field">\n                            <input type="radio" id="resize-method-fill" name="resize-method" value="fill" checked="true" /><label for="resize-method-fill">${(0,i.A)("fill")}</label>\n                            <input type="radio" id="resize-method-fit" name="resize-method" value="fit" /><label for="resize-method-fit">${(0,i.A)("fit")}</label>\n                        </div>\n                    </div>\n\n                    <input type="checkbox" id="toggle-resize-rotate" />\n                    <label class="switch top-10" for="toggle-resize-rotate">${(0,i.A)("dialogResizeRotate")}<span></span></label>\n\n                    <div class="splitter top-20"></div>\n\n                    <ul id="resize-presets" class="size-list top-20">\n\n                        <li data="" id="resize-reset"><img src="/img/icon/reset.svg" width="18" height="18" loading="lazy" title="reset">${(0,i.A)("reset")} <span id="resize-reset-span"></span></span></li>\n\n                        <li data="1:1"><img src="/img/icon/category/landscape.svg" width="18" height="18" loading="lazy" title="Square">Square <span>1:1 aspect</span></span></li>\n                        <li data="16:9"><img src="/img/icon/category/landscape.svg" width="18" height="18" loading="lazy" title="Wide">Wide <span>16:9 aspect</span></span></li>\n                        <li data="9:16"><img src="/img/icon/category/portrait.svg" width="18" height="18" loading="lazy" title="Tall">Tall <span>9:16 aspect</span></span></li>\n                        <li data="4:3"><img src="/img/icon/category/landscape.svg" width="18" height="18" loading="lazy" title="Landscape">Landscape <span>4:3 aspect</span></span></li>\n                        <li data="3:4"><img src="/img/icon/category/portrait.svg" width="18" height="18" loading="lazy" title="Portrait">Portrait <span>3:4 aspect</span></span></li>\n\n                        <li data="1080x1920"><img src="/img/icon/category/tiktok.svg" width="18" height="18" loading="lazy" title="Tiktok video">Tiktok video<span>1080x1920px</span></li>\n\n                        <li data="1080x1080"><img src="/img/icon/category/instagram.svg" width="18" height="18" loading="lazy" title="Instagram square">Instagram square <span>1080x1080px</span></li>\n                        <li data="1080x1350"><img src="/img/icon/category/instagram.svg" width="18" height="18" loading="lazy" title="Instagram post">Instagram post <span>1080x1350px</span></li>\n                        <li data="1080x1920"><img src="/img/icon/category/instagram.svg" width="18" height="18" loading="lazy" title="Instagram story">Instagram story <span>1080x1920px</span></li>\n                        <li data="1080x1920"><img src="/img/icon/category/instagram.svg" width="18" height="18" loading="lazy" title="Instagram reelse">Instagram reels <span>1080x1920px</span></li>\n\n                        <li data="1200x630"><img src="/img/icon/category/facebook.svg" width="18" height="18" loading="lazy" title="Facebook post">Facebook post <span>1200x630px</span></li>\n                        <li data="1080x1920"><img src="/img/icon/category/facebook.svg" width="18" height="18" loading="lazy" title="Facebook story">Facebook story <span>1080x1920px</span></li>\n                        <li data="1080x1920"><img src="/img/icon/category/facebook.svg" width="18" height="18" loading="lazy" title="Facebook reelse">Facebook reels <span>1080x1920px</span></li>\n                        <li data="850x850"><img src="/img/icon/category/facebook.svg" width="18" height="18" loading="lazy" title="Facebook profile">Facebook profile <span>850x850px</span></li>\n                        <li data="1920x1005"><img src="/img/icon/category/facebook.svg" width="18" height="18" loading="lazy" title="Facebook event">Facebook event <span>1920x1005px</span></li>\n                        \n                        <li data="1600x900"><img src="/img/icon/category/x.svg" width="18" height="18" loading="lazy" title="X post">X post <span>1600x900px</span></li>\n                        <li data="1500x500"><img src="/img/icon/category/x.svg" width="18" height="18" loading="lazy" title="X cover">X cover <span>1500x500px</span></li>\n                        <li data="400x400"><img src="/img/icon/category/x.svg" width="18" height="18" loading="lazy" title="X profile">X profile <span>400x400px</span></li>\n\n                        <li data="1080x1920"><img src="/img/icon/category/youtube.svg" width="18" height="18" loading="lazy" title="Youtube shorts">Youtube shorts <span>1080x1920px</span></li>\n                        <li data="800x800"><img src="/img/icon/category/youtube.svg" width="18" height="18" loading="lazy" title="Youtube profile">Youtube profile <span>800x800px</span></li>\n                        <li data="1280x720"><img src="/img/icon/category/youtube.svg" width="18" height="18" loading="lazy" title="Youtube thumbnail">Youtube thumbnail <span>1280x720px</span></li>\n                        <li data="2048x1152"><img src="/img/icon/category/youtube.svg" width="18" height="18" loading="lazy" title="Youtube channel art">Youtube channel art <span>2048x1152px</span></li>\n\n                        <li data="1000x1500"><img src="/img/icon/category/pinterest.svg" width="18" height="18" loading="lazy" title="Pinterest pin">Pinterest pin <span>1000x1500px</span></li>\n                        <li data="1000x1000"><img src="/img/icon/category/pinterest.svg" width="18" height="18" loading="lazy" title="Pinterest square pin">Pinterest square pin <span>1000x1000px</span></li>\n                        <li data="1000x2100"><img src="/img/icon/category/pinterest.svg" width="18" height="18" loading="lazy" title="Pinterest long pin">Pinterest long pin <span>1000x2100px</span></li>\n\n                        <li data="1240x1748"><img src="/img/icon/category/paper.svg" width="18" height="18" loading="lazy" title="ISO A6">A6 105 x 148 mm <span>1240x1748px</span></li>\n                        <li data="1748x2480"><img src="/img/icon/category/paper.svg" width="18" height="18" loading="lazy" title="ISO A5">A5 148 x 210 mm <span>1748x2480px</span></li>\n                        <li data="2480x3508"><img src="/img/icon/category/paper.svg" width="18" height="18" loading="lazy" title="ISO A4">A4 210 x 297 mm <span>2480x3508px</span></li>\n\n                        <li data="1275x1650"><img src="/img/icon/category/flyer.svg" width="18" height="18" loading="lazy" title="Flyer 4.25 x 5.5 in">Flyer 4.25 x 5.5 in<span>1275x1650px</span></li>\n                        <li data="1650x2550"><img src="/img/icon/category/flyer.svg" width="18" height="18" loading="lazy" title="Flyer 5.5 x 8.5 in">Flyer 5.5 x 8.5 in<span>1650x2550px</span></li>\n                        <li data="1650x2550"><img src="/img/icon/category/flyer.svg" width="18" height="18" loading="lazy" title="Flyer 8.5 x 11 in">Flyer 8.5 x 11 in<span>2550x3300px</span></li>\n                    </ul>\n\n                </div>\n            </div>\n\n            <div id="resize-preview" style="display:flex;flex-grow:1;background: linear-gradient(43deg, #ffffff00 0%, #ffffff11 100%);padding:20px;align-items:center;justify-content:center;">\n                <canvas id="resize-preview-canvas" style="max-height:100%; max-width:100%; box-shadow: 6px 6px 12px rgb(0 0 0 / 30%);background-image: var(--square-bg);background-size: 20px 20px;background-position: 50% 50%;"/>\n            </div>\n        `),this.content.append((0,n.T)("div",{id:"preview-scale",style:"display:flex;position:absolute;z-index:99;height:28px;top:20px;right:20px;padding:0 15px 0 10px;gap:8px;border-radius:50vh;background-color:#00000088;color:#fff;opacity:0.7;align-items:center;"},(0,n.T)("img",{src:"/img/tool/zoom.svg",width:16,height:16}),(0,n.T)("span",{id:"preview-scale-label",style:"font-size:14px;"}))),(0,n.Ay)("resize-reset").setAttribute("data",this.source.width+"x"+this.source.height),(0,n.Ay)("resize-reset-span").innerText=this.source.width+"x"+this.source.height+"px",(0,n.Ay)("resize-constraint").addEventListener("click",this.changeContraint,!1),(0,n.Ay)("toggle-resize-constraint").addEventListener("click",this.changeContraint,!1),(0,n.Ay)("toggle-resize-rotate").addEventListener("click",this.changeRotate,!1);let e=(0,n.Ay)("resize-width");e.addEventListener("input",this.sizeInputChange,!1),e.addEventListener("change",this.sizeInputChange,!1),e.value=this.source.width.toString();let s=(0,n.Ay)("resize-height");s.addEventListener("change",this.sizeInputChange,!1),s.addEventListener("input",this.sizeInputChange,!1),s.value=this.source.height.toString(),(0,n.Ay)("resize-method-fill").addEventListener("change",this.changeMethod,!0),(0,n.Ay)("resize-method-fit").addEventListener("change",this.changeMethod,!0);let a=(0,n.Ay)("resize-presets").getElementsByTagName("li");for(var y=0;y<a.length;y++)a[y].addEventListener("click",this.selectPreset,!1);new d.A((0,n.Ay)("resize-settings")),this.preview=(0,n.Ay)("resize-preview-canvas"),this.ctx=this.preview.getContext("2d"),this.calculateResize()}}},53198:(t,e,s)=>{s.d(e,{A:()=>y});var i,a=s(21742),n=s(63306),o=s(26806),r=s(42268),h=s(54738),l=s(98244),c=s(93771),d=s(81937);class u{constructor(t,e){this.clear=()=>{this.grid.innerHTML=""},this.grid=t,this.grid.classList.add("mansorary"),e&&this.grid.classList.add(e),this.gridItems=[].slice.call(this.grid.children),window.onload=()=>this.resizeAllGridItems(),window.addEventListener("resize",(()=>this.resizeAllGridItems()))}addChild(t){this.grid.appendChild(t),this.gridItems=[].slice.call(this.grid.children)}resizeAllGridItems(){this.grid.style.alignItems="start",this.gridItems.forEach((t=>this.resizeGridItem(t))),this.grid.style.alignItems="stretch"}resizeGridItem(t){let e=parseInt(window.getComputedStyle(this.grid).getPropertyValue("gap")),s=Math.ceil((t.clientHeight+e)/(1+e));t.style.gridRowEnd="span "+s}getContent(){return this.grid}}class p{constructor(t,e,s,i,a){this.id=t,this.urls=e,this.description=s,this.downloadLink=i,this.credits=a,this.downloadUrl=()=>fetch(this.downloadLink+"&client_id=0fded05dc29e00f3a22e79c451bbbf4905f3d17d9ba2d5348398c648bd1603ca").then((t=>t.json())).then((t=>t.url)),this.source="unsplash",this.thumbnail=e.thumb}}class g{constructor(t,e,s,i){this.id=t,this.url=e,this.description=s,this.downloadLink=i,this.downloadUrl=()=>fetch(this.downloadLink).then((t=>t.json())).then((t=>t.download_url.replace("http://","https://"))),this.thumbnail=e}}class m{}i=m,m.randomDefault=()=>{const t=["candy","cake","cookies","nature","spring","winter","forest","architecture","park","new york","flower","london","tokyo","kyoto","cherry blossom","waterfall","jungle","italy","food","garden","lion","reef","river","mountain","boats"];return t[Math.floor(Math.random()*t.length)]},m.query=(t,e="unsplash")=>{switch(e){case"unsplash":default:return i.getUnsplashResults(t,1);case"stockunlimited":return i.getStockUnlimitedResults(t,1)}},m.getUnsplashResults=(t,e)=>fetch(`https://api.unsplash.com/search/photos?content_filter=high&page=${e}&query=${t}&per_page=50`,{headers:{Authorization:"Client-ID 0fded05dc29e00f3a22e79c451bbbf4905f3d17d9ba2d5348398c648bd1603ca"}}).then((t=>t.json())).then((t=>t)).then((s=>{const a=s.total_pages===e;return{items:s.results.map((t=>new p(t.id,t.urls,t.description,t.links.download_location,{name:t.user.name,profile:t.user.links.html}))),nextPage:a?void 0:()=>i.getUnsplashResults(t,e+1)}})),m.getStockUnlimitedResults=(t,e)=>fetch(`/api/stockunlimited/search?query=${t}&page=${e}`).then((t=>t.json())).then((t=>t)).then((s=>{const a=s.meta.pages===e;return{items:s.data.map((t=>new g(t.id,t.thumbnail,t.description,t.download))),nextPage:a?void 0:()=>i.getStockUnlimitedResults(t,e+1)}})).catch((t=>console.error(t)));const v=m;class y extends o.A{constructor(t){super((0,a.A)("dialogStockSearch"),!0,!0),this.setSearch=async()=>{const t=(0,r.Ay)("search-result"),e=(0,r.Ay)("search-input");e.value=v.randomDefault(),e.focus(),e.onkeyup=s=>{switch(s.key){case"Down":case"ArrowDown":case"Up":case"ArrowUp":case"Left":case"ArrowLeft":case"Right":case"ArrowRight":case"Meta":return}let i=e.value;i.length<=2||(t.innerHTML="",(0,r.Ay)("search-more").onclick=void 0,(0,r.Ay)("search-more").style.display="none",(0,r.Ay)("search-loading").style.display="block",(0,r.Ay)("search-error").style.display="none",(0,r.Ay)("search-offline").style.display="none",h.sg("search-input",500,(()=>{this.search(i,t)})))},(0,r.Ay)("search-loading").style.display="block",(0,r.Ay)("search-error").style.display="none",(0,r.Ay)("search-offline").style.display="none",this.search(e.value,t)},this.sourceChange=async()=>{const t=(0,r.Ay)("search-result");let e=(0,r.Ay)("search-input").value;e.length<=2||(t.innerHTML="",(0,r.Ay)("search-more").onclick=void 0,(0,r.Ay)("search-more").style.display="none",(0,r.Ay)("search-loading").style.display="block",(0,r.Ay)("search-error").style.display="none",(0,r.Ay)("search-offline").style.display="none",h.sg("search-input",500,(()=>{this.search(e,t)})))},this.search=async(t,e)=>{e.innerHTML="",(0,r.Ay)("search-more").style.display="none";const s=(0,r.Ay)("stock-search-source");try{const i=await v.query(t,s.value);this.renderResult(i,e)}catch(i){(0,r.Ay)("search-loading").style.display="none",window.navigator.onLine?(0,r.Ay)("search-error").style.display="block":(0,r.Ay)("search-offline").style.display="block"}},this.renderResult=(t,e)=>{let s=new u(e);t.items.forEach((t=>{let e=document.createElement("div");e.classList.add("box");let i=document.createElement("img");if(i.src=t.thumbnail,i.alt=t.description,i.onload=()=>s.resizeGridItem(e),e.appendChild(i),t.credits){let s=document.createElement("a");s.className="meta",s.target="_blank",s.innerText=t.credits.name,s.title=`${t.credits.name} on ${t.source}`,s.href=t.credits.profile,e.appendChild(s)}e.onclick=()=>this.open(t),s.addChild(e)}));const i=(0,r.Ay)("search-more");i.style.display=t.nextPage&&t.items.length>0?"flex":"none",(0,r.Ay)("search-loading").style.display="none",(0,r.Ay)("search-no-result").style.display=0===t.items.length?"block":"none",h.sg("search-more",500,(()=>{this.working=!1})),i.onclick=async()=>{if(this.working)return;this.working=!0;const e=await t.nextPage();this.renderResult(e,s.getContent())}},this.autoLoad=()=>{(0,r.Ay)("search-more").click()},this.open=async t=>{(0,l.A)("open-stock");const e=new n.A({title:t.id,referrer:t.source}),s=await t.downloadUrl();let i=await e.load(s);await c.Tq(this.stage,i),this.stage.notify("imageAdded")},this.cancel=()=>{this.cleanUp()},this.stage=t,(0,r.Ay)("dialog-cancel"+this.mid).innerText=(0,a.A)("close"),(0,r.Ay)("dialog-apply"+this.mid).style.display="none",this.dialog.style.width="90%",this.dialog.style.height="80%",this.dialog.style.maxWidth="1200px",this.content.style.flex="1",this.content.style.height="1px",this.content.style.display="flex",this.content.style.padding="0 10px",this.content.style.flexDirection="column",this.setContent(`\n            <div id="stock-seach-bar" style="flex:0 0 auto; padding:10px;">\n                 <div style="position: relative;">\n                        <label>${(0,a.A)("search")}</label>\n                        <div style="position:relative;display:flex;justify-content: flex-start;gap: 15px;">\n                            <input id="search-input" type="text" placeholder="${(0,a.A)("keyword")}" style="width:100%;max-width:600px;height:42px;padding-left:40px" />\n                            <img class="search-icon ic" src="/img/tool/zoom.svg" width="20" height="20" style="top:10px;left:10px;">\n\n                            <div class="select" style="height:42px;margin-top:0px">\n                                <select id="stock-search-source" style="width:180px">\n                                    <option value="unsplash" selected>${(0,a.A)("unsplash")}</option>\n                                    <option value="stockunlimited">${(0,a.A)("stockunlimited")}</option>\n                                </select>\n                            </div>\n                        </div>\n                </div>\n            </div>\n\n            <div id="stock-seach-result" style="padding:0 10px;position:relative;">\n\n                <div id="search-result" style="min-height:600px;"></div>\n\n                <div id="search-loading" class="loading"></div>\n\n                <div id="search-error" style="display: none">\n                    <h3>${(0,a.A)("error")}</h3>\n                    ${(0,a.A)("genericError")}\n                </div>\n\n                <div id="search-offline" style="display: none">\n                    <h3>${(0,a.A)("offline")}</h3>\n                    ${(0,a.A)("genericOffline")}\n                </div>\n\n                <div id="search-no-result" style="display: none">\n                    ${(0,a.A)("genericNoResult")}\n                </div>\n\n                <div class="button positive large" id="search-more" style="display: none; margin: 15px auto 0 auto; max-width: 350px;transform:translateY(-100px)">${(0,a.A)("loadMore")} </div>\n\n            </div>\n        `),new d.A((0,r.Ay)("stock-seach-result")),this.setSearch(),(0,r.Ay)("stock-search-source").onchange=()=>{this.sourceChange()},this.observer=new IntersectionObserver(this.autoLoad),this.observer.observe((0,r.Ay)("search-more"))}}},51787:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(52040),a=s(74785);class n extends i.A{constructor(t,e,s,i,n=!1,o=!0,r="right"){super(t),this.cleanUp=()=>{this.callback&&this.callback(this.selector.color),this.superClean()},this.color=e,this.preview=i,this.callback=s,this.selector=new a.A(this.content,this.color,this.preview,n,o,!0),this.position(r)}}},52040:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(54738),a=s(42268);class n{constructor(t,e="right"){let s;this.position=(t=this.flow)=>{let e=this.parent.getBoundingClientRect();if("up"===t||document.body.clientWidth<650)this.drop.style.left=i.qE(e.right-this.drop.offsetWidth+15,5,document.body.clientWidth-this.drop.offsetWidth)+"px",this.drop.style.top=e.top-this.drop.offsetHeight+"px",this.drop.classList.add("up");else{switch(t){case"right":this.drop.style.left=e.right-5+"px",this.drop.style.top=e.top-24+"px";break;case"left":this.drop.style.left=e.left-this.drop.offsetWidth+this.parent.offsetWidth/2+38+"px",this.drop.style.top=e.top-this.drop.offsetHeight+"px";break;case"down":this.drop.style.left=e.left+this.parent.offsetWidth/2-36+"px",this.drop.style.top=e.bottom+5+"px"}this.drop.classList.add(t)}},this.setContent=(...t)=>{t[0]instanceof HTMLElement?this.content.append(...t):this.content.innerHTML+=t[0],this.position()},this.keyDown=t=>{"Enter"!==t.key&&"Escape"!==t.key||this.cleanUp()},this.superClean=()=>{var t;document.removeEventListener("keydown",this.keyDown,!1),this.drop.remove(),this.drop=null,null===(t=this.modal)||void 0===t||t.remove(),this.modal=null},this.cleanUp=()=>{this.superClean()},this.flow=e,this.parent=t,this.mid=i.r0(),this.content=(0,a.T)("div",{className:"content"}),this.drop=(0,a.T)("div",{className:"drop"},this.content),this.modal=(0,a.T)("div",{id:"modal-"+this.mid,className:"modal"},this.drop),this.modal.addEventListener("mousedown",(t=>{s=t.target})),this.modal.addEventListener("mouseup",(t=>{t.target===s&&t.target===this.modal&&this.cleanUp()})),document.body.appendChild(this.modal),document.addEventListener("keydown",this.keyDown,!1),this.position(e)}}},66827:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(42268),a=s(16309),n=s(15818),o=s(14871),r=s(27982);class h{constructor(t,e,s,h){this.previewFill=t=>{this.setFill(t),this.preview&&this.preview(this.fill)},this.callbackFill=t=>{this.setFill(t),this.callback&&this.callback(this.fill)},this.setFill=t=>{this.fill=t,this.holder.classList.remove("empty"),this.holder.style.backgroundColor="unset",this.holder.style.backgroundImage="unset",this.fill&&this.fill.value?this.fill.value instanceof n.A?this.holder.style.backgroundColor=this.fill.value.toHEX():(this.fill.value instanceof a.Ay||this.fill.value instanceof o.A)&&(this.holder.style.backgroundImage=this.fill.value.toCSS()):this.holder.classList.add("empty")},this.getFill=()=>this.fill,this.picker=()=>{new r.A(this.fill,this.callbackFill,this.previewFill)},this.cleanUp=()=>{this.container.removeEventListener("click",this.picker,!1)},this.fill=e,this.preview=h,this.callback=s,this.container=(0,i.Ay)(t),this.container.classList.add("fill-pod"),this.container.addEventListener("click",this.picker,!1),this.container.hasChildNodes()?this.holder=(0,i.Ay)(t+"-holder"):(this.holder=(0,i.T)("div",{id:t+"-holder"}),this.container.appendChild(this.holder)),this.setFill(e)}}},58281:(t,e,s)=>{s.d(e,{A:()=>c});var i=s(42268),a=s(58354),n=s(21742),o=s(54738),r=s(82042),h=s(15818);class l{constructor(t){this.updatePreview=()=>{this.preview.style.backgroundImage=this.grad.toCSS(),this.callback&&this.callback(this.grad)},this.populateStops=()=>{this.stoplist.innerHTML="";for(let t=0;t<this.grad.stops.length;++t){const e=Math.round(300*this.grad.stops[t].position);this.stoplist.append((0,i.T)("div",{id:this.grad.stops[t].id,className:"knob",style:"left:"+e+"px"},(0,i.T)("div",{id:this.grad.stops[t].id+"-color",style:"background:"+this.grad.stops[t].color.toHEX()})))}this.setHandlers()},this.addStop=t=>{t.stopPropagation(),t.preventDefault();const e=this.grad.addStop(new h.A(0,255,0),Math.round(t.clientX-this.container.offsetLeft-14)/300),s=Math.round(300*e.position),a=(0,i.T)("div",{id:e.id,className:"knob",style:"left:"+s+"px"},(0,i.T)("div",{id:e.id+"-color",style:"background:"+e.color.toHEX()}));a.addEventListener("mousedown",this.mouseDown,!0),a.addEventListener("touchstart",this.touchStart,{passive:!0}),this.stoplist.append(a),this.selectStop(e.id),this.updatePreview()},this.removeStop=()=>{if(this.grad.stops.length>2){(0,i.Ay)(this.selected.id)&&(0,i.Ay)(this.selected.id).remove();const t=this.grad.removeStop(this.selected.id);this.selected=void 0,this.selectStop(t),this.updatePreview()}},this.selectStop=t=>{this.selected&&this.selected.id===t||(this.selected&&(0,i.Ay)(this.selected.id)&&(0,i.Ay)(this.selected.id).classList.remove("selected"),this.selected=this.grad.getStop(t),(0,i.Ay)(this.selected.id).classList.add("selected"),this.opacity.setValue(this.selected.color.a/255),(0,i.Ay)("grad-editor-remove").classList.toggle("disabled",this.grad.stops.length<3))},this.down=(t,e,s)=>{this.selectStop(s.id),this.downX=t,this.target=s,this.start=s.offsetLeft+6},this.move=(t,e)=>{let s=o.qE(this.start+(t-this.downX),0,300);this.target.style.left=s+"px",this.selected.position=s/300,this.grad.sort(),this.updatePreview()},this.setHandlers=()=>{const t=document.querySelectorAll("#grad-editor-stoplist > .knob");for(let e=0;e<t.length;e++)t[e].addEventListener("mousedown",this.mouseDown,!0),t[e].addEventListener("touchstart",this.touchStart,{passive:!0}),0===e&&this.selectStop(t[e].id)},this.removeHandlers=()=>{const t=document.querySelectorAll("#grad-editor-stoplist > .knob");for(let e=0;e<t.length;e++)t[e].removeEventListener("mousedown",this.mouseDown,!0),t[e].removeEventListener("touchstart",this.touchStart)},this.touchStart=t=>{t.preventDefault(),t.stopPropagation(),this.down(t.changedTouches[0].clientX,t.changedTouches[0].clientY,t.currentTarget),document.addEventListener("touchmove",this.touchMove,{passive:!0}),document.addEventListener("touchend",this.touchEnd,{passive:!0})},this.touchMove=t=>{t.preventDefault(),t.stopPropagation(),this.move(t.changedTouches[0].clientX,t.changedTouches[0].clientY)},this.touchEnd=t=>{t.preventDefault(),t.stopPropagation(),document.removeEventListener("touchmove",this.touchMove),document.removeEventListener("touchend",this.touchEnd)},this.mouseDown=t=>{t.preventDefault(),t.stopPropagation(),this.down(t.clientX,t.clientY,t.currentTarget),document.addEventListener("mousemove",this.mouseMove,!0),document.addEventListener("mouseup",this.mouseUp,!0)},this.mouseMove=t=>{t.stopPropagation(),this.move(t.clientX,t.clientY)},this.mouseUp=t=>{t.stopPropagation(),t.preventDefault(),document.removeEventListener("mousemove",this.mouseMove,!0),document.removeEventListener("mouseup",this.mouseUp,!0)},this.cleanUp=()=>{var t;this.removeHandlers(),this.addlist.removeEventListener("click",this.addStop,!0),(0,i.Ay)("grad-editor-remove").removeEventListener("click",this.removeStop,!0),this.gradpod.update(this.grad),this.container.remove(),null===(t=this.modal)||void 0===t||t.remove()},this.gradpod=t,this.grad=t.grad,this.modal=(0,i.Ay)("workspace").appendChild((0,i.T)("div",{id:"grad-editor-modal",className:"modal"}));let e=(0,i.T)("div",{style:"position:relative"}),s=(0,i.T)("div",{className:"option",style:"display:flex;position:relative"});this.container=(0,i.T)("div",{id:"grad-editor"},e,s),this.container.classList.add("grad-editor-float"),(0,i.Ay)("workspace").appendChild(this.container),this.preview=(0,i.T)("div",{id:"grad-editor-preview"}),this.stoplist=(0,i.T)("div",{id:"grad-editor-stoplist"}),this.addlist=(0,i.T)("div",{id:"grad-editor-addlist"}),e.append((0,i.T)("div",{id:"grad-editor-preview-holder"},this.preview),this.stoplist,this.addlist),s.append((0,i.T)("div",{id:"grad-editor-opacity"}),(0,i.T)("ul",{className:"icon-button-set",style:"margin-left:auto"},(0,i.T)("li",{id:"grad-editor-remove"},(0,i.T)("img",{src:"/img/icon/delete.svg",className:"ic"}))));const a=(0,i.Ay)("grad-editor-remove");a.setAttribute("tooltip",(0,n.A)("removeStop")),a.setAttribute("flow","down"),a.addEventListener("click",this.removeStop,!0);let l=this.gradpod.container.getBoundingClientRect();this.modal.addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault(),t.target===t.currentTarget&&this.cleanUp()}),!1),this.container.style.top=l.bottom+5+"px",this.container.style.left=l.left-5+"px",this.container.style.display="flex",this.preview=(0,i.Ay)("grad-editor-preview"),this.opacity=new r.A("grad-editor-opacity",{label:(0,n.A)("opacity")+":",compact:!0,defaultValue:1,labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100,onChange:t=>{this.selected.color.a=Math.round(255*t),this.updatePreview()}}),this.addlist.addEventListener("click",this.addStop,!1),this.populateStops(),this.setHandlers(),this.updatePreview()}}class c{constructor(t,e,s=!1){this.update=t=>{this.grad=t,this.container.style.backgroundImage=this.grad.toCSS()},this.picker=()=>{this.mini?new l(this):new a.A(void 0,this,this.update)},this.cleanUp=()=>{this.container.removeEventListener("click",this.picker,!1)},this.grad=e,this.mini=s,this.container=(0,i.Ay)(t),this.container.classList.add("grad-pod"),this.container.style.backgroundImage=this.grad.toCSS(),this.container.addEventListener("click",this.picker,!1)}}},58354:(t,e,s)=>{s.d(e,{A:()=>p});var i=s(21742),a=s(54738),n=s(82042),o=s(42268),r=s(41915),h=s(8689),l=s(15818),c=s(81937),d=s(29755),u=s(16309);class p{constructor(t,e,s,p=!1){this.populatePresets=()=>{let t=[new u.mR([d.Ay.mainColor+"FF",d.Ay.altColor+"FF"],[0,1]),new u.mR(["#000000FF","#FFFFFFFF"],[0,1]),new u.mR(["#999999FF","#03205AFF","#000000FF"],[0,.5,1]),new u.mR(["#000000FF","#00000000"],[0,1]),new u.mR(["#FFFFFFFF","#FFFFFF00"],[0,1]),new u.mR(["#00A8DFFF","#323496FF","#CA1688FF","#EB2E2EFF","#FDE92DFF","#009E54FF"],[0,.2,.4,.6,.8,1]),new u.mR(["#0B01B8FF","#DE9E31FF","#0B01B8FF"],[.25,.5,.75]),new u.mR(["#000000FF","#FF0000FF"],[0,1]),new u.mR(["#FFFFFFFF","#FF0000FF"],[0,1]),new u.mR(["#FFFFFFFF","#00FF00FF"],[0,1]),new u.mR(["#FFFFFFFF","#0000FFFF"],[0,1]),new u.mR(["#00FFFFFF","#FF8000FF"],[0,1]),new u.mR(["#c2e59cff","#64b3f4ff"],[0,1]),new u.mR(["#8E0E00FF","#1F1C18FF"],[0,1]),new u.mR(["#f46b45FF","#eea849FF"],[0,1]),new u.mR(["#fc00ffff","#00dbdeff"],[0,1]),new u.mR(["#CCCCB2ff","#757519ff"],[0,1]),new u.mR(["#F1F2B5FF","#135058FF"],[0,1]),new u.mR(["#7b4397FF","#dc2430FF"],[0,1]),new u.mR(["#8e9eabFF","#eef2f3FF"],[0,1]),new u.mR(["#00bf8fFF","#001510FF"],[0,1]),new u.mR(["#ff0084FF","#33001bFF"],[0,1]),new u.mR(["#833ab4FF","#fd1d1dFF","#fcb045FF"],[0,.5,1]),new u.mR(["#FEAC5EFF","#C779D0FF","#fcb045FF"],[0,.5,1]),new u.mR(["#6441A5FF","#2a0845FF"],[0,1]),new u.mR(["#43cea2FF","#185a9dFF"],[0,1]),new u.mR(["#FFA17FFF","#00223EFF"],[0,1]),new u.mR(["#360033FF","#0b8793FF"],[0,1]),new u.mR(["#948E99FF","#2E1437FF"],[0,1]),new u.mR(["#1e130cFF","#9a8478FF"],[0,1]),new u.mR(["#D38312FF","#A83279FF"],[0,1]),new u.mR(["#70e1f5FF","#ffd194FF"],[0,1]),new u.mR(["#556270FF","#ff6b6bFF"],[0,1]),new u.mR(["#000000FF","#e74c3cFF"],[0,1]),new u.mR(["#f0c27bff","#4b1248ff"],[0,1]),new u.mR(["#fbd3e9ff","#bb377dff"],[0,1]),new u.mR(["#649173ff","#dbd5a4ff"],[0,1]),new u.mR(["#b993d6ff","#8ca6dbff"],[0,1]),new u.mR(["#d3959bff","#bfe6baff"],[0,1]),new u.mR(["#dad299ff","#b0dab9ff"],[0,1]),new u.mR(["#f2709cff","#ff9472ff"],[0,1]),new u.mR(["#5d4157ff","#a8cabaff"],[0,1]),new u.mR(["#ddd6f3ff","#faaca8ff"],[0,1]),new u.mR(["#fc354cff","#0abfbcff"],[0,1]),new u.mR(["#414d0bff","#727a17ff"],[0,1]),new u.mR(["#134e5eff","#71b280ff"],[0,1]),new u.mR(["#2bc0e4ff","#eaecc6ff"],[0,1]),new u.mR(["#603813ff","#b29f94ff"],[0,1]),new u.mR(["#bbd2c5FF","#536976FF","#292e49FF"],[0,.5,1]),new u.mR(["#1e9600FF","#fff200FF","#ff0000FF"],[0,.5,1]),new u.mR(["#06beb6ff","#48b1bfff"],[0,1]),new u.mR(["#eb3349ff","#f45c43ff"],[0,1]),new u.mR(["#56ab2fff","#a8e063ff"],[0,1]),new u.mR(["#614385ff","#516395ff"],[0,1]),new u.mR(["#ddd6f3ff","#faaca8ff"],[0,1]),new u.mR(["#3a1c71FF","#d76d77FF","#ffaf7bFF"],[0,.5,1]),new u.mR(["#4ca1afff","#c4e0e5ff"],[0,1]),new u.mR(["#dbdcd7ff","#b8235aff","#801357ff","#3d1635ff","#1c1a27ff"],[0,.59,.71,.84,1]),new u.mR(["#f83600ff","#f9d423ff"],[0,1]),new u.mR(["#71a192ff","#b7bb81ff","#f5b752ff","#db6549ff","#7b4163ff"],[0,.25,.5,.8,1]),new u.mR(["#00737AFF","#DE5159FF","#7F3038ff","#150C14FF"],[0,.5,.75,1]),new u.mR(["#8FB9A8FF","#FEFAD4FF","#FCD0BAff","#F1828DFF","#765D69FF"],[0,.4,.5,.75,1]),new u.mR(["#F26627FF","#F9A26CFF","#EFEEEEff","#98D7D1FF","#325D79FF"],[0,.3,.5,.75,1]),new u.mR(["#F18C8EFF","#F0B7A4FF","#F1D1B5ff","#568EA6FF","#305F72FF"],[0,.3,.5,.75,1]),new u.mR(["#FCBB6DFF","#D8737FFF","#AB6CB2FF","#685D79FF","#475C7AFF"],[0,.3,.5,.75,1]),new u.mR(["#CC2A49FF","#F99E4CFF","#F36F38FF","#EF4648FF","#582841FF"],[0,.3,.5,.75,1]),new u.mR(["#092B38FF","#9C5773FF","##CDCDC5FF"],[0,.5,1]),new u.mR(["#009e00FF","#ffff96FF"],[0,1]),new u.mR(["#fcce78FF","#7e2d02FF"],[0,1]),new u.mR(["#ffdb01FF","#0e197dFF"],[0,1]),new u.mR(["#B4C6CCFF","#FE4929FF"],[0,1]),new u.mR(["#B71970FF","#01416DFF"],[0,1]),new u.mR(["#471B0DFF","#F0E867FF"],[0,1]),new u.mR(["#1A2713FF","#E2EAB1FF"],[0,1]),new u.mR(["#B03F2AFF","#FFEBB0FF"],[0,1])];const e=(0,o.Ay)("grad-selector-presets-ss-content");if(this.extended){const t=(0,o.T)("div",{className:"grad-pod square empty"});t.setAttribute("data","empty"),t.addEventListener("click",this.selectPreset,!0),e.append(t)}t.forEach((t=>{const s=(0,o.T)("div",{className:"grad-pod square",style:"background:"+t.toCSS()});s.setAttribute("data",JSON.stringify(t)),s.addEventListener("click",this.selectPreset,!0),e.append(s)}))},this.selectPreset=t=>{this.removeHandlers(),this.marked&&this.marked.classList.remove("selected"),this.marked=t.currentTarget,this.marked.classList.add("selected"),"empty"!==this.marked.getAttribute("data")?(this.grad=u.Ay.fromPreset(a.bD(u.mR,JSON.parse(this.marked.getAttribute("data")))),this.extended&&(this.grad.direction=this.direction.getValue(),this.grad.type=(0,o.Ay)("grad-type-linear").checked?"linear":"radial"),this.populateStops(),this.updatePreview()):this.callback&&this.callback(void 0)},this.setGrad=t=>{this.grad=t,this.extended&&((0,o.Ay)("grad-type-linear").checked="linear"===this.grad.type,(0,o.Ay)("grad-type-radial").checked="radial"===this.grad.type,this.direction.setValue(this.grad.direction)),this.removeHandlers(),this.populateStops(),this.updatePreview(!1)},this.directionChange=()=>{this.grad.direction=this.direction.getValue(),this.updatePreview()},this.typeChange=t=>{let e=t.target;this.grad.type="linear"===e.value?"linear":"radial",(0,o.Ay)("grad-direction").style.display="linear"===this.grad.type?"flex":"none",this.updatePreview()},this.updatePreview=(t=!0)=>{this.preview.style.backgroundImage=this.grad.toCSS(),this.callback&&t&&this.callback(this.grad)},this.populateStops=()=>{this.stoplist.innerHTML="";for(let t=0;t<this.grad.stops.length;++t){const e=Math.round(this.width*this.grad.stops[t].position);this.stoplist.append((0,o.T)("div",{id:this.grad.stops[t].id,className:"knob",style:"left:"+e+"px"},(0,o.T)("div",{className:"bg ic"}),(0,o.T)("div",{className:"color",id:this.grad.stops[t].id+"-color",style:"background:"+this.grad.stops[t].color.toHEX()})))}this.setHandlers()},this.addStop=t=>{t.stopPropagation(),t.preventDefault();const e=this.grad.addStop(this.colorpod.getColor().clone(),Math.round(t.offsetX)/this.width),s=Math.round(this.width*e.position),i=(0,o.T)("div",{id:e.id,className:"knob",style:"left:"+s+"px"},(0,o.T)("div",{className:"bg ic"}),(0,o.T)("div",{className:"color",id:e.id+"-color",style:"background:"+e.color.toHEX()}));i.addEventListener("mousedown",this.mouseDown,!0),i.addEventListener("touchstart",this.touchStart,{passive:!0}),this.stoplist.append(i),this.selectStop(e.id),this.updatePreview()},this.removeStop=()=>{if(this.grad.stops.length>2){(0,o.Ay)(this.selected.id)&&(0,o.Ay)(this.selected.id).remove();const t=this.grad.removeStop(this.selected.id);this.selected=void 0,this.selectStop(t),this.updatePreview()}},this.selectStop=t=>{this.selected&&this.selected.id===t||(this.selected&&(0,o.Ay)(this.selected.id)&&(0,o.Ay)(this.selected.id).classList.remove("selected"),this.selected=this.grad.getStop(t),(0,o.Ay)(this.selected.id).classList.add("selected"),this.colorpod.setColor(this.selected.color),this.opacity.setValue(this.selected.color.a/255),(0,o.Ay)("grad-selector-remove").classList.toggle("disabled",this.grad.stops.length<3))},this.down=(t,e,s)=>{this.selectStop(s.id),this.downX=t,this.target=s,this.start=s.offsetLeft+6},this.move=(t,e,s=!0)=>{let i=a.qE(this.start+(t-this.downX),0,this.width);this.target.style.left=i+"px",this.selected.position=i/this.width,this.grad.sort(),this.updatePreview(s)},this.setHandlers=()=>{const t=document.querySelectorAll("#grad-selector-stoplist > .knob");for(let e=0;e<t.length;e++)t[e].addEventListener("mousedown",this.mouseDown,!0),t[e].addEventListener("touchstart",this.touchStart,{passive:!0}),0===e&&this.selectStop(t[e].id)},this.removeHandlers=()=>{const t=document.querySelectorAll("#grad-selector-stoplist > .knob");for(let e=0;e<t.length;e++)t[e].removeEventListener("mousedown",this.mouseDown,!0),t[e].removeEventListener("touchstart",this.touchStart)},this.touchStart=t=>{t.stopPropagation(),this.down(t.changedTouches[0].clientX,t.changedTouches[0].clientY,t.currentTarget),document.addEventListener("touchmove",this.touchMove,{passive:!0}),document.addEventListener("touchend",this.touchEnd,{passive:!0})},this.touchMove=t=>{t.stopPropagation(),this.move(t.changedTouches[0].clientX,t.changedTouches[0].clientY,!1)},this.touchEnd=t=>{t.stopPropagation(),this.move(t.changedTouches[0].clientX,t.changedTouches[0].clientY,!0),document.removeEventListener("touchmove",this.touchMove),document.removeEventListener("touchend",this.touchEnd)},this.mouseDown=t=>{t.preventDefault(),t.stopPropagation(),this.down(t.clientX,t.clientY,t.currentTarget),document.addEventListener("mousemove",this.mouseMove,!0),document.addEventListener("mouseup",this.mouseUp,!0)},this.mouseMove=t=>{t.stopPropagation(),this.move(t.clientX,t.clientY,!1)},this.mouseUp=t=>{t.stopPropagation(),t.preventDefault(),this.move(t.clientX,t.clientY,!0),document.removeEventListener("mousemove",this.mouseMove,!0),document.removeEventListener("mouseup",this.mouseUp,!0)},this.resizeStart=t=>{this.d=new r.A(this.container.clientHeight,t.y)},this.resizeMove=t=>{const e=this.d.x+(t.y-this.d.y);this.container.style.height=(e<320?320:e)+"px"},this.cleanUp=()=>{var t;this.removeHandlers(),this.addlist.removeEventListener("click",this.addStop,!0),(0,o.Ay)("grad-selector-remove").removeEventListener("click",this.removeStop,!0),this.container.remove(),null===(t=this.modal)||void 0===t||t.remove()},this.extended=p,this.gradpod=e,this.grad=e?e.grad:u.Ay.fromColors(l.A.fromHEX(d.Ay.mainColor),l.A.fromHEX(d.Ay.altColor)),this.callback=s,this.asControl=!e,this.asControl||(this.modal=(0,o.Ay)("workspace").appendChild((0,o.T)("div",{id:"grad-selector-modal",className:"modal"})));let g=(0,o.T)("div",{style:"position:relative"}),m=(0,o.T)("div",{className:"option",style:"display:flex;justify-content: space-between"}),v=(0,o.T)("div",{id:"grad-selector-presets",className:"top-10"});if(this.container=(0,o.T)("div",{id:"grad-selector"},g,m),t?t.appendChild(this.container):(this.container.classList.add("grad-selector-float"),(0,o.Ay)("workspace").appendChild(this.container)),this.preview=(0,o.T)("div",{id:"grad-selector-preview"}),this.stoplist=(0,o.T)("div",{id:"grad-selector-stoplist"}),this.addlist=(0,o.T)("div",{id:"grad-selector-addlist"}),g.append((0,o.T)("div",{id:"grad-selector-preview-holder"},this.preview),this.stoplist,this.addlist),m.append((0,o.T)("div",{id:"grad-selector-opacity"}),(0,o.T)("label",{className:"tab-30",style:"width:unset"},(0,i.A)("color")+":"),(0,o.T)("div",{id:"grad-selector-color",className:"tab-5"}),(0,o.T)("ul",{className:"icon-button-set",style:"margin-left:auto"},(0,o.T)("li",{id:"grad-selector-remove"},(0,o.T)("img",{src:"/img/icon/delete.svg",className:"ic"})))),this.container.append((0,o.T)("div",{className:"splitter top-8"})),p){let t=(0,o.T)("div",{className:"option top-10",style:"display:flex;justify-content: space-between"});t.innerHTML+=`\n                    <div id="gradient-type" class="switch-field">\n                        <input type="radio" id="grad-type-linear" name="grad-type" value="linear" checked/><label for="grad-type-linear">${(0,i.A)("linear")}</label>\n                        <input type="radio" id="grad-type-radial" name="grad-type" value="radial" /><label for="grad-type-radial">${(0,i.A)("radial")}</label>\n                    </div>\n                    <div id="grad-direction"></div>\n                    `,this.container.append(t),(0,o.Ay)("grad-type-linear").addEventListener("click",this.typeChange,!0),(0,o.Ay)("grad-type-radial").addEventListener("click",this.typeChange,!0),this.direction=new n.A("grad-direction",{label:(0,i.A)("direction")+":",compact:!0,range:[0,360],defaultValue:0,labelFormat:t=>t.toFixed(1),labelParse:t=>parseInt(t,10),onChange:this.directionChange})}this.container.append(v);const y=(0,o.Ay)("grad-selector-remove");if(y.setAttribute("tooltip",(0,i.A)("removeStop")),y.setAttribute("flow","down"),y.addEventListener("click",this.removeStop,!0),this.asControl)(0,o.Ay)("grad-selector-presets").style.height="180px";else{let t=this.gradpod.container.getBoundingClientRect();this.modal.addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault(),t.target===t.currentTarget&&this.cleanUp()}),!1),this.container.style.top=t.bottom+5+"px",this.container.style.left=t.left-~~(this.container.offsetWidth/2)+40+"px",this.container.style.display="flex",this.container.style.height="360px";const e=(0,o.T)("img",{src:"/img/icon/three-dot.svg",className:"resize ic"});(0,o.Bb)(e,this.resizeStart,this.resizeMove),this.container.append(e)}this.preview=(0,o.Ay)("grad-selector-preview"),this.opacity=new n.A("grad-selector-opacity",{label:(0,i.A)("opacity")+":",compact:!0,defaultValue:1,labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100,onChange:t=>{this.selected.color.a=Math.round(255*t),this.updatePreview()}}),this.colorpod=new h.A("grad-selector-color",new l.A,(t=>{t.a=this.selected.color.a,this.selected.color=t,(0,o.Ay)(this.selected.id+"-color").style.background=t.toHEX(),this.updatePreview()})),this.addlist.addEventListener("click",this.addStop,!1),this.width=g.clientWidth,this.populateStops(),this.setHandlers(),this.updatePreview(!1),new c.A((0,o.Ay)("grad-selector-presets")),this.populatePresets()}}},28754:(t,e,s)=>{s.d(e,{A:()=>a});var i=s(42268);class a{constructor(){this.notification=t=>{var e;const s=null!==(e=(0,i.Ay)("notification"))&&void 0!==e?e:this.addNotif();this.notiId&&(clearTimeout(this.notiId),s.innerHTML="",s.style.display="none"),requestAnimationFrame((()=>{s.style.display="block",s.innerHTML='<div class="message">'+t.detail+"</div>",this.position(s)})),this.notiId=setTimeout((function(){s.innerHTML="",s.style.top="-999px",s.style.left="-999px",s.style.display="none"}),1500)},this.legend=t=>{var e;const s=null!==(e=(0,i.Ay)("notification"))&&void 0!==e?e:this.addNotif();if("stop"===t.detail)return s.innerHTML="",s.style.top="-999px",s.style.left="-999px",void(s.style.display="none");s.style.display="block",""===s.innerHTML?s.innerHTML='<div id="legend" class="legend">'+t.detail+"</div>":(0,i.Ay)("legend")&&((0,i.Ay)("legend").innerText=t.detail),this.position(s)},this.loading=t=>{var e;const s=null!==(e=(0,i.Ay)("notification"))&&void 0!==e?e:this.addNotif();"stop"!==t.detail?(this.notiId&&(clearTimeout(this.notiId),s.innerHTML="",s.style.display="none"),this.notiId=setTimeout((()=>{this.keepLoading?this.keepLoading=!1:(s.innerHTML="",s.style.top="-999px",s.style.left="-999px",s.style.display="none")}),400),s.style.display="block",s.innerHTML=`\n            <div class="spinner">\n                <label class="working">${"start"===t.detail?"Loading":t.detail}</label>\n            </div>\n        `,this.keepLoading=!0,this.position(s)):this.keepLoading?this.keepLoading=!1:(s.innerHTML="",s.style.display="none")},this.addNotif=()=>{const t=(0,i.T)("div",{id:"notification"});return document.body.append(t),t},this.position=t=>{let e=0!==document.getElementsByClassName("modal").length,s=(0,i.Ay)("splash")&&"none"!==(0,i.Ay)("splash").style.display,a=0!==document.getElementsByClassName("canvas").length;if(e||s||!a)t.style.top=Math.round(document.body.clientHeight/2-t.clientHeight/2)+"px",t.style.left=Math.round(document.body.clientWidth/2-t.clientWidth/2)+"px";else{const e=document.querySelector(".canvas").getBoundingClientRect();t.style.top=Math.round(e.height/2+e.top-t.clientHeight/2)/1.5+"px",t.style.left=Math.round(e.width/2+e.left-t.clientWidth/2)+"px"}},document.addEventListener("legend",(t=>this.legend(t)),!0),document.addEventListener("loading",(t=>this.loading(t)),!0),document.addEventListener("notification",(t=>this.notification(t)),!0)}}},53872:(t,e,s)=>{s.d(e,{A:()=>u});var i=s(21742),a=s(54738),n=s(82042),o=s(42268),r=s(15818),h=s(81937),l=s(14871),c=s(6395),d=s(96785);class u{constructor(t,e){this.populatePresets=async()=>{const t=await fetch("/pattern/index.json"),e=await t.json(),s=(0,o.Ay)("pattern-selector-presets-ss-content"),i=(0,o.T)("div",{className:"pattern-pod empty"});i.setAttribute("data","empty"),i.addEventListener("click",this.selectPreset,!0),s.append(i),e.packs.forEach((t=>{t.assets.forEach((e=>{const i="/pattern/"+t.name+"/"+e,a=(0,o.T)("div",{className:"pattern-pod"});a.setAttribute("data",i),a.addEventListener("click",this.selectPreset,!0),a.style.backgroundImage="url("+i+")",s.append(a)}))}))},this.populatePack=()=>{},this.selectPreset=async t=>{this.marked&&this.marked.classList.remove("selected"),this.marked=t.currentTarget,this.marked.classList.add("selected");let e=this.marked.getAttribute("data");if("empty"===e)this.pattern=void 0;else{if(!this.pattern){let t=this.scale.getValue();this.pattern=new l.A(void 0,t<0?1+t/12.5:1+t,this.direction.getValue())}this.pattern.svg=await fetch(e+"?ref").then((t=>t.text()));let t=new Blob([this.pattern.svg],{type:"image/svg+xml"});this.pattern.image=await(0,c.Ep)(t),this.extractColors()}this.updatePreview()},this.changeColor=t=>{this.colorPod=t.currentTarget,new d.A(r.A.fromHEX(this.colorPod.title),this.setColor)},this.extractColors=()=>{let t=[];this.pattern.svg.replace(/fill:?=?"?(#[abcdef0-9]{3,8})/gi,(function(e,s){return t.push(s),e})),this.pattern.svg.replace(/stroke:?=?"?(#[abcdef0-9]{3,8})/gi,(function(e,s){return t.push(s),e}));t=t.filter(((t,e,s)=>s.indexOf(t)===e)).slice(0,10);let e=(0,o.Ay)("pattern-color-list");e.innerHTML="",t.forEach((t=>{e.appendChild((0,o.T)("div",{onclick:this.changeColor,className:"color-pod small",title:t,style:"border:none;border-radius:3px;display:inline-block;margin:5px 5px 5px 0px;background-color:"+t}))}))},this.setColor=async t=>{let e=this.colorPod.title,s=t.toHEX();this.colorPod.title=s,this.colorPod.style.backgroundColor=s;var i=new RegExp(e,"g");this.pattern.svg=this.pattern.svg.replace(i,s);let a=new Blob([this.pattern.svg],{type:"image/svg+xml"});this.pattern.image=await(0,c.Ep)(a),this.updatePreview()},this.setPattern=t=>{this.pattern=t;let e=this.pattern.scale;this.scale.setValue(e<1?-12.5*(1-e):e-1),this.direction.setValue(this.pattern.direction),this.extractColors(),this.updatePreview()},this.scaleChange=t=>{this.pattern&&(t=t<0?1+t/12.5:1+t,this.pattern.scale=t,this.updatePreview(!1))},this.directionChange=t=>{this.pattern&&(this.pattern.direction=t,this.updatePreview(!1))},this.updatePreview=(t=!0)=>{this.pattern?(this.ctx.save(),this.ctx.fillStyle=this.pattern.createCanvasPattern(this.ctx),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore()):this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.callback&&t&&this.callback(this.pattern)},this.callback=e,this.canvas=a.VI(300,120),this.canvas.classList.add("transparent"),this.canvas.style.borderRadius="2px",this.ctx=this.canvas.getContext("2d");let s=(0,o.T)("div",{className:"option top-5",style:"display:flex;"},(0,o.T)("div",{id:"pattern-scale"}),(0,o.T)("div",{id:"pattern-direction",className:"tab-20"})),u=(0,o.T)("div",{id:"pattern-color-list",style:"display:block;"}),p=(0,o.T)("div",{id:"pattern-selector-top"},this.canvas,u,s),g=(0,o.T)("div",{id:"pattern-selector-presets",className:"top-10"});this.container=(0,o.T)("div",{id:"pattern-selector"},p,(0,o.T)("div",{className:"splitter top-8"}),g),t.appendChild(this.container),new h.A((0,o.Ay)("pattern-selector-presets")),this.scale=new n.A("pattern-scale",{label:(0,i.A)("scale")+":",compact:!0,range:[-10,10],defaultValue:0,labelFormat:t=>t.toFixed(1),labelParse:t=>parseInt(t,10),onChange:this.scaleChange,onEnd:()=>this.updatePreview()}),this.direction=new n.A("pattern-direction",{label:(0,i.A)("direction")+":",compact:!0,range:[0,360],defaultValue:0,labelFormat:t=>t.toFixed(1),labelParse:t=>parseInt(t,10),onChange:this.directionChange,onEnd:()=>this.updatePreview()}),this.populatePresets()}}},81937:(t,e,s)=>{s.d(e,{A:()=>a});var i=s(42268);class a{constructor(t){for(this.scrollTop=()=>{this.content.scrollTo(0,0)},this.moveBar=t=>{let e=this.content.scrollHeight,s=this.content.clientHeight;if(this.scrollRatio=s/e,this.scrollRatio>=1)this.bar.classList.add("ss-hidden");else{this.bar.classList.remove("ss-hidden");const t=Math.max(this.scrollRatio*s,20),i=this.content.scrollTop/(e-s)*(s-t);this.bar.style.cssText="height:"+t+"px; top:"+i+"px"}},t.classList.add("ss-wrapper"),this.content=(0,i.T)("div",{id:t.id+"-ss-content",className:"ss-content"});t.firstChild;)this.content.appendChild(t.firstChild);t.appendChild(this.content),this.bar=(0,i.T)("div",{className:"ss-scroll"}),t.append(this.bar);let e=t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var e=t.pageY-this.lastPageY;this.lastPageY=t.pageY,this.content.scrollTop+=e/this.scrollRatio},s=t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),document.removeEventListener("mousemove",e,!0),document.removeEventListener("mouseup",s,!0)};this.bar.addEventListener("mousedown",(t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),this.lastPageY=t.pageY,document.addEventListener("mousemove",e,!0),document.addEventListener("mouseup",s,!0)}),!0),this.moveBar(null),window.addEventListener("resize",this.moveBar),this.content.addEventListener("click",this.moveBar),this.content.addEventListener("scroll",this.moveBar),this.content.addEventListener("mouseenter",this.moveBar)}}},42903:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(21742),a=s(54738),n=s(22866),o=s(23556);class r{constructor(t,e){this.apply=()=>{setTimeout((()=>{const t=this.selected.trim?this.selected.trim.clone():this.selected.rect.clone(),e=a.oM(this.selected.canvas);if(this.selected.type!==n.A.TYPE_FRAME&&this.stage.fresco.hasSelection()){let t=a.Nw(e.width,e.height),i=t.getContext("2d");i.drawImage(this.shaders.apply(this.selected.canvas),0,0),i.globalCompositeOperation="destination-in",i.drawImage(this.stage.fresco.selection.mask,-this.selected.rect.x,-this.selected.rect.y);var s=this.selected.canvas.getContext("2d");s.drawImage(t,0,0),s=void 0,i=void 0,t=void 0}else this.selected.replaceCanvas(this.shaders.apply(this.selected.canvas));this.selected.render(),this.stage.history.add({type:"bitmapSwitch",kind:this.kind,layer:this.selected,rect:t,canvas:e}),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)(this.kind)})),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))}))},this.kind=e,this.stage=t,this.shaders=new o.A,this.selected=this.stage.fresco.getSelected()}}},86755:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(42268),a=s(17651);class n{constructor(t,e,s){this.path="M 0,0 H 100 V 100 H 0 Z",this.previewPath=t=>{this.setPath(t),this.preview&&this.preview(this.path)},this.callbackPath=t=>{this.setPath(t),this.callback&&this.callback(this.path)},this.setPath=t=>{this.path=t;let e=this.thumbnail.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height);const s=new Path2D;s.addPath(new Path2D(this.path),(new DOMMatrix).scale((e.canvas.width-2)/100,(e.canvas.height-2)/100)),e.save(),e.lineWidth=1,e.translate(1,1),e.strokeStyle="rgba(255, 255, 255, 0.4)",e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(s),e.stroke(s),e.restore()},this.getPath=()=>this.path,this.toggle=()=>{new a.A(this.container,this.path,this.callbackPath,this.previewPath)},this.cleanUp=()=>{this.container.setAttribute("data",this.path),this.container.removeEventListener("click",this.toggle,!1)},this.preview=s,this.callback=e,this.container=(0,i.Ay)(t),this.container.hasChildNodes()?(this.thumbnail=(0,i.Ay)(t+"-canvas"),this.container.hasAttribute("data")&&(this.path=this.container.getAttribute("data"))):(this.container.classList.add("shape-pod"),this.thumbnail=(0,i.T)("canvas",{id:t+"-canvas",width:30,height:30}),this.container.append(this.thumbnail)),this.container.addEventListener("click",this.toggle,!1),this.setPath(this.path)}}},17651:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(54738),a=s(41915),n=s(29755),o=s(42268),r=s(81937);class h{constructor(t,e,s,h){this.resizeStart=t=>{this.d=new a.A(this.container.clientHeight,t.y)},this.resizeMove=t=>{const e=this.d.x+(t.y-this.d.y);this.container.style.height=(e<200?200:e)+"px"},this.populatePresets=()=>{const t=(0,o.Ay)("shape-selector-presets-ss-content");t.style.paddingTop="6px",["M 0,0 H 100 V 100 H 0 Z","m3 0h94c1.66 0 3 1.34 3 3v94c0 1.66-1.34 3-3 3h-94c-1.66 0-3-1.34-3-3v-94c0-1.66 1.34-3 3-3z","m 6,0 h 88 c 3.324,0 6,2.676 6,6 v 88 c 0,3.324 -2.676,6 -6,6 H 6 C 2.676,100 0,97.324 0,94 V 6 C 0,2.676 2.676,0 6,0 Z","m 10,0 h 80 c 5.54,0 10,4.46 10,10 v 80 c 0,5.54 -4.46,10 -10,10 H 10 C 4.46,100 0,95.54 0,90 V 10 C 0,4.46 4.46,0 10,0 Z","m 20,0 h 60 c 11.08,0 20,8.92 20,20 v 60 c 0,11.08 -8.92,20 -20,20 H 20 C 8.92,100 0,91.08 0,80 V 20 C 0,8.92 8.92,0 20,0 Z","M 0,50 C 0,0 0,0 50,0 c 50,0 50,0 50,50 0,50 0,50 -50,50 C 0,100 0,100 0,50","m80 0c11.1 0 20 8.92 20 20v80h-80c-11.1 0-20-8.92-20-20v-80h80z","m80 100c11.1 0 20-8.92 20-20v-80h-80c-11.1 0-20 8.92-20 20v80h80z","m 100,50.000001 c 0,0 -3.52,6.8 -3.52,22.281 0,15.078 -5.18,18.578 -5.446,18.75 -0.144,0.228 -3.604,5.451 -18.753,5.451 C 56.8,96.482001 50,100 50,100 c 0,0 -6.801,-3.517999 -22.282,-3.517999 -15.131,0 -18.603,-5.217 -18.752,-5.45 -0.256,-0.164 -5.448,-3.65 -5.448,-18.751 C 3.518,56.8 0,50 0,50 0,50 3.518,43.200001 3.518,27.718001 3.518,12.594 8.729,9.118 8.968,8.966 8.971,8.961 8.975,8.955 8.982,8.945 9.293,8.48 12.96,3.518 27.719,3.518 43.199,3.518 50,0 50,0 c 0,0 6.828,3.518 22.309,3.518 14.756,0 18.425,4.962 18.736,5.427 v 0 0 c 0,0 5.435,3.892001 5.435,18.773 0,15.483 3.52,22.282 3.52,22.282001 z","m 11.538461,11.538461 c 15.384615,-15.3846148 61.538462,-15.3846148 76.923076,0 15.384613,15.384615 15.384613,61.538464 0,76.923079 -15.384614,15.38461 -61.538461,15.38461 -76.923076,0 -15.3846147,-15.384615 -15.3846147,-61.538464 0,-76.923079","M 0,50 C 0,14.5 14.500003,0 50,0 85.5,0 100,14.5 100,50 100,85.5 85.5,100 50,100 14.500003,100 0,85.5 0,50","m100 50a50 50 0 0 1-50 50 50 50 0 0 1-50-50 50 50 0 0 1 50-50 50 50 0 0 1 50 50z","m7.58 76.5 8.5-5.3c1.6 2.5 3.4 4.9 5.6 7.1 2.2 2.2 4.6 4.1 7.1 5.6l-5.3 8.5c16.2 10.1 36.8 10.1 53 0l-5.3-8.5c2.5-1.6 4.9-3.4 7.1-5.6 2.2-2.2 4.1-4.6 5.6-7.1l8.5 5.3c10.1-16.2 10.1-36.8 0-53l-8.5 5.3c-1.6-2.5-3.4-4.9-5.6-7.1-2.2-2.2-4.6-4.1-7.1-5.6l5.3-8.5c-16.2-10.1-36.8-10.1-53 0l5.3 8.5c-2.5 1.6-4.9 3.4-7.1 5.6-2.2 2.2-4.1 4.6-5.6 7.1l-8.5-5.3c-10.1 16.2-10.1 36.8 0 53z","m 80.100004,19.9 c -6.2,-6.2 -13.8,-9.9999998 -21.7,-11.5999998 L 50.000004,0 l -8.3,8.3000002 c -8,1.6 -15.6,5.4999998 -21.7,11.5999998 -6.1,6.1 -10.1,13.8 -11.7,21.8 L 0,50 8.300004,58.3 c 1.6,8 5.5,15.6 11.6,21.7 6.2,6.2 13.8,10 21.7,11.6 l 8.4,8.4 8.3,-8.3 c 8,-1.6 15.6,-5.5 21.7,-11.6 6.2,-6.2 10,-13.8 11.6,-21.7 L 100,50 91.700004,41.7 c -1.6,-8 -5.5,-15.6 -11.6,-21.8 z","M 31.278462,0.01959957 C 23.186769,-0.27097901 15.000275,2.6696037 8.8346993,8.8330525 -2.1173026,19.781307 -2.8922296,37.108219 6.5404597,48.953281 c 0.2422598,0.315753 0.3671413,0.681873 0.3705912,1.047372 -0.00343,0.3655 -0.1283314,0.73162 -0.3705912,1.047373 -9.4326893,11.845059 -8.6577623,29.171972 2.2942396,40.120231 10.9610277,10.957253 28.3079167,11.724463 40.1575537,2.269882 0.309131,-0.23713 0.666341,-0.332857 1.024148,-0.330053 0.366744,0.0034 0.734111,0.110187 1.051116,0.353625 11.847133,9.426729 29.131837,8.654389 40.083427,-2.293454 10.943446,-10.939723 11.751726,-28.273568 2.341393,-40.120231 -0.242377,-0.315753 -0.367656,-0.681856 -0.370591,-1.047373 0.0034,-0.365516 0.12816,-0.731619 0.370591,-1.047372 C 102.90267,37.106616 102.09439,19.772771 91.150944,8.8330525 80.199354,-2.1147875 62.91465,-2.8871348 51.067517,6.5395994 50.750512,6.7830358 50.383145,6.8897696 50.016401,6.8932183 49.658594,6.8966464 49.301384,6.8002786 48.992253,6.5631705 43.808027,2.4268049 37.571993,0.24560339 31.278462,0.01959957 Z","m87.074 36.937h-5.1102l3.6072-3.6036c5.1102-5.1051 5.1102-13.413 0-18.619-5.1102-5.2052-13.427-5.1051-18.637 0l-3.6072 3.6036v-5.1051c-0.1002-7.3073-5.9118-13.213-13.226-13.213s-13.126 5.9059-13.126 13.113v5.1051l-3.6072-3.6036c-5.1102-5.1051-13.427-5.1051-18.637 0-5.2104 5.1051-5.1102 13.413 0 18.619l3.6072 3.6036h-5.1102c-7.3146 0.1001-13.226 5.9059-13.226 13.213s5.9118 13.113 13.126 13.113h5.1102l-3.6072 3.6036c-5.1102 5.1051-5.1102 13.413 0 18.619 5.1102 5.1051 13.427 5.1051 18.637 0l3.6072-3.6036v5.1051c0 7.3073 5.9118 13.113 13.126 13.113 7.2144 0 13.126-5.9059 13.126-13.113v-5.1051l3.6072 3.6036c5.1102 5.1051 13.427 5.1051 18.637 0 5.1102-5.1051 5.1102-13.413 0-18.619l-3.6072-3.6036h5.1102c7.3146 0 13.126-5.9059 13.126-13.113s-5.7114-13.113-12.926-13.113z","m86.987 36.903h-0.4004c-1.7017 0-2.6026-2.1009-1.4014-3.3014 4.9049-4.9021 5.5055-12.806 1.1011-18.008-5.005-6.0026-14.014-6.3027-19.419-0.90039l-0.3003 0.30013c-1.2012 1.2005-3.3033 0.40017-3.3033-1.4006v-0.10004c0-6.8029-4.9049-12.706-11.712-13.406-7.9079-0.90039-14.615 5.3023-14.615 13.106v0.40017c0 1.7007-2.1021 2.6011-3.3033 1.4006-4.9049-4.9021-12.813-5.5024-18.018-1.1005-6.006 5.0022-6.3063 14.006-0.9009 19.408l0.3003 0.30013c1.2012 1.2005 0.4004 3.3014-1.4014 3.3014h-0.4004c-7.3073 0-13.213 5.8025-13.213 13.106s5.9059 13.106 13.113 13.106h0.4004c1.7017 0 2.6026 2.1009 1.4014 3.3014l-0.3003 0.30013c-5.4054 5.4023-5.1051 14.306 0.9009 19.408 5.3053 4.4019 13.213 3.8016 18.018-1.1005 1.2012-1.2005 3.3033-0.40017 3.3033 1.4006v0.40017c0 7.7033 6.7067 13.906 14.615 13.106 6.7067-0.7003 11.712-6.7029 11.712-13.406v-0.10004c0-1.7007 2.1021-2.6011 3.3033-1.4006l0.3003 0.30013c5.4054 5.4023 14.314 5.1022 19.419-0.90039 4.4044-5.3023 3.8038-13.206-1.1011-18.008-1.2012-1.2005-0.4004-3.3014 1.4014-3.3014h0.4004c7.3073 0 13.113-5.9026 13.113-13.106 0-7.2031-5.8058-13.106-13.013-13.106z","m 50.094148,0 c -2.77536,0 -5.553405,0.64778966 -8.038073,1.9436751 -4.969341,2.5917545 -8.12526,7.3889096 -8.12526,12.5724349 v 7.453361 c 0,0.578822 -0.337936,1.109289 -0.889248,1.398692 -0.551335,0.289419 -1.220173,0.289419 -1.771503,0 L 24.103777,19.55012 C 19.134436,16.958365 13.003954,16.956091 8.034594,19.546895 3.0652529,22.138666 0,26.935805 0,32.11933 c 0,5.183526 3.0652529,9.980681 8.034594,12.572435 l 7.372024,3.909398 c 0.551335,0.289402 0.889252,0.819867 0.889252,1.398693 0,0.578822 -0.34142,1.109269 -0.892736,1.398689 L 8.017166,55.27643 C 3.047806,57.868183 0,62.696853 0,67.88038 c 0,5.183523 3.0687318,9.980663 8.0380919,12.572433 4.9693411,2.591774 11.0963441,2.591757 16.0656851,0 l 7.270897,-3.821188 c 0.551331,-0.28942 1.223686,-0.28942 1.775002,0 0.551349,0.289402 0.781158,0.816711 0.781139,1.395533 v 7.4566 c 0,5.183527 3.159398,9.98068 8.128739,12.572437 2.464461,1.285337 5.187223,1.933208 7.940444,1.943659 2.798399,0.01131 5.627343,-0.637226 8.132242,-1.943659 4.969341,-2.591757 8.031091,-7.38891 8.031091,-12.572437 L 66.069191,78.0304 c -0.0071,-0.578792 0.233307,-1.109291 0.784623,-1.398693 0.55133,-0.28942 1.220187,-0.28942 1.771518,0 l 7.270897,3.814881 c 4.969341,2.59177 11.099823,2.59177 16.069183,0 C 96.934748,77.854835 100,73.057677 100,67.874155 c 0,-5.183527 -3.065252,-9.97752 -8.034593,-12.56929 l -7.372024,-3.909398 c -0.551335,-0.289403 -0.889252,-0.816712 -0.889252,-1.395533 0,-0.578822 0.34142,-1.109274 0.892736,-1.398689 L 91.986314,44.72336 C 96.955712,42.131607 100,37.302935 100,32.11941 c 0,-5.183526 -3.065252,-9.980665 -8.034593,-12.572436 -4.96936,-2.59177 -11.099842,-2.589496 -16.069183,0.0032 l -7.166287,3.818043 c -0.55133,0.289419 -1.220168,0.289419 -1.771504,0 -0.553971,-0.290258 -0.889247,-0.819951 -0.889247,-1.398772 v -7.45336 c 0,-5.1835253 -2.971084,-9.9806804 -7.940444,-12.5724349 C 55.644069,0.64778966 52.869527,0 50.094148,0 Z","m91.1 35c-5.89-2.87-9.49-9.71-8.79-16.8 1.4-14.2-13.1-23.5-23.5-15-5.2 4.19-12.3 4.19-17.6 0-10.4-8.39-25 0.883-23.6 15 0.699 7.06-2.9 13.9-8.79 16.8-11.8 5.74-11.8 24.3 0.0999 30 5.89 2.87 9.49 9.71 8.79 16.8-1.4 14.1 13.1 23.4 23.6 15 5.2-4.19 12.3-4.19 17.6 0 10.4 8.39 25-0.883 23.6-15-0.699-7.06 2.9-13.9 8.79-16.8 11.7-5.74 11.7-24.3-0.2-30z","m3.17 48.6 11.9 12.1c2.5 2.5 3.6 6.04 3 9.57l-2.8 17.1c-1.5 8.85 7.5 15.6 15.1 11.4l14.8-8.12c3-1.67 6.7-1.67 9.7 0l14.8 8.12c7.6 4.16 16.6-2.6 15.1-11.4l-2.8-17.1c-0.6-3.54 0.5-7.08 3-9.57l11.9-12.1c6.2-6.24 2.8-17.2-5.8-18.5l-16.5-2.5c-3.4-0.52-6.3-2.71-7.8-5.93l-7.4-15.6c-3.9-8.01-14.9-8.01-18.7 0l-7.4 15.6c-1.5 3.23-4.4 5.41-7.8 5.93l-16.6 2.5c-8.5 1.25-11.9 12.2-5.7 18.5z","m32 0v32h-32v36h32v32h36v-32h32v-36h-32v-32h-36z","m34 0v34h-34v32h34v34h32v-34h34v-32h-34v-34h-32z","m36 0v36h-36v28h36v36h28v-36h36v-28h-36v-36h-28z","m38 0v38h-38v24h38v38h24v-38h38v-24h-38v-38h-24z","m100 99.9-50-35.8-49.9 35.9 35.8-50-35.9-49.9 50 35.8 49.9-35.9-35.8 50z","m100 100-50-28.8-50 28.8 28.8-50-28.8-50 50 28.8 50-28.8-28.8 50z","M 49.999984,0 C 45.722878,0 41.617373,1.6978034 38.592988,4.7221408 35.56864,7.7464783 33.8708,11.851959 33.8708,16.129017 v 10.817782 c 0,0.536631 -0.264632,1.034533 -0.708796,1.335693 C 32.71784,28.583556 32.157866,28.64491 31.659343,28.4463 28.200473,27.227976 25.094977,26.165382 21.110455,24.796091 16.086103,23.159917 10.543614,24.078997 6.3094312,27.327976 1.7398721,30.834282 -0.61368155,36.514793 0.13813101,42.225271 0.88981729,47.934817 4.6342391,52.819843 9.9542542,55.02452 l 12.8340388,4.624495 c 0.454071,0.188081 0.796007,0.570582 0.932461,1.042725 0.136616,0.47213 0.05049,0.975225 -0.233116,1.376628 l -9.469586,11.983363 c -0.0016,0.0032 -0.0032,0.0064 -0.0064,0.0097 l -0.01292,0.01612 c -3.490018,4.566738 -4.2856042,10.656816 -2.085454,15.968359 2.204181,5.32135 7.082548,9.064235 12.793085,9.816024 5.700862,0.750526 11.377026,-1.594919 14.884848,-6.149189 0.0013,-0.0016 0.0016,-0.0048 0.0032,-0.0064 l 0.01612,-0.01612 9.110474,-11.532877 C 49.02707,81.758415 49.49722,81.527221 50,81.527253 c 0.50278,-3.2e-5 0.972926,0.231162 1.278995,0.630033 l 9.110471,11.532877 0.01612,0.01612 c 0.0016,0.0016 0.0016,0.0048 0.0032,0.0064 3.507825,4.55427 9.18399,6.899717 14.884849,6.149189 5.710536,-0.751789 10.588906,-4.494674 12.793088,-9.816024 2.20015,-5.311543 1.40456,-11.401621 -2.085454,-15.968359 l -0.01292,-0.01612 c -0.0032,-0.0032 -0.0048,-0.0064 -0.0064,-0.0097 L 76.51236,62.068368 c -0.283599,-0.401403 -0.369729,-0.904498 -0.233117,-1.376628 0.136454,-0.472143 0.478394,-0.854644 0.932462,-1.042725 L 90.045743,55.02452 c 5.320019,-2.204677 9.06444,-7.089703 9.816127,-12.799249 0.75181,-5.710478 -1.601741,-11.390989 -6.171301,-14.897295 -4.191331,-3.216093 -9.664607,-4.149222 -14.648313,-2.580787 -3.387709,1.174531 -7.124923,2.472013 -10.701602,3.699111 -0.498519,0.19861 -1.058493,0.137256 -1.502657,-0.163808 -0.4442,-0.30116 -0.708832,-0.799062 -0.708832,-1.335693 V 16.129017 c 0,-4.277058 -1.697837,-8.3825387 -4.722188,-11.4068762 C 58.382588,1.6978034 54.277082,0 49.999977,0 Z","m 95.097846,4.9018824 c -6.5362,-6.5358435 -17.184353,-6.5358426 -23.720548,-1.2e-6 L 50.028804,26.249213 c -0.425617,0.425594 -1.040135,0.586638 -1.621513,0.430837 L 21.08856,19.627522 c -5.785619,-1.55016 -11.9599597,0.09643 -16.1897377,4.310702 -2.1146391,2.107408 -3.5852443,4.695818 -4.33177648,7.481767 -0.74652914,2.785944 -0.76864986,5.766964 0.009252,8.649189 0.75867638,2.810944 2.22358978,5.323667 4.19641438,7.340366 2.0728318,2.11897 4.7064751,3.690254 7.6708358,4.484488 l 28.056935,6.416262 c 0.28639,0.0767 0.547033,0.231845 0.750533,0.435477 0.209661,0.209842 0.356755,0.473669 0.435495,0.769013 l 6.418482,28.038807 c 0.78666,2.935694 2.306363,5.484426 4.3105,7.49614 4.090458,4.10683 10.194583,5.980987 16.162376,4.38201 2.921791,-0.782839 5.455367,-2.303208 7.455498,-4.308661 4.086164,-4.097795 5.946157,-10.219785 4.339911,-16.214049 l -7.0571,-27.321448 c -0.155477,-0.581682 0.0075,-1.193522 0.433183,-1.619113 L 95.097852,28.621141 c 6.536198,-6.535842 6.536198,-17.183416 3e-6,-23.7192562 z","m 66.400001,0 -16.4,16.4 L 33.600001,0 0,33.6 16.400001,50 0,66.4 33.600001,100 l 16.4,-16.4 16.4,16.4 L 100,66.4 83.600001,50 100,33.6 Z","m 19.630485,54.1 -7.3903,7.8 v 0 L 0,75 30.715935,70.7 c 3.464203,-0.5 6.928406,1.2 8.083141,4.1 l 2.309469,5.2 1.847575,4.2 v 0 l 6.928406,15.8 6.928406,-15.8 v 0 l 1.847576,-4.2 2.309468,-5.2 c 1.270208,-2.9 4.618938,-4.6 8.083141,-4.1 L 99.999999,75 87.644341,61.9 v 0 l -7.3903,-7.8 c -2.193996,-2.4 -2.193996,-5.8 0,-8.1 l 5.889145,-6.3 1.385682,-1.5 v 0 L 99.999999,25 80.715935,27.7 v 0 L 69.168591,29.3 C 65.704387,29.8 62.240184,28.1 61.08545,25.2 L 58.775981,20 56.928406,15.8 v 0 L 50,0 43.071593,15.8 v 0 l -1.847575,4.2 -2.309469,5.2 c -1.270208,2.9 -4.618937,4.6 -8.083141,4.1 L 19.284064,27.7 v 0 L 0,25 12.355658,38.1 v 0 l 1.385681,1.5 5.889146,6.3 c 2.309469,2.4 2.309469,5.8 0,8.2 z","M 50,0 30.1,30.1 0,50 30.1,69.9 50,100.00001 69.9,69.9 100,50 69.9,30.1 Z","m73 64.6c-8.69 12.7-19.4 23.3-29.9 29.5-10.4 6.23-19.7 7.55-25.8 3.68-6.09-3.87-8.48-12.6-6.64-24.3 1.84-11.7 7.75-25.4 16.4-38.1 8.69-12.7 19.4-23.3 29.9-29.5 10.4-6.23 19.7-7.55 25.8-3.68 12.7 8.07 8.3 36-9.79 62.4z","M 33.606558,75.300005 50,100 66.393446,75.300005 H 100 L 83.255273,50 100,24.7 H 66.393446 L 50.000001,0 33.606558,24.7 H 0 L 16.744731,50 0,75.300005 Z","M 85.4,14.6 62.7,19.3 50,0 37.3,19.3 14.6,14.6 19.3,37.3 0,50 19.3,62.7 14.6,85.4 37.3,80.7 50,100 62.7,80.7 85.4,85.4 80.7,62.7 99.999999,50 80.7,37.3 Z","M 93.3,25 78.3,21.7 75,6.7 60.4,11.4 50,0 39.6,11.4 25,6.7 21.7,21.7 6.7,25 11.4,39.6 0,50 11.4,60.4 6.7,75 21.7,78.3 25,93.3 39.6,88.6 50,99.999997 60.4,88.6 75,93.3 78.3,78.3 93.3,75 88.6,60.4 100,50 88.6,39.6 Z","m 93.300004,25 -21.8,3.5 3.5,-21.8 -17.1,13.9 -7.9,-20.6 -7.9,20.6 L 25,6.7 28.5,28.5 6.7,25 20.6,42.1 0,50 20.6,57.9 6.7,75 28.5,71.5 25,93.3 42.100004,79.4 l 7.9,20.6 7.9,-20.6 17.1,13.9 -3.5,-21.8 21.8,3.5 -13.9,-17.1 L 100,50 79.400004,42.1 Z","m97.5 66.2-8.94 2.39 3.67 8.47-9.25 0.188 1.53 9.1-9.03-2.02-0.701 9.2-8.28-4.12-2.89 8.76-7.05-5.97-4.91 7.82-5.41-7.48-6.64 6.42-3.46-8.56-7.99 4.65-1.3-9.13-8.88 2.6 0.927-9.18-9.24 0.419 3.1-8.69-9.08-1.8 5.1-7.7-8.38-3.91 6.8-6.26-7.2-5.79 8.1-4.45-5.6-7.35 8.94-2.39-3.67-8.47 9.25-0.189-1.53-9.1 9.03 2.02 0.7-9.2 8.28 4.12 2.89-8.76 7.05 5.97 4.91-7.82 5.41 7.48 6.64-6.42 3.46 8.56 7.99-4.65 1.3 9.13 8.88-2.61-0.926 9.18 9.24-0.418-3.1 8.69 9.08 1.8-5.1 7.69 8.38 3.91-6.8 6.26 7.2 5.79-8.1 4.45z","m 0,43.5 v 0 C 0,67.5 22.413793,87 50.000001,87 v 13 C 77.586208,100 100,80.5 100,56.5 v 0 C 100,32.5 77.586208,13 50.000001,13 V 0 C 22.413793,0 0,19.5 0,43.5 Z","M 89.108383,36.593295 C 84.406622,31.890944 78.804523,28.789393 72.902312,27.088543 L 89.108383,10.88044 c -14.505434,-14.5072533 -38.01424,-14.5072533 -52.619712,0 v 0 c -4.701762,4.702351 -7.702886,10.305152 -9.403523,16.208103 L 10.879076,10.88044 c -14.5054345,14.507253 -14.5054345,38.019007 0,52.62631 v 0 c 4.701762,4.702351 10.30386,7.803902 16.206072,9.504752 L 10.879076,89.119555 c 14.505435,14.507255 38.014242,14.507255 52.619712,0 v 0 C 68.20055,84.417204 71.301712,78.814403 73.002349,72.911452 L 89.208421,89.119555 C 103.61382,74.612302 103.61382,51.100548 89.108383,36.593295 Z","m 86.783481,22.786394 c -1.602002,-1.6008 -3.30413,-3.101551 -5.106383,-4.402201 l 5.106383,-5.102552 c -17.722153,-17.7088548 -46.357948,-17.7088548 -63.979976,0 v 0 c -1.602002,1.600801 -3.10388,3.301651 -4.405507,5.102552 l -5.106383,-5.102552 c -17.7221533,17.708856 -17.7221533,46.323164 0,63.93197 v 0 c 1.602003,1.6008 3.30413,3.101551 5.106383,4.402201 l -5.106383,5.102552 c 17.722153,17.708856 46.357949,17.708856 63.979976,0 1.602003,-1.600801 3.10388,-3.301651 4.405507,-5.102552 l 5.106383,5.102552 c 17.622029,-17.608806 17.622029,-46.223114 0,-63.93197 z","m 80.419581,19.480519 4.895104,-4.895104 C 75.724276,5.0949053 61.838162,2.4975027 49.95005,6.8931071 V 0 C 36.463537,0 24.775225,7.9920082 19.480519,19.480519 L 14.585415,14.585415 C 5.0949051,24.175824 2.4975025,38.061938 6.8931069,49.95005 H 0 c 0,13.486513 7.992008,25.174825 19.480519,30.469531 l -4.895104,4.895104 c 9.590409,9.59041 23.376623,12.087912 35.364635,7.792208 V 100 c 13.486513,0 25.174825,-7.992008 30.469531,-19.480519 l 4.895104,4.895105 C 94.905099,75.824176 97.402601,62.037962 93.106897,50.04995 H 100 C 99.9001,36.463537 91.908096,24.775225 80.419581,19.480519 Z","m 50,83.6 16.4,16.4 H 100 V 66.4 L 83.600005,50 100.00001,33.6 V 0 H 66.400005 l -16.4,16.4 -16.4,-16.4 H 0 V 33.6 L 16.4,50 0,66.4 V 100 h 33.600005 z","m 84.915847,65.690376 c -23.436956,26.022959 -34.915933,34.30962 -34.915933,34.30962 0,0 -11.478977,-8.289949 -34.915929,-34.30962 C -8.3509667,39.671797 -2.4009791,6.9318151 18.693978,1.0456555 39.788935,-4.840504 49.999914,16.043854 49.999914,16.043854 c 0,0 10.210979,-20.884358 31.306936,-14.9981985 21.09296,5.8861596 27.04495,38.6261415 3.608997,64.6447205 z","M 100,61.688 C 100,82.848 77.615954,99.999996 50.000003,99.999996 22.385351,99.999996 0,82.848 0,61.687 0,40.526 50.000003,0 50.000003,0 50.000003,0 100,40.526 100,61.688 Z","m 100,25.001 v 50 L 50,100 0,75 V 25 L 50,0 Z","M 100,0 50,10.2 1e-5,0 10.2,50 0,100 50,90 100,100 90,50 Z","m0 100 50-100 50 100z","m0 100 100-100v100z","M 100,0 0,100 V 0 Z","m0 0 5 50-5 50h100l-5-50 5-50z","m0 0 10 50-10 50h100l-10-50 10-50z","m0 0 15 50-15 50h100l-15-50 15-50z","m0 0 20 50-20 50h100l-20-50 20-50z","m0 0v100h100l-20-50 20-50z","m0 0c23.7 41.8 16.7 58.2 0 100h100l-20-50 20-50z","m26.5 13.9c14.6-16 35-18.1 52.7-6.76 4.84 3.1 9 7.46 12.6 12.3 3.26 4.33 6.16 9.19 7.45 14.7 3.35 14.4-5.42 38.7-15.3 48.4-23.5 23-53.7 19.6-84 10.8 3.13-26.4 9.79-61.1 26.5-79.4","m3.19 53.1c-8.19-17-0.2-34.3 19.3-45.1 5.34-2.95 11.5-4.95 17.9-6.35 5.74-1.27 11.8-2.08 17.7-1.36 15.4 1.85 34.4 16.8 38.8 27.9 10.6 26.5-7.45 50-30.7 71.8-23.8-11-53.7-27.5-63-46.9","m0 100c4.57-4.05 6.77-9.47 8.71-14.7 5.19-14.1 9.48-28.4 16.3-42 6.85-13.6 16.5-26.6 30.6-35.8 8.59-5.6 20.3-9.73 30.5-6.23 7.58 2.62 12.4 9.11 13.6 15.8 1.15 6.64-0.866 13.4-3.84 19.6-7.45 15.6-20.9 29.1-37.1 39.5-16.2 10.4-35.1 17.7-54.6 23","m3.91 51.1c3.56-5.47 9.6-10.5 16-15.4 16.1-12.4 34.6-24 53.1-35.7 1.52 8.55 3.05 17.1 7.16 25.5 5.33 10.8 14.9 21.1 18.6 32.1 3.66 11 0.223 23.3-16.8 31-12.8 5.82-60.8 15-66.9 9.84-13.8-11.7-19.3-34.7-11-47.4","m94 10.3s-10.9-17.6-49.1-6.77c-38.2 10.9-44.8 57.2-44.8 57.2s-3.19 40.3 25.9 39.3c29.1-1.06 51.1 1.34 62-9.8 9.64-9.85 12.1-53 12-61.2-0.261-11.8-5.98-18.7-5.98-18.7z","m81.1 15.9c-8.87-9.29-9.11-15.9-34.4-15.9-17.6-0.034-31.7 4.09-40.8 22.7-3.29 6.69-8.52 26.1-4.19 36.8 3.17 7.83 15.3 6.46 17.9 14.4 3.78 11.4-4.65 26.3 6.27 25.9 29-1.06 56.6 3.72 67.5-7.4 9.62-9.83 5.88-47.2 6.37-55.5 0.684-11.8-9.7-11.7-18.6-21z","m40 0.0297c15.9-0.0929 60-0.797 60 15.4 0 17.3-22.3 21.8-21.9 34.5 0.344 12.7 21.8 8.37 21.7 30.3-0.134 22.1-40.2 19.6-59.7 19.7-19.5 0.0859-40.1-9.01-40-50 0.113-41 24.1-49.9 40-50z","m0 25c57.3 15.3 79.9 1.05 100-25v100h-99.9z","m0 25c29.5 13.7 38.7 2.17 48.5-5.79 16.2-13.2 20.5-17.7 51.5-19.2v100h-99.9z","m0 33c24.3 1.75 24.6-9.81 40.1-9.4 13 0.345 20.7-13.5 31.6-13.4 18.6 0.219 16.5-9.65 28.2-10.2v100h-99.9z","m0 21.4c24.3 1.75 25.5 20.3 33.9 20.3 6.34-1.17e-4 6.07-16.9 17-16.8 9.18 0.0074 13.4 12 25 5.09 8.44-5 19.1-29.7 24.1-29.9v100h-99.9z","m90 40v-10l-3.6-3.6v-12.8h-12.8l-3.6-3.6h-10l-10-10-10 10h-10l-3.6 3.6h-12.8v12.8l-3.6 3.6v10l-10 10 10 10v10l3.6 3.6v12.8h12.8l3.6 3.6h10l10 10 10-10h10l3.6-3.6h12.8v-12.8l3.6-3.6v-10l10-10z","M 80.8,12 100,32.6 79.9,85.1 H 74.2 L 50,100 25.8,85.1 H 20.1 L 0,32.6 19.2,12 V 5.2 L 50,0 80.8,5.2 Z","m0.425 69.8c-0.3-0.501-0.499-1-0.399-1.6l7.59-56.4c0.2-1.2 1.3-2.1 2.6-1.9 3.2 0.3 6.19 0.501 9.09 0.501 20 0 27.3-7.51 28.6-9.01 0.2-0.4 0.499-0.701 0.899-1 0.499-0.4 1.2-0.501 1.9-0.3s1.2 0.701 1.5 1.2c1.3 1.6 8.59 9.01 28.6 9.01 2.9 0 5.99-0.2 9.09-0.501 1.3-0.1 2.4 0.701 2.6 1.9l7.59 56.4c0.0998 0.601-0.0998 1.1-0.399 1.6-0.2 0.2-4.49 5.21-12.6 11.8-7.49 6.11-19.8 14.2-36 18.4-0.2 0.1-0.499 0.1-0.799 0.1h-0.0998c-0.3 0-0.599-0.1-0.899-0.2-16.2-4.2-28.6-12.3-35.9-18.4-8.29-6.51-12.6-11.4-12.8-11.6z","m100 50c0 7.08-2.1 13.6-5.6 18.7 0.2 0.674 0.4 1.46 0.6 2.13 0 0-15 15.7-45 29.2-30.1-13.5-45-29.2-45-29.2 0.2-0.674 0.4-1.46 0.6-2.13-3.5-5.06-5.6-11.6-5.6-18.7 0-9.21 3.5-17.3 9.1-22.8-1.1-6.07-2.9-10.4-4.3-13.3-1.1-2.25-0.2-4.94 2.1-5.96 16-7.08 35-7.98 43.1-7.98s27.1 0.899 43.2 8.09c2.3 1.01 3.2 3.71 2.1 5.96-1.4 2.81-3.2 7.19-4.3 13.3 5.5 5.39 9 13.5 9 22.7z","m100 50c-2.3 4.3-5.3 8.2-8.8 11.7 1.7 2.3 2.9 4.6 3.8 6.9-2.2 1-4.8 1.7-7.6 2.2 0.1 5-0.6 9.9-2 14.6-4.6 1.4-9.6 2.1-14.6 2-0.5 2.8-1.2 5.4-2.2 7.6-2.3-0.9-4.6-2.2-6.9-3.8-3.5 3.6-7.4 6.6-11.7 8.8-4.3-2.3-8.2-5.3-11.7-8.8-2.3 1.7-4.6 2.9-6.9 3.8-1-2.2-1.7-4.8-2.2-7.6-5 0.1-9.9-0.6-14.6-2-1.4-4.6-2.1-9.6-2-14.6-2.8-0.5-5.4-1.2-7.6-2.2 0.9-2.3 2.2-4.6 3.8-6.9-3.5-3.5-6.5-7.4-8.8-11.7 2.3-4.3 5.3-8.2 8.8-11.7-1.7-2.3-2.9-4.6-3.8-6.9 2.2-1 4.8-1.7 7.6-2.2-0.1-5 0.6-9.9 2-14.6 4.6-1.4 9.6-2.1 14.6-2 0.5-2.8 1.2-5.4 2.2-7.6 2.3 0.9 4.6 2.2 6.9 3.8 3.5-3.5 7.4-6.5 11.7-8.8 4.3 2.3 8.2 5.3 11.7 8.8 2.3-1.7 4.6-2.9 6.9-3.8 1 2.2 1.7 4.8 2.2 7.6 5-0.1 9.9 0.6 14.6 2 1.4 4.6 2.1 9.6 2 14.6 2.8 0.5 5.4 1.2 7.6 2.2-0.9 2.3-2.2 4.6-3.8 6.9 3.5 3.5 6.5 7.4 8.8 11.7z","m100 50c-0.1 6.4-3.8 11.4-8.2 13.8l0.1 18.9c0 6.5-5.1 6.9-5.1 6.9-24.5 0.1-36.8 10.4-36.8 10.4s-12.3-10.3-36.8-10.4c0 0-5.1-0.4-5.1-6.9l0.1-18.9c-4.4-2.4-8.1-7.4-8.2-13.8 0.1-6.4 3.8-11.4 8.2-13.8l-0.1-18.9c0-6.5 5.1-6.9 5.1-6.9 24.5-0.1 36.8-10.4 36.8-10.4s12.3 10.3 36.8 10.4c0 0 5.1 0.4 5.1 6.9l-0.1 18.9c4.4 2.4 8.1 7.4 8.2 13.8z","m100 50c-2.6 2.8-6.3 5.3-10.7 7.5l9.2 3.8c-2 0.2-3.9 0.7-5.7 1.5 1.5 2.2 2.6 4.3 3.5 6.4-2.1 0.9-4.4 1.6-7 2.1 0.7 1.8 1.7 3.5 3 5.1l-9.2-3.8c1.6 4.6 2.4 9 2.3 12.8-3.8 0.1-8.2-0.7-12.8-2.3l3.8 9.2c-1.6-1.3-3.3-2.3-5.1-3-0.5 2.6-1.2 4.9-2.1 7-2.1-0.8-4.3-2-6.4-3.5-0.8 1.8-1.3 3.7-1.5 5.7l-3.8-9.2c-2.2 4.4-4.7 8.1-7.5 10.7-2.8-2.6-5.3-6.3-7.5-10.7l-3.8 9.2c-0.2-2-0.7-3.9-1.5-5.7-2.2 1.5-4.3 2.6-6.4 3.5-0.9-2.1-1.6-4.4-2.1-7-1.8 0.7-3.5 1.7-5.1 3l3.8-9.2c-4.6 1.6-9 2.4-12.8 2.3-0.1-3.8 0.7-8.2 2.3-12.8l-9.2 3.8c1.3-1.6 2.3-3.3 3-5.1-2.6-0.5-4.9-1.2-7-2.1 0.8-2.1 2-4.3 3.5-6.4-1.8-0.8-3.7-1.3-5.7-1.5l9.2-3.8c-4.4-2.2-8.1-4.7-10.7-7.5 2.6-2.8 6.3-5.3 10.7-7.5l-9.2-3.8c2-0.2 3.9-0.7 5.7-1.5-1.5-2.2-2.6-4.3-3.5-6.4 2.1-0.9 4.4-1.6 7-2.1-0.7-1.8-1.7-3.5-3-5.1l9.2 3.8c-1.6-4.6-2.4-9-2.3-12.8 3.8-0.1 8.2 0.7 12.8 2.3l-3.8-9.2c1.6 1.3 3.3 2.3 5.1 3 0.5-2.6 1.2-4.9 2.1-7 2.1 0.8 4.3 2 6.4 3.5 0.8-1.8 1.3-3.7 1.5-5.7l3.8 9.2c2.2-4.4 4.7-8.1 7.5-10.7 2.8 2.6 5.3 6.3 7.5 10.7l3.8-9.2c0.2 2 0.7 3.9 1.5 5.7 2.2-1.5 4.3-2.6 6.4-3.5 0.9 2.1 1.6 4.4 2.1 7 1.8-0.7 3.5-1.7 5.1-3l-3.8 9.2c4.6-1.6 9-2.4 12.8-2.3 0.1 3.8-0.7 8.2-2.3 12.8l9.2-3.8c-1.3 1.6-2.3 3.3-3 5.1 2.6 0.5 4.9 1.2 7 2.1-0.8 2.1-2 4.3-3.5 6.4 1.8 0.8 3.7 1.3 5.7 1.5l-9.2 3.8c4.4 2.2 8.1 4.7 10.7 7.5z","m91.2 25.1c5.4 6.4 8.8 15.2 8.8 24.9s-3.4 18.5-8.8 24.9v5.1c0 4-3.6 7.2-8 7.2h0.8v2.2c0 4-4.1 4.2-4.1 4.2-20 0.1-30 6.4-30 6.4s-10-6.3-30-6.4c0 0-4.1-0.3-4.1-4.2v-2.2h0.8c-4.4 0-8-3.2-8-7.2v-5.1c-5.2-6.4-8.6-15.2-8.6-24.9s3.4-18.5 8.8-24.9v-5.1c0-4 3.6-7.2 8-7.2h-0.8v-2.2c0-4 4.1-4.2 4.1-4.2 19.9-0.1 29.9-6.4 29.9-6.4s10 6.3 30 6.4c0 0 4.1 0.3 4.1 4.2v2.2h-0.8c4.4 0 8 3.2 8 7.2v5.1z","m94.6 18.3c1.8 0.1 3.6 0.2 5.4 0.2v57.4c-3.5 0.8-15.3 4.2-15.9 15.3h-7.6c-2.3 1.3-5.4 2.4-9.1 3.3-0.9 0.2-1.9 0.4-2.9 0.6 0 0-2.2 0.5-3.3 0.8-3.6 0.9-8.9 2.5-11.2 4.1-2.2-1.6-7.6-3.2-11.2-4.1-1.1-0.3-3.3-0.8-3.3-0.8-1-0.2-1.9-0.4-2.9-0.6-3.7-0.9-6.8-2-9.1-3.3h-7.6c-0.6-11.1-12.4-14.5-15.9-15.3v-57.4c1.8 0 3.6-0.1 5.4-0.2 2.9-5.3 11.8-9.2 22.4-9.2h0.4c0.1-0.3 0.2-0.6 0.2-1 0.1-1.9 1.1-2.9 2.2-2.9h8.1c2-5.2 11.3-5.2 11.3-5.2s9.3 0 11.2 5.2h8.1c1.1 0 2.2 1 2.2 2.9 0 0.3 0.1 0.6 0.2 1h0.4c10.7 0 19.6 3.9 22.5 9.2z","m100 25.5v53.9s-0.3 3.7-4 4.8l-42.4 15s-2.6 0.8-3.6 0.8-3.6-0.8-3.6-0.8l-42.4-15c-3.6-1.1-4-4.8-4-4.8v-53.9c0-1.4 1.2-2.6 2.9-2.6h4.1v-5.2c10.3-0.4 12.2-8.8 12.2-8.8h4.5c0-2.2 1.3-3.3 2.7-3.3h9.9c2.4-5.6 13.7-5.6 13.7-5.6s11.3 0 13.7 5.5h9.9c1.4 0 2.7 1.1 2.7 3.3h4.5s1.9 8.5 12.2 8.8v5.2h4.1c1.7 0.1 2.9 1.3 2.9 2.7z","m93.3 30.5c2.3 0 4.61 0.3 6.71 1v41.8c-2.1 0.6-4.41 1-6.71 1v0.1c0 3-2.61 5.4-5.71 5.4h-3.31v0.2c0 3.7-3.91 6.6-8.72 6.6-1 0-2-0.2-2.91-0.4-2.2 2.9-5.51 5.4-9.72 7.2-0.802 0.4-1.7 0.7-2.61 1 0 0-2.1 0.9-3.11 1.4-2.1 1-5.01 2.6-7.21 4.2-2.3-1.7-5.11-3.2-7.21-4.2-1-0.5-3.11-1.4-3.11-1.4-0.902-0.3-1.8-0.6-2.61-1-4.21-1.8-7.62-4.3-9.72-7.2-0.902 0.2-1.9 0.4-2.91 0.4-4.81 0-8.72-3-8.72-6.6v-0.2h-3.31c-3.11 0-5.71-2.4-5.71-5.4v-0.1c-2.3 0-4.61-0.3-6.71-1v-41.8c2.1-0.6 4.41-1 6.71-1v-0.1c0-3 2.61-5.4 5.71-5.4 0.902-13.9 17.3-25 37.5-25 20.1 0 36.6 11.1 37.7 25 3.11 0 5.71 2.4 5.71 5.4z","m95.7 52c1.1 4.6 3.2 8.8 4.3 13.4-4.9 6-14.3 5.1-21.3 8.6-3.1 1.6-5.9 4.1-9.3 4.6-1.3 0.2-2.6 0-3.8 0.3-2.2 0.5-3.9 2.3-5.5 3.9-8.1 7.9-18.1 13.8-28.9 17.2v-7.7c-1.4 1.2-2.9 2.1-4.5 2.8-0.3-3 0.1-6.1 1-8.9 0.5-1.5 1.1-2.9 1.3-4.4 0.2-2.9-1.6-5.6-3.7-7.5s-4.7-3.4-6.8-5.3c-5.5-5-8-13.4-14.8-16.5 1.2-1.8 2.2-3.8 2.8-5.9-1.6 0.3-3.2 0.8-4.7 1.6 0.9-6.2 0.3-12.5-1.8-18.3 2.4-0.4 4.8-1.4 6.8-2.8l1.6-0.3c4.9-4.9 10.2-9.4 15.8-13.5 2.4-1.7 4.9-3.4 7.6-4.5 1.9-0.8 4-1.3 6-1.9 4.8-1.5 9.3-3.9 13.4-6.9 0.4 1.3 0.7 2.5 1.1 3.8 3.7-0.6 7.4 1.4 11.1 0.9 4.1-0.5 7.9-4 11.8-2.8 0.1 1.1 0.2 2.2 0.2 3.3 2-0.3 3 2.2 3.6 4.1 2.5 7.1 9.4 11.5 14.7 16.7 1.6 1.5 3.1 3.3 3.4 5.4 0.5 2.7-1.3 5.7-4 6.5 1.4 0.2 2.8 0.4 4.2 0.6-2.7 3.7-2.7 8.9-1.6 13.5z","m96.8 69.2c0.5 4.5 0.6 9.3 3.2 12.8-2.2 1.6-4.1 3.6-5.6 5.9-0.2-0.8-0.5-1.5-0.7-2.3-0.1 1.8-1.6 3.1-3.1 3.6-1.6 0.5-3.2 0.4-4.8 0.5-2.5 0.2-5 1-7.2 2.3-2 1.2-3.8 2.9-5.8 4-2 1.2-4.4 1.9-6.6 1.1 0.1-1.3 0.1-2.5 0.2-3.8-0.9 2-3.6 2.8-5.3 1.6-0.3 0.6-0.7 1.3-1 1.9-11.4 1.9-23.1 2.2-34.5 0.8 0.2-0.7 0.5-1.3 0.7-2-4.3 3.8-10.2 4.2-15.8 4.4 1.7-1.8 2.7-4.4 2.7-7 0-3.1-1.3-6-2.4-8.9-1.9-4.4-3.2-9.1-4.2-13.8-0.8-0.7-1.8-1-2.9-1 0.6-0.6 1.2-1.2 1.8-1.7-0.7-0.5-1.2-1.2-1.5-2 1.6-5 1.6-10.4 0-15.2-0.7-2.1-1.7-4.1-2.2-6.2-1.1-4.8 0.2-9.8 1.4-14.6 0.5 0 1 0.1 1.4 0.1-0.8-1.3-1.1-3-1.5-4.5-1-5.5-2-10.9-3.1-16.3 3.5 0.2 6.9-0.1 10.3-0.7 0.5 0.6 0.9 1.2 1.4 1.7l0.2-3.2c2.7-0.9 5.3-1.8 8-2.7 2.9-1 5.9-2 9-2.3 2.5-0.2 5.2 0 7.1-1.7 0 0.4-0.1 0.7-0.1 1.1 5-1.1 10.3-0.5 15.1 1.6 0 0.6 0.1 1.1 0.1 1.7 0.9-1.3 2.6-1.5 4-1.2 1.4 0.4 2.7 1.2 4 1.9 6.3 2.8 13.5 0.2 19.9-2.2 0.5-0.2 1.1-0.4 1.6-0.2s0.9 0.9 0.6 1.4c0.9-0.2 1.8-0.4 2.8-0.7-0.1 0.4-0.2 0.9-0.3 1.3 2.3 3.3 4.5 6.7 6.7 10.2 1.3 2 2.5 4.1 3.2 6.4 0.6 2 0.9 4.2 1.1 6.3l1.2 11.1c0.3 3 0.1 6.9-2.5 7.8 0.5 0.2 1.1 0.4 1.6 0.7-1.4 0.2-2.3 1.7-2.3 3.2-0.1 1.5 0.4 2.9 0.9 4.3 1.6 4.6 2.7 9.5 3.2 14.5z","m96.3 27.7c1.2 0.1 2.4 0.1 3.7 0.2-1.2 0.9-1.6 2.6-1.9 4.2-0.599 3.1-1.1 6.2-1.7 9.3-0.599 3.3-1.2 6.6-0.999 9.9 0.2 3 0.899 5.9 1.2 8.8 0.3 3 0 6.1-1.6 8.5 0.799 0.1 1.5 0.3 2.3 0.4-0.699 1.4-1.7 2.6-2.8 3.5 2.5 1.3 2.6 4.9 2.7 7.9 0.0999 5.2 1.1 10.5 2.8 15.4-1.7-0.1-3.1 1-4.7 1.6-1.3 0.5-3.2 0.5-4-0.6-2.1 0.7-4.1 2-6.29 1.8-1.4-0.1-2.7-0.8-4.1-1.2-1.9-0.7-4-0.9-5.99-0.6-1.4 0.2-2.9 0.6-4.3 0.2-1.4-0.4-2.5-2.1-1.9-3.5-0.599 0.7-0.899 1.7-0.699 2.6-3.4-0.4-6.89 0.2-9.99 1.9-0.2-0.8-0.3-1.6-0.5-2.4-0.4 0.7-0.799 1.3-1.2 2-0.699-1.2-1.4-2.4-2.1-3.6-0.2 1.1-0.4 2.1-0.599 3.2-4.3-1.8-8.89 1.7-13.6 2-2.7 0.2-5.39-0.7-8.09-0.7-2.5 0-4.9 0.9-7.39 1.3-2.5 0.4-5.19 0.2-7.19-1.5-0.3-0.9-0.599-1.7-0.899-2.6-0.999 0.7-1.8 1.7-2.3 2.8-3.7-0.3-7.39 0-11 0.8 0.4-6 0.4-12 0-18-0.2-2.5-0.5-5.2-2.2-6.9 1.1-0.2 2.2-1 2.7-2.1-1.2-0.1-2.4-0.1-3.7-0.2 1.2-0.9 1.6-2.6 1.9-4.2 0.599-3.1 1.1-6.2 1.7-9.3 0.599-3.3 1.2-6.6 0.999-9.9-0.2-3-0.899-5.9-1.2-8.8-0.3-3 0-6.1 1.6-8.5-0.799-0.1-1.5-0.3-2.3-0.4 0.699-1.4 1.7-2.6 2.8-3.5-2.5-1.3-2.6-4.9-2.7-7.9 0.0999-5.4-0.899-10.6-2.6-15.5 1.7 0.1 3.1-1 4.7-1.6 1.3-0.5 3.1-0.5 4 0.6 2.1-0.7 4.1-2 6.29-1.8 1.4 0.1 2.7 0.8 4.1 1.2 1.9 0.7 4 0.9 5.99 0.6 1.3-0.1 2.8-0.5 4.2-0.1 1.4 0.4 2.5 2.1 1.9 3.5 0.599-0.7 0.899-1.7 0.699-2.6 3.4 0.4 6.89-0.2 9.99-1.9 0.2 0.8 0.3 1.6 0.5 2.4 0.4-0.7 0.799-1.3 1.2-2 0.599 1.2 1.3 2.4 2 3.6 0.2-1.1 0.4-2.1 0.599-3.2 4.3 1.8 8.89-1.7 13.6-2 2.7-0.2 5.39 0.7 8.09 0.7 2.5 0 4.9-0.9 7.39-1.3 2.5-0.4 5.19-0.2 7.19 1.5 0.3 0.9 0.599 1.7 0.899 2.6 0.999-0.7 1.8-1.7 2.3-2.8 3.7 0.3 7.39 0 11-0.8-0.4 6-0.4 12 0 18.1 0.2 2.5 0.5 5.2 2.2 6.9-1.1 0.1-2.1 0.9-2.7 2z","m0.0122 12.5c-0.2-2.4 2.1-4.3 4.5-4.8 0.5 0 0.901-0.0999 1.4-0.0999v-1.1c2.7-0.999 5.4-2.1 8.11-3.3 0.6 0.699 1.1 1.5 1.7 2.2-0.1-0.899-0.2-1.8-0.3-2.7 3.7-0.899 7.51-1.8 11.2-2.7 0.5 0.799 1 1.7 1.5 2.5 0-1.6 2.4-1.8 4.1-1.6 8.51 1.1 17.1 0.999 25.5-0.3 0.701 0.799 1.2 1.7 1.5 2.7 1.7-2.8 6-2.8 9.51-2.5 9.71 0.899 19.3 1.8 28.9 2.7-0.6 5.49-0.5 11.2 0.4 16.8-1 0.4-1.9 0.899-2.9 1.3 0.801 0.3 1.6 0.699 2.4 0.999-0.6 7.09-1.1 14.1-1.7 21.2-0.1 0.999-0.1 2 0.2 2.9 0.2 0.599 0.6 1.1 0.801 1.7 0.2 0.599 0.2 1.3 0.1 1.9-0.1 2.3-0.2 4.5-0.4 6.79-0.701 0.799-1.3 1.7-2 2.5 0.901 0 1.6 0.999 1.7 1.9 0 0.899-0.3 1.7-0.5 2.5-0.2 0.999-0.1 2 0 2.9 0.3 4.3 0.701 8.49 1 12.8 0.2 2.9 0.701 6.19 3.2 7.99 0.2 2.3-2.1 4.2-4.5 4.7-0.5 0.0999-0.901 0.0999-1.4 0.0999v1.1c-2.7 0.999-5.4 2.1-8.11 3.3-0.6-0.699-1.1-1.5-1.7-2.2 0.1 0.899 0.2 1.8 0.3 2.7-3.7 0.899-7.51 1.8-11.2 2.7-0.5-0.799-1-1.7-1.5-2.5 0 1.6-2.4 1.8-4.1 1.6-8.51-1.1-17.1-0.999-25.5 0.3-0.701-0.799-1.2-1.7-1.5-2.7-1.7 2.8-6 2.8-9.51 2.5-9.61-0.899-19.2-1.7-28.8-2.6 0.6-5.49 0.5-11.2-0.4-16.8 1-0.4 1.9-0.899 2.9-1.3-0.801-0.3-1.6-0.699-2.4-0.999 0.5-7.09 1.1-14.2 1.7-21.2 0.1-0.999 0.1-2-0.2-2.9-0.2-0.599-0.6-1.1-0.801-1.7-0.2-0.599-0.2-1.3-0.1-1.9 0.1-2.3 0.2-4.5 0.4-6.79 0.701-0.799 1.3-1.7 2-2.5-0.901 0-1.6-0.999-1.7-1.9 0-0.899 0.3-1.7 0.5-2.5 0.2-0.999 0.1-2 0-2.9-0.3-4.3-0.701-8.49-1-12.8-0.3-3-0.801-6.29-3.3-7.99z","m0.0295 73.1c-0.3-5.51 1.7-11 5.5-15 0.8-0.801 1.6-1.6 2.1-2.5 0.5-0.901 0.6-2 0.7-3 0.4-4 0.7-8.11 1.1-12.1 0.1-0.601 0.1-1.2 0.5-1.6 0.4-0.4 1.2-0.4 1.4 0.1-0.6-0.801-0.2-2 0.2-3 3.5-7.61 7.7-14.8 12.4-21.7 0.3 0 0.7 0 1 0.1 3.3-3.9 5-9.21 4.5-14.3 4.2 2.6 9.2 4 14.2 3.9 1.5 0 3.4 0.2 3.7 1.6 3.1 0.4 6.3 0.4 9.3 1 10.2 1.9 18.6 8.71 26.6 15.2 1.1 0.901 2.3 2.2 1.7 3.5 0.4-0.4 1-0.5 1.5-0.2v3.3c4.7-0.1 9.4 1 13.6 3.2-8.1 9.61-12.3 22.4-11.6 34.9-2.1-0.4-4.3-0.801-6.4-1.2 1.3 1.4 2.6 2.8 3.9 4.2-3 1.8-3.5 5.91-4.2 9.31-0.7 3.4-2.9 7.51-6.4 7.21-0.1 0.701 0.3 1.5 0.9 1.8-0.6 0.2-1.2 0.5-1.8 0.701 0.5 1.1 1.1 2.2 1.6 3.3-3.1 1.9-5.4 4.8-6.6 8.21-4.2-4.4-10.2-7.01-16.3-7.11 0.2-0.801 0.4-1.6 0.6-2.4l-1.7 0.801c-4.9-1.5-10-2.5-15.1-3-0.1-0.601-0.2-1.2-0.4-1.8-1.2-0.3-2.1-1-3.2-1.6-4.3-2.4-9.8-1.9-14.1-4.4-0.1-0.4-0.1-0.801-0.2-1.2-0.4 0.3-0.8 0.701-1.2 1-0.7-1.7-2.9-1.9-4.7-2.4-2.3-0.701-4.2-2.3-6.3-3.5-2-1.3-4.5-2.2-6.8-1.3z","m1.43 45.4c-0.3-0.5-0.7-0.9-1.2-1 1.6-0.9 0.9-3.5 0.999-5.4 0-1.6 0.7-3.1 1.4-4.5 2.1-4.6 4.3-9.2 6.4-13.7 0-0.6-0.0999-1.1-0.0999-1.7 0.999 0.9 2.4-0.4 3.2-1.5 4.6-6.4 12.5-9.4 17.4-15.5 0.7 0.1 1.3 0.5 1.7 1.1 0.4-1.1 1.6-1.7 2.7-1.8 1.1 0 2.3 0.4 3.4 0.6 5.7 1.2 11.9-1.9 17.2 0.7 2.9-1.8 6.4-3.4 9.6-2.4 0.7 0.2 1.4 0.5 2 0.9 5 2.5 10.1 5 14 9.1 0.9 0.9 1.7 2.2 1.4 3.4 0 0.1-0.1 0.2-0.1 0.3 1.2 0.9 2.7 1.3 4.2 1.1 0.1 0.5 0.2 1 0.2 1.6l1.1-0.5s0.6 1.1 1.2 2.1c2.3 1.4 4.3 3.2 5.9 5.3-0.2 0.4-0.4 0.9-0.7 1.3 1.1-0.4 1.9 1 2.2 2.1 1.1 4.4 1.7 9 1.7 13.5 0 2-0.1 4.1 0.6 6 0.5 1.4 1.5 2.6 2 4.1 0.5 1.5 0.2 3.4-1.2 4 0.3 0.5 0.7 0.9 1.2 1-1.6 0.9-0.9 3.5-0.999 5.4 0 1.6-0.7 3.1-1.4 4.5-2.1 4.6-4.3 9.2-6.4 13.7 0 0.6 0.1 1.1 0.1 1.7-0.999-0.9-2.4 0.4-3.2 1.5-4.6 6.4-12.5 9.4-17.4 15.5-0.7-0.1-1.3-0.5-1.7-1.1-0.4 1.1-1.6 1.7-2.7 1.8-1.1 0-2.3-0.4-3.4-0.6-5.7-1.2-11.9 1.9-17.2-0.7-2.9 1.8-6.4 3.4-9.6 2.4-0.7-0.2-1.4-0.5-2-0.9-5-2.5-10.1-5-14-9.1-0.9-0.9-1.7-2.2-1.4-3.4 0-0.1 0.1-0.2 0.1-0.3-1.2-0.9-2.7-1.3-4.2-1.1-0.1-0.5-0.2-1-0.2-1.6l-1.1 0.5s-0.6-1.1-1.2-2.1c-2.3-1.4-4.3-3.2-5.9-5.3 0.2-0.4 0.4-0.9 0.7-1.3-1.1 0.4-1.9-1-2.2-2.1-1.1-4.4-1.7-9-1.7-13.5 0-2 0.0999-4.1-0.6-6-0.5-1.4-1.5-2.6-2-4.1-0.5-1.4-0.2-3.4 1.2-4z","m95.4 51c2.1 2.9 3.7 6.4 4.6 10-1 1.1-2 2.1-3 3.2 0.3 0.6 0.5 1.2 0.8 1.8-1.4 3-4.2 3.9-6.8 4.9-5.8 2.3-11 6.3-15.2 11.8l0.3-2.4c-7.5 4.1-15.3 7.4-23.4 9.8-0.1-0.7 0.1-1.3 0.4-1.7-4.1 1.5-8.2 3-12.2 4.5-3.7 1.4-7.6 2.9-10.3 6.2 0.4-0.8 0.6-2 0.4-3.2-2.1-0.2-4-3-5.5-5.7-3.3-6-5.9-12.6-8.4-19.1-1.1-2.8-2.1-5.6-3.2-8.4-1.8-4.8-3.7-9.6-4.7-14.5-0.7-4.2-1.5-9.5-4.5-11.6l0.9-4.2-1.7 2 0.3-2.2s-0.4-1-1.7-2.3c-1.3-1.4-2.5-3.3-2.5-3.3s5.2-2.7 7.9-3.8 4.5-3.5 4.5-3.5c4.7-3.5 9.4-6.9 14.1-10.4 0.4 0.9 0.8 1.8 1.2 2.8 1.6-1.9 4-2 6.3-2.3 6.3-0.9 12.1-3.7 16.9-8.3 1.6 2.5 3.9 1.1 5.3-0.5 0.2 0.6 0.5 1.2 0.7 1.8 4.9-0.8 9.7-1.6 14.6-2.4-1.4 0.3-2.5 1.7-2.8 3.6 2.1-1.6 4.7-2.5 7.4-2.6 1.3 2.7 2.4 5.7 3 8.7 0.8 0 1.5 0.1 2.3 0.1 0 2.4 0.8 5 1.6 7.4l1.5 4.5c1.6 4.7 3.1 9.4 5.3 13.7 1.6 3.2 3.7 6.6 3.8 10 0 0.9-0.1 1.8 0.1 2.8 0.4 1.1 1.1 2 1.7 2.8z","m99.9 48.4c0.1 1.6 0.2 3.1-0.1 4.7-0.3 1.4-1.1 2.8-1.5 4.2-0.4 1.4-0.5 3.1 0.5 4.2-1.1 0.699-2.2 1.4-3.3 2.1-0.3 0.2-0.7 0.4-0.9 0.799-0.3 0.5-0.2 0.999-0.2 1.5 0.1 1.4-0.2 2.8-0.8 4.1-1.1 2.6-2.3 5.19-3.4 7.79-0.2 0.5-0.6 1.1-1.2 1.1-0.3 0.999-0.7 2-1 3h-1.3c0.1 0.999-0.8 1.9-1.8 2.4-1 0.4-2.1 0.599-3.1 0.999-3.1 1.1-5 4.2-7.4 6.49-0.4 0.4-0.9 0.799-1.4 0.699-0.4 0-0.8-0.3-1.2-0.4-1-0.3-2 0.5-2.5 1.3-0.5 0.899-0.7 1.9-1.2 2.7-2.3 3.4-8.2 1.5-11.6 3.9-0.4-0.4-0.9-0.899-1.3-1.3-2.1 0.799-4.4 1.3-6.7 1.4-0.9 0-2.3-0.4-2.1-1.3-5.1 0-10.2 0.0999-15.2 0.599-0.8 0.0999-1.6 0.0999-2.2-0.3-0.5-0.3-0.8-0.799-1.3-1.2-1.1-0.799-2.8-0.3-3.9-1.1-1-0.699-1.2-2.2-2.3-2.6-1.4-0.4-3.1 1.3-4.1 0.3-0.1-0.5-0.2-0.999-0.3-1.5-2.2-2.8-4.4-5.49-6.5-8.29-1.2-1.5-2.3-3-3.3-4.6-1.2-2.1-2-4.4-3.3-6.39-0.6-0.999-1.4-2-1.8-3.1s-0.2-2.5 0.7-3.3c-0.6-0.0999-1.2-0.3-1.5-0.799-0.2-0.3-0.2-0.599-0.2-0.899-0.2-2-0.3-4-0.5-5.99-0.1-0.899-0.1-1.7-0.2-2.6-0.1-1.8-0.3-3.7-0.4-5.49-0.1-1.4-0.2-3 0.1-4.5 0.3-1.4 1.1-2.8 1.5-4.2 0.4-1.4 0.5-3.1-0.5-4.2 1.1-0.699 2.2-1.4 3.3-2.1 0.3-0.2 0.7-0.4 0.9-0.799 0.3-0.5 0.2-0.999 0.2-1.5-0.1-1.4 0.2-2.8 0.8-4.1 1.1-2.6 2.3-5.19 3.4-7.79 0.2-0.5 0.6-1.1 1.2-1.1 0.3-0.999 0.7-2 1-3h1.3c-0.1-0.999 0.8-1.9 1.8-2.4 1-0.4 2.1-0.599 3.1-0.999 3.1-1.1 5-4.2 7.4-6.49 0.4-0.4 0.9-0.799 1.4-0.699 0.4 0 0.8 0.3 1.2 0.4 1 0.3 2-0.5 2.5-1.3 0.5-0.899 0.7-1.9 1.2-2.7 2.3-3.4 8.2-1.5 11.6-3.9l1.3 1.3c2.2-0.799 4.4-1.3 6.7-1.4 0.9 0 2.3 0.4 2.1 1.3 5.1 0 10.2-0.0999 15.2-0.599 0.8-0.0999 1.6-0.0999 2.2 0.3 0.5 0.3 0.8 0.799 1.3 1.2 1.1 0.799 2.8 0.3 3.9 1.1 1 0.699 1.2 2.2 2.3 2.6 1.4 0.4 3.1-1.3 4.1-0.3l0.3 1.5c2.2 2.8 4.4 5.49 6.5 8.29 1.2 1.5 2.3 3 3.3 4.6 1.2 2.1 2 4.4 3.3 6.39 0.6 0.999 1.4 2 1.8 3.1 0.4 1.1 0.2 2.5-0.7 3.3 0.6 0.0999 1.2 0.3 1.5 0.799 0.2 0.3 0.2 0.599 0.2 0.899 0.2 2 0.3 4 0.5 5.99 0.1 0.899 0.1 1.7 0.2 2.6 0.1 1.6 0.2 3.4 0.4 5.29z","m0.00116 75.7c0.794 0.0537 1.95-0.858 2.66 0.148 0.617 0.87 0.424 1.62 1.12 1.62 0.181 4.22 2.61-1.6 2.98 1.98 0.0294 0.286-0.998 2.08-1.07 2.24 0.239-0.53 1.7-0.122 2.03-0.13 0.695-0.0188 1.27 0.938 1.46 2.15 0.0106 0.0685 0.727 0.909 0.851 1.12 0.555 0.948-0.436 0.907 0.914 1.4 0.245-0.0013 0.491-0.0027 0.736-0.0027 0.0642-0.0362 0.0963-0.23 0.0966-0.58 1.86-0.46 3.67-0.393 5.4 0.58 2.51 1.41 4.86 2.46 7.33 4.1 6.07 4.04 12.2 4.33 18.7 5.85 3.57 0.834 8.17-0.4 12-1.11 4.13-0.76 8.34-3.88 12.5-2.25 3.08 1.2 6.23 3.67 9.46 4.56 3.03 0.84 6 4.31 9.1 1.7 0.714-0.6 1.55-1.83 2.24-2.3 0.449-0.303 1.13 0.205 1.56-0.608 0.456-0.852 0.654-2.3 1.07-3.53 0.34-1.01 1.14-0.795 1.36-1.74 0.372-1.62 0.0865-3.46 0.194-4.99-0.0355 0.503 0.221-3.28 0.191-2.69 0.061-1.2 0.481-1.82 0.412-3.21-0.112-2.27-2.02-3.95-1.85-6.65-0.22 0 0.752 0.248 0.602-0.98-0.24-1.96-1.63-2.75-2.1-3.11 0.088-2.07 0.393-0.599 0.756-1.4-0.782-3.91 2.58-2.79 2.91-2.69 0.167 0.0497 2.63-0.0752 2.55-0.957-0.0659-0.732-0.698-0.514-0.605-1.97 0.502 0 2.29 0.677 2.62-0.856-0.157-1.3-1.83-1.7-1.58-3.4 0.405-2.75 2.6 1.68 3.04-1.59 0.261-1.96-0.338-3.61-0.693-4.99-0.148-0.579-0.412-1.43-0.568-2.02-0.188-0.715-0.688-0.506-0.802-1.4 0.329-3.24 2.08 0.768 2.34-2.43-0.22-1.15-1.79-1.06-2.19-1.43-0.831-0.756-1.34-1.51-2.11-2.43-0.853-1-1.71-2.74-2.61-4.01-2.94-4.15-5.83-6.53-8.97-8.18-1.19-0.623-3.29-0.0564-4.26-4.09-0.52-2.17-0.603-5.55-1.23-7.51-0.556-1.76-1.19-2.3-1.78-3.06-2.06-2.66-4.28-2.91-6.46-3.37-2.25-0.474-4.36-1.86-6.45-2.39-5.64-1.42-10.6-4.15-16.3-4.15 0-2.92 0.419-2.48-0.315-4.09-0.344-0.756-0.747-0.444-1.18-0.584-0.465-0.15-0.624-0.474-1.12 0-0.332 0.314-0.611 0.468-0.952 0.584-0.438 0.149-0.843 0.768-1.46 0.591-0.691-0.197-1.14-0.0537-2.03-0.00537-2.05 0.11-3.94-0.699-6.17-0.585-1.36 0.0711-2.58 1.75-3.87 3.24-0.536 0.626-0.966 1.54-1.51 2.02-0.656 0.577-1.01 1.28-1.51 2.19-2.16 3.91-5.25 0.153-7.65 0.153-2.13 0-4.15 0.0738-6.17 1.17-1.44 0.777-2.75 1.93-4.13 3.21-0.51 0.471-1.11 0.98-1.58 2.05-0.12 0.274-0.503 0.129-0.591 0.881-0.324 2.74 0.255 1.98 0.562 2.93-2.86e-4 1.58-2 4.52-2.18 4.96-0.445 1.06-1.32 3.54-1.81 5.47 0.0436 1.82 1.06 0.149 1.37 0.76 0.614 1.2-0.197 2.12-0.113 2.81 0.113 0.929 0.445-0.132 0.606 0.66-0.434 2.04-1.49 1.28-1.72 3.36-0.0386 0.357 0.957 0.949 0.961 0.969 0.46 2.4-0.261 2.01-0.266 2.93-0.0151 2.49-0.298 1.17 0.405 1.17 0.353 0 3.5-1.66 3.68-0.0564 0.379 3.24-1.06 4.04-1.52 4.45-0.824 0.74-1.27 1.01-1.97 1.97-0.541 0.74-0.69 1.63-1.07 2.79-0.399 1.21-1.3 1.84-1.6 3.29-0.191 0.94 1.23-0.168 1.35-0.168 0 2.7-1.61 3.82-1.6 3.9 0.152 1.15 0.18 2.76-0.0223 4.6-0.384 3.48-0.785 1.83-1.47 3.78-0.915 2.6 0.0226 2.84-0.0274 5.46-0.0194 1.01-0.813 3.89-0.915 3.88 0.33 0.0215-0.0241-0.0013 0 0","m100 7.43c-0.651-5.63-2.08-5.19-3.24-5.89-2.07-1.25-4.59-1.75-6.56-1.01-2.2 0.822-5.24 1.38-7.41 0.999-3.69-0.639-7.04 1.32-10.9 1.38-3.25 0.0474-6.06-1.07-9.76-2.14-8.09-2.34-16.4 1.23-24.6 3.52-9.76 2.72-19.7 7.64-29.6 9.64-1.23 0.25-5.05-2.64-5.32 5.82-0.184 5.87 0.561 0.52 1.16 4.5 0.662 4.42-0.517 4.54-0.962 5.53-1.76 3.9 0.133 11.4-1.42 14.8-0.612 1.32-1.42 0.566-1.39 5.69 0.021 3.28 0.782 2.97 0.782 5.67-0.291-0.757-0.502-0.624-0.635 0.402 0.251 1.36 0.511 1.32 0.787 1.95 0.243 0.55 0.655 0.493 0.892 1.09 0.373 0.945 0.466 2.51 0.844 3.41 1.07 2.54 2.22 1.6 3.19 4.85 0.154 0.517 0.402 0.446 0.53 1.05 0.298 1.4 0.195 3.11 0.602 4.42 0.621 2 1.68-0.432 2.26 1.43 0.316 1.01 0.331 3.82 0.528 5.24 0.262 1.89 0.629 3.64 1.02 5.09 1.41 5.25 3.3 7.68 5.04 7.59 0.756-0.0395 1.9-0.139 2.68 1.36 0.384 0.74 0.793 1.99 1.23 2.74 1.85 3.17 3.87 3.46 6.01 3.46 1.94-0.0032 3.84-0.588 5.62-3.17 1.17-1.71 2.49-3.92 3.8-4.4 3.83-1.39 7.85-2.01 11.7-0.694 1.23 0.422 2.51-0.463 3.67 0.678 0.641 0.629 1.18 1.73 1.85 2.15 1.84 1.18 3.59 0.267 5.27-1.45 2.87-2.95 6.19-3.79 9.05-5.47 1.51-0.885 3.27 1.87 4.96 1.27 1.62-0.575 3.61-1.58 5.33-2.68 1.39-0.888 2.64-2.79 3.99-4.13 0.787-0.783 2.88-2.24 3.24-6.43-0.024 0.283-0.611-0.939-0.618-2.33-0.044 0.098 0.846-1.58 0.844-1.58 0.888-0.727 1.28-0.636 1.84-2.74 0.628-2.37 0.484-3.14 1.35-4.13 0.286-0.326 2.23-0.977 2.33-1.86 0.301-2.7-1.03-2.65-1.16-3.29 0.258-2.1 2.48-1.7 0.91-3.81-0.39-0.52-1.03-0.648-1.5-0.675-0.13-0.0079-1.17 1.37-1.3 0.667-0.629-3.22 0.665-3.06 0.774-4.13 0.323-3.15-0.292-4.5-0.0602-6.19 0.192-1.4 1.39-0.498 1.74-0.689 0.723-0.383 3.74 1.08 4.23-2.98 0.0784-0.65-2.48-1.74-2.78-1.84-1.32-0.446-2.83-0.953-4.11-2.06 0.0563-0.759 0.477-2.36 0.583-2.76 0.921-3.48 0.296-0.0237 1.16-0.715 0.218-0.174 0.645-1.27 0.865-1.48 0.0739-0.0711 0.637 0.0016 0.58 0.0427 0.664-0.47 1.25-0.688 1.45-3.33 0.192-2.56-0.386-4.71 0.318-6.92 0.197-0.62 0.795-0.413 0.875-0.683 0.226-0.771 0.311-2.67 0.445-3.19 0.434-1.68 0.948-4.87 1.61-5.76 1.06-1.42 5.42 1.08 5.42-5.81-0.0482-0.419 0 0.161 0 0","m99.8 53.3c-0.222-0.982-0.895-2-1.24-2.87-0.525-1.31-1.29-0.933-1.64-2.44 0.694-2.46 0.261-4.17-0.359-5.33-0.468-0.879-1.03-0.394-1.51-1.15-0.357-0.564-0.291-1.79-0.667-2.33-0.409-0.58-2.02-0.415-2.14-2.28-0.153-2.47 1.58-0.537 1.8-1.87 0.458-2.77-2.47-4.29-2.74-4.49-0.839-0.633-1.81-0.889-2.65-1.69-0.266-0.254-0.474-3.08-0.84-1.47 0.0506 0.58 0.521 1.49 0.0823 2.03-0.119 0.148-1.45-0.529-1.55-1.14-0.658-3.83 1.4-2.91 1.59-3.72-0.515-1.76-0.969-0.0568-1.32-0.542-0.525-0.727-1.07-2.89-1.6-3.8-1.33-2.31-2.82-2.93-4.34-4.73-1.07-1.26-2.92-3.32-4.08-3.61-0.178-0.0449-0.744 0.978-0.846 0.923-0.155-0.0872-0.399-1.6-0.502-1.69-0.91-0.842-1.98-0.533-2.74-0.57-3.36-0.165-7.59-3.2-10.8-4.7-1.4-0.645-2.38-2.73-3.94-2.74-0.945-0.00793-1.42-1.72-2.51-1.29 0.137-0.0529-0.391 0.595-0.261 0.576-0.581 0.0846-1.03-0.905-1.64-1.18-0.539-0.247-1.66-1.45-2.22-1.08-0.463 0.299-0.293 2.06-0.969 2.27-0.198 0.0608-0.0637-1.16-0.231-1.29-0.277-0.213-0.676-0.345-1.03-0.337-0.202 0.00529-1.18 0.0806-1.37 0.234-6e-3 0.00529-0.523 1.1-0.463 1.09-0.504 0.131-1.43-0.387-2.21 0.221-0.276 0.217-0.447 1.2-0.76 1.22-0.267 0.0172-0.371-1.42-1.11-1.14-0.446 0.173-1.61 0.597-2.02 1.15-0.53 0.708-0.251 1.85-0.845 2.3 0.163-0.124-1.07-1.08-1.11-1.08-1.11-0.156-2.29 1.98-3.45 1.94-3.43-0.13-7.31-1.43-11-1.43-3.81-0.00529-7.57-0.776-11.1 4.62-1.58 2.42-2.7 7.8-3.59 14.1-0.674 4.77-1.51 6.14-2.69 8.35-1.21 2.29-2.44 4.54-3.43 8.04-0.237 0.833-0.178 2.94-0.391 3.45-0.342 0.831-0.921-0.0753-1.25 1.19-0.9 3.49 0.334 4.96 0.334 8.6-1.23 0-2.06 4.43-2.35 8.95-0.348 5.51 0.0015 7.11 0.391 11.8 0.48 5.75 0.197 10.7 1.99 9.21 0.259-0.211 0.577-1.04 0.75-1.15 1.03-0.645 1.28 1.5 2.19 1.39 1.67-0.21 3.55 1.13 5.29 0.866 0.465-0.07 1.01-0.152 1.59-0.529 0.935-0.604 1.04-0.0476 1.95-0.0013 1.01 0.0502 2.05-0.703 3.12-1.15 0.525-0.219 0.377-1.12 1.07 1.85 0.312 1.35 0.795 4.22 1.13 4.95 1.28 2.83 3.7 0.615 4.95 0.601 2.27-0.0251 4.41-0.519 6.6-1.07 4.14-1.05 7.82 2.27 11.7 5.16 7.2 5.42 15.2 6.73 22.2 4.62 2.2-0.662 4.52-0.765 6.68-1.73 0.374-0.168 0.922 0.176 1.17-0.555 0.285-0.83 0.0248-2.91 0.483-3.36 0.237-0.234 0.38 2.55 0.34 2.49 0.289 0.386 0.559 0.531 0.906 0.843 0.439 0.395 1.52 0.533 1.82-0.575 0.295-1.07 0.0634-4.08 0.274-4.94 0.723-2.96 0.749 1.29 0.899 2.06 0.231 1.19-0.717 6.43 1.24 3.45-0.0542 0.0833 0.936-1 0.586-1-0.102 0.0013 0.0368-1.3 0.194-1.24 0.0703 0.0238 0.626 1.96 0.804 2.19 0.32 0.414 1.43 0.514 1.74-0.225 0.641-1.55 0.382-3.17-0.261-3.17 0-7 0.472 1.02 0.652-3.17 0.122-2.85-0.465-1.27-0.261-4.18 0.275-3.93 1.14-3.1 1.3 0.447 0.0431 0.956-0.688 8.19-0.315 9.78 0.245 1.05 2.91 0.379 3.2-0.806 0.519-2.11-0.047-4.61 0.434-6.15-0.191 0.608 0.924 1.41 0.952 1.4 0.323-0.141 0.514-1.34 0.855-1.83 0.163-0.233 0.644-0.233 0.863-0.406 0.0838-0.0661 0.111-1.22 0.201-1.39 0.328 1.31 1.56-0.0952 1.95-1.17 0.394-1.09 0.311-3.01 0.782-4.6 0.317-1.07 0.976-0.829 1.37-1.17 0.387-0.33 1.48-1.45 1.69-2.57 0.902-4.65-1.65-1.13-0.458-6.64 0.539-2.49 1.11-1.13 1.55-1.46 0.102-0.074 0.737-1.9 0.987-1.99 0.349-0.115 1.65 1.93 1.3-2.06-0.447-5.15-5.27-0.843-4.06-11.4 0.0844-0.732-0.581-1.11-0.626-1.24 0.0087-0.0793 0.53-2.4 0.518-2.37 1.12-2.61 0.42-0.43 0.782 1.77 0.223 1.36-0.268 2.09 0.391 2.31 0.0583 0.0198 0.622 0.141 0.759-1.05 0.0464-0.403-0.513-1.73-0.0634-3.17 0.0906-0.289 0.308 0.572 0.477 0.48 0.239-0.13 0.742 0.634 0.977 1.44 0.351 1.2 0.488 2.54 0.912 3.17 0.327 0.48 1.43 0.552 0.849-2.03","m100 70.7c-2.05 0-4.47 0.583-6.74 0.583 0-1.06 0.507-2.47 0.691-3.05 0.278-0.868 0.751-0.65 1.1-3.23 0.106-0.793-0.298-1.88 6.31e-4 -3.3 0.178-0.848 0.477-1.02 0.616-1.51 0.178-0.619 1.88-4.67 0.484-4.67 0.0935-2.19 1.85-1 1.79-3.05-0.0199-0.669-4.63-1.03-5.09-1.03 0-2.4 1.23 0.0067 1.38-1.17 0.198-1.55-1.84-1.14-2.06-1.95 0.197-2.48 0.21 0.257-0.149-2.51 1.22-4.87 2.85-2.24 4.26-5.72-0.437-1.63-1.96 0.699-2.52 0.844-1.01 0.263-3.25 1.45-3.93-1.45 0.341-1.51 2.38-0.835 2.45-1.67 0.173-1.94-2.49 0.438-2.59-2.13 0.214 0.276 0.347-1.78 0.195-2.33 0.187 0.677-1.11 0.0415-1.02-1.17 0.222 0.415 0.361 0.224 0.417-0.575 0.0032-1.22-1.49-1.76-1.65-1.76 0-3.02 3.1-4.72 3.56-4.96 0.847-0.457 1.96-1.24 2.76-1.46 0.385-0.103 0.961-0.513 1.24-0.583 0.507-0.129 0.96 0.197 1.39-0.462 0.238-0.363-0.0464-1.29-0.154-1.29 0-0.69 1.19-3.27 1.38-3.5 0.583-0.717 1.61 0.536 2.05-1.42-0.231-1.12-2.6-0.844-2.98-0.915-1.03-0.198-1.96-0.0737-2.9-0.584-1.78-0.958-3.47-1.18-5.24-2.33-2.94-1.91-5.92-4.57-9.01-5.84-3.49-1.43-7.1-2.5-10.6-3.36-3.93-0.955-8.13-2.83-12.2-3.06-5.69-0.319-11.1 0.304-16.6 0.581-3.54 0.18-7.63-0.19-11.1 1.75-6.74 3.72-13.8 3.03-20.6 8.16-1.03 0.785-6.54 6.35-4.41 12.3 0.323 0.894 0.957 0.67 1.18 1.46 0.164 0.592 0.653 4.39 0.622 5.54-0.0515 1.88 0.235 0.908-0.162 2.92-0.104 0.527-0.92-0.596-1.01 0-0.355 2.33 1.09 1.17 1.38 1.17 0 2.75-1.41 0.604-1.63 2.54-0.0281 0.253 3.11-1.18 2.81 2.48-0.174 2.15-1.44-1.28-1.71 1.01-0.042 0.351 1.37 1.12 1.49 0.974-0.0164 0.435-2.6 1.17-2.89 1.17-0.0591 0.839 0.425 1.5 0.553 1.95-0.0733 3.26-1.97-1.13-1.35 3.89 0.429 3.44 1.44 1.54 2.03 3.22-0.466 2.72-0.449 0.758-0.358 4.36 0.0426 1.68 0.826 0.379 0.131 2.93-0.331 1.21-1.79 1.21-2.32 1.16-0.837-0.0831-1.74-1.01-2.41 0.86-0.0983 0.275-0.437 1.73-0.478 2.06-0.0822 0.683-0.0551 4.04 0.136 4.66 0.265 0.87 0.81-0.186 1.03 0.583 0.541 1.88-0.039 3.51 0.213 5.25 0.131 0.906 0.861 3.81 1.02 4.67 0.125 0.651 0.453 1.91 0.626 2.97 0.238 1.46 0.149 2.49 0.453 3.64 0.538 2.03 1.36 2.26 1.95 4.22 0.445 1.48 0.55 2.45 1.08 4.05 0.662 2-0.197 2.02 1.07 2.53-6e-3 -0.0027 0.195-1.08 0.231-1.06 0.559 0.212 3.32 2.34 3.26 2.61 0.155 0.892 0.545 0.0603 0.545-0.868 0.676 0 1.29 1.43 1.99 1.75 0.307 0.142 0.547-0.367 0.973 0.591 0.194-0.938 1.37 0.549 1.71 0.573 0.666 0.0469 2.56 1.51 3.07-0.482-0.758 2.95 1.86 1.32 1.74 1.35 0.549-0.161 2.53-1.01 2.67 0.311 0.365-1.47 2.73-1.46 3.31-1.76 0.889-0.457 1.8-0.135 2.48-0.587 1.19-0.792 2.3 0.0335 3.3 0.583 0.626 0.346 2.18 0.36 2.63-0.683 0.648-1.48 0.0287-0.238 0.737 0.1 0.689 0.328 0.977 0.0188 1.55-0.106 1.88-0.407 4.11-0.421 5.81-0.478 2.13-0.071 4.71 0.647 6.88 0.584 1.07-0.0322 1.83-0.41 2.81 0 1.04 0.433 2.14-0.644 3.13-0.584 5.39 0.33 10.9 0.381 16.8-0.587 2.62-0.427 6.2-0.0094 8.72-0.0107 0.85 0 8.17 1.09 8.17 0.0147 0-0.486-1.84-1.2-1.95-1.17-0.326 0.0804-0.779 0.439-1.41 0.0871-0.554-0.312-1.19-0.411-1.74-0.382-0.263 0.0147-0.815 0.494-1.16 0.296-0.233-0.135-0.509-0.922-0.673-1.07-0.243-0.221-0.278 1.36-0.504 1.07 0.0322-0.528-0.0136-0.916-0.138-1.17 0.103-2.21 5.93-0.615 6.33-0.583 0.311 0.0241 0.637-0.506 1.01-0.513 0.649-0.0121 0.9-0.0027 1.6 0.21 1.37 0.417 2.85 0.0322 4.46-0.281 0.237-0.0456 4.69-4.83 3.85-7.59h-1.03c0-1.62 1.2-14.6 1.1-14.6","m99.8 27.2c-0.424-0.0797-0.901-1.76-1.28-1.76-0.0254-0.33 0.808-0.982 0.404-2.11-0.397-1.11-1.84-0.423-2.35-0.769-0.287-0.195-2.4-1.19-2.38-2.05 0.119-4.51 4.61 0.485 5.05-1.76-0.514-2.13-1.48-1.4-2.22-1.4 0-2.22-0.403-0.361-0.741-1.46 0.108-0.187 0.156-0.47 0.143-0.849-2.96 0-5.81-0.985-8.67-2.31-1.33-0.613-1.89-5.22-3.39-6.39-3.09-2.42-6.15-4.62-8.99-5.32-1.56-0.383-3.24-1.37-4.67-0.994-1.83 0.485-4.04 1.03-6.09 0.575-1.37-0.306-2.96 0.595-4.48 0.692-1.35 0.0849-3.17 0.0782-4.62 1.57-0.657-2.53-1.6-0.296-2.15-0.236-1.02 0.111-1.63-0.305-2.63 0.245-1.36 0.752-3.14-0.602-4.48 0.0265-2.85 1.33-5.73-0.886-8.82 0.172-0.96 0.327-2.28 1.17-3.65 1.57-0.969 0.286-1.54 0.786-2.34 1.18-0.906 0.448-1.86 0.774-2.76 1.42-6.35 4.57-12.9 0.22-19.3 2.04-1.44 0.407-2.84 0.504-4.23 1.13-0.909 0.408-2.44 0.445-3.27 2.03-1.68 3.19 0.00137 6.81 0.649 10.4-0.0999 0.356-0.431 1.02-0.45 1.5-0.127 3.19 0.348 0.693-0.247 2.84-0.813 2.94-1.29 0.578-0.799 6.14 0.057 0.644 0.623 4.2 0.568 5-0.0522 0.753-0.505 1.81-0.488 1.57-0.0302 0.448-0.346 0.577-0.379 0.847-0.221 1.82 0.364 2.24 0.443 3.53 0.163 2.64 0.143 2.63 0.304 4.58 0.0288 0.353 0.521 5.02 0.47 4.67 0.123 0.836 0.735 3.34 0.73 4.02-0.0203 2.57 0.0831 0.391-0.542 0.79-0.572 0.365-1.49-2.76-1.98-0.338-0.417 2.06 0.251 3.04 0.422 4.38 0.247 1.94 0.716 4.08 0.749 6.3 0.0079 0.501-0.509 3.08-0.445 4.13 0.113 1.86 0.653 2.33 0.957 3.38 1.27 4.37 2.27 6.22 3.94 7.01 0.985 0.467 2.03 0.865 2.98 1.8 0.335 0.33 0.0755 1.96 0.419 2.24 0.185 0.155 1.84 0.0529 1.96 0 0.973-0.473 1.68-0.429 3.02 0 0.721 0.23 1.76 1.53 2.52 1.74 1.07 0.286 2.79-0.28 4.1-0.0066 0.216 0.0451 0.91-0.214 1.09 0-0.0436-0.0528 0.766 1.35 0.56 1.45-0.232 0.112 1.25 0.115 0.593-0.831 0.443 0.642 0.0642-0.735 0.666 2.29 0.268-0.352 0.396-0.936 0.384-1.75 0.223-0.0663 0.658 2.37 1.01 2.31 0.663-0.111 1.17-6.31 2.14-2.55-0.36 1.22-0.833 1.77-0.453 3.71 0.117 0.601 1.43-0.676 1.64-0.576 1.24 0.585 1.59 5.08 1.72-0.383 0.0199-0.836-0.982-0.239-0.272-2.02 0.525-1.32 0.395-0.719 0.799 1.12 0.569 2.59 0.118 2.87 0.848 3.49 0.0663 0.057 0.949-0.649 1.25-0.472-0.0052-0.0025 0.26 2.24 0.413 2.31 0.188 0.0918 0.629-1.18 0.783-1.73 0.286-1.02-0.0464-4.08 0.449-2.6 0.0965 0.289-0.0481 2.58-0.125 2.22 0.0797 0.38 0.0563 2.5 0.125 2.69h0.965c0.232-1.6 0.458-1.5 0.678 0.298 0.405 0.108 0.552 1.13 1.05-0.559-0.147-1.06-0.854-3.78 0.148-3.78 0.136 2.1-0.369 1.94 0.338 4.04 0.393 1.17 0.889 2.45 1.37 0.66 0.498 1.41 0.217 1.33 0.801 0.727 0.142-0.147 0.75-2.14 0.931-1.97 0 4.1 2.17 2.04 2.54 2.01 0.249-0.0162 1.56 0.803 2.32 0.874 2.12 0.195 4.63-1.38 6.58-1.76 4.35-0.857 8.64-4.07 12.7-8.08 2.22-2.2 4.46-2.95 6.75-4.69 0.975-0.738 2.14-1.78 3.19-2.22 1.01-0.425 2.19-0.238 3.16-1.46 0.674-0.85 1.01-2.23 1.63-2.59 0.341-0.196 0.247-0.028 0.559-0.578 0.325-0.573 0.145 1.83 0.712 0.569 0.217-0.484-0.0793-2.04 0.186-2.38 1.11-1.43 2.27-2.56 3.33-3.39 1.89-1.47 3.37-1.6 4.87-3.95 0.511-0.795 1.15 0.0663 1.88-0.682 0.08-0.0807 0.778-1.77 0.794-1.83 0.236-0.955-0.325-1.44-0.19-2.05 0.323-1.46 0.823-1.7 1.16 0.121-0.147 0.336-0.196 0.819-0.146 1.45 1.8 0 0.349-0.581 0.475-1.54 0.399-3.04 1.5 2.23 0.921-3.07-0.0776-0.707-0.819 0.336-0.798-1.16 0.023-1.57 0.87-1.57 0.875-1.52-3.43e-4 -0.0016-0.379-0.86-0.426-0.789-0.0367 0.0554 0.6-0.859 0.748-1.15-0.0295 0.0597 0.538 0.578 0.509 0.578 0.531-1.15-0.379-1.15-0.359-1.15 0-5.03 0.0604-0.135 0.443-2.61-1.07-4.54 2.74-1.35 2.55-3.74 0.0384-0.735-1.46-1.12-1.58-1.17-0.464-0.222-1.29 0.0766-1.71-0.561-0.331-0.501-0.167-2.18-0.434-2.89-0.167-0.444-0.764-0.573-0.912-0.573-0.0494-0.639 3.26-3.61 3.74-6.35 0.528-3.01-0.161-1.63-0.0978-2.89 0.133-2.63 0.383-0.765 0.981-3.13-0.197-0.795-0.733 0.349-0.733-1.49 0.699 0 0.584-2.56 1.02-3.23 0.346-0.529 1.93 0.978 2.11 0.028-0.07-0.271-0.14-0.542-0.21-0.814-0.0488-0.0082 0.07 0.272 0 0","m56.2 0.033c-6.56 0.319-13 1.11-19.5 2.25-5.03 0.299-9.75 2.39-14.7 3.09-4.09 0.76-8.61 0.178-13 1.04-1.22-2.13-2.78-8.81-5.88-3.41-0.677 4.57-2.49 8.64-2.05 13.3-0.451 9.45-1.52 18.9-1.1 28.4 0.228 7.65 0.318 15.3 0.623 22.9 0.363 4.12 0.337 8.49 1.06 12.4-0.0369 4.8 0.938 9.31 1.75 13.9 0.288 2.65 2.83 8.99 4.56 3.44 2.76-1.65 1.7-5.79 4.37-7.23 0.56-4.09 3.84-0.429 6.06-2.14 2.53 2.05 2.02-5.08 3.28-0.435 2.17-1.26 5.36-3.26 7.12-3.59 1.78-0.77 1.23 0.454 1.6-0.802 0.711 1.66 3.54 1.4 3.93 3.88-0.111-6.19 3.06 3.77 6.73 0.248 3.28 3.78 3.05-3.14 3.7-2.48 3.85-1.51 1.84-6.81 4.16-8.85 0.721 2.38 3.3 3 4.14 0.157 0.731 6.1 3.22-5.43 4.25 0.361 1.78-0.333 2.99 3.12 4.79 0.705 1.9 2.58 5.1 0.637 6.91 2.42 0.591-2.83 0.996 2.83 1.58 0.163-0.0621 3.73 3.64 3.93 3.73-0.178 0.303 1.65 0.703 4.36 1.63 1.21 1.47 3.36 3.43-1.4 3.28 3 1.25 1.4 1.13 2.21 2.44 1.29 1.48 0.725 0.975 1.98 1.91 0.0674 0.336 0.999 0.806-1.03 1.94 0.968 1.41-1.29 1.98 0.987 3.4-1.59 1.13 1.5 2.08 3.72 2.1 2.14 2.22 2.55 2.52-4.81 3.06-6.76 2.32-2.21 0.624-5.66 0.466-8.57 0.17-1.77 1.25-3.32 1.08-5.19 0.619-0.635 1.08 1.06 1.04-1.83 0.513-1.47-0.667-3.65 1.21-5.57-0.537-2.93-0.601-7.87 0.796-7.23-0.682-1.42-1.9-2.1-0.372-3.44 0.642-1.35-0.373-3.97 1.42-3.17-0.289-4.17 0.257-7.83 0.167-12-0.456-4.06-0.163-7.74-0.734-12.1-0.691-3.19 2.33-8.31-1.81-10.1-2.59-1.64-7.45-4.76-8.93-4.68-4.01-0.18-9.63-4.07-12.9-2.21-2-3.23-7.51-1.74-10.9-3.1-2.82-0.278-5.66-0.531-8.49-0.64","m99.9 59.9c-0.429-4.47-0.0208-8.78-1.82-12.8-3.51-4.83 4.14-9.21 0.0086-14.4-2-3.02 3.77-5.44 0.34-7.9 0.494-0.405 0.665-4.2-1.1-3.48-0.446-2.97-4.58-1.1-3.65-5.85-0.691-3.24-2.44-6.98-4.15-7.98-2.1-1.3-2.98-0.0809-5.09 0.394-1.55 1.89-3.26 2.22-5.16 1.69-1.63-0.518-3.75 0.667-4.78 0.566-2.67-0.49-4.87-0.175-7.08 2.25-3.03-0.327-2.67-8.46-6.19-9.93-1.97-3.78-5.31-2.72-7.74-0.973-2.85 0.63-4.4 4.33-6.57 5.6 0.531 2.94-2.6 2.41-1.63 5.27-0.697 1.57-1.07 3.8-2.57 4.01-0.43 0.445-2.1 2.7-2.5 3.19-1.28 0.245-3.51 1.67-3.47 0.213 1.15-1.07-2.13-0.0342-1.28 0.685-1.64-2.25-2.77-3.92-3.85-4.75-0.204 1.99-3.21-1.12-2.73-3.03-0.394-2.08-1.98-0.629-2.93-2.09-1.85 0.617-2.35-2.39-4.13-2.2-2.29-2.49-0.997 2.36-2.6 0.848-3.69-1.58 3.2-0.901-0.826-1.9-1.39-0.0212-2.12-2.89-2.41-1.48 1.28 1.14 0.165 2 1.64 2.31 0.995 3.29-2.34-0.449-3.55-1.63-0.874-0.598 2.09-0.28-0.0556-1.22-2.17 0.249-5.21-2.49-6.77-1.79-0.53-0.149-1.73 2.25-2.9 2.83-1.8 0.753-2.27 4.57-2.74 6.74 1.07 0.208-2.14 2.69-0.139 3.32-1.68 0.0341-1.04 6.3-1.46 8.25 0.00219 2.17-0.114 4.42 0.225 6.19 0.677 2.54 1.3 3.07 2.59 5.42 1.55 3.05 5.97 1.74 8.6 2.5 0.0223-1.58-3.25-0.0475-4.74-2.5-0.0458-0.298 0.105-1.68-0.224-2.45 1.45 0.536 4.37 0.187 0.951-0.121-1.61-0.444 0.726-1.06 0.343-2.19 2.84 0.364-1.46-3.11 1.41-1.01 0.239-0.745 2.54 0.93 2.45-0.0821-1.93-3.05 2.42 2.4 1.49 0.0405 0.337-1.54 2.62-0.292 3.67-0.272 1.85 0.0829 2.43 0.202 3.98 0.76-0.0615 0.618 4.33 1.47 0.663 3.43-3.07 1.17-5.25 3.19-8.23 5.11-2.81 2.09-5.65 5.13-6.71 9.26-1.05 4.27-3.19 8.41-2.01 12.5-0.482 2.44 1.32 4.39-0.938 5.97-2.67 3.49 3.93 6.97 1.12 8.63-0.752-0.662-2.34 4.31-3.1 6.72-0.875 0.844-0.966 4.32-1.08 6.66-0.522 3.04 1.13 6.87 1.43 6.14-0.344 2.44 1.89 3.56 2.78 4.37 2.95 0.334 5.14-0.012 7.96-0.3 1.02-0.116 7.99-0.679 4.58-1.12-1.9 0.568-2.99 0.0635-5.06 0.801-1.98-0.0719-4.46 0.428-6.1-0.464-0.796 0.74-1.37-4.01-0.198-2.79 2.25 1.83-1.25-2.48 1.87-1.7 2.83-1.14 4.91 0.361 7.29-1.18 1.92-0.779 1.23 2.38 3.34 1.57 1.86-1.03 4.08-0.352 5.76-1.37 1.4 1.48-2.71 1.81-1.91 2.31-0.927 1.28 1.61-0.304 1.95-0.506 1.23-0.0631 3.46 0.0403 1.56 1.08-1.62-0.0129-2.25 0.632-3 1.03 2.68 0.946 7.52-1.75 10.8-3.01 2.65-1.18 5.1-3.02 7.15-5.06 2.36-5.25 5.56-0.448 8.86-0.121 1.37-1.21 2.66-1.1 4.4-1.55 0.0892-2.14 2.74-0.396 2.11-0.787-0.0946-1.83 0.691-1.11 1.92-1.52 2.09-0.0898 4.48 1.08 6.41 2.77 0.362-1.34 0.846 2.11 1.13-0.268 0.968 1.25 3.49 3.2 3.65 5.21 1.01-1.45 3.64 1.9 4.08-0.694-0.271-2.53 0.909-6.22 1.15-8.6-0.134-3.46-0.858-9.05-2.99-11.5 0.199-4.15-5.82-5.99-4.68-8.3 1.36 0.976 6.53 3.06 6.34 2.09-2.25-1.37 2.82 0.187 3.62-0.395 2.17 0.514 2.34-0.687 4.81 0.371 2.47-0.21 3.34 0.831 5.7-0.0719 1.08 0.698 2.23-0.448 3.18 1.26 3.06 0.249 2.31 4.17 5.36 0.16 1.82 0.597 1-1.72 2.12-2.56 0.35-0.647 1.28-2.82 1.43-2.46 0.562-0.194 0.836-1.5 0.614-2.24","m99.8 79.3c-1.23 1.28-2.8 1.6-2.71-2.33-0.874 2.34-1.77-2.61-0.384-1.35-0.913-2.54-2.97-0.585-1.54 1.35-0.496-1.88-4.34-1.08-1.8-3.3-0.392-2.5 2.06-5.51 0.458-7.36 2.23 0.0233-1.16-3.53 1.66-3.13 0.976-4.27 1.61-7.65 2.54-10.9-0.918-1.03 0.492-4.21-0.889-3.83 1.26-2.54-1.66-1.5-0.197-4.16-0.239-4.15-0.939-7.77-1.87-11.8-1.58-7.17-5.22-10.5-8.2-15.2-1.74-2.23-5.4-4.65-6.26-5.48-0.845-1.88-2.96-1.74-4.16-3.92-0.963-1.67 1.65 3.7-0.523 0.815-1.12-2.24-2.85 1.85-2.98-2.14-1.31-1.61-4.23-3.32-5.55-1.8-1.35-3.46-3.65-0.563-5.08-2.75-1.37 0.15-1.43 0.812-3.27 0.0912-0.8-0.479-3.38-4.46-3.03 0.259-1.56 0.0992-2.49-3.03-3.33 0.506-1.32-0.386-2.76-2.34-3.8-2.61 1.48-0.779-3.9 0.356-0.338 0.951-1.41 0.994-2.97-2.17-1.86 1.46-1.74 0.622-5.09-1.66-2.91-1.2-1.4-2.06-1.98 1.32-3.26-1.26-0.679-0.164 0.482 2.12-1.26-0.0521-0.111 2.63 3.46 2.95 1.05 3.72-0.366 2.68-2.17-7.37-2.62-1.92 3.35 5.38-5.4 2.82-0.71 2.85 1.03-0.871-0.364-0.422 0.205-1.98-1.71 1.42-3.3 1.78-3.02-0.928-0.314 0.993-2.58-0.631-3.25 1.06-1.36-1.31-3.83-0.359-4.09 1.87 0.109 2.08-4.2 1.16-1.38 1.87-0.768 3.09-2.3 0.448-2.59 1.81-0.0473-3.64-2.18-2.31-0.257-0.0301-0.4 2.61 0.264 4.08-1.29 1.17-1.11 1.41-3.49-1.06-3.28 2.56-1.32 0.226-2.8-2.86-3.12 2.33-0.132-5.07-1.49 0.898-3.15-1.67-1.97 1.34-0.959 5.64-2.79 3.3-1.45 1.59-2.56 2.9-0.0603 1.39 0.498 3.59 3.38-2.18 1.75 1.61-1.73 0.89-3.63-0.669-4.79-0.0128-0.534 1.76 0.746 0.52-1.52 2.29-1.55 2.33-0.801 3.98-2.57 5.16 1.49 2.66 0.664 1.18 1.96 0.066 0.434 2.2-0.976 5.15-0.955 2.48-3.51-4.16 1.35 4.45-2.06 2.94-0.618 1.66 1.58-0.0786 0.436 2.27-1.8 4.07-1.17 9.35-0.621 14 0.402 2.92-0.0393 3.11 0.497 3.64-0.331 2.66 0.431 3.91 0.22 6.05 0.719 0.111-1.02 2.41 0.871 4.3-0.0436 3.58 0.613 6.96 2.21 9.59 2.35 1.7 3.41 4.1 5.51 4.43 1.39 5.72 5.4 7.3 8.07 10.4 2.82 3.17 6.86 4.01 9.36 6.34 1.84 0.142 3.4 1.4 4.74 1.79 1.58 0.552 2.87-0.366 2.07 1.17 2.6-0.306 3.43 1.66 6.02 1.37 2.78 1.87 6.31 1.85 9.12 1.73 2.8 2.46 4.38-1.47 6.07 0.698 3.54-0.298 7.35-0.155 11-1.52 2.47-0.667 5.1-1.55 7.58-1.95 1.75-0.981 3.32-0.539 5.03-0.831 2.11-0.536 3.45-1.66 4.62-1.14 1.99-2.58 4.23-0.53 6.26-3.67 0.324 2.76 3.77-2.67 4.44-1.66 0.644-1.53 1.18-3.73 1.15-1.54 1.53 8.08e-4 -0.0866-2.07 2.03-2.28 0.463 1.49 3.36-3.95 2.43-5.98","m64.2 0.539c-3.04 1.13-4.28 1.48-7.29 2.16-2.93 0.926-5.25-0.384-6.34 3.44-0.19 2.45-1.8 3.55-3.03 6.32 0.108 3.53-5.56 3.56-2.35 1.79-2.19-2.65-6.04-3.21-9.46-3.61-3.18 0.962-5.72 1.02-7.97 2.44-2.01 1.05 1.32 1.78-1.55 2.46 0.234 4.66-4.92 2.17-7.55 4.76-2.35-0.93-5.47 1.08-4.9 1.17-1.32-0.158 1.23 3.18-1.62 2.75-1.76 1.03-4.26 2.49-2.67 3.79-2.22 1.65-3.12 5.44-4.02 9.36-1.42 3.27 0.484 7.57-1.55 9.1-0.778 3.13 0.0511 6.82-0.816 8.38 0.33 1.07-0.709 2.21-0.265 3.18-2.15 0.906 0.318 3.89-0.247 4.91-1.03 3.9-0.923 5.95-1.73 8.36 0.35 1.94 0.102 5.22-0.347 6.91-1.12 2.26 1.43 6.21-0.447 6.94 0.0358 3.06 2.24 1.14 1.15 3.73 1.52 2.36 2.73 3.76 5.62 6.23 0.927 0.525 4.32 4.39 7 4.89 1.62-1.38 3.94-3.44 5.19-6.32 2.59-0.889 5.01 2.84 6.32 1.6-0.752 1.86 3.63 0.13 4.68 2.69 0.384 0.0568 1.7-1.95 1.51-0.607-2.51 2.91 3.17 1.17 2.3 0.963-0.257 2.72 3-0.793 3.03 0.11 1.77-0.129 0.96-2.42 2.31-0.695-0.726-0.685 1.65-3.56 1.86-1.19-0.799-3.27 2.71-5.48 3.01-8.76-1.44-0.786-8.22 1.44-2.83-0.345 2.9-0.209 4.13-0.42 5-2.82 2.54 1.85 4.65 3.55 6.86 4.37 1.83-1.33 1.82 0.143 1.01 1.35 3.12-2.09-1.13 1.54 2.65 0.572 2.27 2.39 4.95 1.27 7.51 0.842 1.54-1.6 3.05-0.883 3.72-3.58-0.856-0.757 2.88 0.329 2.85-2.42 0.71-2.56 4.67-2.24 3.75-3.73 1.09-0.163 2.86-4 4.19-1.51-0.912 1.37-3.02-1.52-2.18 1.38 2.59 0.157 2.94-3.7 5.31-3.46 0.195-0.817 1.5 2.01 0.332-0.81-3.65 0.277-0.695-3.85 0.926-1.84 1.51-1.34-0.182-2.91-1.26-1.47-3.11-0.966 2.58-1.69 3.22-2.65 0.724-0.837-3.99-0.537-1.15-1.43 0.207-0.0239 2.33-2.25 0.396-2.21 1.75-1.03 0.404-2.77 3.06-1.65-2.13-1.35 4.25-1.89 0.951-3.16 2.05 0.115 0.407-1.17 1.51-2.55-1.23-1.97-0.913-2.48 0.164-3.68-3.58-1.14 3.32-3.83 0.162-0.809 1.43 1.04 2.96-3.68-0.242-2.09-0.637-0.992 4.45-0.246 0.689-1.5 2.7-2.59-2.1-0.753 0.177-3.6 1.07-1.15 2.59-1.79 2.61-3.95-0.219-1.26 0.806-4.08 0.025-4.69 1.09-0.882 1.92-1.99 2.06-3.32 0.889-0.326-0.453-2.78 1.45-1.56-1.42-2.04 0.433-2.61-0.0815-4.94 2.65-1.48-2.48-2.36 1.4-2.28 1.12-1.01 2.32-4.78 1.59-5.76 1.2-1.01-3.05-1.28-0.352-2.6-0.95-0.331-2.6-0.781-0.343-1.39-1.22-3.04-2.16 1.36-2.79-1.89 0.717-0.51-2.24 0.659-1.16-0.68-1.36 1.93-4.2-1.53-2.41 1.45-1.39-1.07-3.78 0.856-1.96-2.22-1 0.261-2.11 1.78-4.01 1.33-2.63 1.47-3.27 0.8-6.2 1.05-1.86-0.919-0.729 1.95-3.33 0.295-4.17 1.08-1.6-5.9-2.7-8.54 0.219-2.95-1.7-5.27-4.39-5.74 0.0318-1.12-0.108-0.55 0.847-2.61-0.53-2.2-3.05 2.19-4.21-0.651-0.985 1.5-1.5-1.46-2.61 0.229z","m97.3 57.2c-3.41 0-4.74-6.08-8.05-6.1-1.29-0.795-3.87-0.991-2.73-2.24-0.461 0.105 4.07-1.76 2.58-2.95-0.276 0.0469-1.66-4.4-1.88-1.47-1.36-0.391-1.07-2.36-1.27-1.62-1.62 0.0399 8.03-1.15 6.51-0.797-1.78 0.597-1.31-1.57-2.35-2.4-0.458 0.327-4.94-0.923-1.01-0.854-0.831-1.1-0.472-1.75 0.0586-4.04 0.533-1.89-2.5 0.207-0.825-1.39-0.89-1.75-1.09-0.904-1.57-3.06-1.16-0.951-1.78-1.03-2.84-1.14 2.11 0.151-0.32-2.08 1.08-1.45 0.421-0.661 8.25-3.23 7.96-4.94-1.57-1.95-1.71-0.0456-3.1-3.81 0.665 3.54-0.192 0.654-0.944-0.899-0.654-1.49-1.36-3.11-2.92-4.35-1.19-2.92-0.257 2.7-1.65-0.177-0.363-2.09-3.08 0.626-1.6-1.95 0.915-1.38 5.96-7.76 6.92-5.41-1.84-0.314 0.0411-0.555-1.4-2.01-2.65-0.62-0.587-2.27-2.83-1.94-0.891-1.13-0.313-0.513-0.368-1.36-1.07-1.02-1.2-1.36-1.13 0.396-1.83-0.483-2.44-0.812-3.45-0.308-2.32-0.0102-9.13-0.462-12-0.359-0.581 0.361-2.24 4.17-3.12 3.74-0.345 0.803-29-4.16-30.3-2.87 0.426-0.902-5.43-0.656-2.95-0.38-2.09 0.429-2.98 0.345-3.78 0.739-1.76 0.0938-2.27 3.72-3.7 3.74-0.875 1.71-1.59-0.443-2.57 0.925-1.59-0.0625-4.02-0.262-3.68-0.529-1.73 0.25-2.36-0.259-2.95-0.822-1.27 0.255-1.65-3.16-3.36-3.25-1.77-0.478-3.08 0.112-4.51-0.279-0.795-1.08-2.01-0.597-2.79-0.309-1.29 0.673-2.41-1.64-3.25-0.36 0.269 3.8-0.413 9.13-1.18 9.65-0.958 3.77 6.29 8.17 4.95 11.7 0.33 2.17-5.9 4.99-5.18 7.06-0.151 3 2.7 2.24 4.34 1.83 1.55 1.14 3.65-0.928 4.48 1.08 0.844 4.55-4.57 7.76-2.15 12.5 0.93 4.55 5.67 2.93 8.52 4.87 2.87 0.757 9.05 1.51 3.39 4.16-3.63 3.38-20 9.73-18.1 14.2 2.82 2.46 6.51 1.82 9.54 2.71 2.8 0.982 5.74 0.786 8.6 2.07 3.35 1.2-2.94 2.88-3.3 5.45-2.42 3.72-3.78 8.59-3.09 13.1-0.57 4.75 4.49 3.18 7.13 4.2 8.46 2.12 33.1 4.16 41.8 4.31 5.06 0.0968 10.1 0.248 15.2 0.179 2.56-1.15 5.94 0.664 9.04-0.886 3.42-0.389 7.19-1.46 10.3-3.45 2.26-1.65 5.26-6.01 3.7-9.75-1.99-2.48-3.9-6.12-4.74-8.06-1.1-2.55-3.59-3.99-5.43-5.01-1.16-0.584-3.28-0.481-4.21-0.804 1.7-2.1 14.6-5.56 14-9.31 0.303-2.06-0.0416-5.48-1.94-5.48z","m86.9 0.416c-2.65 0.408-5.71-0.589-8.11 0.475-3.02-1.44-6.37 0.199-9.03-0.782-1.92 1.65-4.94 0.317-7.17 0.0679-3.2 0.55-7-0.879-10.1 0.314-2.97-0.426-6.34-0.492-9.57 0.108-2.95 0.128-6.34-0.391-8.93 0.331-2.24 0.0952-4.71-0.758-6.98 0.496-3.21-0.616-6.48-0.693-9.53 0.357-2.98 0.795-5.03 3.75-7.08 7.64-2.73 2.45-6.1 3.3-7.82 8.86-0.445 0.677-3.29-2.09-2.51 1.37 3.26-1.21-0.803 8.33 2.38 10.4 0.42 6.11 3.88 6.35 6.25 6.63 2.29 1.75 5.76-1.33 7.03 3.1-1.79 2.08-4.22 2.77-6.05 4.95-3.39 4.3-4.2 11.5-2.08 17.9 1.85 5.04 0.776 12.6 2.91 17.4 1.53 2.54 3.71 2.13 5.02 3.42 3.52-1.88 2.62 7.15 5.18 8.6 2.6 2.27 5.67 1.43 8.43 2.78 2.92 0.673 5.36-0.13 8.13 0.67 2.73-0.475 5.51 1.53 8.19 0.136 2.71 1.99 5.7 0.76 8.48 1.13 1.47 0.551 3.01-0.468 4.52 0.174 2.15 1.32 4.49 0.423 6.78 0.366 2.48 1.8 5.74 1.69 8.46 1.47 2.86-1.03 5.56 1.22 8.36 0.503 2.47 1.6 5.08 0.104 7.27-0.656 0.0273-4.47 3.15-5.73 2.5-11.4 2.59-4.28 1.77-10.5 0.635-15.5-2.25-5.73-7.91-4.13-7.78-12.2-0.15-5.61 5.39-0.0295 7.76-2.7 2.57 1.77 5.55 0.341 6.09-4.8 3.49-3.55-0.732-9.66 0.471-13.6-1.53-2.77-3.79-5.59-6.39-4.86-1.83-0.569-3.35-0.944-2.87-5.04-3.26-3.66 2.44-4.1 2.02-8.61 3.91-6 0.769-13.5-2.16-17.9-0.935-0.187-1.76-1.25-2.72-1.66z","m0 97.2v-97.2h100s-1.64 4.67-2.14 7.16c-0.493 2.49 1.85e-4 0.623-1.07 2.18-1.07 1.56-1.97 2.18-2.47 4.05s-0.658 3.11-1.4 3.11c-0.74 0-1.32-0.622-2.14 2.18-0.822 2.8-0.904 3.43-1.81 4.36-0.905 0.934-1.07 3.43-1.64 5.3-0.576 1.87-1.07 2.18-1.97 4.05-0.904 1.87-2.38 3.12-3.04 4.98-0.658 1.87-1.48 4.67-1.73 6.54s-1.81 6.23-3.45 7.79c-1.64 1.56-3.37 2.49-4.03 4.05-0.658 1.56-1.07 3.43-2.06 3.74-0.987 0.312-6.09 9.35-7.98 9.03-1.89-0.311-4.19-0.312-4.44 2.18-0.247 2.49-1.89 2.18-3.95 0.623-2.06-1.56-3.37-0.623-5.51 2.8-2.14 3.43-2.88 0.311-3.62-0.623-0.74-0.934-4.11 1.25-5.35 2.49-1.23 1.25-2.06 1.56-3.37 1.56-1.32 0-3.21 5.3-4.19 5.61-0.37 0.117-0.821 0.102-1.27 0.0869-0.757-0.0243-1.52-0.0486-1.93 0.535-0.658 0.934-1.56 3.74-2.22 4.67-0.658 0.934-2.47 0.934-2.96 0.934-0.494 0-2.14-2.49-3.54 0-1.4 2.49-3.04 4.98-4.36 4.05-1.32-0.934-2.63-4.05-3.7-1.56-1.07 2.49-3.45 8.41-4.19 8.1-0.74-0.312-4.19-1.87-5.02-2.18-0.822-0.311-3.45-0.622-3.45-0.622","m0 100v-100s2.5 1.73 2.92 3.47c0.417 1.73 1.04 3.18 2.08 3.47 1.04 0.29 1.87 0.00176 2.81-0.288 0.937-0.29 1.98 2.02 3.02 2.6 1.04 0.577 3.44 1.15 4.17-0.29 0.729-1.44 1.46-1.16 2.29 0 0.833 1.16 2.19-0.867 4.48-1.73 2.29-0.867 3.54-4.34 4.69-2.6 1.15 1.73 2.71 4.62 3.33 5.2 0.625 0.577 0.729 1.73 2.08 4.05 1.35 2.31 3.75 1.16 4.9 0.867 1.15-0.288 3.65-0.867 4.06 0.867 0.417 1.73 3.54 11 5.83 11.3 1.15 0.146 1.98 0.0728 2.63 8.46e-4 0.65-0.072 1.12-0.145 1.54-8.46e-4 0.833 0.29 1.15 2.31 2.08 3.18 0.937 0.867 1.04 2.02 2.6 2.89 1.56 0.867 2.6-0.29 4.06-1.44 1.46-1.16 3.65-3.47 5.1-2.6 1.46 0.867 1.35-0.577 3.85 2.02 2.5 2.6 3.54 3.18 5.52 3.76 0.729 0.213 0.978 0.152 1.21 0.0902 0.397-0.106 0.743-0.211 3.37 1.07 4.17 2.02 4.9 0.867 6.77 0.867 1.88 0 6.04-0.867 7.4 0.29 1.35 1.15 3.96 1.16 4.9 0 0.937-1.16 2.29-1.73 2.29-1.73v43.9s-2.5-2.89-3.85-1.45c-1.35 1.45-2.81 2.89-3.75 3.76-0.937 0.867-2.71 2.02-4.17 2.02-1.46 0-2.08 2.02-4.06 2.02-1.98 0-4.58 0.869-5.83-0.577-1.25-1.44-2.19-1.44-3.85-2.6-1.67-1.16-2.92-1.15-3.85 0-0.938 1.16-5.21 2.89-6.25 4.34-1.04 1.44-3.02 2.02-3.85 2.02-0.834 0-3.85-2.6-4.48-2.02-0.625 0.577-4.58 2.89-6.04 5.49-1.46 2.6-3.33 2.89-4.9 2.89-1.56 0-3.13-0.29-5.1-1.16-1.98-0.867-7.71-3.18-8.33-2.89-0.625 0.29-1.77 2.89-3.85 4.62-2.08 1.73-4.17 2.6-5 2.6h-6.25c-0.312 0-2.92-0.577-4.06-1.16-1.15-0.577-1.77-2.31-2.71-2.89-0.937-0.579-0.938-2.31-2.6-1.16-1.67 1.16-1.56 0.867-3.33 2.31-1.77 1.45-3.85 4.62-3.85 4.62","m0 70.8v-70.8h100v97.9s-3.74-2.93-6.23 0c-2.49 2.93-2.74 2.56-5.24 0-2.49-2.57-4.24-1.83-7.23-2.57-2.99-0.732-6.98-1.46-7.48-3.66-0.498-2.2-2.24-2.93-3.74-2.2-1.5 0.733-6.73 0.366-8.23-0.733-1.5-1.1-1.5-3.66-5.24-5.49-2.08-1.02-2.69-0.34-3.49 0.339-0.64 0.543-1.4 1.09-3.11 0.76-3.87-0.733-5.36-3.3-7.11-3.3-1.75 0-4.24 2.56-7.48 0.733-3.24-1.83-2.49-3.16-7.23-3.41-1.67-0.0891-3.06 0.414-4.32 0.919-2.33 0.929-4.23 1.86-6.65-0.919-3.74-4.28-4.24-5.75-8.23-5.02-3.99 0.733-4.99 3.3-6.98 0.367l-2-2.93","m100 19.6v80.4h-100v-97.8s2.29-4.97 4.38 0c2.08 4.97 5.42 5.62 6.46 4.97 1.04-0.654 4.79-0.654 5.62-0.654 0.833 0 4.38 3.79 5 3.86 0.625 0.0667 1.88 0.585 3.54 0 1.67-0.586 3.96-1.38 4.58 0 0.625 1.37 2.08 3.99 3.13 4.64 1.04 0.654 1.67 0.654 3.54 0.654 1.88 0 4.58 1.99 6.04 3.94 1.46 1.95 1.25 0.64 3.75 5.87 2.5 5.23 1.46 11.1 3.96 8.82 2.5-2.29 2.71-0.327 5.21-4.25 2.5-3.92 2.29-3.92 4.79-5.88 2.5-1.96 5.83-6.51 6.56-4.56 0.729 1.95 3.65 2.6 5.31 3.25 1.67 0.654 1.67 3.27 3.96 1.31 2.29-1.96 1.04-4.55 4.79-4.56 1.26-0.0049 2.21 0.216 3.16 0.437 1.88 0.437 3.73 0.875 7.88-0.436 6.25-1.97 8.33 0 8.33 0","m0 0v100h100v-45.4s-4.66-9.87-7.4-4.61c-2.74 5.26-5.48 1.97-8.22 0-2.74-1.97-9.04-8.55-11.2-7.89-1.04 0.312-2.57-0.705-4.12-1.72-1.73-1.13-3.49-2.26-4.64-1.57-2.19 1.32-3.56 2.63-7.12 0-3.56-2.63-2.47-6.58-7.26-5.26-4.8 1.32-8.08 0-11.9-3.29-3.84-3.29-4.11-7.89-9.32-7.24-5.21 0.658-7.75 2.16-9.04-1.32-2.19-5.92-1.1-7.89-4.66-9.87-3.56-1.97-2.74-5.26-5.75-6.58-3.01-1.32-9.32-5.26-9.32-5.26","m100 0.435v98.2s-2.49 0.722-4.98 0c-1.01-0.293-2.02 0.175-2.98 0.643-1.41 0.684-2.71 1.37-3.77-0.323-1.78-2.85-1.78-3.57-5.69-3.57-3.91 0-6.4-0.361-7.46-1.08-1.07-0.722-3.55-3.25-5.33-3.25s-3.55-0.722-7.82 0c-4.26 0.721-11.4 2.89-14.9 1.44-3.55-1.44-6.4-3.25-8.17-3.25s-6.75 1.08-8.53-1.08c-1.78-2.17-0.711-4.33-4.62-4.33-3.91 0-3.2-0.361-7.11-0.722-3.91-0.361-7.46-2.53-8.88-3.61-1.42-1.08-3.91-2.17-6.4-3.61-2.49-1.44-4.26-3.61-2.84-5.41 1.42-1.81 2.13-5.05 2.84-6.86 0.711-1.8-1.07-7.51 0-8.08 1.07-0.58 2.13-4.62 2.13-5.3 0-0.69 0.711-6.1 0.711-6.1s1.42-4.69 1.42-6.32c0-1.62 1.07-3.79 1.78-6.32 0.711-2.53 0.355-2.89 1.07-6.14 0.71-3.25 1.07-6.14 2.13-9.02 1.07-2.89 0.711-4.33 2.13-6.86 1.42-2.53 3.2-2.37 6.4-2.63 1.24-0.101 2.64 0.078 3.97 0.257 2.11 0.283 4.04 0.566 4.91-0.257 1.42-1.34 9.59-2.79 11.4-3.51 1.78-0.722 5.54-0.722 8.63-0.361 3.1 0.361 7.36 0.722 9.49-0.361 2.13-1.08 4.97-3.61 7.46-2.17 2.49 1.44 7.11 1.81 9.95 1.81 2.84 0 8.17-0.361 9.59-0.361 1.42 0 13.5-1.44 13.5-1.44","m0 100h100v-98.1s-2.26 2.58-3.06 6.45c-0.799 3.87-1.86-3.87-2.53-6.45-0.666-2.58-2-2.58-2.66 0-0.666 2.58-2.93 5.16-3.59 10.3-0.666 5.16-2 1.29-3.33 5.16-1.33 3.87-2.8 3.87-3.6 5.16-0.799 1.29-1.86-1.29-2.53-3.87-0.666-2.58-0.932-9.03-1.86-7.74-0.359 0.498-0.835 0.0392-1.33-0.418-0.794-0.735-1.64-1.47-2.13 1.71-0.799 5.16-2.13 1.29-2.93 5.16-0.349 1.69-0.546 1.66-0.802 1.62-0.329-0.0434-0.754-0.0898-1.73 3.54-1.73 6.45-1.73 7.74-3.59 14.2-1.86 6.45-3.99 6.45-4.66 6.45-0.666 0-2.13-3.87-3.2-5.16-1.06-1.29-3.86-9.03-4.26-7.74-0.16 0.516-0.383 0.207-0.658-0.103-0.412-0.465-0.94-0.93-1.54 1.39-0.999 3.87-0.999 5.16-2.73 9.03-1.73 3.87-3.73 1.29-4.39 1.29-0.666 0-1.86-9.03-3.06-6.45-1.2 2.58-2 2.58-3.06 6.45-1.07 3.87-0.133-0.645-3.06 8.06-2.93 8.71-4.53 11.3-5.86 8.71-1.33-2.58-0.266-8.39-2.53-8.71-2.26-0.323-0.133-4.19-2.26-0.323-0.926 1.68-1.48 0.318-1.93-1.05-0.592-1.77-1.03-3.55-1.93 1.37-1.6 8.71-1.86 3.55-3.46 10-0.888 3.58-1.73 3.19-2.59 2.79-0.681-0.318-1.36-0.635-2.07 1.08-1.6 3.87-2.93 9.03-3.73 12.9-0.799 3.87-1.73 5.16-2.8 6.45-1.07 1.29-3.06 7.74-3.06 7.74l-1.46 9.03","m0.642 91.6c2.18-0.834 1.23 0.646 2.08 5.01 1.15 5.89 2.04-0.393 3.53-1.92 0.997-1.02 1.1-0.0486 1.34 0.919 0.167 0.677 0.401 1.35 1.05 1.35 0.673-0.0028 1.21-2.06 1.94-2.16 0.618-0.0861 1.53 1.26 2.16 1.6 0.978 0.537 2.32 1.11 3.25-0.214 1.12-1.6 1.06-5.87 1.91-7.36 0.49-0.854 1.61-0.912 2.23-1.08-0.0448 3.49 1.27 7.03 2.23 2.97-0.228 3.71 0.481 3.62 1.48 5.18 0.689 1.07 2.22 1.88 3.09 2.98 2.56 3.23 3.88-1.12 6.34-2.31 1.83-0.88 2.74-0.315 4.27 1.94 1.62 2.39 1.83 1.85 3.39-0.883 2.19-3.85 4.81-0.0486 6.84-5.73 1.17-3.28 0.699-3.87 2.54-4.2 0.763-0.135 2.62-0.893 3.33-0.516 1.6 0.843 1.1 5.2 2.63 6.59 0.307 0.282 0.625 0.0555 0.928-0.171 0.274-0.205 0.537-0.41 0.77-0.239 0.545 0.403 0.557 1.66 1.03 2.34 1.35 1.98 2.47 2.41 4.01 2.77 0.848 0.193 1.74-0.0541 2.63-0.301 1.06-0.296 2.12-0.591 3.09-0.132 0.718 0.339 1.3 2.06 2.05 1.66 0.934-0.498 1.31-4.57 1.87-6.2 0.859-2.48 1.25-4.16 3.04-3.21-0.524 6.14 3.33 4.11 4.71 3.39 0.848-0.446 1.36-0.7 2.04-2.01 0.888-1.71 1.56-7.51 2.84-7.75 1.02-0.192 4.02 7.53 5.11 9.04 1.52 2.12 2.79 3.41 4.23 0.0153 0.722-1.7 2.48-6.64 1.64-8.7 0.507-2.05 1.15-2.65 2.49-2.7 0.44-0.0167 0.848 0.0333 1.24 0.107v-81.6c-0.445 0.429-0.885 0.876-1.32 1.37-0.33 0.378-1.05 0.343-1.33 0.957-0.295 0.639-0.319 2.69-0.593 3.12-1.62 2.53-1.55 0.0208-3.15-1.53-0.362-0.351-0.409-1.3-0.906-1.61-0.242-0.149-0.558 0.107-0.892 0.362-0.337 0.257-0.691 0.515-1.01 0.358 0.0703-6.64-4.2 2.67-5.42 3.23-1.38 0.637-2.65-0.368-3.9-1.37-1.68-1.36-3.33-2.72-5.16-0.0236-2.46 3.62-3.81 10.4-7.44 10.5-0.598 0.0125-1.15-0.317-1.7-0.646-0.552-0.329-1.1-0.658-1.68-0.646-1.25 0.0264-2.54 2.7-3.82 1.58-1.11-0.979-1.29-4.91-2.23-5.75-0.609-0.541-1.21 0.146-1.81 0.832-0.576 0.659-1.16 1.32-1.76 0.894-1.14-0.802-1.5-4.69-2.45-6.31-1.24-2.12-2.71-1.89-4.11-1.23-1.89 0.883-3.13 3.74-4.83 5.04-0.567 0.432-1.31 0.0986-2.06-0.235-1.04-0.465-2.1-0.93-2.71 0.677-0.65 1.7 0.652 7.88-0.753 9.93-1.3 1.9-0.737-0.33-1.75-1.81-0.856-1.25-0.647 0.13-1.34-1.47 0.523-2.12 1.3-4.75 0.92-7.43-0.264-0.0514-0.611-0.018-0.991 0.0153-1.09 0.0944-2.45 0.189-2.96-1.65-0.319-1.14 0.104-5.07-0.0232-6.59-0.958 0.0236-10.5 11.6-9.23 1.89-0.96 4.56-3.26 9.14-5.33 7.57-0.658-0.497-1.2-2.3-1.84-2.73-0.614-0.419-1.21-0.204-1.82 0.0111-0.399 0.14-0.803 0.282-1.22 0.244-0.86-0.0764-1.94-1.51-2.72-1.16-1.38 0.628-2.42 4.97-3.89 5.08-2.16 0.172-2.31-5.77-4.01-7.49-0.809-0.822-1.8-0.18-2.79 0.99v86.8c0.206-0.0403 0.418-0.0958 0.642-0.18","m89.3 0h-89.3v94.5c0.542 1.3 1.03 2.47 1.34 2.65 1.24 0.722 1.8-3.48 2.81-4.09 1.45-0.875 0.831 1.28 2 2.99 1.64 2.4 2.1-1.09 3.84-1.12 0.421-0.0071 0.747 0.258 1.04 0.524 0.65 0.593 1.12 1.19 2.09-1.25-0.447-1.41-1.17-2.01-1.74-3.04 0.802-1.44 1.52-2.38 2.16-4.14 0.692-1.9 0.15-4.06 1.52-4.07 0.985 4.63-0.761 7.72 1.38 9.28 0.3 0.219 0.6 0.0435 0.906-0.131 0.334-0.191 0.674-0.382 1.03-0.059 0.792 0.725 1.15 4.18 1.89 4.91 1.78 1.76 6.06-6.96 4.09-12.7 1.24-2.15 2.73-3.02 3.98-5.06 0.969-1.58 1.69-4.6 2.79-5.47 0.38 5 1.7 8.26 3.69 10-0.615 1.29-1.16 2.77-1.36 4.72 0.938 2.73 2.26 0.706 3.42 0.376 2.77-0.789 1.47 2.79 3.45 4.97 0.963 1.06 1.94-0.59 2.96-2.24 1.11-1.79 2.26-3.58 3.49-1.91 0.604 0.819 0.825 3.53 1.52 4.56 0.557 0.829 0.962 0.787 1.41 0.746 0.269-0.0239 0.554-0.0492 0.897 0.118 0.897 0.437 1.79 1.55 2.72 1.91 0.591 0.223 1.14 0.0056 1.65-0.211 0.63-0.264 1.22-0.528 1.8 0.0014 0.474 0.434 0.482 2.86 1.25 3.21 0.891 0.416 1.58-2.12 2.33-2.78 1.33-1.17 2.89-0.27 3.82-3.51-0.602 0.574-1.3 0.93-1.9 0.949 0.283-3.84 1.86-5.23 3.06-6.95-0.181-1.04-0.013-2-0.12-2.98 0.539 1.01 1.17 1.33 1.77 0.697-0.922-4.21 0.292-5.18 1.53-7.87-0.427 2.09 0.193 5.48 0.213 7.66 0.0284 3.21-0.28 2.65 0.266 5.81 0.337 1.95 1.17 0.185 0.604 3.3 1.39 2.93 7.69 4.26 5.58-4.16 0.871-0.0885 1.21 1.17 1.56 2.43 0.444 1.63 0.89 3.26 2.49 1.96 0.744-0.6 1.44-3.09 2.16-3.37 1.76-0.671 1.24 3.23 2.81 3.75 1.31 0.438 2.66-4.45 3.85-5.48 0.512-0.442 0.951-0.358 1.44-0.274 0.267 0.0464 0.548 0.0927 0.864 0.052 2.22-0.284 3.09-4.96 1.35-9.59 1.11-1.21 1.7-2.88 2.47-4.96 1.5-4.03 0.88-3.53 2.82-0.896 1.06 1.44 2.01 3.27 3.03 0.126v-73.9h-10.7","m0 51.2c3.3-2.88 6.4-5.95 9.3-9.33-0.9-1.59-2.1-3.08-3.9-3.57-0.8-1.49 0.2-3.47 1.7-4.46 0.3-0.198 0.6-0.298 0.9-0.496-0.1-0.198-0.2-0.496-0.3-0.694 1.6-1.49 3.1-2.98 4.6-4.46 0.6 0.298 1.2 0.694 1.8 0.992-0.3-0.595-0.6-1.19-0.9-1.69 0.7-0.496 1.4-1.09 2.2-1.59-0.3-1.39-0.8-2.78-2.1-3.67-0.1-1.69 1.5-3.08 3.3-3.47 0.3-0.0992 0.7-0.0992 1-0.0992v-0.794l6-2.38c0.4 0.496 0.8 1.09 1.3 1.59-0.1-0.694-0.1-1.29-0.2-1.98 0.8-0.198 1.6-0.397 2.5-0.595 1.1-3.17 1.7-6.45 1.9-9.82 1.1 0.595 2.4 0.198 3.6 0.198 1.1 0 2.3 0.496 2.6 1.49 1.6 0.0992 3.4-0.198 4.8 0.496 0.8 0.397 1.5 1.09 2.2 1.79 2.3-2.58 4.3-5.46 5.8-8.63 0.8 0.893 2.1 1.09 3.3 1.59 0.7 0.694 1.7 1.69 1.6 2.68 1.4 0.694 3.2 1.09 4.2 2.28 0.5 0.496 0.8 1.19 1.1 1.88 3.6-1.09 7.3-2.28 10.9-3.37 1 3.37 2.4 6.55 4.1 9.62 3.9 0.397 7.8 0.694 11.8 1.09-0.4 3.17-0.4 6.35-0.1 9.52 0.3 0.298 0.6 0.694 0.8 1.09 0 0.694-0.1 1.39-0.1 2.08 0.9-0.198 1.7-0.694 2.4-1.19 2.4 1.29 5 2.08 7.7 2.58-1.6 3.27-3 6.55-4.3 10 0.4 0.595 0.6 1.29 0.6 1.98-0.3 0.595-0.6 1.19-0.9 1.88 0.9 0.0992 1.8 0 2.7-0.198 1.7 2.08 3.8 3.87 6.1 5.26-3.3 2.88-6.4 5.95-9.3 9.33 0.9 1.59 2.1 3.08 3.9 3.57 0.8 1.49-0.2 3.47-1.7 4.46-0.3 0.198-0.6 0.298-0.9 0.496 0.1 0.198 0.2 0.496 0.3 0.694-1.6 1.49-3.1 2.98-4.6 4.46-0.6-0.298-1.2-0.694-1.8-0.992 0.3 0.595 0.6 1.19 0.9 1.69-0.7 0.496-1.4 1.09-2.2 1.59 0.3 1.39 0.8 2.78 2.1 3.67 0.1 1.69-1.5 3.08-3.3 3.47-0.3 0.0992-0.7 0.0992-1 0.0992v0.794c-2 0.794-4 1.59-6 2.38-0.4-0.496-0.8-1.09-1.3-1.59 0.1 0.694 0.1 1.29 0.2 1.98-0.8 0.198-1.6 0.397-2.5 0.595-1.1 3.17-1.7 6.45-1.9 9.82-1.1-0.595-2.4-0.198-3.6-0.198-1.1 0-2.3-0.496-2.6-1.49-1.6-0.0992-3.4 0.198-4.8-0.496-0.8-0.397-1.5-1.09-2.2-1.79-2.3 2.58-4.3 5.46-5.8 8.63-0.8-0.893-2.1-1.09-3.3-1.59-0.7-0.893-1.7-1.88-1.6-2.88-1.4-0.694-3.2-1.09-4.2-2.28-0.5-0.496-0.8-1.19-1.1-1.88-3.6 1.09-7.3 2.28-10.9 3.37-1-3.37-2.4-6.55-4.1-9.62-3.9-0.397-7.8-0.694-11.8-1.09 0.4-3.17 0.4-6.35 0.1-9.52-0.3-0.298-0.6-0.694-0.8-1.09 0-0.694 0.1-1.39 0.1-2.08-0.9 0.198-1.7 0.694-2.4 1.19-2.4-1.29-5-2.08-7.7-2.58 1.6-3.27 3-6.55 4.3-10-0.4-0.595-0.6-1.29-0.6-1.98 0.3-0.595 0.6-1.19 0.9-1.88-0.9-0.0992-1.8 0-2.7 0.198-1.7-1.79-3.8-3.57-6.1-5.06z","m100 48.7c-3.3 2.89-6.49 6.08-9.39 9.36-1.2 1.39-2.4 2.99-2.4 4.78-0.699-0.498-1.6-0.598-2.5-0.299 0.599 0.697 1.2 1.29 1.8 1.99-1.1-0.199-2.2 0.498-3.2 1.2-0.0999 0.0996-0.3 0.199-0.4 0.299 0.2 1.99 0.3 3.98 0.5 5.88 0.2 2.09 0.5 4.48 2.3 5.88 0.0999 1.69-1.5 3.09-3.3 3.49-0.3 0.0996-0.699 0.0996-0.999 0.0996v0.797c-2 0.797-4 1.59-5.99 2.39-0.4-0.498-0.799-1.1-1.3-1.59 0.0999 0.697 0.0999 1.29 0.2 1.99-2.7 0.697-5.49 1.29-8.19 1.99-0.4-0.598-0.699-1.2-1.1-1.79 0 1.2-1.8 1.39-3 1.2-0.5-0.0996-1.1-0.0996-1.6-0.199-0.2 1.59-1.6 3.09-2.8 4.38-2.7 2.79-4.9 5.98-6.49 9.46-0.799-0.896-2.1-1.1-3.3-1.59-0.899-0.598-1.9-1.59-1.8-2.59-1.4-0.697-3.2-1.1-4.2-2.29-0.699-0.797-0.999-1.79-1.5-2.79-0.699-1.29-1.6-2.49-2.8-3.49-0.4-0.299-0.899-0.697-1.3-0.996-0.4 0-0.699 0-1.1-0.0996-6.99-0.598-14.1-1.2-21.1-1.89 0.5-4.08 0.4-8.27-0.3-12.4 0.699-0.299 1.4-0.598 2.1-0.996-0.599-0.199-1.2-0.498-1.8-0.697 0.0999-1.39 0.2-2.89 0.3-4.28-1.3-1.29-3-2.09-4.5-3.19-1.5-1.1-2.8-2.59-3-4.48 0.3-0.598 0.599-1.2 0.899-1.89-0.899-0.0996-1.8 0-2.7 0.199-1.7-2.09-3.8-3.88-6.09-5.28 3.3-2.89 6.49-6.08 9.39-9.36 1.2-1.39 2.4-2.99 2.4-4.78 0.699 0.498 1.6 0.598 2.5 0.299-0.599-0.697-1.2-1.29-1.8-1.99 1.1 0.199 2.2-0.498 3.2-1.2 0.0999-0.0996 0.3-0.199 0.4-0.299-0.2-1.99-0.3-3.98-0.5-5.88-0.2-2.09-0.5-4.48-2.3-5.88-0.0999-1.69 1.5-3.09 3.3-3.49 0.3-0.0996 0.699-0.0996 0.999-0.0996v-0.797c2-0.797 4-1.59 5.99-2.39 0.4 0.498 0.799 1.1 1.3 1.59-0.0999-0.697-0.0999-1.29-0.2-1.99 2.7-0.697 5.49-1.29 8.19-1.99 0.4 0.598 0.699 1.2 1.1 1.79 0-1.2 1.8-1.39 3-1.2 0.5 0.0996 1.1 0.0996 1.6 0.199 0.2-1.59 1.6-3.09 2.8-4.38 2.7-2.79 4.9-5.98 6.49-9.46 0.799 0.896 2.1 1.1 3.3 1.59 0.999 0.598 2 1.59 1.9 2.59 1.4 0.697 3.2 1.1 4.2 2.29 0.699 0.797 0.999 1.79 1.5 2.79 0.699 1.29 1.6 2.49 2.8 3.49 0.4 0.299 0.899 0.697 1.3 0.996 0.4 0 0.699 0 1.1 0.0996 7.09 0.598 14.1 1.29 21.2 1.89-0.5 4.08-0.4 8.27 0.3 12.4-0.699 0.299-1.4 0.598-2.1 0.996 0.599 0.199 1.2 0.498 1.8 0.697-0.0999 1.39-0.2 2.89-0.3 4.28 1.3 1.29 3 2.09 4.5 3.19 1.5 1.1 2.8 2.59 3 4.48-0.3 0.598-0.599 1.2-0.899 1.89 0.899 0.0996 1.8 0 2.7-0.199 1.5 1.99 3.6 3.78 5.89 5.28z","m100 61.9c0 10.9-8 19.9-18.4 21.1-1.9 9.7-10.3 17-20.3 17-4.2 0-8-1.3-11.3-3.4-3.2 2.1-7.1 3.4-11.3 3.4-10.1 0-18.5-7.3-20.4-17.1-10.3-1.2-18.3-10.2-18.3-21 0-10.4 7.3-19 16.9-20.8 0-0.8 0.1-1.6 0.2-2.4 0.6-4.2 3-7 3-7s0 3.5 1.7 2.7c2.1-1 1.5-5.1 3.4-8.8 4.3-8.1 11.6-11.1 11.6-11.1s-2.9 7.2 1.6 6.3c2.9-0.6 2.6-7.5 7.5-13 7.5-8.6 16.1-7.8 16.1-7.8s-6.6 5.7-7.2 12.5c-0.4 4 1.5 8.5 5 9.2 5.1 1 4.1-2.4 4.1-2.4s3.4-0.1 6.8 3.9c2.3 2.6 1.9 6.4 4.6 6.9 1.4 0.3 1.3-2.5 1.3-2.5s2.9 1.4 4.6 5.9c1 2.6 1.3 5.1 1.4 7.4 9.9 1.7 17.4 10.4 17.4 21z","m94.3 56.2c0.4 6 2 13 5.7 21.2 0 0-16.6 12.2-50 22.6-33.4-10.4-50-22.6-50-22.6 3.7-8.1 5.3-15.1 5.7-21.1-0.5-0.9-3.9-7.7-2.5-14.8 0.9-4.5 4.3-7.5 4.3-7.5s0 3.8 2.5 2.9c3-1.1 2.1-5.5 4.9-9.4 6.1-8.7 16.7-12 16.7-12s-4.1 7.8 2.3 6.7c4.2-0.7 3.8-8.1 10.8-14 10.7-9 23.1-8.2 23.1-8.2s-9.5 6.2-10.4 13.4c-0.6 4.3 2.2 9.2 7.3 9.9 7.4 1 5.9-2.6 5.9-2.6s4.9-0.1 9.8 4.2c3.3 2.8 2.8 6.9 6.7 7.5 2 0.3 1.9-2.7 1.9-2.7s4.2 1.6 6.6 6.4c4.7 9.7-0.3 18.6-1.3 20.1z","m100 56.2v0.1c0 24.1-22.4 43.7-50 43.7-27.6 0-50-19.6-50-43.7v-0.1c0-1.6 0.1-3.3 0.4-5.1 1-5.6 4.5-9.3 4.5-9.3s0 4.7 2.6 3.6c3.1-1.3 2.2-6.8 5.1-11.6 6.5-10.7 17.6-14.8 17.6-14.8s-4.4 9.6 2.4 8.3c4.4-0.8 4-9.9 11.4-17.2 11.5-11.1 24.6-10.1 24.6-10.1s-10 7.6-11 16.5c-0.6 5.4 2.3 11.3 7.7 12.2 7.8 1.3 6.3-3.2 6.3-3.2s5.1-0.1 10.3 5.1c3.5 3.5 2.9 8.4 7.1 9.2 2.1 0.4 2-3.3 2-3.3s4.4 1.9 7 7.9c1.6 4.2 2.1 8.3 2 11.8z","m100 41.1v34.5c-2 0-3.7 0.3-5.2 0.8v0.7c0 5-4.1 9.1-9.1 9.1h-0.1c-0.6 2-0.6 3.6-0.6 3.6-12.4 7-30 10.2-35 10.2s-22.6-3.2-35-10.2c0 0-0.1-1.6-0.7-3.7h-0.1c-5 0-9.1-4.1-9.1-9.1v-0.7c-1.4-0.4-3.1-0.7-5.1-0.7v-34.5c0-0.9 0.1-1.8 0.3-2.8 1-4.2 4.5-7 4.5-7s0 3.5 2.6 2.7c3.1-1 2.2-5.1 5.1-8.7 6.5-8 17.6-11.1 17.6-11.1s-4.4 7.2 2.4 6.2c4.5-0.6 4.1-7.4 11.5-12.8 11.5-8.4 24.6-7.6 24.6-7.6s-10 5.7-11 12.4c-0.6 4 2.3 8.5 7.7 9.2 7.8 1 6.3-2.4 6.3-2.4s5.1-0.1 10.3 3.8c3.5 2.6 2.9 6.3 7.1 6.9 2.1 0.3 2-2.5 2-2.5s4.4 1.4 7 5.9c1.4 2.8 2 5.4 2 7.8z","m91.7 37.2c2.6-0.4 5.4-1 8.3-1.7 0 0-5.2 44-50 64.5-44.8-20.5-50-64.5-50-64.5 2.9 0.7 5.6 1.3 8.3 1.7-0.1-1.3-0.1-2.7 0.2-4.1 0.8-3.6 3.8-6 3.8-6s0 3 2.2 2.3c2.6-0.9 1.9-4.4 4.3-7.5 5.4-6.9 14.7-9.6 14.7-9.6s-3.7 6.2 2 5.4c3.7-0.5 3.3-6.4 9.6-11.1 9.5-7.3 20.5-6.6 20.5-6.6s-8.4 4.9-9.2 10.7c-0.5 3.5 1.9 7.3 6.4 7.9 6.5 0.8 5.2-2 5.2-2s4.3-0.1 8.6 3.3c2.9 2.3 2.5 5.5 5.9 6 1.8 0.3 1.6-2.1 1.6-2.1s3.7 1.2 5.8 5.1c1.7 2.9 2.1 5.8 1.8 8.3z","m97.2 50.9v34.9s-0.3 2.6-3.8 3.3l-40.2 10.3s-2.5 0.6-3.4 0.6-3.4-0.6-3.4-0.6l-40.3-10.3c-3.4-0.8-3.8-3.3-3.8-3.3v-34.9c-1.2-2.3-3.2-7.3-2-12.5 0.999-4.2 4.49-7 4.49-7s0 3.5 2.6 2.7c3.1-1 2.2-5.1 5.09-8.7 6.49-8 17.6-11.1 17.6-11.1s-4.39 7.2 2.4 6.2c4.49-0.6 4.1-7.5 11.5-12.9 11.5-8.4 24.6-7.6 24.6-7.6s-9.99 5.7-11 12.4c-0.599 4 2.3 8.5 7.69 9.2 7.79 1 6.29-2.4 6.29-2.4s5.09-0.1 10.3 3.8c3.5 2.6 2.9 6.3 7.09 6.9 2.1 0.3 2-2.5 2-2.5s4.39 1.4 6.99 5.9c4.2 7.7 0.899 14.8-0.799 17.6z","m100 35.6v51.8h-10.4c-3.4 1.9-8 3.5-13.6 4.7-1.4 0.3-2.8 0.6-4.3 0.8 0 0-3.4 0.8-5 1.2-5.3 1.3-13.4 3.6-16.7 5.9-3.3-2.3-11.4-4.5-16.7-5.9-1.6-0.4-5-1.2-5-1.2-1.5-0.3-2.9-0.5-4.3-0.8-5.6-1.2-10.2-2.8-13.6-4.7h-10.4v-51.8c0-0.9 0.1-1.8 0.4-2.7 1-3.6 4.5-6 4.5-6s0 3 2.6 2.3c3.1-0.9 2.2-4.4 5.1-7.5 6.5-6.9 17.6-9.5 17.6-9.5s-4.4 6.2 2.4 5.3c4.4-0.5 4-6.3 11.4-11 11.5-7.2 24.6-6.5 24.6-6.5s-10 4.9-11 10.6c-0.6 3.4 2.3 7.3 7.7 7.9 7.8 0.8 6.3-2 6.3-2s5.1-0.1 10.3 3.3c3.5 2.2 2.9 5.4 7.1 5.9 2.1 0.2 2-2.1 2-2.1s4.4 1.2 7 5.1c1.5 2.4 2 4.8 2 6.9z","m100 35.9-4.1 42.7v0.2c0 4.1-5.2 7.5-11.7 7.5-1.4 0-2.6-0.2-3.9-0.5-2.9 3.3-7.4 6.1-13 8.1-1.1 0.4-2.3 0.8-3.5 1.1 0 0-3.3 0.7-4.6 1.3-2.9 1.2-5.8 2.6-9.2 3.7-3.4-1.1-6.3-2.5-9.2-3.7-1.3-0.6-4.6-1.3-4.6-1.3-1.2-0.3-2.4-0.7-3.5-1.1-5.7-2-10.1-4.8-13-8.1-1.2 0.3-2.5 0.5-3.9 0.5-6.5 0-11.7-3.4-11.7-7.5v-0.2l-4.1-42.7c0-0.9 0.1-1.8 0.4-2.8 1-3.6 4.5-6 4.5-6s0 3 2.6 2.3c3.1-0.9 2.2-4.4 5.1-7.5 6.5-6.9 17.6-9.6 17.6-9.6s-4.4 6.2 2.4 5.4c4.4-0.5 4-6.4 11.4-11.1 11.5-7.3 24.6-6.6 24.6-6.6s-10 4.9-11 10.7c-0.6 3.5 2.3 7.3 7.7 7.9 7.8 0.8 6.3-2 6.3-2s5.1-0.1 10.3 3.3c3.5 2.3 2.9 5.5 7.1 6 2.1 0.3 2-2.1 2-2.1s4.4 1.2 7 5.1c1.5 2.4 2 4.8 2 7z","m96.4 38.7c0.4 9.69 3.6 14.6 3.6 14.6s-3.6 5.39-3.7 16.2c0 0-0.1 2.2-2.4 2.2h-5.8v9.69c0 4.2-3.3 7.69-7.4 7.69h-6.6c0 3-0.9 5.39-2.6 6.79-1.2 0.999-2.7 1.4-4.5 1.3-1-0.0999-2.4-0.3-3.8-0.499-3.2-0.499-7.1-0.999-8.9-0.599-2.6 0.499-3.8 2.9-3.8 3l-0.5 0.999-0.5-0.999s-1.2-2.4-3.8-3c-1.8-0.4-5.8 0.2-8.9 0.599-1.4 0.2-2.8 0.4-3.8 0.499-1.8 0.0999-3.3-0.3-4.5-1.3-1.7-1.4-2.6-3.8-2.6-6.79h-6.6c-4.1 0-7.4-3.4-7.4-7.69v-9.69h-5.8c-2.3 0-2.4-2.2-2.4-2.2-0.1-10.7-3.7-16.1-3.7-16.1s3.3-4.89 3.6-14.6c0-0.999 0.1-2 0.3-3 0.9-3.9 4.2-6.49 4.2-6.49s0 3.3 2.4 2.5c2.9-0.899 2.1-4.79 4.8-8.09 6-7.49 16.3-10.3 16.3-10.3s-4.1 6.69 2.2 5.79c4.1-0.599 3.7-6.89 10.6-12 10.7-7.89 22.9-7.19 22.9-7.19s-9.3 5.29-10.2 11.6c-0.5 3.7 2.1 7.89 7.1 8.49 7.2 0.899 5.8-2.2 5.8-2.2s4.8-0.0999 9.6 3.6c3.2 2.4 2.7 5.89 6.5 6.39 2 0.3 1.8-2.3 1.8-2.3s4.1 1.3 6.5 5.49c1.5 2.7 2 5.29 2 7.59z","m100 65s-2.7 1.4-5.6 2.2c-1.2 2.5-2.1 5.1-2.8 7.9-0.4 1.8-2.6 3-5.4 3.1v2.5c0 2.9-1.4 5.6-3.9 7.6-5.4 4.4-16.8 11.7-32.3 11.7s-26.9-7.3-32.3-11.7c-2.4-2-3.9-4.7-3.9-7.6v-2.5c-2.8-0.1-5-1.3-5.4-3.1-0.7-2.8-1.6-5.4-2.8-7.9-2.9-0.9-5.6-2.2-5.6-2.2l4.3-5-3.2-9.2s2.6 1 5.5 1.8c1.7 0.5 4.9 1.1 7.3 1.5v-15.4c0-1 0.1-2 0.3-3 0.7-3.9 3.3-6.5 3.3-6.5s0 3.3 1.9 2.5c2.3-0.9 1.6-4.8 3.7-8.1 4.7-7.5 12.7-10.3 12.7-10.3s-3.2 6.7 1.8 5.8c3.2-0.6 2.9-6.9 8.3-12 8.1-7.8 17.6-7.1 17.6-7.1s-7.2 5.3-8 11.6c-0.4 3.7 1.6 7.9 5.6 8.5 5.6 0.9 4.5-2.2 4.5-2.2s3.7-0.1 7.5 3.6c2.5 2.4 2.1 5.9 5.1 6.4 1.5 0.3 1.4-2.3 1.4-2.3s3.2 1.3 5.1 5.5c1.2 2.7 1.6 5.3 1.5 7.6v15.4c2.4-0.4 5.6-1 7.3-1.5 2.8-0.9 5.5-1.8 5.5-1.8l-3.3 9.2z","m67.5-0.0611c-2.04-0.0186-4 0.25-5.85 0.688-7.3 1.73-18 6.14-22.2 8.41-8.72 4.7-22.6 1.06-32.2 0.194l2.92 23.1c-0.447 0.377-0.915 0.682-1.35 1.1-4.44 4.28-7.79 10.5-8.4 18.1-0.372 4.67 0.385 9.17 1.97 13.2 1.58 3.99 3.91 7.31 6.65 9.9 2.54 2.39 5.32 4.01 8.19 5.11-0.976 0.748-2.05 1.3-2.99 2.11l10.7 17.4c8.64-7.49 20-11.1 30.6-9.7 5.12 0.661 11.7 3.06 20 2.57 4.16-0.25 8.67-1.34 12.9-4.21 4.37-2.93 8.22-7.55 10.1-14 1.34-4.53 1.46-9.24 0.594-13.7-0.859-4.41-1.65-8.96-4.02-12.2-4.14-5.63-6.67-8.38-12.2-9.55 1.09-1.79 3.6-3.7 4.32-5.88 1.11-3.4 1.64-7.11 1.37-11-0.268-3.87-1.32-7.67-3.26-11.1-2.93-5.11-7.17-8.16-11.6-9.6-2.15-0.706-4.26-1.01-6.3-1.03z","m51.7 3.39s-7.76 0.243-9.75 0.416c-1.86 0.162-4.01 0.213-6.44 0.266-7.55 0.164-15.1 0.372-22.6 0.623-6.68 0.222-11.9 5.82-11.7 12.5 0.325 3.66 2.3 6.98 5.36 9.01-1 0.664-2 1.45-2.91 2.55-1.2 1.44-2.19 3.2-2.73 5.38-0.542 2.21-0.561 4.6 0.238 7.11 0.814 2.56 2.34 4.86 4.81 6.62 1.65 1.18 3.17 1.73 4.57 2.05-1.09 1.09-2.92 2.93-4.24 6.62-0.764 2.13-1.22 4.7-0.748 7.67 0.488 3.08 1.88 6.16 4.76 8.69 0.904 0.794 1.76 1.38 2.55 1.84-5.83 3.14-8.06 10.4-4.99 16.3 3.11 5.91 8.02 7.85 15.7 6.6 4.5-0.588 8.83-1.4 13.3-2.01 7.35 0.434 14-0.585 18.2-0.808 5.45-0.243 8.88-1.26 10.5-1.35 1.49-0.0776 4.49 0.386 9.04 0.439 2.28 0.027 5.83-1.53 8.46-2.8 2.77-1.35 6.19-2.06 9.15-4.48 1.96-1.6 3.81-3.67 5.18-6.37 1.02-2 2.24-5.05 1.69-9.26-0.205-1.55-0.793-3.16-1.62-4.75 0.928-2.51 1.45-5.39 0.799-8.69-0.553-2.81-2-5.19-3.88-7.28 0.927-1.06 1.81-2.26 2.51-3.82 0.998-2.25 1.55-4.87 1.18-7.85-0.348-2.77-1.46-5.95-4.54-8.68-0.251-0.222-0.499-0.356-0.75-0.551 0.483-0.438 0.981-0.809 1.44-1.34 1.69-1.96 2.98-4.4 3.47-7.37 0.502-3.03 0.128-6.19-1.51-9.26-1.96-3.66-4.77-5.52-7.19-6.6-2.29-1.02-4-1.25-4.9-1.39-8.02-1.28-14 0.0821-17.6-0.483zm-28.5 49.5c-0.38-0.0969-0.159-0.137 0.438 0.102-0.2-0.0513-0.231-0.0488-0.438-0.102z","m84.8 0.869c-5.02 0.251-10.1-0.442-15 0.896-5.22 0.146-10.4 1.2-15.6 1.48-4.05 0.815-8.31 0.0499-12.3 1.33 1.43-0.679-4.41 0.385-6.32 0.408-6.76 0.17-13.5 0.457-20.3 0.322-3.41 0.185-6.94-0.433-10.3 0.444-5.37 1.74-3.41 9.51 0.453 10.4-5.31 1.74-4.09 10.6 1.42 11-4.21 2.27-3.18 9.11 1.41 10.2-2.18 2.33-3.93 5.84-1.44 8.69 4.6 2.01-2.5 3.66-0.256 7.42 1.9 5.4 8.45 2.04 12.6 2.94 3.14 0.0137 3.8 1.32 0.371 1.76-4.1 1.73-8.77 3.41-11.6 6.95-3.14 4.08 3.82 6.8 0.532 9.93-0.47 2.53 1.56 4.79-2.37 4.05-5.74-0.1-7.69 8.76-2.68 11.3 4 1.75 7.9 2.31 10.3 6.04 3.21 1.25 6.69 0.132 10-0.203 6.22-1.23 12.5 0.58 18.8 0.443 11.7 0.511 23.5-0.0068 35-2.2 4.33-1.02 8.72-1.8 12.9-3.21 3.99-1.56 7.68-5.21 6.84-9.71-0.012-4.4-5.85-6.18-7.77-5.45-2.68 0.632-4.09-1.24-5.94-2.5 4.27-2.03 9.39-3.35 12.3-7.29 2.62-4.3-2.09-9.97-6.78-8.22-1.1 0.327-2.97 1.72-0.838 0.416-4.37 3.51-4.82-4.46-9.72-3.11 1.87-1.46 8.91-4.78 2.99-2.35-4.86 1.67 4.88-1.29 6.79-2.34 1.62-0.784-3.68-5.75 1.25-4.09 2.81 2.24 2.16-1.46 2.43-2.63 3.38-2.45 0.6-6.82-0.0624-8.94 2.44-1.51 1.21-4.08 1.14-6.33-0.477-4.67-5.18 4.82-4.53 1.09-0.0838-2.09 5.2-3.33 3.62-7.9-3.1-3.56 3.49-7.52-0.873-11.2-2.29-1.88 1.11-7.41-3.46-9.04-0.97-0.535-2.1-0.82-3.21-0.768zm5.24 9.12c0.0118-0.00178 0.0507 0.0433 0 0zm-1.22 40.2c-0.331 0.34-1.93 0.69 0 0zm-74.3 46.1c2.4 0.856 1.33 0.876 0 0z","m72.8 1.64c-5.3 0.108-12.7 0.345-15.7 0.501-14.9 0.773-29.5-0.736-41.1 0.0102-11.6 0.747-14.5 7.19-15.7 16.7-1.21 9.55 3.18 15.6 10.6 17.4 4.59 1.1 9.22 1.9 13.9 2.42l-5.24 1.78 0.604-0.188c-5.22 1.45-9.7 5.05-13 10.4-3.27 5.36-4.9 11.8-4.7 18.5 0.226 7.85 2.83 14.9 7.43 20.2 4.6 5.26 10.4 7.81 16.6 7.28l-2.05-0.0203c10.1 1.07 20.3 1.8 30.5 2.19 9.78 0.375 19.6 0.436 29.3 0.181 7.56-0.196 13.6-8.12 13.4-17.7-0.156-9.58-6.41-17.2-14-17-1.78 0.0465-3.57-0.0584-5.35-0.0339 4.95-3.39 9.51-7.67 13.4-12.9 1.75-2.31 3.9-5.39 5.68-9.8 1.83-4.54 2.47-7.45 1.81-14.2-0.785-7.99-4.04-14.1-8.21-18.4-4.04-4.15-8.5-6.1-12.6-6.88-2.02-0.384-3.91-0.515-5.68-0.479z","m16.4 0.00257a6.4 6.35 0 0 0-6.58 6.17 6.4 6.35 0 0 0 6.22 6.52c5.1 0.143 10.4 0.305 19.4 0.795-7.6 1.3-13.5 2.56-16.8 3.57-1.11 0.343-1.97 0.534-3.44 1.35-0.732 0.409-2.08 0.675-3.22 3.57-0.572 1.45-0.529 3.74 0.203 5.25 0.732 1.5 1.67 2.21 2.34 2.66 2.65 1.78 3.38 1.38 4.93 1.62 1.55 0.239 3.45 0.44 5.97 0.653 5.03 0.425 13.4 0.791 21.2 1.22-1.71 0.318-3.67 0.688-5.16 0.972-6.36 1.22-10.4 2.08-13 2.75-1.32 0.339-2.29 0.613-3.24 0.98-0.478 0.184-0.951 0.371-1.62 0.779-0.67 0.408-1.85 0.867-2.82 3.27-0.483 1.2-0.629 3.1-0.0735 4.61 0.555 1.51 1.5 2.43 2.19 2.95 1.38 1.05 2.09 1.1 2.64 1.24 1.12 0.276 1.72 0.286 2.43 0.327 1.42 0.0823 2.96 0.0728 4.6 0.0728h6.99c-0.382 0.111-1.17 0.293-1.52 0.398-2.22 0.668-3.57 1.05-5.24 1.91-0.416 0.216-0.872 0.454-1.53 0.996s-1.85 1.42-2.33 3.86c-0.481 2.44 1.16 5.38 2.35 6.33 1.19 0.95 1.93 1.11 2.49 1.27 1.8 0.528 2.79 0.52 3.96 0.52-9.64 2.52-18.7 4.99-24.4 6.58-4.53 1.27-6.68 1.76-8.81 2.63-0.533 0.217-1.05 0.279-2.32 1.38-0.633 0.55-1.72 1.54-2.14 3.66-0.421 2.12 0.675 4.63 1.64 5.66 1.94 2.05 2.69 1.77 3.26 1.93 0.571 0.166 0.958 0.239 1.35 0.315 2.75 0.527 8.63 1.11 18.6 1.55 0.0405 0.681 0.0582 1.39 0.286 1.93 0.643 1.54 1.51 2.25 2.09 2.68 1.15 0.866 1.66 0.932 2.09 1.07 0.866 0.281 1.35 0.344 1.98 0.443 1.26 0.198 2.85 0.364 5.17 0.559 9.29 0.78 29.8 1.87 50.5 2.98a6.4 6.35 0 0 0 6.74-6 6.4 6.35 0 0 0-0.584-2.82c0.36-0.184 0.751-0.398 1.46-1.05 0.861-0.794 2.37-3 1.98-5.6-0.391-2.6-1.95-3.79-2.71-4.31-1.53-1.04-1.88-0.893-2.23-0.974-1.39-0.324-1.36-0.204-1.75-0.234-1.58-0.123-4.34-0.277-15.8-0.425-7.69-0.0991-19.2-0.304-30-0.49 4.65-1.2 9.29-2.44 13.8-3.48 14.9-3.42 27.2-5.34 32.7-6.73 0.686-0.174 1.27-0.33 1.99-0.604 0.359-0.137 0.748-0.289 1.34-0.644 0.594-0.355 1.63-0.725 2.65-2.88 0.51-1.08 0.801-2.79 0.429-4.28s-1.21-2.55-1.86-3.16c-1.31-1.22-2.06-1.34-2.6-1.52-1.09-0.355-1.61-0.376-2.24-0.445-2.51-0.274-5.82-0.28-10.7-0.317-0.0931-7.01e-4 -0.236 6.87e-4 -0.33 0 0.21-0.0548 0.585-0.154 0.786-0.207 2.45-0.643 4.24-1.13 5.58-1.53 1.34-0.399 1.87-0.413 3.5-1.32 0.406-0.228 0.94-0.439 1.86-1.51 0.461-0.534 1.08-1.36 1.4-2.74 0.322-1.38 0.0653-3.29-0.639-4.55-1.41-2.52-2.88-2.73-3.58-2.98-0.702-0.245-1.08-0.29-1.39-0.337-0.341-0.0498-0.404-0.0151-0.649-0.0354 0.542-0.114 1.67-0.301 2.16-0.407 2.52-0.551 4.28-0.988 5.73-1.46 0.723-0.234 1.35-0.442 2.2-0.901 0.428-0.23 0.93-0.504 1.62-1.15 0.688-0.641 1.8-1.83 2.07-4.01 0.272-2.17-0.911-4.44-1.88-5.41-0.967-0.962-1.68-1.25-2.21-1.47-1.06-0.452-1.62-0.519-2.18-0.618-1.13-0.199-2.12-0.274-3.15-0.356-4.16-0.33-9.38-0.547-22-1.15-0.0481-0.0023-0.113-0.0076-0.161-0.0099 5.35-0.609 12-1.36 15.3-1.84 2.08-0.301 3.56-0.556 4.86-0.886 0.649-0.165 1.24-0.319 2.08-0.709 0.845-0.39 2.78-0.677 3.81-4.31 0.517-1.82-0.0388-4.13-0.822-5.32-0.783-1.19-1.52-1.67-2.05-2-1.06-0.672-1.6-0.794-2.11-0.955-1.03-0.32-1.82-0.464-2.64-0.626-3.3-0.65-7.81-1.36-17.1-2.16-9.24-0.804-23.3-1.72-33-2.26-9.71-0.537-15.1-0.687-20.3-0.834zm-7.83 76.3c0.0849 0.0247 0.264-0.0317 0.59 0.0807-0.0708-0.0128-0.349-0.0373-0.411-0.0492-0.23-0.0442-0.359-0.0841-0.179-0.0315z","m15 0.00104a6.81 8.11 0 0 0-6.91 7.98 6.81 8.11 0 0 0 6.7 8.23c3.08 0.0583 5.73 0.128 8.76 0.187-0.375 0.129-0.886 0.258-1.24 0.388-1.88 0.696-3.23 0.987-5.39 2.9-1.08 0.959-3.37 3.18-3.15 7.71 0.219 4.53 2.88 6.58 4.13 7.37 1.6 1.01 2.86 1.36 4.15 1.61-0.141 1.66-0.0734 3.37 0.453 4.62 0.889 2.1 1.89 2.8 2.5 3.26 2.45 1.82 2.42 1.15 2.89 1.24 0.473 0.0921 0.87 0.142 1.34 0.195 0.936 0.107 2.11 0.203 3.72 0.313 2.47 0.169 7.02 0.368 10.8 0.57-2.7 0.642-5.02 1.15-7.5 1.75-15.4 3.77-24.7 6.36-29.6 8.36-1.21 0.499-2.02 0.651-3.7 2.14-0.841 0.746-2.73 2.15-2.96 6.33-0.115 2.09 0.607 4.33 1.43 5.61 0.819 1.28 1.59 1.86 2.18 2.26 2.34 1.59 2.96 1.25 3.93 1.39 0.968 0.146 1.94 0.225 3 0.299 2.53 0.177 7.62 0.237 11.8 0.331-0.0236 0.0284-0.0312 0.0225-0.0552 0.0518-0.776 0.949-1.88 2.87-1.96 5.46-0.0726 2.58 1.01 4.78 1.82 5.83 1.63 2.11 2.4 2.06 2.96 2.29 1.71 0.718 2.52 0.777 3.49 0.855a6.81 8.11 0 0 0-0.821 2.9 6.81 8.11 0 0 0 7.25 7.55c18.1-1.45 36.3-2.91 45.2-3.65 4.47-0.373 6.19-0.461 7.94-0.787 0.219-0.0407 0.446-0.0803 0.851-0.203 0.405-0.123 0.782 0.275 2.74-1.63 0.977-0.954 2.88-3.94 2.43-7.51-0.29-2.28-1.06-3.49-1.81-4.35 0.426-0.121 0.962 0.242 2.9-2.09 0.996-1.2 2.44-4.65 1.76-7.77-0.68-3.12-2.16-4.22-2.9-4.79-0.201-0.156-0.252-0.147-0.415-0.259 2.91e-4 -0.0022 0.0086-0.0677 0.0086-0.0677-5.1e-5 -5.82e-4 -0.401-2.04-0.401-2.04-1.8e-4 -5.79e-4 -0.432-1.15-0.677-1.59-0.49-0.891-0.986-1.45-1.39-1.84-1.63-1.59-2.14-1.43-2.55-1.56-0.405-0.131-0.617-0.167-0.792-0.199-0.351-0.0646-0.527-0.078-0.699-0.0936-0.344-0.0313-0.615-0.0415-0.94-0.0538-0.65-0.0245-1.46-0.0395-2.47-0.0538-4.06-0.0573-11.4-0.0936-21.4-0.149-0.704-4e-3 -1.52-0.0138-2.25-0.0179 9.3-2.15 19.7-4.61 25.4-5.92 5.17-1.21 7.46-1.75 9.07-2.27 0.402-0.13 0.656-0.146 1.61-0.683 0.478-0.268 1.29 0.0431 2.94-3.09 0.824-1.56 1.39-5.17 0.431-7.69-0.962-2.52-2.28-3.35-3.01-3.82-2.93-1.86-2.63-0.956-2.99-0.986-0.361-0.0296-0.579-0.0305-0.776-0.0359-1.18-0.032-4.54-0.0306-8.24-0.0319 0.504-2.45 0.311-5.91-0.685-7.55-1.3-2.14-2.24-2.4-2.8-2.7-2.26-1.2-2.15-0.724-2.71-0.795-2.2-0.283-5.44-0.377-11.3-0.592-0.898-0.0328-2.36-0.103-3.36-0.139 0.966-0.213 2.26-0.514 3.15-0.707 9.85-2.16 14.1-3.04 16.6-3.52 0.638-0.119 1.2-0.218 1.71-0.317 0.511-0.0982 0.134 0.367 2.33-0.701 0.549-0.267 1.92 0.456 3.69-4.23 0.882-2.34 0.325-6.49-0.794-8.25-1.12-1.75-1.98-2.13-2.53-2.44-2.18-1.23-2.06-0.742-2.43-0.791-0.73-0.0972-1.25-0.114-2.08-0.153-3.34-0.158-10.7-0.339-17.8-0.562-7.12-0.223-14-0.485-22.4-0.709-8.4-0.224-18.3-0.411-28.1-0.598zm68.4 18.1c0.147 0.0109 0.537 0.038 0.477 0.0299-0.0416-0.0055-0.126 0.0615-0.477-0.0299zm-8.05 6.25c-0.0726 0.0123-0.115 0.0254-0.187 0.0359 0.092-0.0441 0.11-0.0186 0.187-0.0359zm16.6 26.6c0.0692 0.0015 0.482 2.94e-4 0.545 2e-3 0.155 0.0042 0.258 0.0128 0.15 4e-3 -0.0653-0.0053-0.187 0.129-0.696-6e-3z","m8.55 0c-3.58 0-6.49 3.34-6.49 7.47 0 4.12 2.9 7.47 6.49 7.47 6.65 0 11.1 0.0284 17.4 0.0331-3.94 1.03-8.41 2.2-10.6 2.79-0.819 0.227-1.51 0.402-2.44 0.766-0.465 0.182-0.882 0.156-2.23 1.3-0.672 0.573-2.07 1.59-2.59 4.7-0.519 3.1 1.3 6.39 2.4 7.38 0.545 0.494 0.751 0.517 1.11 0.755-0.851 0.793-1.7 2.04-1.92 4.9-0.182 2.34 0.842 4.76 1.76 5.9 0.918 1.14 1.65 1.54 2.21 1.84 0.944 0.509 1.56 0.69 2.17 0.838-1.84 0.486-3.3 0.907-4.29 1.22-0.573 0.181-1.06 0.264-2.19 0.815-0.564 0.276-1.61-0.521-3.49 3.62-0.943 2.07-0.548 6.47 0.701 8.25 1.25 1.79 2.16 2.06 2.75 2.33 2.35 1.09 2.65 0.734 3.96 0.84 1.3 0.106 2.99 0.184 5.33 0.249 0.967 0.0271 3.08 0.0164 4.25 0.0389-0.03 0.453 0.0463 0.927 0.098 1.4-2.79 0.294-7.31 0.716-8.76 0.912-0.7 0.0953-1.23 0.142-2.14 0.362-0.228 0.0549-0.477 0.109-0.958 0.298-0.481 0.188-1.27-0.522-3.31 2.84-1.02 1.68-1.39 5.87-0.314 8.03 0.158 0.316 0.293 0.383 0.448 0.63-0.508 0.0914-1.46 0.14-1.89 0.241-0.532 0.124-0.976 0.17-2.04 0.712-0.53 0.271-1.32 0.478-2.56 2.24-0.618 0.881-1.34 2.39-1.45 4.26s0.508 3.71 1.15 4.78c1.29 2.14 2.23 2.37 2.81 2.67 0.579 0.299 0.942 0.411 1.27 0.51 0.65 0.198 1.13 0.285 1.67 0.375 1.54 0.258 4.31 0.452 6.99 0.661 0.0178 0.111 0.098 0.609 0.098 0.609 1.18e-4 1.99e-4 1.89 2.09 1.89 2.09 2.8e-4 2.02e-4 0.772 0.486 1.02 0.601 0.245 0.114 0.421 0.179 0.566 0.229 0.29 0.101 0.458 0.142 0.591 0.173 1.07 0.25 0.834 0.133 0.97 0.144 1.08 0.0833 2.67 0.123 7.18 0.268 9.02 0.291 28.2 0.873 47.3 1.45 3.58 0.109 6.56-3.15 6.66-7.27-2e-3 -1.13-0.225-2.24-0.652-3.25 0.701-0.0264 2.38-0.0732 2.76-0.0953 0.271-0.0158 0.336 0.0035 0.939-0.0894 0.151-0.0232 0.305-0.0279 0.838-0.191 0.266-0.0814 0.597-0.129 1.45-0.665 0.214-0.134 0.77-0.57 0.77-0.57 3.18e-4 -2.72e-4 1.07-1.16 1.07-1.16 1.82e-4 -2.48e-4 0.923-1.85 1.08-2.17 1.29-0.0298 2.68-0.0594 3.47-0.0894 0.577-0.0219 1.03-0.0442 1.44-0.0739 0.41-0.0297 0.296 0.157 1.8-0.299 0.375-0.114 0.824 0.0351 2.36-1.34 0.384-0.343 0.855-0.825 1.34-1.62 0.242-0.398 0.484-0.879 0.686-1.44 0.202-0.566 0.437-1.91 0.438-1.91 8e-5 -7.61e-4 -0.0253-2.08-0.0253-2.08-1.04e-4 -7.63e-4 -0.259-1.29-0.459-1.82-0.4-1.06-0.901-1.77-1.32-2.26-1.67-1.96-2.22-1.73-2.63-1.88-0.408-0.156-0.616-0.203-0.792-0.245-0.704-0.168-0.9-0.164-1.25-0.204-0.693-0.0796-1.51-0.147-2.49-0.233-0.837-0.0735-2.51-0.187-3.65-0.28 0.199-0.404 0.481-1.07 0.481-1.07 2.07e-4 -5.98e-4 0.387-1.59 0.387-1.59 1.21e-4 -8.51e-4 -0.0995-1.5-0.167-2.52 0.137-0.0616 0.22-0.0839 0.427-0.202 0.205-0.117 0.453-0.269 0.782-0.527 0.329-0.258 1.25-1.29 1.26-1.29 4.23e-4 -5.67e-4 1.44-3.33 1.44-3.34 5.2e-5 -2.7e-4 0.0828-2.54 0.0828-2.54-2.6e-5 -2.64e-4 -0.616-2.32-0.617-2.32-2.17e-4 -5.13e-4 -1.79-2.54-1.79-2.54s-0.924-0.716-1.24-0.889c-1.26-0.692-1.52-0.587-1.79-0.636-1.09-0.198-0.941-0.0984-1.11-0.101-0.166-0.0027-0.293-2e-3 -0.414-2e-3 -0.963 0-2.41 0.0013-5.46-0.0525-0.439-0.0078-2.35-0.0252-2.88-0.035 0.639-0.112 3.1-0.579 3.52-0.648 0.421-0.0691 0.0365 0.255 1.99-0.453 0.244-0.0885 0.55-0.178 1.2-0.583 0.646-0.406 2.4-0.87 3.22-4.84 0.412-1.99-0.123-4.51-0.9-5.86-0.778-1.35-1.52-1.9-2.03-2.26-1.02-0.72-1.44-0.769-1.77-0.869-1.33-0.402-1.33-0.264-1.71-0.292-0.0603-0.0045-0.318-0.0055-0.382-0.0098 0.192-0.174 0.26-0.164 0.502-0.416 0.797-0.833 2.35-3 2.11-6.18-0.231-3.18-2-4.93-2.86-5.6-1.73-1.34-2.11-1.09-2.51-1.17-0.788-0.175-1.06-0.161-1.41-0.183-0.717-0.044-1.42-0.051-2.23-0.0603-1.68-0.0194-6.55-0.0346-9.66-0.0467 1.96-0.633 4.16-1.3 5.6-1.87 1.19-0.466 2.18-0.884 3.22-1.49 0.522-0.302 1.06-0.62 1.79-1.3 0.736-0.679 2.14-1.72 2.6-5.03 0.229-1.66-0.138-3.76-0.855-5.15-0.716-1.39-1.55-2.14-2.19-2.61-1.27-0.948-2-1.08-2.66-1.25-1.31-0.35-2.34-0.43-3.71-0.527-2.75-0.195-6.6-0.254-12.2-0.299-11.1-0.0915-29-0.0914-46.9-0.0914z","M 0,100 V 0 H 100 V 100 H 99 A 49,-98 0 0 0 50,2 49,-98 0 0 0 1,100 Z","M 0,0 V 100 H 100 V 0 H 99 A 49,98 0 0 1 50,98 49,98 0 0 1 1,0 Z","M 0,100 V 0 H 100 V 100 H 95 A 45,-90 0 0 0 50,10 45,-90 0 0 0 5,100 Z","m0 0v100h100v-100h-5a45 90 0 0 1-45 90 45 90 0 0 1-45-90z","M 0,100 V 0 H 100 V 100 H 90 A 40,-80 0 0 0 50,20 40,-80 0 0 0 10,100 Z","M 0,0 V 100 H 100 V 0 H 90 A 40,80 0 0 1 50,80 40,80 0 0 1 10,0 Z","m 0,0 v 100 h 10.035156 c 1.705045,-6.54927 3.941587,-12.742544 6.720703,-18.300782 l 20.09375,-40.1875 C 50.561077,14.088757 71.945169,12.702882 84.796875,38.40625 92.993332,54.799136 95.671807,78.132046 92.986328,100 H 100 V 0 Z","M 0,0 V 100 H 100 V 0 H 92.986328 C 91.461087,12.420096 88.21082,24.367414 83.244141,34.300782 L 63.150391,74.48828 C 49.438924,101.91124 28.054831,103.29712 15.203125,77.59375 4.9562739,57.10008 3.3279352,25.763198 10.035156,0 Z","M 100,0 C 98.542915,3.142831 97.022904,6.152491 95.425781,8.973086 L 62.601562,66.942421 C 40.203879,106.49781 13.008645,96.967171 1.625,45.571361 1.0225932,42.851581 0.48998452,40.055281 0,37.221491 V 100 h 100 z","M 0,0 V 10 C -1.5552177e-6,6.609576 0.10489712,3.277196 0.28515625,0 Z m 0,10 v 90 H 100 V 10 c 1e-5,44.31998 -15.860419,79.99998 -35.5625,80 H 35.5625 C 15.860418,90.00002 0,54.31999 0,10 Z m 100,0 V 0 H 99.714844 C 99.895106,3.277194 99.999998,6.609576 100,10 Z","M 0,0 V 99.999998 H 100 V 26.237487 A 61.723576,126.74566 7.430995 0 1 82.216797,52.190278 61.723576,126.74566 7.430995 0 1 1.3339844,8.692257 61.723576,126.74566 7.430995 0 1 0,0 Z"].forEach((e=>{const s=(0,o.T)("div",{className:"shape-setting-pod"});s.setAttribute("data",e),s.addEventListener("click",this.selectPreset,!0),s.appendChild(this.createPreview(e)),e===this.path&&(this.selected=s,this.selected.classList.add("active")),t.append(s)}));let e=t.querySelector(".active");e&&e.scrollIntoView({behavior:"auto",block:"center",inline:"nearest"})},this.createPreview=t=>{const e=i.VI(50,50),s=e.getContext("2d"),a=new Path2D;return a.addPath(new Path2D(t),(new DOMMatrix).scale(.48,.48)),s.translate(1,1),s.lineWidth=2,s.strokeStyle="rgba(255, 255, 255, .5)",s.fillStyle="rgba(0, 0, 0, 0.6)",s.fill(a),s.stroke(a),e},this.selectPreset=t=>{var e;null===(e=this.selected)||void 0===e||e.classList.remove("active"),this.selected=t.currentTarget,this.selected.classList.add("active"),this.path=this.selected.getAttribute("data"),this.preview&&this.preview(this.path),"express"===n.Ay.product&&this.cleanUp()},this.cleanUp=()=>{this.callback&&this.callback(this.path),this.container.remove(),this.modal.remove()},this.path=e,this.preview=h,this.callback=s,this.modal=document.body.appendChild((0,o.T)("div",{id:"shape-selector-modal",className:"modal"}));let l=(0,o.T)("div",{id:"shape-selector-presets"});this.container=(0,o.T)("div",{id:"shape-selector",className:"shape-float"},l),this.modal.appendChild(this.container),this.modal.addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault(),t.target===t.currentTarget&&this.cleanUp()}),!1);let c=t.getBoundingClientRect();if("express"===n.Ay.product)this.container.style.width="320px",this.container.style.top=c.bottom-15+"px",this.container.style.left="50px",this.container.offsetTop+this.container.offsetHeight>(0,o.Ay)("workspace").offsetHeight&&(this.container.style.top=(0,o.Ay)("workspace").offsetHeight-this.container.offsetHeight+"px");else{this.container.style.top=c.bottom-5+"px",this.container.style.left=c.left-~~(this.container.offsetWidth/2)+40+"px";const t=(0,o.T)("img",{src:"/img/icon/three-dot.svg",className:"resize ic"});(0,o.Bb)(t,this.resizeStart,this.resizeMove),this.container.append(t)}new r.A((0,o.Ay)("shape-selector-presets")),this.populatePresets()}}},82042:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(21742),a=s(54738),n=s(42268);const o={step:[.01],range:[0,1],stops:[0,1],compact:!1,force:!1,defaultValue:0,labelFormat:t=>String(t),labelParse:t=>parseInt(t,10)};class r{constructor(t,e={}){if(this.findElements=()=>{this.outlet=this.container.querySelector("input"),this.slider=this.container.querySelector(".slider"),this.diff=this.container.querySelector(".slider .diff"),this.label=this.container.querySelector(".info label"),this.hold=this.container.querySelector(".slider-holder"),this.bound=this.container.querySelector(".slider-holder .bound"),this.knob=this.container.querySelector(".slider-holder .bound .knob")},this.buildElements=()=>{this.container.classList.add("range-box"),this.label=document.createElement("label"),this.label.innerText=(this.options.label||this.name)+" ",this.outlet=document.createElement("input"),this.outlet.type="text",this.outlet.autocomplete="off",this.outlet.value=this.options.labelFormat(this.options.defaultValue);const t=document.createElement("div");t.className="info",t.appendChild(this.label),t.appendChild(this.outlet),this.knob=document.createElement("div"),this.knob.innerHTML="<div></div>",this.knob.className="knob",this.bound=(0,n.T)("div",{className:"bound"},this.knob),this.diff=(0,n.T)("div",{className:"diff"}),this.slider=(0,n.T)("div",{className:"slider"},this.diff),this.hold=(0,n.T)("div",{className:"slider-holder"},this.slider,this.bound),this.container.appendChild(t),this.container.appendChild(this.hold)},this.labelOver=()=>{this.value!==this.options.defaultValue&&(this.label.innerText=(0,i.A)("reset")+" ")},this.labelOut=()=>{this.label.innerText=(this.options.label||this.name)+" "},this.labelClick=()=>{if(this.value===this.options.defaultValue)return;const t=this.value;this.options.onStart&&this.options.onStart(this.value,this.name),this.reset(),this.options.onChange&&this.options.onChange(this.value,this.name),this.options.onEnd&&this.options.onEnd(this.value,t,this.name)},this.sliderMouseDown=t=>{t.preventDefault(),t.stopPropagation(),this.knobDown(t),this.move(t.clientX)},this.knobDown=t=>{document.addEventListener("mousemove",this.knobMouseMove,!1),document.addEventListener("touchmove",this.knobTouchMove,{passive:!1}),document.addEventListener("mouseup",this.knobUp,!0),document.addEventListener("touchend",this.knobUp,{passive:!1}),this.knob.classList.add("grabbed"),t.preventDefault(),t.stopPropagation(),this.downValue=this.value,this.options.onStart&&setTimeout((()=>this.options.onStart(this.downValue,this.name)),0)},this.move=t=>{const e=this.bound.getBoundingClientRect();if(t<=e.left)return void this.setAmount(0);if(t>=e.right)return void this.setAmount(1);const s=(t-e.left)/e.width;this.setAmount(s)},this.knobMouseMove=t=>{t.preventDefault(),t.stopPropagation(),this.move(t.clientX)},this.knobTouchMove=t=>{t.preventDefault(),t.stopPropagation(),this.move(t.touches[0].clientX)},this.knobUp=()=>{if(document.removeEventListener("mousemove",this.knobMouseMove,!1),document.removeEventListener("touchmove",this.knobTouchMove),document.removeEventListener("mouseup",this.knobUp,!0),document.removeEventListener("touchend",this.knobUp),this.knob.classList.remove("grabbed"),this.options.onEnd&&(this.options.force||this.downValue!==this.value)){const t=this.downValue;this.downValue=this.value,setTimeout((()=>this.options.onEnd(this.value,t,this.name)),0)}},this.outletKeyUp=t=>{const e=this.options.labelParse(this.outlet.value);if(isNaN(e))return;const s=this.options.range[0],i=this.options.range[this.options.range.length-1],a=Math.max(Math.min(e,i),s);this.value=a,this.hold.classList.toggle("changed",this.isChanged()),this.diff.style.backgroundImage=this.generateDiff(this.options.defaultValue,this.value);const n=this.calculateAmount(this.value);this.setKnob(100*n),this.options.onChange&&void 0!==t&&setTimeout((()=>this.options.onChange(this.value,this.name)),0)},this.outletFocus=t=>{if(this.options.onStart&&(this.downValue=this.value,this.options.onStart(this.value,this.name)),this.options.compact){this.hold.style.display="flex";const t=a.oR(this.container);this.hold.style.left=t.x+this.container.offsetWidth-this.hold.offsetWidth+10+"px",this.hold.style.top=t.y+34+"px"}},this.outletBlur=t=>{this.options.compact&&(this.hold.style.display="none");const e=this.options.labelParse(this.outlet.value);isNaN(e)||(this.outlet.value=this.options.labelFormat(this.value),this.options.onEnd&&(this.options.force||this.downValue!==this.value)&&void 0!==t&&this.options.onEnd(this.value,this.downValue,this.name))},this.calculateAmount=t=>{for(let e=1;e<this.options.range.length;e++){const s=this.options.range[e-1],i=this.options.range[e];if(t>=s&&t<=i){const a=this.options.stops[e-1];return a+(t-s)/(i-s)*(this.options.stops[e]-a)}}if(t==this.options.defaultValue)throw new Error("Cant recurse on default value with calculateAmount, this is a bug");return this.calculateAmount(this.options.defaultValue)},this.setKnob=t=>{const e=100*this.calculateAmount(this.options.defaultValue),s=this.generateDiff(e,t);requestAnimationFrame((()=>{this.knob.style.marginLeft=`${t}%`,this.diff.style.backgroundImage=s}))},this.roundToStep=(t,e,s,i)=>{const a=t%e;return 0===a||t===s||t===i?t:t-a},this.generateDiff=(t,e)=>{if(t===e)return"none";const s="var(--accent-color)";this.knob.clientWidth;return e>t?`linear-gradient(to right, transparent 0%, transparent ${t}%, ${s} ${t}%, ${s} calc(${e}%), transparent calc(${e}%), transparent 100%)`:`linear-gradient(to right, transparent 0%, transparent calc(${e}% ), ${s} calc(${e}%), ${s} ${t}%, transparent ${t}%, transparent 100%)`},this.setAmount=(t,e=!1)=>{const[s,i]=this.bucket(t),a=this.options.range[s],n=this.options.range[s+1],o=this.options.step[s];this.setKnob(100*t),this.value=this.roundToStep(i*(n-a)+a,o,a,n),this.hold.classList.toggle("changed",this.value!==this.options.defaultValue),this.outlet.value=this.options.labelFormat(this.value),this.options.onChange&&!e&&setTimeout((()=>this.options.onChange(this.value,this.name)),0)},this.bucket=t=>{for(let e=1;e<this.options.stops.length;e++){const s=this.options.stops[e-1],i=this.options.stops[e];if(t>=s&&t<=i)return[e-1,(t-s)/(i-s)]}throw new Error(`Could not assign ${t} to a bucket, this is a bug`)},this.setValue=(t,e=!1)=>{const s=this.value;void 0===t&&(t=this.options.defaultValue);const i=this.options.range[0],a=this.options.range[this.options.range.length-1];this.value=Math.max(Math.min(t,a),i),this.hold.classList.toggle("changed",this.isChanged()),this.outlet.value=this.options.labelFormat(this.value);const n=this.calculateAmount(this.value);this.setKnob(100*n),(this.options.onChange||this.options.onEnd)&&e&&setTimeout((()=>{this.options.onChange&&this.options.onChange(this.value,this.name),this.options.onEnd&&this.options.onEnd(this.value,s,this.name)}),0)},this.isChanged=()=>this.value!==this.options.defaultValue,this.getValue=()=>{var t;return null!==(t=this.value)&&void 0!==t?t:0},this.reset=()=>{this.value=this.options.defaultValue,this.setKnob(100*this.calculateAmount(this.value)),this.hold.classList.remove("changed"),this.outlet.value=this.options.labelFormat(this.value),this.label.innerText=(this.options.label||this.name)+" "},this.cleanUp=()=>{document.removeEventListener("mousemove",this.knobMouseMove,!1),document.removeEventListener("touchmove",this.knobTouchMove),document.removeEventListener("mouseup",this.knobUp,!0),document.removeEventListener("touchend",this.knobUp),this.knob.removeEventListener("mousedown",this.knobDown,!1),this.knob.removeEventListener("touchstart",this.knobDown),this.hold.removeEventListener("mousedown",this.sliderMouseDown,!1),this.outlet.removeEventListener("focus",this.outletFocus,!1),this.outlet.removeEventListener("keyup",this.outletKeyUp,!1),this.outlet.removeEventListener("blur",this.outletBlur,!1),this.options.compact||(this.label.removeEventListener("mouseover",this.labelOver,!1),this.label.removeEventListener("mouseleave",this.labelOut,!1),this.label.removeEventListener("click",this.labelClick,!1))},this.hide=()=>{this.container.style.display="none"},this.show=()=>{this.container.style.display="block"},this.disable=()=>{this.container.classList.add("disabled")},this.enable=()=>{this.container.classList.remove("disabled")},this.name=t,this.container=(0,n.Ay)(t),this.options=Object.assign(Object.assign({},o),e),this.value=this.options.defaultValue,Array.isArray(this.options.step)||(this.options=Object.assign(Object.assign({},this.options),{step:[this.options.step]})),this.options.stops.length<2)throw new Error("Slider need to have atleast two stops, default is [0,1]");if(this.options.range.length!=this.options.stops.length)throw new Error("Slider range option and slide stops option, needs to be the same length");if(this.options.step.length!=this.options.stops.length-1)throw new Error("Step array must be the same length as the number of ranges (slider options range - 1)");this.options.compact&&this.container.classList.add("compact");!!this.container.querySelector(".slider")?this.findElements():this.buildElements(),this.knob.addEventListener("mousedown",this.knobDown,!1),this.knob.addEventListener("touchstart",this.knobDown,{passive:!1}),this.hold.addEventListener("mousedown",this.sliderMouseDown,!1),this.outlet.addEventListener("focus",this.outletFocus,!1),this.outlet.addEventListener("keyup",this.outletKeyUp,!1),this.outlet.addEventListener("blur",this.outletBlur,!1),this.options.compact||(this.label.addEventListener("mouseover",this.labelOver,!1),this.label.addEventListener("mouseleave",this.labelOut,!1),this.label.addEventListener("click",this.labelClick,!1)),this.outlet.value!==this.options.labelFormat(this.options.defaultValue)?(this.outletKeyUp(void 0),this.outletBlur(void 0)):this.reset()}}},69424:(t,e,s)=>{s.d(e,{A:()=>o});var i=s(42268),a=s(41915),n=s(29755);class o{constructor(t){this.verticalDrag=t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let e=(t.clientY-this.downPoint.y)/this.spaceHeightRatio/this.stage.zoom;this.stage.setAnchor(this.downPos.add(new a.A(0,e))),this.stage.updateViewport()},this.verticalStop=t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),document.removeEventListener("pointermove",this.verticalDrag,!0),document.removeEventListener("pointerup",this.verticalStop,!0)},this.horizontalDrag=t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let e=(t.clientX-this.downPoint.x)/this.spaceWidthRatio/this.stage.zoom;this.stage.setAnchor(this.downPos.add(new a.A(e,0))),this.stage.updateViewport()},this.horizontalStop=t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),document.removeEventListener("pointermove",this.horizontalDrag,!0),document.removeEventListener("pointerup",this.horizontalStop,!0)},this.resize=()=>{this.verticalHolder.style.top=this.stage.raster.offsetTop+"px",this.verticalHolder.style.left=this.stage.raster.offsetLeft+this.stage.raster.offsetWidth-16+"px",this.verticalHolder.style.height=this.stage.raster.offsetHeight-16+"px",this.horizontalHolder.style.top=this.stage.raster.offsetTop+this.stage.raster.offsetHeight-16+"px",this.horizontalHolder.style.left=this.stage.raster.offsetLeft+"px",this.horizontalHolder.style.width=this.stage.raster.offsetWidth+"px",this.spaceHeight=this.stage.raster.offsetHeight-20,this.spaceWidth=this.stage.raster.offsetWidth-181,this.render()},this.render=()=>{if(!this.stage.fresco)return;const t=n.Ay.isHDPI?500:250;this.imageInfo.innerText=this.stage.fresco?this.stage.fresco.width+" x "+this.stage.fresco.height+" px @ "+Math.round(100*this.stage.zoom)+"%":"";let e=this.stage.fresco.width*this.stage.zoom,s=this.stage.fresco.height*this.stage.zoom;this.horizontalSlider.style.display=this.stage.raster.width<=e?"block":"none",this.verticalSlider.style.display=this.stage.raster.height<=s?"block":"none",this.spaceHeightRatio=this.spaceHeight/(s+2*t),this.spaceWidthRatio=this.spaceWidth/(e+2*t);const i=Math.round(this.spaceWidth*(this.stage.raster.width/(e+2*t))),a=Math.round(this.spaceHeight*(this.stage.raster.height/(s+2*t))),o=-1*(this.stage.offset.x-t)/(e+2*t),r=-1*(this.stage.offset.y-t)/(s+2*t),h=Math.round((this.spaceWidth-(i<30?30-i:0))*o),l=Math.round((this.spaceHeight-(a<30?30-a:0))*r);this.horizontalSlider.style.width=Math.max(i,30)+"px",this.horizontalSlider.style.left=162+h+"px",this.verticalSlider.style.height=Math.max(a,30)+"px",this.verticalSlider.style.top=2+l+"px"},this.stage=t,this.verticalSlider=(0,i.T)("div",{id:"vertical-scroll-slider"}),this.verticalHolder=(0,i.T)("div",{id:"vertical-scroll-holder"},this.verticalSlider),(0,i.Ay)("workspace").appendChild(this.verticalHolder),this.imageInfo=(0,i.T)("div",{id:"horizontal-image-info"}),this.horizontalSlider=(0,i.T)("div",{id:"horizontal-scroll-slider"}),this.horizontalHolder=(0,i.T)("div",{id:"horizontal-scroll-holder"},this.imageInfo,this.horizontalSlider),(0,i.Ay)("workspace").appendChild(this.horizontalHolder),document.addEventListener("viewport-update",this.render),this.verticalHolder.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const e=n.Ay.isHDPI?500:250;let s=(t.offsetY-2)/this.spaceHeightRatio/this.stage.zoom,i=this.stage.anchor.clone();i.y=s-e/this.stage.zoom,this.stage.setAnchor(i),this.stage.updateViewport()}),!1),this.verticalSlider.addEventListener("click",(t=>(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1)),!0),this.verticalSlider.addEventListener("pointerdown",(t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),this.stage.resetAnchor(),this.downPoint=new a.A(t.clientX,t.clientY),this.downPos=this.stage.anchor.clone(),document.addEventListener("pointermove",this.verticalDrag,!0),document.addEventListener("pointerup",this.verticalStop,!0)}),!0),this.horizontalHolder.addEventListener("click",(t=>{if(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),t.offsetX-160>this.spaceWidth)this.stage.setZoom("fit");else if(t.offsetX>160){const e=n.Ay.isHDPI?500:250;let s=(t.offsetX-160)/this.spaceWidthRatio/this.stage.zoom,i=this.stage.anchor.clone();i.x=s-e/this.stage.zoom,this.stage.setAnchor(i),this.stage.updateViewport()}}),!1),this.horizontalSlider.addEventListener("click",(t=>(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1)),!0),this.horizontalSlider.addEventListener("pointerdown",(t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),this.stage.resetAnchor(),this.downPoint=new a.A(t.clientX,t.clientY),this.downPos=this.stage.anchor.clone(),document.addEventListener("pointermove",this.horizontalDrag,!0),document.addEventListener("pointerup",this.horizontalStop,!0)}),!0)}}},79453:(t,e,s)=>{s.d(e,{N:()=>a});var i=s(42268);const a=function(){let t;const e=(0,i.Ay)("current_user");if(e&&"null"!==e.innerText)try{t=JSON.parse(e.innerText)}catch(a){console.error("Could not read user data json")}const s=new URL(location.href);return t&&"pixlr.com"!==s.hostname&&"true"===s.searchParams.get("premium")&&(t.subscription=!0,t.subscriptionAccess="premium"),t}()},54738:(t,e,s)=>{s.d(e,{$e:()=>A,Al:()=>d,B3:()=>L,D9:()=>J,H5:()=>D,HO:()=>f,Jn:()=>et,KP:()=>p,Nw:()=>x,ON:()=>S,Os:()=>H,Ov:()=>q,P1:()=>G,PG:()=>E,Q5:()=>ot,RZ:()=>u,SE:()=>R,Sg:()=>h,T6:()=>W,TL:()=>O,VI:()=>w,XP:()=>tt,YD:()=>c,aE:()=>y,bD:()=>m,bK:()=>z,bi:()=>l,eD:()=>Z,fu:()=>g,j4:()=>P,jh:()=>X,k8:()=>T,lz:()=>b,m$:()=>nt,oM:()=>_,oR:()=>st,oc:()=>N,p:()=>I,p3:()=>at,q5:()=>r,qE:()=>$,r$:()=>k,r0:()=>V,sg:()=>K,tN:()=>C,tm:()=>M,tn:()=>j,uk:()=>Q,wc:()=>it,y2:()=>F,yu:()=>v,yz:()=>B,z:()=>o,zR:()=>U});var i=s(21742),a=s(40963),n=s(41915);const o="rgba(255,255,255, 0.7)",r="rgb(255,255,255)",h="rgb(32,209,139)",l="rgb(0,163,218)",c="rgb(209,72,14)",d="rgb(255,0,255)",u="rgb(67,201,143)",p="rgb(75,75,75)",g="rgb(148,148,148)";function m(t,e){if(void 0===e)return;if(e instanceof t)return e;const s=Object.create(t.prototype);return Object.assign(s,e)}function v(t,e,s,i,a=!0){let n;return n=t/e>s/i?s/t:i/e,a&&n>1?1:n}function y(t,e,s,i){return t/e<s/i?s/t:i/e}function f(t,e,s,i,a,n){return n>=e&&n<e+i&&a>=t&&a<t+s}function w(t,e){t<0&&(t=1),e<0&&(e=1);let s=document.createElement("canvas");return s.width=t,s.height=e,s}function x(t,e){t<0&&(t=1),e<0&&(e=1);let s=document.createElement("canvas");return s.width=t,s.height=e,s}async function b(t){if(!t)return;const e=URL.createObjectURL(t),s=await A(e);return URL.revokeObjectURL(e),s}function A(t,e=!1){if(void 0!==t)return new Promise(((s,i)=>{if(!t)return console.log("Invalid URL in dataURLToCanvas"),void s(void 0);const a=e?w(100,100):x(100,100),n=a.getContext("2d"),o=new Image;o.onerror=t=>i(t),o.onload=()=>{a.width=o.width,a.height=o.height,n.drawImage(o,0,0),s(a)},o.src=t}))}function k(t,e){if(!t)return;const s=e||new a.A(0,0,t.width,t.height),i=x(s.width,s.height);return i.getContext("2d").drawImage(t,-s.x,-s.y),new Promise(((t,e)=>{i||t(void 0),i.toBlob((s=>{const i=new FileReader;i.onerror=t=>e(t),i.onload=()=>t(i.result),i.readAsDataURL(s)}),"image/jpeg",1)}))}function S(t,e){if(!t)return;const s=e||new a.A(0,0,t.width,t.height);return t.getContext("2d").getImageData(s.x,s.y,s.width,s.height)}function E(t,e){if(!t)return;const s=(null==e?void 0:e.rect)||new a.A(0,0,t.width,t.height),i=x(s.width,s.height);return i.getContext("2d").drawImage(t,-s.x,-s.y),new Promise(((t,s)=>i.toBlob(t,null==e?void 0:e.type,null==e?void 0:e.quality)))}function C(t,e,s){if(!t||!e)return;let i=t.getContext("2d");i.save(),i.globalCompositeOperation="copy",i.drawImage(e,s.x,s.y),i.restore(),i=void 0}function T(t,e,s=0,i=!1){let n=i?w(t.width,t.height):x(t.width,t.height),o=n.getContext("2d");if(o.drawImage(t,0,0,t.width,t.height),o=void 0,n.width>e||n.height>e){let s=a.A.bestFit(t.width,t.height,e,e);n=M(n,s.width,s.height)}return 0!==s&&(n=R(n,s)),n}function L(t,e,s){if(!t)return;let i=x(e,s);var a=t.getContext("2d").getImageData(0,0,t.width,t.height),n=new Int32Array(a.data.buffer),o=t.width,r=t.height,h=i.width,l=i.height;let c=i.getContext("2d");var d=c.getImageData(0,0,i.width,i.height),u=new Int32Array(d.data.buffer);const p=h/o,g=l/r;for(let m=0;m<l;){const t=o*~~(m/g),e=h*m++;for(let s=0;s<h;)u[e+s++]=n[t+~~(s/p)]}return c.putImageData(d,0,0),i}function M(t,e,s){if(!t)return;if(e>t.width||s>t.width)return D(t,e,s);if(e<4096&&s<4096&&(t.width>4096||t.height>4096)){let e=a.A.bestFit(t.width,t.height,4096,4096);t=D(t,e.width,e.height)}let i=x(e,s);var n=t.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,t.width,t.height).data,o=t.width,r=t.height,h=i.width,l=i.height;let c=i.getContext("2d");for(var d=c.getImageData(0,0,i.width,i.height),u=d.data,p=o/h,g=r/l,m=Math.ceil(p/2),v=Math.ceil(g/2),y=0;y<l;y++)for(var f=0;f<h;f++){for(var w=4*(f+y*h),b=0,A=0,k=0,S=0,E=0,C=0,T=(y+.5)*g,L=Math.floor(y*g);L<(y+1)*g;L++)for(var M=Math.abs(T-(L+.5))/v,P=(f+.5)*p,z=M*M,I=Math.floor(f*p);I<(f+1)*p;I++){var F=Math.abs(P-(I+.5))/m,_=Math.sqrt(z+F*F);_>=-1&&_<=1&&(b=2*_*_*_-3*_*_+1)>0&&(k+=b*n[F=4*(I+L*o)],S+=b*n[F+1],E+=b*n[F+2],C+=b*n[F+3],A+=b)}u[w]=k/A,u[w+1]=S/A,u[w+2]=E/A,u[w+3]=C/A}return c.putImageData(d,0,0),i}async function P(t,e,s,i){var a;if(!t)return;if(e>t.width||s>t.width)return D(t,e,s);let n=null!==(a=i)&&void 0!==a?a:x(e,s);var o=t.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,t.width,t.height).data,r=t.width,h=t.height,l=n.width,c=n.height;const d=n.getContext("2d");for(var u=d.getImageData(0,0,n.width,n.height),p=u.data,g=r/l,m=h/c,v=Math.ceil(g/2),y=Math.ceil(m/2),f=0;f<c;f++)for(var w=0;w<l;w++){for(var b=4*(w+f*l),A=0,k=0,S=0,E=0,C=0,T=0,L=(f+.5)*m,M=Math.floor(f*m);M<(f+1)*m;M++)for(var P=Math.abs(L-(M+.5))/y,z=(w+.5)*g,I=P*P,F=Math.floor(w*g);F<(w+1)*g;F++){var _=Math.abs(z-(F+.5))/v,R=Math.sqrt(I+_*_);R>=-1&&R<=1&&(A=2*R*R*R-3*R*R+1)>0&&(S+=A*o[_=4*(F+M*r)],E+=A*o[_+1],C+=A*o[_+2],T+=A*o[_+3],k+=A)}p[b]=S/k,p[b+1]=E/k,p[b+2]=C/k,p[b+3]=T/k}return d.putImageData(u,0,0),n}function D(t,e,s,i=!0,a){if(!t)return;e<1&&(e=1),s<1&&(s=1);let n=null!=a?a:x(e,s);var o=n.getContext("2d");return o.imageSmoothingQuality="high",o.imageSmoothingEnabled=i,o.drawImage(t,0,0,n.width,n.height),o=void 0,n}function z(t,e){let s=x(e.width,e.height),i=s.getContext("2d");return i.drawImage(t,-e.x,-e.y),i=void 0,s}function I(t,e,s){let i=x(s.width,s.height),a=i.getContext("2d");return a.imageSmoothingQuality="high",a.imageSmoothingEnabled=!0,a.drawImage(t,e.x-s.x,e.y-s.y,e.width,e.height),a=void 0,i}function F(t,e){if(t){var s=x(e.width,e.height),i=s.getContext("2d");return i.drawImage(t,-e.x,-e.y),i=void 0,s}}function _(t,e=!1){if(t){var s=e||t instanceof HTMLCanvasElement?w(t.width,t.height):x(t.width,t.height),i=s.getContext("2d");return i.drawImage(t,0,0),i=void 0,s}}function R(t,e){if(t){var s=x(t.width,t.height),i=s.getContext("2d");return 180!==e&&(s.width=t.height,s.height=t.width),i.translate(s.width/2,s.height/2),i.rotate(e*Math.PI/180),i.drawImage(t,-t.width/2,-t.height/2),i.setTransform(1,0,0,1,0,0),i=void 0,s}}function N(t,e,s){let i=x(s.width,s.height),a=i.getContext("2d");return a.save(),a.translate(s.width/2,s.height/2),a.rotate(e*Math.PI/180),a.drawImage(t,-t.width/2,-t.height/2),a.restore(),a=null,i}function B(t,e){if(t){var s=x(t.width,t.height),i=s.getContext("2d");return i.save(),e?(i.scale(1,-1),i.drawImage(t,0,-t.height,t.width,t.height)):(i.scale(-1,1),i.drawImage(t,-t.width,0,t.width,t.height)),i.restore(),i=void 0,s}}function O(t){if(!t)return;const e=t.width,s=t.height;return U(t.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,e,s))}function U(t){if(!t)return;const e=t.width,s=t.height;let i,n,o=new Uint32Array(t.data.buffer),r=-1,h=-1,l=-1,c=-1;for(n=0;n<s;++n){for(i=0;i<e;++i)if(o[i+n*e]>0){h=n;break}if(-1!==h)break}if(-1!==h){for(n=s-1;n>=h;--n){for(i=0;i<e;++i)if(o[i+n*e]>0){c=n+1;break}if(-1!==c)break}for(i=0;i<e;++i){for(n=h;n<=c;++n)if(o[i+n*e]>0){r=i;break}if(-1!==r)break}for(i=e-1;i>=r;--i){for(n=h;n<=c;++n)if(o[i+n*e]>0){l=i+1;break}if(-1!==l)break}return new a.A(r,h,l-r,c-h)}}function q(t){let e=t/1024;return e>1024?(e/1024).toFixed(1)+"mb":e>100?Math.round(e)+"kb":Math.round(10*e)/10+"kb"}function H(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function V(){return"xxxxyxxx4xxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function $(t,e,s){return isNaN(t)?e:Math.min(Math.max(t,e),s)}const X=(t,e,s)=>e*s+t*(1-s);function G(t){let e=!1,s=t.getContext("2d").getImageData(0,0,t.width,t.height).data;for(var i=0;i<s.length;i+=4)if(s[i+3]<255){e=!0;break}return e}function j(t){let e=new n.A(0,255);var s=Array(256);s.fill(0);var i=t.getContext("2d").getImageData(0,0,t.width,t.height).data;for(let n=0;n<i.length;n+=4)s[i[n]]+=1,s[i[n+1]]+=1,s[i[n+2]]+=1;var a=Math.round(t.width*t.height/1e3);let o;for(o=0;o<256;++o)if(s[o]>a){e.x=o;break}for(o=255;o>=0;--o)if(s[o]>a){e.y=o;break}return e.x>100&&(e.x=100),e.y<155&&(e.y=155),e}function W(t){let e=1,s=1,i=t.width<500&&t.height<500?t:D(t,500,500);const a=i.width,n=i.height;let o,r,h,l,c,d,u,p,g,m=i.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,a,n).data;for(c=n;c--;)for(l=a;l--;)d=4*(c*a+l),o=m[d],r=m[d+1],h=m[d+2],u=Math.min(o,r,h),p=Math.max(o,r,h),s+=p/255,g=p-u,g&&(e+=g/p);return e=(e+s)/(i.width*i.height*2),e}const Y={};function K(t,e,s){window.clearTimeout(Y[t]),Y[t]=window.setTimeout((()=>{delete Y[t],s()}),e)}const Z=(t,e)=>{let s;return(...i)=>{clearTimeout(s),s=window.setTimeout((()=>e(...i)),t)}};function Q(t){return new Promise(((e,s)=>{setTimeout((()=>e()),t)}))}function J(){return new Promise(((t,e)=>{window.requestAnimationFrame((()=>{window.requestAnimationFrame((()=>{t()}))}))}))}function tt(t){const e=((new Date).getTime()-t.getTime())/1e3;if(e<0)return"It's the future man";const s=Math.floor(e/86400);if(s>=1)return s>1?(0,i.A)("sinceDays",s):(0,i.A)("sinceDay");const a=Math.floor(e/3600);if(a>=1)return a>1?(0,i.A)("sinceHours",a):(0,i.A)("sinceHour");const n=Math.floor(e/60);return n>=1?n>1?(0,i.A)("sinceMinutes",n):(0,i.A)("sinceMinute"):(0,i.A)("sinceNow")}function et(t){if(!t)return!1;if("TEXTAREA"===t.nodeName)return!0;if("INPUT"===t.nodeName){const e=t,s=e.type.toLowerCase();return"text"===s||"number"===s||"url"===s||!!e.contentEditable}return!1}function st(t){let e=new n.A(t.offsetLeft,t.offsetTop);for(;t.offsetParent&&(e.x=e.x+t.offsetParent.offsetLeft,e.y=e.y+t.offsetParent.offsetTop,t!=document.getElementsByTagName("body")[0]);)t=t.offsetParent;return e}class it{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}}Symbol.toStringTag;class at extends Error{constructor(){super("Promise canceled")}}class nt extends it{constructor(t,e){super(),this.canceled=!1,this.isCanceled=()=>this.canceled,this.cancel=()=>{this.canceled||(this.canceled=!0,this.cancelCallback(),this.reject(new at))},this.cancelCallback=e,(async()=>{try{this.resolve(await t())}catch(e){this.reject(e)}})()}}const ot=t=>{const e=t.lastIndexOf("("),s=t.lastIndexOf(")"),i=()=>{const e=t.lastIndexOf(".");return`${t.slice(0,e)} (1)${t.slice(e)}`};if(!e||!s)return i();const a=parseInt(t.slice(e+1,s));return a?t.slice(0,e+1)+(a+1)+t.slice(s):i()}},56479:(t,e,s)=>{s.d(e,{Ug:()=>n,d8:()=>a});class i{constructor(t){this.internal=t}send(t,e){this.internal.postMessage(t,e)}async receive(){return await new Promise(((t,e)=>{this.internal.onmessage=e=>{this.internal.onerror=void 0,this.internal.onmessage=void 0,t(e.data)},this.internal.onerror=e}))}terminate(){var t;null===(t=this.internal)||void 0===t||t.terminate(),this.internal=null}}class a extends i{constructor(){super(new Worker(new URL(s.p+s.u(1161),s.b)))}}class n extends i{constructor(){super(new Worker(new URL(s.p+s.u(2904),s.b)))}}},60492:(t,e,s)=>{s.d(e,{A:()=>m});var i=s(21742),a=s(42268),n=s(53900),o=s(54738),r=s(22866),h=s(81937),l=s(26806),c=s(10122),d=s(3514),u=s(79453),p=s(6395);async function g(t){const e=await fetch(`https://pixlr.com/api/assets/${t}/download/`),s=await e.json();if(!s.status)throw new Error(s.message);return s.data.url}class m extends l.A{constructor(t){super((0,i.A)("titleAddElement"),!1,!0),this.cache=new Map,this.SERVER_URL="https://pixlr.com/api/assets/collections/keyword/",this.layerSelect=()=>{let t=!0;if(this.stage.fresco.isSelectedType(r.A.TYPE_ELEMENT)?(this.layer=this.stage.fresco.getSelected(),t=this.layer.settings.name!==this.selected,this.selected=this.layer.settings.name,(0,a.Ay)("add-element-list").classList.add("element-layer-selected")):(this.layer=null,this.selected="",(0,a.Ay)("add-element-list").classList.remove("element-layer-selected")),this.subcategory&&t){(0,a.Ay)("element-settings").style.display="none";const t=(0,a.Ay)("add-element-list").querySelectorAll(".element-box");for(let e=0;e<t.length;e++){const s=t[e];this.layer&&this.layer.settings.name===s.id?(s.classList.add("selected"),setTimeout((()=>{this.positionSettings(s,!0)}),200)):s.classList.remove("selected")}}},this.back=()=>{this.subcategory?this.fetchCategory():this.showCategoryList()},this.showCategoryList=()=>{(0,a.Ay)("add-element-back").style.display="none",(0,a.Ay)("add-element-category-list").style.display="block",(0,a.Ay)("add-element-category").style.display="none",(0,a.Ay)("element-settings").style.display="none"},this.selectCategory=t=>{(0,a.Ay)("add-element-category-list").style.display="none",(0,a.Ay)("add-element-category").style.display="block",(0,a.Ay)("add-element-loading").style.display="block",(0,a.Ay)("element-settings").style.display="none",(0,a.Ay)("add-element-back").style.display="flex",(0,a.Ay)("add-element-list").innerHTML="",this.category=t.currentTarget.getAttribute("data"),this.fetchCategory()},this.fetchCategory=async()=>{if((0,a.Ay)("add-element-list").innerHTML="",(0,a.Ay)("add-element-loading").style.display="block",(0,a.Ay)("element-settings").style.display="none",this.cache.has(this.category))this.renderCategory(this.category,this.cache.get(this.category));else try{const t=await fetch(this.SERVER_URL+this.category+"?platform=web"),e=await t.json();if(!e.status)throw new Error("server_error");let s=e.data;this.cache.set(this.category,s),this.renderCategory(this.category,s)}catch(t){console.log(t),(0,a.Ay)("add-element-loading").style.display="none",window.navigator.onLine?(0,a.Ay)("add-element-error").style.display="block":(0,a.Ay)("add-element-offline").style.display="block"}},this.renderCategory=(t,e)=>{(0,a.Ay)("add-element-loading").style.display="none";let s=(0,a.Ay)("add-element-list");this.subcategory="",e.forEach((e=>{let n=document.createElement("div");n.classList.add("element-group"),n.addEventListener("click",(()=>{this.renderSubCategory(this.category,e.name,e.assets)}),!1);let o=document.createElement("div");o.classList.add("wrap",t),n.appendChild(o);let r=document.createElement("img");if(e.assets.length>0&&(r.src=e.assets[0].thumbnailSmall,r.style.objectFit="cover",r.style.overflow="hidden"),o.appendChild(r),"premium"===e.type){let t=(0,a.T)("div",{className:"premium-tag"},(0,a.T)("img",{src:"/img/icon/premium.svg"}));t.setAttribute("tooltip",(0,i.A)("premium")),t.setAttribute("flow","up-right"),o.append(t)}let h=document.createElement("span");h.innerText=e.name.replace("_"," "),n.appendChild(h),s.appendChild(n)})),(0,a.Ay)("add-element-content").getElementsByClassName("ss-content")[0].scrollTo(0,0)},this.renderSubCategory=(t,e,s)=>{let n=(0,a.Ay)("add-element-list");n.innerHTML="",this.subcategory=e;let o=t==c.A.VARIANT_OVERLAY;s.forEach((e=>{let s=document.createElement("div");if(s.classList.add("element-box"),s.id=e.id,o){let a=document.createElement("a");a.classList.add("add","button","negative"),a.innerHTML="<img src='/img/icon/duplicate.svg'/> "+(0,i.A)("add"),a.addEventListener("click",(i=>{var a,n,o;"premium"!==e.type||"premium"===(null===u.N||void 0===u.N?void 0:u.N.subscriptionAccess)?this.addElement(s.id,!1,t,e.id,g(e.id),null===(a=null==e?void 0:e.metaData)||void 0===a?void 0:a.blendmode,null===(n=null==e?void 0:e.metaData)||void 0===n?void 0:n.opacity,null===(o=null==e?void 0:e.metaData)||void 0===o?void 0:o.scalemode):new d.A("element","premium")}),!1),s.appendChild(a)}s.addEventListener("click",(i=>{var a,n,r;"premium"!==e.type||"premium"===(null===u.N||void 0===u.N?void 0:u.N.subscriptionAccess)?this.addElement(s.id,o,t,e.id,g(e.id),null===(a=null==e?void 0:e.metaData)||void 0===a?void 0:a.blendmode,null===(n=null==e?void 0:e.metaData)||void 0===n?void 0:n.opacity,null===(r=null==e?void 0:e.metaData)||void 0===r?void 0:r.scalemode):new d.A("element","premium")}),!1);let r=document.createElement("div");r.classList.add("wrap",t),s.appendChild(r);let h=document.createElement("img");if(h.src=e.thumbnailSmall,r.appendChild(h),"premium"===e.type){let t=(0,a.T)("div",{className:"premium-tag"},(0,a.T)("img",{src:"/img/icon/premium.svg"}));t.setAttribute("tooltip",(0,i.A)("premium")),t.setAttribute("flow","right"),r.append(t)}let l=document.createElement("span");s.appendChild(l),this.layer&&this.layer.settings.name==s.id&&setTimeout((()=>{s.classList.add("selected"),this.positionSettings(s,!0)}),200),n.appendChild(s)})),(0,a.Ay)("add-element-content").getElementsByClassName("ss-content")[0].scrollTo(0,0)},this.select=t=>{(0,a.Ay)("element-settings").style.display="none";let e=(0,a.Ay)(t),s=(0,a.Ay)("add-element-list").getElementsByTagName("div");for(var i=0;i<s.length;i++)s[i].classList.remove("selected");e.classList.add("selected"),this.selected=e.id,setTimeout((()=>{this.positionSettings(e)}),200)},this.positionSettings=(t,e=!1)=>{(0,a.Ay)("element-opacity").value=(0,a.Ay)("element_opacity_out").innerHTML=this.layer?Math.round(100*this.layer.settings.opacity).toString():"100",e&&((0,a.Ay)("element-progress").style.display="none"),(0,a.Ay)("element-rotate-flip").style.display="overlay"===this.category||"border"===this.category?"block":"none";let s=(0,a.Ay)("element-settings");s.style.display="block",s.style.top=t.offsetTop+"px",s.style.left=t.offsetLeft+"px"},this.addElement=async(t,e,s,i,n,r="",h=1,l=c.A.SCALE_METHOD_NONE)=>{e=e&&this.layer&&this.layer.variant===s,this.select(t),this.canceled=!1,this.loading=!0;const d=(0,a.Ay)("element-progress");d.style.display="block",d.value=0;try{const t=await n,e=await(0,p.yP)(t,(t=>{this.canceled||(-1==t?d.removeAttribute("value"):d.value=t)}));if(d.style.display="none",this.canceled)return;const s=await(0,p.Ep)(e);if(this.canceled)return;this.loading=!1;let a=o.k8(s,4096);this.layer=this.stage.addElement(a,i,t,r,l)}catch(u){console.log("Error",u),d.style.display="none"}},this.delete=()=>{this.loading?(this.loading=!1,this.canceled=!0,this.layerSelect()):(this.layer=null,this.selected="",this.stage.deleteLayer())},this.opacityDown=t=>{this.layer&&(this.opacityStart=this.layer.settings.opacity)},this.opacityUp=t=>{this.layer&&this.stage.history.add({type:"layerSettings",kind:"opacity",layer:this.layer,settings:Object.assign(Object.assign({},this.layer.settings),{opacity:this.opacityStart})})},this.opacity=t=>{this.layer&&(this.layer.settings.opacity=Number((0,a.Ay)("element-opacity").value)/100,document.dispatchEvent(new CustomEvent("viewport-render")))},this.rotateOrFlip=t=>{let e=this.stage.fresco.getSelected();if(!e||!e.rect)return;switch(t.currentTarget.getAttribute("id")){case"element-flip-vertical":e.flip(!0);break;case"element-flip-horizontal":e.flip(!1);break;case"element-rotate-left":e.rotateAndFit(!0,new n.A(this.stage.fresco.width,this.stage.fresco.width));break;case"element-rotate-right":e.rotateAndFit(!1,new n.A(this.stage.fresco.width,this.stage.fresco.width))}document.dispatchEvent(new CustomEvent("viewport-render"))},this.cleanUp=()=>{(0,a.Ay)("add-element-list").innerHTML="",document.removeEventListener("layer-select",this.layerSelect,!1),(0,a.Ay)("element-rotate-left").removeEventListener("click",this.rotateOrFlip,!1),(0,a.Ay)("element-rotate-right").removeEventListener("click",this.rotateOrFlip,!1),(0,a.Ay)("element-flip-horizontal").removeEventListener("click",this.rotateOrFlip,!1),(0,a.Ay)("element-flip-vertical").removeEventListener("click",this.rotateOrFlip,!1),(0,a.Ay)("add-element-back").removeEventListener("click",this.back,!1),(0,a.Ay)("element-delete").removeEventListener("click",this.delete,!1);const t=(0,a.Ay)("element-opacity");t.removeEventListener("input",this.opacity,!1),t.removeEventListener("mousedown",this.opacityDown,!1),t.removeEventListener("mouseup",this.opacityUp,!1),t.removeEventListener("touchstart",this.opacityDown,!1),t.removeEventListener("touchend",this.opacityUp,!1);let e=(0,a.Ay)("add-element-category-list").getElementsByTagName("li");for(var s=0;s<e.length;s++)e[s].removeEventListener("click",this.selectCategory,!1);document.removeEventListener("keydown",this.keyDown,!1),this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.stage=t,this.dialog.style.width="500px",this.dialog.style.height="400px",this.dialog.style.maxWidth="500px",this.content.style.padding="0px 0px 0px 20px",this.content.id="add-element-content",document.addEventListener("layer-select",this.layerSelect,!1),this.setContent(`\n            <div id="element-settings">\n                <progress id="element-progress" value="0" max="100"></progress>\n                <img class="close" id="element-delete" src="/img/icon/close.svg" title="Delete">\n                <div class="range-white" id="element-settings-amount">\n                    <label>${(0,i.A)("transparency")}</label>\n                    <input type="range" value="100" min="0" max="100" step="1" id="element-opacity" name="element_opacity" oninput="element_opacity_out.value=this.value" />\n                    <output name="element_opacity_out" id="element_opacity_out" for="element_opacity">100</output>\n                </div>\n                <ul id="element-rotate-flip" class="small-icon-button-set">\n                    <li id="element-rotate-left"><img src="/img/icon/rotate-left.svg" alt="Rotate Left"></li>\n                    <li id="element-rotate-right"><img src="/img/icon/rotate-right.svg"  alt="Rotate Right"></li>\n                    <li id="element-flip-horizontal"><img src="/img/icon/flip-horizontal.svg"  alt="Flip Horizontal"></li>\n                    <li id="element-flip-vertical"><img src="/img/icon/flip-vertical.svg"  alt="Flip Vertical"></li>\n                </ul>\n            </div>\n\n            <ul id="add-element-category-list" class="section-list top-20">\n                <li data="overlay" id="add-element-overlay"><span>${(0,i.A)("overlay")}</span>\n                </li><li data="border" id="add-element-border"><span>${(0,i.A)("border")}</span>\n                </li><li data="shape" id="add-element-shape"><span>${(0,i.A)("shape")}</span>\n                </li><li data="sticker" id="add-element-sticker"><span>${(0,i.A)("sticker")}</span></li>\n            </ul>\n\n            <div id="add-element-category" style="display:none;" >\n                \n                <div id="add-element-loading" class="top-20" style="display:none;">${(0,i.A)("loading")} .. </div>\n                <div id="add-element-list" class="top-20">\n\n                </div>\n                <div id="add-element-error" class="top-20" style="display: none">\n                    <h3>${(0,i.A)("error")}</h3>\n                    <p>\n                        ${(0,i.A)("genericError")}\n                    </p>\n                </div>\n                <div id="add-element-offline" class="top-20" style="display: none">\n                    <h3>${(0,i.A)("offline")}</h3>\n                    <p>\n                        ${(0,i.A)("genericOffline")}\n                    </p>\n                </div>\n            </div>\n        `),(0,a.Ay)("dialog-buttons"+this.mid).insertBefore((0,a.T)("a",{className:"button negative",id:"add-element-back",style:"margin-right:auto"},(0,a.T)("img",{src:"/img/icon/back-small.svg",width:14,height:14}),(0,i.A)("back")),(0,a.Ay)("dialog-cancel"+this.mid)),(0,a.Ay)("dialog-apply"+this.mid).style.display="none",(0,a.Ay)("dialog-cancel"+this.mid).innerText=(0,i.A)("close"),(0,a.Ay)("add-element-back").addEventListener("click",this.back,!1),(0,a.Ay)("element-delete").addEventListener("click",this.delete,!1);const e=(0,a.Ay)("element-opacity");e.addEventListener("input",this.opacity,!1),e.addEventListener("mousedown",this.opacityDown,!1),e.addEventListener("mouseup",this.opacityUp,!1),e.addEventListener("touchstart",this.opacityDown,{passive:!0}),e.addEventListener("touchend",this.opacityUp,{passive:!0}),(0,a.Ay)("element-rotate-left").addEventListener("click",this.rotateOrFlip,!1),(0,a.Ay)("element-rotate-right").addEventListener("click",this.rotateOrFlip,!1),(0,a.Ay)("element-flip-horizontal").addEventListener("click",this.rotateOrFlip,!1),(0,a.Ay)("element-flip-vertical").addEventListener("click",this.rotateOrFlip,!1);let s=(0,a.Ay)("add-element-category-list").getElementsByTagName("li");for(var l=0;l<s.length;l++)s[l].addEventListener("click",this.selectCategory,!1);this.showCategoryList(),this.layerSelect(),new h.A(this.content)}}},78282:(t,e,s)=>{s.d(e,{A:()=>v});var i=s(21742),a=s(42268),n=s(78508),o=s(54738),r=s(40963),h=s(82042),l=s(79453),c=s(26806),d=s(50295),u=s(96703),p=s(39989),g=s(3514);const m=1024;class v extends c.A{constructor(t){super((0,i.A)("titleAiInfill"),!1),this.dirtyMask=!0,this.working=!1,this.renderCreditAmount=()=>{l.N?(0,a.Ay)("generative-fill-credit-count").innerHTML=l.N.credits.toString():((0,a.Ay)("generative-fill-execute").innerText=(0,i.A)("common-signUpLogIn"),(0,a.Ay)("generative-fill-credit-count").style.display="none")},this.cancel=()=>{this.cleanUp()},this.apply=()=>{const t=(0,a.Ay)("infill-newlayer").checked,e=o.tm(this.result,this.imageRect.width,this.imageRect.height);if(t){const t=new p.A(o.Os(),this.prompt.value.substring(0,25)+"..",e,this.maskRect.clone());this.stage.fresco.addLayer(t),this.stage.history.add({type:"addLayer",kind:"aiinfill",layer:t})}else{const t=this.selected;let s=o.ON(t.canvas,this.imageRect.rebase(t.rect.x,t.rect.y));const i=o.oM(this.selected.mask),a=t.rect.clone();t.extendCanvas(this.imageRect);t.canvas.getContext("2d").drawImage(e,0,0,this.imageRect.width,this.imageRect.height,this.imageRect.x,this.imageRect.y,this.imageRect.width,this.imageRect.height),this.stage.history.add({type:"bitmapChange",kind:"aiinfill",layer:this.selected,patchRect:this.imageRect.rebase(this.selected.rect.x,this.selected.rect.y),patch:s,rect:a,mask:i})}document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layerlist-update")),this.cleanUp()},this.execute=async()=>{if(l.N)if(l.N.credits)try{this.working=!0,this.updateButtonStatus(),(0,a.Ay)("infill-working").style.display="flex";const t=document.querySelector('input[name="generative-fill-model"]:checked').value,e=new FormData;e.set("version",t),e.set("prompt",this.prompt.value),e.set("image",await o.PG(this.baseImage)),e.set("mask",await o.PG(this.renderMask()));const s=await fetch("/api/openai/inpaint",{method:"post",body:e}),i=await s.json();if(0==i.status)return void console.log(i.message);const r=await o.$e(i.data),h=r.getContext("2d");h.globalCompositeOperation="destination-in",h.drawImage(this.baseImage,0,0),h.globalCompositeOperation="source-over",this.result=r,this.renderPreview(this.result),n.xs("generative-fill").then((()=>{this.renderCreditAmount()}))}finally{(0,a.Ay)("infill-working").style.display="none",(0,a.Ay)("generative-fill-execute").classList.remove("disabled"),this.working=!1,this.updateButtonStatus()}else l.N.subscription?new u.A("credits"):new g.A("generative-fill","credit");else new d.A},this.updateButtonStatus=()=>{this.working||!this.result?this.disableApply():this.enableApply(),this.working||0===this.prompt.value.length?(0,a.Ay)("generative-fill-execute").classList.add("disabled"):(0,a.Ay)("generative-fill-execute").classList.remove("disabled")},this.dialog.style.width="auto",this.dialog.style.maxWidth="unset",this.stage=t,this.selected=this.stage.fresco.getSelected(),this.bounds=this.stage.fresco.selection.bounds;const e=Math.max(this.bounds.width,this.bounds.height);this.maskRect=new r.A(0,0,e,e).pad(50),this.maskRect.setCenter(this.bounds.center()),this.imageRect=this.maskRect.rebase(this.selected.rect.x,this.selected.rect.y),this.baseImage=o.VI(m,m),this.mask=o.VI(m,m),this.baseImage.getContext("2d").drawImage(this.selected.canvas,this.imageRect.x,this.imageRect.y,this.imageRect.width,this.imageRect.height,0,0,this.baseImage.width,this.baseImage.height),this.preview=o.VI(m,m),this.preview.style.width="356px",this.preview.style.height="356px",this.previewContext=this.preview.getContext("2d"),this.prompt=(0,a.T)("textarea",{rows:3,placeholder:(0,i.A)("aiInfillPrompt"),style:{width:"100%"}}),this.setContent((0,a.T)("div",{style:"display:flex; gap: 10px"},(0,a.T)("div",{style:"width: 250px"},this.prompt,(0,a.T)("div",{id:"infill-influence",className:"range-box top-15"}),(0,a.T)("input",{type:"checkbox",id:"infill-newlayer",checked:!0}),(0,a.T)("label",{className:"top-10 switch",htmlFor:"infill-newlayer"},(0,i.A)("aiInfillNewLayer"),(0,a.T)("span")),(0,a.T)("label",{className:"top-15"},(0,i.A)("model")),(0,a.T)("div",{className:"switch-field stretch"},(0,a.T)("input",{type:"radio",id:"generative-fill-model-v1",name:"generative-fill-model",value:"v1",checked:!0}),(0,a.T)("label",{htmlFor:"generative-fill-model-v1"},"v1"),(0,a.T)("input",{type:"radio",id:"generative-fill-model-v3",name:"generative-fill-model",value:"v3"}),(0,a.T)("label",{htmlFor:"generative-fill-model-v3"},"v3")),(0,a.T)("div",{className:"top-35",style:"display:flex;flex-direction:column; padding-top: 35px"},(0,a.T)("a",{id:"generative-fill-execute",className:"button positive",onclick:()=>this.execute()},(0,i.A)("aiInfillGenerate")+" (1c)"))),(0,a.T)("div",(0,a.T)("div",{className:"dialog-loading",style:{border:"2px solid var(--component-highlight)",borderRadius:"4px",overflow:"hidden",position:"relative"}},this.preview,(0,a.T)("div",{id:"infill-working",className:"message",style:"background-color: #424549e3; display: none"},(0,a.T)("label",{className:"working"},(0,i.A)("working"))))))),(0,a.Ay)("dialog-buttons"+this.mid).prepend((0,a.T)("div",{id:"generative-fill-credit-count",className:"credit-meter",onclick:()=>{new u.A("credits")}})),this.influence=new h.A("infill-influence",{defaultValue:1,onChange:()=>{this.dirtyMask=!0},label:(0,i.A)("aiInfillInfluence"),labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,100)/100}),this.prompt.addEventListener("keyup",this.updateButtonStatus),this.updateButtonStatus(),this.renderPreview(this.baseImage),this.position(),this.renderCreditAmount()}renderMask(){if(!this.dirtyMask)return this.mask;const t=this.mask.getContext("2d");return t.clearRect(0,0,m,m),t.fillStyle="white",t.fillRect(0,0,m,m),t.globalAlpha=this.influence.getValue(),t.drawImage(this.stage.fresco.selection.mask,this.maskRect.x,this.maskRect.y,this.maskRect.width,this.maskRect.height,0,0,m,m),this.mask}renderPreview(t){this.previewContext.globalAlpha=1,this.previewContext.clearRect(0,0,m,m),this.previewContext.drawImage(this.stage.fresco.selection.mask,this.maskRect.x,this.maskRect.y,this.maskRect.width,this.maskRect.height,0,0,m,m),this.previewContext.globalCompositeOperation="xor",this.previewContext.fillRect(0,0,m,m),this.previewContext.globalAlpha=.3,this.previewContext.globalCompositeOperation="copy",this.previewContext.drawImage(this.preview,0,0),this.previewContext.globalAlpha=1,this.previewContext.globalCompositeOperation="destination-over",this.previewContext.drawImage(t,0,0)}}},55614:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titlealphaThreshold")),this.setContent((0,n.T)("div",{id:"alphaThreshold"})),new a.A("alphaThreshold",{label:(0,o.A)("threshold"),step:.01,defaultValue:.5,range:[0,1],labelFormat:t=>`${Math.round(255*t)}`,labelParse:t=>parseInt(t,10)/255,onChange:t=>this.change("alphaThreshold",t+1e-13)}),this.change("alphaThreshold",.5)}}},7623:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(2215);class a{constructor(t=0,e=0,s=0,i=0,a=0,n=0,o=0,r=0,h=0,l=!0){this.shadowRed=t,this.shadowGreen=e,this.shadowBlue=s,this.midtoneRed=i,this.midtoneGreen=a,this.midtoneBlue=n,this.highlightRed=o,this.highlightGreen=r,this.highlightBlue=h,this.preserve=l}}var n=s(82042),o=s(21742),r=s(42268);class h extends i.A{constructor(t){super(t,(0,o.A)("titleColorBalance")),this.colorset=new a,this.range="midtone",this.preserveChange=()=>{this.colorset.preserve=(0,r.Ay)("balance-preserve-luminosity").checked,this.change()},this.rangeChange=()=>{switch(this.range=document.querySelector('input[name="balance-range"]:checked').value,this.range){case"shadow":this.red.setValue(this.colorset.shadowRed),this.green.setValue(this.colorset.shadowGreen),this.blue.setValue(this.colorset.shadowBlue);break;case"midtone":this.red.setValue(this.colorset.midtoneRed),this.green.setValue(this.colorset.midtoneGreen),this.blue.setValue(this.colorset.midtoneBlue);break;case"highlight":this.red.setValue(this.colorset.highlightRed),this.green.setValue(this.colorset.highlightGreen),this.blue.setValue(this.colorset.highlightBlue)}},this.change=(t="",e=0)=>{switch(this.range){case"shadow":this.colorset.shadowRed=this.red.getValue(),this.colorset.shadowGreen=this.green.getValue(),this.colorset.shadowBlue=this.blue.getValue();break;case"midtone":this.colorset.midtoneRed=this.red.getValue(),this.colorset.midtoneGreen=this.green.getValue(),this.colorset.midtoneBlue=this.blue.getValue();break;case"highlight":this.colorset.highlightRed=this.red.getValue(),this.colorset.highlightGreen=this.green.getValue(),this.colorset.highlightBlue=this.blue.getValue()}this.shaders.addShader("balance",this.colorset),setTimeout((()=>{this.scratch.canvas=this.shaders.apply(this.cache),window.requestAnimationFrame((()=>this.stage.render()))}),0)},this.kind="balance",this.setContent(`\n                <label>Range</label>\n                <div class="switch-field stretch top-5">\n                    <input type="radio" id="balance-range-shadow" name="balance-range" value="shadow"/><label for="balance-range-shadow">${(0,o.A)("shadows")}</label>\n                    <input type="radio" id="balance-range-midtone" name="balance-range" value="midtone" checked/><label for="balance-range-midtone">${(0,o.A)("midtones")}</label>\n                    <input type="radio" id="balance-range-highlight" name="balance-range" value="highlight"/><label for="balance-range-highlight">${(0,o.A)("highlights")}</label>\n                </div>\n\n                <div id='balance-red' class='top-20'></div>\n                <div id='balance-green' class='top-5'></div>\n                <div id='balance-blue' class='top-5'></div>\n\n                <input type="checkbox" id="balance-preserve-luminosity" checked>\n                <label class="top-20 switch" for="balance-preserve-luminosity">${(0,o.A)("preserveLuminosity")}<span></span></label>\n                `),this.red=new n.A("balance-red",{label:(0,o.A)("red"),step:.01,range:[-1,1],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("balance",t)}),this.green=new n.A("balance-green",{label:"Green",step:.01,range:[-1,1],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("balance",t)}),this.blue=new n.A("balance-blue",{label:"Blue",step:.01,range:[-1,1],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("balance",t)}),(0,r.Ay)("balance-range-shadow").addEventListener("click",this.rangeChange,!1),(0,r.Ay)("balance-range-midtone").addEventListener("click",this.rangeChange,!1),(0,r.Ay)("balance-range-highlight").addEventListener("click",this.rangeChange,!1),(0,r.Ay)("balance-preserve-luminosity").addEventListener("change",this.preserveChange,!1)}}},18177:(t,e,s)=>{s.d(e,{A:()=>p});var i=s(21742),a=s(54738),n=s(42268),o=s(98244),r=s(82042),h=s(15818),l=s(23556),c=s(8689);class d{constructor(t,e,s,i){this.update=i,this.maxElevation=Math.PI/2,this.getAngle=()=>this.angle,this.getElevation=()=>this.elevation,this.setAngle=t=>{this.angle=t,this.angle<0&&(this.angle=2*Math.PI-Math.abs(this.angle)),this.render()},this.setElevation=t=>{this.elevation=t,this.render()},this.start=t=>{document.addEventListener("mousemove",this.move),document.addEventListener("mouseup",this.end),this.handle.classList.add("grabbed")},this.move=t=>{t.preventDefault(),t.stopPropagation();const e=this.outerCircle.getBoundingClientRect(),s=e.width/2-2,i=e.width/2+e.x,a=e.height/2+e.y,n=t.clientX-i,o=t.clientY-a,r=Math.sqrt(n*n+o*o);if(this.angle=Math.atan2(o,n),this.angle<0&&(this.angle=2*Math.PI-Math.abs(this.angle)),r>s)this.elevation=0,this.render();else{const t=r/s;this.elevation=(1-t)*this.maxElevation,this.render()}this.container.dataset.angle=this.angle.toFixed(5),this.container.dataset.elevation=this.elevation.toFixed(5),this.update&&this.update(this.angle,this.elevation)},this.end=t=>{document.removeEventListener("mousemove",this.move),document.removeEventListener("mouseup",this.end),this.handle.classList.remove("grabbed")},this.buildElements=()=>{this.outerCircle=(0,n.T)("div",{className:"outer-circle"}),this.handle=(0,n.T)("div",{className:"handle"},(0,n.T)("div")),this.container.append(this.outerCircle,this.handle)},this.rebindElements=()=>{this.outerCircle=this.container.querySelector(".outer-circle"),this.handle=this.container.querySelector(".handle")},this.render=()=>{const t=this.outerCircle.getBoundingClientRect(),e=this.handle.getBoundingClientRect(),s=(1-this.elevation/this.maxElevation)*(t.width/2-2),i=Math.round(s*Math.cos(this.angle)),a=Math.round(s*Math.sin(this.angle));window.requestAnimationFrame((()=>{this.handle.style.top=a+(t.height/2-e.height/2)+"px",this.handle.style.left=i+(t.width/2-e.width/2)+"px"}))},this.cleanUp=()=>{},this.container=(0,n.Ay)(t);!!this.container.querySelector(".outer-circle")?this.rebindElements():this.buildElements(),this.angle=parseFloat(this.container.dataset.angle)||e,this.angle<0&&(this.angle=2*Math.PI-Math.abs(this.angle)),this.elevation=parseFloat(this.container.dataset.elevation)||s,this.handle.addEventListener("mousedown",this.start),this.render()}}var u=s(2215);class p extends u.A{constructor(t){super(t,(0,i.A)("titleBevel")),this.load=async()=>{const t=Promise.resolve().then(s.bind(s,82355)),e=a.D9();await e;const{distanceTransformInv:i}=await t,r=this.shaders.ctx,h=this.cache.getContext("2d").getImageData(0,0,this.cache.width,this.cache.height),l=i(this.cache.width,this.cache.height,h.data);if(!r.getSupportedExtensions().includes("OES_texture_float"))return alert("sorry, this filter requires float textures"),void(0,o.A)("OES_texture_float");r.getExtension("OES_texture_float");const c=r.createTexture();r.bindTexture(r.TEXTURE_2D,c),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.cache.width,this.cache.height,0,r.ALPHA,r.FLOAT,l),r.bindTexture(r.TEXTURE_2D,null),(0,n.Ay)("bevel-loading").style.display="none",(0,n.Ay)("bevel-controls").style.visibility="visible",this.enableApply(),this.map=c,this.update()},this.update=()=>{const t={depth:this.depth.getValue(),size:this.size.getValue(),lightAngle:this.angle.getAngle(),lightElevation:this.angle.getElevation(),lowLightColor:this.lowLightColor.getColor(),highLightColor:this.highLightColor.getColor(),lowOpacity:this.lowOpacity.getValue(),highOpacity:this.highOpacity.getValue(),distanceMap:this.map};this.change("bevel",t.size?t:null)},this.disableApply(),this.kind="bevel",this.shaders=new l.A,this.setContent((0,n.T)("div",{className:"dialog-loading"},(0,n.T)("div",{id:"bevel-controls",className:"controls"},(0,n.T)("div",{className:"bevel-angle"},(0,n.T)("div",{className:"angle-box-holder"},(0,n.T)("div",{id:"bevel-angle",className:"angle-box top-10"})),(0,n.T)("div",{className:"angle-box-sliders"},(0,n.T)("div",{id:"bevel-angle-slider",className:"top-10"}),(0,n.T)("div",{id:"bevel-elevation-slider",className:"top-10"}))),(0,n.T)("div",{id:"bevel-size",className:"top-20"}),(0,n.T)("div",{id:"bevel-depth",className:"top-10"}),(0,n.T)("label",{className:"split top-10"},(0,i.A)("dialogBevelHighColor"),(0,n.T)("div",{id:"bevel-highlight-color"})),(0,n.T)("div",{id:"bevel-high-opacity",className:"top-15"}),(0,n.T)("label",{className:"split top-10"},(0,i.A)("dialogBevelShadowColor"),(0,n.T)("div",{id:"bevel-lowlight-color"})),(0,n.T)("div",{id:"bevel-low-opacity",className:"top-15"})),(0,n.T)("div",{id:"bevel-loading",className:"message"},(0,n.T)("label",{className:"working"},(0,i.A)("loading"))))),this.highLightColor=new c.A("bevel-highlight-color",h.A.fromHEX("#ffffff"),this.update,this.update),this.lowLightColor=new c.A("bevel-lowlight-color",h.A.fromHEX("#000000"),this.update,this.update),this.size=new r.A("bevel-size",{label:(0,i.A)("size"),range:[0,150],defaultValue:10,step:1,labelFormat:t=>`${t}px`,onChange:()=>this.update()});const e=-Math.PI/4;this.angle=new d("bevel-angle",e,0,((t,e)=>{let s=(t*(180/Math.PI)+90)%360;this.angleSlider.setValue(s),this.elevationSlider.setValue(e*(180/Math.PI)),this.update()})),this.angleSlider=new r.A("bevel-angle-slider",{label:(0,i.A)("angle"),range:[0,360],step:1,defaultValue:45,labelFormat:t=>t.toFixed(0)+"°",labelParse:t=>parseInt(t,10),onChange:t=>{this.angle.setAngle((t-90)*(Math.PI/180)),this.update()}}),this.elevationSlider=new r.A("bevel-elevation-slider",{label:(0,i.A)("elevation"),range:[0,90],defaultValue:180*this.angle.getElevation()/Math.PI,step:1,labelFormat:t=>t.toFixed(0)+"°",labelParse:t=>parseInt(t,10),onChange:t=>{this.angle.setElevation(t*(Math.PI/180)),this.update()}}),this.depth=new r.A("bevel-depth",{label:(0,i.A)("depth"),range:[.001,1],defaultValue:1,step:.001,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.highOpacity=new r.A("bevel-high-opacity",{label:(0,i.A)("dialogBevelHighOpacity"),range:[0,1],defaultValue:.9,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.lowOpacity=new r.A("bevel-low-opacity",{label:(0,i.A)("dialogBevelShadowOpacity"),range:[0,1],defaultValue:.75,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.position(),this.load()}}},95362:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleBloom")),this.setContent((0,n.T)("div",{id:"bloom-slider"})),new a.A("bloom-slider",{label:(0,o.A)("amount"),range:[0,1],step:.01,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("bloom",t)})}}},58e3:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleBlur")),this.setContent((0,n.T)("div",{id:"blur-slider"})),new a.A("blur-slider",{label:(0,o.A)("amount"),range:[0,1],step:.01,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("blur",t)})}}},89352:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleBrightnessContrast")),this.kind="brightnessContrast",this.setContent((0,n.T)("div",{id:"brightness"}),(0,n.T)("div",{id:"contrast",className:"top-16"})),new a.A("brightness",{label:(0,o.A)("brightness"),step:.01,range:[-1,1],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("brightness",t)}),new a.A("contrast",{label:(0,o.A)("contrast"),step:.01,range:[-1,1],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("contrast",t)})}}},99189:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(2215),a=s(82042),n=s(42268),o=s(21742),r=s(54738);class h extends i.A{constructor(t){super(t,(0,o.A)("titleClarity")),this.update=r.eD(50,(t=>{this.change("clarity",t)})),this.setContent((0,n.T)("div",{id:"clarity-slider"})),new a.A("clarity-slider",{label:(0,o.A)("amount"),step:.01,range:[-1,1],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.update(t)})}}},17096:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(58354),n=s(54738),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleColorLookup")),this.update=n.eD(50,(t=>{let e=this.mctx.createLinearGradient(0,0,255,0);t.addStopToCanvasGradient(e),this.mctx.fillStyle=e,this.mctx.fillRect(0,0,this.map.width,this.map.height),this.change("lookup",this.mctx.getImageData(0,0,255,1))})),this.content.style.paddingBottom="0px",this.dialog.style.width="340px",this.dialog.style.maxWidth="340px",this.map=n.Nw(255,1),this.mctx=this.map.getContext("2d"),this.editor=new a.A(this.content,void 0,this.update),this.position()}}},12895:(t,e,s)=>{s.d(e,{A:()=>d});var i=s(42268),a=s(21742),n=s(75281),o=s(2215),r=s(41915);class h{constructor(){this.points=[]}add(t){for(var e=0;e<this.points.length;e++)if(t.x==this.points[e].x&&t.y==this.points[e].y)return null;return this.points.push(t),this.sortPoints(),this.points.indexOf(t)}sortPoints(){this.points.sort((function(t,e){return t.x-e.x}))}remove(t){var e=null;return t>0&&t<this.points.length-1&&(e=this.points.splice(t,1)[0]),e}removeAll(){this.points=[]}getClosestFrom(t,e){if(!this.points.length)return null;for(var s=1/0,i=null,a=0;a<this.points.length;a++){var n=Math.sqrt(Math.pow(t.x-this.points[a].x,2)+Math.pow(t.y-this.points[a].y,2));n<s&&(s=n,i=a)}return{index:i,distance:s*e}}getPoint(t){return t>=0&&t<this.points.length?this.points[t]:null}getNumberOfPoints(){return this.points.length}getPoints(){return this.points}updatePoint(t,e){let s=t;if(t>=0&&t<this.points.length){this.points[t].x=e.x,this.points[t].y=e.y;var i=this.points[t];this.sortPoints(),s=this.points.indexOf(i)}return s}}var l=s(95009);class c{constructor(t,e,s,i,a){this.move=t=>{t.preventDefault(),t.stopPropagation();var e=this.canvas.getBoundingClientRect();this.mouseMoved=!0,this.mouse.x=(t.clientX-e.left)/this.width,this.mouse.y=(this.height-(t.clientY-e.top))/this.height;var s=this.pointSet.getClosestFrom(this.mouse,this.width);s&&(-1==this.pointGrabbedIndex?s.distance<=this.controlPointRadius?this.pointHoveredIndex=s.index:-1!=this.pointHoveredIndex&&(this.pointHoveredIndex=-1,this.draw()):(this.pointGrabbedIndex=this.pointSet.updatePoint(this.pointGrabbedIndex,this.mouse),this.pointHoveredIndex=this.pointGrabbedIndex),-1==this.pointHoveredIndex&&-1==this.pointGrabbedIndex||this.draw(),-1!=this.pointGrabbedIndex&&this.callback&&this.callback(this,"change"))},this.down=t=>{t.preventDefault(),t.stopPropagation(),this.mouseDown=!0,this.mouseMoved=!1,document.addEventListener("mouseup",this.up,!1),-1!=this.pointHoveredIndex&&(this.pointGrabbedIndex=this.pointHoveredIndex,this.callback(this,"down"))},this.up=t=>{t.preventDefault(),t.stopPropagation();const e=-1!=this.pointGrabbedIndex,s=this.mouseMoved;this.mouseDown=!1,this.mouseMoved=!1,this.pointGrabbedIndex=-1,document.removeEventListener("mouseup",this.up,!1),e&&s&&this.draw(),e&&this.callback&&s&&this.callback(this,"up")},this.dblClick=t=>{if(t.preventDefault(),t.stopPropagation(),this.canvas.focus(),-1==this.pointHoveredIndex){let t=this.add(new r.A(this.mouse.x,this.mouse.y));this.pointHoveredIndex=t}else this.remove(this.pointHoveredIndex),this.pointHoveredIndex=-1,this.pointGrabbedIndex=-1;this.callback&&this.callback(this,"dblclick")},this.add=(t,e=!0,s=!1)=>{let i=this.pointSet.add(t);return e&&this.draw(),s&&this.callback&&this.callback(this,"change"),i},this.addAll=t=>{this.pointSet.removeAll();for(var e=0;e<t.length;e++)this.pointSet.add(t[e]);this.draw()},this.remove=t=>{this.pointSet.remove(t);this.draw(),this.callback&&this.callback(this,"change")},this.removeAll=()=>{this.pointSet.removeAll(),this.draw(),this.callback&&this.callback(this,"change")},this.reset=()=>{this.pointSet.removeAll(),this.add(new r.A(0,0),!1,!1),this.add(new r.A(1,1),!1,!1),this.draw()},this.draw=()=>{if(!this.pointSet.points.length)return;let t,e=this.width,s=this.height,i=[],a=[],n=this.pointSet.getPoints();for(var o=0;o<n.length;o++)i.push(n[o].x*e),a.push(n[o].y*s);this.ctx.clearRect(0,0,this.width,this.height),this.ctx.beginPath(),this.ctx.moveTo(i[0]/this.screenRatio,(s-a[0])/this.screenRatio);let r=new l.A(i,a);for(var h=0;h<Math.ceil(i[0]);h++)t=a[0],t=t<0?.5:t>s?s-.5:t,this.ctx.lineTo(h/this.screenRatio,(s-t)/this.screenRatio);for(h=Math.ceil(i[0]);h<Math.ceil(i[i.length-1]);h++)t=r.interpolate(h),t=t<0?.5:t>s?s-.5:t,this.ctx.lineTo(h/this.screenRatio,(s-t)/this.screenRatio);for(h=Math.ceil(i[i.length-1]);h<e;h++)t=a[a.length-1],t=t<0?.5:t>s?s-.5:t,this.ctx.lineTo(h/this.screenRatio,(s-t)/this.screenRatio);this.ctx.strokeStyle=-1==this.pointHoveredIndex?this.idleColor:this.hoverColor,this.ctx.lineWidth=this.curveThickness/this.screenRatio,this.ctx.stroke(),this.ctx.closePath();for(o=0;o<i.length;o++)this.ctx.beginPath(),this.ctx.arc(i[o]/this.screenRatio,(s-a[o])/this.screenRatio,this.controlPointRadius/this.screenRatio,0,2*Math.PI),-1!=this.pointHoveredIndex&&o==this.pointHoveredIndex?this.ctx.fillStyle=this.hoverColor:this.ctx.fillStyle=this.idleColor,this.ctx.fill(),this.ctx.closePath()},this.getPoints=()=>this.pointSet.getPoints(),this.cleanUp=()=>{this.canvas.removeEventListener("mousemove",this.move,!0),this.canvas.removeEventListener("mousedown",this.down,!0),this.canvas.removeEventListener("dblclick",this.dblClick,!0)},this.callback=s,this.controlPointRadius=5,this.idleColor=i,this.hoverColor=a,this.mouse=new r.A,this.curveThickness=2,this.pointHoveredIndex=-1,this.pointGrabbedIndex=-1,this.screenRatio=window.devicePixelRatio,this.canvas=t,this.canvas.width=this.width=e,this.canvas.height=this.height=e,this.ctx=this.canvas.getContext("2d"),this.ctx.scale(this.screenRatio,this.screenRatio),this.canvas.addEventListener("mousemove",this.move,!0),this.canvas.addEventListener("mousedown",this.down,!0),this.canvas.addEventListener("dblclick",this.dblClick,!0),this.pointSet=new h,this.add(new r.A(0,0),!1,!1),this.add(new r.A(1,1),!1,!1),this.draw()}}class d extends o.A{constructor(t){super(t,(0,a.A)("titleCurves")),this.setUp=()=>{let t=(0,i.Ay)("curves-swatches").getElementsByTagName("div");for(var e=0;e<t.length;e++)t[e].addEventListener("click",(function(){for(var e=0;e<t.length;e++)t[e].classList.remove("active"),(0,i.Ay)("curves-graph-"+t[e].getAttribute("data-name")).classList.remove("active");this.classList.add("active"),(0,i.Ay)("curves-graph-"+this.getAttribute("data-name")).classList.add("active")}),!1);let s=(0,i.Ay)("curves-grid").getContext("2d");s.lineWidth=2,s.strokeStyle="rgb(68,68,68)",s.strokeRect(1,1,254,254),s.lineWidth=1,s.translate(.5,.5),s.beginPath(),s.moveTo(0,63),s.lineTo(255,63),s.moveTo(0,191),s.lineTo(255,191),s.moveTo(63,0),s.lineTo(63,255),s.moveTo(191,0),s.lineTo(191,255),s.closePath(),s.stroke(),s.setTransform(1,0,0,1,0,0),s.beginPath(),s.lineWidth=2,s.moveTo(0,128),s.lineTo(256,128),s.moveTo(128,0),s.lineTo(128,256),s.closePath(),s.stroke(),s.beginPath(),s.lineWidth=1.5,s.moveTo(0,256),s.lineTo(256,0),s.closePath(),s.stroke(),this.all=new c((0,i.Ay)("curves-graph-all"),256,this.curvesChange,"rgba(100, 100, 100, 1)","rgba(125, 125, 125, 1)"),this.red=new c((0,i.Ay)("curves-graph-red"),256,this.curvesChange,"rgba(209, 72, 14, 1)","rgba(232, 82, 16, 1)"),this.green=new c((0,i.Ay)("curves-graph-green"),256,this.curvesChange,"rgba(146, 156, 31, 1)","rgba(169, 181, 36, 1)"),this.blue=new c((0,i.Ay)("curves-graph-blue"),256,this.curvesChange,"rgba(58, 110, 154, 1)","rgba(68, 129, 179, 1)")},this.curvesChange=(t,e)=>{this.change("curves",new n.A(255,this.all.getPoints(),this.red.getPoints(),this.green.getPoints(),this.blue.getPoints()))},this.dialog.style.width="380px",this.dialog.style.maxWidth="380px",this.setContent(`\n            <div id="curves-holder">      \n                <div id="curves-swatches" class="swatches">\n                    <div class="active" data-name="all" flow="left" tooltip="${(0,a.A)("main")}"><span class="ic" style="background-color: #ccc"></span></div>\n                    <div data-name="red" flow="left" tooltip="${(0,a.A)("red")}"><span style="background-color: #d1480e;"></span></div>\n                    <div data-name="green" flow="left" tooltip="${(0,a.A)("green")}"><span style="background-color:#929C1F;"></span></div>\n                    <div data-name="blue" flow="left" tooltip="${(0,a.A)("blue")}"><span style="background-color: #3a6e9a"></span></div>\n                </div>\n                <div id="curves-overlay">\n                    <canvas id="curves-grid" unselectable="on" width="256" height="256"></canvas>\n                    <canvas class="curves-graph active" unselectable="on" id="curves-graph-all"></canvas>\n                    <canvas class="curves-graph" unselectable="on" id="curves-graph-red"></canvas>\n                    <canvas class="curves-graph" unselectable="on" id="curves-graph-green"></canvas>\n                    <canvas class="curves-graph" unselectable="on" id="curves-graph-blue"></canvas>\n                </div>\n            </div>\n            <div class="tip top-20"><small>${(0,a.A)("addCurvesControlDesc")}</small></div>\n        `),this.setUp()}}},50816:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleDehaze")),this.setContent((0,n.T)("div",{id:"dehaze-slider"})),new a.A("dehaze-slider",{label:(0,o.A)("amount"),range:[0,1],step:.01,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("dehaze",t)})}}},38046:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(2215),a=s(82042),n=s(42268),o=s(54738),r=s(21742);class h extends i.A{constructor(t){super(t,(0,r.A)("titleDenoise")),this.valueChange=o.eD(50,(()=>{this.shaders.addShader("denoise",this.radius.getValue()<.02?0:[this.radius.getValue(),this.threshold.getValue()]),setTimeout((()=>{this.scratch.canvas=this.shaders.apply(this.cache),window.requestAnimationFrame((()=>this.stage.render()))}),0)})),this.kind="denoise",this.setContent((0,n.T)("div",{id:"denoise-radius"}),(0,n.T)("div",{id:"denoise-threshold",className:"top-16"})),this.radius=new a.A("denoise-radius",{label:(0,r.A)("radius"),step:.01,range:[0,1],defaultValue:.4,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.valueChange()}),this.threshold=new a.A("denoise-threshold",{label:(0,r.A)("threshold"),step:.01,range:[.01,1],defaultValue:.12,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.valueChange()}),this.valueChange()}}},15872:(t,e,s)=>{s.d(e,{A:()=>u});var i=s(21742),a=s(54738),n=s(40963),o=s(15818),r=s(82042),h=s(22866),l=s(8689),c=s(26806),d=s(58489);class u extends c.A{constructor(t){super((0,i.A)("titleDropShadow"),!1),this.stage=t,this.apply=()=>{const t=this.stage.fresco.getSelected(),e=a.TL(this.scratch.canvas).rebase(-this.scratch.rect.x,-this.scratch.rect.y),s=a.ON(t.canvas,e.rebase(t.rect.x,t.rect.y)),i=a.oM(t.mask),n=t.rect.clone();t.extendCanvas(e),this.scratch.drawToLayer(t),t.render(),this.stage.fresco.removeScratch(),this.stage.history.add({type:"bitmapChange",kind:"DropShadow",layer:t,rect:n,patchRect:e.rebase(t.rect.x,t.rect.y),patch:s,mask:i}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.cleanUp()},this.cancel=()=>{this.stage.fresco.removeScratch(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.cleanUp()},this.change=()=>{const t=this.stage.fresco.getSelected(),e=this.scratch.ctx;if(t.canvas){this.scratch.clear(),e.save();try{const t=this.color.getColor();e.shadowColor=t.toRGBA(255*this.opacitySlider.getValue()),e.shadowOffsetX=this.offsetXSlider.getValue(),e.shadowOffsetY=this.offsetYSlider.getValue(),e.shadowBlur=this.blurSlider.getValue(),e.drawImage(this.cache,0,0),window.requestAnimationFrame((()=>this.stage.render()))}finally{e.restore()}}},this.createCombinationMask=t=>{if(this.selected.type===h.A.TYPE_FRAME||!this.stage.fresco.hasSelection()&&!t)return;let e=this.selected;if(!this.stage.fresco.hasSelection()&&!e.hasMask())return;let s=a.Nw(e.canvas.width,e.canvas.height),i=s.getContext("2d");return this.stage.fresco.hasSelection()&&i.drawImage(this.stage.fresco.selection.mask,-e.rect.x,-e.rect.y),t&&e.hasMask()&&(i.save(),this.stage.fresco.hasSelection()&&(i.globalCompositeOperation="destination-in"),i.drawImage(this.selected.mask,0,0),i.restore()),i=void 0,s},this.setContent('\n            <label class="split">Color<div id="drop-shadow-color"></div></label>\n            <div id="drop-shadow-opacity" class="range-box top-15"></div>\n            <div id="drop-shadow-blur" class="range-box top-10"></div>\n            <div id="drop-shadow-offset-x" class="range-box top-10"></div>\n            <div id="drop-shadow-offset-y" class="range-box top-10"></div>\n        '),this.color=new l.A("drop-shadow-color",o.A.fromHEX("#000000"),this.change,this.change),this.opacitySlider=new r.A("drop-shadow-opacity",{label:(0,i.A)("opacity"),defaultValue:.5,labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100,onChange:()=>this.change()}),this.blurSlider=new r.A("drop-shadow-blur",{label:(0,i.A)("blur"),defaultValue:5,range:[0,150],step:1,labelFormat:t=>`${t}px`,onChange:()=>this.change()}),this.offsetXSlider=new r.A("drop-shadow-offset-x",{label:(0,i.A)("offsetX"),defaultValue:20,range:[-100,100],step:1,labelFormat:t=>`${t}px`,onChange:()=>this.change()}),this.offsetYSlider=new r.A("drop-shadow-offset-y",{label:(0,i.A)("offsetY"),defaultValue:20,range:[-100,100],step:1,labelFormat:t=>`${t}px`,onChange:()=>this.change()}),this.selected=t.fresco.getSelected();const e=new n.A(0,0,t.fresco.width,t.fresco.height),s=this.selected.settings.locked&&this.selected.rect.equalTo(e)?0:150;let c=this.createCombinationMask(!1),u=!1;if(c){this.cache=a.oM(this.selected.canvas);var p=this.cache.getContext("2d");p.save(),p.globalCompositeOperation="destination-in",p.drawImage(c,0,0),p.restore(),p=null,u=!0}else this.cache=this.selected.canvas;const g=(this.selected.trim&&this.selected instanceof d.A?this.selected.getGlobalTrim():this.selected.rect).pad(s);if(s>0){const t=a.Nw(g.width,g.height);t.getContext("2d").drawImage(this.cache,s,s),this.cache=t}this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,g,u?"over":"replace"),this.scratch.settings.blendmode=this.selected.settings.blendmode,this.scratch.settings.opacity=this.selected.settings.opacity,this.position(),this.change()}}},45432:(t,e,s)=>{s.d(e,{A:()=>u});var i=s(21742),a=s(42268),n=s(54738),o=s(40963),r=s(23556),h=s(65209),l=s(81937),c=s(44448),d=s(2215);class u extends d.A{constructor(t){super(t,(0,i.A)("titleEffectLibrary"),!0),this.setUp=()=>{let t=o.A.fillFit(this.selected.canvas.width,this.selected.canvas.height,220,220);this.thumbnail=n.H5(this.selected.canvas,t.width,t.height),this.marked=void 0,this.renderGroups(),new l.A((0,a.Ay)("effect-content"))},this.renderGroups=()=>{(0,a.Ay)("effect-back").style.display="none";let t=(0,a.Ay)("effect-presets");t.innerHTML="",c.A.groups().forEach((e=>{const s=(0,a.T)("div",{className:"effect-group",id:e,onclick:()=>this.renderEffects(e)}),i=document.createElement("img");i.src="/img/preset/"+e+".jpg",s.appendChild(i);let n=document.createElement("span");n.innerText=e.replace("-"," & "),s.appendChild(n),t.appendChild(s)}))},this.renderEffects=t=>{(0,a.Ay)("effect-back").style.display="flex",(0,a.Ay)("effect-settings").style.display="none";let e=(0,a.Ay)("effect-presets");e.innerHTML="";const s=-(this.thumbnail.width-220)/2,i=-(this.thumbnail.height-120)/2,n=new r.A([]);c.A.names(t).forEach((t=>{const a=document.createElement("div");a.classList.add("effect-preset"),a.id=t,a.addEventListener("click",this.select,!1);const o=document.createElement("canvas");o.width=220,o.height=120,a.appendChild(o);const r=o.getContext("2d");r.drawImage(this.thumbnail,s,i,this.thumbnail.width,this.thumbnail.height);let h=document.createElement("span");h.innerText=t,a.appendChild(h),e.appendChild(a);setTimeout((()=>{n.reset(),n.addPreset(t),r.drawImage(n.apply(this.thumbnail),s,i,this.thumbnail.width,this.thumbnail.height),this.marked&&this.marked.name==t&&setTimeout((()=>{a.classList.add("selected"),this.positionSettings(a)}),200)}),10)}))},this.amount=t=>{n.sg("effect-amount",50,(()=>{this.shaders.reset();const t=parseInt((0,a.Ay)("effect-amount").value,10)/100;this.shaders.addPreset(this.marked.name,t),this.scratch.canvas=this.shaders.apply(this.cache),window.requestAnimationFrame((()=>this.stage.render()))}))},this.back=()=>{(0,a.Ay)("effect-settings").style.display="none",this.renderGroups()},this.select=t=>{let e=t.currentTarget,s=(0,a.Ay)("effect-presets").getElementsByTagName("div");for(var i=0;i<s.length;i++)s[i].classList.remove("selected");e.classList.add("selected"),this.effect(e.id),(0,a.Ay)("effect-settings").style.display="none",setTimeout((()=>{this.positionSettings(e)}),200)},this.positionSettings=t=>{(0,a.Ay)("effect-amount").value=(0,a.Ay)("effect_amount_out").innerHTML=(100*this.marked.value).toString();let e=(0,a.Ay)("effect-settings");e.style.display="block",e.style.top=t.offsetTop+"px",e.style.left=t.offsetLeft+"px"},this.effect=t=>{this.selected&&(this.kind="effect - "+t,this.shaders.reset(),this.marked=new h.A(t,1),this.shaders.addPreset(t,1),this.scratch.canvas=this.shaders.apply(this.cache),window.requestAnimationFrame((()=>this.stage.render())))},this.reset=()=>{if(!this.selected)return;let t=(0,a.Ay)("effect-presets").getElementsByTagName("div");for(var e=0;e<t.length;e++)t[e].classList.remove("selected");this.marked=null,(0,a.Ay)("effect-settings").style.display="none",this.scratch.setTarget(this.selected.id,this.selected.rect,"replace",this.cache),this.stage.render()},this.dialog.style.width="500px",this.dialog.style.height="400px",this.dialog.style.maxWidth="500px",this.content.style.padding="0px 0px 0px 20px",this.content.id="effect-content",this.compare.remove(),this.setContent('\n            <div id="effect-settings">\n                <img class="close" id="effect-remove" src="/img/icon/close.svg" title="Remove effect">\n                <div class="range-white" id="effect-settings-amount">\n                    <input type="range" value="100" min="0" max="100" step="1" id="effect-amount" name="effect_amount" oninput="effect_amount_out.value=this.value" />\n                    <output name="effect_amount_out" id="effect_amount_out" for="effect_amount">100</output>\n                </div>\n            </div>\n        \n            <section id="effect-presets" class="top-20">\n            </section>\n        '),(0,a.Ay)("dialog-buttons"+this.mid).insertBefore((0,a.T)("a",{className:"button negative",id:"effect-back",style:"margin-right:auto"},(0,a.T)("img",{src:"/img/icon/back-small.svg",width:14,height:14}),(0,i.A)("back")),(0,a.Ay)("dialog-cancel"+this.mid)),(0,a.Ay)("effect-back").addEventListener("click",this.back,!1),(0,a.Ay)("effect-remove").addEventListener("click",this.reset,!1),(0,a.Ay)("effect-amount").addEventListener("input",this.amount,!1),(0,a.Ay)("effect-settings").style.display="none",(0,a.Ay)("effect-back").style.display="none",this.setUp()}}},21164:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleExposure")),this.setContent((0,n.T)("div",{id:"exposure"})),new a.A("exposure",{label:(0,o.A)("amount"),step:.01,range:[-1,1],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("exposure",t)})}}},15923:(t,e,s)=>{s.d(e,{A:()=>g});var i=s(42268),a=s(21742),n=s(54738),o=s(7324),r=s(40963),h=s(82042),l=s(26806),c=s(15818),d=s(29755),u=s(66827),p=s(58489);class g extends l.A{constructor(t){super((0,a.A)("titleFill"),!1),this.cancel=()=>{this.cleanUp()},this.updatePreserve=()=>{(0,i.Ay)("filler-preserve").checked&&this.selected.rect&&this.selected.canvas?this.scratch.setTarget(this.selected.id,this.selected.rect,"over"):this.scratch.setTarget(this.selected.id,new r.A(0,0,this.stage.fresco.width,this.stage.fresco.height),"over"),this.update()},this.update=()=>{var t,e;this.selected instanceof p.A||(this.scratch||(this.scratch=this.stage.fresco.addScratch(),(0,i.Ay)("filler-preserve").checked&&this.selected.rect&&this.selected.canvas?this.scratch.setTarget(this.selected.id,this.selected.rect,"over"):this.scratch.setTarget(this.selected.id,new r.A(0,0,this.stage.fresco.width,this.stage.fresco.height),"over")),this.scratch.clear(),this.scratch.settings.blendmode=(0,i.Ay)("filler-blend-mode").value,this.selected.rect&&this.selected.canvas&&(0,i.Ay)("filler-preserve").checked?(this.scratch.ctx.save(),null===(e=this.fillPod.getFill())||void 0===e||e.addToCanvasFillStyle(this.scratch.ctx),this.scratch.ctx.fillRect(0,0,this.scratch.canvas.width,this.scratch.canvas.height),this.scratch.ctx.globalCompositeOperation="destination-in",this.scratch.ctx.drawImage(this.selected.canvas,0,0),this.scratch.ctx.restore()):(null===(t=this.fillPod.getFill())||void 0===t||t.addToCanvasFillStyle(this.scratch.ctx),this.scratch.ctx.fillRect(0,0,this.scratch.canvas.width,this.scratch.canvas.height)),this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render())))},this.apply=()=>{var t;if(this.selected instanceof p.A){const e=this.selected.trim.clone(),s=n.oM(this.selected.canvas);let a=this.selected.canvas.getContext("2d");a.save(),a.globalAlpha=this.opacity.getValue(),a.globalCompositeOperation=(0,i.Ay)("filler-blend-mode").value,null===(t=this.fillPod.getFill())||void 0===t||t.addToCanvasFillStyle(this.scratch.ctx),a.fillRect(0,0,this.selected.canvas.width,this.selected.canvas.height),a.restore(),this.stage.history.add({type:"bitmapSwitch",kind:"fill",layer:this.selected,rect:e,canvas:s}),this.selected.render()}else{let t=n.TL(this.scratch.getCanvas());if(t&&t.width>0&&t.height>0){const e=this.selected.rect.clone(),s=n.oM(this.selected.canvas);this.selected.extendCanvas(t),this.scratch.drawToLayer(this.selected,(0,i.Ay)("filler-blend-mode").value,this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapSwitch",kind:"fill",layer:this.selected,rect:e,canvas:s})}}window.requestAnimationFrame((()=>this.stage.render())),this.cleanUp()},this.cleanUp=()=>{this.fillPod.cleanUp(),this.stage.coating.freeze(!1),this.stage.fresco.removeScratch(),(0,i.Ay)("filler-preserve").removeEventListener("change",this.updatePreserve),(0,i.Ay)("filler-blend-mode").removeEventListener("change",this.update),document.removeEventListener("keydown",this.keyDown,!1),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.selected=void 0,this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.stage=t,this.stage.coating.freeze(!0),this.selected=this.stage.fresco.getSelected(),this.setContent(`\n\n            <label class="split">${(0,a.A)("fill")}\n                <div id="filler-fill"></div>\n            </label>\n            <label id="filler-blend-mode-holder" class="split top-10">${(0,a.A)("blendMode")}\n                <div class="select top-0" style="width:auto">\n                    <select id="filler-blend-mode">\n                        <option value="source-over" selected>${(0,a.A)("blendModeNone")}</option>\n                        <option value="multiply">${(0,a.A)("blendModeMultiply")}</option>\n                        <option value="screen">${(0,a.A)("blendModeScreen")}</option>\n                        <option value="overlay">${(0,a.A)("blendModeOverlay")}</option>\n                        <option value="darken">${(0,a.A)("blendModeDarken")}</option>\n                        <option value="lighten">${(0,a.A)("blendModeLighten")}</option>\n                        <option value="color-dodge">${(0,a.A)("blendModeColorDodge")}</option>\n                        <option value="color-burn">${(0,a.A)("blendModeColorBurn")}</option>\n                        <option value="hard-light">${(0,a.A)("blendModeHardLight")}</option>\n                        <option value="soft-light">${(0,a.A)("blendModeSoftLight")}</option>\n                        <option value="difference">${(0,a.A)("blendModeDifference")}</option>\n                        <option value="exclusion">${(0,a.A)("blendModeExclusion")}</option>\n                        <option value="hue">${(0,a.A)("blendModeHue")}</option>\n                        <option value="saturation">${(0,a.A)("blendModeSaturation")}</option>\n                        <option value="color">${(0,a.A)("blendModeColor")}</option>\n                        <option value="luminosity">${(0,a.A)("blendModeLuminosity")}</option>\n                    </select>\n                </div>\n            </label>\n\n            <div id="filler-opacity" class="range-box top-20"></div>\n\n            <div id="filler-preserve-holder">\n                <input type="checkbox" checked id="filler-preserve" />\n                <label class="switch top-16" for="filler-preserve">${(0,a.A)("preserveTransparency")}<span></span></label>\n            </div>\n        `),this.fillPod=new u.A("filler-fill",new o.A(c.A.fromHEX(d.Ay.mainColor)),this.update,this.update),(0,i.Ay)("filler-preserve").addEventListener("change",this.updatePreserve),(0,i.Ay)("filler-blend-mode").addEventListener("change",this.update),this.opacity=new h.A("filler-opacity",{label:(0,a.A)("opacity"),defaultValue:1,labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100,onChange:t=>{this.scratch.settings.opacity=t,window.requestAnimationFrame((()=>this.stage.render()))}}),this.selected.rect&&this.selected.canvas||((0,i.Ay)("filler-blend-mode-holder").style.display="none",(0,i.Ay)("filler-preserve-holder").style.display="none"),this.update()}}},47378:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(2215),a=s(82042),n=s(42268),o=s(21742),r=s(54738);class h extends i.A{constructor(t){super(t,(0,o.A)("titleFishEye")),this.update=r.eD(50,(()=>{const t=Number(document.querySelector('input[name="edge-fill"]:checked').value),e={amount:this.amount.getValue(),aperture:this.aperture.getValue()*(Math.PI/1.8),x:this.x.getValue(),y:this.y.getValue(),edgeFill:t};this.change("fisheye",e)})),this.setContent(`\n             <div id="fish-eye-aperture"></div>\n             <div id="fish-eye-x" class="top-16"></div>\n             <div id="fish-eye-y" class="top-16"></div>\n             <div id="fish-eye-amount" class="top-10"></div>\n             <label class="split top-35">${(0,o.A)("edgeFill")}</label>\n             <div class="switch-field top-5" id="fish-eye-edge-fill">\n                 <input type="radio" id="edge-fill-none" name="edge-fill" value="0" checked/><label for="edge-fill-none">${(0,o.A)("none")}</label>\n                 <input type="radio" id="edge-fill-reflect" name="edge-fill" value="1"/><label for="edge-fill-reflect">${(0,o.A)("reflect")}</label>\n                 <input type="radio" id="edge-fill-repeat" name="edge-fill" value="2"/><label for="edge-fill-repeat">${(0,o.A)("repeat")}</label>\n             </div>\n            `),this.amount=new a.A("fish-eye-amount",{label:(0,o.A)("stretch"),range:[0,1],defaultValue:0,step:.01,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.aperture=new a.A("fish-eye-aperture",{label:(0,o.A)("buldge"),step:.01,range:[-Math.PI/2,Math.PI/2],defaultValue:0,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.update()}),this.x=new a.A("fish-eye-x",{label:"X",range:[0,1],defaultValue:.5,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.y=new a.A("fish-eye-y",{label:"Y",range:[0,1],defaultValue:.5,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),(0,n.Ay)("edge-fill-none").addEventListener("change",this.update,!1),(0,n.Ay)("edge-fill-reflect").addEventListener("change",this.update,!1),(0,n.Ay)("edge-fill-repeat").addEventListener("change",this.update,!1),this.update()}}},92270:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleFringe")),this.setContent((0,n.T)("div",{id:"fringe-slider"})),new a.A("fringe-slider",{label:(0,o.A)("amount"),step:.01,range:[-1,1],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("fringe",t)})}}},64019:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleGaussianBlur")),this.setContent((0,n.T)("div",{id:"gaussian-slider"})),new a.A("gaussian-slider",{label:(0,o.A)("amount"),range:[0,1],step:.01,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("gaussian",t)})}}},26232:(t,e,s)=>{s.d(e,{A:()=>y});var i=s(21742),a=s(42268),n=s(40963),o=s(53900),r=s(54738),h=s(41915),l=s(79453),c=s(81937),d=s(78508),u=s(26806),p=s(50295),g=s(6395);var m=s(96703);var v=s(3514);class y extends u.A{constructor(t){super((0,i.A)("titleAIGenerativeExpand"),!0,!0),this.constrain=!0,this.saving=!1,this.messy=!1,this.working=!1,this.setPreview=async()=>{(0,a.Ay)("generative-expand-preview-holder").innerHTML="";const t=n.A.bestFit(this.selected.canvas.width,this.selected.canvas.height,this.dialog.offsetWidth-360,this.dialog.offsetHeight-192),e=r.H5(this.selected.canvas,t.width,t.height,!0);e.id="generative-expand-preview-canvas",e.classList.add("expand-preview"),(0,a.Ay)("generative-expand-preview-holder").append(e),this.updatePreview()},this.updatePreview=()=>{const t=(0,a.Ay)("generative-expand-preview-holder"),e=(0,a.Ay)("generative-expand-preview-canvas"),s=n.A.bestFit(this.size.width,this.size.height,this.dialog.offsetWidth-360,this.dialog.offsetHeight-192);let i=this.selected.rect.width/this.size.width,o=this.selected.rect.height/this.size.height;t.style.width=s.width+2+"px",t.style.height=s.height+2+"px",e.style.width=s.width*i+"px",e.style.height=s.height*o+"px";let r=t.clientWidth/this.size.width;e.style.top=Math.round(this.pos.y*r)+"px",e.style.left=Math.round(this.pos.x*r)+"px",this.messy=1!==i||1!==o,this.messy?(0,a.Ay)("generative-expand-execute").classList.remove("disabled"):(0,a.Ay)("generative-expand-execute").classList.add("disabled")},this.previewDown=t=>{t.stopPropagation();const e=(0,a.Ay)("generative-expand-preview-canvas");this.downPoint=new h.A(t.clientX,t.clientY),this.downPosition=new h.A(e.offsetLeft,e.offsetTop),document.addEventListener("pointermove",this.previewMove,!0),document.addEventListener("pointerup",this.previewUp,!0)},this.previewMove=t=>{t.stopPropagation();const e=(0,a.Ay)("generative-expand-preview-canvas"),s=(0,a.Ay)("generative-expand-preview-holder");let i=this.downPosition.x+(t.clientX-this.downPoint.x),n=this.downPosition.y+(t.clientY-this.downPoint.y);i=r.qE(i,0,s.clientWidth-e.clientWidth),n=r.qE(n,0,s.clientHeight-e.clientHeight),e.style.top=n+"px",e.style.left=i+"px";let o=this.size.width/s.clientWidth;this.pos.x=Math.round(i*o),this.pos.y=Math.round(n*o)},this.previewUp=t=>{t.stopPropagation(),document.removeEventListener("pointermove",this.previewMove,!0),document.removeEventListener("pointerup",this.previewUp,!0)},this.showCreditPop=()=>{new m.A("credits")},this.setPreset=t=>{var e;if(t!==(null===(e=this.selectedPreset)||void 0===e?void 0:e.getAttribute("data"))&&this.reset(),-1!==t.indexOf(":")){const[e,s]=t.split(":").map(Number);let i=this.selected.rect.width,a=this.selected.rect.height;if(e===s){let t=Math.max(i,a);this.size=new o.A(t,t)}else{let t=i,n=a;e>s?(n=i/e*s,n<a&&(t=a/s*e,n=a)):(t=a/s*e,t<i&&(n=i/e*s,t=i)),this.size=new o.A(Math.round(t),Math.round(n))}}else"1.5x"===t&&(this.size.width=Math.round(1.5*this.selected.rect.width),this.size.height=Math.round(1.5*this.selected.rect.height)),"2x"===t&&(this.size.width=2*this.selected.rect.width,this.size.height=2*this.selected.rect.height),"1.5w"===t&&(this.size.height=this.selected.rect.height,this.size.width=Math.round(1.5*this.selected.rect.width)),"1.5h"===t&&(this.size.width=this.selected.rect.width,this.size.height=Math.round(1.5*this.selected.rect.height));this.pos.x=Math.round(.5*(this.size.width-this.selected.rect.width)),this.pos.y=Math.round(.5*(this.size.height-this.selected.rect.height)),this.updateSizeInput(),this.updatePreview()},this.changeContraint=t=>{this.saving||(this.constrain=!this.constrain,(0,a.Ay)("generative-expand-lock").style.display=this.constrain?"block":"none",(0,a.Ay)("generative-expand-vs").style.display=this.constrain?"none":"block",(0,a.Ay)("toggle-generative-expand-constraint").checked=this.constrain)},this.widthHeightInputChange=t=>{if(this.saving||this.working)return;let e=null==t?void 0:t.currentTarget,s=(0,a.Ay)("generative-expand-width").value,i=(0,a.Ay)("generative-expand-height").value;if(this.size.width=Number.isNaN(Number(s))?this.selected.rect.width:r.qE(Number(s),this.selected.rect.width,4096),this.size.height=Number.isNaN(Number(i))?this.selected.rect.height:r.qE(Number(i),this.selected.rect.height,4096),this.constrain&&"generative-expand-width"==e.id){let t=this.size.width/this.selected.rect.width;this.size.height=Number.isNaN(Number(s))?this.selected.rect.height:Math.round(t*this.selected.rect.height)}else if(this.constrain&&"generative-expand-height"==e.id){let t=this.size.height/this.selected.rect.height;this.size.width=Number.isNaN(Number(s))?this.selected.rect.width:Math.round(t*this.selected.rect.width)}this.pos.x=Math.round(.5*(this.size.width-this.selected.rect.width)),this.pos.y=Math.round(.5*(this.size.height-this.selected.rect.height)),r.sg("size",200,(()=>this.updatePreview()))},this.updateSizeInput=()=>{(0,a.Ay)("generative-expand-width").value=this.size.width.toString(),(0,a.Ay)("generative-expand-height").value=this.size.height.toString()},this.renderCreditAmount=()=>{l.N?(0,a.Ay)("generative-expand-credit-count").innerHTML=l.N.credits.toString():((0,a.Ay)("generative-expand-execute").innerText=(0,i.A)("common-signUpLogIn"),(0,a.Ay)("generative-expand-credit-count").style.display="none")},this.reset=()=>{(0,a.Ay)("generative-expand-result").style.display="none",(0,a.Ay)("generative-expand-preview").style.display="block",(0,a.Ay)("generative-expand-execute").style.display="inline-flex",(0,a.Ay)("generative-expand-repeat").style.display="none",(0,a.Ay)(`dialog-apply${this.mid}`).classList.add("disabled"),this.result=void 0},this.execute=async()=>{var t,e,s;if(l.N)if(l.N.credits){if(!(this.working||this.size.width===this.selected.rect.width&&this.size.height===this.selected.rect.height)){this.working=!0,(0,a.Ay)("generative-expand-execute").classList.add("working"),null===(t=(0,a.Ay)("generative-expand-repeat"))||void 0===t||t.classList.add("working"),(0,a.Ay)("generative-expand-settings").classList.add("disabled"),(0,a.Ay)("generative-expand-preview").classList.add("disabled");try{let t=(0,a.Ay)("generative-expand-result-list").getElementsByTagName("canvas");for(let a=0;a<t.length;a++)t[a].classList.add("disabled");this.result=await async function(t,e,s,i=2){const a=await fetch("/api/auth/ai/remove-background/"),n=await a.json();if(!1===n.status)throw new Error(n.message);const o=(await r.r$(t)).replace("data:image/jpeg;base64,",""),h=await fetch("https://ai.pixlr.com/outpaint",{method:"POST",headers:{authorizationToken:n.data,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({init_image_b64:o,output_dims:[e.width,e.height],image_position:[s.x,s.y],num_images:i})}),l=JSON.parse(await h.json()).split(",").map((t=>(0,g.kw)(`data:image/jpeg;base64,${t}`)));return Promise.all(l)}(this.selected.canvas,this.size,this.pos,1),(0,a.Ay)("generative-expand-result").style.display="block",(0,a.Ay)("generative-expand-preview").style.display="none",(0,a.Ay)("generative-expand-execute").style.display="none",(0,a.Ay)("generative-expand-repeat").style.display="inline-flex",(0,a.Ay)(`dialog-apply${this.mid}`).classList.remove("disabled"),(0,a.Ay)("generative-expand-result-list").innerHTML="",(0,a.Ay)("generative-expand-repeat").addEventListener("click",this.execute,!1);const[e]=this.result;e.id=r.r0();let s=n.A.bestFit(e.width,e.height,this.dialog.offsetWidth-360,this.dialog.offsetHeight-192),i=r.H5(e,s.width,s.height,!0);i.className="flow-down",i.style.boxShadow="6px 6px 12px rgb(0 0 0 / 30%)",i.id="generative-expand-result-canvas",(0,a.Ay)("generative-expand-result-list").append(i),(0,d.xs)("generative-expand-editor").then((()=>{this.renderCreditAmount()}))}catch(o){console.error(o),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)("genericError")}))}finally{this.working=!1,null===(e=(0,a.Ay)("generative-expand-execute"))||void 0===e||e.classList.remove("working"),null===(s=(0,a.Ay)("generative-expand-repeat"))||void 0===s||s.classList.remove("working"),(0,a.Ay)("generative-expand-settings").classList.remove("disabled"),(0,a.Ay)("generative-expand-preview").classList.remove("disabled")}}}else l.N.subscription?new m.A("credits"):new v.A("generative-expand","credit");else new p.A},this.cancel=()=>{this.cleanUp()},this.scaleAndApply=async t=>{this.working=!0,(0,a.Ay)("generative-expand-result").classList.add("working"),(0,a.Ay)(`dialog-apply${this.mid}`).classList.add("working"),(0,a.Ay)("generative-expand-settings").classList.add("disabled"),(0,a.Ay)("generative-expand-result").classList.add("disabled");try{let e=this.result.find((e=>e.id===t)),s=r.k8(e,this.maxSize),i=await async function(t,e){const s=await fetch("/api/auth/ai/remove-background/"),i=await s.json();if(!1===i.status)throw new Error(i.message);let a;const n=(await r.r$(t)).replace("data:image/jpeg;base64,","");a=e instanceof o.A?{image_b64:n,target_width:e.width,target_height:e.height}:{image_b64:n,scale:e};const h=await fetch("https://ai.phosus.com/sr/v2",{method:"POST",headers:{authorizationtoken:i.data,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)}),l=await h.blob();return r.lz(l)}(s,this.size);if(this.stage.fresco.layers[0]===this.selected&&this.selected.canvas.width===this.stage.fresco.width&&this.selected.canvas.height===this.stage.fresco.height){const t=new o.A(this.stage.fresco.width,this.stage.fresco.height);if(t.width!==i.width||i.width!==i.height){const e=this.stage.fresco.layers.map((t=>(t.syncRequested=new Date,t.clone(!0))));this.stage.fresco.resize(i.width,i.height,!0),this.selected.canvas=i,this.selected.rect=new n.A(this.selected.rect.x,this.selected.rect.y,i.width,i.height),this.stage.history.add({type:"pageResize",size:t,layers:e})}}else{const t=this.selected.rect.clone(),e=r.oM(this.selected.canvas);this.selected.canvas=i,this.selected.rect=new n.A(this.selected.rect.x,this.selected.rect.y,i.width,i.height),this.stage.history.add({type:"bitmapSwitch",kind:"generative-expand",layer:this.selected,rect:t,canvas:e})}}catch(e){console.error(e),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.A)("genericError")}))}this.working=!1,(0,a.Ay)("generative-expand-result").classList.remove("working"),(0,a.Ay)(`dialog-apply${this.mid}`).classList.remove("working"),(0,a.Ay)("generative-expand-settings").classList.remove("disabled"),(0,a.Ay)("generative-expand-result").classList.remove("disabled"),document.dispatchEvent(new CustomEvent("reset-viewport")),document.dispatchEvent(new CustomEvent("layerlist-update")),document.dispatchEvent(new CustomEvent("layer-select")),this.updatePreview(),this.cleanUp()},this.applyLayer=()=>{if(this.saving)return;this.saving=!0;const t=r.oM(this.selected.canvas),e=this.selected.rect.clone();this.stage.history.add({type:"bitmapSwitch",kind:"generative-expand",layer:this.selected,canvas:t,rect:e})},this.apply=()=>{const[t]=this.result;this.scaleAndApply(t.id)},this.cleanUp=()=>{var t;(0,a.Ay)("generative-expand-preview-holder").removeEventListener("pointerdown",this.previewDown,!1),(0,a.Ay)("generative-expand-credit-count").removeEventListener("click",this.showCreditPop),(0,a.Ay)("generative-expand-width").removeEventListener("input",this.widthHeightInputChange,!1),(0,a.Ay)("generative-expand-width").removeEventListener("blur",this.updateSizeInput,!1),(0,a.Ay)("generative-expand-height").removeEventListener("input",this.widthHeightInputChange,!1),(0,a.Ay)("generative-expand-height").removeEventListener("blur",this.updateSizeInput,!1),(0,a.Ay)("generative-expand-execute").removeEventListener("click",this.execute,!1),null===(t=(0,a.Ay)("generative-expand-repeat"))||void 0===t||t.removeEventListener("click",this.execute,!1),this.selected=void 0,this.selectedPreset=void 0,super.cleanUp()},this.stage=t,this.maxSize=8192,this.dialog.style.width="90%",this.dialog.style.height="80%",this.dialog.style.maxWidth="1200px",this.content.style.flex="1",this.content.style.height="1px",this.content.style.padding="0px",this.content.style.display="flex",this.content.style.position="relative",this.setContent(`\n            <div id="generative-expand-settings" style="flex:0 0 auto;width:300px;position:relative;overflow: hidden;">\n\n                <div id="generative-expand-base" style="padding:20px;overflow: hidden;">\n\n                    <label class="split">${(0,i.A)("generativeExpandPreset")}</label>\n                    <ul class="push-buttons small top-5" id="generative-expand-preset-list">\n                        <li data="1.5h"><img src="/img/icon/aspect-15h.svg" width="18" height="18"><span>1.5x High</span></li>\n                        <li data="1.5w"><img src="/img/icon/aspect-15w.svg" width="18" height="18"><span>1.5x Wide</span></li>\n                        <li data="1.5x"><img src="/img/icon/aspect-2x.svg" width="18" height="18"><span>1.5x Size</span></li>\n                        <li data="2x"><img src="/img/icon/aspect-2x.svg" width="18" height="18"><span>2x Size</span></li>\n                        <li data="1:1"><img src="/img/icon/aspect-1-1.svg" width="18" height="18"><span>Square</span></li>\n                        <li data="3:4"><img src="/img/icon/aspect-3-4.svg" width="18" height="18"><span>Portrait</span></li>\n                        <li data="4:3"><img src="/img/icon/aspect-4-3.svg" width="18" height="18"><span>Post</span></li>\n                        <li data="9:16"><img src="/img/icon/aspect-9-16.svg" width="18" height="18"><span>Story</span></li>\n                        <li data="16:9"><img src="/img/icon/aspect-16-9.svg" width="18" height="18"><span>Wide</span></li>\n                    </ul>\n\n                    <div style="display: flex; line-height: 28px;" class="top-30">\n                        <div style="flex-grow:1">\n                            <label class="split" style="height: 36px!important;">${(0,i.A)("width")} <input type="number" id="generative-expand-width"/></label>\n                            <label class="split" style="height: 36px!important;">${(0,i.A)("height")} <input type="number" id="generative-expand-height"/></label>\n                        </div>\n                        <div style="width:30px">\n                            <div id="generative-expand-constraint" class="constraint">\n                                <div class="constraint-lock" flow="left" tooltip="${(0,i.A)("toggleConstraint")}">\n                                    <img src="/img/icon/locked.svg" id="generative-expand-lock" width="16" height="16" loading="lazy" class="ic tiny-icon">\n                                    <img src="/img/icon/x.svg" id="generative-expand-vs" width="16" height="16" loading="lazy" style="display:none" class="ic tiny-icon">\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <input type="checkbox" checked id="toggle-generative-expand-constraint" />\n                    <label class="switch top-10" for="toggle-generative-expand-constraint">${(0,i.A)("dialogResizeLock")}<span></span></label>\n\n                    <div id="generative-expand-execute" class="button positive top-30" style="width: 100%; height: 34px;">${(0,i.A)("aiInfillGenerate")} (1c)</div>\n                    <div id="generative-expand-repeat" class="button outline top-30" style="width: 100%; height: 34px; display:none">\n                        <img src="/img/icon/reset.svg" width="16" height="16" loading="lazy" class="ic"/>\n                        ${(0,i.A)("repeat")} (1c)\n                    </div>\n                </div>\n            </div>\n            \n            <div id="generative-expand-preview" style="display: flex; flex-direction: column; flex-grow: 1; align-items: center; padding: 20px;background: linear-gradient(43deg, #ffffff00 0%, #ffffff11 100%)">\n                <label>${(0,i.A)("generativeExpandPosition")} <span class="tab-10" style="color:var(--text-dim);font-style: italic;">${(0,i.A)("generativeExpandDrag")}</span></label>\n                <div id="generative-expand-preview-holder" class="expand-preview-holder top-20"></div>\n            </div>\n\n            <div id="generative-expand-result" style="display:none;flex-direction:column;flex-grow:1;align-items:center;padding:20px;background:linear-gradient(43deg, #ffffff00 0%, #ffffff11 100%);">\n                <label class="split" style="width: 100%; margin-bottom: 15px;">${(0,i.A)("generativeExpandPosition")} <span style="color:var(--text-dim);font-style: italic;">${(0,i.A)("generativeExpandDrag")}</span></label>\n                <div id="generative-expand-result-list" style="display:flex;align-items:center;justify-content:center;"></div>\n            </div>\n        `),(0,a.Ay)(`dialog-buttons${this.mid}`).insertBefore((0,a.T)("div",{id:"generative-expand-credit-count",className:"credit-meter",onclick:this.showCreditPop},""),(0,a.Ay)(`dialog-cancel${this.mid}`)),(0,a.Ay)("generative-expand-preview-holder").addEventListener("pointerdown",this.previewDown,!1),(0,a.Ay)("generative-expand-preset-list").childNodes.forEach((t=>{t.addEventListener("click",(t=>{var e;null===(e=this.selectedPreset)||void 0===e||e.classList.remove("selected");let s=t.currentTarget,i=s.getAttribute("data");s.classList.add("selected"),this.setPreset(i),this.selectedPreset=s}))})),(0,a.Ay)("generative-expand-constraint").addEventListener("click",this.changeContraint,!1),(0,a.Ay)("toggle-generative-expand-constraint").addEventListener("click",this.changeContraint,!1),(0,a.Ay)("generative-expand-execute").addEventListener("click",this.execute,!1),this.selected=this.stage.fresco.getSelected(),this.size=new o.A(this.selected.rect.width,this.selected.rect.height),this.pos=new h.A(0,0);let e=(0,a.Ay)("generative-expand-width");e.addEventListener("input",this.widthHeightInputChange,!1),e.addEventListener("change",this.widthHeightInputChange,!1),e.addEventListener("blur",this.updateSizeInput,!1),e.value=this.size.width.toString();let s=(0,a.Ay)("generative-expand-height");s.addEventListener("change",this.widthHeightInputChange,!1),s.addEventListener("input",this.widthHeightInputChange,!1),s.addEventListener("blur",this.updateSizeInput,!1),s.value=this.size.height.toString(),new c.A((0,a.Ay)("generative-expand-settings")),new c.A((0,a.Ay)("generative-expand-preview")),new c.A((0,a.Ay)("generative-expand-result")),this.renderCreditAmount(),this.setPreview()}}},22220:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleGlamour")),this.setContent((0,n.T)("div",{id:"glamour-slider"})),new a.A("glamour-slider",{label:(0,o.A)("amount"),range:[0,1],step:.01,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("glamour",t)})}}},55098:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleGrain")),this.setContent((0,n.T)("div",{id:"grain-slider"})),new a.A("grain-slider",{label:(0,o.A)("amount"),range:[0,1],step:.01,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("grain",t)})}}},4380:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(42268),n=s(82042),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleHalftone")),this.setContent((0,a.T)("div",{id:"halftone-slider"}));const e=new n.A("halftone-slider",{label:(0,o.A)("frequency"),range:[.01,2],step:.01,defaultValue:.4,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("halftone",t)});setTimeout((()=>this.change("halftone",e.getValue())))}}},87971:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleHighlightsShadows")),this.kind="highlightsShadows",this.setContent((0,n.T)("div",{id:"highlight-slider"}),(0,n.T)("div",{id:"shadows-slider",className:"top-16"})),new a.A("highlight-slider",{label:(0,o.A)("highlights"),step:.01,range:[-2,2],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("highlights",t)}),new a.A("shadows-slider",{label:(0,o.A)("shadows"),step:.01,range:[-2,2],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("shadows",t)})}}},27983:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleHueSaturation")),this.range="main",this.selectRange=t=>{var e,s,i;let a=t.currentTarget,o=(0,n.Ay)("hue-swatches").getElementsByTagName("div");for(var r=0;r<o.length;r++)o[r].classList.remove("active");a.classList.add("active"),this.range=a.getAttribute("data-name");let h=null!==(e=this.shaders.getShaderValue("hue"+("main"!==this.range?"-"+this.range:"")))&&void 0!==e?e:0,l=null!==(s=this.shaders.getShaderValue("saturation"+("main"!==this.range?"-"+this.range:"")))&&void 0!==s?s:0,c=null!==(i=this.shaders.getShaderValue("lightness"+("main"!==this.range?"-"+this.range:"")))&&void 0!==i?i:0;this.hue.setValue(h),this.sat.setValue(l),this.lig.setValue(c)},this.kind="hueSaturation",this.setContent((0,n.T)("div",{id:"swatches-section"},(0,n.T)("label",{},(0,o.A)("range")),(0,n.T)("div",{id:"hue-swatches",className:"swatches top-4",style:"width:100%"})),(0,n.T)("div",{id:"hue"}),(0,n.T)("div",{id:"saturation",className:"top-16"}),(0,n.T)("div",{id:"lightness",className:"top-16"}),(0,n.T)("input",{type:"checkbox",id:"colorize"}),(0,n.T)("label",{className:"top-20 switch",htmlFor:"colorize"},(0,o.A)("colorize"),(0,n.T)("span"))),(0,n.Ay)("hue-swatches").innerHTML=`\n            <div class="active" data-name="main" flow="up" tooltip="${(0,o.A)("main")}" style="margin-right:15px;"><span class="ic" style="background-color: #ccc;"></span></div>\n            <div data-name="red" flow="up" tooltip="${(0,o.A)("red")}"><span style="background-color: #D1320E"></span></div>\n            <div data-name="yellow" flow="up" tooltip="${(0,o.A)("yellow")}"><span style="background-color: #bbb215"></span></div>\n            <div data-name="green" flow="up" tooltip="${(0,o.A)("green")}"><span style="background-color: #64ab24"></span></div>\n            <div data-name="cyan" flow="up" tooltip="${(0,o.A)("cyan")}"><span style="background-color: #3EB4BF"></span></div>\n            <div data-name="blue" flow="up" tooltip="${(0,o.A)("blue")}"><span style="background-color: #2F4DE6"></span></div>\n            <div data-name="magenta" flow="up" tooltip="${(0,o.A)("magenta")}"><span style="background-color: #BF3E8A"></span></div>\n        `;let e=(0,n.Ay)("hue-swatches").getElementsByTagName("div");for(let s=0;s<e.length;s++)e[s].addEventListener("click",this.selectRange,!1);this.hue=new a.A("hue",{label:(0,o.A)("hue"),range:[-180,180],step:1,labelFormat:t=>String(t),labelParse:t=>parseInt(t,10),onChange:t=>{this.isColorize?this.change("colorize",t+181):"main"===this.range?this.change("hue",t):this.change("hue-"+this.range,t)}}),this.sat=new a.A("saturation",{label:(0,o.A)("saturation"),step:.01,range:[-1,1],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>{"main"===this.range?this.change("saturation",t):this.change("saturation-"+this.range,t)}}),this.lig=new a.A("lightness",{label:(0,o.A)("lightness"),step:.01,range:[-1,1],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>{"main"===this.range?this.change("lightness",t):this.change("lightness-"+this.range,t)}}),(0,n.Ay)("colorize").addEventListener("click",(()=>{this.shaders.chain=[],this.isColorize=(0,n.Ay)("colorize").checked,(0,n.Ay)("swatches-section").style.display=this.isColorize?"none":"block",this.hue.setValue(0),this.sat.setValue(0),this.lig.setValue(0),this.change("colorize",this.isColorize?181:0)}))}}},26824:(t,e,s)=>{s.d(e,{A:()=>u});var i=s(21742),a=s(42268),n=s(54738),o=s(98244),r=s(82042),h=s(15818),l=s(23556),c=s(8689),d=s(2215);class u extends d.A{constructor(t){super(t,(0,i.A)("titleInnerGlow")),this.load=async()=>{const t=Promise.resolve().then(s.bind(s,82355)),e=n.D9();await e;const{distanceTransformInv:i}=await t,r=this.shaders.ctx,h=this.cache.getContext("2d").getImageData(0,0,this.cache.width,this.cache.height),l=i(this.cache.width,this.cache.height,h.data);if(!r.getSupportedExtensions().includes("OES_texture_float"))return alert("sorry, this filter requires float textures"),void(0,o.A)("OES_texture_float");r.getExtension("OES_texture_float");const c=r.createTexture();r.bindTexture(r.TEXTURE_2D,c),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.cache.width,this.cache.height,0,r.ALPHA,r.FLOAT,l),r.bindTexture(r.TEXTURE_2D,null),this.map=c,(0,a.Ay)("innerglow-loading").style.display="none",(0,a.Ay)("innerglow-controls").style.visibility="visible",this.enableApply(),this.update()},this.update=()=>{const t={size:this.size.getValue(),feather:this.feather.getValue(),opacity:this.opacity.getValue(),color:this.color.getColor(),distanceMap:this.map};this.change("inner-glow",t.size?t:null)},this.disableApply(),this.kind="innerGlow",this.shaders=new l.A,this.setContent((0,a.T)("div",{className:"dialog-loading"},(0,a.T)("div",{id:"innerglow-controls",className:"controls"},(0,a.T)("label",{className:"split"},(0,i.A)("color"),(0,a.T)("div",{id:"glow-color",className:"colod-pod"})),(0,a.T)("div",{id:"glow-size",className:"range-box top-15"}),(0,a.T)("div",{id:"glow-feather",className:"range-box top-10"}),(0,a.T)("div",{id:"glow-opacity",className:"range-box top-10"})),(0,a.T)("div",{id:"innerglow-loading",className:"message"},(0,a.T)("label",{className:"working"},(0,i.A)("loading"))))),this.color=new c.A("glow-color",h.A.fromHEX("#ffffff"),this.update,this.update),this.opacity=new r.A("glow-opacity",{label:(0,i.A)("opacity"),range:[0,1],defaultValue:1,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.size=new r.A("glow-size",{label:(0,i.A)("size"),range:[0,150],defaultValue:10,step:1,labelFormat:t=>`${t}px`,onChange:()=>this.update()}),this.feather=new r.A("glow-feather",{label:(0,i.A)("feather"),range:[0,1],defaultValue:.5,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.position(),this.load()}}},77441:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleInterference")),this.update=()=>{this.change("interference",{seed:this.seed.getValue(),amount:this.amount.getValue(),direction:(0,n.Ay)("interfer-direction").checked})},this.kind="interference",this.setContent((0,n.T)("div",{id:"interfer-seed"}),(0,n.T)("div",{id:"interfer-amount",className:"range-box top-16"}),(0,n.T)("input",{type:"checkbox",id:"interfer-direction"}),(0,n.T)("label",{className:"top-20 switch",htmlFor:"interfer-direction"},(0,o.A)("vertical"),(0,n.T)("span"))),this.seed=new a.A("interfer-seed",{label:(0,o.A)("seed"),range:[0,100],step:1,defaultValue:23,labelFormat:t=>String(t),onChange:t=>this.update()}),this.amount=new a.A("interfer-amount",{label:(0,o.A)("amount"),step:.01,range:[-1,1],defaultValue:.2,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.update()}),(0,n.Ay)("interfer-direction").addEventListener("click",(()=>{this.update()})),this.update()}}},69504:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(21742),a=s(54738),n=s(82042),o=s(2215);class r extends o.A{constructor(t){super(t,(0,i.A)("titleKaleidoscope")),this.update=()=>{a.sg("kaleidoscope",50,(()=>{const t={amount:this.amount.getValue(),stretch:this.stretch.getValue(),position:this.pos.getValue()};this.change("kaleidoscope",t)}))},this.setContent('\n             <div id="kaleidoscope-amount"></div>\n             <div id="kaleidoscope-stretch" class="top-16"></div>\n             <div id="kaleidoscope-position" class="top-16"></div>\n            '),this.amount=new n.A("kaleidoscope-amount",{label:(0,i.A)("amount"),range:[2,20],defaultValue:5,step:1,onChange:()=>this.update()}),this.stretch=new n.A("kaleidoscope-stretch",{label:"Stretch",range:[0,1],defaultValue:0,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.pos=new n.A("kaleidoscope-position",{label:"Position",range:[0,1],defaultValue:0,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.update()}}},2006:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(42268),a=s(21742),n=s(94711),o=s(2215);class r extends o.A{constructor(t){super(t,(0,a.A)("titleLevels")),this.selectChannelEvent=t=>{this.selectChannel(t.currentTarget.getAttribute("data-name"))},this.channel="",this.selectChannel=t=>{switch(this.channel&&((0,i.Ay)("channel-"+this.channel).classList.remove("active"),(0,i.Ay)("levels-graph-"+this.channel).classList.remove("active")),this.channel=t,(0,i.Ay)("channel-"+this.channel).classList.add("active"),(0,i.Ay)("levels-graph-"+this.channel).classList.add("active"),this.channel){case"all":this.aCM=this.all;break;case"red":this.aCM=this.red;break;case"green":this.aCM=this.green;break;case"blue":this.aCM=this.blue}this.setKnobs(),this.setInputs()},this.setKnobs=()=>{this.ikMin.style.left=this.aCM.minin+"px",this.ikMax.style.left=this.aCM.maxin+"px",this.ikMid.style.left=Math.floor((this.aCM.maxin-this.aCM.minin)*this.aCM.mid)+this.aCM.minin+"px",this.okMin.style.left=this.aCM.minout+"px",this.okMax.style.left=this.aCM.maxout+"px"},this.setInputs=()=>{this.ivMin.value=this.aCM.minin.toString(),this.ivMid.value=this.aCM.midin.toFixed(1),this.ivMax.value=this.aCM.maxin.toString(),this.ovMin.value=this.aCM.minout.toString(),this.ovMax.value=this.aCM.maxout.toString()},this.inputInput=t=>{let e=t.currentTarget.getAttribute("id"),s=Number(t.currentTarget.value);if(!isNaN(s)){switch(e){case"input-value-min":this.aCM.minin=Math.min(Math.max(s,0),this.aCM.maxin-10);break;case"input-value-mid":break;case"input-value-max":this.aCM.maxin=Math.min(Math.max(s,this.aCM.minin+10),255);break;case"output-value-min":this.aCM.minout=Math.min(Math.max(s,0),this.aCM.maxout-10);break;case"output-value-max":this.aCM.maxout=Math.min(Math.max(s,this.aCM.minout+10),255)}this.setKnobs(),this.levelChange()}},this.analyzeImage=()=>{let t,e,s,a=this.cache.width,n=this.cache.height,o=this.cache.getContext("2d").getImageData(0,0,a,n).data,r=new Uint32Array(256),h=new Uint32Array(256),l=new Uint32Array(256),c=new Uint32Array(256);for(let i=0,d=o.length;i<d;i+=4)o[i+3]>0&&(t=o[i],e=o[i+1],s=o[i+2],c[t]+=1,c[e]+=1,c[s]+=1,r[t]+=1,h[e]+=1,l[s]+=1);this.drawChannel(c,(0,i.Ay)("levels-graph-all"),"rgba(180, 180, 180, 1)"),this.drawChannel(r,(0,i.Ay)("levels-graph-red"),"rgba(209, 72, 14, 1)"),this.drawChannel(h,(0,i.Ay)("levels-graph-green"),"rgba(146, 156, 31, 1)"),this.drawChannel(l,(0,i.Ay)("levels-graph-blue"),"rgba(58, 110, 154, 1)")},this.drawChannel=(t,e,s)=>{for(var i=new Array(0,0,0,0),a=0;a<t.length;++a)i[0]<t[a]?i[0]=t[a]:i[1]<t[a]?i[1]=t[a]:i[2]<t[a]?i[2]=t[a]:i[3]<t[a]&&(i[3]=t[a]);let n=i.sort((function(t,e){return t-e}))[0],o=e.getContext("2d");o.save(),o.lineWidth=2,o.strokeStyle=s,o.fillStyle=s,o.beginPath(),o.moveTo(0,128),o.lineTo(0,128);for(var r=0;r<256;++r){let e=Math.min(Math.round(t[r]/n*128),128);o.lineTo(r,128-e)}o.lineTo(256,128),o.closePath(),o.stroke(),o.globalAlpha=.7,o.fill(),o.restore()},this.touchStart=t=>{t.preventDefault(),t.stopPropagation(),this.down(t.changedTouches[0].clientX,t.changedTouches[0].clientY,t.currentTarget),document.addEventListener("touchmove",this.touchMove,{passive:!0}),document.addEventListener("touchend",this.touchEnd,{passive:!0})},this.touchMove=t=>{t.preventDefault(),t.stopPropagation(),this.move(t.changedTouches[0].clientX,t.changedTouches[0].clientY)},this.touchEnd=t=>{t.preventDefault(),t.stopPropagation(),document.removeEventListener("touchmove",this.touchMove),document.removeEventListener("touchend",this.touchEnd)},this.mouseDown=t=>{t.stopPropagation(),this.down(t.clientX,t.clientY,t.currentTarget),document.addEventListener("mousemove",this.mouseMove,!0),document.addEventListener("mouseup",this.mouseUp,!0)},this.mouseMove=t=>{t.stopPropagation(),this.move(t.clientX,t.clientY)},this.mouseUp=t=>{t.stopPropagation(),document.removeEventListener("mousemove",this.mouseMove,!0),document.removeEventListener("mouseup",this.mouseUp,!0)},this.down=(t,e,s)=>{switch(this.downX=t,this.target=s.getAttribute("id"),this.target){case"input-knob-min":this.start=this.aCM.minin;break;case"input-knob-mid":this.start=s.offsetLeft;break;case"input-knob-max":this.start=this.aCM.maxin;break;case"output-knob-min":this.start=this.aCM.minout;break;case"output-knob-max":this.start=this.aCM.maxout}},this.move=(t,e)=>{let s=this.start+(t-this.downX);switch(this.target){case"input-knob-min":this.aCM.minin=Math.min(Math.max(s,0),this.aCM.maxin-10);break;case"input-knob-mid":this.aCM.setMid(Math.min(Math.max(s,this.aCM.minin+5),this.aCM.maxin-5));break;case"input-knob-max":this.aCM.maxin=Math.min(Math.max(s,this.aCM.minin+10),255);break;case"output-knob-min":this.aCM.minout=Math.min(Math.max(s,0),this.aCM.maxout-10);break;case"output-knob-max":this.aCM.maxout=Math.min(Math.max(s,this.aCM.minout+10),255)}this.setKnobs(),this.setInputs(),this.levelChange()},this.levelChange=()=>{this.shaders.addShader("levels",this.all),this.shaders.addShader("multilevels",this.red.isFlat()&&this.green.isFlat()&&this.blue.isFlat()?null:[this.red,this.green,this.blue]),setTimeout((()=>{this.scratch.canvas=this.shaders.apply(this.cache),window.requestAnimationFrame((()=>this.stage.render()))}),0)},this.cleanUp=()=>{(0,i.Ay)("levels-swatches").querySelectorAll("div").forEach((t=>{t.removeEventListener("click",this.selectChannelEvent,!1)})),(0,i.Ay)("levels-overlay").querySelectorAll("input").forEach((t=>{t.removeEventListener("input",this.inputInput,!1),t.removeEventListener("blur",this.setInputs,!1)})),this.stage.fresco.removeScratch(),document.removeEventListener("keydown",this.keyDown,!1),this.stage.coating.freeze(!1),this.stage.render(),this.shaders.cleanUp(),this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.kind="levels",this.dialog.style.width="380px",this.dialog.style.maxWidth="380px",this.content.style.paddingBottom="4px",this.setContent(`\n            <div id="levels-holder">      \n                <div id="levels-swatches" class="swatches">\n                    <div data-name="all" id="channel-all" flow="left" tooltip="${(0,a.A)("main")}"><span class="ic" style="background-color: #ccc"></span></div>\n                    <div data-name="red" id="channel-red" flow="left" tooltip="${(0,a.A)("red")}"><span style="background-color: #d1480e;"></span></div>\n                    <div data-name="green" id="channel-green" flow="left" tooltip="${(0,a.A)("green")}"><span style="background-color:#929C1F;"></span></div>\n                    <div data-name="blue" id="channel-blue" flow="left" tooltip="${(0,a.A)("blue")}"><span style="background-color: #3a6e9a"></span></div>\n                </div>\n                <div id="levels-overlay">\n                    <div id="levels-input">\n                        <canvas class="levels-graph" width="256" height="128" unselectable="on" id="levels-graph-all"></canvas>\n                        <canvas class="levels-graph" width="256" height="128" unselectable="on" id="levels-graph-red"></canvas>\n                        <canvas class="levels-graph" width="256" height="128" unselectable="on" id="levels-graph-green"></canvas>\n                        <canvas class="levels-graph" width="256" height="128" unselectable="on" id="levels-graph-blue"></canvas>\n                        <div class="knob" id="input-knob-min"><div class="bg ic"></div></div>\n                        <div class="knob" id="input-knob-mid"><div class="bg ic"></div></div>\n                        <div class="knob" id="input-knob-max"><div class="bg ic"></div></div>\n                    </div>\n                    <div id="levels-input-values">\n                        <input type="number" id="input-value-min" value="0">\n                        <input type="number" id="input-value-mid" value="1.0">\n                        <input type="number" id="input-value-max" value="255">\n                    </div>\n                    <div id="levels-output" class="top-10">\n                        <div id="slide"></div>\n                        <div class="knob" id="output-knob-min"><div class="bg ic"></div></div>\n                        <div class="knob" id="output-knob-max"><div class="bg ic"></div></div>\n                    </div>\n                    <div id="levels-output-values">\n                        <input type="number" id="output-value-min" value="0">\n                        <input type="number" id="output-value-max" value="255">\n                    </div>\n                </div>\n            </div>\n        `),(0,i.Ay)("levels-swatches").querySelectorAll("div").forEach((t=>{t.addEventListener("click",this.selectChannelEvent,!1)})),(0,i.Ay)("levels-overlay").querySelectorAll("input").forEach((t=>{t.addEventListener("input",this.inputInput,!1),t.addEventListener("blur",this.setInputs,!1)})),this.ivMin=(0,i.Ay)("input-value-min"),this.ivMid=(0,i.Ay)("input-value-mid"),this.ivMax=(0,i.Ay)("input-value-max"),this.ovMin=(0,i.Ay)("output-value-min"),this.ovMax=(0,i.Ay)("output-value-max"),this.ikMin=(0,i.Ay)("input-knob-min"),this.ikMid=(0,i.Ay)("input-knob-mid"),this.ikMax=(0,i.Ay)("input-knob-max"),this.okMin=(0,i.Ay)("output-knob-min"),this.okMax=(0,i.Ay)("output-knob-max"),this.ikMin.addEventListener("mousedown",this.mouseDown,!0),this.ikMid.addEventListener("mousedown",this.mouseDown,!0),this.ikMax.addEventListener("mousedown",this.mouseDown,!0),this.okMin.addEventListener("mousedown",this.mouseDown,!0),this.okMax.addEventListener("mousedown",this.mouseDown,!0),this.ikMin.addEventListener("touchstart",this.touchStart,{passive:!0}),this.ikMid.addEventListener("touchstart",this.touchStart,{passive:!0}),this.ikMax.addEventListener("touchstart",this.touchStart,{passive:!0}),this.okMin.addEventListener("touchstart",this.touchStart,{passive:!0}),this.okMax.addEventListener("touchstart",this.touchStart,{passive:!0}),this.all=new n.A,this.red=new n.A,this.green=new n.A,this.blue=new n.A,this.analyzeImage(),this.selectChannel("all")}}},78360:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(2215),a=s(82042),n=s(42268),o=s(54738),r=s(21742);class h extends i.A{constructor(t){super(t,(0,r.A)("titleMimicHDR")),this.createBlurMap=()=>{this.shaders.addShader("blur",1),this.shaders.addShader("invert",1),this.shaders.addShader("desaturate",1),this.blurmap=o.oM(this.shaders.apply(this.cache)),this.shaders.reset()},this.update=o.eD(10,(()=>{this.change("mimichdr",0===this.amount.getValue()?0:{amount:this.amount.getValue(),contra:this.contra.getValue(),blurMap:this.blurmap})})),this.kind="mimicHDR",this.setContent((0,n.T)("div",{id:"mimichdr-amount"}),(0,n.T)("div",{id:"mimichdr-contra"})),this.amount=new a.A("mimichdr-amount",{label:(0,r.A)("amount"),range:[0,1],step:.01,defaultValue:.5,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.update()}),this.contra=new a.A("mimichdr-contra",{label:(0,r.A)("contrast"),range:[0,1],step:.01,defaultValue:.2,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.update()}),this.createBlurMap(),this.update()}}},66544:(t,e,s)=>{s.d(e,{A:()=>o});var i=s(2215),a=s(42268),n=s(21742);class o extends i.A{constructor(t){super(t,(0,n.A)("titleMonochrome")),this.setValue=(t,e,s)=>{this.mRed.style.height=Math.round(24+100*t)+"px",this.mGreen.style.height=Math.round(24+100*e)+"px",this.mBlue.style.height=Math.round(24+100*s)+"px",(0,a.Ay)("monochrome-red").innerText="R: "+(100*t).toFixed(1)+"%",(0,a.Ay)("monochrome-green").innerText="G: "+(100*e).toFixed(1)+"%",(0,a.Ay)("monochrome-blue").innerText="B: "+(100*s).toFixed(1)+"%",this.update(t,e,s)},this.update=(t,e,s)=>{this.change("monochrome",{r:t,g:e,b:s})},this.dialog.style.width="440px",this.dialog.style.maxWidth="440px",this.mRed=(0,a.T)("div",{style:"background-color:#d1480e;"}),this.mGreen=(0,a.T)("div",{style:"background-color:#929C1F;"}),this.mBlue=(0,a.T)("div",{style:"background-color:#3a6e9a;"}),this.content.classList.add("flex");var e=(0,a.T)("div",{style:"margin-top:2px",className:"select"});e.innerHTML='\n            <select id="monochrome-preset">\n                <option value="0.299:0.587:0.114" selected>Rec601 Luma (Vision)</option>\n                <option value="0.2126:0.7152:0.0722">sRGB ITU-R BT.709</option>\n                <option value="0.2627:0.6780:0.0593">HDR ITU-R BT.2100</option>\n                <option value="0.3333333:0.3333334:0.3333333">Unweighted</option>\n                <option value="1:0:0">Red</option>\n                <option value="0:1:0">Green</option>\n                <option value="0:0:1">Blue</option>\n                <option value="0.18:0.41:0.41">Agfa 200X</option>\n                <option value="0.25:0.39:0.36">Agfapan 25</option>\n                <option value="0.21:0.40:0.39">Agfapan 100</option>\n                <option value="0.20:0.41:0.39">Agfapan 400</option>\n                <option value="0.21:0.42:0.37">Ilford Delta 100 & XP2 Super</option>\n                <option value="0.22:0.42:0.36">Ilford Delta 400</option>\n                <option value="0.31:0.36:0.33">Ilford Delta 400 Pro & 3200</option>\n                <option value="0.28:0.41:0.31">Ilford FP4</option>\n                <option value="0.23:0.37:0.40">Ilford HP5</option>\n                <option value="0.33:0.36:0.31">Ilford Pan F</option>\n                <option value="0.36:0.31:0.33">Ilford SFX</option>\n                <option value="0.21:0.42:0.37">Ilford</option>\n                <option value="0.24:0.37:0.39">Kodak Tmax 100</option>\n                <option value="0.27:0.36:0.37">Kodak Tmax 400</option>\n                <option value="0.25:0.35:0.40">Kodak Tri-X</option>\n                <option value="0.5:0.5:0">Red Green</option>\n                <option value="0:0.5:0.5:">Green Blue</option>\n                <option value="0.5:0:0.5:">Blue Red</option>\n            </select>\n        ';let s=(0,a.T)("div",{style:"margin:10px 20px;opacity:0.7",className:"flex"});s.innerHTML='\n            <div id="monochrome-red">R: </div>\n            <div id="monochrome-green">G: </div>\n            <div id="monochrome-blue">B: </div>\n        ',this.setContent((0,a.T)("div",{style:"position:relative;margin-top:20px;margin-bottom:30px;margin-left:10px;margin-right:5px;"},(0,a.T)("div",{className:"swatch-slider"},this.mRed),(0,a.T)("div",{className:"swatch-slider"},this.mGreen),(0,a.T)("div",{className:"swatch-slider"},this.mBlue)),(0,a.T)("div",{style:"flex-grow:1;margin:20px"},(0,a.T)("label",{},(0,n.A)("preset")),e,s)),(0,a.Ay)("monochrome-preset").addEventListener("change",(()=>{let t=(0,a.Ay)("monochrome-preset").value.split(":");this.setValue(Number(t[0]),Number(t[1]),Number(t[2]))})),this.setValue(.299,.587,.114)}}},72617:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleMosaic")),this.setContent((0,n.T)("div",{id:"mosaic-slider"})),new a.A("mosaic-slider",{label:(0,o.A)("amount"),range:[0,1],step:.01,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("mosaic",t)})}}},93354:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(2215),a=s(82042),n=s(42268),o=s(54738),r=s(21742);class h extends i.A{constructor(t){super(t,(0,r.A)("titleMotionBlur")),this.update=()=>{o.sg("motion-blur",50,(()=>{const t={amount:this.amount.getValue(),angle:this.angle.getValue()*(Math.PI/1.8)};this.change("motion",t.amount?t:void 0)}))},this.setContent((0,n.T)("div",{id:"motion-amount"}),(0,n.T)("div",{id:"motion-angle"})),this.amount=new a.A("motion-amount",{label:(0,r.A)("amount"),range:[0,1],step:.05,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.angle=new a.A("motion-angle",{label:(0,r.A)("angle"),step:.01,range:[0,3.6],defaultValue:0,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.update()}),this.update()}}},54907:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleNoise")),this.setContent((0,n.T)("div",{id:"noise-slider"})),new a.A("noise-slider",{label:(0,o.A)("amount"),range:[0,1],step:.01,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("noise",t)})}}},49143:(t,e,s)=>{s.d(e,{A:()=>u});var i=s(21742),a=s(54738),n=s(42268),o=s(98244),r=s(2215),h=s(82042),l=s(15818),c=s(8689),d=s(40963);class u extends r.A{constructor(t){const e=t.fresco.getSelected(),r=new d.A(0,0,t.fresco.width,t.fresco.height),u=e.settings.locked&&e.rect.equalTo(r)?0:150;super(t,(0,i.A)("titleOuterGlow"),!1,!1,u),this.load=async()=>{const t=Promise.resolve().then(s.bind(s,82355)),e=a.D9();await e;const{distanceTransform:i}=await t,r=this.shaders.ctx,h=this.cache.getContext("2d").getImageData(0,0,this.cache.width,this.cache.height),l=i(this.cache.width,this.cache.height,h.data);if(!r.getSupportedExtensions().includes("OES_texture_float"))return alert("sorry, this filter requires float textures"),void(0,o.A)("OES_texture_float");r.getExtension("OES_texture_float");const c=r.createTexture();r.bindTexture(r.TEXTURE_2D,c),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.cache.width,this.cache.height,0,r.ALPHA,r.FLOAT,l),r.bindTexture(r.TEXTURE_2D,null),this.map=c,(0,n.Ay)("outerglow-loading").style.display="none",(0,n.Ay)("outerglow-controls").style.visibility="visible",this.enableApply(),this.update()},this.update=()=>{const t={size:this.size.getValue(),feather:this.feather.getValue(),opacity:this.opacity.getValue(),color:this.color.getColor(),distanceMap:this.map};this.shaders.addShader("outer-glow",t.size?t:null),window.requestAnimationFrame((()=>{this.scratch.canvas=this.shaders.apply(this.cache),this.stage.render()}))},this.apply=()=>{const t=this.stage.fresco.getSelected(),e=a.TL(a.oM(this.scratch.canvas)).rebase(-this.scratch.rect.x,-this.scratch.rect.y),s=a.ON(t.canvas,e.rebase(t.rect.x,t.rect.y)),i=a.oM(t.mask),n=t.rect.clone();t.extendCanvas(e),this.scratch.drawToLayer(t),t.render(),this.stage.fresco.removeScratch(),this.stage.history.add({type:"bitmapChange",kind:"outerGlow",layer:t,rect:n,patchRect:e.rebase(t.rect.x,t.rect.y),patch:s,mask:i}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.cleanUp()},this.cancel=()=>{this.stage.fresco.removeScratch(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.cleanUp()},this.disableApply(),this.setContent((0,n.T)("div",{className:"dialog-loading"},(0,n.T)("div",{id:"outerglow-controls",className:"controls"},(0,n.T)("label",{className:"split"},(0,i.A)("color"),(0,n.T)("div",{id:"glow-color"})),(0,n.T)("div",{id:"glow-size",className:"range-box top-15"}),(0,n.T)("div",{id:"glow-feather",className:"range-box top-10"}),(0,n.T)("div",{id:"glow-opacity",className:"range-box top-10"})),(0,n.T)("div",{id:"outerglow-loading",className:"message"},(0,n.T)("label",{className:"working"},(0,i.A)("loading"))))),this.color=new c.A("glow-color",l.A.fromHEX("#ffffff"),this.update,this.update),this.opacity=new h.A("glow-opacity",{label:(0,i.A)("opacity"),range:[0,1],defaultValue:1,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.size=new h.A("glow-size",{label:(0,i.A)("size"),range:[0,150],defaultValue:15,step:1,labelFormat:t=>`${t}px`,onChange:()=>this.update()}),this.feather=new h.A("glow-feather",{label:(0,i.A)("feather"),range:[0,1],defaultValue:.5,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.position(),this.load()}}},28329:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titlePixelate")),this.setContent((0,n.T)("div",{id:"pixelate-slider"})),new a.A("pixelate-slider",{label:(0,o.A)("amount"),range:[0,1],step:.01,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("pixelate",t)})}}},35722:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titlePolarCoordinates")),this.update=()=>{this.change("polarcoordinates",{rotate:this.rotate.getValue()*(Math.PI/1.8),overlap:this.overlap.getValue()*(Math.PI/2),flip:(0,n.Ay)("polarcoordinates-flip").checked,symmetry:(0,n.Ay)("polarcoordinates-symmetry").checked})},this.setContent((0,n.T)("div",{id:"polarcoordinates-rotate"}),(0,n.T)("div",{id:"polarcoordinates-overlap",className:"range-box top-16"}),(0,n.T)("input",{type:"checkbox",id:"polarcoordinates-flip"}),(0,n.T)("label",{className:"top-20 switch",htmlFor:"polarcoordinates-flip"},(0,o.A)("flip"),(0,n.T)("span")),(0,n.T)("input",{type:"checkbox",id:"polarcoordinates-symmetry"}),(0,n.T)("label",{className:"top-20 switch",htmlFor:"polarcoordinates-symmetry"},(0,o.A)("symmetry"),(0,n.T)("span"))),this.rotate=new a.A("polarcoordinates-rotate",{label:(0,o.A)("rotate"),step:.01,range:[0,3.6],defaultValue:0,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.update()}),this.overlap=new a.A("polarcoordinates-overlap",{label:(0,o.A)("overlap"),step:.01,range:[0,1],defaultValue:0,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.update()}),(0,n.Ay)("polarcoordinates-flip").addEventListener("click",(()=>{this.update()})),(0,n.Ay)("polarcoordinates-symmetry").addEventListener("click",(()=>{this.update()})),this.update()}}},18252:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titlePosterize")),this.setContent((0,n.T)("div",{id:"posterize-slider"})),new a.A("posterize-slider",{label:(0,o.A)("colors"),range:[0,.3],step:.01,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("posterize",t)})}}},16499:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(42268),a=s(21742),n=s(26806),o=s(29755);class r extends n.A{constructor(t){super((0,a.A)("titlePreferences"),!0),this.stage=t,this.getLanguage=()=>{const t=location.pathname.split("/");return t[1]&&2===t[1].length?t[1]:"us"},this.setLanguage=t=>{const e=location.pathname.split("/");e[1]&&2===e[1].length?e[1]=t:e.splice(1,0,t),location.href=e.join("/")},this.dialog.style.maxWidth="440px",this.setContent(`\n\n                <label class="split" for="settings-language">${(0,a.A)("language")}\n                <div class="select top-0" style="width:auto">\n                    <select id="settings-language">\n                        <option value="us">English</option>\n                        <option value="id">Bahasa Indonesia</option>\n                        <option value="ml">Bahasa Melayu</option>\n                        <option value="cz">Čeština</option>\n                        <option value="dk">Dansk</option>\n                        <option value="de">Deutsch</option>\n                        <option value="es">Español</option>\n                        <option value="ph">Filipino</option>\n                        <option value="fr">Français</option>\n                        <option value="hr">Hrvatski</option>\n                        <option value="it">Italiano</option>\n                        <option value="nl">Nederlands</option>\n                        <option value="no">Norsk</option>\n                        <option value="pl">Polski</option>\n                        <option value="pt">Português</option>\n                        <option value="br">Português (Brasileiro)</option>\n                        <option value="ro">Romanian</option>\n                        <option value="rs">Србија</option>\n                        <option value="ru">Русский</option>\n                        <option value="fi">Suomi</option>\n                        <option value="se">Svenska</option>\n                        <option value="tr">Türkçe</option>\n                        <option value="vn">Tiếng Việt</option>\n                        <option value="th">ไทย</option>\n                        <option value="gr">Ελληνικά</option>\n                        <option value="kr">한국어</option>\n                        <option value="jp">日本語</option>\n                        <option value="cn">中文</option>\n                        <option value="tw">繁體中文</option>\n                    </select> \n                </div>\n            </label>\n\n            <div class="splitter small top-10"></div>\n\n            <label class=" top-10">${(0,a.A)("viewOBarAccent")}</label>\n            <div id="preference-accent" class="top-4 color-pod-list" style="gap:3px;">\n                <div class="color-pod small" data="ash" style="background-color:#383E42"></div>\n                <div class="color-pod small" data="brown" style="background-color:#715649"></div>\n                <div class="color-pod small" data="coral" style="background-color:#F3764C"></div>\n                <div class="color-pod small" data="pink" style="background-color:#F17686"></div>\n                <div class="color-pod small" data="rose" style="background-color:#FE5151"></div>\n                <div class="color-pod small" data="red" style="background-color:#BA2B46"></div>\n                <div class="color-pod small" data="plum" style="background-color:#5A354F"></div>\n                <div class="color-pod small" data="maroon" style="background-color:#A82068"></div>\n                <div class="color-pod small" data="purple" style="background-color:#7D4199"></div>\n                <div class="color-pod small" data="lavender" style="background-color:#6D5DD2"></div>\n                <div class="color-pod small" data="denim" style="background-color:#496171"></div>\n                <div class="color-pod small" data="blue" style="background-color:#0099CC"></div>\n                <div class="color-pod small" data="teal" style="background-color:#00A5A5"></div>\n                <div class="color-pod small" data="green" style="background-color:#48B07B"></div>\n                <div class="color-pod small" data="lime" style="background-color:#95C20F"></div>\n                <div class="color-pod small" data="mustard" style="background-color:#F5BB00"></div>\n            </div>\n\n            <label class="top-16">${(0,a.A)("viewOBarWorkspace")}</label>\n            <div id="preference-workspace" class="color-selector-presets extended top-4" style="width:200px">\n                <div data="dark" class="color-pod square" style="background-color: #232529"></div>\n                <div data="iron" class="color-pod square" style="background-color: #606060"></div>\n                <div data="steel" class="color-pod square" style="background-color: #999999"></div>\n                <div data="light" class="color-pod square" style="background-color: #cccccc"></div>\n            </div>\n\n            <a id="preference-theme-reset" class="link top-20" style="display:inline-block;">${(0,a.A)("reset")}</a>\n\n            <div class="splitter small top-16"></div>\n\n            <input type="checkbox" id="setting-performance-mode" />\n            <label class="switch top-16" for="setting-performance-mode">${(0,a.A)("viewOBarPerformanceMode")}<span></span></label>\n\n            <input type="checkbox" id="setting-use-legacy-save" />\n            <label class="switch top-10" for="setting-use-legacy-save">${(0,a.A)("viewOBarUseLegacySave")}<span></span></label>\n\n            <input type="checkbox" id="setting-ask-preresize" />\n            <label class="switch top-20" for="setting-ask-preresize">${(0,a.A)("viewOBarAskPrerezise")}<span></span></label>\n            <input type="checkbox" id="setting-guides" />\n            <label class="switch top-10" for="setting-guides">${(0,a.A)("viewOBarShowGu")}<span></span></label>\n            <input type="checkbox" id="settings-snap-to" />\n            <label class="switch top-10" for="settings-snap-to">${(0,a.A)("viewOBarSnap")}<span></span></label>\n\n            <label class="split top-10" for="settings-scroll-mode">${(0,a.A)("viewOBarScollMode")}\n                <div class="select top-0" style="width:auto">\n                    <select id="settings-scroll-mode">\n                        <option value="zoom">${(0,a.A)("zoom")}</option>\n                        <option value="move">${(0,a.A)("move")}</option>\n                        <option value="none">${(0,a.A)("none")}</option>\n                    </select> \n                </div>\n            </label>\n        `);let e=o.Ay.accent,s=(0,i.Ay)("preference-accent").getElementsByTagName("div");for(var n=0;n<s.length;n+=1)s[n].addEventListener("click",(t=>{document.documentElement.classList.remove(e),e=t.currentTarget.getAttribute("data"),document.documentElement.classList.add(e),document.dispatchEvent(new CustomEvent("layerlist-update")),(0,o.ZC)("accent",e)}));let r=o.Ay.workspace,h=(0,i.Ay)("preference-workspace").getElementsByTagName("div");for(n=0;n<h.length;n+=1)h[n].addEventListener("click",(t=>{document.documentElement.classList.remove(r),r=t.currentTarget.getAttribute("data"),document.documentElement.classList.add(r),(0,o.ZC)("workspace",r),this.stage.createBGPattern(),this.stage.render()}));(0,i.Ay)("preference-theme-reset").addEventListener("click",(()=>{(0,o.ZC)("workspace","default"),(0,o.ZC)("accent","default"),document.documentElement.className="",this.stage.createBGPattern(),this.stage.render()}));const l=(0,i.Ay)("settings-language");l.value=this.getLanguage(),l.onchange=()=>this.setLanguage(l.value);const c=(0,i.Ay)("setting-performance-mode");c.checked=o.Ay.performanceMode,c.onchange=()=>(0,o.ZC)("performanceMode",c.checked);const d=(0,i.Ay)("setting-use-legacy-save");d.checked=o.Ay.useLegacySave,d.onchange=()=>(0,o.ZC)("useLegacySave",d.checked);const u=(0,i.Ay)("setting-ask-preresize");u.checked=o.Ay.askToPreResize,u.onchange=()=>(0,o.ZC)("askToPreResize",u.checked);const p=(0,i.Ay)("setting-guides");p.checked=o.Ay.showGuides,p.onchange=()=>(0,o.ZC)("showGuides",p.checked);const g=(0,i.Ay)("settings-snap-to");g.checked=o.Ay.snapToGuides,g.onchange=()=>(0,o.ZC)("snapToGuides",g.checked);const m=(0,i.Ay)("settings-scroll-mode");m.value=o.Ay.scrollMode,m.onchange=()=>(0,o.ZC)("scrollMode",m.value),(0,i.Ay)("dialog-apply"+this.mid).style.display="none",(0,i.Ay)("dialog-cancel"+this.mid).innerText=(0,a.A)("close")}}},14887:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(2215),a=s(82042),n=s(42268),o=s(21742),r=s(54738);class h extends i.A{constructor(t){super(t,(0,o.A)("titleRadialBlur")),this.update=r.eD(50,(()=>{const t=Number(document.querySelector('input[name="direction"]:checked').value),e={amount:this.amount.getValue(),x:this.x.getValue(),y:this.y.getValue(),direction:t,symmetry:(0,n.Ay)("radial-symmetry").checked};this.change("radial",e.amount?e:void 0)})),this.setContent(`\n             <label>Direction</label>\n             <div class="switch-field top-5">\n                 <input type="radio" id="direction-cw" name="direction" value="0" checked/><label for="direction-cw">${(0,o.A)("right")}</label>\n                 <input type="radio" id="direction-ccw" name="direction" value="1"/><label for="direction-ccw">${(0,o.A)("left")}</label>\n                 <input type="radio" id="direction-bi" name="direction" value="2"/><label for="direction-bi">${(0,o.A)("both")}</label>\n             </div>\n             <div id="radial-amount" class="top-20"></div>\n             <div id="radial-x" class="top-16"></div>\n             <div id="radial-y" class="top-16"></div>\n             <input type="checkbox" id="radial-symmetry">\n             <label class="top-20 switch" for="radial-symmetry">${(0,o.A)("symmetry")}<span></span></label>\n             `),this.amount=new a.A("radial-amount",{label:(0,o.A)("amount"),range:[0,1],step:.01,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.x=new a.A("radial-x",{label:"X",range:[0,1],defaultValue:.5,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.y=new a.A("radial-y",{label:"Y",range:[0,1],defaultValue:.5,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),(0,n.Ay)("direction-cw").addEventListener("change",this.update,!1),(0,n.Ay)("direction-ccw").addEventListener("change",this.update,!1),(0,n.Ay)("direction-bi").addEventListener("change",this.update,!1),(0,n.Ay)("radial-symmetry").addEventListener("click",(()=>{this.update()})),this.update()}}},11980:(t,e,s)=>{s.d(e,{A:()=>o});var i=s(21742),a=s(82042),n=s(2215);class o extends n.A{constructor(t){super(t,(0,i.A)("titleReflect")),this.changeX=()=>{const t=Number(document.querySelector('input[name="reflect-type"]:checked').value);10!=t&&11!=t||this.y.setValue(1-this.x.getValue()),9!=t&&12!=t||this.y.setValue(this.x.getValue()),this.update()},this.changeY=()=>{const t=Number(document.querySelector('input[name="reflect-type"]:checked').value);9!=t&&12!=t||this.x.setValue(this.y.getValue()),10!=t&&11!=t||this.x.setValue(1-this.y.getValue()),this.update()},this.changeType=()=>{const t=Number(document.querySelector('input[name="reflect-type"]:checked').value);1==t||3==t?(this.x.enable(),this.xo.enable(),this.y.disable(),this.yo.disable(),this.y.reset(),this.yo.reset()):2==t||4==t?(this.x.disable(),this.xo.disable(),this.y.enable(),this.yo.enable(),this.x.reset(),this.xo.reset()):(this.x.enable(),this.y.enable(),this.xo.enable(),this.yo.enable()),this.update()},this.update=()=>{const t=Number(document.querySelector('input[name="reflect-type"]:checked').value);this.change("reflect",{type:t,x:this.x.getValue(),y:this.y.getValue(),xo:this.xo.getValue(),yo:this.yo.getValue()})},this.setContent(`\n                <label>${(0,i.A)("type")}</label>\n                <div class="switch-icon-field" style="display:flex">\n                    <input type="radio" id="reflect-type-minus-x" name="reflect-type" value="1" checked="true" /><label for="reflect-type-minus-x"><img src="/img/icon/reflect-t1.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-plus-y" name="reflect-type" value="4" /><label for="reflect-type-plus-y"><img src="/img/icon/reflect-t2.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-plus-x" name="reflect-type" value="3" /><label for="reflect-type-plus-x"><img src="/img/icon/reflect-t3.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-minus-y" name="reflect-type" value="2" /><label for="reflect-type-minus-y"><img src="/img/icon/reflect-t4.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-minus-x-minus-y" name="reflect-type" value="5" /><label for="reflect-type-minus-x-minus-y"><img src="/img/icon/reflect-t5.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-minus-x-plus-y" name="reflect-type" value="6" /><label for="reflect-type-minus-x-plus-y"><img src="/img/icon/reflect-t6.svg" class="ic" width="20" height="20"/></label>\n                </div>\n                <div class="switch-icon-field" style="display:flex;margin-top:4px">\n                    <input type="radio" id="reflect-type-plus-x-plus-y" name="reflect-type" value="7" /><label for="reflect-type-plus-x-plus-y"><img src="/img/icon/reflect-t7.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-plus-x-minus-y" name="reflect-type" value="8" /><label for="reflect-type-plus-x-minus-y"><img src="/img/icon/reflect-t8.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-above-x-equalto-y" name="reflect-type" value="9" /><label for="reflect-type-above-x-equalto-y"><img src="/img/icon/reflect-t9.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-below-x-equalto-minus-y" name="reflect-type" value="10" /><label for="reflect-type-below-x-equalto-minus-y"><img src="/img/icon/reflect-t10.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-above-x-equalto-minus-y" name="reflect-type" value="11" /><label for="reflect-type-above-x-equalto-minus-y"><img src="/img/icon/reflect-t11.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-below-x-equalto-y" name="reflect-type" value="12" /><label for="reflect-type-below-x-equalto-y"><img src="/img/icon/reflect-t12.svg" class="ic" width="20" height="20"/></label>\n                </div>\n                <div id="reflect-x" class="top-20"></div>\n                <div id="reflect-offset-x" class="top-10"></div>\n                <div id="reflect-y" class="top-20"></div>\n                <div id="reflect-offset-y" class="top-10"></div>\n            `),this.x=new a.A("reflect-x",{label:(0,i.A)("horizontal"),range:[0,1],defaultValue:.5,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.changeX()}),this.xo=new a.A("reflect-offset-x",{label:(0,i.A)("offset"),range:[-.5,.5],defaultValue:0,step:.001,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.changeX()}),this.y=new a.A("reflect-y",{label:(0,i.A)("vertical"),range:[0,1],defaultValue:.5,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.changeY()}),this.yo=new a.A("reflect-offset-y",{label:(0,i.A)("offset"),range:[-.5,.5],defaultValue:0,step:.001,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.changeY()}),document.querySelectorAll('input[name="reflect-type"]').forEach((t=>t.addEventListener("change",this.changeType))),this.changeType()}}},66496:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleRGBSplit")),this.type="red-blue",this.selectSwatch=t=>{(0,n.Ay)("split-"+this.type).classList.remove("active");let e=t.currentTarget;this.type=e.getAttribute("data"),e.classList.add("active"),this.update()},this.update=()=>{this.change("rgb-split",{distance:this.distance.getValue()/20,amount:this.amount.getValue(),direction:this.direction.getValue(),type:this.type})},this.kind="rgbSplit",this.setContent((0,n.T)("div",{id:"split-distance"}),(0,n.T)("div",{id:"split-direction",className:"range-box top-16"}),(0,n.T)("div",{id:"split-amount",className:"range-box top-16"})),this.setContent(`\n            <label class="top-16">${(0,o.A)("color")}</label>\n            <div id="split-swatches" class="swatches top-4">\n                <div data="red-blue" id="split-red-blue" class="twin active"><span style="background-color: #d1480e;"></span><span style="background-color: #3a6e9a;"></span></div>\n                <div data="green-red" id="split-green-red" class="twin"><span style="background-color: #929C1F;"></span><span style="background-color: #d1480e;"></span></div>\n                <div data="blue-green" id="split-blue-green" class="twin"><span style="background-color: #3a6e9a;"></span><span style="background-color: #929C1F;"></span></div>\n\n                <div data="red" id="split-red"><span style="background-color: #d1480e;"></span></div>\n                <div data="green" id="split-green"><span style="background-color:#929C1F;"></span></div>\n                <div data="blue" id="split-blue"><span style="background-color: #3a6e9a"></span></div>\n            </div>\n        `),this.distance=new a.A("split-distance",{label:(0,o.A)("distance"),step:.01,range:[0,1],defaultValue:.2,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.update()}),this.direction=new a.A("split-direction",{label:(0,o.A)("direction"),step:1,range:[0,360],defaultValue:180,labelFormat:t=>`${Math.round(t)}`,labelParse:t=>parseInt(t,10),onChange:t=>this.update()}),this.amount=new a.A("split-amount",{label:(0,o.A)("amount"),step:.01,range:[0,1],defaultValue:1,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.update()}),document.querySelector("#split-swatches").querySelectorAll("div").forEach((t=>t.addEventListener("click",this.selectSwatch))),this.update()}}},3729:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleScanlines")),this.update=()=>{this.change("scanlines",{size:this.size.getValue()/4,amount:this.amount.getValue()/4,colorize:(0,n.Ay)("scanline-colorize").checked,direction:(0,n.Ay)("scanline-direction").checked})},this.kind="scanlines",this.setContent((0,n.T)("div",{id:"scanline-size"}),(0,n.T)("div",{id:"scanline-amount",className:"range-box top-16"}),(0,n.T)("input",{type:"checkbox",checked:!0,id:"scanline-colorize"}),(0,n.T)("label",{className:"top-20 switch",htmlFor:"scanline-colorize"},(0,o.A)("colorize"),(0,n.T)("span")),(0,n.T)("input",{type:"checkbox",id:"scanline-direction"}),(0,n.T)("label",{className:"top-20 switch",htmlFor:"scanline-direction"},(0,o.A)("vertical"),(0,n.T)("span"))),this.size=new a.A("scanline-size",{label:(0,o.A)("size"),range:[1,10],step:1,defaultValue:2,labelFormat:t=>String(t),onChange:t=>this.update()}),this.amount=new a.A("scanline-amount",{label:(0,o.A)("amount"),step:.01,range:[0,1],defaultValue:.2,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.update()}),(0,n.Ay)("scanline-colorize").addEventListener("click",(()=>{this.update()})),(0,n.Ay)("scanline-direction").addEventListener("click",(()=>{this.update()})),this.update()}}},17550:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleSharpen")),this.setContent((0,n.T)("div",{id:"sharpen-slider"})),new a.A("sharpen-slider",{label:(0,o.A)("amount"),range:[0,1],step:.01,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("sharpen",t)})}}},98762:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(42268),a=s(26806);class n extends a.A{constructor(){super("Keybord Shortcuts",!0),this.dialog.style.width="800px",this.dialog.style.maxWidth="800px",this.content.style.paddingBottom="0px",this.setContent('\n            <div id="keyboard-shortcuts" class="flex">\n            \n            <div class="third" style="margin-right:20px;">\n                <label>New <span>Ctrl+E</span></label>\n                <label>Open <span>Ctrl+O</span></label>\n                <label>Save <span>Ctrl+S</span></label>\n                <label>Stock search <span>Ctrl+F</span></label>\n                <label>Print <span>Ctrl+P</span></label>\n                <label>Close <span>Ctrl+Q</span></label>\n\n                <label>Delete / Clear <span>DEL</span></label>\n\n                <div class="splitter small top-20"></div>\n\n                <label>Zoom In <span>Ctrl++</span></label>\n                <label>Zoom Out <span>Ctrl+-</span></label>\n                <label>Zoom Fit <span>Ctrl+0</span></label>\n                <label>Zoom 1X <span>Ctrl+1</span></label>\n                <label>Zoom Fill <span>Ctrl+2</span></label>\n                <label>Zoom 3X <span>Ctrl+3</span></label>\n                <label>Pan / Move<span>Spacebar</span></label>\n                <div class="splitter small top-20"></div>\n                <label>Brush size up <span>.</span></label>\n                <label>Brush size down <span>,</span></label>\n                <label>Brush softness less <span>Shift+.</span></label>\n                <label>Brush softness more <span>Shift+,</span></label>\n\n            </div>\n            <div class="third" style="margin-left:20px;">\n\n                <label>Arrange <span>V</span></label>\n                <label>Marquee <span>M</span></label>\n                <label>Lasso <span>L</span></label>\n                <label>Wand <span>W</span></label>\n                <label>Crop <span>C</span></label>\n                <label>Cutout <span>K</span></label>\n                <label>Liquify <span>Q</span></label>\n                <label>Heal <span>H</span></label>\n                <label>Clone <span>S</span></label>\n                <label>Blur / Sharpen <span>D</span></label>\n                <label>Dodge / Burn <span>O</span></label>\n                <label>Sponge/ Color <span>R</span></label>\n                <label>Pen <span>P</span></label>\n                <label>Draw <span>B</span></label>\n                <label>Eraser <span>E</span></label>\n                <label>Fill <span>F</span></label>\n                <label>Color replace <span>A</span></label>\n                <label>Shape <span>U</span></label>\n                <label>Text <span>T</span></label>\n                <label>Switch colors <span>X</span></label>\n            </div>\n            <div class="third" style="margin-left:20px;">\n\n                <label>Undo <span>Ctrl+Z</span></label>\n                <label>Redo <span>Ctrl+Y</span></label>\n                <label>Cut <span>Ctrl+X</span></label>\n                <label>Copy <span>Ctrl+C</span></label>\n                <label>Paste <span>Ctrl+V</span></label>\n                \n                <div class="splitter small top-20"></div>\n                <label>Free transform <span>Ctrl+R</span></label>\n                <label>Free distort <span>Ctrl+K</span></label>\n                <label>Select all <span>Ctrl+A</span></label>\n                <label>Deselect <span>Ctrl+D</span></label>\n                <label>Invert selction <span>Ctrl+I</span></label>\n\n                <div class="splitter small top-20"></div>\n\n                <label>Move \n                    <span>&#8593;</span>\n                    <span>&#8595;</span>\n                    <span>&#8592;</span>\n                    <span>&#8594;</span>\n                \n                </label>\n                <br />\n                <small>Hold down Shift to step 10px</small>\n                <div class="splitter small top-20"></div>\n\n            </div>\n        </div>\n        '),(0,i.Ay)("dialog-apply"+this.mid).style.display="none",(0,i.Ay)("dialog-cancel"+this.mid).innerText="close"}}},34475:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(21742),a=s(42268),n=s(82042),o=s(2215);class r extends o.A{constructor(t){super(t,(0,i.A)("titleSlice")),this.update=()=>{this.change("slice",{seed:this.seed.getValue(),amount:this.amount.getValue(),distance:this.distance.getValue(),line:(0,a.Ay)("slice-line").checked})},this.setContent((0,a.T)("div",{id:"slice-seed"}),(0,a.T)("div",{id:"slice-amount",className:"top-16"}),(0,a.T)("div",{id:"slice-distance",className:"top-16"}),(0,a.T)("input",{type:"checkbox",id:"slice-line"}),(0,a.T)("label",{className:"top-20 switch",htmlFor:"slice-line"},(0,i.A)("line"),(0,a.T)("span"))),this.seed=new n.A("slice-seed",{label:(0,i.A)("seed"),range:[0,200],step:1,defaultValue:100,labelFormat:t=>String(t),onChange:t=>this.update()}),this.amount=new n.A("slice-amount",{label:(0,i.A)("amount"),step:1,range:[0,25],defaultValue:4,labelFormat:t=>`${Math.round(t)}`,labelParse:t=>parseInt(t,10),onChange:t=>this.update()}),this.distance=new n.A("slice-distance",{label:(0,i.A)("distance"),step:.01,range:[-1,1],defaultValue:.2,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.update()}),(0,a.Ay)("slice-line").addEventListener("click",this.update),this.update()}}},15047:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleSmooth")),this.setContent((0,n.T)("div",{id:"smooth-slider"})),new a.A("smooth-slider",{label:(0,o.A)("amount"),range:[0,1],step:.01,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("smooth",t)})}}},25069:(t,e,s)=>{s.d(e,{A:()=>g});var i=s(21742),a=s(42268),n=s(40963),o=s(54738),r=s(98244),h=s(82042),l=s(15818),c=s(29755),d=s(23556),u=s(8689),p=s(2215);class g extends p.A{constructor(t){const e=t.fresco.getSelected(),p=new n.A(0,0,t.fresco.width,t.fresco.height),g=e.settings.locked&&e.rect.equalTo(p)?0:150;super(t,(0,i.A)("titleStrokeOutline"),!1,!1,g),this.load=async()=>{const t=Promise.resolve().then(s.bind(s,82355)),e=o.D9();await e;const{distanceTransform:i}=await t,n=this.shaders.ctx,h=this.cache.getContext("2d").getImageData(0,0,this.cache.width,this.cache.height),l=i(this.cache.width,this.cache.height,h.data);if(!n.getSupportedExtensions().includes("OES_texture_float"))return alert("sorry, this filter requires float textures"),void(0,r.A)("OES_texture_float");n.getExtension("OES_texture_float");const c=n.createTexture();n.bindTexture(n.TEXTURE_2D,c),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.cache.width,this.cache.height,0,n.ALPHA,n.FLOAT,l),n.bindTexture(n.TEXTURE_2D,null),this.map=c,(0,a.Ay)("stroke-loading").style.display="none",(0,a.Ay)("stroke-controls").style.visibility="visible",this.enableApply(),this.update()},this.update=()=>{const t={size:this.size.getValue(),opacity:this.opacity.getValue(),color:this.color.getColor(),distanceMap:this.map,cutout:this.cutout.checked};this.shaders.addShader("stroke",t.size?t:null),window.requestAnimationFrame((()=>{this.scratch.canvas=this.shaders.apply(this.cache),this.stage.render()}))},this.apply=()=>{const t=this.stage.fresco.getSelected(),e=o.TL(o.oM(this.scratch.canvas)).rebase(-this.scratch.rect.x,-this.scratch.rect.y),s=o.ON(t.canvas,e.rebase(t.rect.x,t.rect.y)),i=o.oM(t.mask),a=t.rect.clone();t.extendCanvas(e),this.scratch.drawToLayer(this.selected,this.isMasked?"source-over":"copy",1),t.render(),this.stage.fresco.removeScratch(),this.stage.history.add({type:"bitmapChange",kind:"stroke",layer:t,rect:a,patchRect:e.rebase(t.rect.x,t.rect.y),patch:s,mask:i}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.cleanUp()},this.cancel=()=>{this.stage.fresco.removeScratch(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.cleanUp()},this.disableApply(),this.shaders=new d.A,this.kind="stroke",this.stage=t,this.stage.coating.freeze(!0),this.setContent((0,a.T)("div",{className:"dialog-loading"},(0,a.T)("div",{id:"stroke-controls",className:"controls"},(0,a.T)("label",{className:"split"},(0,i.A)("color"),(0,a.T)("div",{id:"stroke-color"})),(0,a.T)("div",{id:"stroke-size",className:"range-box top-15"}),(0,a.T)("div",{id:"stroke-opacity",className:"range-box top-10"}),(0,a.T)("input",{id:"stroke-cutout",type:"checkbox"}),(0,a.T)("label",{className:"top-20 switch",htmlFor:"stroke-cutout"},(0,i.A)("strokeOutlineOnly"),(0,a.T)("span"))),(0,a.T)("div",{id:"stroke-loading",className:"message"},(0,a.T)("label",{className:"working"},(0,i.A)("loading"))))),this.cutout=(0,a.Ay)("stroke-cutout"),this.cutout.onchange=this.update,this.color=new u.A("stroke-color",l.A.fromHEX(c.Ay.mainColor),this.update,this.update),this.size=new h.A("stroke-size",{label:(0,i.A)("size"),range:[1,150],defaultValue:10,step:1,labelParse:t=>parseInt(t,10),onChange:()=>this.update()}),this.opacity=new h.A("stroke-opacity",{label:(0,i.A)("opacity"),defaultValue:1,labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.position(),this.load()}}},74298:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleTemperatureTint")),this.kind="temperatureTint",this.setContent((0,n.T)("div",{id:"temperature"}),(0,n.T)("div",{id:"tint",className:"top-16"})),new a.A("temperature",{label:(0,o.A)("temperature"),step:.01,range:[-1,1],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("temperature",t)}),new a.A("tint",{label:(0,o.A)("tint"),step:.01,range:[-1,1],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("tint",t)})}}},70586:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleThreshold")),this.setContent((0,n.T)("div",{id:"threshold"})),new a.A("threshold",{label:(0,o.A)("level"),step:.01,defaultValue:.5,range:[0,1],labelFormat:t=>`${Math.round(255*t)}`,labelParse:t=>parseInt(t,10)/255,onChange:t=>this.change("threshold",t+1e-13)}),this.change("threshold",.5)}}},58435:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleVibrance")),this.setContent((0,n.T)("div",{id:"vibrance"})),new a.A("vibrance",{label:(0,o.A)("amount"),step:.01,range:[-1,1],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("vibrance",t)})}}},71419:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(2215),a=s(82042),n=s(42268),o=s(21742);class r extends i.A{constructor(t){super(t,(0,o.A)("titleVignette")),this.setContent((0,n.T)("div",{id:"vignette-slider"})),new a.A("vignette-slider",{label:(0,o.A)("amount"),step:.01,range:[-1,1],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.change("vignette",t)})}}},16040:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(2215),a=s(82042),n=s(42268),o=s(21742),r=s(54738);class h extends i.A{constructor(t){super(t,(0,o.A)("titleWave")),this.update=()=>{r.sg("wave",50,(()=>{const t=Number(document.querySelector('input[name="type"]:checked').value),e=Number(document.querySelector('input[name="edge-approx"]:checked').value),s={type:t,amplitude:this.amplitude.getValue(),scale:Math.max(.01,this.scale.getValue()),rotate:this.rotate.getValue()*(Math.PI/1.8),edgeApprox:e};this.change("wave",s.amplitude?s:void 0)}))},this.setContent(`\n            <label>${(0,o.A)("type")}</label>\n            <div class="switch-field top-5">\n                <input type="radio" id="type-sine" name="type" value="0" checked/><label for="type-sine">${(0,o.A)("round")}</label>\n                <input type="radio" id="type-triangle" name="type" value="1"/><label for="type-triangle">${(0,o.A)("triangle")}</label>\n                <input type="radio" id="type-square" name="type" value="2"/><label for="type-square">${(0,o.A)("square")}</label>\n            </div>\n\n            <div id="wave-amplitude" class="range-box top-20"></div>\n            <div id="wave-scale" class="range-box"></div>\n            <div id="wave-rotate" class="range-box"></div>\n\n            <label class="split top-35">${(0,o.A)("edgeFill")}</label>\n            <div class="switch-field top-5" id="wave-edge-approx">\n                <input type="radio" id="edge-approx-none" name="edge-approx" value="0" checked/><label for="edge-approx-none">${(0,o.A)("none")}</label>\n                <input type="radio" id="edge-approx-reflect" name="edge-approx" value="1"/><label for="edge-approx-reflect">${(0,o.A)("reflect")}</label>\n                <input type="radio" id="edge-approx-repeat" name="edge-approx" value="2"/><label for="edge-approx-repeat">${(0,o.A)("repeat")}</label>\n            </div>\n        `),this.amplitude=new a.A("wave-amplitude",{label:(0,o.A)("amplitude"),range:[-.5,.5],step:.01,defaultValue:.05,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.scale=new a.A("wave-scale",{label:(0,o.A)("scale"),range:[1,30],step:1,defaultValue:1,labelFormat:t=>String(t),onChange:t=>this.update()}),this.rotate=new a.A("wave-rotate",{label:(0,o.A)("rotate"),step:.01,range:[-.9,.9],defaultValue:0,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:t=>this.update()}),(0,n.Ay)("type-sine").addEventListener("change",this.update,!1),(0,n.Ay)("type-triangle").addEventListener("change",this.update,!1),(0,n.Ay)("type-square").addEventListener("change",this.update,!1),(0,n.Ay)("edge-approx-none").addEventListener("change",this.update,!1),(0,n.Ay)("edge-approx-reflect").addEventListener("change",this.update,!1),(0,n.Ay)("edge-approx-repeat").addEventListener("change",this.update,!1),this.update()}}},81551:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(21742),a=s(42268),n=s(82042),o=s(2215),r=s(54738);class h extends o.A{constructor(t){super(t,(0,i.A)("titleZoomBlur")),this.update=r.eD(50,(()=>{const t={x:this.x.getValue(),y:1-this.y.getValue(),amount:this.amount.getValue()};this.change("zoom",t.amount?t:void 0)})),this.kind="zoom",this.setContent((0,a.T)("div",{id:"zoom-amount"}),(0,a.T)("div",{id:"zoom-x",className:"top-10"}),(0,a.T)("div",{id:"zoom-y",className:"top-10"})),this.amount=new n.A("zoom-amount",{label:(0,i.A)("amount"),range:[0,1],defaultValue:.2,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.x=new n.A("zoom-x",{label:"X",range:[0,1],defaultValue:.5,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.y=new n.A("zoom-y",{label:"Y",range:[0,1],defaultValue:.5,step:.01,labelFormat:t=>`${Math.round(100*t)}%`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.update()}),this.update()}}},57695:(t,e,s)=>{s.a(t,(async(t,i)=>{try{s.d(e,{A:()=>ce});var a=s(42268),n=s(40963),o=s(98244),r=s(41915),h=s(22866),l=s(69424),c=s(87852),d=s(54738),u=s(15818),p=s(53198),g=s(86344),m=s(16377),v=s(36854),y=s(91601),f=s(37694),w=s(6709),x=s(26232),b=s(39989),A=s(96785),k=s(93771),S=s(29755),E=s(40562),C=s(46207),T=s(13791),L=s(18505),M=s(44146),P=s(89352),D=s(87971),z=s(74298),I=s(27983),F=s(66544),_=s(58435),R=s(21164),N=s(7623),B=s(12895),O=s(2006),U=s(45432),q=s(17550),H=s(99189),V=s(58e3),$=s(81551),X=s(64019),G=s(93354),j=s(14887),W=s(60492),Y=s(18252),K=s(15047),Z=s(38046),Q=s(95362),J=s(22220),tt=s(55098),et=s(54907),st=s(50816),it=s(71419),at=s(92270),nt=s(28329),ot=s(72617),rt=s(98762),ht=s(25069),lt=s(15923),ct=s(70586),dt=s(55614),ut=s(17096),pt=s(15872),gt=s(49143),mt=s(26824),vt=s(4380),yt=s(18177),ft=s(34475),wt=s(16040),xt=s(47378),bt=s(78360),At=s(11980),kt=s(66496),St=s(3729),Et=s(16499),Ct=s(77441),Tt=s(69504),Lt=s(35722),Mt=s(78282),Pt=s(33850),Dt=s(54975),zt=s(10809),It=s(69429),Ft=s(39612),_t=s(79522),Rt=s(99810),Nt=s(85806),Bt=s(98865),Ot=s(23580),Ut=s(97802),qt=s(61161),Ht=s(89373),Vt=s(4059),$t=s(18155),Xt=s(4894),Gt=s(22400),jt=s(53226),Wt=s(411),Yt=s(55949),Kt=s(87257),Zt=s(57346),Qt=s(69175),Jt=s(75707),te=s(19883),ee=s(38135),se=s(72357),ie=s(9735),ae=s(90593),ne=s(57906),oe=s(48373),re=s(59423),he=s(64872),le=t([E]);E=(le.then?(await le)():le)[0];class ce extends E.A{constructor(){super(),this.hasDock=!1,this.isKeyDown=!1,this.isPreviewMode=!1,this.initial=!0,this.resize=()=>{if(this.stage&&(0,a.Ay)("menu-bar")){if(this.isPreviewMode)this.stage.resize(0,0,this.stage.workspace.offsetWidth,this.stage.workspace.offsetHeight-1);else{let t=S.Ay.barQuicklink?(0,a.Ay)("right-bar").offsetWidth+1:0,e=S.Ay.panelFloating?0:(0,a.Ay)("menu-bar").offsetWidth+1,s=S.Ay.panelFloating?46:(0,a.Ay)("panel-bar").offsetWidth+1,i="none"===(0,a.Ay)("tab-bar").style.display?0:33;this.stage.resize(e,77+i,this.stage.workspace.offsetWidth-e-s-t,this.stage.workspace.offsetHeight-77-i),(0,a.Ay)("panel-bar").style.right=t+"px"}this.tabBar&&this.tabBar.resize(),this.scrollbar&&this.scrollbar.resize(),this.tool&&"crop"===this.tool.name&&this.tool.refit(),this.initial&&(this.positionFloatingPanels(),this.initial=!1)}},this.togglePreviewMode=()=>{var t,e;this.isSplash()||this.isModal()||(this.isPreviewMode=!this.isPreviewMode,this.isPreviewMode?((0,a.Ay)("top-bar").style.display="none",(0,a.Ay)("panel-bar").style.display="none",(0,a.Ay)("right-bar").style.display="none",(0,a.Ay)("menu-bar").style.display="none",(0,a.Ay)("tab-bar").style.display="none",this.tool instanceof Kt.A&&(null===(t=this.tool.reform)||void 0===t||t.supress(!0))):((0,a.Ay)("panel-bar").style.display="flex",(0,a.Ay)("top-bar").style.display="block",(0,a.Ay)("menu-bar").style.display="block",S.Ay.barQuicklink&&((0,a.Ay)("right-bar").style.display="flex"),this.tabBar.render(),this.tool instanceof Kt.A&&(null===(e=this.tool.reform)||void 0===e||e.supress(!1))),this.resize())},this.keyDown=async t=>{var e;const s=document.activeElement;if(d.Jn(s))"Enter"===t.key&&"TEXTAREA"!==s.nodeName&&document.activeElement.blur();else if(this.isSplash())"Escape"===t.key&&this.stage.fresco&&this.hideSplash();else if("Control"!==t.key&&"Shift"!==t.key&&" "!==t.key&&this.tool instanceof Kt.A&&(null===(e=this.tool.selectron)||void 0===e||e.cleanCut()),!this.isModal())if(t.ctrlKey||t.metaKey)switch(t.key.toLowerCase()){case"a":return t.preventDefault(),void this.stage.selectionAll();case"b":return t.preventDefault(),void new W.A(this.stage);case"d":return t.preventDefault(),void(this.stage.fresco.hasSelection()?this.stage.selectionDeselect():await this.stage.duplicateLayer());case"e":return t.preventDefault(),void this.newClick();case"f":return t.preventDefault(),void new p.A(this.stage);case"i":return t.preventDefault(),void this.stage.selectionInvert();case"j":return t.preventDefault(),void this.stage.pasteFromSelection();case"m":return t.preventDefault(),void(this.stage.fresco&&this.stage.fresco.isSelectedShaderbleWithCanvas()&&new B.A(this.stage));case"l":return t.preventDefault(),void(this.stage.fresco&&this.stage.fresco.isSelectedShaderbleWithCanvas()&&new O.A(this.stage));case"o":return t.preventDefault(),void this.openClick();case"s":return t.preventDefault(),void this.saveClick();case"p":return t.preventDefault(),void this.print();case"u":return t.preventDefault(),void(this.stage.fresco&&this.stage.fresco.isSelectedShaderbleWithCanvas()&&new I.A(this.stage));case"w":case"q":return t.preventDefault(),void this.closeClick();case"r":return t.preventDefault(),void this.setTool("arrange",!0,"TRANSFORM");case"k":return t.preventDefault(),void this.setTool("arrange",!0,"DISTORT");case"z":return t.preventDefault(),void(t.shiftKey?this.stage.history.redo():this.stage.history.undo());case"y":return t.preventDefault(),void this.stage.history.redo();case"0":return t.preventDefault(),void this.stage.setZoom("fit");case"1":return t.preventDefault(),void this.stage.setZoom("1");case"2":return t.preventDefault(),void this.stage.setZoom("fill");case"3":return t.preventDefault(),void this.stage.setZoom("3");case"6":return t.preventDefault(),void this.stage.mergeDown();case"7":return t.preventDefault(),void this.stage.mergeVisible();case"8":return t.preventDefault(),void this.stage.mergeFlatten();case"4":return t.preventDefault(),void this.stage.moveUp();case"5":return t.preventDefault(),void this.stage.moveDown();case"-":return t.preventDefault(),void this.stage.setZoomStep(!1);case"+":case"=":return t.preventDefault(),void this.stage.setZoomStep(!0);case"enter":return void this.stage.playAnimation()}else{if(" "===t.key&&(!this.tool||"hand"!==this.tool.name))return this.stage.coating.setPan(),void t.preventDefault();if("Tab"===t.key)return t.preventDefault(),void this.togglePreviewMode();if("Escape"===t.key)return this.isPreviewMode&&this.togglePreviewMode(),void(this.tool&&this.tool.cancel());if("Enter"!==t.key)if("Delete"!==t.key&&"Backspace"!==t.key)switch(t.key.toLowerCase()){case"a":this.setTool("replace");break;case"b":this.setTool("draw");break;case"c":this.setTool("crop");break;case"d":this.setTool("detail");break;case"e":this.setTool("eraser");break;case"f":this.setTool("fill");break;case"g":this.setTool("gradient");break;case"h":this.setTool("heal");break;case"i":this.setTool("picker");break;case"j":this.setTool("focus");break;case"k":this.setTool("cutout");break;case"l":this.setTool("lasso");break;case"m":this.setTool("marquee");break;case"n":this.setTool("frame");break;case"o":this.setTool("toning");break;case"p":this.setTool("pen");break;case"q":this.setTool("liquify");break;case"r":this.setTool("temper");break;case"s":this.setTool("clone");break;case"t":this.setTool("text");break;case"u":this.setTool("shape");break;case"v":this.setTool("arrange");break;case"w":this.setTool("wand");break;case"x":this.switchColor();break;case"y":this.setTool("disperse");break;case"z":this.setTool("zoom")}else this.stage.fresco&&(this.stage.fresco.hasSelection()?this.clear():this.stage.deleteLayer(),t.preventDefault());else this.tool&&this.tool.apply()}},this.keyUp=t=>{this.isModal()?t.preventDefault():" "!==t.key||this.tool&&"hand"===this.tool.name||this.stage.coating.removePan()},this.setUpTopBar=()=>{var t;null===(t=(0,a.Ay)("toggle-home"))||void 0===t||t.addEventListener("click",(()=>{var t;null===(t=this.tool)||void 0===t||t.apply(),this.showSplash()}),!1);let e=(0,a.Ay)("menu").querySelectorAll("#menu>li>label");for(var s=0;s<e.length;s++)e[s].addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault(),(0,a.Ay)("menu").classList.toggle("active");const e=t=>{t.target.classList.contains("more")||((0,a.Ay)("menu").classList.remove("active"),document.removeEventListener("click",e,!1))};document.addEventListener("click",e,!1)}),!0);const i=(t,e)=>{(0,a.Ay)(t).addEventListener("click",(()=>{var s;null===(s=this.stage)||void 0===s||s.stopAnimation(),"edit-undo"!==t&&"edit-redo"!==t&&this.tool&&(this.stage.history.commitTransaction(),this.tool.apply()),(t=>!(0,a.Ay)(t).classList.contains("disabled"))(t)&&e()}),!0)},r=()=>{var t,e;let s=null===(t=this.stage.fresco)||void 0===t?void 0:t.getSelected(),i=this.stage.isSelectedLayerShaderble(),n=i&&s.type===h.A.TYPE_FRAME;const o=null===(e=this.stage.fresco)||void 0===e?void 0:e.hasSelection(),r=s&&s instanceof b.A&&s.hasMask();(0,a.Ay)("menu").querySelectorAll(".image").forEach((t=>{t.classList.toggle("disabled",!i),n&&t.classList.contains("noframe")&&t.classList.add("disabled")})),(0,a.Ay)("menu").querySelectorAll(".selection").forEach((t=>{t.classList.toggle("disabled",!o)})),(0,a.Ay)("menu").querySelectorAll(".mask").forEach((t=>{t.classList.toggle("disabled",!r)})),(0,a.Ay)("layer-merge-down").classList.toggle("disabled",!s),this.stage.fresco&&((0,a.Ay)("file-print").classList.toggle("disabled",this.stage.fresco.block),(0,a.Ay)("export-image").classList.toggle("disabled",this.stage.fresco.block),(0,a.Ay)("export-layer").classList.toggle("disabled",this.stage.fresco.block))};document.addEventListener("layer-select",r),document.addEventListener("history-update",(async t=>{(0,a.Ay)("edit-undo").classList.toggle("disabled",t.detail&&t.detail.atStart),(0,a.Ay)("edit-redo").classList.toggle("disabled",t.detail&&t.detail.atEnd),r()})),i("file-new",this.newClick),i("file-save",this.saveClick),i("file-print",(()=>this.print())),i("file-close",this.closeClick),i("file-open",this.openClick),i("file-open-url",(()=>new m.A(this.stage))),i("file-stock",(()=>new p.A(this.stage))),i("file-add-element",(()=>new W.A(this.stage))),i("export-image",(()=>this.quickExport())),i("export-layer",(()=>this.quickExport(!0))),i("edit-undo",(()=>this.stage.history.undo())),i("edit-redo",(()=>this.stage.history.redo())),i("edit-cut",(()=>document.execCommand("cut"))),i("edit-copy",(()=>document.execCommand("copy"))),i("edit-paste",(()=>this.pasteActivatedFromMenu())),i("edit-clear",(()=>this.clear())),i("edit-stroke",(()=>new ht.A(this.stage))),i("edit-fill",(()=>new lt.A(this.stage))),i("edit-infill",(()=>new Mt.A(this.stage))),i("edit-free-transform",(()=>this.setTool("arrange",!0,"TRANSFORM"))),i("edit-free-distort",(()=>this.setTool("arrange",!0,"DISTORT"))),i("edit-rotate-left",(()=>this.stage.rotateSelected(!0))),i("edit-rotate-right",(()=>this.stage.rotateSelected(!1))),i("edit-flip-horizontal",(()=>this.stage.flipSelected(!1))),i("edit-flip-vertical",(()=>this.stage.flipSelected(!0))),i("edit-preferences",(()=>new Et.A(this.stage))),i("selection-all",(()=>this.stage.selectionAll())),i("selection-deselect",(()=>this.stage.selectionDeselect())),i("selection-invert",(()=>this.stage.selectionInvert())),i("selection-pixels",(()=>this.stage.selectionPixels())),i("selection-subject",(()=>this.stage.selectionSubject())),i("selection-save",(()=>this.stage.selectionSave())),i("selection-restore",(()=>this.stage.selectionRestore())),i("selection-convert",(()=>{this.stage.selectionConvert(),this.setTool("cutout")})),i("image-canvas-resize",(()=>new f.A(this.stage))),i("image-resize",(()=>new y.A(this.stage))),i("image-smart-resize",(()=>new w.A(this.stage))),i("image-canvas-color",(()=>new v.A(this.stage))),i("image-flip-vertical",(()=>this.stage.flip(!0))),i("image-flip-horizontal",(()=>this.stage.flip(!1))),i("image-rotate-left",(()=>this.stage.rotate(!0))),i("image-rotate-right",(()=>this.stage.rotate(!1))),i("image-crop",(()=>{if(this.stage.fresco.hasSelection()){const t=new n.A(this.stage.fresco.selection.bounds.x,this.stage.fresco.selection.bounds.y,this.stage.fresco.selection.bounds.width,this.stage.fresco.selection.bounds.height);this.stage.selectionDeselect(),this.stage.crop(t)}})),i("image-trim",(()=>{let t=this.stage.getOutputCanvas(this.stage.fresco,1),e=d.TL(t);e.width>0&&e.height>0&&this.stage.crop(e)})),i("image-generative-expand",(()=>{new x.A(this.stage),this.resize()})),i("layer-new",(()=>this.stage.addEmpty())),i("layer-open",(async()=>{(0,o.A)("open-browse"),await(0,k.XN)(!0).then((async t=>{document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));for(let e=0;e<t.length;e++)await(0,k.Tq)(this.stage,t[e],!1);document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}))})),i("layer-url",(()=>new m.A(this.stage,!1))),i("layer-add-element",(()=>new W.A(this.stage))),i("layer-duplicate",(async()=>await this.stage.duplicateLayer())),i("layer-delete",(()=>this.stage.deleteLayer())),i("layer-merge-down",(()=>this.stage.mergeDown())),i("layer-merge-visible",(()=>this.stage.mergeVisible())),i("layer-merge-flatten",(()=>this.stage.mergeFlatten())),i("layer-move-up",(()=>this.stage.moveUp())),i("layer-move-down",(()=>this.stage.moveDown())),i("layer-rasterize",(()=>this.stage.rasterize())),i("layer-ai-mask",(()=>new g.A(this.stage))),i("layer-add-mask",(()=>{this.stage.maskAdd(),this.setTool("cutout")})),i("layer-convert-mask",(()=>{this.stage.maskConvert(),this.setTool("arrange")})),i("layer-extract-mask",(()=>this.stage.maskExtract())),i("layer-invert-mask",(()=>this.stage.maskInvert())),i("layer-delete-mask",(()=>this.stage.maskDelete())),i("layer-apply-mask",(()=>this.stage.maskApply())),i("adjust-auto",(()=>new ae.A(this.stage))),i("adjust-pop",(()=>new ie.A(this.stage))),i("adjust-bw",(()=>new se.A(this.stage))),i("adjust-brightness-contrast",(()=>new P.A(this.stage))),i("adjust-temperature-tint",(()=>new z.A(this.stage))),i("adjust-hue-saturation",(()=>new I.A(this.stage))),i("adjust-vibrance",(()=>new _.A(this.stage))),i("adjust-balance",(()=>new N.A(this.stage))),i("adjust-highlights-shadows",(()=>new D.A(this.stage))),i("adjust-exposure",(()=>new R.A(this.stage))),i("adjust-monochrome",(()=>new F.A(this.stage))),i("adjust-curves",(()=>new B.A(this.stage))),i("adjust-levels",(()=>new O.A(this.stage))),i("adjust-threshold",(()=>new ct.A(this.stage))),i("adjust-alphaThreshold",(()=>new dt.A(this.stage))),i("adjust-posterize",(()=>new Y.A(this.stage))),i("adjust-desaturate",(()=>new he.A(this.stage))),i("adjust-invert",(()=>new ne.A(this.stage))),i("adjust-solarize",(()=>new re.A(this.stage))),i("adjust-mimichdr",(()=>new bt.A(this.stage))),i("adjust-lookup",(()=>new ut.A(this.stage))),i("filter-effect",(()=>new U.A(this.stage))),i("filter-drop-shadow",(()=>new pt.A(this.stage))),i("filter-outline",(()=>new ht.A(this.stage))),i("filter-outer-glow",(()=>new gt.A(this.stage))),i("filter-inner-glow",(()=>new mt.A(this.stage))),i("filter-bevel",(()=>new yt.A(this.stage))),i("filter-sharpen",(()=>new q.A(this.stage))),i("filter-clarity",(()=>new H.A(this.stage))),i("filter-blur",(()=>new V.A(this.stage))),i("filter-zoom-blur",(()=>new $.A(this.stage))),i("filter-gaussian-blur",(()=>new X.A(this.stage))),i("filter-motion-blur",(()=>new G.A(this.stage))),i("filter-radial-blur",(()=>new j.A(this.stage))),i("filter-smooth",(()=>new K.A(this.stage))),i("filter-denoise",(()=>new Z.A(this.stage))),i("filter-bloom",(()=>new Q.A(this.stage))),i("filter-glamour",(()=>new J.A(this.stage))),i("filter-fringe",(()=>new at.A(this.stage))),i("filter-rgb-split",(()=>new kt.A(this.stage))),i("filter-scanlines",(()=>new St.A(this.stage))),i("filter-interference",(()=>new Ct.A(this.stage))),i("filter-slice",(()=>new ft.A(this.stage))),i("filter-grain",(()=>new tt.A(this.stage))),i("filter-noise",(()=>new et.A(this.stage))),i("filter-dehaze",(()=>new st.A(this.stage))),i("filter-vignette",(()=>new it.A(this.stage))),i("filter-pixelate",(()=>new nt.A(this.stage))),i("filter-mosaic",(()=>new ot.A(this.stage))),i("filter-halftone",(()=>new vt.A(this.stage))),i("filter-sobel",(()=>new oe.A(this.stage))),i("filter-polarcoordinates",(()=>new Lt.A(this.stage))),i("filter-fish-eye",(()=>new xt.A(this.stage))),i("filter-reflect",(()=>new At.A(this.stage))),i("filter-wave",(()=>new wt.A(this.stage))),i("filter-kaleidoscope",(()=>new Tt.A(this.stage))),i("view-restore",(()=>this.restorePanel())),i("view-floating",(()=>this.toggleFloatingPanel())),i("view-navigator",(()=>this.togglePanel("navigator-panel"))),i("view-layer",(()=>this.togglePanel("layer-panel"))),i("view-history",(()=>this.togglePanel("history-panel"))),i("view-quicklink",(()=>this.toggleQuicklink())),i("view-zoom-in",(()=>this.stage.setZoomStep(!0))),i("view-zoom-out",(()=>this.stage.setZoomStep(!1))),i("view-zoom-fit",(()=>this.stage.setZoom("fit"))),i("view-zoom-fill",(()=>this.stage.setZoom("fill"))),i("view-zoom-1x",(()=>this.stage.setZoom("1"))),i("view-zoom-2x",(()=>this.stage.setZoom("2"))),i("view-zoom-3x",(()=>this.stage.setZoom("3"))),i("view-preview",(()=>this.togglePreviewMode())),i("view-full-screen",(()=>document.documentElement.requestFullscreen())),i("view-theme",(()=>new Et.A(this.stage))),i("help-shortcuts",(()=>new rt.A)),i("help-error-report",(()=>new c.A(this.stage)))},this.setUpMenuBar=()=>{const t=(0,a.Ay)("tool-menu").getElementsByTagName("li");for(var e=0;e<t.length;e++)t[e].addEventListener("click",(t=>this.setTool(t.currentTarget.getAttribute("data"))),!1),t[e].addEventListener("pointerenter",(t=>this.showToolTip(t.currentTarget.getAttribute("data"),t)),!1),t[e].addEventListener("pointerleave",(t=>this.hideToolTip(t.currentTarget.getAttribute("data"),t)),!1);(0,a.Ay)("color-main").style.backgroundColor=S.Ay.mainColor,(0,a.Ay)("color-main").addEventListener("click",(()=>new A.A(u.A.fromHEX(S.Ay.mainColor),(t=>{this.setColor(t,!0)}))),!1),(0,a.Ay)("color-alt").style.backgroundColor=S.Ay.altColor,(0,a.Ay)("color-alt").addEventListener("click",(()=>new A.A(u.A.fromHEX(S.Ay.altColor),(t=>{this.setColor(t,!1)}))),!1),(0,a.Ay)("color-switch").addEventListener("click",this.switchColor,!1),(0,a.Ay)("tool-zoom").addEventListener("dblclick",(()=>this.stage.setZoom("1")),!1),(0,a.Ay)("menu-bar").classList.toggle("floating",S.Ay.panelFloating),(0,a.Bb)((0,a.Ay)("menu-handle"),this.dragMenuStart,this.dragMenuMove,this.dragMenuUp),this.setTool("arrange")},this.dragMenuStart=t=>{this.p=t,this.d=new r.A((0,a.Ay)("menu-bar").offsetLeft,(0,a.Ay)("menu-bar").offsetTop)},this.dragMenuMove=t=>{(0,a.Ay)("menu-bar").style.left=Math.round(this.d.x+(t.x-this.p.x))+"px",(0,a.Ay)("menu-bar").style.top=Math.round(this.d.y+(t.y-this.p.y))+"px"},this.dragMenuUp=t=>{let e=Math.round(this.d.y+(t.y-this.p.y)),s=Math.round(this.d.x+(t.x-this.p.x));e<76&&(e=76),s<0&&(s=0),s+72>(0,a.Ay)("workspace").offsetWidth&&(s=(0,a.Ay)("workspace").offsetWidth-72),(0,a.Ay)("menu-bar").style.left=s+"px",(0,a.Ay)("menu-bar").style.top=e+"px"},this.setColorEvent=t=>{const e=t.detail;(0,S.oY)(e),this.setColor(e,!0)},this.setColor=(t,e)=>{let s=t.toHEX();e?((0,S.ZC)("mainColor",s),(0,a.Ay)("color-main").style.backgroundColor=s):((0,S.ZC)("altColor",s),(0,a.Ay)("color-alt").style.backgroundColor=s)},this.switchColor=()=>{let t=S.Ay.mainColor,e=S.Ay.altColor;(0,S.ZC)("altColor",t),(0,S.ZC)("mainColor",e),(0,a.Ay)("color-main").style.backgroundColor=e,(0,a.Ay)("color-alt").style.backgroundColor=t},this.resetColor=()=>{(0,S.ZC)("altColor","#FFFFFF"),(0,S.ZC)("mainColor","#000000"),(0,a.Ay)("color-main").style.backgroundColor="#000000",(0,a.Ay)("color-alt").style.backgroundColor="#FFFFFF"},this.setUpRightBar=()=>{S.Ay.barQuicklink||((0,a.Ay)("right-bar").style.display="none"),(0,a.Ay)("shortcut-save").addEventListener("click",this.saveClick),(0,a.Ay)("shortcut-navigator").addEventListener("click",(()=>this.togglePanel("navigator-panel"))),(0,a.Ay)("shortcut-layers").addEventListener("click",(()=>this.togglePanel("layer-panel"))),(0,a.Ay)("shortcut-history").addEventListener("click",(()=>this.togglePanel("history-panel")))},this.setUpPanelBar=()=>{this.tabBar=new C.A(this),this.layerPanel=new T.A(this.stage,S.Ay.panelLayer),this.historyPanel=new L.A(this.stage,S.Ay.panelHistory),this.navigatorPanel=new M.A(this.stage,S.Ay.panelNavigator),this.scrollbar=new l.A(this.stage),(S.Ay.panelLayer||S.Ay.panelHistory||S.Ay.panelNavigator)&&(0,a.Ay)("panel-bar").classList.add("active"),(0,a.Ay)("panel-bar").classList.toggle("floating",S.Ay.panelFloating)},this.togglePanel=t=>{const e=!(0,a.Ay)(t).classList.contains("active");switch(t){case"navigator-panel":(0,S.ZC)("panelNavigator",e),this.navigatorPanel.activate(e);break;case"layer-panel":(0,S.ZC)("panelLayer",e),this.layerPanel.activate(e);break;case"history-panel":(0,S.ZC)("panelHistory",e),this.historyPanel.activate(e)}let s=!1;const i=(0,a.Ay)("panel-bar").getElementsByClassName("panel");for(let a=0;a<i.length;a++)if(i[a].classList.contains("active")){s=!0;break}(0,a.Ay)("panel-bar").classList.toggle("active",s),S.Ay.panelFloating?e&&((0,a.Ay)(t).style.left=~~(((0,a.Ay)("workspace").clientWidth-240)/2)+"px",(0,a.Ay)(t).style.top=~~(((0,a.Ay)("workspace").clientHeight-70)/2)+"px"):this.resize()},this.toggleQuicklink=()=>{const t="none"===(0,a.Ay)("right-bar").style.display;(0,S.ZC)("barQuicklink",t),(0,a.Ay)("right-bar").style.display=t?"flex":"none",this.resize()},this.restorePanel=()=>{(0,a.Ay)("panel-bar").classList.remove("floating"),(0,a.Ay)("menu-bar").classList.remove("floating"),(0,a.Ay)("panel-bar").classList.add("active"),this.navigatorPanel.activate(!0),this.layerPanel.activate(!0),this.historyPanel.activate(!0),(0,S.ZC)("panelNavigator",!0),(0,S.ZC)("panelLayer",!0),(0,S.ZC)("panelHistory",!0),(0,S.ZC)("panelFloating",!1),this.positionFloatingPanels(),this.resize()},this.toggleFloatingPanel=()=>{const t=!S.Ay.panelFloating;(0,S.ZC)("panelFloating",t),(0,a.Ay)("panel-bar").classList.toggle("floating"),(0,a.Ay)("menu-bar").classList.toggle("floating"),this.resize()},this.positionFloatingPanels=()=>{const t=(0,a.Ay)("menu-bar");t.style.top="100px",t.style.left="20px";const e=(0,a.Ay)("workspace").offsetWidth-51,s=(0,a.Ay)("workspace").offsetHeight;let i=100;if(this.navigatorPanel.active){const t=(0,a.Ay)("navigator-panel");t.style.top=i+"px",t.style.left=e-260+"px",i+=t.offsetHeight+20}let n=Math.min(~~(s-i)/2-20,300);if(this.layerPanel.active&&this.historyPanel.active||(n*=2),this.layerPanel.active){const t=(0,a.Ay)("layer-panel");t.style.top=i+"px",t.style.left=e-260+"px",t.style.height=n+"px",i+=n+20}if(this.historyPanel.active){const t=(0,a.Ay)("history-panel");t.style.top=i+"px",t.style.left=e-260+"px",t.style.height=n+"px"}},this.hovering=!1,this.selectToolEvent=t=>{window.clearTimeout(this.onit),window.clearTimeout(this.offit),t&&t.detail?this.setTool(t.detail,!0):this.setTool("arrange")},this.setTool=async(t,e=!1,s)=>{var i;if(null===(i=this.stage)||void 0===i||i.stopAnimation(),e||!this.tool||this.tool.name!==t){switch(this.tool&&((0,a.Ay)("tool-"+this.tool.name).classList.remove("active"),(0,a.Ay)(this.tool.name).classList.remove("active"),this.tool.cleanUp(),this.tool=void 0,this.stage.coating.removeCursorImage()),t){case"crop":this.tool=new zt.A(this.stage);break;case"cutout":this.tool=new $t.A(this.stage);break;case"frame":this.tool=new Ot.A(this.stage);break;case"arrange":this.tool=new Kt.A(this.stage,s||"ARRANGE");break;case"marquee":this.tool=new Qt.A(this.stage);break;case"lasso":this.tool=new Ht.A(this.stage);break;case"wand":this.tool=new It.A(this.stage);break;case"clone":this.tool=new Ut.A(this.stage);break;case"heal":this.tool=new Nt.A(this.stage);break;case"detail":this.tool=new Xt.A(this.stage);break;case"toning":this.tool=new Gt.A(this.stage);break;case"temper":this.tool=new jt.A(this.stage);break;case"focus":this.tool=new Vt.A(this.stage);break;case"disperse":this.tool=new ee.A(this.stage);break;case"liquify":this.tool=new Zt.A(this.stage);break;case"pen":this.tool=new Pt.A(this.stage);break;case"fill":this.tool=new Rt.A(this.stage);break;case"draw":this.tool=new Bt.A(this.stage);break;case"shape":this.tool=new qt.A(this.stage);break;case"eraser":this.tool=new Wt.A(this.stage);break;case"replace":this.tool=new Jt.A(this.stage);break;case"gradient":this.tool=new te.A(this.stage);break;case"text":this.tool=new Dt.A(this.stage);break;case"zoom":this.tool=new Ft.A(this.stage);break;case"hand":this.tool=new _t.A(this.stage);break;case"picker":this.tool=new Yt.A(this.stage,((t,e)=>{(0,S.oY)(t),this.setColor(t,e)}))}this.tool&&((0,a.Ay)("tooltip-"+this.tool.name).classList.remove("active"),(0,a.Ay)("tool-"+this.tool.name).classList.add("active"),(0,a.Ay)(this.tool.name).classList.add("active"))}},this.print=async()=>{let t=this.stage.getOutputCanvas(this.stage.fresco,1).toDataURL();var e=window.open("about:blank","_new");e.document.open(),e.document.write("<html><head><script>function step1(){\nsetTimeout('step2()', 10);}\nfunction step2(){window.print();window.close()}\n<\/script></head><body onload='step1()'>\n<img src='"+t+"' /></body></html>"),e.document.close()},window.onresize=()=>this.resize(),document.body.onkeydown=t=>this.keyDown(t),document.body.onkeyup=t=>this.keyUp(t),document.addEventListener("resize",(()=>this.resize())),document.addEventListener("select-tool",this.selectToolEvent,!0),document.addEventListener("set-color",this.setColorEvent,!0),document.addEventListener("preferences",(()=>new Et.A(this.stage)),!0),document.addEventListener("panel-state",(t=>this.togglePanel(t.detail))),this.setUpTopBar(),this.setUpMenuBar(),this.setUpPanelBar(),this.setUpRightBar()}showToolTip(t,e){"mouse"===e.pointerType&&(window.clearTimeout(this.offit),this.onit=window.setTimeout((()=>{let e=(0,a.Ay)("tooltip-"+t);e.style.top=(0,a.Ay)("tool-"+t).offsetTop-10+"px",e.style.left=(0,a.Ay)("tool-"+t).offsetLeft+40+"px",e.offsetTop+e.offsetHeight>(0,a.Ay)("menu-bar").offsetHeight-10&&(e.style.top=(0,a.Ay)("menu-bar").offsetHeight-e.offsetHeight-10+"px"),e.classList.add("active"),this.hovering=!0}),this.hovering?0:666))}hideToolTip(t,e){"mouse"===e.pointerType&&(window.clearTimeout(this.onit),window.clearTimeout(this.offit),(0,a.Ay)("tooltip-"+t).classList.remove("active"),this.offit=window.setTimeout((()=>{this.hovering=!1}),1e3))}}i()}catch(ce){i(ce)}}))},37771:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(54738),a=s(41915),n=s(29755),o=s(42268);class r{constructor(t,e,s=!1){if(this.docked=!1,this.setTitle=(t,e=40)=>{t=t.length>e?`${t.substring(0,5)}...`:t,(0,o.Ay)("float-title-"+this.mid).innerHTML=t},this.position=()=>{if(this.parent)if("express"===n.Ay.product)this.float.style.left="400px",this.float.style.top=Math.round(((0,o.Ay)("workspace").clientHeight-this.float.clientHeight)/3)+"px";else{let t=this.parent.getBoundingClientRect();this.float.style.left=~~(t.right-this.float.clientWidth/2-t.width/2)+"px",this.float.style.top=t.top+30+"px"}else{const t=(0,o.Ay)("workspace").getBoundingClientRect();this.docked?(this.float.style.left="unset",this.float.style.right="0",this.float.style.top="77px",this.float.style.height=t.height-77+"px"):(this.float.style.left=t.width-~~(this.float.offsetWidth/2)-400+"px",this.float.style.height="600px",this.float.style.top="120px"),this.float.classList.toggle("docked",this.docked)}},this.setContent=(...t)=>{t[0]instanceof HTMLElement?this.content.append(...t):this.content.innerHTML+=t[0],this.position()},this.dragStart=t=>{this.docked||(this.p=t,this.d=new a.A(this.float.offsetLeft,this.float.offsetTop))},this.dragMove=t=>{this.docked||(this.float.style.left=Math.round(this.d.x+(t.x-this.p.x))+"px",this.float.style.top=Math.round(this.d.y+(t.y-this.p.y))+"px")},this.dragEnd=t=>{if(this.docked)return;let e=Math.round(this.d.y+(t.y-this.p.y)),s=Math.round(this.d.x+(t.x-this.p.x)),i=this.float.offsetWidth;e<20&&(e=20),s<-i/2&&(s=0),s+i/2>(0,o.Ay)("workspace").offsetWidth&&(s=(0,o.Ay)("workspace").offsetWidth-i),this.float.style.left=s+"px",this.float.style.top=e+"px"},this.resizeStart=t=>{this.d=new a.A(this.float.clientHeight,t.y)},this.resizeMove=t=>{const e=this.d.x+(t.y-this.d.y);this.float.style.height=(e<320?320:e)+"px"},this.keyDown=t=>{"Enter"!==t.key&&"Escape"!==t.key||this.cleanUp()},this.superCleanUp=()=>{var t;document.removeEventListener("keydown",this.keyDown,!1),this.float.remove(),this.float=null,null===(t=this.modal)||void 0===t||t.remove(),this.modal=null},this.cleanUp=()=>{this.superCleanUp()},this.parent=t,this.mid=i.r0(),this.parent){let t;document.addEventListener("keydown",this.keyDown,!1),this.modal=(0,o.T)("div",{id:"modal-"+this.mid,className:"modal"}),this.modal.addEventListener("mousedown",(e=>{t=e.target})),this.modal.addEventListener("mouseup",(e=>{e.target===t&&e.target===this.modal&&this.cleanUp()})),document.body.appendChild(this.modal)}this.float=(0,o.T)("div",{className:"float"}),this.modal?this.modal.appendChild(this.float):(0,o.Ay)("workspace").append(this.float),this.content=(0,o.T)("div",{className:"content"});const r=(0,o.T)("div",{id:"float-title-"+this.mid,className:"title"},e);if((0,o.Bb)(r,this.dragStart,this.dragMove,this.dragEnd),this.float.append(r,(0,o.T)("img",{id:"float-close"+this.mid,className:"close ic",src:"/img/icon/close.svg",onclick:()=>this.cleanUp()}),(0,o.T)("div",{className:"splitter small"}),this.content),s){const t=(0,o.T)("img",{id:"resize-"+this.mid,src:"/img/icon/three-dot.svg",className:"resize ic"});(0,o.Bb)(t,this.resizeStart,this.resizeMove),this.float.append(t)}this.position()}}},55696:(t,e,s)=>{s.a(t,(async(t,i)=>{try{s.r(e);var a=s(29755),n=s(57695),o=t([n]);if(n=(o.then?(await o)():o)[0],"cGl4bHIuY29t"!==window.btoa(document.location.hostname.split(".").slice(-2).join(".")))throw new Error;a.Ay.product="editor";new n.A;i()}catch(r){i(r)}}))},87257:(t,e,s)=>{s.d(e,{A:()=>S});var i=s(42268),a=s(75770),n=s(22866),o=s(26651),r=s(21742),h=s(54738),l=s(40963),c=s(41915),d=s(29755);class u{constructor(t,e,s,i,a,n){this.p0=t,this.p1=e,this.p2=s,this.t0=i,this.t1=a,this.t2=n}}var p=s(97266);class g{constructor(t,e){if(this.addPointer=t=>{this.pointers.push(t),this.modal.setPointerCapture(t)},this.removePointer=t=>{for(let e=0;e<this.pointers.length;e++)if(this.pointers[e]===t){this.pointers.splice(e,1);break}this.modal.releasePointerCapture(t)},this.pointerDown=t=>{if(t.stopPropagation(),this.stage.coating.override||t.button>0)return;this.addPointer(t.pointerId);const e=d.Ay.isHDPI?2:1;1===this.pointers.length&&this.down(new c.A((t.offsetX-this.stage.canvas.offsetLeft)*e,(t.offsetY-this.stage.canvas.offsetTop)*e))},this.pointerMove=t=>{t.stopPropagation();const e=d.Ay.isHDPI?2:1;this.move(new c.A((t.offsetX-this.stage.canvas.offsetLeft)*e,(t.offsetY-this.stage.canvas.offsetTop)*e))},this.pointerUp=t=>{t.stopPropagation(),this.removePointer(t.pointerId);const e=d.Ay.isHDPI?2:1;this.up(new c.A((t.offsetX-this.stage.canvas.offsetLeft)*e,(t.offsetY-this.stage.canvas.offsetTop)*e))},this.keyDown=t=>{if(27!==t.keyCode){if(13!==t.keyCode)return 32===t.keyCode?(this.stage.coating.setPan(this.modal),void t.preventDefault()):void 0;this.apply()}else this.cancel()},this.keyUp=t=>{if(32===t.keyCode)return this.stage.coating.removePan(this.modal),this.split=28,void this.render()},this.inputPosition=t=>{this.TL.x=Number((0,i.Ay)("distort-x1").value),this.TL.y=Number((0,i.Ay)("distort-y1").value),this.TR.x=Number((0,i.Ay)("distort-x2").value),this.TR.y=Number((0,i.Ay)("distort-y2").value),this.BL.x=Number((0,i.Ay)("distort-x3").value),this.BL.y=Number((0,i.Ay)("distort-y3").value),this.BR.x=Number((0,i.Ay)("distort-x4").value),this.BR.y=Number((0,i.Ay)("distort-y4").value),window.requestAnimationFrame(this.render)},this.updateInputs=()=>{(0,i.Ay)("distort-x1").value=Math.round(this.TL.x).toString(),(0,i.Ay)("distort-y1").value=Math.round(this.TL.y).toString(),(0,i.Ay)("distort-x2").value=Math.round(this.TR.x).toString(),(0,i.Ay)("distort-y2").value=Math.round(this.TR.y).toString(),(0,i.Ay)("distort-x3").value=Math.round(this.BL.x).toString(),(0,i.Ay)("distort-y3").value=Math.round(this.BL.y).toString(),(0,i.Ay)("distort-x4").value=Math.round(this.BR.x).toString(),(0,i.Ay)("distort-y4").value=Math.round(this.BR.y).toString()},this.down=async t=>{this.downPoint=this.stage.translateRasterToFresco(t),this.isControl(this.downPoint)?(this.split=8,this.isDown=!0,this.downPosition=this.ss.clone(),window.requestAnimationFrame(this.render)):this.isInside(this.downPoint)?(this.split=5,this.isMove=!0,this.isDown=!0,this.offset=new c.A,window.requestAnimationFrame(this.render)):this.choice()},this.move=t=>{t=this.stage.translateRasterToFresco(t),this.isDown?(this.isMove?(this.offset.x=this.downPoint.x-t.x,this.offset.y=this.downPoint.y-t.y):(this.ss.x=this.downPosition.x+(t.x-this.downPoint.x),this.ss.y=this.downPosition.y+(t.y-this.downPoint.y),this.updateInputs()),window.requestAnimationFrame(this.render)):this.isControl(t)?this.modal.style.cursor="pointer":this.isInside(t)?this.modal.style.cursor="move":this.modal.style.cursor="unset"},this.up=t=>{this.isDown&&(this.isMove&&(this.TL=this.TL.neg(this.offset),this.TR=this.TR.neg(this.offset),this.BL=this.BL.neg(this.offset),this.BR=this.BR.neg(this.offset)),this.split=28,this.ss=void 0,this.isDown=!1,this.isMove=!1,this.offset=void 0,this.downPoint=void 0,this.downPosition=void 0,window.requestAnimationFrame(this.render),this.updateInputs())},this.renderLow=()=>{this.split=5,this.renderControls(),this.renderPreview()},this.render=()=>{this.renderControls(),this.renderPreview(),this.stage.render()},this.renderPreview=()=>{let t=this.scratch.ctx;t.clearRect(0,0,t.canvas.width,t.canvas.height),t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high";const e=this.calculateGeometry();e.forEach((e=>{this.drawTriangle(t,e.p0.x,e.p0.y,e.p1.x,e.p1.y,e.p2.x,e.p2.y,e.t0.x,e.t0.y,e.t1.x,e.t1.y,e.t2.x,e.t2.y)})),this.split>=20&&(e.forEach((e=>{this.drawTriangle(t,e.p0.x,e.p0.y,e.p1.x,e.p1.y,e.p2.x,e.p2.y,e.t0.x,e.t0.y,e.t1.x,e.t1.y,e.t2.x,e.t2.y)})),e.forEach((e=>{this.drawTriangle(t,e.p0.x,e.p0.y,e.p1.x,e.p1.y,e.p2.x,e.p2.y,e.t0.x,e.t0.y,e.t1.x,e.t1.y,e.t2.x,e.t2.y)})),t.imageSmoothingEnabled=!0,e.forEach((e=>{this.drawTriangle(t,e.p0.x,e.p0.y,e.p1.x,e.p1.y,e.p2.x,e.p2.y,e.t0.x,e.t0.y,e.t1.x,e.t1.y,e.t2.x,e.t2.y)})))},this.calculateGeometry=()=>{let t=[];for(var e=this.split,s=this.split,i=this.offset?this.TL.neg(this.offset):this.TL,a=this.offset?this.TR.neg(this.offset):this.TR,n=this.offset?this.BR.neg(this.offset):this.BR,o=this.offset?this.BL.neg(this.offset):this.BL,r=o.x-i.x,h=o.y-i.y,l=n.x-a.x,d=n.y-a.y,p=this.patch.width,g=this.patch.height,m=0;m<e;++m)for(var v=m/e,y=(m+1)/e,f=i.x+r*v,w=i.y+h*v,x=a.x+l*v,b=a.y+d*v,A=i.x+r*y,k=i.y+h*y,S=a.x+l*y,E=a.y+d*y,C=0;C<s;++C){var T=C/s,L=(C+1)/s,M=S-A,P=E-k,D=f+(x-f)*T,z=w+(b-w)*T,I=f+(x-f)*L,F=w+(b-w)*L,_=A+M*L,R=k+P*L,N=A+M*T,B=k+P*T,O=T*p,U=L*p,q=v*g,H=y*g;t.push(new u(new c.A(D,z),new c.A(_,R),new c.A(N,B),new c.A(O,q),new c.A(U,H),new c.A(O,H))),t.push(new u(new c.A(D,z),new c.A(I,F),new c.A(_,R),new c.A(O,q),new c.A(U,q),new c.A(U,H)))}return t},this.drawTriangle=(t,e,s,i,a,n,o,r,h,l,c,d,u)=>{t.save(),t.beginPath(),t.moveTo(e,s),t.lineTo(i,a),t.lineTo(n,o),t.closePath(),t.clip();var p=r*(u-c)-l*u+d*c+(l-d)*h;if(0!==p){var g=-(h*(n-i)-c*n+u*i+(c-u)*e)/p,m=(c*o+h*(a-o)-u*a+(u-c)*s)/p,v=(r*(n-i)-l*n+d*i+(l-d)*e)/p,y=-(l*o+r*(a-o)-d*a+(d-l)*s)/p,f=(r*(u*i-c*n)+h*(l*n-d*i)+(d*c-l*u)*e)/p,w=(r*(u*a-c*o)+h*(l*o-d*a)+(d*c-l*u)*s)/p;t.transform(g,m,v,y,f,w),t.drawImage(this.patch,0,0),t.restore()}},this.renderControls=()=>{if(!this.stage||!this.stage.fresco||this.stage.supressRender)return;this.ctx.clearRect(0,0,this.raster.width,this.raster.height),d.Ay.isHDPI?this.ctx.lineWidth=2:(this.ctx.lineWidth=1,this.ctx.translate(.5,.5)),this.ctx.strokeStyle=h.q5,this.ctx.fillStyle=h.q5;const t=this.stage.translateFrescoToRaster(this.offset?this.TL.neg(this.offset):this.TL),e=this.stage.translateFrescoToRaster(this.offset?this.TR.neg(this.offset):this.TR),s=this.stage.translateFrescoToRaster(this.offset?this.BL.neg(this.offset):this.BL),i=this.stage.translateFrescoToRaster(this.offset?this.BR.neg(this.offset):this.BR);this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(e.x-1,e.y),this.ctx.lineTo(i.x-1,i.y-1),this.ctx.lineTo(s.x,s.y-1),this.ctx.lineTo(t.x,t.y),this.ctx.closePath(),this.ctx.stroke(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillStyle=h.bi;let a=8;d.Ay.isHDPI?(a=16,this.ctx.lineWidth=3):this.ctx.lineWidth=1.5,this.isDown&&this.ss&&this.ss!==this.TL||(this.ctx.beginPath(),this.ctx.arc(t.x,t.y,16,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()),this.isDown&&this.ss&&this.ss!==this.BL||(this.ctx.beginPath(),this.ctx.arc(s.x,s.y,16,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()),this.isDown&&this.ss&&this.ss!==this.TR||(this.ctx.beginPath(),this.ctx.arc(e.x,e.y,16,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()),this.isDown&&this.ss&&this.ss!==this.BR||(this.ctx.beginPath(),this.ctx.arc(i.x,i.y,16,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke())},this.isControl=t=>{let e=32/this.stage.zoom,s=e/2;return h.HO(this.TL.x-s,this.TL.y-s,e,e,t.x,t.y)?(this.ss=this.TL,!0):h.HO(this.TR.x-s,this.TR.y-s,e,e,t.x,t.y)?(this.ss=this.TR,!0):h.HO(this.BL.x-s,this.BL.y-s,e,e,t.x,t.y)?(this.ss=this.BL,!0):h.HO(this.BR.x-s,this.BR.y-s,e,e,t.x,t.y)?(this.ss=this.BR,!0):(this.ss=void 0,!1)},this.isInside=t=>this.scratch.ctx.getImageData(t.x,t.y,1,1).data[3]>0,this.choice=async()=>{const t=await new p.A("Apply","Do you want to apply the distort?","Yes","No","Cancel").init();void 0!==t&&(t?this.apply():this.cancel())},this.apply=async()=>{if(!(this.oTL.equalTo(this.TL)&&this.oTR.equalTo(this.TR)&&this.oBL.equalTo(this.BL)&&this.oBR.equalTo(this.BR))){let t=l.A.fromPoints([this.TL,this.TR,this.BL,this.BR]);this.split=64,this.offset=t.topLeft(),this.scratch.setTarget(this.selected.id,this.clone?t:new l.A(0,0,t.width,t.height),this.clone?"over":"replace"),this.renderPreview();const e=this.selected.rect.clone(),s=h.oM(this.clone?this.clone:this.selected.canvas);return this.clone?(this.selected.extendCanvas(t),this.scratch.drawToLayer(this.selected)):this.selected.switchCanvas(this.scratch.canvas,t),this.selected.render(),this.stage.history.add({type:"bitmapSwitch",kind:"distort",layer:this.selected,rect:e,canvas:s}),void this.callback(!!this.clone)}this.cancel()},this.cancel=()=>{this.clone&&(this.selected.canvas=this.clone),this.callback()},this.cleanUp=()=>{var t,e;this.modal&&(this.ctx.clearRect(0,0,this.raster.width,this.raster.width),this.stage&&this.stage.fresco&&(this.stage.fresco.removeScratch(),window.requestAnimationFrame(this.stage.render)),this.stage.coating.wake(),this.modal.removeEventListener("pointerdown",this.pointerDown,!1),this.modal.removeEventListener("pointermove",this.pointerMove,!1),this.modal.removeEventListener("pointerup",this.pointerUp,!1),this.modal.removeEventListener("dblclick",this.choice,!1),this.modal.removeEventListener("wheel",this.stage.coating.mouseWheel),this.modal.removeEventListener("contextmenu",(t=>{t.preventDefault()}),!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),document.removeEventListener("viewport-render",this.renderLow),(0,i.Ay)("distort-apply").removeEventListener("click",this.apply,!1),(0,i.Ay)("distort-cancel").removeEventListener("click",this.cancel,!1),(0,i.Ay)("distort-x1").removeEventListener("input",this.inputPosition,!1),(0,i.Ay)("distort-y1").removeEventListener("input",this.inputPosition,!1),(0,i.Ay)("distort-x2").removeEventListener("input",this.inputPosition,!1),(0,i.Ay)("distort-y2").removeEventListener("input",this.inputPosition,!1),(0,i.Ay)("distort-x3").removeEventListener("input",this.inputPosition,!1),(0,i.Ay)("distort-y3").removeEventListener("input",this.inputPosition,!1),(0,i.Ay)("distort-x4").removeEventListener("input",this.inputPosition,!1),(0,i.Ay)("distort-y4").removeEventListener("input",this.inputPosition,!1),null===(t=this.modal)||void 0===t||t.remove(),this.modal=void 0,null===(e=this.options)||void 0===e||e.remove(),this.options=void 0,this.scratch=void 0,this.raster=void 0,this.stage=void 0,this.ctx=void 0)},this.stage=t,this.callback=e,this.ctx=t.coating.ctx,this.raster=t.coating.raster,this.stage.fresco&&this.stage.fresco.isSelectedImageWithCanvas()){if(this.pointers=new Array,this.selected=this.stage.fresco.getSelected(),this.stage.fresco.hasSelection()){this.clone=h.oM(this.selected.canvas);const[t,e]=this.stage.primeCut();if(!t)return void this.callback();this.patch=t,this.oTL=e.topLeft(),this.oTR=e.topRight(),this.oBL=e.bottomLeft(),this.oBR=e.bottomRight()}else this.patch=this.selected.canvas,this.oTL=this.selected.rect.topLeft(),this.oTR=this.selected.rect.topRight(),this.oBL=this.selected.rect.bottomLeft(),this.oBR=this.selected.rect.bottomRight();this.stage.coating.sleep(),this.offset=new c.A,this.TL=this.oTL.clone(),this.TR=this.oTR.clone(),this.BL=this.oBL.clone(),this.BR=this.oBR.clone(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new l.A(0,0,this.stage.fresco.width,this.stage.fresco.height),this.clone?"over":"replace"),this.modal=(0,i.T)("div",{id:"modal-distort",className:"modal"}),(0,i.Ay)("workspace").appendChild(this.modal),this.options=(0,i.T)("div",{id:"distort",className:"option-float option active"},(0,i.T)("div",{className:"option-icon"},(0,i.T)("img",{src:"/img/tool/distort.svg",className:"ic"})),(0,i.T)("div",{id:"distort-settings"},(0,i.T)("label",{className:"tab-10"},"Left top:"),(0,i.T)("input",{type:"number",id:"distort-x1"}),(0,i.T)("label",{className:"tab-5"},"x"),(0,i.T)("input",{type:"number",id:"distort-y1"}),(0,i.T)("label",{className:"tab-20"},"Right top:"),(0,i.T)("input",{type:"number",id:"distort-x2"}),(0,i.T)("label",{className:"tab-5"},"x"),(0,i.T)("input",{type:"number",id:"distort-y2"}),(0,i.T)("label",{className:"tab-20"},"Left bottom:"),(0,i.T)("input",{type:"number",id:"distort-x3"}),(0,i.T)("label",{className:"tab-5"},"x"),(0,i.T)("input",{type:"number",id:"distort-y3"}),(0,i.T)("label",{className:"tab-20"},"Right bottom:"),(0,i.T)("input",{type:"number",id:"distort-x4"}),(0,i.T)("label",{className:"tab-5"},"x"),(0,i.T)("input",{type:"number",id:"distort-y4"}),(0,i.T)("a",{className:"button outline tab-30",id:"distort-cancel"},(0,i.T)("img",{src:"/img/icon/close.svg",width:10,height:10,className:"ic"}),(0,r.A)("cancel")),(0,i.T)("a",{className:"button outline tab-10",id:"distort-apply"},(0,i.T)("img",{src:"/img/icon/check.svg",width:16,height:16,className:"ic"}),(0,r.A)("apply")))),(0,i.Ay)("workspace").appendChild(this.options),(0,i.Ay)("distort-apply").addEventListener("click",this.apply,!1),(0,i.Ay)("distort-cancel").addEventListener("click",this.cancel,!1),(0,i.Ay)("distort-x1").addEventListener("input",this.inputPosition,!1),(0,i.Ay)("distort-y1").addEventListener("input",this.inputPosition,!1),(0,i.Ay)("distort-x2").addEventListener("input",this.inputPosition,!1),(0,i.Ay)("distort-y2").addEventListener("input",this.inputPosition,!1),(0,i.Ay)("distort-x3").addEventListener("input",this.inputPosition,!1),(0,i.Ay)("distort-y3").addEventListener("input",this.inputPosition,!1),(0,i.Ay)("distort-x4").addEventListener("input",this.inputPosition,!1),(0,i.Ay)("distort-y4").addEventListener("input",this.inputPosition,!1),this.split=28,this.modal.addEventListener("pointerdown",this.pointerDown,!1),this.modal.addEventListener("pointermove",this.pointerMove,!1),this.modal.addEventListener("pointerup",this.pointerUp,!1),this.modal.addEventListener("dblclick",this.choice,!1),this.modal.addEventListener("wheel",this.stage.coating.mouseWheel,{passive:!1}),this.modal.addEventListener("contextmenu",(t=>{t.preventDefault()}),!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),document.addEventListener("viewport-render",this.renderLow),window.requestAnimationFrame(this.render),this.updateInputs()}else this.callback()}}var m=s(82042),v=s(7245),y=s(21404);class f{constructor(t,e){if(this.addPointer=t=>{this.pointers.push(t),this.modal.setPointerCapture(t)},this.removePointer=t=>{for(let e=0;e<this.pointers.length;e++)if(this.pointers[e]===t){this.pointers.splice(e,1);break}this.modal.releasePointerCapture(t)},this.pointerDown=t=>{if(t.stopPropagation(),this.stage.coating.override||t.button>0)return;this.isDown=!0,this.addPointer(t.pointerId);let e=new c.A(t.offsetX-this.stage.canvas.offsetLeft,t.offsetY-this.stage.canvas.offsetTop);if(!h.HO(0,0,this.raster.offsetWidth,this.raster.offsetHeight,e.x,e.y))return console.log("here"),void this.choice();const s=d.Ay.isHDPI?2:1;1===this.pointers.length&&this.down(new c.A(e.x*s,e.y*s))},this.pointerMove=t=>{t.stopPropagation();const e=d.Ay.isHDPI?2:1;this.pointers.length<2&&this.move(new c.A((t.offsetX-this.stage.canvas.offsetLeft)*e,(t.offsetY-this.stage.canvas.offsetTop)*e))},this.pointerUp=t=>{t.stopPropagation(),this.isDown=!1,this.removePointer(t.pointerId);const e=d.Ay.isHDPI?2:1;this.up(new c.A((t.offsetX-this.stage.canvas.offsetLeft)*e,(t.offsetY-this.stage.canvas.offsetTop)*e))},this.inputPosition=t=>{let e=(0,i.Ay)("transform-top").value,s=(0,i.Ay)("transform-left").value,a=new c.A(Math.round(Number(s)),Math.round(Number(e)));this.layer.rect.x=a.x,this.layer.rect.y=a.y,this.renderAll()},this.inputSize=t=>{if("transform-width"==t.currentTarget.id){let t=(0,i.Ay)("transform-width").value,e=Number.isNaN(Number(t))?50:Math.round(Number(t));this.layer.setWidth(e,this.orgRect.getAspect()),(0,i.Ay)("transform-height").value=Math.round(this.layer.rect.height).toString()}else{let t=(0,i.Ay)("transform-height").value,e=Number.isNaN(Number(t))?50:Math.round(Number(t));this.layer.setHeight(e,this.orgRect.getAspect()),(0,i.Ay)("transform-width").value=Math.round(this.layer.rect.width).toString()}this.renderAll()},this.updateInputs=()=>{(0,i.Ay)("transform-width").value=Math.round(this.layer.rect.width).toString(),(0,i.Ay)("transform-height").value=Math.round(this.layer.rect.height).toString(),(0,i.Ay)("transform-top").value=Math.round(this.layer.rect.y).toString(),(0,i.Ay)("transform-left").value=Math.round(this.layer.rect.x).toString(),this.rotation.setValue(this.layer.rect.rotation)},this.keyDown=t=>{if("ArrowUp"===t.key||"ArrowDown"===t.key||"ArrowLeft"===t.key||"ArrowRight"===t.key){let e=t.shiftKey?10:1,s="ArrowLeft"===t.key||"ArrowRight"===t.key?"ArrowLeft"===t.key?-e:e:0,i="ArrowUp"===t.key||"ArrowDown"===t.key?"ArrowUp"===t.key?-e:e:0;this.step(s,i)}if("Escape"!==t.key)if("Enter"!==t.key){if("Shift"!==t.key)return" "===t.key?(this.stage.coating.setPan(this.modal),void t.preventDefault()):void 0;this.isShiftDown=!0}else this.apply();else this.cancel()},this.keyUp=t=>{"Shift"===t.key&&(this.isShiftDown=!1)," "!==t.key||this.stage.coating.removePan(this.modal)},this.down=t=>{if(this.isControl(t)){if(this.isDown=!0,this.downControl=this.layer.rect.topLeft(),this.downPoint=this.stage.translateRasterToFresco(t),"rotate"===this.method){let t=this.layer.rect.center();this.downRotation=180/Math.PI*Math.atan2(this.downPoint.y-t.y,this.downPoint.x-t.x)-this.layer.rect.rotation}else if("move"!==this.method){const t=this.layer.rect,e=t.center();let s,i;switch(this.matrix.reset(),this.matrix.translate(e),this.matrix.rotateDegree(360-this.layer.rect.rotation),this.matrix.invert(),this.method){case"nw-resize":i=t.topLeft(),s=t.bottomRight();break;case"n-resize":i=new c.A(e.x,t.y),s=new c.A(e.x,t.bottom());break;case"ne-resize":i=t.topRight(),s=t.bottomLeft();break;case"e-resize":i=new c.A(t.right(),e.y),s=new c.A(t.x,e.y);break;case"se-resize":i=t.bottomRight(),s=t.topLeft();break;case"s-resize":i=new c.A(e.x,t.bottom()),s=new c.A(e.x,t.y);break;case"sw-resize":i=t.bottomLeft(),s=t.topRight();break;case"w-resize":i=new c.A(t.x,e.y),s=new c.A(t.right(),e.y)}this.downControl=this.matrix.transformPoint(i).add(e),this.downAnchor=this.matrix.transformPoint(s).add(e)}}else this.choice()},this.getAnchor=()=>{const t=this.layer.rect,e=t.center();let s;switch(this.matrix.reset(),this.matrix.translate(e),this.matrix.rotateDegree(360-this.layer.rect.rotation),this.matrix.invert(),this.method){case"nw-resize":s=t.bottomRight();break;case"n-resize":s=new c.A(e.x,t.bottom());break;case"ne-resize":s=t.bottomLeft();break;case"e-resize":s=new c.A(t.x,e.y);break;case"se-resize":s=t.topLeft();break;case"s-resize":s=new c.A(e.x,t.y);break;case"sw-resize":s=t.topRight();break;case"w-resize":s=new c.A(t.right(),e.y)}return this.matrix.transformPoint(s).add(e)},this.move=t=>{if(!this.isDown)return void this.isControl(t);let e=this.stage.translateRasterToFresco(t);if("move"===this.method){if(this.isShiftDown){const t=Math.abs(this.downPoint.x-e.x),s=Math.abs(this.downPoint.y-e.y);(t>4||s>4)&&(t<s?(e.x=this.downPoint.x,this.method="vertical"):(e.y=this.downPoint.y,this.method="horizontal"))}this.layer.rect.x=Math.round(this.downControl.x+(e.x-this.downPoint.x)),this.layer.rect.y=Math.round(this.downControl.y+(e.y-this.downPoint.y)),this.checkGuides(this.layer)}else if("vertical"===this.method)this.isShiftDown||(this.method="move"),this.layer.rect.y=Math.round(this.downControl.y+(e.y-this.downPoint.y)),this.checkGuides(this.layer);else if("horizontal"===this.method)this.isShiftDown||(this.method="move"),this.layer.rect.x=Math.round(this.downControl.x+(e.x-this.downPoint.x)),this.checkGuides(this.layer);else if("rotate"===this.method){const s=this.layer.rect.center();let i=180/Math.PI*Math.atan2(e.y-s.y,e.x-s.x)-this.downRotation;this.isShiftDown&&(i=11.25*Math.round(i/11.25)),i<0?i+=360:i>=360&&(i-=360),this.layer.rect.rotation=i,this.updateRotatingCursor(t)}else{let t=e.neg(this.downPoint),s=this.downAnchor,i=this.downControl.add(t);if(0!==this.layer.rect.rotation){const t=new c.A((s.x+i.x)/2,(s.y+i.y)/2);this.matrix.reset(),this.matrix.translate(t),this.matrix.rotateDegree(this.layer.rect.rotation),this.matrix.invert(),i=this.matrix.transformPoint(i).add(t),s=this.matrix.transformPoint(s).add(t)}switch(this.method){case"nw-resize":this.layer.calculate(i,s,this.isShiftDown?0:this.orgRect.getAspect());break;case"ne-resize":this.layer.calculate(new c.A(s.x,i.y),new c.A(i.x,s.y),this.isShiftDown?0:this.orgRect.getAspect());break;case"sw-resize":this.layer.calculate(new c.A(i.x,s.y),new c.A(s.x,i.y),this.isShiftDown?0:this.orgRect.getAspect());break;case"se-resize":this.layer.calculate(s,i,this.isShiftDown?0:this.orgRect.getAspect());break;case"n-resize":this.layer.rect.y=i.y,this.layer.rect.height=s.y-i.y,this.layer.rect.height<10&&(this.layer.rect.height=10);break;case"s-resize":this.layer.rect.y=s.y,this.layer.rect.height=i.y-s.y,this.layer.rect.height<10&&(this.layer.rect.height=10);break;case"w-resize":this.layer.rect.x=i.x,this.layer.rect.width=s.x-i.x,this.layer.rect.width<10&&(this.layer.rect.width=10);break;case"e-resize":this.layer.rect.x=s.x,this.layer.rect.width=i.x-s.x,this.layer.rect.width<10&&(this.layer.rect.width=10)}let a=this.downAnchor.neg(this.getAnchor());this.layer.rect.x+=a.x,this.layer.rect.y+=a.y}this.updateInputs(),this.renderAll()},this.up=t=>{this.guides=void 0,this.isDown=!1,this.renderAll()},this.step=(t,e)=>{this.layer.rect.x+=t,this.layer.rect.y+=e,this.updateInputs(),this.renderAll()},this.renderAll=()=>{window.requestAnimationFrame((()=>{this.stage.render(),this.render()}))},this.render=()=>{if(!this.ctx)return;this.ctx.clearRect(0,0,this.raster.width,this.raster.height),d.Ay.isHDPI?this.ctx.lineWidth=2:(this.ctx.lineWidth=1,this.ctx.translate(.5,.5)),this.ctx.strokeStyle=h.q5,this.ctx.fillStyle=h.q5;let t=this.stage.getLayerLocationRect(this.layer);if(t){if(0!==this.layer.rect.rotation){let e=t.center();this.ctx.translate(e.x,e.y),this.ctx.rotate(this.layer.rect.rotation*Math.PI/180),t.x-=e.x,t.y-=e.y}if(this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(t.right()-1,t.y),this.ctx.lineTo(t.right()-1,t.bottom()-1),this.ctx.lineTo(t.x,t.bottom()-1),this.ctx.lineTo(t.x,t.y),this.ctx.closePath(),this.ctx.stroke(),!this.isDown){0===this.layer.rect.rotation&&this.ctx.setTransform(1,0,0,1,0,0);var e=t.center();e.x=Math.round(e.x),e.y=Math.round(e.y),this.ctx.fillRect(t.x-6,t.y-6,12,12),this.ctx.fillRect(t.x-6,t.y+t.height-6,12,12),this.ctx.fillRect(t.x+t.width-6,t.y-6,12,12),this.ctx.fillRect(t.x+t.width-6,t.y+t.height-6,12,12),t.width>100&&(this.ctx.fillRect(e.x-12,t.y-5,24,8),this.ctx.fillRect(e.x-12,t.y+t.height-3,24,8)),t.height>100&&(this.ctx.fillRect(t.x-5,e.y-12,8,24),this.ctx.fillRect(t.x+t.width-3,e.y-12,8,24)),this.ctx.fillStyle=h.bi,this.ctx.fillRect(t.x-5,t.y-5,10,10),this.ctx.fillRect(t.x-5,t.y+t.height-5,10,10),this.ctx.fillRect(t.x+t.width-5,t.y-5,10,10),this.ctx.fillRect(t.x+t.width-5,t.y+t.height-5,10,10),t.width>100&&(this.ctx.fillRect(e.x-11,t.y-4,22,6),this.ctx.fillRect(e.x-11,t.y+t.height-2,22,6)),t.height>100&&(this.ctx.fillRect(t.x-4,e.y-11,6,22),this.ctx.fillRect(t.x+t.width-2,e.y-11,6,22))}this.ctx.setTransform(1,0,0,1,0,0),d.Ay.showGuides&&this.guides&&this.guides.length>0&&(d.Ay.isHDPI||this.ctx.translate(.5,.5),this.ctx.strokeStyle=h.Al,this.guides.forEach((t=>{this.ctx.beginPath(),this.ctx.moveTo(t.start.x,t.start.y),this.ctx.lineTo(t.end.x,t.end.y),this.ctx.closePath(),this.ctx.stroke()})),this.ctx.setTransform(1,0,0,1,0,0))}},this.isControl=t=>{const e=2*this.hitSize,s=this.stage.getLayerLocationRect(this.layer);if(!s)return;if(0!==this.layer.rect.rotation){let e=s.center();this.matrix.reset(),this.matrix.translate(e),this.matrix.rotateDegree(this.layer.rect.rotation),this.matrix.invert(),t=this.matrix.transformPoint(t).add(e)}if(h.HO(s.x-this.hitSize,s.y-this.hitSize,e,e,t.x,t.y))return this.modal.style.cursor=this.getRotatedCursor(315),this.method="nw-resize",!0;if(h.HO(s.x+s.width-this.hitSize,s.y-this.hitSize,e,e,t.x,t.y))return this.modal.style.cursor=this.getRotatedCursor(45),this.method="ne-resize",!0;if(h.HO(s.x-this.hitSize,s.y+s.height-this.hitSize,e,e,t.x,t.y))return this.modal.style.cursor=this.getRotatedCursor(225),this.method="sw-resize",!0;if(h.HO(s.x+s.width-this.hitSize,s.y+s.height-this.hitSize,e,e,t.x,t.y))return this.modal.style.cursor=this.getRotatedCursor(135),this.method="se-resize",!0;const i=s.width/2,a=s.height/2;return h.HO(s.x+i-30,s.y-this.hitSize,60,e,t.x,t.y)?(this.modal.style.cursor=this.getRotatedCursor(0),this.method="n-resize",!0):h.HO(s.x+i-30,s.y+s.height-this.hitSize,60,e,t.x,t.y)?(this.modal.style.cursor=this.getRotatedCursor(180),this.method="s-resize",!0):h.HO(s.x-this.hitSize,s.y+a-30,e,60,t.x,t.y)?(this.modal.style.cursor=this.getRotatedCursor(90),this.method="w-resize",!0):h.HO(s.x+s.width-this.hitSize,s.y+a-30,e,60,t.x,t.y)?(this.modal.style.cursor=this.getRotatedCursor(270),this.method="e-resize",!0):h.HO(s.x,s.y,s.width,s.height,t.x,t.y)?(this.modal.style.cursor="move",this.method="move",!0):h.HO(s.x+s.width-100,s.y-100,200,200,t.x,t.y)?(this.modal.style.cursor=this.getRotatedCursor(45,!1),this.method="rotate",!0):h.HO(s.x+s.width-100,s.y+s.height-100,200,200,t.x,t.y)?(this.modal.style.cursor=this.getRotatedCursor(135,!1),this.method="rotate",!0):h.HO(s.x-100,s.y+s.height-100,200,200,t.x,t.y)?(this.modal.style.cursor=this.getRotatedCursor(225,!1),this.method="rotate",!0):h.HO(s.x-100,s.y-100,200,200,t.x,t.y)?(this.modal.style.cursor=this.getRotatedCursor(315,!1),this.method="rotate",!0):(this.modal.style.cursor=this.method="unset",!1)},this.updateRotatingCursor=t=>{const e=this.stage.getLayerLocationRect(this.layer);if(!e)return;let s=e.center();this.matrix.reset(),this.matrix.translate(s),this.matrix.rotate(this.layer.rect.rotation*Math.PI/180),this.matrix.invert(),t=this.matrix.transformPoint(t).add(s),h.HO(e.x+e.width-100,e.y-100,200,200,t.x,t.y)?this.modal.style.cursor=this.getRotatedCursor(45,!1):h.HO(e.x+e.width-100,e.y+e.height-100,200,200,t.x,t.y)?this.modal.style.cursor=this.getRotatedCursor(135,!1):h.HO(e.x-100,e.y+e.height-100,200,200,t.x,t.y)?this.modal.style.cursor=this.getRotatedCursor(225,!1):h.HO(e.x-100,e.y-100,200,200,t.x,t.y)&&(this.modal.style.cursor=this.getRotatedCursor(315,!1))},this.getRotatedCursor=(t,e=!0)=>{const s=["n","ne","e","se","s","sw","w","nw"];let i=t+this.layer.rect.rotation;i<0&&(i+=360),i>360&&(i-=360),i+=22.5;let a=7;for(;a>0&&!(i>45*a&&i<360);)a--;return e?s[a]+"-resize":"url('/img/cursor/rotate-"+s[a]+".svg') 16 16, auto"},this.checkGuides=t=>{if(d.Ay.showGuides||d.Ay.snapToGuides){this.guides=[];let e=d.Ay.snapToGuides,s=5/this.stage.zoom,i=this.stage.fresco.width/2,a=this.stage.fresco.height/2,n=t.rect,o=n.center(),r=new l.A(this.stage.offset.x,this.stage.offset.y,Math.round(this.stage.fresco.width*this.stage.zoom),Math.round(this.stage.fresco.height*this.stage.zoom));o.x<i+s&&o.x>i-s&&(e&&(n.x=Math.round(i-n.width/2)),this.guides.push(new v.A(new c.A(Math.round(r.center().x),r.y),new c.A(Math.round(r.center().x),r.bottom()-1)))),o.y<a+s&&o.y>a-s&&(e&&(n.y=Math.round(a-n.height/2)),this.guides.push(new v.A(new c.A(r.x,Math.round(r.center().y)),new c.A(r.right()-1,Math.round(r.center().y))))),n.x<0+s&&n.x>0-s&&(e&&(n.x=0),this.guides.push(new v.A(new c.A(r.x,r.y),new c.A(r.x,r.bottom()-1)))),n.right()<this.stage.fresco.width+s&&n.right()>this.stage.fresco.width-s&&(e&&n.moveRight(this.stage.fresco.width),this.guides.push(new v.A(new c.A(r.right()-1,r.y),new c.A(r.right()-1,r.bottom()-1)))),n.y<0+s&&n.y>0-s&&(e&&(n.y=0),this.guides.push(new v.A(new c.A(r.x,r.y),new c.A(r.right()-1,r.y)))),n.bottom()<this.stage.fresco.height+s&&n.bottom()>this.stage.fresco.height-s&&(e&&n.moveBottom(this.stage.fresco.height),this.guides.push(new v.A(new c.A(r.x,r.bottom()-1),new c.A(r.right()-1,r.bottom()-1))))}},this.choice=async()=>{const t=await new p.A("Apply","Do you want to apply the transform?","Yes","No","Cancel").init();void 0!==t&&(t?this.apply():this.cancel())},this.apply=()=>{if(this.clone){if(!this.orgRect.equalTo(this.layer.rect)){const t=this.stage.fresco.getSelected(),e=h.oM(this.clone),s=t.rect.clone();return 0!==this.layer.rect.rotation&&(this.layer.rect=this.layer.rect.getRotatedBounds(),this.layer.canvas=h.oc(this.layer.canvas,this.layer.rect.rotation,this.layer.rect),this.layer.rect.rotation=0),t.extendCanvas(this.layer.rect),this.layer.drawToLayer(t),this.stage.history.add({type:"bitmapSwitch",kind:"transform",layer:t,rect:s,canvas:e}),this.layer.render(),void this.callback(!0)}this.stage.fresco.getSelected().canvas=this.clone}else{if(this.layer.wouldApplyTransform()){const t=h.oM(this.layer.canvas),e=h.oM(this.layer.mask);this.layer.applyTransform(),this.stage.history.add({type:"arrange",kind:"transform",layer:this.layer,action:{type:"trans",data:t,mask:e,rect:this.orgRect}})}else this.layer.rect.x===this.orgRect.x&&this.layer.rect.y===this.orgRect.y||this.stage.history.add({type:"arrange",kind:"arrange",layer:this.layer,action:{type:"rect",rect:this.orgRect}})}this.callback()},this.cancel=()=>{this.clone&&(this.stage.fresco.getSelected().canvas=this.clone),this.layer.rect=this.orgRect,this.callback()},this.cleanUp=()=>{if(this.modal){this.ctx.clearRect(0,0,this.raster.width,this.raster.width),this.stage&&this.stage.fresco&&(this.stage.fresco.removeScratch(),window.requestAnimationFrame(this.stage.render)),this.stage.coating.wake();for(let t=0;t<this.pointers.length;t++)this.modal.releasePointerCapture(this.pointers[t]);this.modal.removeEventListener("pointerdown",this.pointerDown,!1),this.modal.removeEventListener("pointermove",this.pointerMove,!1),this.modal.removeEventListener("pointerup",this.pointerUp,!1),this.modal.removeEventListener("dblclick",this.choice,!1),this.modal.removeEventListener("wheel",this.stage.coating.mouseWheel),this.modal.removeEventListener("contextmenu",(t=>{t.preventDefault()}),!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),document.removeEventListener("viewport-render",this.render),(0,i.Ay)("transform-apply").removeEventListener("click",this.apply,!1),(0,i.Ay)("transform-cancel").removeEventListener("click",this.cancel,!1),(0,i.Ay)("transform-width").removeEventListener("input",this.inputSize,!1),(0,i.Ay)("transform-height").removeEventListener("input",this.inputSize,!1),(0,i.Ay)("transform-top").removeEventListener("input",this.inputPosition,!1),(0,i.Ay)("transform-left").removeEventListener("input",this.inputPosition,!1),this.rotation.cleanUp(),this.rotation=void 0,this.modal&&(this.modal.remove(),this.modal=void 0),this.options&&(this.options.remove(),this.options=void 0),this.layer=void 0,this.raster=void 0,this.stage=void 0,this.clone=void 0,this.ctx=void 0}},this.stage=t,this.callback=e,this.ctx=t.coating.ctx,this.raster=t.coating.raster,!this.stage.fresco.isSelectedImageWithCanvas())return void this.callback();this.pointers=new Array;const s=this.stage.fresco.getSelected();if(this.stage.fresco.hasSelection()){this.clone=h.oM(s.canvas);const[t,e]=this.stage.primeCut();if(!t)return void this.callback();this.stage.coating.sleep(),this.layer=this.stage.fresco.addScratch(),this.layer.setTarget(s.id,e,"over",t),this.orgRect=e.clone()}else this.layer=s,this.orgRect=this.layer.rect.clone();this.modal=(0,i.T)("div",{id:"modal-transform",className:"modal"}),(0,i.Ay)("workspace").appendChild(this.modal),this.options=(0,i.T)("div",{id:"transform",className:"option-float option active"},(0,i.T)("div",{className:"option-icon"},(0,i.T)("img",{src:"/img/tool/transform.svg",className:"ic"})),(0,i.T)("div",{id:"transform-settings"},(0,i.T)("label",{className:"tab-10"},"Left:"),(0,i.T)("input",{type:"number",id:"transform-left"}),(0,i.T)("label",{className:"tab-10"},"Top:"),(0,i.T)("input",{type:"number",id:"transform-top"}),(0,i.T)("label",{className:"tab-10"},"Width:"),(0,i.T)("input",{type:"number",id:"transform-width"}),(0,i.T)("label",{className:"tab-10"},"Height:"),(0,i.T)("input",{type:"number",id:"transform-height"}),(0,i.T)("div",{className:"tab-20 range-box",id:"transform-rotation"}),(0,i.T)("a",{className:"button outline tab-30",id:"transform-cancel"},(0,i.T)("img",{src:"/img/icon/close.svg",width:10,height:10,className:"ic"}),(0,r.A)("cancel")),(0,i.T)("a",{className:"button outline tab-10",id:"transform-apply"},(0,i.T)("img",{src:"/img/icon/check.svg",width:16,height:16,className:"ic"}),(0,r.A)("apply")))),(0,i.Ay)("workspace").appendChild(this.options),this.rotation=new m.A("transform-rotation",{compact:!0,label:"Rotation:",step:.1,range:[-180,180],labelFormat:t=>t.toFixed(1)+"°",labelParse:t=>parseFloat(t),onChange:t=>{this.layer.rect.rotation=t,this.renderAll()},onEnd:t=>{this.updateInputs()}}),(0,i.Ay)("transform-apply").addEventListener("click",this.apply,!1),(0,i.Ay)("transform-cancel").addEventListener("click",this.cancel,!1),(0,i.Ay)("transform-width").addEventListener("input",this.inputSize,!1),(0,i.Ay)("transform-height").addEventListener("input",this.inputSize,!1),(0,i.Ay)("transform-top").addEventListener("input",this.inputPosition,!1),(0,i.Ay)("transform-left").addEventListener("input",this.inputPosition,!1),this.matrix=new y.A,this.hitSize=d.Ay.isHDPI?d.Ay.canTouch?44:32:16,this.modal.addEventListener("pointerdown",this.pointerDown,!1),this.modal.addEventListener("pointermove",this.pointerMove,!1),this.modal.addEventListener("pointerup",this.pointerUp,!1),this.modal.addEventListener("dblclick",this.choice,!1),this.modal.addEventListener("wheel",this.stage.coating.mouseWheel,{passive:!1}),this.modal.addEventListener("contextmenu",(t=>{t.preventDefault()}),!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),document.addEventListener("viewport-render",this.render),window.requestAnimationFrame(this.render),this.updateInputs()}}var w=s(21079);class x extends a.A{constructor(t){super("selectron",t),this.mode=void 0,this.moveLock="none",this.proxy=t=>{if("cut"===this.mode&&t.target!==this.stage.raster)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),void this.cleanCut()},this.contextMenu=t=>{t.preventDefault(),t.stopPropagation(),new w.Ay(new c.A(t.clientX,t.clientY),[new w.kt((0,r.A)("titleSelectAll"),(()=>{this.cleanCut(),this.stage.selectionAll()}),"Ctrl + A"),new w.kt((0,r.A)("titleSelectPixels"),(()=>{this.cleanCut(),this.stage.selectionPixels()})),new w.kt((0,r.A)("titleSelectSubject"),(()=>{this.cleanCut(),this.stage.selectionSubject()})),new w.kt((0,r.A)("titleSelectDeselect"),(()=>{this.cleanCut(),this.stage.selectionDeselect()}),"Ctrl + D"),new w.kt((0,r.A)("titleSelectInvert"),(()=>{this.cleanCut(),this.stage.selectionInvert()}),"Ctrl + I"),new w.kt])},this.keyDown=t=>{if(!this.isDown){if("cut"===this.mode){if("Escape"===t.key)return this.stage.fresco.selection.offset=new c.A,this.stage.fresco.getSelected().canvas=this.clone,this.stage.fresco.removeScratch(),this.mode=void 0,void window.requestAnimationFrame((()=>{this.stage.coating.render(),this.stage.render()}));if("Enter"===t.key)return void this.cleanCut()}if(t.keyCode>=37&&t.keyCode<=40){if("cut"!==this.mode){this.mode=t.ctrlKey?"copy":"cut",this.clone="cut"===this.mode?h.oM(this.stage.fresco.getSelected().canvas):void 0;let[e,s]=this.stage.primeCut("cut"===this.mode);if(!e||!s)return void(this.mode=void 0);this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.stage.fresco.getSelected().id,s,"over",e)}if(!this.scratch)return;if("ArrowUp"===t.key||"ArrowDown"===t.key||"ArrowLeft"===t.key||"ArrowRight"===t.key){let e=t.shiftKey?10:1,s="ArrowLeft"===t.key||"ArrowRight"===t.key?"ArrowLeft"===t.key?-e:e:0,i="ArrowUp"===t.key||"ArrowDown"===t.key?"ArrowUp"===t.key?-e:e:0;this.stage.fresco.selection.offset.x+=s,this.scratch.rect.x+=s,this.stage.fresco.selection.offset.y+=i,this.scratch.rect.y+=i}this.up()}else"Shift"!==t.key?"Control"!==t.key||this.isCtrlDown||(this.isCtrlDown=!0,"move"!==this.stage.raster.style.cursor&&(this.stage.raster.style.cursor='url("/img/cursor/move-copy.svg") 2 2, auto')):this.isShiftDown=!0}},this.keyUp=t=>{"Shift"===t.key&&(this.isShiftDown=!1),"Control"===t.key&&this.isCtrlDown&&(this.isCtrlDown=!1,'url("/img/cursor/move-copy.svg") 2 2, auto'===this.stage.raster.style.cursor?this.stage.raster.style.cursor="url('/img/cursor/move-cut.svg') 2 2, auto":this.stage.raster.style.cursor="move")},this.down=t=>{if(!this.stage.fresco||!this.stage.fresco.selection)return;this.isDown=!0;let e=this.stage.translateRasterToFresco(t);if("cut"!==this.mode)if(this.stage.fresco.isSelectedImageWithCanvas()&&this.stage.fresco.selection.isSelected(e)){this.mode=this.isCtrlDown?"copy":"cut",this.clone="cut"===this.mode?h.oM(this.stage.fresco.getSelected().canvas):void 0;let[t,e]=this.stage.primeCut("cut"===this.mode);t&&e?(this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.stage.fresco.getSelected().id,e,"over",t)):this.mode="move"}else this.mode="move";else if(!this.stage.fresco.selection.isSelected(e.neg(this.stage.fresco.selection.offset))||this.isCtrlDown)return this.cleanCut(),void this.down(t);this.downPoint=e,this.downOffset=this.stage.fresco.selection.offset.clone(),this.scratch&&(this.downPos=this.scratch.rect.topLeft()),this.stage.coating.freeze(!0)},this.move=(t,e)=>{if(!this.isDown){let e=this.stage.translateRasterToFresco(t).neg(this.stage.fresco.selection.offset);return this.stage.fresco.selection.isSelected(e)?void(this.isCtrlDown?this.stage.raster.style.cursor="url('/img/cursor/move-copy.svg') 2 2, auto":this.stage.raster.style.cursor="url('/img/cursor/move-cut.svg') 2 2, auto"):void(this.stage.raster.style.cursor="move")}if(t=this.stage.translateRasterToFresco(t),this.isShiftDown&&"none"===this.moveLock){const e=Math.abs(this.downPoint.x-t.x),s=Math.abs(this.downPoint.y-t.y);(e>4||s>4)&&(e<s?(t.x=this.downPoint.x,this.moveLock="vertical"):(t.y=this.downPoint.y,this.moveLock="horizontal"))}this.isShiftDown||(this.moveLock="none"),"vertical"!==this.moveLock&&(this.stage.fresco.selection.offset.x=this.downOffset.x+Math.round(t.x-this.downPoint.x),this.scratch&&(this.scratch.rect.x=this.downPos.x+Math.round(t.x-this.downPoint.x))),"horizontal"!==this.moveLock&&(this.stage.fresco.selection.offset.y=this.downOffset.y+Math.round(t.y-this.downPoint.y),this.scratch&&(this.scratch.rect.y=this.downPos.y+Math.round(t.y-this.downPoint.y))),window.requestAnimationFrame((()=>{this.stage.coating.render(),this.stage.render()}))},this.up=t=>{var e,s,i,a,n,o;if(this.isDown=!1,this.moveLock="none",this.stage.coating.freeze(!1),"copy"===this.mode){const t=this.stage.fresco.getSelected(),a=t.rect.clone(),n=this.clone||h.oM(t.canvas);if((0!==this.stage.fresco.selection.offset.x||0!==this.stage.fresco.selection.offset.y||this.clone)&&(t.extendCanvas(this.scratch.rect),this.scratch.drawToLayer(t),0!==this.stage.fresco.selection.offset.x||0!==this.stage.fresco.selection.offset.y)){let o=h.oM(null===(i=null===(s=null===(e=this.stage)||void 0===e?void 0:e.fresco)||void 0===s?void 0:s.selection)||void 0===i?void 0:i.mask);this.stage.fresco.selection.applyOffset(),this.stage.history.add({type:"selectionAndBitmapSwitch",kind:this.clone?"cut":"copy",selection:o,layer:t,canvas:n,rect:a}),this.stage.fresco.selection.bounds||(this.stage.fresco.removeSelection(),document.dispatchEvent(new CustomEvent("select-tool",{detail:"arrange"})))}t.render(),this.scratch.clear(),this.clone=void 0,this.mode=void 0}else if("move"===this.mode){if(0!==this.stage.fresco.selection.offset.x||0!==this.stage.fresco.selection.offset.y){let t=h.oM(null===(o=null===(n=null===(a=this.stage)||void 0===a?void 0:a.fresco)||void 0===n?void 0:n.selection)||void 0===o?void 0:o.mask);this.stage.fresco.selection.applyOffset(),this.stage.fresco.selection.bounds?this.stage.history.add({type:"selectionChange",kind:"move",selection:t}):(this.stage.history.add({type:"selectionChange",kind:"deselect",selection:t}),this.stage.fresco.removeSelection(),document.dispatchEvent(new CustomEvent("select-tool",{detail:"arrange"})))}this.mode=void 0}window.requestAnimationFrame((()=>{this.stage.coating.render(),this.stage.render()}))},this.cleanCut=()=>{"cut"===this.mode&&(this.mode="copy",this.up())},this.cleanUp=()=>{var t;this.cleanCut(),null===(t=this.stage.fresco)||void 0===t||t.removeScratch(),this.stage.raster.style.cursor="unset",document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),document.removeEventListener("mousedown",this.proxy,!0),this.removeDownListeners(),this.removeMoveListeners(),this.stage.raster.removeEventListener("contextmenu",this.contextMenu,!0)},this.addDownListeners(),this.addMoveListeners(),this.stage.raster.style.cursor="move",document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),document.addEventListener("mousedown",this.proxy,!0),this.stage.raster.addEventListener("contextmenu",this.contextMenu,!0)}}var b=s(39989),A=s(37771);class k extends A.A{constructor(t){super(t,(0,r.A)("titleToolSettings")),this.setContent(`\n            <section>\n                <input type="checkbox" id="arrange-setting-auto-select" checked />\n                <label class="top-10 switch" for="arrange-setting-auto-select">${(0,r.A)("autoSelectLayer")}<span></span></label>\n                <input type="checkbox" id="arrange-setting-guides" checked />\n                <label class="top-30 switch" for="arrange-setting-guides">${(0,r.A)("showGuides")}<span></span></label>\n                <input type="checkbox" id="arrange-settings-snap-to" checked />\n                <label class="top-10 switch" for="arrange-settings-snap-to">${(0,r.A)("snapToGuides")}<span></span></label>\n                <input type="checkbox" id="settings-smooth" checked />\n                <label class="top-10 switch" for="settings-smooth">${(0,r.A)("viewOBarSmooth")}<span></span></label>\n            </section>\n        `);const e=(0,i.Ay)("arrange-setting-auto-select");e.checked=d.Ay.autoSelect,e.onchange=()=>(0,d.ZC)("autoSelect",e.checked);const s=(0,i.Ay)("arrange-setting-guides");s.checked=d.Ay.showGuides,s.onchange=()=>(0,d.ZC)("showGuides",s.checked);const a=(0,i.Ay)("arrange-settings-snap-to");a.checked=d.Ay.snapToGuides,a.onchange=()=>(0,d.ZC)("snapToGuides",a.checked);const n=(0,i.Ay)("settings-smooth");n.checked=d.Ay.smoothScaling,n.onchange=()=>(0,d.ZC)("smoothScaling",n.checked)}}class S extends a.A{constructor(t,e){super("arrange",t),this.isShiftDown=!1,this.rasterize=()=>{this.stage.rasterize()},this.selectionTransform=()=>{this.mode="TRANSFORM",this.layerSelect()},this.selectionDistort=()=>{this.mode="DISTORT",this.layerSelect()},this.transformChange=t=>{var e;this.mode="ARRANGE",null===(e=this.transform)||void 0===e||e.cleanUp(),this.transform=void 0,t?this.stage.selectionDeselect():this.layerSelect()},this.distortChange=t=>{var e;this.mode="ARRANGE",null===(e=this.distort)||void 0===e||e.cleanUp(),this.distort=void 0,t?this.stage.selectionDeselect():this.layerSelect()},this.showSettings=()=>{new k((0,i.Ay)("arrange-tool-settings"))},this.toggleAspectMode=()=>{1===this.stage.fresco.getSelectedStack().length&&this.setAspectMode(!(0,i.Ay)("arrange-aspect-fixed").checked)},this.selectAspectMode=t=>{void 0!==t&&t.currentTarget.blur(),this.setAspectMode((0,i.Ay)("arrange-aspect-fixed").checked)},this.setAspectMode=t=>{this.reform&&(this.reform.constrain=t),(0,i.Ay)("arrange-aspect-fixed").checked=t,(0,i.Ay)("arrange-aspect-free").checked=!t,(0,i.Ay)("arrange-size-lock").style.display=t?"block":"none",(0,i.Ay)("arrange-size-vs").style.display=t?"none":"block"},this.shiftDown=t=>{"Shift"!==t.key||this.isShiftDown||(this.isShiftDown=!0,this.toggleAspectMode())},this.shiftUp=t=>{"Shift"===t.key&&(this.isShiftDown=!1,this.toggleAspectMode())},this.layerSelect=()=>{var t,e;if(!this.stage||!this.stage.fresco)return;let s=this.stage.fresco.getStackHashId();if(s!==this.currentId&&this.stage.history.commitTransaction(),this.currentId=s,null===(t=this.selectron)||void 0===t||t.cleanUp(),this.selectron=void 0,this.stage.fresco.hasSelection()&&"ARRANGE"===this.mode)return(0,i.Ay)("arrange-selection-locked").style.display="none",(0,i.Ay)("arrange-no-layer").style.display="none",(0,i.Ay)("arrange-selection").style.display="none",(0,i.Ay)("arrange-settings").style.display="none",(0,i.Ay)("arrange-no-layer").style.display="none",null===(e=this.reform)||void 0===e||e.cleanUp(),this.reform=void 0,void(this.stage.fresco.isSelectedType(n.A.TYPE_IMAGE)?((0,i.Ay)("arrange-selection").style.display="flex",this.selectron=new x(this.stage)):(0,i.Ay)("arrange-selection-locked").style.display="flex");if("DISTORT"===this.mode)return void(this.distort=new g(this.stage,this.distortChange));if("TRANSFORM"===this.mode)return void(this.transform=new f(this.stage,this.transformChange));this.reform||(this.reform=new o.A(this.stage,"ARRANGE"));let a=this.stage.fresco.getSelectedStack();(0,i.Ay)("arrange-settings").style.display="none",(0,i.Ay)("arrange-no-layer").style.display="none",(0,i.Ay)("arrange-no-layer").style.display="none",(0,i.Ay)("arrange-selection").style.display="none",(0,i.Ay)("arrange-selection-locked").style.display="none",(0,i.Ay)("arrange-rotate-left").style.display="flex",(0,i.Ay)("arrange-rotate-right").style.display="flex",(0,i.Ay)("arrange-flip-horizontal").style.display="flex",(0,i.Ay)("arrange-flip-vertical").style.display="flex",1===a.length&&a[0].rect&&a[0].rect.isSet()?(a[0].settings.locked?(0,i.Ay)("arrange-no-layer").style.display="flex":(0,i.Ay)("arrange-settings").style.display="flex",a[0].type===n.A.TYPE_TEXT?((0,i.Ay)("arrange-flip-horizontal").style.display="none",(0,i.Ay)("arrange-flip-vertical").style.display="none"):a[0].type===n.A.TYPE_FRAME?((0,i.Ay)("arrange-rotate-left").style.display=a[0].editMode?"none":"flex",(0,i.Ay)("arrange-rotate-right").style.display=a[0].editMode?"none":"flex",(0,i.Ay)("arrange-flip-horizontal").style.display=a[0].editMode?"flex":"none",(0,i.Ay)("arrange-flip-vertical").style.display=a[0].editMode?"flex":"none"):a[0].type===n.A.TYPE_SHAPE&&((0,i.Ay)("arrange-flip-horizontal").style.display="none",(0,i.Ay)("arrange-flip-vertical").style.display="none"),(0,i.Ay)("arrange-apect-holder").style.display=a[0].type===n.A.TYPE_TEXT||a[0].editMode?"none":"flex",this.updateInputs()):a.length>1?((0,i.Ay)("arrange-settings").style.display="flex",(0,i.Ay)("arrange-no-layer").style.display="none",(0,i.Ay)("arrange-apect-holder").style.display="none",(0,i.Ay)("arrange-rotate-left").style.display="none",(0,i.Ay)("arrange-rotate-right").style.display="none",(0,i.Ay)("arrange-flip-vertical").style.display="none",(0,i.Ay)("arrange-flip-horizontal").style.display="none",this.setAspectMode(!0),this.updateInputs()):((0,i.Ay)("arrange-no-layer").style.display="none",(0,i.Ay)("arrange-settings").style.display="none",(0,i.Ay)("arrange-no-layer").style.display="flex"),this.reform&&(this.reform.constrain=(0,i.Ay)("arrange-aspect-fixed").checked)},this.unlock=()=>this.stage.changeLocked(void 0,!1),this.deleteLayer=()=>this.stage.deleteLayer(),this.duplicateLayer=()=>this.stage.duplicateLayer(),this.inputBegin=()=>{this.reform.beginHistory()},this.inputEnd=t=>{let e=t.target.id,s="arrange-width"===e||"arrange-height"===e?"resize":"move";this.stage.fresco.isSelectedType(n.A.TYPE_TEXT)&&(s="arrange-height"===e?"w-resize":"t-resize"),this.reform.commitHistory(s)},this.inputPosition=t=>{let e=Math.round(Number((0,i.Ay)("arrange-top").value)),s=Math.round(Number((0,i.Ay)("arrange-left").value));this.reform.inputPosition(s,e)},this.inputSize=t=>{if("arrange-width"==t.currentTarget.id){let t=(0,i.Ay)("arrange-width").value,e=Number.isNaN(Number(t))?50:Math.round(Number(t)),s=this.reform.inputSize(e,void 0);(0,i.Ay)("arrange-height").value=Math.round(s.height).toString()}else{let t=(0,i.Ay)("arrange-height").value,e=Number.isNaN(Number(t))?50:Math.round(Number(t)),s=this.reform.inputSize(void 0,e);(0,i.Ay)("arrange-width").value=Math.round(s.width).toString()}},this.updateInputs=()=>{let t=this.stage.fresco.getStackBounds();t&&((0,i.Ay)("arrange-width").value=Math.round(t.width).toString(),(0,i.Ay)("arrange-height").value=Math.round(t.height).toString(),(0,i.Ay)("arrange-top").value=Math.round(t.y).toString(),(0,i.Ay)("arrange-left").value=Math.round(t.x).toString())},this.rotateOrFlip=t=>{let e=this.stage.fresco.getSelected();if(!e)return;switch(t.currentTarget.getAttribute("id")){case"arrange-flip-vertical":this.stage.flipSelected(!0);break;case"arrange-flip-horizontal":this.stage.flipSelected(!1);break;case"arrange-rotate-left":if(e instanceof b.A)this.stage.rotateSelected(!0);else{let t=e.rect.clone();e.rect.rotation+=-90,this.stage.history.add({type:"arrange",kind:"rotate",layer:e,action:{type:"rect",rect:t}})}break;case"arrange-rotate-right":if(e instanceof b.A)this.stage.rotateSelected(!0);else{let t=e.rect.clone();e.rect.rotation+=90,this.stage.history.add({type:"arrange",kind:"rotate",layer:e,action:{type:"rect",rect:t}})}}document.dispatchEvent(new CustomEvent("viewport-render"))},this.cleanUp=()=>{var t,e,s;this.stage.history.commitTransaction(),null===(t=this.reform)||void 0===t||t.cleanUp(),this.reform=void 0,null===(e=this.selectron)||void 0===e||e.cleanUp(),this.selectron=void 0,null===(s=this.stage)||void 0===s||s.coating.wake(),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("layer-arrange",this.updateInputs,!1),(0,i.Ay)("arrange-tool-settings").removeEventListener("click",this.showSettings,!1),(0,i.Ay)("arrange-selection-transform").removeEventListener("click",this.selectionTransform,!1),(0,i.Ay)("arrange-selection-distort").removeEventListener("click",this.selectionDistort,!1),(0,i.Ay)("arrange-rasterize").removeEventListener("click",this.rasterize,!1),(0,i.Ay)("arrange-delete").removeEventListener("click",this.deleteLayer,!1),(0,i.Ay)("arrange-duplicate").removeEventListener("click",this.duplicateLayer,!1),(0,i.Ay)("arrange-duplicate-button").removeEventListener("click",this.duplicateLayer,!1),(0,i.Ay)("arrange-convert").removeEventListener("click",this.unlock,!1),(0,i.Ay)("arrange-width").removeEventListener("input",this.inputSize,!1),(0,i.Ay)("arrange-height").removeEventListener("input",this.inputSize,!1),(0,i.Ay)("arrange-top").removeEventListener("input",this.inputPosition,!1),(0,i.Ay)("arrange-left").removeEventListener("input",this.inputPosition,!1),(0,i.Ay)("arrange-width").removeEventListener("focus",this.inputBegin,!1),(0,i.Ay)("arrange-height").removeEventListener("focus",this.inputBegin,!1),(0,i.Ay)("arrange-top").removeEventListener("focus",this.inputBegin,!1),(0,i.Ay)("arrange-left").removeEventListener("focus",this.inputBegin,!1),(0,i.Ay)("arrange-width").removeEventListener("blur",this.inputEnd,!1),(0,i.Ay)("arrange-height").removeEventListener("blur",this.inputEnd,!1),(0,i.Ay)("arrange-top").removeEventListener("blur",this.inputEnd,!1),(0,i.Ay)("arrange-left").removeEventListener("blur",this.inputEnd,!1),(0,i.Ay)("arrange-aspect-fixed").removeEventListener("click",this.selectAspectMode,!1),(0,i.Ay)("arrange-aspect-free").removeEventListener("click",this.selectAspectMode,!1),(0,i.Ay)("arrange-aspect-icon").removeEventListener("click",this.toggleAspectMode,!1);let a=(0,i.Ay)("arrange-rotate").getElementsByTagName("li");for(var n=0;n<a.length;n++)a[n].removeEventListener("click",this.rotateOrFlip,!1)},this.mode=e,document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("layer-arrange",this.updateInputs,!1),(0,i.Ay)("arrange-convert").addEventListener("click",this.unlock,!1),(0,i.Ay)("arrange-width").addEventListener("input",this.inputSize,!1),(0,i.Ay)("arrange-height").addEventListener("input",this.inputSize,!1),(0,i.Ay)("arrange-top").addEventListener("input",this.inputPosition,!1),(0,i.Ay)("arrange-left").addEventListener("input",this.inputPosition,!1),(0,i.Ay)("arrange-width").addEventListener("focus",this.inputBegin,!1),(0,i.Ay)("arrange-height").addEventListener("focus",this.inputBegin,!1),(0,i.Ay)("arrange-top").addEventListener("focus",this.inputBegin,!1),(0,i.Ay)("arrange-left").addEventListener("focus",this.inputBegin,!1),(0,i.Ay)("arrange-width").addEventListener("blur",this.inputEnd,!1),(0,i.Ay)("arrange-height").addEventListener("blur",this.inputEnd,!1),(0,i.Ay)("arrange-top").addEventListener("blur",this.inputEnd,!1),(0,i.Ay)("arrange-left").addEventListener("blur",this.inputEnd,!1),(0,i.Ay)("arrange-delete").addEventListener("click",this.deleteLayer,!1),(0,i.Ay)("arrange-duplicate").addEventListener("click",this.duplicateLayer,!1),(0,i.Ay)("arrange-duplicate-button").addEventListener("click",this.duplicateLayer,!1),(0,i.Ay)("arrange-tool-settings").addEventListener("click",this.showSettings,!1),(0,i.Ay)("arrange-selection-transform").addEventListener("click",this.selectionTransform,!1),(0,i.Ay)("arrange-selection-distort").addEventListener("click",this.selectionDistort,!1),(0,i.Ay)("arrange-rasterize").addEventListener("click",this.rasterize,!1),(0,i.Ay)("arrange-aspect-fixed").addEventListener("click",this.selectAspectMode,!1),(0,i.Ay)("arrange-aspect-free").addEventListener("click",this.selectAspectMode,!1),(0,i.Ay)("arrange-aspect-icon").addEventListener("click",this.toggleAspectMode,!1);let s=(0,i.Ay)("arrange-rotate").getElementsByTagName("li");for(var a=0;a<s.length;a++)s[a].addEventListener("click",this.rotateOrFlip,!1);this.layerSelect(),this.selectAspectMode()}}},97802:(t,e,s)=>{s.d(e,{A:()=>p});var i=s(42268),a=s(21742),n=s(54738),o=s(40963),r=s(75770),h=s(82042),l=s(59350),c=s(22866),d=s(85337),u=s(71499);class p extends r.A{constructor(t){super("clone",t),this.mode="source",this.layerSelect=()=>{const t=this.selected===this.stage.fresco.getSelected();if(!this.stage.fresco.isSelectedType(c.A.TYPE_IMAGE))return(0,i.Ay)("clone-no-layer").style.display="flex",(0,i.Ay)("clone-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.Ay)("clone-settings").style.display="flex",(0,i.Ay)("clone-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new o.A(0,0,this.stage.fresco.width,this.stage.fresco.height),"over"),this.flat=this.stage.getOutputCanvas(),this.stage.fresco.hasSelection()&&this.scratch.addBake(),t||(this.alignChange(),this.updateBrush())},this.alignChange=()=>{this.source=void 0,this.setMode("source")},this.toggleMode=()=>{this.setMode("paint"===this.mode?"source":"paint")},this.selectMode=t=>{this.setMode(t.currentTarget===(0,i.Ay)("clone-mode-paint")?"paint":"source")},this.setMode=t=>{this.mode=t,(0,i.Ay)("clone-mode-paint").checked="paint"===this.mode,(0,i.Ay)("clone-mode-source").checked="source"===this.mode,this.updateBrush()},this.isShiftDown=!1,this.keyDown=t=>{if("Shift"===t.key&&!this.isShiftDown)return this.isShiftDown=!0,void this.toggleMode();switch(t.key){case",":t.shiftKey?this.brushPod.stepSoftness(.1):this.brushPod.stepSize(-10);break;case".":t.shiftKey?this.brushPod.stepSoftness(-.1):this.brushPod.stepSize(10)}},this.keyUp=t=>{"Shift"===t.key&&(this.isShiftDown=!1,this.toggleMode())},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage("source"===this.mode?null:this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage()},this.down=(t,e)=>{if(this.selected)return"source"==this.mode?(this.source=this.stage.translateRasterToFresco(t),this.offset=void 0,void(this.isShiftDown||this.toggleMode())):void(this.source?(this.stage.coating.freeze(!0),(0,i.Ay)("workspace").appendChild(this.sourceMarker),(0,i.Ay)("clone-aligned").checked&&this.offset||(this.offset=this.stage.translateRasterToFresco(t),this.offset.x=this.offset.x-this.source.x,this.offset.y=this.offset.y-this.source.y),this.x=this.y=-1,this.scratch.settings.opacity=this.opacity.getValue(),this.useFlat=(0,i.Ay)("clone-sample-all").checked,"touch"!==e&&this.move(t),this.addMoveListeners()):document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("selectSource")})))},this.x=-1,this.y=-1,this.move=t=>{let e=this.brush.getStep(),s=!1;if(this.sourceMarker.style.top=t.y-Math.round(this.offset.y*this.stage.zoom)+(this.stage.raster.offsetTop-16)+"px",this.sourceMarker.style.left=t.x-Math.round(this.offset.x*this.stage.zoom)+(this.stage.raster.offsetLeft-16)+"px",t=this.stage.translateRasterToFresco(t),-1==this.x&&(this.lx=t.x,this.ly=t.y,this.x=t.x,this.y=t.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),t.x!==this.x||t.y!==this.y){let i=t.x-this.x,a=t.y-this.y,n=i>0?1:-1,o=a>0?1:-1;if(i=i<0?-i:i,a=a<0?-a:a,i>a){let t=.5*i;for(let r=1;r<=i;r++)this.x+=n,t+=a,t>=i&&(t-=i,this.y+=o),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let t=.5*a;for(let r=1;r<=a;r++)this.y+=o,t+=i,t>=a&&(t-=a,this.x+=n),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&(this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render())))},this.drawShape=(t,e)=>{let s=this.getPatchContext(this.brush.canvas.width,this.brush.canvas.height);s.save();const i=this.selected.rect&&!this.useFlat?this.selected.rect.x:0,a=this.selected.rect&&!this.useFlat?this.selected.rect.y:0;s.drawImage(this.useFlat||!this.selected.canvas?this.flat:this.selected.canvas,-(t-this.offset.x-i),-(e-this.offset.y-a)),s.globalCompositeOperation="destination-in",s.drawImage(this.brush.canvas,0,0),s.restore(),this.scratch.ctx.drawImage(this.patch,t,e)},this.getPatchContext=(t,e)=>this.patch?(this.patch.width!==t||this.patch.height!==e?(this.patch.width=t,this.patch.height=e):this.ptx.clearRect(0,0,t,e),this.ptx):(this.patch=n.VI(t,e),this.ptx=this.patch.getContext("2d"),this.ptx),this.up=t=>{this.sourceMarker.remove(),this.stage.coating.freeze(!1),this.removeMoveListeners();let e=n.TL(this.scratch.canvas);if(e&&e.width>0&&e.height>0){let t=this.selected.rect?n.ON(this.selected.canvas,e.rebase(this.selected.rect.x,this.selected.rect.y)):void 0;const s=n.oM(this.selected.mask),i=this.selected.rect?this.selected.rect.clone():void 0;this.selected.extendCanvas(e),this.scratch.drawToLayer(this.selected,"source-over",this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"clone",layer:this.selected,patchRect:e.rebase(this.selected.rect.x,this.selected.rect.y),patch:t,rect:i,mask:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{var t;null===(t=this.stage.fresco)||void 0===t||t.removeScratch(),this.sourceMarker.remove(),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.removeDownListeners(),this.brushPod.cleanUp(),this.opacity.cleanUp(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),(0,i.Ay)("clone-mode-source").removeEventListener("click",this.selectMode,!1),(0,i.Ay)("clone-mode-paint").removeEventListener("click",this.selectMode,!1),(0,i.Ay)("clone-aligned").removeEventListener("change",this.alignChange,!1),this.selected=void 0,this.scratch=void 0,this.patch=void 0,this.flat=void 0,this.ptx=void 0},document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),(0,i.Ay)("clone-mode-source").addEventListener("click",this.selectMode,!1),(0,i.Ay)("clone-mode-paint").addEventListener("click",this.selectMode,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),this.brush=new l.A(new u.A),this.brushPod=new d.A(t,"clone-brush",this.brush,this.updateBrush),this.opacity=new h.A("clone-opacity",{compact:!0,label:(0,a.A)("opacity")+":",defaultValue:1,labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100}),(0,i.Ay)("clone-aligned").addEventListener("change",this.alignChange,!1),this.sourceMarker=document.createElement("img"),this.sourceMarker.src="/img/cursor/source.svg",this.sourceMarker.id="source-marker",this.addDownListeners(),this.setMode("source"),this.layerSelect()}}},10809:(t,e,s)=>{s.d(e,{A:()=>d});var i=s(42268),a=s(21742),n=s(54738),o=s(53900),r=s(40963),h=s(75770),l=s(82042),c=s(41915);class d extends h.A{constructor(t){super("crop",t),this.aspectX=0,this.aspectY=0,this.inputBlur=t=>{(0,i.Ay)("crop-width").value=Math.round(this.crop.width).toString(),(0,i.Ay)("crop-height").value=Math.round(this.crop.height).toString()},this.updateCrop=t=>{var e;this.applying||(this.crop=new r.A(0,0,this.stage.fresco.width,this.stage.fresco.height),this.stage.fresco.lockedBackground()&&this.crop.equalTo(this.stage.fresco.layers[0].rect)?(this.stage.fresco.layers[0].rect.rotation=0,(0,i.Ay)("crop-straighten").style.display="block"):(0,i.Ay)("crop-straighten").style.display="none",(0,i.Ay)("crop-constraint-free").checked=!0,null===(e=this.straighten)||void 0===e||e.reset(),this.setConstraintMode(0,0),this.updateSizeInput(),this.render())},this.viewportChange=()=>{this.render()},this.reset=t=>{var e;null===(e=this.straighten)||void 0===e||e.reset(),this.stage.straighten(0),this.setConstraintMode(0,0),this.setAspect(0,0),this.refit(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("reset")}))},this.setConstraintMode=(t,e)=>{if(0==t&&0==e)return(0,i.Ay)("crop-constraint-free").checked=!0,void((0,i.Ay)("crop-constraint-settings").style.display="none");if((0,i.Ay)("crop-constraint-ratio").checked=!0,0!==t){let t=(e,s)=>0==s?e:t(s,e%s),e=t(this.crop.width,this.crop.height);(0,i.Ay)("crop-constraint-width").value=(this.crop.width/e).toString(),(0,i.Ay)("crop-constraint-height").value=(this.crop.height/e).toString()}(0,i.Ay)("crop-constraint-preset").value="0:0"},this.constraintModeChange=t=>{let e=document.querySelector('input[name="crop-constraint-mode"]:checked').value;if("free"===e)return(0,i.Ay)("crop-constraint-settings").style.display="none",void this.setAspect(0,0);(0,i.Ay)("crop-constraint-settings").style.display="inline-flex";let s=Number((0,i.Ay)("crop-constraint-width").value),a=Number((0,i.Ay)("crop-constraint-height").value);"ratio"===e?((0,i.Ay)("crop-constraint-width").value="1",(0,i.Ay)("crop-constraint-height").value="1"):((0,i.Ay)("crop-constraint-width").value=(0,i.Ay)("crop-width").value,(0,i.Ay)("crop-constraint-height").value=(0,i.Ay)("crop-height").value),s=Number((0,i.Ay)("crop-constraint-width").value),a=Number((0,i.Ay)("crop-constraint-height").value),this.setAspect(s,a),(0,i.Ay)("crop-constraint-preset").value="0:0"},this.constraintPresetChange=t=>{let e=(0,i.Ay)("crop-constraint-preset").value.split(":");if("0"===e[0])return;if("x"===e[0]&&"y"===e[1]){let t=(e,s)=>0==s?e:t(s,e%s),s=t(this.stage.fresco.width,this.stage.fresco.height);e[0]=(this.stage.fresco.width/s).toString(),e[1]=(this.stage.fresco.height/s).toString()}let s=Number(e[0]),a=Number(e[1]);this.setAspect(s,a);let n="x"!==e[0]&&s>50;(0,i.Ay)("crop-constraint-size").checked=n,(0,i.Ay)("crop-constraint-ratio").checked=!n,(0,i.Ay)("crop-constraint-width").value=e[0],(0,i.Ay)("crop-constraint-height").value=e[1]},this.constraintWidthHeightInputChange=t=>{let e=(0,i.Ay)("crop-constraint-width").value,s=(0,i.Ay)("crop-constraint-height").value,a=Number.isNaN(Number(e))?1:Number(e),n=Number.isNaN(Number(s))?1:Number(s);this.setAspect(a,n)},this.setAspect=(t,e)=>{this.aspectX=t,this.aspectY=e,this.calculate(new c.A(0,0),new c.A(this.stage.fresco.width,this.stage.fresco.height)),this.crop.width<30&&(this.crop.width=30),this.crop.height<30&&(this.crop.height=30),this.crop.x+=Math.round((this.stage.fresco.width-this.crop.width)/2),this.crop.y+=Math.round((this.stage.fresco.height-this.crop.height)/2),this.updateSizeInput(),window.requestAnimationFrame(this.render)},this.widthHeightInputChange=t=>{let e=(0,i.Ay)("crop-width").value,s=(0,i.Ay)("crop-height").value,a=Number.isNaN(Number(e))?this.stage.fresco.width:Number(e),n=Number.isNaN(Number(s))?this.stage.fresco.height:Number(s),o=Math.round(30/this.stage.zoom);if(a<o?a=o:a>this.stage.fresco.width&&(a=this.stage.fresco.width),n<o?n=o:n>this.stage.fresco.height&&(n=this.stage.fresco.height),this.crop.width=a,this.crop.height=n,0!=this.aspectX){let e=t.currentTarget.getAttribute("id");"crop-width"==e?this.crop.height=this.stage.fresco.height:this.crop.width=this.stage.fresco.width,this.calculate(new c.A(this.crop.x,this.crop.y),new c.A(this.crop.right(),this.crop.bottom())),this.updateSizeInput("crop-width"==e,"crop-height"==e)}this.crop.right()>this.stage.fresco.width&&(this.crop.x=this.stage.fresco.width-this.crop.width),this.crop.bottom()>this.stage.fresco.height&&(this.crop.y=this.stage.fresco.height-this.crop.height),window.requestAnimationFrame(this.render)},this.updateSizeInput=(t,e)=>{t||((0,i.Ay)("crop-width").value=this.crop.width.toString()),e||((0,i.Ay)("crop-height").value=this.crop.height.toString())},this.down=t=>{this.p=this.stage.translateRasterToFresco(t),this.setCursor(this.p),this.updateSizeInput(),this.downTopLeft=this.crop.topLeft(),this.downBottomRight=this.crop.bottomRight(),this.raster.addEventListener("pointerup",this.pointerUp,!1),window.requestAnimationFrame(this.render)},this.move=t=>{t=this.stage.translateRasterToFresco(t),this.isDown?this.reform(this.p.x-t.x,this.p.y-t.y):this.setCursor(t)},this.up=t=>{this.raster.removeEventListener("pointerup",this.pointerUp,!1),window.requestAnimationFrame(this.render)},this.setCursor=t=>{let e=this.crop.width/6,s=this.crop.height/6;t.x<=this.crop.x+e?t.y<this.crop.y+s?this.method="nw-resize":t.y<this.crop.y+this.crop.height-s?this.method="w-resize":this.method="sw-resize":t.x>this.crop.x+e&&t.x<this.crop.x+this.crop.width-e?t.y<this.crop.y+s?this.method="n-resize":t.y<this.crop.y+this.crop.height-s?this.method="move":this.method="s-resize":t.y<this.crop.y+s?this.method="ne-resize":t.y<this.crop.y+this.crop.height-s?this.method="e-resize":this.method="se-resize",this.raster.style.cursor=this.method},this.refit=()=>{let t=Math.round(16/this.stage.zoom),e=new c.A(this.crop.x,this.crop.y),s=new c.A(this.crop.right(),this.crop.bottom());e.x<0&&(e.x=0),e.y<0&&(e.y=0),s.x>this.stage.fresco.width&&(s.x=this.stage.fresco.width),s.y>this.stage.fresco.height&&(s.y=this.stage.fresco.height),s.x<e.x+t&&(s.x=e.x+t),s.y<e.y+t&&(s.y=e.y+t),e.x>s.x-t&&(e.x=s.x-t),e.y>s.y-t&&(e.y=s.y-t),this.calculate(e,s),this.updateSizeInput(),this.render()},this.reform=(t,e)=>{if("move"==this.method)this.crop.x=this.downTopLeft.x-t,this.crop.y=this.downTopLeft.y-e,this.crop.x<0?this.crop.x=0:this.crop.right()>this.stage.fresco.width&&(this.crop.x=this.stage.fresco.width-this.crop.width),this.crop.y<0?this.crop.y=0:this.crop.bottom()>this.stage.fresco.height&&(this.crop.y=this.stage.fresco.height-this.crop.height);else{let s=this.downTopLeft.clone(),i=this.downBottomRight.clone();switch(this.method){case"w-resize":0!==this.aspectX&&(i.y=this.stage.fresco.height),s.x=this.downTopLeft.x-t;break;case"e-resize":0!==this.aspectX&&(i.y=this.stage.fresco.height),i.x=this.downBottomRight.x-t;break;case"n-resize":0!==this.aspectX&&(i.x=this.stage.fresco.width),s.y=this.downTopLeft.y-e;break;case"s-resize":0!==this.aspectX&&(i.x=this.stage.fresco.width),i.y=this.downBottomRight.y-e;break;case"nw-resize":s.x=this.downTopLeft.x-t,s.y=this.downTopLeft.y-e;break;case"ne-resize":s.y=this.downTopLeft.y-e,i.x=this.downBottomRight.x-t;break;case"sw-resize":s.x=this.downTopLeft.x-t,i.y=this.downBottomRight.y-e;break;case"se-resize":i.x=this.downBottomRight.x-t,i.y=this.downBottomRight.y-e}let a=Math.round(30/this.stage.zoom);s.x!=this.downTopLeft.x&&(s.x<0?s.x=0:s.x>i.x-a&&(s.x=i.x-a)),s.y!=this.downTopLeft.y&&(s.y<0?s.y=0:s.y>i.y-a&&(s.y=i.y-a)),i.x!=this.downBottomRight.x&&(i.x>this.stage.fresco.width?i.x=this.stage.fresco.width:i.x<s.x+a&&(i.x=s.x+a)),i.y!=this.downBottomRight.y&&(i.y>this.stage.fresco.height?i.y=this.stage.fresco.height:i.y<s.y+a&&(i.y=s.y+a)),this.calculate(s,i,this.downTopLeft),this.updateSizeInput()}window.requestAnimationFrame(this.render)},this.render=()=>{let t=this.crop.scale(this.stage.zoom);t.x+=this.stage.offset.x,t.y+=this.stage.offset.y;let e=t.width<200||t.height<200?15:30;if(this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.straightenIsDown){this.ctx.lineWidth=1,this.ctx.fillStyle=n.q5,this.ctx.translate(.5,.5),this.ctx.beginPath();let t=new c.A(Math.round(this.raster.width/2),Math.round(this.raster.height/2));this.ctx.moveTo(this.stage.viewClip.x,t.y),this.ctx.lineTo(this.stage.viewClip.right()-1,t.y),this.ctx.moveTo(t.x,this.stage.viewClip.y),this.ctx.lineTo(t.x,this.stage.viewClip.bottom()-1),this.ctx.strokeStyle="rgba(255,255,255,.5)";let e=0,s=t.x;for(;s>this.stage.viewClip.x;)e%5==0?(this.ctx.moveTo(s,this.stage.viewClip.y),this.ctx.lineTo(s,this.stage.viewClip.bottom()-1),this.ctx.moveTo(t.x+t.x-s,this.stage.viewClip.y),this.ctx.lineTo(t.x+t.x-s,this.stage.viewClip.bottom()-1)):(this.ctx.moveTo(s,t.y-3),this.ctx.lineTo(s,t.y+3),this.ctx.moveTo(t.x+t.x-s,t.y-3),this.ctx.lineTo(t.x+t.x-s,t.y+3)),s-=30,e++;e=0;let i=t.y;for(;i>this.stage.viewClip.y;)e%5==0?(this.ctx.moveTo(this.stage.viewClip.x,i),this.ctx.lineTo(this.stage.viewClip.right()-1,i),this.ctx.moveTo(this.stage.viewClip.x,t.y+t.y-i),this.ctx.lineTo(this.stage.viewClip.right()-1,t.y+t.y-i)):(this.ctx.moveTo(t.x-3,i),this.ctx.lineTo(t.x+3,i),this.ctx.moveTo(t.x-3,t.y+t.y-i),this.ctx.lineTo(t.x+3,t.y+t.y-i)),i-=30,e++;this.ctx.stroke(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.beginPath(),this.ctx.arc(t.x,t.y,50,0,2*Math.PI),this.ctx.arc(t.x,t.y,300,0,2*Math.PI),this.ctx.stroke()}else{if(this.ctx.fillStyle="rgba(0,0,0,0.5)",this.ctx.fillRect(this.stage.viewClip.x<0?0:this.stage.viewClip.x,this.stage.viewClip.y<0?0:this.stage.viewClip.y,this.stage.viewClip.width,this.stage.viewClip.height),this.ctx.clearRect(t.x,t.y,t.width,t.height),this.ctx.lineWidth=1,this.ctx.fillStyle=n.q5,this.ctx.translate(.5,.5),this.ctx.strokeStyle="rgb(0,0,0)",this.ctx.strokeRect(t.x,t.y,t.width-1,t.height-1),this.ctx.strokeStyle=n.q5,this.ctx.strokeRect(t.x-1,t.y-1,t.width+1,t.height+1),this.isDown){let e=Math.round(t.width/3),s=Math.round(t.height/3);this.ctx.strokeStyle="rgba(255,255,255,.5)",this.ctx.beginPath(),this.ctx.moveTo(t.x+e,t.y),this.ctx.lineTo(t.x+e,t.bottom()),this.ctx.moveTo(t.x+2*e,t.y),this.ctx.lineTo(t.x+2*e,t.bottom()),this.ctx.moveTo(t.x,t.y+s),this.ctx.lineTo(t.right(),t.y+s),this.ctx.moveTo(t.x,t.y+2*s),this.ctx.lineTo(t.right(),t.y+2*s),this.ctx.stroke()}this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillRect(t.x-3,t.y-3,e,3),this.ctx.fillRect(t.x-3,t.y,3,e-3),this.ctx.fillRect(t.x-3,t.y+t.height,e,3),this.ctx.fillRect(t.x-3,t.y+t.height-e+3,3,e-3),this.ctx.fillRect(t.x+t.width-e+3,t.y-3,e,3),this.ctx.fillRect(t.x+t.width,t.y,3,e-3),this.ctx.fillRect(t.x+t.width-e+3,t.y+t.height,e,3),this.ctx.fillRect(t.x+t.width,t.y+t.height-e+3,3,e-3),this.ctx.fillRect(Math.floor(t.x+t.width/2-e),t.y-3,2*e,3),this.ctx.fillRect(Math.floor(t.x+t.width/2-e),t.y+t.height,2*e,3),this.ctx.fillRect(t.x-3,t.y+t.height/2-e,3,2*e),this.ctx.fillRect(t.x+t.width,t.y+t.height/2-e,3,2*e)}},this.dblClick=()=>{this.setAspect(this.aspectY,this.aspectX)},this.apply=()=>{document.dispatchEvent(new CustomEvent("select-tool"))},this.cleanUp=()=>{var t;this.removeDownListeners(),this.applying=!0;const e=this.stage.fresco.lockedBackground()&&0!==this.stage.fresco.layers[0].rect.rotation;if(!this.crop.equalTo(new r.A(0,0,this.stage.fresco.width,this.stage.fresco.height))||e){let t,s=new o.A(this.stage.fresco.width,this.stage.fresco.height),i=new c.A(-this.crop.x,-this.crop.y);if(e){const e=this.stage.fresco.layers[0];t=n.oM(e.canvas),s=new o.A(e.canvas.width,e.canvas.height),i.x+=-e.rect.x,i.y+=-e.rect.y,e.applyStraighten(new r.A(0,0,this.stage.fresco.width,this.stage.fresco.height))}this.stage.fresco.crop(this.crop),this.stage.history.add({type:"crop",offset:i,size:s,straighten:t})}if("size"===document.querySelector('input[name="crop-constraint-mode"]:checked').value){const t=Number((0,i.Ay)("crop-constraint-width").value),e=Number((0,i.Ay)("crop-constraint-height").value),s=new o.A(this.stage.fresco.width,this.stage.fresco.height);if(s.width!==t||s.height!==e){const i=this.stage.fresco.layers.map((t=>(t.syncRequested=new Date,t.clone(!0))));this.stage.fresco.resize(t,e,!0),this.stage.history.add({type:"pageResize",size:s,layers:i})}}document.removeEventListener("history-update",this.updateCrop,!1),document.removeEventListener("viewport-render",this.viewportChange,!1),this.raster.removeEventListener("pointermove",this.pointerMove,!1),this.raster.removeEventListener("dblclick",this.dblClick,!1);const s=(0,i.Ay)("crop-width");s.removeEventListener("input",this.widthHeightInputChange,!1),s.removeEventListener("blur",this.inputBlur,!1);const a=(0,i.Ay)("crop-height");a.removeEventListener("input",this.widthHeightInputChange,!1),a.removeEventListener("blur",this.inputBlur,!1);const h=(0,i.Ay)("crop-constraint-width");h.removeEventListener("input",this.constraintWidthHeightInputChange,!1),h.removeEventListener("blur",this.inputBlur,!1);const l=(0,i.Ay)("crop-constraint-height");l.removeEventListener("input",this.constraintWidthHeightInputChange,!1),l.removeEventListener("blur",this.inputBlur,!1),null===(t=this.straighten)||void 0===t||t.cleanUp(),(0,i.Ay)("crop-constraint-preset").removeEventListener("change",this.constraintPresetChange,!1),(0,i.Ay)("crop-constraint-free").removeEventListener("click",this.constraintModeChange,!1),(0,i.Ay)("crop-constraint-size").removeEventListener("click",this.constraintModeChange,!1),(0,i.Ay)("crop-constraint-ratio").removeEventListener("click",this.constraintModeChange,!1),(0,i.Ay)("crop-reset").removeEventListener("click",this.reset,!1),(0,i.Ay)("crop-apply").removeEventListener("click",this.apply,!1),this.ctx.clearRect(0,0,this.raster.width,this.raster.height),this.ctx=null,this.stage.updateViewport(),this.stage.coating.wake()},this.raster=t.raster,this.stage.selectionDeselect(),this.stage.coating.sleep(),this.ctx=this.raster.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,document.addEventListener("history-update",this.updateCrop,!1),document.addEventListener("viewport-render",this.viewportChange,!1),this.raster.addEventListener("pointermove",this.pointerMove,!1),this.raster.addEventListener("dblclick",this.dblClick,!1);const e=(0,i.Ay)("crop-width");e.addEventListener("input",this.widthHeightInputChange,!1),e.addEventListener("blur",this.inputBlur,!1);const s=(0,i.Ay)("crop-height");s.addEventListener("input",this.widthHeightInputChange,!1),s.addEventListener("blur",this.inputBlur,!1);const h=(0,i.Ay)("crop-constraint-width");h.addEventListener("input",this.constraintWidthHeightInputChange,!1),h.addEventListener("blur",this.inputBlur,!1);const d=(0,i.Ay)("crop-constraint-height");d.addEventListener("input",this.constraintWidthHeightInputChange,!1),d.addEventListener("blur",this.inputBlur,!1),this.straighten=new l.A("crop-straighten",{range:[-25,25],step:.25,label:(0,a.A)("straighten")+":",compact:!0,force:!0,labelFormat:t=>t.toFixed(1)+"°",labelParse:t=>parseFloat(t),onChange:t=>{this.stage.straighten(t),this.calculate(new c.A(0,0),new c.A(this.stage.fresco.width,this.stage.fresco.height)),this.refit()},onStart:()=>{this.straightenIsDown=!0,this.render()},onEnd:(t,e)=>{this.straightenIsDown=!1,this.refit(),this.render()}}),(0,i.Ay)("crop-constraint-preset").addEventListener("change",this.constraintPresetChange,!1),(0,i.Ay)("crop-constraint-free").addEventListener("click",this.constraintModeChange,!1),(0,i.Ay)("crop-constraint-size").addEventListener("click",this.constraintModeChange,!1),(0,i.Ay)("crop-constraint-ratio").addEventListener("click",this.constraintModeChange,!1),(0,i.Ay)("crop-reset").addEventListener("click",this.reset,!1),(0,i.Ay)("crop-apply").addEventListener("click",this.apply,!1),this.addDownListeners(),this.updateCrop()}calculate(t,e,s){if(this.crop.x=Math.round(t.x<e.x?t.x:e.x),this.crop.y=Math.round(t.y<e.y?t.y:e.y),this.crop.width=Math.round(t.x<e.x?e.x-this.crop.x:t.x-this.crop.x),this.crop.height=Math.round(t.y<e.y?e.y-this.crop.y:t.y-this.crop.y),0!=this.aspectX&&0!=this.aspectY){let e=this.crop.height,i=this.crop.width;this.aspectY/this.aspectX*(this.crop.width/this.crop.height)<this.aspectX/this.aspectY*(this.crop.height/this.crop.width)?this.crop.height=Math.round(this.crop.width*(this.aspectY/this.aspectX)):this.crop.width=Math.round(this.crop.height*(this.aspectX/this.aspectY)),s&&(s.x!=t.x&&(this.crop.x+=Math.round(i-this.crop.width)),s.y!=t.y&&(this.crop.y+=Math.round(e-this.crop.height)))}}}},18155:(t,e,s)=>{s.d(e,{A:()=>x});var i=s(42268),a=s(21742),n=s(54738),o=s(67983),r=s(16309),h=s(75770),l=s(82042),c=s(15818),d=s(41915),u=s(59350),p=s(58281),g=s(23556),m=s(66495),v=s(85337),y=s(86344),f=s(71499),w=s(21079);class x extends h.A{constructor(t){super("cutout",t),this.type="",this.mode="remove",this.isShiftDown=!1,this.more=t=>{t.preventDefault(),t.stopPropagation(),this.showContextMenu(new d.A(t.clientX,t.clientY),!0)},this.contextMenu=t=>{t.preventDefault(),t.stopPropagation(),this.showContextMenu(new d.A(t.clientX,t.clientY),!1)},this.showContextMenu=(t,e)=>{if(!this.selected)return;const s=this.selected.hasMask();new w.Ay(t,[new w.kt((0,a.A)("titleLayerInvertMask"),s?()=>this.stage.maskInvert():void 0),new w.kt((0,a.A)("titleLayerExtractMask"),s?()=>this.stage.maskExtract():void 0),new w.kt((0,a.A)("titleLayerConvertMask"),s?()=>this.stage.maskConvert():void 0),new w.kt,new w.kt((0,a.A)("titleLayerApplyMask"),s?()=>this.stage.maskApply():void 0),new w.kt((0,a.A)("titleLayerResetMask"),s?()=>this.stage.maskDelete():void 0)],e)},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.Ay)("cutout-no-layer").style.display="flex",(0,i.Ay)("cutout-sub-tools").style.display="none",void(this.selected=null);(0,i.Ay)("cutout-sub-tools").style.display="flex",(0,i.Ay)("cutout-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),"draw"===this.type&&this.updateBrush(),this.renderMask()},this.selectType=t=>{this.setType(t.currentTarget.value)},this.setType=t=>{t!==this.type&&(""!==this.type&&((0,i.Ay)("cutout-"+this.type+"-settings").style.display="none"),(0,i.Ay)("cutout-"+t+"-settings").style.display="inline-flex",this.type=t,this.selected&&!this.selected.hasMask()&&("shape"===this.type?this.setMode("keep"):this.setMode("remove")),this.selected?"draw"===this.type?this.updateBrush():(this.stage.coating.removeCursorImage(),this.stage.raster.style.cursor="crosshair"):this.stage.raster.style.cursor="auto")},this.toggleMode=()=>{this.setMode("keep"===this.mode?"remove":"keep")},this.selectMode=t=>{this.setMode(t.currentTarget===(0,i.Ay)("cutout-mode-remove")?"remove":"keep")},this.setMode=t=>{if(this.mode=t,(0,i.Ay)("cutout-mode-remove").checked="remove"===this.mode,(0,i.Ay)("cutout-mode-keep").checked="keep"===this.mode,"draw"===this.type)this.updateBrush()},this.zoomChange=()=>{if("draw"===this.type)this.updateBrush()},this.keyDown=t=>{switch("Shift"!==t.key||this.isShiftDown||(this.isShiftDown=!0,this.toggleMode()),t.key){case",":t.shiftKey?this.brushPod.stepSoftness(.1):this.brushPod.stepSize(-10);break;case".":t.shiftKey?this.brushPod.stepSoftness(-.1):this.brushPod.stepSize(10)}},this.keyUp=t=>{"Shift"===t.key&&(this.isShiftDown=!1,this.toggleMode())},this.down=t=>{if(this.selected)if(this.downPoint=t,"magic"!==this.type){switch(this.type){case"draw":this.downDraw(t);break;case"lasso":this.downLasso(t);break;case"shape":this.downShape(t);break;case"gradient":this.downGradient(t)}this.addMoveListeners()}else this.applyMagic(t)},this.move=t=>{switch(this.type){case"shape":this.moveShape(t);break;case"draw":this.moveDraw(t);break;case"lasso":this.moveLasso(t);break;case"gradient":this.moveGradient(t)}},this.up=t=>{switch(this.removeMoveListeners(),this.type){case"shape":this.applyShape(this.stage.translateRasterToFresco(this.downPoint,this.selected.rect),this.stage.translateRasterToFresco(t,this.selected.rect));break;case"draw":this.applyDraw();break;case"lasso":this.applyLasso();break;case"gradient":this.applyGradient(this.stage.translateRasterToFresco(this.downPoint,this.selected.rect),this.stage.translateRasterToFresco(t,this.selected.rect))}},this.applyMagic=t=>{if((t=this.stage.translateRasterToFresco(t,this.selected.rect)).x<0||t.y<0||t.x>this.selected.canvas.width||t.y>this.selected.canvas.height)return;const e=this.prepareMask();let s=this.magicFeather.getValue(),a=this.selected.canvas.getContext("2d").getImageData(t.x,t.y,1,1).data,n=new c.A(a[0],a[1],a[2],a[3]);if(0===n.a&&"remove"===this.mode&&0===s)return;let o=100*this.magicTolerance.getValue(),r=(this.selected.baked&&"remove"===this.mode?this.selected.baked:this.selected.canvas).getContext("2d").getImageData(0,0,this.selected.canvas.width,this.selected.canvas.height);this.cpx=new Uint32Array(r.data.buffer);let h=this.scratch.ctx.getImageData(0,0,this.scratch.canvas.width,this.scratch.canvas.height);this.mpx=new Uint32Array(h.data.buffer),(0,i.Ay)("cutout-magic-contiguous").checked?this.floodFill(t,n,o,0!==s):this.allFill(n,o),this.scratch.ctx.putImageData(h,0,0),h=null,r=null,this.cpx=null,this.mpx=null,this.drawToMask(e,this.magicFeather.getValue())},this.updateBrush=()=>{this.brush.generate("keep"===this.mode?new c.A(0,255,0,255):new c.A(255,0,0,255)),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage()},this.downDraw=t=>{this.x=this.y=-1,this.scratch.settings.opacity=.4,this.moveDraw(t)},this.x=-1,this.y=-1,this.moveDraw=t=>{let e=this.brush.getStep(),s=!1;if(t=this.stage.translateRasterToFresco(t,this.selected.rect),-1===this.x&&(this.lx=t.x,this.ly=t.y,this.x=t.x,this.y=t.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),t.x!==this.x||t.y!==this.y){let i=t.x-this.x,a=t.y-this.y,n=i>0?1:-1,o=a>0?1:-1;if(i=i<0?-i:i,a=a<0?-a:a,i>a){let t=.5*i;for(let r=1;r<=i;r++)this.x+=n,t+=a,t>=i&&(t-=i,this.y+=o),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,s=!0)}else{let t=.5*a;for(let r=1;r<=a;r++)this.y+=o,t+=i,t>=a&&(t-=a,this.x+=n),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,s=!0)}}s&&window.requestAnimationFrame((()=>this.stage.render()))},this.applyDraw=()=>{const t=this.prepareMask();this.drawToMask(t,0,this.drawOpacity.getValue())},this.downLasso=t=>{this.points=[]},this.moveLasso=t=>{this.rasterctx.save(),this.points.push(t),this.stage.raster.style.opacity="0.6",this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.rasterctx.strokeStyle="keep"===this.mode?"#00ff00":"#ff0000",this.rasterctx.lineWidth=2,this.rasterctx.lineCap="round",this.rasterctx.setLineDash([6]),this.rasterctx.beginPath(),this.rasterctx.moveTo(this.points[0].x,this.points[0].y),this.points.forEach((t=>{this.rasterctx.lineTo(t.x,t.y)})),this.rasterctx.stroke(),this.rasterctx.restore()},this.applyLasso=()=>{if(this.stage.raster.style.opacity="1",this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.points.length<2)return;const t=this.points.map((t=>this.stage.translateRasterToFresco(t,this.selected.rect))),e=this.prepareMask();this.scratch.ctx.beginPath(),this.scratch.ctx.moveTo(t[0].x,t[0].y),t.forEach((t=>this.scratch.ctx.lineTo(t.x,t.y))),this.scratch.ctx.fill(),this.drawToMask(e,this.lassoFeather.getValue())},this.downShape=t=>{this.shapeType=document.querySelector('input[name="cutout-shape-type"]:checked').value},this.moveShape=t=>{switch(this.rasterctx.save(),this.stage.raster.style.opacity="0.6",this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.rasterctx.strokeStyle="keep"===this.mode?"#00ff00":"#ff0000",this.rasterctx.lineWidth=2,this.shapeType){case"rectangle":this.rasterctx.setLineDash([6]),this.rasterctx.strokeRect(this.downPoint.x,this.downPoint.y,t.x-this.downPoint.x,t.y-this.downPoint.y);break;case"ellipse":this.rasterctx.setLineDash([6]),m.A.ellipse(this.rasterctx,this.downPoint,t),this.rasterctx.stroke();break;case"line":this.rasterctx.lineWidth=4,m.A.line(this.rasterctx,this.downPoint,t),this.rasterctx.stroke()}this.rasterctx.restore()},this.applyShape=(t,e)=>{if(t.x===e.x&&t.y===e.y)return;this.stage.raster.style.opacity="1",this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height);const s=this.prepareMask();switch(this.shapeType){case"rectangle":this.scratch.ctx.fillRect(t.x,t.y,e.x-t.x,e.y-t.y);break;case"ellipse":m.A.ellipse(this.scratch.ctx,t,e),this.scratch.ctx.fill();break;case"line":this.scratch.ctx.lineWidth=4/this.stage.zoom,m.A.line(this.scratch.ctx,t,e),this.scratch.ctx.stroke()}this.drawToMask(s,this.shapeFeather.getValue())},this.downGradient=t=>{this.stage.coating.ctx.strokeStyle=n.q5,this.stage.coating.ctx.fillStyle=n.bi},this.moveGradient=t=>{window.requestAnimationFrame((()=>{this.downPoint&&(this.stage.coating.clear(!0),this.stage.coating.ctx.lineWidth=2,m.A.line(this.stage.coating.ctx,this.downPoint,t),this.stage.coating.ctx.stroke(),m.A.arc(this.stage.coating.ctx,this.downPoint,6),this.stage.coating.ctx.fill(),this.stage.coating.ctx.stroke(),m.A.arc(this.stage.coating.ctx,t,6),this.stage.coating.ctx.fill(),this.stage.coating.ctx.stroke(),this.stage.coating.ctx.lineWidth=1,this.stage.coating.render())}))},this.applyGradient=(t,e)=>{if(this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.stage.coating.ctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),t.x===e.x&&t.y===e.y)return;let s,i=document.querySelector('input[name="cutout-gradient-type"]:checked').value;if(this.scratch.clear(),this.scratch.ctx.save(),"radial"===i){const i=t.x-e.x,a=t.y-e.y;s=this.scratch.ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,Math.sqrt(i*i+a*a))}else s=this.scratch.ctx.createLinearGradient(t.x,t.y,e.x,e.y);this.gradPod.grad.addStopToCanvasGradient(s,"remove"===this.mode),this.scratch.ctx.fillStyle=s,this.scratch.ctx.fillRect(0,0,this.scratch.canvas.width,this.scratch.canvas.height),this.scratch.ctx.restore();const a=this.prepareMask();this.drawToMask(a,0)},this.prepareMask=()=>{let t=!1;if(!this.selected.hasMask()&&(this.selected.addMask(),t=!0,"remove"===this.mode)){this.selected.mask.getContext("2d").fillRect(0,0,this.selected.mask.width,this.selected.mask.height)}return t},this.renderMask=()=>{this.selected.hasMask()&&(this.selected.render(),(0,i.Ay)("cutout-show-ghost").checked&&this.renderGhost(),this.stage.render())},this.renderGhost=()=>{if(this.selected.hasMask()){var t=this.selected.baked.getContext("2d");t.save(),t.globalAlpha=.33,t.drawImage(this.selected.canvas,0,0),t.restore(),t=null}},this.auto=t=>{this.selected&&new y.A(this.stage)},this.cleanUp=()=>{var t;this.stage.coating.freeze(!1),null===(t=this.stage.fresco)||void 0===t||t.removeScratch(),this.removeDownListeners(),(0,i.Ay)("cutout-show-ghost").checked&&(this.selected.render(),this.stage.render()),this.brushPod.cleanUp(),this.drawOpacity.cleanUp(),this.magicFeather.cleanUp(),this.shapeFeather.cleanUp(),this.lassoFeather.cleanUp(),this.magicTolerance.cleanUp(),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),document.removeEventListener("zoom-change",this.zoomChange,!1),document.removeEventListener("layer-select",this.layerSelect,!1),(0,i.Ay)("cutout-auto").removeEventListener("click",this.auto,!1),(0,i.Ay)("cutout-show-ghost").removeEventListener("change",this.renderMask,!1),(0,i.Ay)("cutout-type-magic").removeEventListener("change",this.selectType,!1),(0,i.Ay)("cutout-type-draw").removeEventListener("change",this.selectType,!1),(0,i.Ay)("cutout-type-lasso").removeEventListener("change",this.selectType,!1),(0,i.Ay)("cutout-type-shape").removeEventListener("change",this.selectType,!1),(0,i.Ay)("cutout-type-gradient").removeEventListener("change",this.selectType,!1),(0,i.Ay)("cutout-mode-keep").removeEventListener("click",this.selectMode,!1),(0,i.Ay)("cutout-mode-remove").removeEventListener("click",this.selectMode,!1),(0,i.Ay)("cutout-tool-more").removeEventListener("click",this.more,!1),this.stage.raster.removeEventListener("contextmenu",this.contextMenu,!0),this.rasterctx=null,this.selected=null,this.brush=null},this.allFill=(t,e)=>{for(var s=0;s<this.mpx.length;++s)this.tolerate(s,t,e)&&(this.mpx[s]=4294967295)},this.floodFill=(t,e,s,i)=>{let a=this.selected.canvas.width,n=this.selected.canvas.height,o=new Array,r=new Array(a*n);for(this.linearFill(t.x,t.y,e,s,i,o,r);o.length>0;)for(var h=o.shift(),l=h.start;l<=h.stop;++l)h.row>0&&!r[(h.row-1)*a+l]&&this.linearFill(l,h.row-1,e,s,i,o,r),h.row<n-1&&!r[(h.row+1)*a+l]&&this.linearFill(l,h.row+1,e,s,i,o,r)},this.linearFill=(t,e,s,i,a,n,r)=>{var h=this.selected.canvas.width;if(r[h*e+t]=!0,this.tolerate(h*e+t,s,i)){this.mpx[h*e+t]=4294967295;for(var l=t-1,c=t+1;l>=0&&!r[h*e+l];){if(r[h*e+l]=!0,!this.tolerate(h*e+l,s,i)){a&&(this.mpx[h*e+l]=4294967295);break}this.mpx[h*e+l]=4294967295,--l}for(;c<h&&!r[h*e+c];){if(r[h*e+c]=!0,!this.tolerate(h*e+c,s,i)){a&&(this.mpx[h*e+c]=4294967295);break}this.mpx[h*e+c]=4294967295,++c}n.push(new o.A(l+1,c-1,e))}else a&&(this.mpx[h*e+l]=4294967295)},this.tolerate=(t,e,s)=>{let i,a,n,o,r,h,l;return a=0,n=this.cpx[t],o=n>>24&255,o=e.a-o,i=o<0?-o:o,i>a&&(a=i),e.a>0&&(l=n>>16&255,h=n>>8&255,r=255&n,r=e.r-r,i=r<0?-r:r,i>a&&(a=i),h=e.g-h,i=h<0?-h:h,i>a&&(a=i),l=e.b-l,i=l<0?-l:l,i>a&&(a=i)),a<s},this.stage.coating.freeze(!0),this.stage.coating.clear(),this.rasterctx=this.stage.coating.ctx,(0,i.Ay)("cutout-tool-more").addEventListener("click",this.more,!1),(0,i.Ay)("cutout-auto").addEventListener("click",this.auto,!1),(0,i.Ay)("cutout-type-magic").addEventListener("change",this.selectType,!1),(0,i.Ay)("cutout-type-draw").addEventListener("change",this.selectType,!1),(0,i.Ay)("cutout-type-lasso").addEventListener("change",this.selectType,!1),(0,i.Ay)("cutout-type-shape").addEventListener("change",this.selectType,!1),(0,i.Ay)("cutout-type-gradient").addEventListener("change",this.selectType,!1),(0,i.Ay)("cutout-mode-keep").addEventListener("click",this.selectMode,!1),(0,i.Ay)("cutout-mode-remove").addEventListener("click",this.selectMode,!1),(0,i.Ay)("cutout-show-ghost").addEventListener("change",this.renderMask,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.zoomChange,!1),this.stage.raster.addEventListener("contextmenu",this.contextMenu,!0),this.brush=new u.A(new f.A),this.brushPod=new v.A(t,"cutout-draw-brush",this.brush,this.updateBrush),this.drawOpacity=new l.A("cutout-draw-opacity",{compact:!0,label:(0,a.A)("opacity")+":",defaultValue:1,labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100});let e=new r.Ay;e.addStop(new c.A(0,255,0,255),0),e.addStop(new c.A(0,255,0,0),1),this.gradPod=new p.A("cutout-gradient-grad",e,!0),this.magicTolerance=new l.A("cutout-magic-tolerance",{compact:!0,defaultValue:.32,label:(0,a.A)("tolerance")+":",labelFormat:t=>(100*t).toFixed(0),labelParse:t=>parseInt(t,10)/100}),this.magicFeather=new l.A("cutout-magic-feather",{compact:!0,defaultValue:0,label:(0,a.A)("feather")+":",labelFormat:t=>(100*t).toFixed(0),labelParse:t=>parseInt(t,10)/100}),this.shapeFeather=new l.A("cutout-shape-feather",{compact:!0,defaultValue:0,label:(0,a.A)("feather")+":",labelFormat:t=>(100*t).toFixed(0),labelParse:t=>parseInt(t,10)/100}),this.lassoFeather=new l.A("cutout-lasso-feather",{compact:!0,defaultValue:0,label:(0,a.A)("feather")+":",labelFormat:t=>(100*t).toFixed(0),labelParse:t=>parseInt(t,10)/100}),(0,i.Ay)("cutout-magic-settings").style.display="none",(0,i.Ay)("cutout-draw-settings").style.display="none",(0,i.Ay)("cutout-shape-settings").style.display="none",(0,i.Ay)("cutout-lasso-settings").style.display="none",(0,i.Ay)("cutout-gradient-settings").style.display="none",this.addDownListeners(),this.layerSelect();const s=document.querySelector('input[name="cutout-type"]:checked').value;this.setType(s);const h=document.querySelector('input[name="cutout-mode"]:checked').value;this.setMode(h)}drawToMask(t,e,s=1){if(0!==e){let t=new g.A;t.addShader("blur",e),this.scratch.replaceCanvas(t.apply(this.scratch.canvas))}const i=n.TL(this.scratch.canvas);if(!i)return;let a;t||(a=n.ON(this.selected.mask,i));const o=this.selected.mask.getContext("2d");o.save(),o.globalAlpha=s,"remove"===this.mode&&(o.globalCompositeOperation="destination-out"),o.drawImage(this.scratch.canvas,0,0),o.restore(),this.scratch.clear(),this.renderMask(),this.stage.history.add({type:"mask",layer:this.selected,rect:i,patch:a})}}},4894:(t,e,s)=>{s.d(e,{A:()=>d});var i=s(42268),a=s(21742),n=s(54738),o=s(75770),r=s(82042),h=s(59350),l=s(71499),c=s(85337);class d extends o.A{constructor(t){super("detail",t),this.mode="blur",this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.Ay)("detail-no-layer").style.display="flex",(0,i.Ay)("detail-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.Ay)("detail-settings").style.display="flex",(0,i.Ay)("detail-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.stage.fresco.hasSelection()&&this.scratch.addBake(),this.updateBrush()},this.selectMode=t=>{switch(t.currentTarget.id){case"detail-mode-blur":this.setMode("blur");break;case"detail-mode-smudge":this.setMode("smudge");break;case"detail-mode-sharpen":this.setMode("sharpen")}},this.setMode=t=>{this.mode=t,(0,i.Ay)("detail-mode-blur").checked="blur"===this.mode,(0,i.Ay)("detail-mode-sharpen").checked="sharpen"===this.mode,(0,i.Ay)("detail-mode-smudge").checked="smudge"===this.mode},this.isShiftDown=!1,this.keyDown=t=>{if("Shift"!==t.key)switch(t.key){case",":t.shiftKey?this.brushPod.stepSoftness(.1):this.brushPod.stepSize(-10);break;case".":t.shiftKey?this.brushPod.stepSoftness(-.1):this.brushPod.stepSize(10)}else this.isShiftDown=!0},this.keyUp=t=>{"Shift"===t.key&&(this.isShiftDown=!1)},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage()},this.down=(t,e)=>{this.selected&&(this.stage.coating.freeze(!0),this.isShiftDown||(this.x=this.y=-1),"smudge"===this.mode&&this.ptt&&this.ptt.clearRect(0,0,this.ptt.canvas.width,this.ptt.canvas.height),"touch"!==e&&this.move(t),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=t=>{let e="smudge"===this.mode?1:this.brush.getStep(),s=!1;if(t=this.stage.translateRasterToFresco(t,this.selected.rect),-1===this.x&&(this.lx=t.x,this.ly=t.y,this.x=t.x,this.y=t.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),t.x!==this.x||t.y!==this.y){let i=t.x-this.x,a=t.y-this.y,n=i>0?1:-1,o=a>0?1:-1;if(i=i<0?-i:i,a=a<0?-a:a,i>a){let t=.5*i;for(let r=1;r<=i;r++)this.x+=n,t+=a,t>=i&&(t-=i,this.y+=o),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,s=!0)}else{let t=.5*a;for(let r=1;r<=a;r++)this.y+=o,t+=i,t>=a&&(t-=a,this.x+=n),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,s=!0)}}s&&(this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render())))},this.drawShape=(t,e)=>{let s=this.strength.getValue(),i=this.getPatchContext(this.brush.canvas.width,this.brush.canvas.height);if(i.drawImage(this.selected.canvas,-t,-e),"smudge"===this.mode){if(this.x!==this.lx||this.y!==this.ly){i.drawImage(this.scratch.canvas,-t,-e);let a=this.getPatternContext(this.brush.canvas.width,this.brush.canvas.height);a.save(),a.drawImage(this.scratch.canvas,-(this.lx-~~(this.brush.canvas.width/2)),-(this.ly-~~(this.brush.canvas.height/2))),a.restore(),a.save(),a.globalCompositeOperation="destination-in",a.drawImage(this.brush.canvas,0,0),a.restore(),i.save(),i.globalAlpha=s/100,i.drawImage(this.ptt.canvas,0,0),i.restore()}this.scratch.ctx.drawImage(this.patch,t,e)}else"blur"===this.mode?this.blur(i):"sharpen"===this.mode&&this.sharpen(i),i.save(),i.globalCompositeOperation="destination-in",i.drawImage(this.brush.canvas,0,0),i.restore(),this.scratch.ctx.save(),this.scratch.ctx.globalAlpha=.01*s,this.scratch.ctx.drawImage(this.patch,t,e),this.scratch.ctx.restore()},this.getPatchContext=(t,e)=>this.patch?(this.patch.width!==t||this.patch.height!==e?(this.patch.width=t,this.patch.height=e):this.ptx.clearRect(0,0,t,e),this.ptx):(this.patch=n.VI(t,e),this.ptx=this.patch.getContext("2d"),this.ptx),this.getPatternContext=(t,e)=>this.pattern?(this.pattern.width!==t||this.pattern.height!==e?(this.pattern.width=t,this.pattern.height=e):this.ptt.clearRect(0,0,t,e),this.ptt):(this.pattern=n.VI(t,e),this.ptt=this.pattern.getContext("2d"),this.ptt),this.up=t=>{this.stage.coating.freeze(!1),this.removeMoveListeners();let e=n.TL(this.scratch.canvas);if(e&&e.width>0&&e.height>0){let t=n.ON(this.selected.canvas,e);const s=this.selected.rect.clone();this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"detail",layer:this.selected,patchRect:e,patch:t,rect:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.sharpen=t=>{const e=.3;for(var s,i,a,n,o,r,h,l,c,d,u,p,g,m=t.canvas.width,v=t.canvas.height,y=[0,-1,0,-1,5,-1,0,-1,0],f=Math.round(Math.sqrt(y.length)),w=.5*f|0,x=t.createImageData(m,v),b=x.data,A=t.getImageData(0,0,m,v).data,k=v;k--;)for(s=m;s--;){for(a=k,i=s,h=4*(k*m+s),n=0,o=0,r=0,0,u=0;u<f;u++)for(d=0;d<f;d++)g=i+d-w,(p=a+u-w)>=0&&p<v&&g>=0&&g<m&&(c=y[u*f+d],n+=A[l=4*(p*m+g)]*c,o+=A[l+1]*c,r+=A[l+2]*c,A[l+3]*c);b[h]=n*e+.7*A[h],b[h+1]=o*e+.7*A[h+1],b[h+2]=r*e+.7*A[h+2],b[h+3]=A[h+3]}t.putImageData(x,0,0)},this.blur=t=>{var e,s,i,a,n,o,r,h,l,c,d,u,p,g,m=t.canvas.width,v=t.canvas.height,y=t.getImageData(0,0,m,v),f=y.data,w=m-1,x=v-1;var b=[],A=[],k=[],S=[],E=[],C=[];for(p=u=0,o=0;o<v;o++){for(e=6*f[p],s=6*f[p+1],i=6*f[p+2],a=6*f[p+3],r=1;r<=5;r++)h=p+((r>w?w:r)<<2),e+=f[h++],s+=f[h++],i+=f[h++],a+=f[h];for(n=0;n<m;n++)b[u]=e,A[u]=s,k[u]=i,S[u]=a,0==o&&(E[n]=((h=n+6)<w?h:w)<<2,C[n]=(h=n-5)>0?h<<2:0),l=p+E[n],c=p+C[n],e+=f[l++]-f[c++],s+=f[l++]-f[c++],i+=f[l++]-f[c++],a+=f[l]-f[c],u++;p+=m<<2}for(n=0;n<m;n++){for(e=6*b[d=n],s=6*A[d],i=6*k[d],a=6*S[d],r=1;r<=5;r++)e+=b[d+=r>x?0:m],s+=A[d],i+=k[d],a+=S[d];for(u=n<<2,o=0;o<v;o++)f[u+3]=g=34*a>>>12,g>0?(g=255/g,f[u]=(34*e>>>12)*g,f[u+1]=(34*s>>>12)*g,f[u+2]=(34*i>>>12)*g):f[u]=f[u+1]=f[u+2]=0,0===n&&(E[o]=((h=o+6)<x?h:x)*m,C[o]=(h=o-5)>0?h*m:0),l=n+E[o],c=n+C[o],e+=b[l]-b[c],s+=A[l]-A[c],i+=k[l]-k[c],a+=S[l]-S[c],u+=m<<2}t.putImageData(y,0,0)},this.cleanUp=()=>{var t;null===(t=this.stage.fresco)||void 0===t||t.removeScratch(),this.removeDownListeners(),this.brushPod.cleanUp(),this.strength.cleanUp(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),(0,i.Ay)("detail-mode-blur").removeEventListener("click",this.selectMode,!1),(0,i.Ay)("detail-mode-sharpen").removeEventListener("click",this.selectMode,!1),(0,i.Ay)("detail-mode-smudge").removeEventListener("click",this.selectMode,!1),this.selected=void 0,this.pattern=void 0,this.patch=void 0,this.ptx=void 0,this.ptt=void 0},document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),(0,i.Ay)("detail-mode-blur").addEventListener("click",this.selectMode,!1),(0,i.Ay)("detail-mode-sharpen").addEventListener("click",this.selectMode,!1),(0,i.Ay)("detail-mode-smudge").addEventListener("click",this.selectMode,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),this.brush=new h.A(new l.A("circle",50,.5)),this.brushPod=new c.A(t,"detail-brush",this.brush,this.updateBrush),this.strength=new r.A("detail-strength",{compact:!0,label:(0,a.A)("strength")+":",range:[1,100],defaultValue:40,step:1});const e=document.querySelector('input[name="detail-mode"]:checked').value;this.setMode(e),this.addDownListeners(),this.layerSelect()}}},38135:(t,e,s)=>{s.d(e,{A:()=>y});var i=s(42268),a=s(21742),n=s(54738),o=s(40963),r=s(15818),h=s(75770),l=s(82042),c=s(41915),d=s(59350),u=s(97266),p=s(71499),g=s(37771);class m extends g.A{constructor(t,e,s){super(t,(0,a.A)("options")),this.checkIt=()=>{this.options.shrink=(0,i.Ay)("disperse-shrink").checked,this.options.hollow=(0,i.Ay)("disperse-hollow").checked,this.callback(this.options)},this.cleanUp=()=>{(0,i.Ay)("disperse-shrink").removeEventListener("click",this.checkIt,!1),(0,i.Ay)("disperse-hollow").removeEventListener("click",this.checkIt,!1),this.direction.cleanUp(),this.stretch.cleanUp(),this.amount.cleanUp(),this.spread.cleanUp(),this.scale.cleanUp(),this.superCleanUp()},this.options=e,this.callback=s,this.setContent(`\n            <section>\n                <div id="disperse-scale"></div>\n                <div id="disperse-amount"></div>\n                <div id="disperse-stretch"></div>\n                <div id="disperse-direction"></div>\n                <div id="disperse-spread"></div>\n                <input type="checkbox" checked id="disperse-shrink" />\n                <label class="top-16 switch" for="disperse-shrink">${(0,a.A)("shrink")}<span></span></label>\n                <input type="checkbox" id="disperse-hollow" />\n                <label class="top-10 switch" for="disperse-hollow">${(0,a.A)("hollow")}<span></span></label>\n            </section>\n        `),this.scale=new l.A("disperse-scale",{label:(0,a.A)("scale")+":",range:[.02,1],step:.02,defaultValue:e.scale,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onEnd:t=>{this.options.scale=t,s(this.options)}}),this.amount=new l.A("disperse-amount",{label:(0,a.A)("amount")+":",range:[.01,1],step:.01,defaultValue:e.amount,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onEnd:t=>{this.options.amount=t,s(this.options)}}),this.stretch=new l.A("disperse-stretch",{label:(0,a.A)("stretch")+":",range:[0,1],step:.01,defaultValue:e.stretch,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onEnd:t=>{this.options.stretch=t,s(this.options)}}),this.direction=new l.A("disperse-direction",{label:(0,a.A)("direction")+":",range:[-180,180],defaultValue:e.direction,labelFormat:t=>t.toFixed(1),labelParse:t=>parseInt(t,10),onEnd:t=>{this.options.direction=t,s(this.options)}}),this.spread=new l.A("disperse-spread",{label:(0,a.A)("spread")+":",range:[-1,1],step:.02,defaultValue:e.spread,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onEnd:t=>{this.options.spread=t,s(this.options)}}),(0,i.Ay)("disperse-shrink").addEventListener("click",this.checkIt,!1),(0,i.Ay)("disperse-hollow").addEventListener("click",this.checkIt,!1),(0,i.Ay)("disperse-shrink").checked=this.options.shrink,(0,i.Ay)("disperse-hollow").checked=this.options.hollow}}class v{constructor(t,e,s,i,a,n,o,r,h){this.sx=t,this.sy=e,this.tx=s,this.ty=i,this.background=a,this.color=n,this.radius=o,this.rotation=r,this.factor=h}}class y extends h.A{constructor(t){super("disperse",t),this.mode="mask",this.layerSelect=async()=>{if(!(this.selected===this.stage.fresco.getSelected())&&this.maskRect){await new u.A((0,a.A)("apply"),(0,a.A)("viewDisperseApply")).init()&&this.apply()}if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.Ay)("disperse-no-layer").style.display="flex",(0,i.Ay)("disperse-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.Ay)("disperse-settings").style.display="flex",(0,i.Ay)("disperse-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.maskRect=void 0,window.requestAnimationFrame((()=>this.stage.render())),this.setMode("mask")},this.updateBrush=()=>{this.brush.generate(),this.selected&&"mask"===this.mode?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage(),this.scratch&&(this.scratch.settings.opacity="mask"===this.mode?.4:1)},this.selectMode=t=>{this.setMode(t.currentTarget===(0,i.Ay)("disperse-mode-mask")?"mask":"effect")},this.setMode=t=>{"effect"!==t||this.maskRect||(t="mask",this.stage.notify("viewDisperseMaskFirst")),this.mode=t,(0,i.Ay)("disperse-mode-mask").checked="mask"===this.mode,(0,i.Ay)("disperse-mode-effect").checked="effect"===this.mode,(0,i.Ay)("disperse-mask-settings").style.display="mask"===this.mode?"flex":"none",(0,i.Ay)("disperse-effect-settings").style.display="effect"===this.mode?"flex":"none",this.updateBrush(),this.disperse()},this.rand=(t,e)=>Math.random()*(e-t)+t,this.showOptions=()=>{new m((0,i.Ay)("disperse-options"),this.options,this.updateOptions)},this.updateOptions=t=>{this.options=t,this.disperse()},this.disperse=()=>{var t;if(this.scratch.clear(),"effect"!==this.mode||!this.maskRect)return;const e=this.maskRect,s=e.center(),i=this.scratch.ctx,a=this.selected.canvas.getContext("2d"),n=new Array,o=10*this.options.amount,h=Math.round(100*this.options.scale),l=Math.round(.5*h),d=Math.round(e.width/h)*Math.round(e.height/h)*o,u=this.options.direction*Math.PI/180,p=this.options.spread,g=Math.sqrt(e.width*e.width+e.height*e.height),m=Math.round(this.options.stretch*g),y=this.options.shrink,f=this.options.hollow;let w,x=0,b=0;for(;x<d&&b<5e4;){let o=new c.A(Math.round(this.rand(e.x,e.x+e.width)),Math.round(this.rand(e.y,e.y+e.height)));if(b++,this.maskData.data[4*(o.y*i.canvas.width+o.x)]>0){x++;let e=g*Math.cos(u),i=g*Math.sin(u),c=this.getBound(o.x,o.y,o.x-e,o.y-i),d=this.getBound(o.x,o.y,o.x+e,o.y+i),f=null!==(t=o.distanceTo(c)/d.distanceTo(c))&&void 0!==t?t:0,w=1-f,b=l+this.rand(.2*-l,.2*l);y&&(b=.5*b+Math.round(.5*b*w));let A=a.getImageData(d.x,d.y,1,1).data;const k=new r.A(A[0],A[1],A[2]);let S=a.getImageData(o.x,o.y,1,1).data;const E=new r.A(S[0],S[1],S[2]);let C=f*f*m,T=Math.cos(u)*C,L=Math.sin(u)*C;if(0!==p){let t=s.rotateAround(o,u),e=(o.y-t.y)*p*f;T+=Math.sin(u)*e,L+=Math.cos(u)*e}if(n.push(new v(o.x,o.y,o.x+T,o.y+L,k,E,b,6.283185308*Math.random(),w)),y&&Math.random()>w){let t=2*h*f,e=this.rand(-t,t),s=this.rand(-t,t);n.push(new v(o.x+e,o.y+s,o.x+T+e,o.y+L+s,k,E,b,6.283185308*Math.random(),w))}}}switch(document.querySelector('input[name="disperse-type"]:checked').value){case"circle":w=this.circle;break;case"square":w=this.square;break;case"hexagon":w=this.hexagon;break;case"cross":w=this.cross;break;case"triangle":w=this.triangle;break;case"heart":w=this.heart;break;case"star":w=this.star;break;case"glimmer":w=this.glimmer}i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",n.forEach((t=>{i.save(),i.translate(t.sx,t.sy),i.rotate(t.rotation),i.beginPath(),i.shadowBlur=2,i.fillStyle=i.shadowColor=t.background.toRGBA(245),w(i,l),i.closePath(),i.fill(),i.restore()})),n.forEach((t=>{Math.random()<.5&&(i.save(),i.translate(t.tx,t.ty),i.rotate(t.rotation),i.beginPath(),w(i,t.radius),i.closePath(),i.fillStyle=f?t.background.toRGBA():t.color.toRGBA(),i.fill(),f&&(i.lineWidth=.25*t.radius,i.strokeStyle=t.color.toRGBA(),i.stroke()),i.restore())})),window.requestAnimationFrame((()=>this.stage.render()))},this.getBound=(t,e,s,i)=>{let a=t,n=e,o=s-t,r=i-e,h=o>0?1:-1,l=r>0?1:-1;if(o=o<0?-o:o,r=r<0?-r:r,o>r){let t=.5*o;for(let e=1;e<=o&&(a+=h,t+=r,t>=o&&(t-=o,n+=l),0!==this.maskData.data[4*(n*this.scratch.canvas.width+a)]);e++);}else{let t=.5*r;for(let e=1;e<=r&&(n+=l,t+=o,t>=r&&(t-=r,a+=h),0!==this.maskData.data[4*(n*this.scratch.canvas.width+a)]);e++);}return new c.A(a,n)},this.circle=(t,e)=>{t.arc(0,0,e,0,2*Math.PI)},this.square=(t,e)=>{t.moveTo(0,e);for(let s=0;s<4;s++)t.rotate(2*Math.PI/4),t.lineTo(0,e)},this.triangle=(t,e)=>{t.moveTo(0,0-e);for(let s=0;s<3;s++)t.rotate(Math.PI/3),t.lineTo(0,0-.5*e),t.rotate(Math.PI/3),t.lineTo(0,0-e)},this.hexagon=(t,e)=>{t.moveTo(0,e);for(let s=0;s<6;s++)t.rotate(2*Math.PI/6),t.lineTo(0,e)},this.heart=(t,e)=>{let s=.8*e;t.translate(0,-e/2),t.rotate(45*Math.PI/180),t.beginPath(),t.moveTo(0,0),t.bezierCurveTo(-s,0,-s,e,0,e),t.lineTo(e,e),t.lineTo(e,0),t.bezierCurveTo(e,-s,0,-s,0,0)},this.cross=(t,e)=>{let s=.35*e;t.moveTo(-s,-s);for(let i=0;i<4;i++)t.lineTo(-s,-e),t.lineTo(s,-e),t.lineTo(s,-s),t.rotate(Math.PI/2)},this.star=(t,e)=>{t.moveTo(0,0-e);for(let s=0;s<5;s++)t.rotate(Math.PI/5),t.lineTo(0,0-.5*e),t.rotate(Math.PI/5),t.lineTo(0,0-e)},this.glimmer=(t,e)=>{t.moveTo(0,0-e);for(let s=0;s<4;s++)t.rotate(Math.PI/4),t.lineTo(0,0-.2*e),t.rotate(Math.PI/4),t.lineTo(0,0-e)},this.down=t=>{this.selected&&"mask"===this.mode&&(this.x=this.y=-1,this.move(t),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=t=>{let e=this.brush.getStep(),s=!1;if(t=this.stage.translateRasterToFresco(t,this.selected.rect),-1==this.x&&(this.lx=t.x,this.ly=t.y,this.x=t.x,this.y=t.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),t.x!==this.x||t.y!==this.y){let i=t.x-this.x,a=t.y-this.y,n=i>0?1:-1,o=a>0?1:-1;if(i=i<0?-i:i,a=a<0?-a:a,i>a){let t=.5*i;for(let r=1;r<=i;r++)this.x+=n,t+=a,t>=i&&(t-=i,this.y+=o),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.lx=this.x,this.ly=this.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let t=.5*a;for(let r=1;r<=a;r++)this.y+=o,t+=i,t>=a&&(t-=a,this.x+=n),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.lx=this.x,this.ly=this.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&window.requestAnimationFrame((()=>this.stage.render()))},this.up=t=>{this.removeMoveListeners(),this.maskRect=n.TL(this.scratch.canvas),this.maskData=this.maskRect?this.scratch.ctx.getImageData(0,0,this.scratch.canvas.width,this.scratch.canvas.height):void 0,this.maskData&&this.setMode("effect")},this.reset=()=>{var t;this.maskRect=void 0,null===(t=this.scratch)||void 0===t||t.clear(),this.layerSelect(),window.requestAnimationFrame((()=>this.stage.render())),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("reset")}))},this.applyClick=()=>{this.apply()},this.apply=()=>{var t;if(!this.selected||!this.stage.fresco.hasLayer(this.selected))return;if(!this.maskRect)return;const e=new o.A(0,0,this.selected.rect.width,this.selected.rect.height),s=n.ON(this.selected.canvas);this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"disperse",layer:this.selected,patchRect:e,patch:s,rect:this.selected.rect.clone()}),this.maskRect=void 0,null===(t=this.scratch)||void 0===t||t.clear(),this.layerSelect()},this.cleanUp=()=>{this.maskRect&&this.apply(),this.stage.fresco.removeScratch(),this.removeDownListeners(),window.requestAnimationFrame((()=>this.stage.render())),(0,i.Ay)("disperse-apply").removeEventListener("click",this.applyClick,!1),(0,i.Ay)("disperse-reset").removeEventListener("click",this.reset,!1),(0,i.Ay)("disperse-options").removeEventListener("click",this.showOptions,!0),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),(0,i.Ay)("disperse-mode-mask").removeEventListener("change",this.selectMode,!0),(0,i.Ay)("disperse-mode-effect").removeEventListener("change",this.selectMode,!0),document.querySelectorAll('input[name="disperse-type"]').forEach((t=>t.removeEventListener("change",this.disperse))),this.brushSize.cleanUp(),this.selected=null,this.scratch=null},(0,i.Ay)("disperse-apply").addEventListener("click",this.applyClick,!1),(0,i.Ay)("disperse-reset").addEventListener("click",this.reset,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),(0,i.Ay)("disperse-mode-mask").addEventListener("change",this.selectMode,!0),(0,i.Ay)("disperse-mode-effect").addEventListener("change",this.selectMode,!0),(0,i.Ay)("disperse-options").addEventListener("click",this.showOptions,!0),this.brush=new d.A(new p.A("circle",50,0)),this.brushSize=new l.A("disperse-brush-size",{label:(0,a.A)("size")+":",step:2,compact:!0,range:[5,200],defaultValue:this.brush.settings.size,labelFormat:t=>t.toFixed(0)+"px",onEnd:t=>{this.brush.settings.size=t,this.updateBrush()}}),document.querySelectorAll('input[name="disperse-type"]').forEach((t=>t.addEventListener("change",this.disperse))),this.options={scale:.2,amount:.2,stretch:.5,direction:0,spread:.2,shrink:!0,hollow:!1},this.addDownListeners(),this.layerSelect()}}},98865:(t,e,s)=>{s.d(e,{A:()=>m});var i=s(42268),a=s(21742),n=s(54738),o=s(40963),r=s(75770),h=s(82042),l=s(15818),c=s(29755),d=s(59350),u=s(22866),p=s(85337),g=s(71499);class m extends r.A{constructor(t){super("draw",t),this.stage=t,this.isShiftDown=!1,this.keyDown=t=>{if("Shift"!==t.key)if("Control"!==t.key||this.stage.coating.override)switch(t.key){case",":t.shiftKey?this.brushPod.stepSoftness(.1):this.brushPod.stepSize(-10);break;case".":t.shiftKey?this.brushPod.stepSoftness(-.1):this.brushPod.stepSize(10)}else this.stage.coating.setPicker();else this.isShiftDown=!0},this.keyUp=t=>{"Shift"===t.key&&(this.isShiftDown=!1),"Control"===t.key&&this.stage.coating.override&&this.stage.coating.removePicker()},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedType(u.A.TYPE_IMAGE))return(0,i.Ay)("draw-no-layer").style.display="flex",(0,i.Ay)("draw-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.Ay)("draw-no-layer").style.display="none",(0,i.Ay)("draw-settings").style.display="flex",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new o.A(0,0,this.stage.fresco.width,this.stage.fresco.height),"over"),this.stage.fresco.hasSelection()&&this.scratch.addBake(),this.updateBrush()},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom,new l.A(255,255,255,255))):this.stage.coating.removeCursorImage(),this.lastTip=void 0,this.lastColor=void 0,this.lastSettings=void 0},this.down=(t,e,s)=>{if(!this.selected)return;this.stage.coating.freeze(!0),this.isShiftDown||(this.x=this.y=-1);let a=l.A.fromHEX(c.Ay.mainColor),n=(0,i.Ay)("draw-hard-tip").checked;!g.A.isEqual(this.brush.settings,this.lastSettings)&&a.isEqual(this.lastColor)&&n===this.lastTip||(this.brush.generate(a,n),this.lastSettings=this.brush.settings,this.lastColor=a,this.lastTip=n),this.scratch.settings.opacity=this.opacity.getValue(),this.mirror=(0,i.Ay)("draw-mirror").value,this.scatter=(0,i.Ay)("draw-scatter").checked,this.usePen=(0,i.Ay)("draw-pen-pressure").checked,"touch"!==e&&this.move(t,e,s),this.addMoveListeners()},this.x=-1,this.y=-1,this.move=(t,e,s=1)=>{let i=this.brush.getStep(),a=!1;if(this.scratch.ctx.globalAlpha=("pen"===e||"touch"===e)&&this.usePen&&s>0?s*s:this.flow.getValue(),t=this.stage.translateRasterToFresco(t),-1===this.x&&(this.lx=t.x,this.ly=t.y,this.x=t.x,this.y=t.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),a=!0),t.x!==this.x||t.y!==this.y){let e=t.x-this.x,s=t.y-this.y,n=e>0?1:-1,o=s>0?1:-1;if(e=e<0?-e:e,s=s<0?-s:s,e>s){let t=.5*e;for(let r=1;r<=e;r++)this.x+=n,t+=s,t>=e&&(t-=e,this.y+=o),(this.x>this.lx+i||this.x<this.lx-i||this.y>this.ly+i||this.y<this.ly-i)&&(this.draw(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,a=!0)}else{let t=.5*s;for(let r=1;r<=s;r++)this.y+=o,t+=e,t>=s&&(t-=s,this.x+=n),(this.x>this.lx+i||this.x<this.lx-i||this.y>this.ly+i||this.y<this.ly-i)&&(this.draw(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,a=!0)}}a&&(this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render())))},this.draw=(t,e)=>{if(this.scatter){const s=.5*(this.brush.canvas.width+this.brush.canvas.height);t+=Math.round(Math.random()*s-.5*s),e+=Math.round(Math.random()*s-.5*s)}if(this.scratch.ctx.drawImage(this.brush.canvas,t,e),"vertical"===this.mirror||"fourway"===this.mirror){let s=this.scratch.rect.width-t;this.scratch.ctx.drawImage(this.brush.canvas,s,e)}if("horizontal"===this.mirror||"fourway"===this.mirror){let s=this.scratch.rect.height-e;this.scratch.ctx.drawImage(this.brush.canvas,t,s)}if("fourway"===this.mirror){let s=this.scratch.rect.width-t,i=this.scratch.rect.height-e;this.scratch.ctx.drawImage(this.brush.canvas,s,i)}},this.up=t=>{this.stage.coating.freeze(!1),this.removeMoveListeners();const e=n.TL(this.scratch.canvas);if(e&&e.width>0&&e.height>0){let t=this.selected.rect?n.ON(this.selected.canvas,e.rebase(this.selected.rect.x,this.selected.rect.y)):void 0;const s=n.oM(this.selected.mask),i=this.selected.rect?this.selected.rect.clone():void 0;this.selected.extendCanvas(e),this.scratch.drawToLayer(this.selected,"source-over",this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"draw",layer:this.selected,patchRect:this.selected.rect?e.rebase(this.selected.rect.x,this.selected.rect.y):e,patch:t,rect:i,mask:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{var t;null===(t=this.stage.fresco)||void 0===t||t.removeScratch(),this.stage.coating.removePicker(),this.brushPod.cleanUp(),this.opacity.cleanUp(),this.flow.cleanUp(),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1)},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),this.brush=new d.A(new g.A),this.brushPod=new p.A(t,"draw-brush",this.brush,this.updateBrush),this.opacity=new h.A("draw-opacity",{compact:!0,label:(0,a.A)("opacity")+":",defaultValue:1,labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100}),this.flow=new h.A("draw-flow",{compact:!0,label:(0,a.A)("flow")+":",defaultValue:1,labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100}),this.addDownListeners(),this.layerSelect()}}},411:(t,e,s)=>{s.d(e,{A:()=>u});var i=s(42268),a=s(54738),n=s(75770),o=s(82042),r=s(15818),h=s(59350),l=s(71499),c=s(85337),d=s(21742);class u extends n.A{constructor(t){super("eraser",t),this.stage=t,this.isShiftDown=!1,this.keyDown=t=>{if("Shift"!==t.key)switch(t.key){case",":t.shiftKey?this.brushPod.stepSoftness(.1):this.brushPod.stepSize(-10);break;case".":t.shiftKey?this.brushPod.stepSoftness(-.1):this.brushPod.stepSize(10)}else this.isShiftDown=!0},this.keyUp=t=>{"Shift"===t.key&&(this.isShiftDown=!1)},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.Ay)("eraser-no-layer").style.display="flex",(0,i.Ay)("eraser-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.Ay)("eraser-no-layer").style.display="none",(0,i.Ay)("eraser-settings").style.display="flex",this.selected=this.stage.fresco.getSelected(),this.cached=a.oM(this.selected.canvas),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"none"),this.stage.fresco.hasSelection()&&this.scratch.addBake(),this.usePen=(0,i.Ay)("eraser-pen-pressure").checked,this.isTransparent=!(0===this.stage.fresco.selectedLayerNr()&&this.selected.settings.locked)||a.P1(this.selected.canvas),this.updateBrush()},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom,new r.A(255,255,255,255))):this.stage.coating.removeCursorImage()},this.down=(t,e,s)=>{this.selected&&(this.stage.coating.freeze(!0),this.brush.generate(new r.A,(0,i.Ay)("eraser-hard-tip").checked),this.isShiftDown||(this.x=this.y=-1),"touch"!==e&&this.move(t,e,s),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=(t,e,s)=>{let i=this.brush.getStep(),a=!1;if(this.scratch.ctx.globalAlpha=("pen"===e||"touch"===e)&&this.usePen&&s>0?s*s:this.flow.getValue(),t=this.stage.translateRasterToFresco(t,this.selected.rect),-1===this.x&&(this.lx=t.x,this.ly=t.y,this.x=t.x,this.y=t.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),a=!0),t.x!==this.x||t.y!==this.y){let e=t.x-this.x,s=t.y-this.y,n=e>0?1:-1,o=s>0?1:-1;if(e=e<0?-e:e,s=s<0?-s:s,e>s){let t=.5*e;for(let r=1;r<=e;r++)this.x+=n,t+=s,t>=e&&(t-=e,this.y+=o),(this.x>this.lx+i||this.x<this.lx-i||this.y>this.ly+i||this.y<this.ly-i)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),a=!0)}else{let t=.5*s;for(let r=1;r<=s;r++)this.y+=o,t+=e,t>=s&&(t-=s,this.x+=n),(this.x>this.lx+i||this.x<this.lx-i||this.y>this.ly+i||this.y<this.ly-i)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),a=!0)}}a&&(this.scratch.applySelection(this.stage),this.selected.replaceCanvas(this.cached),this.scratch.drawToLayer(this.selected,this.isTransparent?"destination-out":"source-over",this.opacity.getValue()),this.selected.render(),window.requestAnimationFrame((()=>this.stage.render())))},this.drawShape=(t,e)=>{this.scratch.ctx.drawImage(this.brush.canvas,t,e)},this.up=t=>{this.stage.coating.freeze(!1),this.removeMoveListeners();let e=a.TL(this.scratch.getCanvas());if(e&&e.width>0&&e.height>0){let t=a.ON(this.cached,e);const s=this.selected.rect.clone();this.cached=a.oM(this.selected.canvas);const i=this.selected.shrinkWrap();if(this.selected.rect&&(e=e.rebase(this.selected.rect.x-s.x,this.selected.rect.y-s.y)),this.stage.history.add({type:"bitmapChange",kind:"eraser",layer:this.selected,patchRect:e,patch:t,rect:s}),i)return void this.layerSelect()}this.scratch.clear(),window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{var t;null===(t=this.stage.fresco)||void 0===t||t.removeScratch(),this.brushPod.cleanUp(),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),this.cached=void 0},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),this.brush=new h.A(new l.A),this.brushPod=new c.A(t,"eraser-brush",this.brush,this.updateBrush),this.opacity=new o.A("eraser-opacity",{compact:!0,label:(0,d.A)("opacity")+":",defaultValue:1,labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100}),this.flow=new o.A("eraser-flow",{compact:!0,label:(0,d.A)("flow")+":",defaultValue:1,labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100}),this.addDownListeners(),this.layerSelect()}}},99810:(t,e,s)=>{s.d(e,{A:()=>p});var i=s(42268),a=s(21742),n=s(54738),o=s(67983),r=s(40963),h=s(75770),l=s(82042),c=s(15818),d=s(29755),u=s(22866);class p extends h.A{constructor(t){super("fill",t),this.keyDown=t=>{"Control"!==t.key||this.stage.coating.override||this.stage.coating.setPicker()},this.keyUp=t=>{"Control"===t.key&&this.stage.coating.override&&this.stage.coating.removePicker()},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedType(u.A.TYPE_IMAGE))return(0,i.Ay)("fill-no-layer").style.display="flex",(0,i.Ay)("fill-settings").style.display="none",this.stage.raster.style.cursor="unset",void(this.selected=null);(0,i.Ay)("fill-settings").style.display="flex",(0,i.Ay)("fill-no-layer").style.display="none",this.stage.raster.style.cursor="crosshair",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new r.A(0,0,this.stage.fresco.width,this.stage.fresco.height),"over")},this.down=t=>{if(!this.selected)return;if((t=this.stage.translateRasterToFresco(t)).x<0||t.y<0||t.x>this.scratch.canvas.width||t.y>this.scratch.canvas.height)return;let e,s=this.tolerance.getValue(),a=c.A.fromHEX(d.Ay.mainColor);if(this.selected.canvas&&this.selected.rect){if(this.stage.coating.animateCursorTap(),this.scratch.rect.equalTo(this.selected.rect)){const t=this.selected.canvas.getContext("2d");this.canvasData=t.getImageData(0,0,this.selected.canvas.width,this.selected.canvas.height).data}else{let t=n.Nw(this.scratch.canvas.width,this.scratch.canvas.height),e=t.getContext("2d");e.drawImage(this.selected.canvas,this.selected.rect.x,this.selected.rect.y),this.canvasData=e.getImageData(0,0,t.width,t.height).data,e=void 0}if(this.selected.rect.isInside(t)){const s=4*(t.y*this.scratch.canvas.width+t.x);e=new c.A(this.canvasData[s],this.canvasData[s+1],this.canvasData[s+2],this.canvasData[s+3])}else e=new c.A(0,0,0,0);let o=this.scratch.ctx.getImageData(0,0,this.scratch.canvas.width,this.scratch.canvas.height);this.scratchData=o.data,(0,i.Ay)("fill-contiguous").checked?this.floodFill(t,e,a,s,(0,i.Ay)("fill-anti-alias").checked):this.allFill(e,a,s,(0,i.Ay)("fill-anti-alias").checked),this.scratch.ctx.putImageData(o,0,0)}else this.scratch.ctx.fillStyle=a.toRGBA(255*this.opacity.getValue()),this.scratch.ctx.fillRect(0,0,this.scratch.canvas.width,this.scratch.canvas.height);this.scratch.applySelection(this.stage);let o=n.TL(this.scratch.getCanvas());if(o&&o.width>0&&o.height>0){let t=this.selected.rect?n.ON(this.selected.canvas,o.rebase(this.selected.rect.x,this.selected.rect.y)):void 0;const e=this.selected.rect?this.selected.rect.clone():void 0,s=n.oM(this.selected.mask);this.selected.extendCanvas(o),this.scratch.drawToLayer(this.selected,"source-over",this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"fill",layer:this.selected,patchRect:this.selected.rect?o.rebase(this.selected.rect.x,this.selected.rect.y):o,patch:t,rect:e,mask:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.allFill=(t,e,s,i)=>{for(var a,n,o=0,r=this.scratch.canvas.height;o<r;++o)for(var h=0,l=this.scratch.canvas.width;h<l;++h)n=4*(o*l+h),(a=this.tolerate(n,t,s,i))>64&&(a>128&&(a=255),this.scratchData[n]=e.r,this.scratchData[n+1]=e.g,this.scratchData[n+2]=e.b,this.scratchData[n+3]=a)},this.floodFill=(t,e,s,i,a)=>{let n=this.scratch.canvas.width,o=this.scratch.canvas.height,r=new Array,h=new Array(n*o);for(this.linearFill(t.x,t.y,e,s,i,a,r,h);r.length>0;)for(var l=r.shift(),c=l.start;c<=l.stop;++c)l.row>0&&!h[(l.row-1)*n+c]&&this.linearFill(c,l.row-1,e,s,i,a,r,h),l.row<o-1&&!h[(l.row+1)*n+c]&&this.linearFill(c,l.row+1,e,s,i,a,r,h)},this.linearFill=(t,e,s,i,a,n,r,h)=>{var l=this.scratch.canvas.width;h[l*e+t]=!0;let c=4*(l*e+t),d=this.tolerate(c,s,a,n);if(d>5&&(this.scratchData[c]=i.r,this.scratchData[c+1]=i.g,this.scratchData[c+2]=i.b,this.scratchData[c+3]=d>160?255:d),d>64){for(var u=t-1,p=t+1;u>=0&&!h[l*e+u]&&d>64;)h[l*e+u]=!0,c=4*(l*e+u),d=this.tolerate(c,s,a,n),d>5&&(this.scratchData[c]=i.r,this.scratchData[c+1]=i.g,this.scratchData[c+2]=i.b,this.scratchData[c+3]=d>160?255:d),--u;for(d=255;p<l&&!h[l*e+p]&&d>64;)h[l*e+p]=!0,c=4*(l*e+p),d=this.tolerate(c,s,a,n),d>5&&(this.scratchData[c]=i.r,this.scratchData[c+1]=i.g,this.scratchData[c+2]=i.b,this.scratchData[c+3]=d>160?255:d),++p;r.push(new o.A(u+1,p-1,e))}},this.tolerate=(t,e,s,i=!1)=>{let a,n,o,r,h,l,c;return r=e.a-this.canvasData[t+3],n=r<0?-r:r,e.a>0&&(h=e.r-this.canvasData[t],a=h<0?-h:h,a>n&&(n=a),l=e.g-this.canvasData[t+1],a=l<0?-l:l,a>n&&(n=a),c=e.b-this.canvasData[t+2],a=c<0?-c:c,a>n&&(n=a)),i&&s>0?(o=1.5-n/s,o<=0?0:o<.5?Math.round(512*o):255):n>s?0:255},this.cleanUp=()=>{var t;null===(t=this.stage.fresco)||void 0===t||t.removeScratch(),this.stage.coating.removePicker(),this.removeDownListeners(),this.tolerance.cleanUp(),this.opacity.cleanUp(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1)},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),this.tolerance=new l.A("fill-tolerance",{compact:!0,label:(0,a.A)("tolerance")+":",defaultValue:32,range:[0,255],step:1}),this.opacity=new l.A("fill-opacity",{compact:!0,label:(0,a.A)("opacity")+":",defaultValue:1,labelFormat:t=>(100*t).toFixed(0)+"%"}),this.addDownListeners(),this.layerSelect()}}},4059:(t,e,s)=>{s.d(e,{A:()=>v});var i=s(42268),a=s(21742),n=s(54738),o=s(40963),r=s(75770),h=s(41915),l=s(82042),c=s(23556),d=s(21404),u=s(97266),p=s(37771),g=s(81937);class m extends p.A{constructor(t,e,s){super(t,(0,a.A)("options"),!0),this.checkBlur=()=>{this.options.bokehBlur=(0,i.Ay)("bokeh-blur").checked,this.options.bokehBlurType=document.querySelector('input[name="bokeh-blur-type"]:checked').value,this.callback(this.options,"blur")},this.checkShape=()=>{this.options.bokehShape=(0,i.Ay)("bokeh-shape").checked,this.options.bokehShapeDual=(0,i.Ay)("bokeh-shape-dual").checked,this.options.bokehShapeType=document.querySelector('input[name="bokeh-shape-type"]:checked').value,this.callback(this.options,"shape")},this.cleanUp=()=>{(0,i.Ay)("bokeh-blur").removeEventListener("change",this.checkBlur,!1),(0,i.Ay)("bokeh-shape").removeEventListener("change",this.checkShape,!1),(0,i.Ay)("bokeh-shape-dual").removeEventListener("change",this.checkShape,!1),document.querySelectorAll('input[name="bokeh-blur-type"]').forEach((t=>t.removeEventListener("change",this.checkBlur))),document.querySelectorAll('input[name="bokeh-shape-type"]').forEach((t=>t.removeEventListener("change",this.checkShape))),this.bokehBlurSize.cleanUp(),this.bokehBlurIntensity.cleanUp(),this.bokehShapeHue.cleanUp(),this.bokehShapeSize.cleanUp(),this.bokehShapeQuantity.cleanUp(),this.bokehShapeIntensity.cleanUp(),this.superCleanUp()},this.options=e,this.callback=s,this.content.id="focus-options-content",this.content.style.height="400px",this.content.style.overflow="hidden",this.content.style.paddingBottom="4px",this.setContent(`\n            <section>\n\n            <div>\n                <input type="checkbox" class="toggle-check" id="bokeh-blur" />\n                <label class="switch subline top-16" for="bokeh-blur">${(0,a.A)("bokehBlur")}<span></span><span class="arrow"></span></label>\n        \n                <div class="toggle">\n                    <div class="switch-icon-field stretch">\n                        <input type="radio" id="bokeh-blur-type-circle" name="bokeh-blur-type" value="circle" checked /><label for="bokeh-blur-type-circle" tooltip="${(0,a.A)("circle")}" flow="up"><img src="/img/icon/shape-ellipse.svg" width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-blur-type-square" name="bokeh-blur-type" value="square" /><label for="bokeh-blur-type-square" tooltip="${(0,a.A)("square")}" flow="up"><img src="/img/icon/shape-rectangle.svg" width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-blur-type-hexagon" name="bokeh-blur-type" value="hexagon" /><label for="bokeh-blur-type-hexagon" tooltip="${(0,a.A)("hexagon")}" flow="up"><img src="/img/icon/shape-hexagon.svg"  width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-blur-type-cross" name="bokeh-blur-type" value="cross" /><label for="bokeh-blur-type-cross" tooltip="${(0,a.A)("cross")}" flow="up"><img src="/img/icon/shape-cross.svg" width="20" height="20" loading="lazy"/></label>\n                    </div>\n                    <div id="bokeh-blur-size" class="top-16"></div>\n                    <div id="bokeh-blur-intensity"></div>\n                </div>\n            </div>\n        \n            <div class="top-16">\n                <input type="checkbox" class="toggle-check" id="bokeh-shape" />\n                <label class="switch subline top-16" for="bokeh-shape">${(0,a.A)("bokehShape")}<span></span><span class="arrow"></span></label>\n        \n                <div class="toggle">\n                    <div class="switch-icon-field stretch">\n                        <input type="radio" id="bokeh-shape-type-circle" name="bokeh-shape-type" value="circle" checked /><label for="bokeh-shape-type-circle" tooltip="${(0,a.A)("circle")}" flow="up"><img src="/img/icon/shape-ellipse.svg" width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-shape-type-hexagon" name="bokeh-shape-type" value="hexagon" /><label for="bokeh-shape-type-hexagon" tooltip="${(0,a.A)("hexagon")}" flow="up"><img src="/img/icon/shape-hexagon.svg"  width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-shape-type-square" name="bokeh-shape-type" value="square" /><label for="bokeh-shape-type-square" tooltip="${(0,a.A)("square")}" flow="up"><img src="/img/icon/shape-rectangle.svg" width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-shape-type-triangle" name="bokeh-shape-type" value="triangle" /><label for="bokeh-shape-type-triangle" tooltip="${(0,a.A)("triangle")}" flow="up"><img src="/img/icon/shape-triangle.svg" width="20" height="20" loading="lazy"/></label>\n                    </div>\n                    <div class="switch-icon-field stretch top-4">\n                        <input type="radio" id="bokeh-shape-type-heart" name="bokeh-shape-type" value="heart" /><label for="bokeh-shape-type-heart" tooltip="${(0,a.A)("heart")}" flow="up"><img src="/img/icon/shape-heart.svg" width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-shape-type-cross" name="bokeh-shape-type" value="cross" /><label for="bokeh-shape-type-cross" tooltip="${(0,a.A)("cross")}" flow="up"><img src="/img/icon/shape-cross.svg" width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-shape-type-star" name="bokeh-shape-type" value="star" /><label for="bokeh-shape-type-star" tooltip="${(0,a.A)("star")}" flow="up"><img src="/img/icon/shape-star.svg"  width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-shape-type-glimmer" name="bokeh-shape-type" value="glimmer" /><label for="bokeh-shape-type-glimmer" tooltip="${(0,a.A)("glimmer")}" flow="up"><img src="/img/icon/shape-glimmer.svg" width="20" height="20" loading="lazy"/></label>\n                    </div>\n                    <div id="bokeh-shape-hue" class="top-16"></div>\n                    <div id="bokeh-shape-size" ></div>\n                    <div id="bokeh-shape-quantity"></div>\n                    <div id="bokeh-shape-intensity"></div>\n                    <input type="checkbox" id="bokeh-shape-dual" />\n                    <label class="top-16 switch" for="bokeh-shape-dual">${(0,a.A)("dualTone")}<span></span></label>\n                </div>\n            </div>\n            </section>\n        `),this.bokehBlurSize=new l.A("bokeh-blur-size",{label:(0,a.A)("size"),range:[0,1],step:.01,defaultValue:this.options.bokehBlurSize,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onEnd:t=>{this.options.bokehBlurSize=t,s(this.options,"blur")}}),this.bokehBlurIntensity=new l.A("bokeh-blur-intensity",{label:(0,a.A)("intensity"),range:[0,1],step:.01,defaultValue:this.options.bokehBlurIntensity,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onEnd:t=>{this.options.bokehBlurIntensity=t,s(this.options,"blur")}}),this.bokehShapeHue=new l.A("bokeh-shape-hue",{label:(0,a.A)("color"),range:[-180,180],step:1,defaultValue:this.options.bokehShapeHue,labelFormat:t=>String(t),labelParse:t=>parseInt(t,10),onEnd:t=>{this.options.bokehShapeHue=t,s(this.options,"shape")}}),this.bokehShapeSize=new l.A("bokeh-shape-size",{label:(0,a.A)("size"),range:[0,1],step:.01,defaultValue:this.options.bokehShapeSize,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onEnd:t=>{this.options.bokehShapeSize=t,s(this.options,"shape")}}),this.bokehShapeQuantity=new l.A("bokeh-shape-quantity",{label:(0,a.A)("quantity"),range:[0,1],step:.01,defaultValue:this.options.bokehShapeQuantity,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onEnd:t=>{this.options.bokehShapeQuantity=t,s(this.options,"shape")}}),this.bokehShapeIntensity=new l.A("bokeh-shape-intensity",{label:(0,a.A)("intensity"),range:[0,1],step:.01,defaultValue:this.options.bokehShapeIntensity,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onEnd:t=>{this.options.bokehShapeIntensity=t,s(this.options,"shape")}}),(0,i.Ay)("bokeh-blur").addEventListener("change",this.checkBlur,!1),(0,i.Ay)("bokeh-shape").addEventListener("change",this.checkShape,!1),(0,i.Ay)("bokeh-shape-dual").addEventListener("change",this.checkShape,!1),document.querySelectorAll('input[name="bokeh-blur-type"]').forEach((t=>t.addEventListener("change",this.checkBlur))),document.querySelectorAll('input[name="bokeh-shape-type"]').forEach((t=>t.addEventListener("change",this.checkShape))),(0,i.Ay)("bokeh-blur").checked=this.options.bokehBlur,(0,i.Ay)("bokeh-blur-type-"+this.options.bokehBlurType).checked=!0,(0,i.Ay)("bokeh-shape").checked=this.options.bokehShape,(0,i.Ay)("bokeh-shape-dual").checked=this.options.bokehShapeDual,(0,i.Ay)("bokeh-shape-type-"+this.options.bokehShapeType).checked=!0,new g.A((0,i.Ay)("focus-options-content"))}}class v extends r.A{constructor(t){super("focus",t),this.mode="symmetric",this.PI2=2*Math.PI,this.selectMode=t=>{this.mode=t.currentTarget.value,this.rotation=0,window.requestAnimationFrame((()=>{this.renderControls(),this.renderFocus()}))},this.layerSelect=async()=>{if(!(this.selected===this.stage.fresco.getSelected())&&(0!==this.blurAmount.getValue()||this.options.bokehShape||this.options.bokehBlur)){await new u.A((0,a.A)("apply"),(0,a.A)("viewFocusApply")).init()&&this.apply()}if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.Ay)("focus-no-layer").style.display="flex",(0,i.Ay)("focus-settings").style.display="none",this.selected=void 0,this.cached=void 0,this.shape=void 0,this.blur=void 0,void window.requestAnimationFrame((()=>{this.renderControls()}));(0,i.Ay)("focus-no-layer").style.display="none",(0,i.Ay)("focus-settings").style.display="flex",this.selected=this.stage.fresco.getSelected(),this.cached=this.selected.baked?this.selected.baked:this.selected.canvas,this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over",this.cached),this.scratch.settings.blendmode=this.selected.settings.blendmode,this.scratch.settings.opacity=this.selected.settings.opacity,this.center=new h.A(Math.round(this.stage.fresco.width/2),Math.round(this.stage.fresco.height/2)),this.distance=Math.round(this.stage.fresco.height/2*.75),this.falloff=Math.round(.5*this.distance),this.rotation=0,this.addDownListeners(),this.addMoveListeners(),this.renderControls(),this.renderBlur(),this.renderShape()},this.showOptions=()=>{new m((0,i.Ay)("focus-options"),this.options,this.updateOptions)},this.updateOptions=(t,e)=>{this.options=t,"shape"===e?this.renderShape():this.renderBlur()},this.down=t=>{if(!this.selected)return;this.downPoint=this.stage.translateRasterToFresco(t);let e=this.downPoint.clone();if(0!==this.rotation&&(this.matrix.reset(),this.matrix.translate(this.center),this.matrix.rotate(this.rotation),this.matrix.invert(),e=this.matrix.transformPoint(e).add(this.center)),this.checkControl(e),this.control){switch(this.control){case"center":this.downPosition=this.center.clone();break;case"falloff":this.downPosition=new h.A(this.center.y,this.falloff),this.downPoint=e;break;case"distance":this.downPosition=new h.A(this.center.y,this.distance),this.downPoint=e;break;case"rotation":this.downRotation=Math.atan2(this.downPoint.y-this.center.y,this.downPoint.x-this.center.x)-this.rotation}this.raster.addEventListener("pointerup",this.pointerUp,!1)}else n.HO(0,0,this.stage.fresco.width,this.stage.fresco.height,this.downPoint.x,this.downPoint.y)?this.renderControls():this.rctx.clearRect(0,0,this.raster.width,this.raster.height)},this.move=t=>{if(!this.selected)return;let e=this.stage.translateRasterToFresco(t),s=e.clone();if(0!==this.rotation&&(this.matrix.reset(),this.matrix.translate(this.center),this.matrix.rotate(this.rotation),this.matrix.invert(),s=this.matrix.transformPoint(s).add(this.center)),this.isDown){if(this.control){switch(this.control){case"center":this.center.x=this.downPosition.x+(e.x-this.downPoint.x),this.center.y=this.downPosition.y+(e.y-this.downPoint.y);break;case"falloff":this.falloff=n.qE(this.downPosition.y+(s.y-this.downPoint.y),20,this.distance-20);break;case"distance":this.distance=n.qE(this.downPosition.y+(s.y-this.downPoint.y),this.falloff+20,Math.round(this.cached.height));break;case"rotation":this.rotation=Math.atan2(e.y-this.center.y,e.x-this.center.x)-this.downRotation,this.rotation<0?this.rotation+=this.PI2:this.rotation>=this.PI2&&(this.rotation-=this.PI2)}window.requestAnimationFrame((()=>{this.renderControls(),this.renderFocus()}))}}else this.checkControl(s)},this.checkControl=t=>{let e=28/this.stage.zoom,s=e/2,i=50/this.stage.zoom,a=!1,o=!1;n.HO(this.center.x-s,this.center.y+this.falloff-s,e,e,t.x,t.y)&&(o="falloff"===this.control,this.control="falloff",a=!0),n.HO(this.center.x-s,this.center.y+this.distance-s,e,e,t.x,t.y)&&(o="distance"===this.control,this.control="distance",a=!0),n.HO(this.center.x-s,this.center.y-s,e,e,t.x,t.y)&&(o="center"===this.control,this.control="center",a=!0),"radial"!==this.mode&&n.HO(this.center.x+i-s,this.center.y-i-s,e,e,t.x,t.y)&&(o="rotation"===this.control,this.control="rotation",a=!0),a&&!o?(window.requestAnimationFrame(this.renderControls),this.raster.style.cursor="pointer"):!a&&this.control&&(this.control=void 0,window.requestAnimationFrame(this.renderControls),this.raster.style.cursor="unset")},this.up=t=>{this.isDown=!1},this.renderBlurEvent=()=>{window.requestAnimationFrame(this.renderBlur)},this.renderBlur=()=>{this.options.bokehBlur?this.shaders.addShader("bokeh",{size:this.options.bokehBlurSize,amount:this.options.bokehBlurIntensity,type:this.options.bokehBlurType}):this.shaders.addShader("bokeh",void 0),this.shaders.addShader("blur",this.blurAmount.getValue()),this.blur=this.shaders.apply(this.cached),this.renderFocus()},this.rand=(t,e)=>Math.random()*(e-t)+t,this.hsla=(t,e,s,i)=>"hsla("+t+","+e+"%,"+s+"%,"+i+")",this.renderShape=()=>{if(!this.options.bokehShape)return this.shape=void 0,void this.renderFocus();this.shape||(this.shape=n.Nw(this.cached.width,this.cached.height));const t=this.shape.getContext("2d");t.clearRect(0,0,this.shape.width,this.shape.height),t.save(),t.globalCompositeOperation="lighter";const e=this.shape.width,s=this.shape.height,i=e+s,a=this.options.bokehShapeHue+180,o=.1*i*this.options.bokehShapeSize,r=.03*i;let h,l=Math.floor(.1*i*this.options.bokehShapeQuantity);switch(this.options.bokehShapeType){case"circle":h=this.circle;break;case"square":h=this.square;break;case"hexagon":h=this.hexagon;break;case"cross":h=this.cross;break;case"triangle":h=this.triangle;break;case"heart":h=this.heart;break;case"star":h=this.star;break;case"glimmer":h=this.glimmer}const c=this.options.bokehShapeDual;for(;l--;){const i=this.rand(0,e),n=this.rand(0,s),d=this.rand(1,o);let u=this.rand(a-30,a+30);c&&l%2==0&&(u+=120),t.shadowColor=this.hsla(u,this.rand(10,80),this.rand(30,60),this.rand(.2,.8)),t.shadowBlur=this.rand(10,r),t.beginPath(),t.save(),t.translate(i,n),t.rotate(Math.random()*this.PI2),h(t,d),t.restore(),t.closePath(),t.fill()}for(l=Math.floor(.03*i*this.options.bokehShapeQuantity),t.shadowBlur=15,t.shadowColor="#fff";l--;){const i=this.rand(0,e),a=this.rand(0,s),n=this.rand(.5,.75*o);t.fillStyle=this.hsla(0,0,100,this.rand(.03,.1)),t.beginPath(),t.save(),t.translate(i,a),t.rotate(Math.random()*this.PI2),h(t,n),t.restore(),t.closePath(),t.fill()}t.restore(),this.renderFocus()},this.circle=(t,e)=>{t.arc(0,0,e,0,2*Math.PI)},this.square=(t,e)=>{t.moveTo(0,e);for(let s=0;s<4;s++)t.rotate(2*Math.PI/4),t.lineTo(0,e)},this.triangle=(t,e)=>{t.moveTo(0,0-e);for(let s=0;s<3;s++)t.rotate(Math.PI/3),t.lineTo(0,0-.5*e),t.rotate(Math.PI/3),t.lineTo(0,0-e)},this.hexagon=(t,e)=>{t.moveTo(0,e);for(let s=0;s<6;s++)t.rotate(2*Math.PI/6),t.lineTo(0,e)},this.heart=(t,e)=>{let s=.8*e;t.translate(0,-e/2),t.rotate(45*Math.PI/180),t.beginPath(),t.moveTo(0,0),t.bezierCurveTo(-s,0,-s,e,0,e),t.lineTo(e,e),t.lineTo(e,0),t.bezierCurveTo(e,-s,0,-s,0,0)},this.cross=(t,e)=>{let s=.35*e;t.moveTo(-s,-s);for(let i=0;i<4;i++)t.lineTo(-s,-e),t.lineTo(s,-e),t.lineTo(s,-s),t.rotate(Math.PI/2)},this.star=(t,e)=>{t.moveTo(0,0-e);for(let s=0;s<5;s++)t.rotate(Math.PI/5),t.lineTo(0,0-.5*e),t.rotate(Math.PI/5),t.lineTo(0,0-e)},this.glimmer=(t,e)=>{t.moveTo(0,0-e);for(let s=0;s<4;s++)t.rotate(Math.PI/4),t.lineTo(0,0-.2*e),t.rotate(Math.PI/4),t.lineTo(0,0-e)},this.renderFocus=()=>{if(this.scratch.replaceCanvas(this.blur),this.scratch.drawCanvas(this.shape,"screen",this.options.bokehShapeIntensity),"none"===this.mode)return void window.requestAnimationFrame(this.stage.render);let t;const e=(0,i.Ay)("focus-invert").checked,s=e?"#00000000":"#000000FF",a=e?"#000000FF":"#00000000";let n=this.center.neg(this.selected.rect.topLeft());if("radial"===this.mode){const e=this.falloff/this.distance;t=this.scratch.ctx.createRadialGradient(n.x,n.y,0,n.x,n.y,this.distance),t.addColorStop(0,s),t.addColorStop(e,s),t.addColorStop(1,a)}else if("symmetric"===this.mode){const e=this.falloff/this.distance*.5,i=new h.A(n.x,n.y-this.distance).rotateAround(n,this.rotation),o=new h.A(n.x,n.y+this.distance).rotateAround(n,this.rotation);t=this.scratch.ctx.createLinearGradient(i.x,i.y,o.x,o.y),t.addColorStop(0,a),t.addColorStop(.5-e,s),t.addColorStop(.5,s),t.addColorStop(.5+e,s),t.addColorStop(1,a)}else{const e=this.falloff/this.distance,i=new h.A(n.x,n.y+this.distance).rotateAround(n,this.rotation);t=this.scratch.ctx.createLinearGradient(n.x,n.y,i.x,i.y),t.addColorStop(0,s),t.addColorStop(e,s),t.addColorStop(1,a)}this.scratch.ctx.save(),this.scratch.ctx.fillStyle=t,this.scratch.ctx.globalCompositeOperation="destination-out",this.scratch.ctx.fillRect(0,0,this.cached.width,this.cached.height),this.scratch.ctx.restore(),window.requestAnimationFrame(this.stage.render)},this.renderControls=()=>{if(this.rctx.clearRect(0,0,this.raster.width,this.raster.height),!this.selected||"none"===this.mode)return;const t=this.stage.translateFrescoToRaster(this.center),e=Math.round(this.falloff*this.stage.zoom),s=Math.round(this.distance*this.stage.zoom),i="radial"!==this.mode;this.rctx.save(),this.rctx.lineWidth=2,this.rctx.shadowBlur=6,this.rctx.shadowColor="rgba(0,0,0,0.5)",this.rctx.strokeStyle=n.z,this.rctx.translate(t.x,t.y),this.rctx.rotate(this.rotation),"symmetric"===this.mode?(this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,-s),this.rctx.lineTo(this.raster.width,-s),this.rctx.closePath(),this.rctx.stroke(),this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,s),this.rctx.lineTo(this.raster.width,s),this.rctx.closePath(),this.rctx.stroke(),this.rctx.setLineDash([5,8]),this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,-e),this.rctx.lineTo(this.raster.width,-e),this.rctx.closePath(),this.rctx.stroke(),this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,e),this.rctx.lineTo(this.raster.width,+e),this.rctx.closePath(),this.rctx.stroke()):"linear"===this.mode?(this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,s),this.rctx.lineTo(this.raster.width,s),this.rctx.closePath(),this.rctx.stroke(),this.rctx.setLineDash([5,8]),this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,e),this.rctx.lineTo(this.raster.width,e),this.rctx.closePath(),this.rctx.stroke()):(this.rctx.beginPath(),this.rctx.arc(0,0,s,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.stroke(),this.rctx.setLineDash([5,5]),this.rctx.beginPath(),this.rctx.arc(0,0,e,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.stroke()),this.rctx.setLineDash([]),this.rctx.fillStyle=n.q5,this.rctx.beginPath(),this.rctx.arc(0,e,"falloff"===this.control?12:8,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle="falloff"===this.control?n.bi:n.fu,this.rctx.beginPath(),this.rctx.arc(0,e,"falloff"===this.control?10:6,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle=n.q5,this.rctx.beginPath(),this.rctx.arc(0,s,"distance"===this.control?12:8,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle="distance"===this.control?n.bi:n.fu,this.rctx.beginPath(),this.rctx.arc(0,s,"distance"===this.control?10:6,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),i&&(this.rctx.fillStyle=n.q5,this.rctx.beginPath(),this.rctx.arc(50,-50,"rotation"===this.control?12:8,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle="rotation"===this.control?n.bi:n.fu,this.rctx.beginPath(),this.rctx.arc(50,-50,"rotation"===this.control?10:6,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill()),this.rctx.fillStyle=n.q5,this.rctx.beginPath(),this.rctx.arc(0,0,"center"===this.control?12:10,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle="center"===this.control?n.bi:n.KP,this.rctx.beginPath(),this.rctx.arc(0,0,"center"===this.control?10:8,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.restore()},this.reset=()=>{this.options={bokehBlur:!1,bokehBlurType:"circle",bokehBlurSize:.3,bokehBlurIntensity:.5,bokehShape:!1,bokehShapeDual:!1,bokehShapeType:"circle",bokehShapeHue:0,bokehShapeSize:.4,bokehShapeQuantity:.4,bokehShapeIntensity:.6},this.blurAmount.setValue(0),this.selected=void 0,this.cached=void 0,this.shape=void 0,this.blur=void 0,window.requestAnimationFrame((()=>{this.renderControls()})),this.layerSelect(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("reset")}))},this.applyClick=()=>{this.apply()},this.apply=()=>{if(!this.selected||!this.stage.fresco.hasLayer(this.selected))return;if(0===this.blurAmount.getValue()&&!this.options.bokehShape&&!this.options.bokehBlur)return;const t=new o.A(0,0,this.selected.rect.width,this.selected.rect.height),e=n.ON(this.selected.canvas);this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.shaders.reset(),this.options.bokehBlur=!1,this.options.bokehShape=!1,this.blurAmount.setValue(0),this.stage.history.add({type:"bitmapChange",kind:"focus",layer:this.selected,patchRect:t,patch:e,rect:this.selected.rect.clone()}),this.layerSelect(),this.rctx.clearRect(0,0,this.raster.width,this.raster.height)},this.cleanUp=async()=>{var t;(0!==this.blurAmount.getValue()||this.options.bokehShape||this.options.bokehBlur)&&this.apply(),this.removeMoveListeners(),this.removeDownListeners(),this.rctx.clearRect(0,0,this.raster.width,this.raster.height),this.stage.fresco.removeScratch(),null===(t=this.shaders)||void 0===t||t.cleanUp(),this.shaders=void 0,this.blurAmount.cleanUp(),(0,i.Ay)("focus-invert").removeEventListener("click",this.renderFocus,!0),(0,i.Ay)("focus-options").removeEventListener("click",this.showOptions,!0),(0,i.Ay)("focus-mode-symmetric").removeEventListener("change",this.selectMode,!1),(0,i.Ay)("focus-mode-linear").removeEventListener("change",this.selectMode,!1),(0,i.Ay)("focus-mode-radial").removeEventListener("change",this.selectMode,!1),(0,i.Ay)("focus-mode-none").removeEventListener("change",this.selectMode,!1),(0,i.Ay)("focus-apply").removeEventListener("click",this.applyClick,!1),(0,i.Ay)("focus-reset").removeEventListener("click",this.reset,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("viewport-render",this.renderControls,!1),window.requestAnimationFrame((()=>this.stage.render())),this.cached=void 0,this.shape=void 0,this.blur=void 0,this.raster=void 0,this.rctx=void 0},this.matrix=new d.A,this.shaders=new c.A,this.raster=t.raster,this.rctx=this.raster.getContext("2d"),(0,i.Ay)("focus-mode-symmetric").addEventListener("change",this.selectMode,!1),(0,i.Ay)("focus-mode-linear").addEventListener("change",this.selectMode,!1),(0,i.Ay)("focus-mode-radial").addEventListener("change",this.selectMode,!1),(0,i.Ay)("focus-mode-none").addEventListener("change",this.selectMode,!1),(0,i.Ay)("focus-invert").addEventListener("click",this.renderFocus,!0),(0,i.Ay)("focus-options").addEventListener("click",this.showOptions,!0),this.blurAmount=new l.A("focus-blur-amount",{label:(0,a.A)("blur")+":",range:[0,1],step:.01,compact:!0,defaultValue:0,labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onEnd:t=>this.renderBlurEvent()}),(0,i.Ay)("focus-apply").addEventListener("click",this.applyClick,!1),(0,i.Ay)("focus-reset").addEventListener("click",this.reset,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("viewport-render",this.renderControls,!1),this.mode=document.querySelector('input[name="focus-mode"]:checked').value,this.options={bokehBlur:!1,bokehBlurType:"circle",bokehBlurSize:.3,bokehBlurIntensity:.5,bokehShape:!1,bokehShapeDual:!1,bokehShapeType:"circle",bokehShapeHue:0,bokehShapeSize:.4,bokehShapeQuantity:.4,bokehShapeIntensity:.6},this.addDownListeners(),this.addMoveListeners(),this.layerSelect()}}},23580:(t,e,s)=>{s.d(e,{A:()=>w});var i=s(42268),a=s(54738),n=s(40963),o=s(75770),r=s(22866),h=s(26651),l=s(86755),c=s(97266),d=s(21742),u=s(15818),p=s(29755),g=s(8689),m=s(81937),v=s(82042),y=s(37771);class f extends y.A{constructor(t,e){super(e,(0,d.A)("styles"),!0),this.updateInputs=()=>{var t,e;(0,i.Ay)("frame-outline").checked=this.selected.frameSettings.outline,this.outlineColor.setColor(null!==(t=this.selected.frameSettings.outlineColor)&&void 0!==t?t:"#555555"),this.outlineSize.setValue(this.selected.frameSettings.outlineSize),(0,i.Ay)("frame-shadow").checked=this.selected.frameSettings.shadow,this.shadowColor.setColor(null!==(e=this.selected.frameSettings.shadowColor)&&void 0!==e?e:"#000000"),this.shadowBlur.setValue(this.selected.frameSettings.shadowBlur),this.shadowOpacity.setValue(this.selected.frameSettings.shadowOpacity),this.shadowDistance.setValue(this.selected.frameSettings.shadowDistance),this.shadowDirection.setValue(this.selected.frameSettings.shadowDirection)},this.changeOutlineState=()=>{const t=this.selected.frameSettings.clone();this.changeOutline(),this.stage.history.add({type:"frameSettings",kind:"outline",layer:this.selected,settings:t})},this.changeOutline=()=>{let t=(0,i.Ay)("frame-outline").checked,e=this.outlineColor.getColor().toHEX(),s=this.outlineSize.getValue();this.selected.setOutline(t,s,e),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeOutlineColor=t=>{const e=this.selected.frameSettings.clone();this.changeOutline(),this.stage.history.add({type:"frameSettings",kind:"outline",layer:this.selected,settings:e})},this.changeShadowState=()=>{const t=this.selected.frameSettings.clone();this.changeShadow(),this.stage.history.add({type:"frameSettings",kind:"shadow",layer:this.selected,settings:t})},this.changeShadow=()=>{this.selected.setShadow((0,i.Ay)("frame-shadow").checked,this.shadowBlur.getValue(),this.shadowOpacity.getValue(),this.shadowColor.getColor().toHEX(),this.shadowDistance.getValue(),this.shadowDirection.getValue()),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeShadowColor=t=>{const e=this.selected.frameSettings.clone();this.changeShadow(),this.stage.history.add({type:"frameSettings",kind:"shadow",layer:this.selected,settings:e})},this.cleanUp=()=>{this.selected=void 0,this.outlineColor.cleanUp(),this.outlineColor=void 0,this.shadowColor.cleanUp(),this.shadowColor=void 0,this.outlineSize.cleanUp(),this.shadowBlur.cleanUp(),this.shadowOpacity.cleanUp(),this.shadowDistance.cleanUp(),this.shadowDirection.cleanUp(),(0,i.Ay)("frame-outline").removeEventListener("change",this.changeOutlineState,!1),(0,i.Ay)("frame-shadow").removeEventListener("change",this.changeShadowState,!1),this.superCleanUp()},this.stage=t,this.selected=this.stage.fresco.getSelected(),this.content.id="frame-style-content",this.content.style.height="333px",this.content.style.overflow="hidden",this.content.style.paddingBottom="4px",this.setContent(`\n            <section>\n                <div>\n                    <input type="checkbox" class="toggle-check" id="frame-outline" />\n                    <label class="switch subline top-4" for="frame-outline">${(0,d.A)("outline")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <label class="split">${(0,d.A)("color")}<div id="frame-outline-color"></div></label>\n                        <div id="frame-outline-size" class="top-10"></div>\n                    </div>\n                </div>\n                <div>\n                    <input type="checkbox" class="toggle-check" id="frame-shadow" />\n                    <label class="switch subline top-10" for="frame-shadow">${(0,d.A)("shadow")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <label class="split">${(0,d.A)("color")}<div id="frame-shadow-color"></div></label>\n                        <div id="frame-shadow-blur" class="top-10"></div>\n                        <div id="frame-shadow-distance"></div>\n                        <div id="frame-shadow-direction"></div>\n                        <div id="frame-shadow-opacity"></div>\n                    </div>\n                </div>\n            </section>\n        `),this.outlineColor=new g.A("frame-outline-color",u.A.fromHEX(p.Ay.altColor),this.changeOutlineColor),this.shadowColor=new g.A("frame-shadow-color",u.A.fromHEX(p.Ay.altColor),this.changeShadowColor);let s=this.selected.frameSettings;const a={onStart:()=>{s=this.selected.frameSettings.clone()},labelFormat:t=>(100*t).toFixed(0),labelParse:t=>parseInt(t,100)/100};this.outlineSize=new v.A("frame-outline-size",Object.assign(Object.assign({},a),{label:(0,d.A)("size"),range:[.01,1],defaultValue:.3,step:.01,onChange:()=>this.changeOutline(),labelFormat:t=>(100*t).toFixed(0),labelParse:t=>parseInt(t,100)/100,onEnd:()=>{this.stage.history.add({type:"frameSettings",kind:"outline",layer:this.selected,settings:s})}}));const n=Object.assign(Object.assign({},a),{range:[0,1],onChange:()=>this.changeShadow(),onEnd:()=>{this.stage.history.add({type:"frameSettings",kind:"shadow",layer:this.selected,settings:s})}});this.shadowBlur=new v.A("frame-shadow-blur",Object.assign(Object.assign({},n),{label:(0,d.A)("blur")})),this.shadowOpacity=new v.A("frame-shadow-opacity",Object.assign(Object.assign({},n),{label:(0,d.A)("opacity"),defaultValue:1})),this.shadowDistance=new v.A("frame-shadow-distance",Object.assign(Object.assign({},n),{label:(0,d.A)("distance"),range:[0,1]})),this.shadowDirection=new v.A("frame-shadow-direction",Object.assign(Object.assign({},n),{label:(0,d.A)("direction"),range:[0,360],defaultValue:180,labelFormat:t=>t.toFixed(1),labelParse:t=>parseInt(t,10)})),(0,i.Ay)("frame-outline").addEventListener("change",this.changeOutlineState,!1),(0,i.Ay)("frame-shadow").addEventListener("change",this.changeShadowState,!1),this.updateInputs(),new m.A(this.content)}}class w extends o.A{constructor(t){super("frame",t),this.stage=t,this.showFrameStyles=()=>{new f(this.stage,(0,i.Ay)("frame-styles"))},this.keyDown=t=>{"Shift"!==t.key||this.isShiftDown||(this.isShiftDown=!0,this.reform.constrain=!1)},this.keyUp=t=>{"Shift"===t.key&&this.isShiftDown&&(this.isShiftDown=!1,this.reform.constrain=!0)},this.previewShape=t=>{this.selected.setPath(t,!0),window.requestAnimationFrame((()=>this.stage.render()))},this.selectShape=t=>{const e=this.selected.frameSettings.clone();this.selected.setPath(t),this.stage.history.add({type:"frameSettings",kind:"shape",layer:this.selected,settings:e}),window.requestAnimationFrame((()=>this.stage.render()))},this.layerSelect=()=>{if(this.selected&&this.selected!==this.stage.fresco.getSelected()&&(this.selected.editMode=!1,this.stage.history.commitTransaction()),!this.stage.fresco.isSelectedType(r.A.TYPE_FRAME))return(0,i.Ay)("frame-settings").style.display="none",(0,i.Ay)("frame-no-layer").style.display="flex",void(this.selected=void 0);(0,i.Ay)("frame-settings").style.display="flex",(0,i.Ay)("frame-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.shapePod.setPath(this.selected.frameSettings.clip)},this.toggle=()=>{this.selected.editMode||this.selected.canvas?(this.selected.editMode=!this.selected.editMode,document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))):this.stage.notify("frameNoContent")},this.reformDown=(t,e)=>{this.downPoint=t,this.usedtobe=e,this.stage.coating.freeze(!0),this.addMoveListeners()},this.move=t=>{const e=this.stage.translateToRect(this.downPoint,t,this.isShiftDown,!0);e.width>0&&e.height>0&&this.drawframe(e.topLeft(),e.bottomRight()),document.dispatchEvent(new CustomEvent("legend",{detail:"W: "+Math.round(e.width/this.stage.zoom)+"  H: "+Math.round(e.height/this.stage.zoom)}))},this.drawframe=(t,e)=>{const s=this.stage.coating.ctx;s.save(),s.lineWidth=2,s.strokeStyle=a.bi,s.clearRect(0,0,s.canvas.width,s.canvas.height),s.strokeRect(t.x,t.y,e.x-t.x,e.y-t.y),s.lineWidth=1,s.beginPath(),s.moveTo(t.x,t.y),s.lineTo(e.x,e.y),s.moveTo(e.x,t.y),s.lineTo(t.x,e.y),s.closePath(),s.stroke()},this.up=async t=>{if(this.stage.coating.clear(!0),this.stage.coating.freeze(!1),this.removeMoveListeners(),document.dispatchEvent(new CustomEvent("legend",{detail:"stop"})),this.downPoint.distanceTo(t)>10){const e=this.stage.translateToRect(this.downPoint,t,this.isShiftDown,!1);this.addFrame(e)}else this.usedtobe||await new c.A("Add Frame","Do you want to add a new Frame layer?","Add").init()&&this.addFrameEvent()},this.addFrameEvent=()=>{let t=this.stage.getViewPort(),e=new n.A(Math.round(t.x+t.width/4),Math.round(t.y+t.height/4),Math.round(t.width/2),Math.round(t.width/2));this.addFrame(e)},this.addFrame=t=>{this.stage.addFrame(t)},this.deleteLayer=()=>this.stage.deleteLayer(),this.duplicateLayer=()=>this.stage.duplicateLayer(),this.cleanUp=()=>{var t,e;this.stage.history.commitTransaction(),null===(t=this.reform)||void 0===t||t.cleanUp(),this.reform=void 0,this.shapePod.cleanUp(),this.shapePod=void 0,null===(e=this.stage)||void 0===e||e.coating.wake(),(0,i.Ay)("frame-toggle").removeEventListener("click",this.toggle,!1),(0,i.Ay)("frame-add-button").removeEventListener("click",this.addFrameEvent,!1),(0,i.Ay)("frame-browse").removeEventListener("click",this.stage.browseFrameImage,!1),(0,i.Ay)("frame-add").removeEventListener("click",this.addFrameEvent,!1),(0,i.Ay)("frame-delete").removeEventListener("click",this.deleteLayer,!1),(0,i.Ay)("frame-duplicate").removeEventListener("click",this.duplicateLayer,!1),(0,i.Ay)("frame-styles").removeEventListener("click",this.showFrameStyles,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1)},this.stage.coating.sleep(),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),(0,i.Ay)("frame-toggle").addEventListener("click",this.toggle,!1),(0,i.Ay)("frame-add-button").addEventListener("click",this.addFrameEvent,!1),(0,i.Ay)("frame-browse").addEventListener("click",this.stage.browseFrameImage,!1),(0,i.Ay)("frame-add").addEventListener("click",this.addFrameEvent,!1),(0,i.Ay)("frame-delete").addEventListener("click",this.deleteLayer,!1),(0,i.Ay)("frame-duplicate").addEventListener("click",this.duplicateLayer,!1),(0,i.Ay)("frame-styles").addEventListener("click",this.showFrameStyles,!1),this.reform=new h.A(t,"FRAME"),this.reform.proxy=this.reformDown,this.shapePod=new l.A("frame-shape",this.selectShape,this.previewShape),this.layerSelect()}}},19883:(t,e,s)=>{s.d(e,{A:()=>m});var i=s(42268),a=s(21742),n=s(54738),o=s(16309),r=s(40963),h=s(75770),l=s(15818),c=s(82042),d=s(22866),u=s(29755),p=s(58281),g=s(66495);class m extends h.A{constructor(t){super("gradient",t),this.isShiftDown=!1,this.shiftDown=t=>{"Shift"===t.key&&(this.isShiftDown=!0)},this.shiftUp=t=>{"Shift"===t.key&&(this.isShiftDown=!1)},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedType(d.A.TYPE_IMAGE))return(0,i.Ay)("gradient-no-layer").style.display="flex",(0,i.Ay)("gradient-settings").style.display="none",this.stage.raster.style.cursor="auto",void(this.selected=null);(0,i.Ay)("gradient-no-layer").style.display="none",(0,i.Ay)("gradient-settings").style.display="flex",this.stage.raster.style.cursor="crosshair",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new r.A(0,0,this.stage.fresco.width,this.stage.fresco.height),"over")},this.down=t=>{this.selected&&(this.stage.coating.freeze(!0),this.downPoint=t,this.stage.coating.ctx.strokeStyle=n.q5,this.stage.coating.ctx.fillStyle=n.bi,this.addMoveListeners())},this.move=t=>{if(this.isShiftDown){const e=this.downPoint.x-t.x,s=this.downPoint.y-t.y;Math.abs(e)<Math.abs(s)?t.x=this.downPoint.x:t.y=this.downPoint.y}window.requestAnimationFrame((()=>{this.downPoint&&(this.stage.coating.clear(!0),this.stage.coating.ctx.lineWidth=2,g.A.line(this.stage.coating.ctx,this.downPoint,t),this.stage.coating.ctx.stroke(),g.A.arc(this.stage.coating.ctx,this.downPoint,6),this.stage.coating.ctx.fill(),this.stage.coating.ctx.stroke(),g.A.arc(this.stage.coating.ctx,t,6),this.stage.coating.ctx.fill(),this.stage.coating.ctx.stroke(),this.stage.coating.ctx.lineWidth=1,this.stage.coating.render())}))},this.up=t=>{if(this.stage.coating.ctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.downPoint.x===t.x&&this.downPoint.y===t.y)return;if(this.downPoint=this.stage.translateRasterToFresco(this.downPoint),t=this.stage.translateRasterToFresco(t),this.isShiftDown){const e=this.downPoint.x-t.x,s=this.downPoint.y-t.y;Math.abs(e)<Math.abs(s)?t.x=this.downPoint.x:t.y=this.downPoint.y}let e,s=document.querySelector('input[name="gradient-type"]:checked').value;if(this.scratch.clear(),this.scratch.ctx.save(),"radial"===s){const s=this.downPoint.x-t.x,i=this.downPoint.y-t.y;e=this.scratch.ctx.createRadialGradient(this.downPoint.x,this.downPoint.y,0,this.downPoint.x,this.downPoint.y,Math.sqrt(s*s+i*i))}else e=this.scratch.ctx.createLinearGradient(this.downPoint.x,this.downPoint.y,t.x,t.y);this.downPoint=void 0,this.gradPod.grad.addStopToCanvasGradient(e),this.scratch.ctx.fillStyle=e,this.scratch.ctx.fillRect(0,0,this.scratch.canvas.width,this.scratch.canvas.height),this.scratch.ctx.restore(),this.scratch.applySelection(this.stage);let a=n.TL(this.scratch.getCanvas());if(a&&a.width>0&&a.height>0){let t=n.ON(this.selected.canvas,this.selected.rect?a.rebase(this.selected.rect.x,this.selected.rect.y):a);const e=n.oM(this.selected.mask),s=this.selected.rect?this.selected.rect.clone():void 0;this.selected.extendCanvas(a),this.scratch.drawToLayer(this.selected,(0,i.Ay)("gradient-blend").value,this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"gradient",layer:this.selected,patchRect:this.selected.rect?a.rebase(this.selected.rect.x,this.selected.rect.y):a,patch:t,rect:s,mask:e})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{var t;null===(t=this.stage.fresco)||void 0===t||t.removeScratch(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),this.gradPod.cleanUp(),this.opacity.cleanUp()},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1);let e=new o.Ay;e.addStop(l.A.fromHEX(u.Ay.mainColor),0),e.addStop(l.A.fromHEX(u.Ay.altColor),1),this.gradPod=new p.A("gradient-grad",e),this.opacity=new c.A("gradient-opacity",{compact:!0,label:(0,a.A)("opacity")+":",defaultValue:1,labelFormat:t=>(100*t).toFixed(0)+"%"}),this.addDownListeners(),this.layerSelect()}}},79522:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(42268),a=s(75770);class n extends a.A{constructor(t){super("hand",t),this.stage=t,this.z1x=()=>{this.stage.setZoom("1")},this.fit=()=>{this.stage.setZoom("fit")},this.fill=()=>{this.stage.setZoom("fill")},this.cleanUp=()=>{this.stage.coating.removePan(),(0,i.Ay)("hand-1x").removeEventListener("click",this.z1x,!1),(0,i.Ay)("hand-fit").removeEventListener("click",this.fit,!1),(0,i.Ay)("hand-fill").removeEventListener("click",this.fill,!1)},(0,i.Ay)("hand-1x").addEventListener("click",this.z1x,!1),(0,i.Ay)("hand-fit").addEventListener("click",this.fit,!1),(0,i.Ay)("hand-fill").addEventListener("click",this.fill,!1),this.stage.coating.setPan()}}},85806:(t,e,s)=>{s.d(e,{A:()=>v});var i=s(42268),a=s(21742),n=s(54738),o=s(40963),r=s(75770),h=s(82042),l=s(41915),c=s(15818),d=s(59350),u=s(71499);class p{constructor(t){this.stage=t,this.resize=()=>{const t=document.querySelector(".raster");this.container.style.top=t.style.top,this.container.style.left=t.style.left,this.container.style.width=t.style.width},this.bar=(0,i.T)("div"),this.container=(0,i.T)("div",{id:"workspace-progress"},this.bar),(0,i.Ay)("workspace").append(this.container),this.resize(),document.addEventListener("viewport-update",this.resize),document.addEventListener("resize",this.resize)}update(t){this.bar.style.width=`${(100*t).toFixed(0)}%`}show(){this.bar.style.width="0",this.container.style.display="block",this.resize()}hide(){this.container.style.display="none",this.resize()}cleanUp(){this.container.remove()}}var g=s(56479);const m={speed:[2,20],balanced:[20,20],quality:[50,50],ultra:[100,100]};class v extends r.A{constructor(t){super("heal",t),this.workset=null,this.changeMode=()=>{this.mode=document.querySelector('input[name="heal-mode"]:checked').value,this.stage.fresco.setBlock(),this.updateBrush(),(0,i.Ay)("heal-presets").style.display="object"===this.mode?"flex":"none"},this.layerSelect=()=>{var t,e;if((null===(t=this.selected)||void 0===t?void 0:t.id)!==(null===(e=this.stage.fresco.getSelected())||void 0===e?void 0:e.id)&&(this.cleanUpWorker(),this.worker=new g.d8),!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.Ay)("heal-no-layer").style.display="flex",(0,i.Ay)("heal-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.Ay)("heal-settings").style.display="flex",(0,i.Ay)("heal-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.scratch.settings.opacity=.4,this.updateBrush()},this.keyDown=t=>{if(","===t.key||"."===t.key){switch(t.key){case",":this.size.setValue(this.size.getValue()-10);break;case".":this.size.setValue(this.size.getValue()+10)}this.brush.settings.size=this.size.getValue(),this.updateBrush()}},this.updateBrush=()=>{this.brush.generate(new c.A(0,255,0,255)),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage()},this.down=(t,e)=>{if(!this.selected||null!==this.workset)return;let s=document.querySelector('input[name="heal-mode"]:checked').value;"spot"===s?(this.stage.coating.animateCursorTap(),this.applyHealSpot(t)):"soft"===s?(this.stage.coating.animateCursorTap(),this.applyHealSoft(t)):(this.brushPoints=[],this.x=this.y=-1,"touch"!==e&&this.move(t),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=t=>{let e=this.brush.getStep(),s=!1;if(t=this.stage.translateRasterToFresco(t,this.selected.rect),-1==this.x&&(this.lx=t.x,this.ly=t.y,this.x=t.x,this.y=t.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),t.x!==this.x||t.y!==this.y){let i=t.x-this.x,a=t.y-this.y,n=i>0?1:-1,o=a>0?1:-1;if(i=i<0?-i:i,a=a<0?-a:a,i>a){let t=.5*i;for(let r=1;r<=i;r++)this.x+=n,t+=a,t>=i&&(t-=i,this.y+=o),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let t=.5*a;for(let r=1;r<=a;r++)this.y+=o,t+=i,t>=a&&(t-=a,this.x+=n),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&window.requestAnimationFrame((()=>this.stage.render()))},this.drawShape=(t,e)=>{this.brushPoints.push(new l.A(t,e)),this.scratch.ctx.drawImage(this.brush.canvas,t,e)},this.up=async t=>{try{this.removeMoveListeners();const t=document.querySelector('input[name="heal-preset"]:checked').value,[e,s]=m[t];let i=50;"ultra"===t&&(i=100);let a=o.A.fromPointRects(this.brushPoints,this.brush.canvas.width,this.brush.canvas.height);if(a.x-=i,a.y-=i,a.width+=2*i,a.height+=2*i,a=a.intersect(new o.A(0,0,this.scratch.canvas.width,this.scratch.canvas.height)),!a)return;const r=n.ON(this.selected.canvas,a);this.workset=[a,r],await this.fill(a,!0,e,s),this.stage.history.add({type:"bitmapChange",kind:"healObject",layer:this.selected,patchRect:a,patch:r,rect:this.selected.rect.clone()})}finally{this.workset=null}},this.applyHealSpot=async t=>{try{(t=this.stage.translateRasterToFresco(t,this.selected.rect)).x-=~~(this.brush.canvas.width/2),t.y-=~~(this.brush.canvas.height/2),this.scratch.ctx.drawImage(this.brush.canvas,t.x,t.y);let e=this.brush.canvas.width,s=this.brush.canvas.height;const i=50;let a=new o.A(t.x-i,t.y-i,e+2*i,s+2*i);if(a=a.intersect(new o.A(0,0,this.scratch.canvas.width,this.scratch.canvas.height)),!a)return;const r=n.ON(this.selected.canvas,a);this.workset=[a,r];const[h,l]=m.balanced;await this.fill(a,!1,h,l),this.stage.history.add({type:"bitmapChange",kind:"healSpot",layer:this.selected,patchRect:a,patch:r,rect:this.selected.rect.clone()})}finally{this.workset=null}},this.fill=async(t,e,s,i)=>{e&&(this.stage.coating.removeCursorImage(),this.progress.show());const a=this.selected.canvas.getContext("2d"),o=a.getImageData(t.x,t.y,t.width,t.height),r=n.Nw(t.width,t.height),h=r.getContext("2d");h.fillStyle="#fff",h.fillRect(0,0,t.width,t.height),h.drawImage(this.scratch.canvas,t.x,t.y,t.width,t.height,0,0,t.width,t.height);const l=h.getImageData(0,0,t.width,t.height);this.worker.send({image:o,neighbour:s,random:i,mask:l,intermediateImage:e},[o.data.buffer,l.data.buffer]),h.globalCompositeOperation="copy",h.drawImage(this.scratch.canvas,t.x,t.y,t.width,t.height,0,0,t.width,t.height);const c=n.Nw(t.width,t.height),d=c.getContext("2d");for(d.globalCompositeOperation="destination-atop",this.scratch.clear(),this.stage.render();;){const{progress:e,image:s}=await this.worker.receive();if("done"===e){this.progress.update(1),a.putImageData(s,t.x,t.y);break}this.progress.update(e),s&&(d.putImageData(s,0,0),d.drawImage(r,0,0),a.drawImage(c,0,0,t.width,t.height,t.x,t.y,t.width,t.height),window.requestAnimationFrame((()=>{this.selected.render(),this.stage.render()})))}e&&(setTimeout((()=>this.progress.hide()),300),this.updateBrush()),this.selected.render(),this.stage.render()},this.cleanUpWorker=()=>{var t;if(null===(t=this.worker)||void 0===t||t.terminate(),this.progress.hide(),this.workset){const[t,e]=this.workset;this.selected.canvas.getContext("2d").putImageData(e,t.x,t.y),this.selected.render(),this.stage.render(),this.workset=null}},this.apply=()=>{},this.applyHealSoft=t=>{(t=this.stage.translateRasterToFresco(t,this.selected.rect)).x-=~~(this.brush.canvas.width/2),t.y-=~~(this.brush.canvas.height/2);let e=this.brush.canvas.width,s=this.brush.canvas.height;const i=new o.A(t.x,t.y,e,s),a=n.ON(this.selected.canvas,i);this.blendImages(t),this.selected.render(),this.stage.render(),this.stage.history.add({type:"bitmapChange",kind:"healSoft",layer:this.selected,patchRect:i,patch:a,rect:this.selected.rect.clone()})},this.blendImages=t=>{let e=this.brush.canvas.width,s=this.brush.canvas.height,i=this.brush.canvas.getContext("2d").getImageData(0,0,e,s),a=this.selected.canvas.getContext("2d");var n=a.getImageData(t.x,t.y,e,s),r=a.getImageData(t.x,t.y,e,s);r=this.createGradient(r,n);let h=new o.A(t.x-e,t.y-s,3*e,3*s),l=a.getImageData(h.x,h.y,h.width,h.height);var c=this.locateBestTexture(l,h,e);c.x+=t.x-e,c.y+=t.y-s;var d=a.getImageData(c.x,c.y,e,s);let u,p,g,m=1,v=0,y=0,f=0,w=0,x=0,b=0,A=0,k=0;for(;;){for(u=0,p=0,f=1;f<s-1;f++)for(y=1;y<e-1;y++)if(w=4*(f*e+y),i.data[w+3]>0)for(g=[4*((f-1)*e+y),4*((f+1)*e+y),4*(f*e+(y-1)),4*(f*e+(y+1))],b=0;b<3;b++){for(A=0,x=0;x<4;x++)i.data[w+3]>64?A+=r.data[g[x]+b]:A+=n.data[g[x]+b],A+=d.data[w+b]-d.data[g[x]+b];k=A/4,u+=Math.abs(k-r.data[w+b]),p+=Math.abs(k),r.data[w+b]=k}v++;var S=u/p;if(!S||m-S==0||v>250)break;m=S}a.putImageData(r,t.x,t.y)},this.locateBestTexture=(t,e,s)=>{let i=this.sobel(t),a=new l.A(-1,-1),n=Number.POSITIVE_INFINITY,r=new l.A(Math.round(e.width/2),Math.round(e.height/2));const h=Math.round(s/2);let c=new o.A(0,0,this.selected.canvas.width,this.selected.canvas.height);for(let l=0;l<40;l++){const t=r.y-Math.round(Math.sin(2*Math.PI*l/40)*s),d=r.x+Math.round(Math.cos(2*Math.PI*l/40)*s);if(!c.contains(new o.A(d-h+e.x,t-h+e.y,s,s)))continue;let u=this.computeEnergy(i,e.width,d-h,t-h,s);u<n&&(n=u,a.x=d-h,a.y=t-h)}return a},this.computeEnergy=(t,e,s,i,a)=>{let n=0;for(let o=i;o<i+a;o+=2)for(let i=s;i<s+a;i+=2){let s=t[o*e+i];n+=s*s}return n},this.pixelAt=(t,e,s,i)=>s[e*i+t],this.sobel=t=>{var e,s,i,a=t.width,n=t.height,o=[[-1,0,1],[-2,0,2],[-1,0,1]],r=[[-1,-2,-1],[0,0,0],[1,2,1]],h=new Array,l=new Array;for(s=0;s<n;s++)for(e=0;e<a;e++)i=4*(s*a+e),l.push(Math.round((t.data[i]+t.data[i+1]+t.data[i+2])/3));for(s=0;s<n;s++)for(e=0;e<a;e++){var c=o[0][0]*this.pixelAt(e-1,s-1,l,a)+o[0][1]*this.pixelAt(e,s-1,l,a)+o[0][2]*this.pixelAt(e+1,s-1,l,a)+o[1][0]*this.pixelAt(e-1,s,l,a)+o[1][1]*this.pixelAt(e,s,l,a)+o[1][2]*this.pixelAt(e+1,s,l,a)+o[2][0]*this.pixelAt(e-1,s+1,l,a)+o[2][1]*this.pixelAt(e,s+1,l,a)+o[2][2]*this.pixelAt(e+1,s+1,l,a),d=r[0][0]*this.pixelAt(e-1,s-1,l,a)+r[0][1]*this.pixelAt(e,s-1,l,a)+r[0][2]*this.pixelAt(e+1,s-1,l,a)+r[1][0]*this.pixelAt(e-1,s,l,a)+r[1][1]*this.pixelAt(e,s,l,a)+r[1][2]*this.pixelAt(e+1,s,l,a)+r[2][0]*this.pixelAt(e-1,s+1,l,a)+r[2][1]*this.pixelAt(e,s+1,l,a)+r[2][2]*this.pixelAt(e+1,s+1,l,a),u=Math.sqrt(c*c+d*d)>>>0;h.push(u)}return h},this.createGradient=(t,e)=>{var s,i,a=Math.round(.4*e.height);let n=Math.round(.1*a),o=~~(e.width/2),r=~~(e.height/2),h=e.width,l=0,c=0;for(var d=-a;d<a;d++)for(var u=-a;u<a;u++)(i=(Math.sqrt(d*d+u*u)+1)/(a-1))<1&&(s=Math.round(u/i+(Math.random()*n-n/2)),l=4*((r+d)*h+(o+u)),c=4*((r+Math.round(d/i+(Math.random()*n-n/2)))*h+(o+s)),t.data[l]=e.data[c],t.data[l+1]=e.data[c+1],t.data[l+2]=e.data[c+2]);n=Math.round(.5*a);for(d=-(a=Math.round(.8*a));d<a;d++)for(u=-a;u<a;u++)Math.sqrt(d*d+u*u)<a&&(s=Math.round(u+(Math.random()*n-n/2)),l=4*((r+d)*h+(o+u)),c=4*((r+Math.round(d+(Math.random()*n-n/2)))*h+(o+s)),t.data[l]=t.data[c],t.data[l+1]=t.data[c+1],t.data[l+2]=t.data[c+2]);return t},this.cleanUp=()=>{var t;this.cleanUpWorker(),null===(t=this.stage.fresco)||void 0===t||t.removeScratch(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("fresco-select",this.changeMode,!1),document.removeEventListener("keydown",this.keyDown,!1),this.size.cleanUp(),this.progress.cleanUp(),document.getElementsByName("heal-mode").forEach((t=>{t.removeEventListener("click",this.changeMode,!1)})),this.selected=null,this.scratch=null},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),document.addEventListener("fresco-select",this.changeMode,!1),document.addEventListener("keydown",this.keyDown,!1),this.brush=new d.A(new u.A("circle",50,0)),this.progress=new p(this.stage),this.size=new h.A("heal-brush-size",{compact:!0,label:(0,a.A)("size")+":",step:2,range:[5,200],defaultValue:this.brush.settings.size,labelFormat:t=>t.toFixed(0),onEnd:t=>{this.brush.settings.size=t,this.updateBrush()}}),document.getElementsByName("heal-mode").forEach((t=>{t.addEventListener("click",this.changeMode,!1)})),this.addDownListeners(),this.changeMode(),this.layerSelect()}}},89373:(t,e,s)=>{s.d(e,{A:()=>u});var i=s(42268),a=s(21742),n=s(54738),o=s(23556),r=s(41915),h=s(82042),l=s(59350),c=s(71499),d=s(8594);class u extends d.A{constructor(t){super("lasso",t),this.points=[],this.selectMode=()=>{this.mode=document.querySelector('input[name="lasso-mode"]:checked').value},this.selectType=t=>{this.type=t.currentTarget.value,(0,i.Ay)("lasso-magnet-settings").style.display="magnet"===this.type?"block":"none",this.noGoZone="lasso"!==this.type,"magnet"!==this.type||this.edges||this.generateEdges()},this.layerSelect=()=>{"magnet"===this.type&&this.generateEdges()},this.viewportChange=()=>{this.points&&this.points.length>1&&window.requestAnimationFrame((()=>{"bezier"===this.type?this.stage.coating.drawAntBezier(this.points.map((t=>this.stage.translateFrescoToRaster(t)))):this.stage.coating.drawAntPolygon(this.points.map((t=>this.stage.translateFrescoToRaster(t))))}))},this.generateEdges=()=>{const t=new o.A([]);t.addShader("gaussian",.2),t.addShader("sobel",1),this.edges=n.oM(t.apply(this.stage.getOutputCanvas(this.stage.fresco,1))),this.edgeData=this.edges.getContext("2d").getImageData(0,0,this.edges.width,this.edges.height)},this.keyDown=t=>{"Shift"!==t.key||this.isShiftDown||(this.isShiftDown=!0,this.isDown||((0,i.Ay)("lasso-mode-add").checked=!0,this.selectMode())),"Control"!==t.key||this.isCtrlDown||(this.isCtrlDown=!0,this.isDown||((0,i.Ay)("lasso-mode-remove").checked=!0,this.selectMode()))},this.keyUp=t=>{"Shift"===t.key&&this.isShiftDown&&(this.isShiftDown=!1,this.isCtrlDown||this.isDown||((0,i.Ay)("lasso-mode-new").checked=!0,this.selectMode())),"Control"===t.key&&this.isCtrlDown&&(this.isCtrlDown=!1,this.isDown||((0,i.Ay)("lasso-mode-new").checked=!0,this.selectMode()))},this.down=t=>{if(t=this.stage.translateRasterToFresco(t,void 0,!1),(new Date).getTime()-this.stamp<350&&"free"!==this.type&&(this.points.length<2||this.points[this.points.length-1].distanceTo(this.points[this.points.length-2])<10))return 0!==this.points.length&&this.closeLoop(),this.removeMoveListeners(),void(this.isDown=!1);if(this.stamp=(new Date).getTime(),this.stage.coating.freeze(!0),0===this.points.length&&this.setHistory(),0===this.points.length&&"new"===this.mode&&this.stage.fresco.selection&&(this.stage.fresco.selection.clear(),window.requestAnimationFrame((()=>this.stage.coating.render()))),0===this.points.length&&(this.addMoveListeners(),"magnet"===this.type&&this.stage.coating.setCursorImage(new l.A(new c.A("circle",this.size.getValue(),0)).getCursorImage(1))),this.points.length>3&&"free"!==this.type)if("bezier"===this.type){if(this.points[0].distanceTo(this.points[this.points.length-2])<10/this.stage.zoom)return void this.closeLoop()}else if(this.points[0].distanceTo(this.points[this.points.length-1])<10/this.stage.zoom)return void this.closeLoop();this.points.push(t),"free"!==this.type&&1===this.points.length&&this.points.push(t.clone())},this.move=t=>{switch(t=this.stage.translateRasterToFresco(t,void 0,!1),this.type){case"free":if(!this.isDown)return;this.points.push(t);break;case"polygon":case"bezier":this.points[this.points.length-1]=t;break;case"magnet":this.findAnchor(t)}window.requestAnimationFrame((()=>{"bezier"===this.type?this.stage.coating.drawAntBezier(this.points.map((t=>this.stage.translateFrescoToRaster(t)))):this.stage.coating.drawAntPolygon(this.points.map((t=>this.stage.translateFrescoToRaster(t))))}))},this.up=t=>{"free"===this.type&&(t=this.stage.translateRasterToFresco(t,void 0,!1),this.isDown=!1,this.removeMoveListeners(),this.stage.coating.freeze(!1),this.points.length<3?this.stage.fresco.selection&&this.stage.fresco.selection.bounds&&this.stage.fresco.selection.bounds.width>0&&(this.stage.fresco.selection.reset(),this.addHistory("deselect")):(this.stage.fresco.addSelection(),this.stage.fresco.selection.editPolygon(this.points,this.feather.getValue(),!(0,i.Ay)("lasso-anti-alias").checked,"remove"===this.mode),this.addHistory()),window.requestAnimationFrame((()=>this.stage.coating.render())),this.points=[])},this.closeLoop=()=>{this.isDown=!1,this.removeMoveListeners(),this.stage.coating.freeze(!1),this.stage.coating.removeCursorImage(),this.stage.raster.style.cursor="crosshair",this.points.length>2?(this.stage.fresco.addSelection(),"bezier"===this.type?this.stage.fresco.selection.editBezier(this.points,this.feather.getValue(),!(0,i.Ay)("lasso-anti-alias").checked,"remove"===this.mode):this.stage.fresco.selection.editPolygon(this.points,this.feather.getValue(),!(0,i.Ay)("lasso-anti-alias").checked,"remove"===this.mode),this.addHistory()):this.stage.fresco.hasSelection()&&(this.stage.fresco.selection.reset(),this.addHistory("deselect")),window.requestAnimationFrame((()=>this.stage.coating.render())),this.points=[]},this.findAnchor=t=>{let e=this.size.getValue();if(t=new r.A(Math.round(t.x),Math.round(t.y)),0===this.points.length||this.points[this.points.length-1].distanceTo(t)>e/10){let s,i=this.size.getValue()/2,a=this.edges.width,n=new r.A,o=e;for(let r=t.y-i,h=t.y+i;r<h;++r)for(let l=t.x-i,c=t.x+i;l<c;++l){n.x=l,n.y=r;let i=t.distanceTo(n);if(i>e)continue;let h=this.edgeData.data[4*(r*a+l)];h>18&&(h=.333*i+i*(1-h/255)*.666,h<o&&(s=n.clone(),o=h))}s&&(t=s),this.checkAndAdd(t,e/10)}},this.checkAndAdd=(t,e)=>{let s=this.points.slice(Math.max(this.points.length-3,0)),i=!1;s.forEach((s=>{s.distanceTo(t)<e&&(i=!0)})),i||this.points.push(t)},this.cancel=()=>{"free"!==this.type&&(this.points.length>2?("polygon"===this.type||"bezier"===this.type?this.points.splice(-2,1):this.points.pop(),window.requestAnimationFrame((()=>{"bezier"===this.type?this.stage.coating.drawAntBezier(this.points.map((t=>this.stage.translateFrescoToRaster(t)))):this.stage.coating.drawAntPolygon(this.points.map((t=>this.stage.translateFrescoToRaster(t))))}))):(this.points=[],this.isDown=!1,this.removeMoveListeners(),this.stage.coating.freeze(!1),this.stage.coating.removeCursorImage(),this.stage.raster.style.cursor="crosshair",this.stage.fresco.hasSelection()&&(this.stage.fresco.selection.reset(),this.addHistory("deselect")),window.requestAnimationFrame((()=>this.stage.coating.render()))))},this.apply=()=>{"free"!==this.type&&this.points.length>2&&this.closeLoop()},this.cleanUp=()=>{var t;(this.isShiftDown||this.isCtrlDown)&&((0,i.Ay)("lasso-mode-new").checked=!0),this.superClean(),this.stage.fresco&&this.stage.fresco.selection&&0===(null===(t=this.stage.fresco.selection.outline)||void 0===t?void 0:t.length)&&this.stage.fresco.removeSelection(),this.removeMoveListeners(),this.size.cleanUp(),this.feather.cleanUp(),this.edges=void 0,this.edgeData=void 0,document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("viewport-render",this.viewportChange,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),(0,i.Ay)("lasso-type-free").removeEventListener("change",this.selectType,!1),(0,i.Ay)("lasso-type-polygon").removeEventListener("change",this.selectType,!1),(0,i.Ay)("lasso-type-bezier").removeEventListener("change",this.selectType,!1),(0,i.Ay)("lasso-type-magnet").removeEventListener("change",this.selectType,!1)},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("viewport-render",this.viewportChange,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),(0,i.Ay)("lasso-type-free").addEventListener("change",this.selectType,!1),(0,i.Ay)("lasso-type-polygon").addEventListener("change",this.selectType,!1),(0,i.Ay)("lasso-type-bezier").addEventListener("change",this.selectType,!1),(0,i.Ay)("lasso-type-magnet").addEventListener("change",this.selectType,!1),this.feather=new h.A("lasso-feather",{compact:!0,defaultValue:0,label:(0,a.A)("feather")+":",labelFormat:t=>(100*t).toFixed(0),labelParse:t=>parseInt(t,10)/100}),this.size=new h.A("lasso-magnet-size",{compact:!0,label:(0,a.A)("size")+":",step:2,range:[5,120],defaultValue:50,labelFormat:t=>t.toFixed(0)}),this.type=document.querySelector('input[name="lasso-type"]:checked').value,"magnet"===this.type&&this.generateEdges(),this.noGoZone="lasso"!==this.type,(0,i.Ay)("lasso-mode-new").addEventListener("change",this.selectMode,!1),(0,i.Ay)("lasso-mode-add").addEventListener("change",this.selectMode,!1),(0,i.Ay)("lasso-mode-remove").addEventListener("change",this.selectMode,!1),this.selectMode()}}},57346:(t,e,s)=>{s.d(e,{A:()=>d});var i=s(42268),a=s(54738),n=s(75770),o=s(82042),r=s(15818),h=s(59350),l=s(71499),c=s(21742);class d extends n.A{constructor(t){super("liquify",t),this.timedStroke=!1,this.keyDown=t=>{if(","===t.key||"."===t.key){switch(t.key){case",":this.size.setValue(this.size.getValue()-10);break;case".":this.size.setValue(this.size.getValue()+10)}this.updateBrush()}},this.layerSelect=async()=>{const{Displacement:t}=await Promise.resolve().then(s.bind(s,82355));if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.Ay)("liquify-no-layer").style.display="flex",(0,i.Ay)("liquify-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.Ay)("liquify-settings").style.display="flex",(0,i.Ay)("liquify-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.settings.blendmode=this.selected.settings.blendmode,this.scratch.settings.opacity=this.selected.settings.opacity,this.scratch.setTarget(this.selected.id,this.selected.rect,"replace"),this.scratch.ctx.drawImage(this.selected.canvas,0,0);const e=this.selected.canvas.getContext("2d").getImageData(0,0,this.selected.canvas.width,this.selected.canvas.height);if(this.displacement)this.displacement.retarget(e.data,e.width,e.height);else{this.displacement=new t(e.data,e.width,e.height,this.size.getValue(),this.strength.getValue(),this.density.getValue());const s=document.querySelector('input[name="liquify-mode"]:checked').value;this.setMode(s),this.brush.settings.size=this.size.getValue()}this.updateBrush(),this.stage.render()},this.selectMode=t=>{this.setMode(t.currentTarget.value)},this.setMode=t=>{var e;this.timedStroke="MOVE"!==t,null===(e=this.displacement)||void 0===e||e.setMode(t)},this.updateBrush=()=>{var t;this.brush.settings.size=this.size.getValue(),null===(t=this.displacement)||void 0===t||t.setStampSize(this.size.getValue()),this.brush.generate(),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom,new r.A(255,255,255,255))):this.stage.coating.removeCursorImage()},this.down=(t,e)=>{this.selected&&this.displacement&&(this.stage.coating.freeze(!0),this.stroke=this.displacement.beginStroke(),this.highQualityStroke=(0,i.Ay)("liquify-hq-preview").checked,"touch"!==e&&this.move(t),this.addMoveListeners())},this.move=t=>{const e=this.stage.translateRasterToFresco(t,this.selected.rect),s=this.stroke.push(e.x,e.y,this.timedStroke);if(s){this.strokeDamage=s.union(this.strokeDamage);const t=this.highQualityStroke?this.displacement.applyQuality(s):this.displacement.applyFast(s);this.scratch.ctx.putImageData(new ImageData(t,s.width,s.height),s.x,s.y),window.requestAnimationFrame((()=>this.stage.render()))}this.timedStroke&&(window.clearTimeout(this.strokeTimeout),this.strokeTimeout=window.setTimeout((()=>this.move(t)),16))},this.up=t=>{var e;if(null===(e=this.stroke)||void 0===e||e.free(),this.stroke=void 0,window.clearTimeout(this.strokeTimeout),this.removeMoveListeners(),!this.displacement||!this.strokeDamage)return;const s=this.strokeDamage;if(this.strokeDamage=void 0,!this.highQualityStroke){let t=this.displacement.applyQuality(s);this.scratch.ctx.putImageData(new ImageData(t,s.width,s.height),s.x,s.y),window.requestAnimationFrame((()=>this.stage.render()))}const i=a.ON(this.selected.canvas,s),n=this.selected.rect.clone(),o=this.selected.canvas.getContext("2d");o.clearRect(s.x,s.y,s.width,s.height),o.drawImage(this.scratch.canvas,s.x,s.y,s.width,s.height,s.x,s.y,s.width,s.height),this.scratch.clear(),this.scratch.ctx.drawImage(this.selected.canvas,0,0),this.selected.render(),this.stage.render(),this.stage.history.add({type:"bitmapChange",kind:"liquify",layer:this.selected,patchRect:s,patch:i,rect:n})},this.cleanUp=()=>{var t,e,s;null===(t=this.displacement)||void 0===t||t.free(),null===(e=this.stroke)||void 0===e||e.free(),null===(s=this.stage.fresco)||void 0===s||s.removeScratch(),this.removeDownListeners(),this.size.cleanUp(),this.strength.cleanUp(),this.density.cleanUp(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.keyDown,!1),document.getElementsByName("liquify-mode").forEach((t=>{t.removeEventListener("click",this.selectMode,!1)}))},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),document.addEventListener("keydown",this.keyDown,!1),document.getElementsByName("liquify-mode").forEach((t=>{t.addEventListener("click",this.selectMode,!1)})),this.brush=new h.A(new l.A("circle",50,0)),this.size=new o.A("liquify-brush-size",{compact:!0,label:(0,c.A)("size")+":",step:2,range:[5,500],defaultValue:50,labelFormat:t=>t.toFixed(0),onEnd:()=>this.updateBrush()}),this.strength=new o.A("liquify-brush-strength",{compact:!0,label:(0,c.A)("strength")+":",range:[.01,1],defaultValue:.5,step:.01,labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100,onEnd:t=>{var e;return null===(e=this.displacement)||void 0===e?void 0:e.setStrength(t)}}),this.density=new o.A("liquify-brush-density",{compact:!0,label:(0,c.A)("density")+":",range:[0,.95],defaultValue:.5,step:.01,labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100,onEnd:t=>{var e;return null===(e=this.displacement)||void 0===e?void 0:e.setDensity(t)}}),this.addDownListeners(),this.layerSelect()}}},69175:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(8594),a=s(82042),n=s(40963),o=s(42268),r=s(21742);class h extends i.A{constructor(t){super("marquee",t),this.selectMode=()=>{this.mode=document.querySelector('input[name="marquee-mode"]:checked').value},this.keyDown=t=>{"Shift"!==t.key||this.isShiftDown||(this.isShiftDown=!0,this.isDown||((0,o.Ay)("marquee-mode-add").checked=!0,this.selectMode())),"Control"!==t.key||this.isCtrlDown||(this.isCtrlDown=!0,this.isDown||((0,o.Ay)("marquee-mode-remove").checked=!0,this.selectMode()))},this.keyUp=t=>{"Shift"===t.key&&this.isShiftDown&&(this.isShiftDown=!1,this.isCtrlDown||this.isDown||((0,o.Ay)("marquee-mode-new").checked=!0,this.selectMode())),"Control"===t.key&&this.isCtrlDown&&(this.isCtrlDown=!1,this.isDown||((0,o.Ay)("marquee-mode-new").checked=!0,this.selectMode()))},this.down=t=>{this.setHistory(),this.stage.coating.freeze(!0),this.addMoveListeners(),this.type=document.querySelector('input[name="marquee-type"]:checked').value,"new"===this.mode&&this.stage.fresco.selection&&(this.stage.fresco.selection.clear(),window.requestAnimationFrame((()=>this.stage.coating.render())))},this.move=t=>{if(this.isDown){let e=this.stage.translateToRect(this.downPoint,t,!this.stage.fresco.hasSelection()&&this.isShiftDown,!0);window.requestAnimationFrame((()=>{"rectangle"===this.type?this.stage.coating.drawAntRectangle(e):this.stage.coating.drawAntEllipse(e)})),document.dispatchEvent(new CustomEvent("legend",{detail:"W: "+Math.round(e.width/this.stage.zoom)+"  H: "+Math.round(e.height/this.stage.zoom)}))}},this.up=t=>{this.isDown=!1,this.stage.coating.freeze(!1),this.removeMoveListeners(),document.dispatchEvent(new CustomEvent("legend",{detail:"stop"}));let e=this.stage.translateToRect(this.downPoint,t,!this.stage.fresco.hasSelection()&&this.isShiftDown,!1);this.downPoint.x===t.x&&this.downPoint.y===t.y||!e.intersect(new n.A(0,0,this.stage.fresco.width,this.stage.fresco.height))?this.stage.fresco.selection&&this.stage.fresco.selection.bounds&&this.stage.fresco.selection.bounds.width>0&&(this.stage.fresco.selection.reset(),this.addHistory("deselect"),window.requestAnimationFrame((()=>this.stage.coating.render()))):(this.stage.fresco.addSelection(),"rectangle"===this.type?this.stage.fresco.selection.editRectangle(e,this.feather.getValue(),"remove"===this.mode):this.stage.fresco.selection.editEllipse(e,this.feather.getValue(),!(0,o.Ay)("marquee-anti-alias").checked,"remove"===this.mode),window.requestAnimationFrame((()=>this.stage.coating.render())),this.addHistory())},this.cleanUp=()=>{var t;(this.isShiftDown||this.isCtrlDown)&&((0,o.Ay)("marquee-mode-new").checked=!0),this.superClean(),this.stage.fresco&&this.stage.fresco.selection&&0===(null===(t=this.stage.fresco.selection.outline)||void 0===t?void 0:t.length)&&this.stage.fresco.removeSelection(),this.feather.cleanUp(),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),(0,o.Ay)("marquee-mode-new").removeEventListener("change",this.selectMode,!1),(0,o.Ay)("marquee-mode-add").removeEventListener("change",this.selectMode,!1),(0,o.Ay)("marquee-mode-remove").removeEventListener("change",this.selectMode,!1)},document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),this.feather=new a.A("marquee-feather",{compact:!0,defaultValue:0,label:(0,r.A)("feather")+":",labelFormat:t=>(100*t).toFixed(0),labelParse:t=>parseInt(t,10)/100}),(0,o.Ay)("marquee-mode-new").addEventListener("change",this.selectMode,!1),(0,o.Ay)("marquee-mode-add").addEventListener("change",this.selectMode,!1),(0,o.Ay)("marquee-mode-remove").addEventListener("change",this.selectMode,!1),this.selectMode()}}},33850:(t,e,s)=>{s.d(e,{A:()=>p});var i=s(42268),a=s(21742),n=s(54738),o=s(40963),r=s(75770);function h(t,e){return Math.floor(Math.random()*(e-t+1))+t}var l=s(82042),c=s(22866),d=s(29755),u=s(56480);class p extends r.A{constructor(t){super("pen",t),this.stage=t,this.pathPoints=[],this.layerSelect=()=>{if(!this.stage.fresco.isSelectedType(c.A.TYPE_IMAGE))return(0,i.Ay)("pen-no-layer").style.display="flex",(0,i.Ay)("pen-settings").style.display="none",this.stage.raster.style.cursor="auto",void(this.selected=null);(0,i.Ay)("pen-no-layer").style.display="none",(0,i.Ay)("pen-settings").style.display="flex",this.stage.raster.style.cursor="crosshair",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new o.A(0,0,this.stage.fresco.width,this.stage.fresco.height),"over"),this.stage.fresco.hasSelection()&&this.scratch.addBake()},this.keyDown=t=>{if("Control"!==t.key||this.stage.coating.override){if(","===t.key||"."===t.key)switch(t.key){case",":this.size.setValue(this.size.getValue()-1);break;case".":this.size.setValue(this.size.getValue()+1)}}else this.stage.coating.setPicker()},this.keyUp=t=>{"Control"===t.key&&this.stage.coating.override&&this.stage.coating.removePicker()},this.down=t=>{this.selected&&(this.stage.coating.freeze(!0),this.mode=(0,i.Ay)("pen-mode").value,this.scratch.settings.opacity=this.opacity.getValue(),this.scratch.ctx.save(),this.scratch.ctx.lineWidth=this.size.getValue()/2,this.scratch.ctx.lineJoin=this.scratch.ctx.lineCap="round","neon"===this.mode?(this.scratch.ctx.strokeStyle="#ffffff",this.scratch.ctx.shadowColor=d.Ay.mainColor,this.scratch.ctx.shadowBlur=.1*this.amount.getValue()):(this.scratch.ctx.strokeStyle=d.Ay.mainColor,this.scratch.ctx.fillStyle=d.Ay.mainColor),this.pathPoints=[],this.pp=this.stage.translateRasterToFresco(t,null),this.pathPoints.push(this.pp),this.addMoveListeners())},this.move=t=>{t=this.stage.translateRasterToFresco(t,null),this.pathPoints.push(t);(function(t,e,s,i,a){let n,o,r,l,c;const d=a.length;if(d<2)return!1;let u=a[d-2],p=a[d-1];const g=Math.sqrt(Math.pow(u.x-p.x,2)+Math.pow(u.y-p.y,2));switch(e){case"plain":case"neon":t.beginPath(),t.moveTo(u.x,u.y),t.lineTo(p.x,p.y),t.stroke();break;case"parallel":if(n=p.x-u.x,o=p.y-u.y,n*n+o*o<500)return!1;s=Math.round(s*i*5),t.beginPath(),t.moveTo(u.x-h(0,s),u.y-h(0,s)),t.lineTo(p.x-h(0,s),p.y-h(0,s)),t.moveTo(u.x,u.y),t.lineTo(p.x,p.y),t.moveTo(u.x+h(0,s),u.y+h(0,s)),t.lineTo(p.x+h(0,s),p.y+h(0,s)),t.stroke();break;case"sketchy":if(g<.8*s)return!1;for(t.beginPath(),t.moveTo(u.x,u.y),t.lineTo(p.x,p.y),t.stroke(),t.beginPath(),t.globalAlpha=.33,l=0;l<a.length;++l)n=a[l].x-p.x,o=a[l].y-p.y,r=n*n+o*o,r<s/2*4e3&&Math.random()<i&&(t.moveTo(p.x+.3*n,p.y+.3*o),t.lineTo(a[l].x-.3*n,a[l].y-.3*o));t.stroke(),t.globalAlpha=1;break;case"shaded":for(t.beginPath(),t.moveTo(u.x,u.y),t.lineTo(p.x,p.y),t.stroke(),t.beginPath(),t.globalAlpha=.1,l=0,c=a.length-2;l<c&&!(l>50);++l)n=a[c-l].x-p.x,o=a[c-l].y-p.y,r=n*n+o*o,r<s/2*5e3*i&&(t.beginPath(),t.moveTo(p.x,p.y),t.lineTo(a[c-l].x,a[c-l].y),t.stroke());t.globalAlpha=1;break;case"furry":if(g<.8*s)return!1;for(t.beginPath(),t.moveTo(a[a.length-2].x,a[a.length-2].y),t.lineTo(a[a.length-1].x,a[a.length-1].y),t.stroke(),t.globalAlpha=.3,t.beginPath(),l=0,c=a.length;l<c;l++)n=a[l].x-a[a.length-1].x,o=a[l].y-a[a.length-1].y,r=n*n+o*o,r<s/2*2e3&&Math.random()>r/2e3&&(t.moveTo(p.x+n*i*2,p.y+o*i*2),t.lineTo(p.x-n*i*2,p.y-o*i*2));t.stroke(),t.globalAlpha=1;break;case"trail":if(g<.8*s)return!1;for(t.globalAlpha=.3,t.beginPath(),l=a.length-1,c=a.length-Math.round(25*i);l>c;--l)l>0&&(t.moveTo(p.x,p.y),t.lineTo(a[l].x,a[l].y));t.stroke(),t.globalAlpha=1;break;case"crayon":var m=Math.round(Math.sqrt(Math.pow(p.x-u.x,2)+Math.pow(p.y-u.y,2))/(5/(100*i))),v=(p.x-u.x)/m,y=(p.y-u.y)/m;for(l=0;l<m;l++)t.save(),t.globalAlpha=.4+.2*Math.random(),n=u.x+l*v,o=u.y+l*y,t.fillRect(n+(Math.random()-.5)*(s+5),o+(Math.random()-.5)*(s+5),2*Math.random()+2,Math.random()+1),t.restore();break;case"ink":t.save(),t.lineWidth=h(s,2*s),t.beginPath(),t.moveTo(u.x,u.y),t.lineTo(p.x,p.y),t.stroke(),t.restore()}return!0})(this.scratch.ctx,this.mode,this.size.getValue(),this.amount.getValue()/100,this.pathPoints)?(this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render()))):this.pathPoints.length>1&&this.pathPoints.pop()},this.up=t=>{if(this.stage.coating.freeze(!1),this.removeMoveListeners(),this.pathPoints.length>2&&"neon"===this.mode){this.scratch.clear(),this.scratch.ctx.beginPath(),this.scratch.ctx.moveTo(this.pathPoints[0].x,this.pathPoints[0].y);for(let t=1;t<this.pathPoints.length;++t)this.scratch.ctx.lineTo(this.pathPoints[t].x,this.pathPoints[t].y);this.scratch.ctx.shadowBlur=.1*this.amount.getValue(),this.scratch.ctx.stroke(),this.scratch.ctx.shadowBlur=.2*this.amount.getValue(),this.scratch.ctx.stroke(),this.scratch.ctx.shadowBlur=.3*this.amount.getValue(),this.scratch.ctx.stroke(),this.scratch.ctx.shadowBlur=.2*this.amount.getValue(),this.scratch.ctx.stroke(),this.scratch.ctx.shadowBlur=this.amount.getValue(),this.scratch.ctx.stroke(),this.scratch.applySelection(this.stage)}this.scratch.ctx.restore();let e=n.TL(this.scratch.canvas);if(e&&e.width>0&&e.height>0){let t=this.selected.rect?n.ON(this.selected.canvas,e.rebase(this.selected.rect.x,this.selected.rect.y)):void 0;const s=n.oM(this.selected.mask),i=this.selected.rect?this.selected.rect.clone():void 0;this.selected.extendCanvas(e),this.scratch.drawToLayer(this.selected,"source-over",this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"pen",layer:this.selected,patchRect:this.selected.rect?e.rebase(this.selected.rect.x,this.selected.rect.y):e,patch:t,rect:i,mask:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{var t;null===(t=this.stage.fresco)||void 0===t||t.removeScratch(),this.stage.coating.removePicker(),this.size.cleanUp(),this.amount.cleanUp(),this.opacity.cleanUp(),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.removeDownListeners(),document.removeEventListener("keyup",this.keyUp,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("layer-select",this.layerSelect,!1)},this.scratch=new u.A,document.addEventListener("keyup",this.keyUp,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("layer-select",this.layerSelect,!1),this.size=new l.A("pen-size",{compact:!0,label:(0,a.A)("size")+":",defaultValue:3,range:[1,50],step:1}),this.amount=new l.A("pen-amount",{compact:!0,label:(0,a.A)("amount")+":",defaultValue:30,range:[1,100],step:1}),this.opacity=new l.A("pen-opacity",{compact:!0,label:(0,a.A)("opacity")+":",defaultValue:1,labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100}),this.addDownListeners(),this.layerSelect()}}},55949:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(42268),a=s(75770),n=s(41915),o=s(15818),r=s(29755);class h extends a.A{constructor(t,e){super("picker",t),this.stage=t,this.target="main",this.toggleTarget=()=>{this.setTarget("main"===this.target?"alt":"main")},this.selectTarget=t=>{this.setTarget(t.currentTarget===(0,i.Ay)("picker-target-main")?"main":"alt")},this.setTarget=t=>{this.target=t,(0,i.Ay)("picker-target-main").checked="main"===this.target,(0,i.Ay)("picker-target-alt").checked="alt"===this.target},this.setPreset=t=>{let e=o.A.fromRGB(t.currentTarget.style.backgroundColor);this.callback(e,!this.isShiftDown,!0)},this.shiftDown=t=>{"Shift"!==t.key||this.isShiftDown||(this.isShiftDown=!0,this.toggleTarget())},this.shiftUp=t=>{"Shift"===t.key&&(this.isShiftDown=!1,this.toggleTarget())},this.layerSelect=()=>{this.output=this.stage.getOutputCanvas(),this.ctx=this.output.getContext("2d")},this.down=t=>{this.stage.coating.freeze(!0),t=this.stage.translateRasterToFresco(t,void 0,!1);let e=this.ctx.getImageData(t.x,t.y,1,1).data;this.callback(new o.A(e[0],e[1],e[2]),"main"===this.target),this.addMoveListeners()},this.move=t=>{t=this.stage.translateRasterToFresco(t,void 0,!1);let e=this.ctx.getImageData(t.x,t.y,1,1).data;this.callback(new o.A(e[0],e[1],e[2]),"main"===this.target,!1)},this.pickerPreviewColor=t=>{let e=new n.A(t.clientX,t.clientY);if(this.preview.style.top=e.y-50+"px",this.preview.style.left=e.x+10+"px",this.preview.style.display="block",e.x-=this.stage.canvas.offsetLeft,e.y-=this.stage.canvas.offsetTop,r.Ay.isHDPI&&(e.x*=2,e.y*=2),e.x<0||e.y<0||e.x>this.stage.canvas.width||e.y>this.stage.canvas.height)return void(this.preview.style.display="none");let s=this.stage.canvas.getContext("2d").getImageData(e.x,e.y,1,1).data;this.preview.style.backgroundColor=new o.A(s[0],s[1],s[2]).toHEX()},this.pickerPreviewLeave=()=>{this.preview.style.display="none"},this.up=t=>{this.stage.coating.freeze(!1),this.removeMoveListeners(),t=this.stage.translateRasterToFresco(t,void 0,!1);let e=this.ctx.getImageData(t.x,t.y,1,1).data;this.callback(new o.A(e[0],e[1],e[2]),"main"===this.target,!0),this.setShades()},this.setShades=()=>{let t=o.A.fromHEX("main"===this.target?r.Ay.mainColor:r.Ay.altColor);(0,i.Ay)("picker-shade-1").style.backgroundColor=new o.A(t.r-50,t.g-50,t.b-50).toHEX(),(0,i.Ay)("picker-shade-2").style.backgroundColor=new o.A(t.r-25,t.g-25,t.b-25).toHEX(),(0,i.Ay)("picker-shade-3").style.backgroundColor=t.toHEX(),(0,i.Ay)("picker-shade-4").style.backgroundColor=new o.A(t.r+25,t.g+25,t.b+25).toHEX(),(0,i.Ay)("picker-shade-5").style.backgroundColor=new o.A(t.r+50,t.g+50,t.b+50).toHEX(),(0,i.Ay)("picker-triad-1").style.backgroundColor=t.toHEX(),(0,i.Ay)("picker-triad-2").style.backgroundColor=t.rotateHue(90).toHEX(),(0,i.Ay)("picker-triad-3").style.backgroundColor=t.rotateHue(180).toHEX(),(0,i.Ay)("picker-tetra-1").style.backgroundColor=t.toHEX(),(0,i.Ay)("picker-tetra-2").style.backgroundColor=t.rotateHue(60).toHEX(),(0,i.Ay)("picker-tetra-3").style.backgroundColor=t.rotateHue(120).toHEX(),(0,i.Ay)("picker-tetra-4").style.backgroundColor=t.rotateHue(180).toHEX(),(0,i.Ay)("picker-analo-1").style.backgroundColor=t.rotateHue(-30).toHEX(),(0,i.Ay)("picker-analo-2").style.backgroundColor=t.toHEX(),(0,i.Ay)("picker-analo-3").style.backgroundColor=t.rotateHue(30).toHEX(),(0,i.Ay)("picker-comp-1").style.backgroundColor=t.toHEX(),(0,i.Ay)("picker-comp-2").style.backgroundColor=t.rotateHue(180).toHEX()},this.cleanUp=()=>{this.removeDownListeners(),this.ctx=void 0,this.output=void 0,this.preview.remove(),this.preview=void 0,(0,i.Ay)("picker").querySelectorAll(".color-pod").forEach((t=>t.removeEventListener("click",this.setPreset))),(0,i.Ay)("picker-target-main").removeEventListener("click",this.selectTarget,!1),(0,i.Ay)("picker-target-alt").removeEventListener("click",this.selectTarget,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),this.stage.raster.removeEventListener("mousemove",this.pickerPreviewColor,!0),this.stage.raster.removeEventListener("mouseleave",this.pickerPreviewLeave,!0)},this.callback=e,document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),this.stage.raster.addEventListener("mousemove",this.pickerPreviewColor,!0),this.stage.raster.addEventListener("mouseleave",this.pickerPreviewLeave,!0),(0,i.Ay)("picker-target-main").addEventListener("click",this.selectTarget,!1),(0,i.Ay)("picker-target-alt").addEventListener("click",this.selectTarget,!1),this.stage.raster.style.cursor="crosshair",(0,i.Ay)("picker").querySelectorAll(".color-pod").forEach((t=>t.addEventListener("click",this.setPreset))),this.addDownListeners(),this.layerSelect(),this.setShades(),this.preview=(0,i.T)("div",{id:"color-picker-preview",style:"display:none"}),(0,i.Ay)("workspace").appendChild(this.preview);const s=document.querySelector('input[name="picker-target"]:checked').value;this.setTarget(s)}}},75707:(t,e,s)=>{s.d(e,{A:()=>p});var i=s(42268),a=s(21742),n=s(54738),o=s(75770),r=s(82042),h=s(29755),l=s(59350),c=s(85337),d=s(15818),u=s(71499);class p extends o.A{constructor(t){super("replace",t),this.stage=t,this.isShiftDown=!1,this.keyDown=t=>{if("Shift"!==t.key)if("Control"!==t.key||this.stage.coating.override)switch(t.key){case",":t.shiftKey?this.brushPod.stepSoftness(.1):this.brushPod.stepSize(-10);break;case".":t.shiftKey?this.brushPod.stepSoftness(-.1):this.brushPod.stepSize(10)}else this.stage.coating.setPicker();else this.isShiftDown=!0},this.keyUp=t=>{"Shift"===t.key&&(this.isShiftDown=!1),"Control"===t.key&&this.stage.coating.override&&this.stage.coating.removePicker()},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.Ay)("replace-no-layer").style.display="flex",(0,i.Ay)("replace-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.Ay)("replace-no-layer").style.display="none",(0,i.Ay)("replace-settings").style.display="flex",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.cache=n.oM(this.selected.canvas),this.cachectx=this.cache.getContext("2d"),this.stage.fresco.hasSelection()&&this.scratch.addBake(),this.updateBrush()},this.updateBrush=()=>{this.brush.generate(new d.A,(0,i.Ay)("replace-hard-tip").checked),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom,new d.A(255,255,255,255))):this.stage.coating.removeCursorImage()},this.down=(t,e)=>{if(!this.selected)return;this.stage.coating.freeze(!0),this.mode=(0,i.Ay)("replace-mode").value,this.scratch.settings.opacity=this.opacity.getValue();const s=this.tolerance.getValue();this.sRGB=this.getSourcePixelAverage(this.stage.translateRasterToFresco(t,this.selected.rect)),this.sHSB=this.sRGB.toHSB(),this.shmax=this.sHSB.h+s,this.shmin=this.sHSB.h-s,this.shmax>360&&(this.shmax-=360),this.shmin<0&&(this.shmin+=360),this.tRGB=d.A.fromHEX(h.Ay.mainColor),this.tHSB=this.tRGB.toHSB(),this.isShiftDown||(this.x=this.y=-1),"touch"!==e&&this.move(t),this.addMoveListeners()},this.getSourcePixelAverage=t=>{let e=0,s=0,i=0;const a=this.cache.getContext("2d").getImageData(t.x-1,t.y-1,3,3).data;for(let n=0;n<36;n+=4)e+=a[n],s+=a[n+1],i+=a[n+2];return new d.A(Math.round(e/9),Math.round(s/9),Math.round(i/9))},this.x=-1,this.y=-1,this.move=t=>{let e=this.brush.getStep(),s=!1;if(t=this.stage.translateRasterToFresco(t,this.selected.rect),-1===this.x&&(this.lx=t.x,this.ly=t.y,this.x=t.x,this.y=t.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),t.x!==this.x||t.y!==this.y){let i=t.x-this.x,a=t.y-this.y,n=i>0?1:-1,o=a>0?1:-1;if(i=i<0?-i:i,a=a<0?-a:a,i>a){let t=.5*i;for(let r=1;r<=i;r++)this.x+=n,t+=a,t>=i&&(t-=i,this.y+=o),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,s=!0)}else{let t=.5*a;for(let r=1;r<=a;r++)this.y+=o,t+=i,t>=a&&(t-=a,this.x+=n),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,s=!0)}}s&&(this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render())))},this.drawShape=(t,e)=>{const s=this.brush.canvas.width,i=this.brush.canvas.height;let a=this.getPatchContext(s,i);a.save(),a.drawImage(this.selected.canvas,-t,-e);const n=a.getImageData(0,0,s,i),o=this.cachectx.getImageData(t,e,s,i);switch(this.mode){case"auto":this.changeAuto(n.data,o.data,s,i);break;case"hue":this.changeHue(n.data,s,i);break;case"sat":this.changeSat(n.data,s,i);break;case"bri":this.changeBri(n.data,s,i);break;case"fill":this.changeFill(n.data,s,i)}a.putImageData(n,0,0),a.globalCompositeOperation="destination-in",a.drawImage(this.brush.canvas,0,0),a.restore(),this.scratch.ctx.drawImage(this.patch,t,e)},this.changeAuto=(t,e,s,i)=>{let a,n,o,r,h,l,c,d,u,p,g,m,v,y,f,w,x=i;const b=this.tHSB.b/this.sHSB.b,A=this.tHSB.s/this.sHSB.s;for(;x--;)for(a=s;a--;)if(w=4*(x*s+a),o=e[w],r=e[w+1],h=e[w+2],u=Math.min(o,r,h),p=Math.max(o,r,h),d=p/255,g=p-u,l=c=0,g&&(c=g/p,l=o==p?(r-h)/g*60:r==p?60*(2+(h-o)/g):60*(4+(o-r)/g),l>360?l-=360:l<0&&(l+=360)),c<.05||d<.05||l<this.shmax&&l>this.shmin||this.shmax<this.shmin&&(l>this.shmin||l<this.shmax)){if(l=this.tHSB.h,d*=b,c*=A,d<0?d=0:d>1&&(d=1),0===d)o=0,r=0,h=0;else if(0===c)o=r=h=d;else switch(m=l/60,n=m-~~m,y=d*(1-c),f=d*(1-c*n),v=d*(1-c*(1-n)),~~m){case 0:case 6:o=d,r=v,h=y;break;case 1:o=f,r=d,h=y;break;case 2:o=y,r=d,h=v;break;case 3:o=y,r=f,h=d;break;case 4:o=v,r=y,h=d;break;case 5:o=d,r=y,h=f}o*=255,r*=255,h*=255,t[w]=o,t[w+1]=r,t[w+2]=h}},this.changeHue=(t,e,s)=>{let i,a,n,o,r,h,l,c,d,u,p,g,m,v,y,f,w=s;for(;w--;)for(i=e;i--;)if(f=4*(w*e+i),n=t[f],o=t[f+1],r=t[f+2],d=Math.min(n,o,r),u=Math.max(n,o,r),c=u/255,p=u-d,h=l=0,p&&(l=p/u,h=n==u?(o-r)/p*60:o==u?60*(2+(r-n)/p):60*(4+(n-o)/p),h>360?h-=360:h<0&&(h+=360)),l>.2&&h<this.shmax&&h>this.shmin||this.shmax<this.shmin&&(h>this.shmin||h<this.shmax)){if(h=this.tHSB.h,c<0?c=0:c>1&&(c=1),0==c)n=0,o=0,r=0;else if(0==l)n=o=r=c;else switch(g=h/60,a=g-~~g,v=c*(1-l),y=c*(1-l*a),m=c*(1-l*(1-a)),~~g){case 0:case 6:n=c,o=m,r=v;break;case 1:n=y,o=c,r=v;break;case 2:n=v,o=c,r=m;break;case 3:n=v,o=y,r=c;break;case 4:n=m,o=v,r=c;break;case 5:n=c,o=v,r=y}n*=255,o*=255,r*=255,t[f]=n,t[f+1]=o,t[f+2]=r}},this.changeSat=(t,e,s)=>{let i,a,n,o,r,h,l,c,d,u,p,g,m,v,y,f,w=s;const x=this.tHSB.s/this.sHSB.s;for(;w--;)for(i=e;i--;)if(f=4*(w*e+i),n=t[f],o=t[f+1],r=t[f+2],d=Math.min(n,o,r),u=Math.max(n,o,r),c=u/255,p=u-d,h=l=0,p&&(l=p/u,h=n==u?(o-r)/p*60:o==u?60*(2+(r-n)/p):60*(4+(n-o)/p),h>360?h-=360:h<0&&(h+=360)),h<this.shmax&&h>this.shmin||this.shmax<this.shmin&&(h>this.shmin||h<this.shmax)){if(l*=x,c<0?c=0:c>1&&(c=1),0==c)n=0,o=0,r=0;else if(0==l)n=o=r=c;else switch(g=h/60,a=g-~~g,v=c*(1-l),y=c*(1-l*a),m=c*(1-l*(1-a)),~~g){case 0:case 6:n=c,o=m,r=v;break;case 1:n=y,o=c,r=v;break;case 2:n=v,o=c,r=m;break;case 3:n=v,o=y,r=c;break;case 4:n=m,o=v,r=c;break;case 5:n=c,o=v,r=y}n*=255,o*=255,r*=255,t[f]=n,t[f+1]=o,t[f+2]=r}},this.changeBri=(t,e,s)=>{let i,a,n,o,r,h,l,c,d,u,p,g,m,v,y,f=s;const w=this.tHSB.b/this.sHSB.b;for(;f--;)for(i=e;i--;){y=4*(f*e+i),n=t[y],o=t[y+1],r=t[y+2],d=Math.min(n,o,r),u=Math.max(n,o,r),c=u/255;var x=u-d;if(h=l=0,x&&(l=x/u,h=n==u?(o-r)/x*60:o==u?60*(2+(r-n)/x):60*(4+(n-o)/x),h>360?h-=360:h<0&&(h+=360)),h<this.shmax&&h>this.shmin||this.shmax<this.shmin&&(h>this.shmin||h<this.shmax)){if(c*=w,c<0?c=0:c>1&&(c=1),0==c)n=0,o=0,r=0;else if(0==l)n=o=r=c;else switch(p=h/60,a=p-~~p,m=c*(1-l),v=c*(1-l*a),g=c*(1-l*(1-a)),~~p){case 0:case 6:n=c,o=g,r=m;break;case 1:n=v,o=c,r=m;break;case 2:n=m,o=c,r=g;break;case 3:n=m,o=v,r=c;break;case 4:n=g,o=m,r=c;break;case 5:n=c,o=m,r=v}n*=255,o*=255,r*=255,t[y]=n,t[y+1]=o,t[y+2]=r}}},this.changeFill=(t,e,s)=>{let i,a,n,o,r,h,l,c,d,u,p=s;for(;p--;)for(i=e;i--;){u=4*(p*e+i),a=t[u],n=t[u+1],o=t[u+2],c=Math.min(a,n,o),d=Math.max(a,n,o),l=d/255;var g=d-c;r=h=0,g&&(h=g/d,r=a==d?(n-o)/g*60:n==d?60*(2+(o-a)/g):60*(4+(a-n)/g),r>360?r-=360:r<0&&(r+=360)),(h>.2&&l>.1&&r<this.shmax&&r>this.shmin||this.shmax<this.shmin&&(r>this.shmin||r<this.shmax))&&(t[u]=this.tRGB.r,t[u+1]=this.tRGB.g,t[u+2]=this.tRGB.b)}},this.getPatchContext=(t,e)=>this.patch?(this.patch.width!==t||this.patch.height!==e?(this.patch.width=t,this.patch.height=e):this.ptx.clearRect(0,0,t,e),this.ptx):(this.patch=n.VI(t,e),this.ptx=this.patch.getContext("2d"),this.ptx),this.up=t=>{this.stage.coating.freeze(!1),this.removeMoveListeners();let e=n.TL(this.scratch.getCanvas());if(e&&e.width>0&&e.height>0){let t=n.ON(this.selected.canvas,e);const s=this.selected.rect.clone();this.scratch.drawToLayer(this.selected,"source-over",this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"replace",layer:this.selected,patchRect:e,patch:t,rect:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{var t;null===(t=this.stage.fresco)||void 0===t||t.removeScratch(),this.brushPod.cleanUp(),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.removeDownListeners(),(0,i.Ay)("replace-hard-tip").addEventListener("click",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1)},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),(0,i.Ay)("replace-hard-tip").addEventListener("click",this.updateBrush,!1),this.brush=new l.A(new u.A),this.brushPod=new c.A(t,"replace-brush",this.brush,this.updateBrush),this.tolerance=new r.A("replace-tolerance",{compact:!0,label:(0,a.A)("tolerance")+":",defaultValue:36,range:[0,150],step:1}),this.opacity=new r.A("replace-opacity",{compact:!0,label:(0,a.A)("opacity")+":",defaultValue:1,range:[0,1],labelFormat:t=>(100*t).toFixed(0)+"%",labelParse:t=>parseInt(t,10)/100}),this.addDownListeners(),this.layerSelect()}}},61161:(t,e,s)=>{s.d(e,{A:()=>k});var i=s(42268),a=s(21742),n=s(54738),o=s(40963),r=s(7324),h=s(75770),l=s(15818),c=s(82042),d=s(22866),u=s(29755),p=s(66495),g=s(26651),m=s(66827),v=s(8689),y=s(86755),f=s(86445),w=s(14983),x=s(81937),b=s(37771);class A extends b.A{constructor(t,e){super(e,(0,a.A)("styles"),!0),this.updateInputs=()=>{var t,e;(0,i.Ay)("shape-outline-settings").style.display="line"===this.selected.shapeSettings.variant?"none":"block",(0,i.Ay)("shape-outline").checked=this.selected.shapeSettings.outlineSize>0,this.outlineColor.setColor(null!==(t=this.selected.shapeSettings.outlineColor)&&void 0!==t?t:"#555555"),this.outlineSize.setValue(this.selected.shapeSettings.outlineSize),(0,i.Ay)("shape-shadow").checked=this.selected.shapeSettings.shadow,this.shadowColor.setColor(null!==(e=this.selected.shapeSettings.shadowColor)&&void 0!==e?e:"#000000"),this.shadowBlur.setValue(this.selected.shapeSettings.shadowBlur),this.shadowOpacity.setValue(this.selected.shapeSettings.shadowOpacity),this.shadowDistance.setValue(this.selected.shapeSettings.shadowDistance),this.shadowDirection.setValue(this.selected.shapeSettings.shadowDirection)},this.changeOutlineState=()=>{const t=this.selected.shapeSettings.clone();this.changeOutline(),this.stage.history.add({type:"shapeSettings",kind:"outline",layer:this.selected,settings:t})},this.changeOutline=()=>{let t=(0,i.Ay)("shape-outline").checked,e=this.outlineColor.getColor().toHEX(),s=this.outlineSize.getValue();this.selected.setOutline(t?s:0,e),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeOutlineColor=t=>{const e=this.selected.shapeSettings.clone();this.changeOutline(),this.stage.history.add({type:"shapeSettings",kind:"outline",layer:this.selected,settings:e})},this.changeShadowState=()=>{const t=this.selected.shapeSettings.clone();this.changeShadow(),this.stage.history.add({type:"shapeSettings",kind:"shadow",layer:this.selected,settings:t})},this.changeShadow=()=>{this.selected.setShadow((0,i.Ay)("shape-shadow").checked,this.shadowBlur.getValue(),this.shadowOpacity.getValue(),this.shadowColor.getColor().toHEX(),this.shadowDistance.getValue(),this.shadowDirection.getValue()),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeShadowColor=t=>{const e=this.selected.shapeSettings.clone();this.changeShadow(),this.stage.history.add({type:"shapeSettings",kind:"shadow",layer:this.selected,settings:e})},this.cleanUp=()=>{this.selected=void 0,this.outlineColor.cleanUp(),this.outlineColor=void 0,this.shadowColor.cleanUp(),this.shadowColor=void 0,this.outlineSize.cleanUp(),this.shadowBlur.cleanUp(),this.shadowOpacity.cleanUp(),this.shadowDistance.cleanUp(),this.shadowDirection.cleanUp(),(0,i.Ay)("shape-outline").removeEventListener("change",this.changeOutlineState,!1),(0,i.Ay)("shape-shadow").removeEventListener("change",this.changeShadowState,!1),this.superCleanUp()},this.stage=t,this.selected=this.stage.fresco.getSelected(),this.content.id="shape-style-content",this.content.style.height="400px",this.setContent(`\n            <section>\n                <div id="shape-outline-settings">\n                    <input type="checkbox" class="toggle-check" id="shape-outline" />\n                    <label class="switch subline top-4" for="shape-outline">${(0,a.A)("outline")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <label class="split">${(0,a.A)("color")}<div id="shape-outline-color"></div></label>\n                        <div id="shape-outline-size" class="top-10"></div>\n                    </div>\n                </div>\n                <div>\n                    <input type="checkbox" class="toggle-check" id="shape-shadow" />\n                    <label class="switch subline top-10" for="shape-shadow">${(0,a.A)("shadow")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <label class="split">${(0,a.A)("color")}<div id="shape-shadow-color"></div></label>\n                        <div id="shape-shadow-blur" class="top-10"></div>\n                        <div id="shape-shadow-distance"></div>\n                        <div id="shape-shadow-direction"></div>\n                        <div id="shape-shadow-opacity"></div>\n                    </div>\n                </div>\n            </section>\n        `),this.outlineColor=new v.A("shape-outline-color",l.A.fromHEX(u.Ay.altColor),this.changeOutlineColor),this.shadowColor=new v.A("shape-shadow-color",l.A.fromHEX(u.Ay.altColor),this.changeShadowColor);let s=this.selected.shapeSettings;const n={onStart:()=>{s=this.selected.shapeSettings.clone()},labelFormat:t=>(100*t).toFixed(0),labelParse:t=>parseInt(t,100)/100};this.outlineSize=new c.A("shape-outline-size",{label:(0,a.A)("size"),defaultValue:4,range:[1,100],step:1,onChange:()=>this.changeOutline(),onEnd:()=>{this.stage.history.add({type:"shapeSettings",kind:"outline",layer:this.selected,settings:s})}});const o=Object.assign(Object.assign({},n),{range:[0,1],onChange:()=>this.changeShadow(),onEnd:()=>{this.stage.history.add({type:"shapeSettings",kind:"shadow",layer:this.selected,settings:s})}});this.shadowBlur=new c.A("shape-shadow-blur",Object.assign(Object.assign({},o),{label:(0,a.A)("blur")})),this.shadowOpacity=new c.A("shape-shadow-opacity",Object.assign(Object.assign({},o),{label:(0,a.A)("opacity"),defaultValue:1})),this.shadowDistance=new c.A("shape-shadow-distance",Object.assign(Object.assign({},o),{label:(0,a.A)("distance"),range:[0,1]})),this.shadowDirection=new c.A("shape-shadow-direction",Object.assign(Object.assign({},o),{label:(0,a.A)("direction"),range:[0,360],defaultValue:180,labelFormat:t=>t.toFixed(1),labelParse:t=>parseInt(t,10)})),(0,i.Ay)("shape-outline").addEventListener("change",this.changeOutlineState,!1),(0,i.Ay)("shape-shadow").addEventListener("change",this.changeShadowState,!1),this.updateInputs(),new x.A(this.content)}}class k extends h.A{constructor(t){super("shape",t),this.stage=t,this.isShiftDown=!1,this.showShapeStyles=()=>{new A(this.stage,(0,i.Ay)("shape-styles"))},this.keyDown=t=>{if("Shift"!==t.key||this.isShiftDown||(this.isShiftDown=!0,this.reform&&(this.reform.constrain=!1)),"Control"!==t.key||this.stage.coating.override||"draw"!==this.mode){if(","===t.key||"."===t.key)switch(t.key){case",":"draw"===this.mode?this.drawStroke.setValue(this.drawStroke.getValue()-1):this.lineSize.setValue(this.lineSize.getValue()-1,!0);break;case".":"draw"===this.mode?this.drawStroke.setValue(this.drawStroke.getValue()+1):this.lineSize.setValue(this.lineSize.getValue()+1,!0)}}else this.stage.coating.setPicker()},this.keyUp=t=>{"Shift"===t.key&&this.isShiftDown&&(this.isShiftDown=!1,this.reform&&(this.reform.constrain=!0)),"Control"===t.key&&this.stage.coating.override&&this.stage.coating.removePicker()},this.setMode=()=>{this.mode=document.querySelector('input[name="shape-mode"]:checked').value,"draw"===this.mode?this.setDrawType():this.setType(),this.layerSelect()},this.setDrawType=()=>{this.stage.coating.wake(),"bezier"===this.variant&&(this.stage.coating.freeze(!1),this.removeMoveListeners(),window.requestAnimationFrame((()=>this.stage.render()))),this.variant=document.querySelector('input[name="shape-draw-type"]:checked').value,(0,i.Ay)("shape-draw-fill-settings").style.display="line"===this.variant||"bezier"===this.variant?"none":"flex",(0,i.Ay)("shape-draw-radii").style.display="rounded"===this.variant?"block":"none"},this.setType=()=>{this.stage.coating.sleep(),this.removeMoveListeners(),this.variant=document.querySelector('input[name="shape-type"]:checked').value,(0,i.Ay)("shape-path").style.display="path"===this.variant?"flex":"none",(0,i.Ay)("shape-fill-settings").style.display="line"===this.variant?"none":"flex",(0,i.Ay)("shape-line-settings").style.display="line"!==this.variant?"none":"flex",(0,i.Ay)("shape-outline-radii").style.display="rounded"===this.variant?"block":"none"},this.selectType=()=>{if(this.selected instanceof f.A){this.variant=document.querySelector('input[name="shape-type"]:checked').value;const t=this.selected.shapeSettings.clone();"path"===this.variant?this.selected.setPath(this.shape.getPath()):this.selected.setVariant(this.variant),this.stage.history.add({type:"shapeSettings",kind:"type",layer:this.selected,settings:t}),window.requestAnimationFrame((()=>this.stage.render()))}this.setType()},this.previewShape=t=>{this.selected instanceof f.A&&(this.selected.setPath(t,!0),window.requestAnimationFrame((()=>this.stage.render())))},this.selectShape=t=>{if(this.selected instanceof f.A){const e=this.selected.shapeSettings.clone();this.selected.setPath(t),this.stage.history.add({type:"shapeSettings",kind:"shape",layer:this.selected,settings:e}),window.requestAnimationFrame((()=>this.stage.render()))}},this.previewFill=t=>{this.selected instanceof f.A&&(this.selected.setFill(t,!0),window.requestAnimationFrame((()=>this.stage.render())))},this.selectFill=t=>{if(this.selected instanceof f.A){const e=this.selected.shapeSettings.clone();this.selected.setFill(t),this.stage.history.add({type:"shapeSettings",kind:"fill",layer:this.selected,settings:e}),window.requestAnimationFrame((()=>this.stage.render()))}},this.selectLine=()=>{if(this.selected instanceof f.A){const t=this.selected.shapeSettings.clone();this.selected.setOutline(this.lineSize.getValue(),this.lineColor.getColor().toHEX()),this.stage.history.add({type:"shapeSettings",kind:"outline",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))}},this.previewLineColor=t=>{this.selected instanceof f.A&&(this.selected.setOutline(this.lineSize.getValue(),this.lineColor.getColor().toHEX()),document.dispatchEvent(new CustomEvent("viewport-render")))},this.selectOutlineRadii=()=>{if(this.selected instanceof f.A){const t=this.selected.shapeSettings.clone();this.selected.setRadii(this.outlineRadii.getValue()),this.stage.history.add({type:"shapeSettings",kind:"radii",layer:this.selected,settings:t}),window.requestAnimationFrame((()=>this.stage.render()))}},this.layerSelect=()=>{if((0,i.Ay)("shape-settings").style.display="none",(0,i.Ay)("shape-draw-settings").style.display="none",(0,i.Ay)("shape-draw-no-layer").style.display="none","draw"===this.mode){if(this.stage.history.commitTransaction(),this.reform&&this.reform.cleanUp(),this.reform=void 0,!this.stage.fresco.isSelectedType(d.A.TYPE_IMAGE))return(0,i.Ay)("shape-draw-no-layer").style.display="flex",this.stage.raster.style.cursor="auto",void(this.selected=void 0);(0,i.Ay)("shape-draw-settings").style.display="flex",this.stage.raster.style.cursor="crosshair",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new o.A(0,0,this.stage.fresco.width,this.stage.fresco.height),"over")}else{if(this.selected!==this.stage.fresco.getSelected()&&this.stage.history.commitTransaction(),(0,i.Ay)("shape-settings").style.display="flex",(0,i.Ay)("shape-action").style.display="none",(0,i.Ay)("shape-styles-settings").style.display="none",this.reform||(this.reform=new g.A(this.stage,"SHAPE"),this.reform.proxy=this.downReform),this.stage.fresco.isSelectedType(d.A.TYPE_SHAPE))if(this.selected=this.stage.fresco.getSelected(),"svg"===this.selected.shapeSettings.variant)this.selected=void 0;else{let t=this.selected.shapeSettings;(0,i.Ay)("shape-type-"+t.variant).checked=!0,this.setType(),this.outlineRadii.setValue(t.radii),this.lineSize.setValue(t.outlineSize),this.lineColor.setColor(t.outlineColor),this.fill.setFill(this.selected.fill),"path"===t.variant&&this.shape.setPath(t.content),(0,i.Ay)("shape-action").style.display="flex",(0,i.Ay)("shape-styles-settings").style.display="flex"}else this.selected=void 0;document.querySelectorAll('input[name="shape-type"]').forEach((t=>{let e=!0;this.selected instanceof f.A&&("line"===this.selected.shapeSettings.variant&&"line"!==t.value||"line"!==this.selected.shapeSettings.variant&&"line"===t.value)&&(e=!1),(0,i.Ay)(t.id+"-label").style.display=e?"block":"none"}))}},this.down=t=>{this.reform||this.downDraw(t)},this.move=t=>{"draw"===this.mode?this.moveDraw(t):this.moveDesign(t)},this.up=t=>{"draw"===this.mode?this.upDraw(t):this.upDesign(t)},this.downReform=(t,e)=>{this.downPoint=t,"line"===this.variant&&0===this.lineSize.getValue()||("line"===this.variant||this.fill.getFill()&&this.fill.getFill().value)&&("path"===this.variant&&(this.path2D=new Path2D(this.shape.getPath())),this.addMoveListeners())},this.moveDesign=t=>{if(this.isShiftDown){const e=this.downPoint.x-t.x,s=this.downPoint.y-t.y;if("line"===this.variant)Math.abs(e)<Math.abs(s)?t.x=this.downPoint.x:t.y=this.downPoint.y;else{let i=Math.sqrt(e*e+s*s)/Math.sqrt(2);t.x=this.downPoint.x+(e>0?-i:i),t.y=this.downPoint.y+(s>0?-i:i)}}const e=this.stage.coating.ctx;switch(e.lineWidth="line"===this.variant?Math.max(Math.round(this.lineSize.getValue()*this.stage.zoom),1):2,e.strokeStyle=n.bi,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.save(),this.variant){case"path":const s=this.stage.translateToRect(this.downPoint,t,this.isShiftDown,!0);if(s.width>0&&s.height>0){const t=new Path2D;t.addPath(this.path2D,(new DOMMatrix).scale(s.width/100,s.height/100)),e.translate(s.x,s.y),e.stroke(t)}break;case"rounded":const i=o.A.fromPoints([this.downPoint,t]);p.A.roundRect(e,i.x,i.y,i.width,i.height,Math.max(Math.round(this.outlineRadii.getValue()*this.stage.zoom),1)),e.stroke();break;case"rectangle":e.strokeRect(this.downPoint.x,this.downPoint.y,t.x-this.downPoint.x,t.y-this.downPoint.y);break;case"ellipse":p.A.ellipse(e,this.downPoint,t),e.stroke();break;case"line":p.A.line(e,this.downPoint,t),e.stroke()}e.restore()},this.upDesign=t=>{const e=this.stage.coating.ctx;if(e.clearRect(0,0,e.canvas.width,e.canvas.height),this.removeMoveListeners(),this.downPoint.distanceTo(t)<6)return;let s=this.stage.translateToRect(this.downPoint,t,"line"!==this.variant&&this.isShiftDown,!1),i=new w.A;switch(this.variant){case"path":i.variant="path",i.content=this.shape.getPath();break;case"rounded":i.variant="rounded",i.radii=this.outlineRadii.getValue();break;case"rectangle":i.variant="rectangle";break;case"ellipse":i.variant="ellipse";break;case"line":if(i.variant="line",this.isShiftDown){const e=this.downPoint.x-t.x,s=this.downPoint.y-t.y;if("line"===this.variant)Math.abs(e)<Math.abs(s)?t.x=this.downPoint.x:t.y=this.downPoint.y;else{let i=Math.sqrt(e*e+s*s)/Math.sqrt(2);t.x=this.downPoint.x+(e>0?-i:i),t.y=this.downPoint.y+(s>0?-i:i)}}let e=s.center(),a=s.bottomRight().distanceTo(s.topLeft());s.x=Math.round(e.x-a/2),s.y=e.y-Math.ceil(this.lineSize.getValue()/2),s.width=Math.round(a),s.height=this.lineSize.getValue(),s.rotation=this.stage.translateRasterToFresco(this.downPoint).angleTo(this.stage.translateRasterToFresco(t)),i.outlineSize=this.lineSize.getValue(),i.outlineColor=this.lineColor.getColor().toHEX()}let a=this.fill.getFill();a&&a.value&&(i.fillType=this.fill.getFill().getType(),i.fillValue=this.fill.getFill().getStringValue()),this.stage.addShape(s,i)},this.downDraw=t=>{if(!this.selected)return;if((0,i.Ay)("shape-draw-fill").checked||0!==this.drawStroke.getValue()){if("bezier"===this.variant&&this.upPoint)return this.stage.coating.freeze(!1),this.addDrawHistory(),this.downPoint=this.upPoint=void 0,void this.removeMoveListeners();this.scratch.ctx.fillStyle=u.Ay.altColor,this.scratch.ctx.strokeStyle=u.Ay.mainColor,this.scratch.ctx.lineWidth=this.drawStroke.getValue(),this.scratch.settings.opacity=this.drawOpacity.getValue(),this.downPoint=this.stage.translateRasterToFresco(t),this.stage.coating.freeze(!0),this.addMoveListeners()}},this.moveDraw=t=>{this.scratch.clear(),t=this.stage.translateRasterToFresco(t),this.scratch.ctx.save();const e=(0,i.Ay)("shape-draw-fill").checked;if(this.isShiftDown){const e=this.downPoint.x-t.x,s=this.downPoint.y-t.y;if("line"===this.variant||"bezier"===this.variant)Math.abs(e)<Math.abs(s)?t.x=this.downPoint.x:t.y=this.downPoint.y;else{let i=Math.sqrt(e*e+s*s)/Math.sqrt(2);t.x=this.downPoint.x+(e>0?-i:i),t.y=this.downPoint.y+(s>0?-i:i)}}this.isDown||"bezier"!==this.variant?("bezier"===this.variant?(p.A.line(this.scratch.ctx,this.downPoint,t),this.scratch.ctx.stroke()):(e||"line"===this.variant)&&p.A.fill(this.scratch.ctx,this.variant,this.downPoint,t,this.drawRadii.getValue()),this.drawStroke.getValue()>0&&"line"!==this.variant&&"bezier"!==this.variant&&p.A.stroke(this.scratch.ctx,this.variant,this.downPoint,t,this.drawRadii.getValue())):(p.A.bezier(this.scratch.ctx,this.downPoint,this.upPoint,t),this.scratch.ctx.stroke()),this.scratch.ctx.restore(),this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render()))},this.upDraw=t=>{this.upPoint=this.stage.translateRasterToFresco(t);const e=this.downPoint.x===this.upPoint.x&&this.downPoint.y===this.upPoint.y;!e&&"bezier"===this.variant&&this.upPoint||(this.upPoint=void 0,this.stage.coating.freeze(!1),this.removeMoveListeners(),e||(this.move(t),this.addDrawHistory()))},this.addDrawHistory=()=>{let t=n.TL(this.scratch.getCanvas());if(t&&t.width>0&&t.height>0){let e=this.selected.rect?n.ON(this.selected.canvas,t.rebase(this.selected.rect.x,this.selected.rect.y)):void 0;const s=n.oM(this.selected.mask),i=this.selected.rect?this.selected.rect.clone():void 0;this.selected.extendCanvas(t),this.scratch.drawToLayer(this.selected,void 0,this.drawOpacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"shape",layer:this.selected,patchRect:this.selected.rect?t.rebase(this.selected.rect.x,this.selected.rect.y):t,patch:e,rect:i,mask:s})}},this.deleteLayer=()=>this.stage.deleteLayer(),this.duplicateLayer=()=>this.stage.duplicateLayer(),this.cleanUp=()=>{var t;this.stage.history.commitTransaction(),this.reform&&(this.reform.cleanUp(),this.reform=void 0),null===(t=this.stage.fresco)||void 0===t||t.removeScratch(),this.stage.coating.removePicker(),this.stage.coating.wake(),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.removeDownListeners(),window.requestAnimationFrame((()=>this.stage.render())),this.drawRadii.cleanUp(),this.drawStroke.cleanUp(),this.drawOpacity.cleanUp(),this.fill.cleanUp(),this.shape.cleanUp(),this.lineColor.cleanUp(),this.lineSize.cleanUp(),this.outlineRadii.cleanUp(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keyup",this.keyUp,!1),document.removeEventListener("keydown",this.keyDown,!1),document.querySelectorAll('input[name="shape-draw-type"]').forEach((t=>t.removeEventListener("change",this.setDrawType))),document.querySelectorAll('input[name="shape-type"]').forEach((t=>t.removeEventListener("change",this.selectType))),(0,i.Ay)("shape-delete").removeEventListener("click",this.deleteLayer,!0),(0,i.Ay)("shape-duplicate").removeEventListener("click",this.duplicateLayer,!0),(0,i.Ay)("shape-mode-draw").removeEventListener("change",this.setMode),(0,i.Ay)("shape-mode-design").removeEventListener("change",this.setMode),(0,i.Ay)("shape-styles").removeEventListener("click",this.showShapeStyles,!1)},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),(0,i.Ay)("shape-mode-draw").addEventListener("change",this.setMode),(0,i.Ay)("shape-mode-design").addEventListener("change",this.setMode),(0,i.Ay)("shape-styles").addEventListener("click",this.showShapeStyles,!1),this.drawStroke=new c.A("shape-draw-size",{compact:!0,label:(0,a.A)("outline")+":",defaultValue:5,range:[0,50],step:1}),this.drawRadii=new c.A("shape-draw-radii",{compact:!0,label:(0,a.A)("radius")+":",defaultValue:5,range:[0,100],step:1}),this.drawOpacity=new c.A("shape-draw-opacity",{compact:!0,label:(0,a.A)("opacity")+":",defaultValue:1,labelFormat:t=>(100*t).toFixed(0)+"%"}),document.querySelectorAll('input[name="shape-draw-type"]').forEach((t=>t.addEventListener("change",this.setDrawType))),document.querySelectorAll('input[name="shape-type"]').forEach((t=>t.addEventListener("change",this.selectType))),this.shape=new y.A("shape-shape",this.selectShape,this.previewShape),this.fill=new m.A("shape-fill",new r.A(l.A.fromHEX(u.Ay.mainColor)),this.selectFill,this.previewFill),this.lineColor=new v.A("shape-line-color",l.A.fromHEX(u.Ay.altColor),this.selectLine,this.previewLineColor),this.lineSize=new c.A("shape-line-size",{compact:!0,label:(0,a.A)("size")+":",defaultValue:4,range:[1,100],step:1,onEnd:this.selectLine}),this.outlineRadii=new c.A("shape-outline-radii",{compact:!0,label:(0,a.A)("radius")+":",defaultValue:5,range:[0,100],step:1,onEnd:this.selectOutlineRadii}),(0,i.Ay)("shape-delete").addEventListener("click",this.deleteLayer,!0),(0,i.Ay)("shape-duplicate").addEventListener("click",this.duplicateLayer,!0),this.addDownListeners(),this.setMode()}}},53226:(t,e,s)=>{s.d(e,{A:()=>d});var i=s(42268),a=s(54738),n=s(75770),o=s(82042),r=s(59350),h=s(71499),l=s(85337),c=s(21742);class d extends n.A{constructor(t){super("temper",t),this.mode="increase",this.method="vibrance",this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.Ay)("temper-no-layer").style.display="flex",(0,i.Ay)("temper-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.Ay)("temper-settings").style.display="flex",(0,i.Ay)("temper-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.stage.fresco.hasSelection()&&this.scratch.addBake(),this.updateBrush()},this.toggleMode=()=>{this.setMode("increase"===this.mode?"decrease":"increase")},this.selectMode=t=>{this.setMode(t.currentTarget===(0,i.Ay)("temper-mode-increase")?"increase":"decrease")},this.setMode=t=>{this.mode=t,(0,i.Ay)("temper-mode-increase").checked="increase"===this.mode,(0,i.Ay)("temper-mode-decrease").checked="decrease"===this.mode},this.isShiftDown=!1,this.keyDown=t=>{if("Shift"===t.key&&!this.isShiftDown)return this.isShiftDown=!0,void this.toggleMode();switch(t.key){case",":t.shiftKey?this.brushPod.stepSoftness(.1):this.brushPod.stepSize(-10);break;case".":t.shiftKey?this.brushPod.stepSoftness(-.1):this.brushPod.stepSize(10)}},this.keyUp=t=>{"Shift"===t.key&&(this.isShiftDown=!1,this.toggleMode())},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage()},this.down=(t,e)=>{this.selected&&(this.stage.coating.freeze(!0),this.method=document.querySelector('input[name="temper-method"]:checked').value,this.isShiftDown||(this.x=this.y=-1),"touch"!==e&&this.move(t),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=t=>{let e=2*this.brush.getStep(),s=!1;if(t=this.stage.translateRasterToFresco(t,this.selected.rect),-1===this.x&&(this.lx=t.x,this.ly=t.y,this.x=t.x,this.y=t.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),t.x!==this.x||t.y!==this.y){let i=t.x-this.x,a=t.y-this.y,n=i>0?1:-1,o=a>0?1:-1;if(i=i<0?-i:i,a=a<0?-a:a,i>a){let t=.5*i;for(let r=1;r<=i;r++)this.x+=n,t+=a,t>=i&&(t-=i,this.y+=o),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let t=.5*a;for(let r=1;r<=a;r++)this.y+=o,t+=i,t>=a&&(t-=a,this.x+=n),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&(this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render())))},this.drawShape=(t,e)=>{let s=this.strength.getValue();"decrease"===this.mode&&(s*=-1);let i=this.getPatchContext(this.brush.canvas.width,this.brush.canvas.height);switch(i.save(),i.drawImage(this.selected.canvas,-t,-e),this.method){case"vibrance":this.vibrance(i,s);break;case"saturation":this.saturation(i,s);break;case"temperature":this.temperature(i,s)}i.globalCompositeOperation="destination-in",i.drawImage(this.brush.canvas,0,0),i.restore(),this.scratch.ctx.drawImage(this.patch,t,e)},this.getPatchContext=(t,e)=>this.patch?(this.patch.width!==t||this.patch.height!==e?(this.patch.width=t,this.patch.height=e):this.ptx.clearRect(0,0,t,e),this.ptx):(this.patch=a.VI(t,e),this.ptx=this.patch.getContext("2d"),this.ptx),this.up=t=>{this.stage.coating.freeze(!1),this.removeMoveListeners();let e=a.TL(this.scratch.getCanvas());if(e&&e.width>0&&e.height>0){let t=a.ON(this.selected.canvas,e);const s=this.selected.rect.clone();this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"temper",layer:this.selected,patchRect:e,patch:t,rect:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.saturation=(t,e)=>{var s=t.canvas.width,i=t.canvas.height;e+=100,e/=100;for(var a,n,o,r,h,l,c=t.getImageData(0,0,s,i),d=c.data,u=i;u--;)for(a=s;a--;)n=d[h=4*(u*s+a)],o=d[h+1],r=d[h+2],(n=(l=Math.sqrt(n*n*.299+o*o*.587+r*r*.114))+(n-l)*e)>255?n=255:n<0&&(n=0),(o=l+(o-l)*e)>255?o=255:o<0&&(o=0),(r=l+(r-l)*e)>255?r=255:r<0&&(r=0),d[h]=n,d[h+1]=o,d[h+2]=r;t.putImageData(c,0,0)},this.vibrance=(t,e)=>{var s=t.canvas.width,i=t.canvas.height;e*=-.02;for(var n,o,r,h,l,c,d,u,p=t.getImageData(0,0,s,i),g=p.data,m=i;m--;)for(n=s;n--;)c=.299*(o=g[l=4*(m*s+n)])+.587*(r=g[l+1])+.114*(h=g[l+2]),d=Math.max(o,r,h),Math.min(o,r,h),u=(d-c)*e/255,(o=a.jh(o,d,u))>255?o=255:o<0&&(o=0),(r=a.jh(r,d,u))>255?r=255:r<0&&(r=0),(h=a.jh(h,d,u))>255?h=255:h<0&&(h=0),g[l]=o,g[l+1]=r,g[l+2]=h;t.putImageData(p,0,0)},this.temperature=(t,e)=>{var s=t.canvas.width,i=t.canvas.height;e=Math.round(e/10);for(var a,n,o,r,h=t.getImageData(0,0,s,i),l=h.data,c=i;c--;)for(a=s;a--;)(n=l[r=4*(c*s+a)]+e)>255?n=255:n<0&&(n=0),(o=l[r+2]-e)>255?o=255:o<0&&(o=0),l[r]=n,l[r+2]=o;t.putImageData(h,0,0)},this.cleanUp=()=>{var t;null===(t=this.stage.fresco)||void 0===t||t.removeScratch(),this.brushPod.cleanUp(),this.strength.cleanUp(),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.removeDownListeners(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),(0,i.Ay)("temper-mode-increase").removeEventListener("click",this.selectMode,!1),(0,i.Ay)("temper-mode-decrease").removeEventListener("click",this.selectMode,!1),this.selected=null,this.patch=null,this.ptx=null},document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),(0,i.Ay)("temper-mode-increase").addEventListener("click",this.selectMode,!1),(0,i.Ay)("temper-mode-decrease").addEventListener("click",this.selectMode,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),this.brush=new r.A(new h.A),this.brushPod=new l.A(t,"temper-brush",this.brush,this.updateBrush),this.strength=new o.A("temper-brush-strength",{compact:!0,label:(0,c.A)("strength")+":",range:[1,100],defaultValue:30,step:1});const e=document.querySelector('input[name="temper-mode"]:checked').value;this.setMode(e),this.addDownListeners(),this.layerSelect()}}},54975:(t,e,s)=>{s.d(e,{A:()=>P});var i=s(42268),a=s(21742),n=s(54738),o=s(7324),r=s(40963),h=s(75770),l=s(82042),c=s(15818),d=s(22866),u=s(29755),p=s(66827),g=s(26651),m=s(41915),v=s(81937),y=s(79453),f=s(37699),w=s(93771),x=s(3514);class b{constructor(t,e,s,o){if(this.addLocalFont=()=>{(0,w.XN)(!0).then((async t=>{for(var e,s=0;e=t[s];s++)await(0,w.Tq)(this.stage,e);this.removeEventHandlers(),this.showFontList()}))},this.showFontList=()=>{(0,i.Ay)("font-wrap").classList.add("show"),(0,i.Ay)("font-wrap").classList.add("modal"),this.populateFonts(),this.setEventHandlers(),this.selected&&this.setFont(this.selected)},this.hideFontList=(t=!0)=>{(0,i.Ay)("font-wrap").classList.remove("show"),(0,i.Ay)("font-wrap").classList.remove("modal"),t&&this.inFocus&&this.inFocus.getAttribute("data")!==this.selected&&this.loadFont(this.selected,!0),this.selected&&(0,i.Ay)("font:"+this.selected)&&(0,i.Ay)("font:"+this.selected).classList.remove("selected"),this.removeEventHandlers()},this.populateFonts=()=>{const t=(0,i.Ay)("font-list-holder-ss-content");t.childElementCount!==f.A.fontList.length&&(t.innerHTML="",f.A.fontList.forEach((e=>{let s=document.createElement("div");e.local?s.append((0,i.T)("img",{src:URL.createObjectURL(e.thumb),title:e.name,className:"thumb ic",loading:"lazy",width:200,height:40}),(0,i.T)("img",{src:"/img/icon/close.svg",title:"Remove font",className:"close ic",onclick:t=>this.removeFont(t,"font:"+e.name)})):s.append((0,i.T)("img",{src:"/font/"+e.short+".png",title:e.name,className:"thumb ic",loading:"lazy",width:200,height:40})),s.setAttribute("data",e.name),s.setAttribute("id","font:"+e.name),s.classList.add("font-pod"),e.premium&&s.classList.add("premium"),t.appendChild(s)})))},this.setEventHandlers=()=>{document.addEventListener("keydown",this.keyPress,!0);const t=document.querySelectorAll("#font-list-holder div.font-pod");for(let e=0;e<t.length;e++)t[e].addEventListener("click",this.selectFont,!1),t[e].addEventListener("mouseenter",this.enterFont,!1)},this.removeEventHandlers=()=>{document.removeEventListener("keydown",this.keyPress,!0);const t=document.querySelectorAll("#font-list-holder div.font-pod");for(let e=0;e<t.length;e++)t[e].removeEventListener("click",this.selectFont,!1),t[e].removeEventListener("mouseenter",this.enterFont,!1)},this.dragStart=t=>{t.stopPropagation(),this.p=new m.A(t.clientX,t.clientY),this.d=new m.A(this.fontList.offsetLeft,this.fontList.offsetTop),document.addEventListener("mousemove",this.dragMove,!0),document.addEventListener("mouseup",this.dragEnd,!0)},this.dragMove=t=>{t.stopPropagation(),this.fontList.style.left=Math.round(this.d.x+(t.clientX-this.p.x))+"px",this.fontList.style.top=Math.round(this.d.y+(t.clientY-this.p.y))+"px"},this.dragEnd=t=>{t.stopPropagation(),this.p=void 0,document.removeEventListener("mousemove",this.dragMove,!0),document.removeEventListener("mouseup",this.dragEnd,!0)},this.keyPress=t=>{var e;const s=()=>{const t=document.querySelectorAll("#font-list-holder div.font-pod"),e=(0,i.Ay)("font-search").value;this.inFocus=void 0;for(let s=0;s<t.length;s++){t[s].getAttribute("data").toLowerCase().startsWith(e)?(t[s].style.display="block",this.inFocus||(this.inFocus=t[s])):t[s].style.display="none"}};if(t.ctrlKey||"Backspace"===t.key||"Delete"===t.key)n.sg("preview",200,s);else{if(t.preventDefault(),t.stopPropagation(),null===(e=this.inFocus)||void 0===e||e.classList.remove("focus"),!this.inFocus){const t=document.querySelectorAll("#font-list-holder div.font-pod");this.inFocus=t[0]}if("ArrowUp"===t.key){for(this.inFocus=this.inFocus.previousElementSibling;this.inFocus&&"none"===this.inFocus.style.display;)this.inFocus=this.inFocus.previousElementSibling;if(!this.inFocus){const t=document.querySelectorAll("#font-list-holder div.font-pod");this.inFocus=t[t.length-1]}}else if("ArrowDown"===t.key){for(this.inFocus=this.inFocus.nextElementSibling;this.inFocus&&"none"===this.inFocus.style.display;)this.inFocus=this.inFocus.nextElementSibling;if(!this.inFocus){const t=document.querySelectorAll("#font-list-holder div.font-pod");this.inFocus=t[0]}}else{if("Escape"===t.key)return void this.hideFontList();if("Enter"===t.key)this.inFocus&&this.inFocus.getAttribute("data")!==this.selected&&(this.inFocus.classList.contains("premium")&&"premium"!==(null===y.N||void 0===y.N?void 0:y.N.subscriptionAccess)&&!this.stage.fresco.block||(this.loadFont(this.inFocus.getAttribute("data")),this.hideFontList(!1)),this.hideFontList(!0));else{let e=(0,i.Ay)("font-search").value;if(t.key.length>1)return;e+=t.key,(0,i.Ay)("font-search").value=e,s()}}if(this.inFocus){this.inFocus.classList.add("focus");const t=this.inFocus.getAttribute("data");this.inFocus.scrollIntoView({behavior:"auto",block:"nearest",inline:"nearest"}),n.sg("preview",200,(()=>{this.loadFont(t,!0)}))}}},this.lx=0,this.ly=0,this.enterFont=t=>{var e;if(t.clientX===this.lx&&t.clientY===this.ly)return;this.lx=t.clientX,this.ly=t.clientY,null===(e=this.inFocus)||void 0===e||e.classList.remove("focus"),this.inFocus=t.currentTarget,this.inFocus.classList.add("focus");const s=this.inFocus.getAttribute("data");n.sg("preview",200,(()=>{this.loadFont(s,!0)}))},this.selectFont=t=>{let e=t.currentTarget,s=e.classList.contains("premium"),i=e.getAttribute("data");!s||"premium"===(null===y.N||void 0===y.N?void 0:y.N.subscriptionAccess)||this.stage.fresco.block?(this.loadFont(i),this.hideFontList(!1)):new x.A("font","premium")},this.removeFont=(t,e)=>{t.preventDefault(),t.stopPropagation();let s=(0,i.Ay)(e);f.A.removeLocalFontDesc(s.getAttribute("data")),s.remove()},this.loadFont=async(t,e=!1)=>{try{await f.A.loadFont(t);if(e)this.preview(t);else{const e=this.selected;e!==t&&(this.setFont(t),this.callback(t,e))}}catch(s){console.error("Could not load font",t,s)}},this.cleanUp=()=>{this.hideFontList(),(0,i.Ay)("font-search").blur(),this.removeEventHandlers(),this.holder.removeEventListener("click",this.showFontList,!1)},this.stage=t,this.holder=e,this.preview=o,this.callback=s,this.holder.addEventListener("click",this.showFontList,!1),this.selected=f.A.fontList[0].name,!(0,i.Ay)("font-list")){let t=(0,i.T)("div",{id:"font-wrap",onmousedown:t=>{t.target===(0,i.Ay)("font-wrap")&&this.hideFontList()}},(0,i.T)("div",{id:"font-list"},(0,i.T)("img",{id:"font-close",className:"close ic",src:"/img/icon/close.svg",onclick:()=>this.hideFontList()}),(0,i.T)("div",{id:"font-list-title",className:"title",onmousedown:t=>this.dragStart(t)},(0,a.A)("font")),(0,i.T)("div",{className:"splitter"}),(0,i.T)("div",{style:"position:relative;margin: 10px 15px;"},(0,i.T)("input",{id:"font-search",className:"font-search",type:"text",placeholder:(0,a.A)("search")}),(0,i.T)("img",{id:"font-search-icon",className:"search-icon ic",src:"/img/tool/zoom.svg"})),(0,i.T)("div",{id:"font-list-holder"}),(0,i.T)("div",{id:"font-list-add"},(0,i.T)("div",{className:"button positive w-100",onclick:this.addLocalFont},(0,i.T)("img",{src:"/img/icon/plus.svg",width:20,height:20}),(0,a.A)("addLocalFont")))));document.body.appendChild(t),new v.A((0,i.Ay)("font-list-holder"))}this.fontList=(0,i.Ay)("font-list")}setFont(t){this.selected&&(0,i.Ay)("font:"+this.selected)&&(0,i.Ay)("font:"+this.selected).classList.remove("selected");let e=(0,i.Ay)("font:"+t);if(e){e.classList.add("selected");let t=e.childNodes[0];this.holder.innerHTML='<img src="'+t.src+'" class="ic" title="'+t.title+'" />'}else{let e=f.A.getFontDesc(t);e&&(e.local?this.holder.innerHTML='<img src="'+URL.createObjectURL(e.thumb)+'" class="ic" title="'+e.name+'" />':this.holder.innerHTML='<img src="/font/'+e.short+'.png" class="ic" title="'+e.name+'" />')}this.selected=t}}var A=s(89209),k=s(97266),S=s(37771);class E extends S.A{constructor(t,e){super(e,(0,a.A)("format")),this.changeUppercase=()=>{const t=this.selected.textSettings.clone();this.selected.setTextUpperCase(!this.selected.textSettings.uppercase),(0,i.Ay)("text-uppercase").classList.toggle("selected",this.selected.textSettings.uppercase),this.stage.history.add({type:"textSettings",kind:"uppercase",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeItalic=()=>{const t=this.selected.textSettings.clone();this.selected.setTextItalic(!this.selected.textSettings.italic),(0,i.Ay)("text-italic").classList.toggle("selected",this.selected.textSettings.italic),this.stage.history.add({type:"textSettings",kind:"italic",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeBold=()=>{const t=this.selected.textSettings.clone();this.selected.setTextBold(!this.selected.textSettings.bold),(0,i.Ay)("text-bold").classList.toggle("selected",this.selected.textSettings.bold),this.stage.history.add({type:"textSettings",kind:"bold",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeUnderline=()=>{const t=this.selected.textSettings.clone();this.selected.setTextUnderline(!this.selected.textSettings.underline),(0,i.Ay)("text-underline").classList.toggle("selected",this.selected.textSettings.underline),this.stage.history.add({type:"textSettings",kind:"underline",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeLineSpace=t=>{this.selected.textSettings.lineSpace=t,n.sg("text-change",50,(()=>{this.selected.setLineSpace(t),document.dispatchEvent(new CustomEvent("viewport-render"))}))},this.changeLetterSpace=t=>{this.selected.textSettings.letterSpace=t,n.sg("text-change",50,(()=>{this.selected.setLetterSpace(t),document.dispatchEvent(new CustomEvent("viewport-render"))}))},this.changeAlign=t=>{const e=this.selected.textSettings.clone(),s=document.querySelector('input[name="text-align"]:checked').value;this.selected.setTextAlign(s),e.align!==this.selected.textSettings.align&&this.stage.history.add({type:"textSettings",kind:"align",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.cleanUp=()=>{this.lineSpacing.cleanUp(),this.letterSpacing.cleanUp(),(0,i.Ay)("text-align-left").removeEventListener("click",this.changeAlign,!1),(0,i.Ay)("text-align-center").removeEventListener("click",this.changeAlign,!1),(0,i.Ay)("text-align-right").removeEventListener("click",this.changeAlign,!1),(0,i.Ay)("text-align-justify").removeEventListener("click",this.changeAlign,!1),(0,i.Ay)("text-uppercase").removeEventListener("click",this.changeUppercase,!1),(0,i.Ay)("text-italic").removeEventListener("click",this.changeItalic,!1),(0,i.Ay)("text-bold").removeEventListener("click",this.changeBold,!1),(0,i.Ay)("text-underline").removeEventListener("click",this.changeUnderline,!1),this.superCleanUp()},this.stage=t,this.setContent(`\n            <section>\n                <div id="line-space" class="range-box top-5"></div>\n                <div id="letter-space" class="range-box top-10"></div>\n                <label class="top-10">${(0,a.A)("align")}</label>\n                <div class="switch-icon-field stretch top-5">\n                    <input type="radio" id="text-align-left" name="text-align" value="left"><label for="text-align-left" tooltip="${(0,a.A)("alignLeft")}" flow="up-right"><img src="/img/icon/align-left.svg" class="ic"></label>\n                    <input type="radio" id="text-align-center" name="text-align" value="center"><label for="text-align-center" tooltip="${(0,a.A)("alignCenter")}" flow="up"><img src="/img/icon/align-center.svg" class="ic"></label>\n                    <input type="radio" id="text-align-right" name="text-align" value="right"><label for="text-align-right" tooltip="${(0,a.A)("alignRight")}" flow="up"><img src="/img/icon/align-right.svg" class="ic"></label>\n                    <input type="radio" id="text-align-justify" name="text-align" value="justify"><label for="text-align-justify" tooltip="${(0,a.A)("alignJustify")}" flow="up"><img src="/img/icon/align-justify.svg" class="ic"></label>\n                </div>\n                <label class="top-16">${(0,a.A)("style")}</label>\n                <ul class="icon-button-set stretch top-5">\n                    <li id="text-uppercase" tooltip="${(0,a.A)("uppercase")}" flow="up"><img class="ic" src="/img/icon/uppercase.svg" /><div class="mark"></div></li>\n                    <li id="text-italic" tooltip="${(0,a.A)("italic")}" flow="up"><img class="ic" src="/img/icon/italic.svg" /><div class="mark"></div></li>\n                    <li id="text-bold" tooltip="${(0,a.A)("bold")}" flow="up"><img class="ic" src="/img/icon/bold.svg" /><div class="mark"></div></li>\n                    <li id="text-underline" tooltip="${(0,a.A)("underline")}" flow="up"><img class="ic" src="/img/icon/underline.svg" /><div class="mark"></div></li>\n                </ul>\n            </section>\n        `),this.selected=this.stage.fresco.getSelected();let s=this.selected.textSettings;const o={onStart:()=>{s=this.selected.textSettings.clone()},labelFormat:t=>(100*t).toFixed(0),labelParse:t=>parseInt(t,10)/100};this.lineSpacing=new l.A("line-space",Object.assign(Object.assign({},o),{label:(0,a.A)("lineSpace"),range:[-1,1],onChange:this.changeLineSpace,onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"linespace",layer:this.selected,settings:s})}})),this.lineSpacing.setValue(s.lineSpace),this.letterSpacing=new l.A("letter-space",Object.assign(Object.assign({},o),{label:(0,a.A)("letterSpace"),range:[-.2,1],onChange:this.changeLetterSpace,onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"letterspace",layer:this.selected,settings:s})}})),this.letterSpacing.setValue(s.letterSpace),(0,i.Ay)("text-uppercase").classList.toggle("selected",this.selected.textSettings.uppercase),(0,i.Ay)("text-italic").classList.toggle("selected",this.selected.textSettings.italic),(0,i.Ay)("text-bold").classList.toggle("selected",this.selected.textSettings.bold),(0,i.Ay)("text-underline").classList.toggle("selected",this.selected.textSettings.underline),(0,i.Ay)("text-align-left").checked="left"===this.selected.textSettings.align,(0,i.Ay)("text-align-center").checked="center"===this.selected.textSettings.align,(0,i.Ay)("text-align-right").checked="right"===this.selected.textSettings.align,(0,i.Ay)("text-align-justify").checked="justify"===this.selected.textSettings.align,(0,i.Ay)("text-align-left").addEventListener("click",this.changeAlign,!1),(0,i.Ay)("text-align-center").addEventListener("click",this.changeAlign,!1),(0,i.Ay)("text-align-right").addEventListener("click",this.changeAlign,!1),(0,i.Ay)("text-align-justify").addEventListener("click",this.changeAlign,!1),(0,i.Ay)("text-uppercase").addEventListener("click",this.changeUppercase,!1),(0,i.Ay)("text-italic").addEventListener("click",this.changeItalic,!1),(0,i.Ay)("text-bold").addEventListener("click",this.changeBold,!1),(0,i.Ay)("text-underline").addEventListener("click",this.changeUnderline,!1)}}var C=s(8689);class T extends S.A{constructor(t,e){super(e,(0,a.A)("styles"),!0),this.updateInputs=()=>{(0,i.Ay)("text-background").checked=this.selected.textSettings.background,(0,i.Ay)("text-background-punch").checked=this.selected.textSettings.backgroundPunch,this.backgroundColor.setColor(this.selected.textSettings.backgroundColor),this.backgroundOffset.setValue(this.selected.textSettings.backgroundOffset),(0,i.Ay)("text-background-type-full").checked=this.selected.textSettings.backgroundType==A.A.BACKGROUND_FULL,(0,i.Ay)("text-background-type-line").checked=this.selected.textSettings.backgroundType==A.A.BACKGROUND_LINE,(0,i.Ay)("text-background-type-word").checked=this.selected.textSettings.backgroundType==A.A.BACKGROUND_WORD,(0,i.Ay)("text-outline").checked=this.selected.textSettings.outline,(0,i.Ay)("text-outline-punch").checked=this.selected.textSettings.outlinePunch,this.outlineColor.setColor(this.selected.textSettings.outlineColor),this.outlineSize.setValue(this.selected.textSettings.outlineSize),this.outlineDistance.setValue(this.selected.textSettings.outlineDistance),this.outlineDirection.setValue(this.selected.textSettings.outlineDirection),(0,i.Ay)("text-shadow").checked=this.selected.textSettings.shadow,this.shadowColor.setColor(this.selected.textSettings.shadowColor),this.shadowBlur.setValue(this.selected.textSettings.shadowBlur),this.shadowAlpha.setValue(this.selected.textSettings.shadowAlpha),this.shadowDirection.setValue(this.selected.textSettings.shadowDirection),this.shadowDistance.setValue(this.selected.textSettings.shadowDistance),(0,i.Ay)("text-curve").checked=this.selected.textSettings.curve,this.curveAmount.setValue(this.selected.textSettings.curveAmount),(0,i.Ay)("text-curve-flip").checked=this.selected.textSettings.curveFlip,(0,i.Ay)("text-curve-spread").checked=this.selected.textSettings.curveSpread,(0,i.Ay)("text-curve-type-arc").checked="arc"===this.selected.textSettings.curveType,(0,i.Ay)("text-curve-type-circle").checked="circle"===this.selected.textSettings.curveType,(0,i.Ay)("text-curve-type-half").checked="half"===this.selected.textSettings.curveType,(0,i.Ay)("text-curve-amount").style.display="arc"!==this.selected.textSettings.curveType?"none":"block",(0,i.Ay)("text-curve-flip-label").style.display="arc"!==this.selected.textSettings.curveType?"block":"none",(0,i.Ay)("text-curve-spread-label").style.display="arc"!==this.selected.textSettings.curveType?"block":"none",(0,i.Ay)("text-warp").checked=this.selected.textSettings.warp,(0,i.Ay)("text-warp-type-circular").checked=this.selected.textSettings.warpType===A.A.WARP_CIRCULAR,(0,i.Ay)("text-warp-type-angular").checked=this.selected.textSettings.warpType===A.A.WARP_ANGULAR,(0,i.Ay)("text-warp-mode-upper").checked=this.selected.textSettings.warpMode===A.A.WARP_UPPER,(0,i.Ay)("text-warp-mode-middle").checked=this.selected.textSettings.warpMode===A.A.WARP_MIDDLE,(0,i.Ay)("text-warp-mode-lower").checked=this.selected.textSettings.warpMode===A.A.WARP_LOWER,this.warpEdgeSize.setValue(this.selected.textSettings.warpEdgeSize),this.warpCenterSize.setValue(this.selected.textSettings.warpCenterSize),this.warpHorizontalOffset.setValue(this.selected.textSettings.warpHorizontalOffset),this.warpVerticalOffset.setValue(this.selected.textSettings.warpVerticalOffset)},this.changeBackground=t=>{const e=this.selected.textSettings.clone();let s=(0,i.Ay)("text-background").checked,a=(0,i.Ay)("text-background-punch").checked,n=this.backgroundOffset.getValue(),o=this.backgroundColor.getColor().toHEX(),r="";r=(0,i.Ay)("text-background-type-full").checked?A.A.BACKGROUND_FULL:(0,i.Ay)("text-background-type-line").checked?A.A.BACKGROUND_LINE:A.A.BACKGROUND_WORD,this.selected.setBackground(s,r,o,a,n),this.stage.history.add({type:"textSettings",kind:"background",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeCurveState=()=>{const t=this.selected.textSettings.clone();this.changeCurve(),this.stage.history.add({type:"textSettings",kind:"curve",layer:this.selected,settings:t})},this.changeCurve=()=>{let t=this.curveAmount.getValue(),e=(0,i.Ay)("text-curve").checked,s=(0,i.Ay)("text-curve-flip").checked,a=(0,i.Ay)("text-curve-spread").checked,n=document.querySelector('input[name="curve-type"]:checked').value;(0,i.Ay)("text-curve-amount").style.display="arc"!==n?"none":"block",(0,i.Ay)("text-curve-flip-label").style.display="arc"!==n?"block":"none",(0,i.Ay)("text-curve-spread-label").style.display="arc"!==n?"block":"none",this.selected.setCurve(e,n,t,a,s),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeWarpState=()=>{const t=this.selected.textSettings.clone();this.changeWarp(),this.stage.history.add({type:"textSettings",kind:"warp",layer:this.selected,settings:t})},this.changeWarp=()=>{let t=(0,i.Ay)("text-warp").checked,e=this.warpEdgeSize.getValue(),s=this.warpCenterSize.getValue(),a=this.warpHorizontalOffset.getValue(),n=this.warpVerticalOffset.getValue(),o=document.querySelector('input[name="warp-type"]:checked').value,r=document.querySelector('input[name="warp-mode"]:checked').value;this.selected.setWarp(t,o,r,e,s,a,n),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeOutlineState=()=>{const t=this.selected.textSettings.clone();this.changeOutline(),this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:t})},this.changeOutline=()=>{let t=(0,i.Ay)("text-outline").checked,e=(0,i.Ay)("text-outline-punch").checked,s=this.outlineColor.getColor().toHEX(),a=this.outlineSize.getValue(),n=this.outlineDistance.getValue(),o=this.outlineDirection.getValue();this.selected.setOutline(t,a,s,e,n,o),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeOutlineColor=t=>{const e=this.selected.textSettings.clone();this.changeOutline(),this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:e})},this.changeShadowState=()=>{const t=this.selected.textSettings.clone();this.changeShadow(),this.stage.history.add({type:"textSettings",kind:"shadow",layer:this.selected,settings:t})},this.changeShadow=()=>{this.selected.setShadow((0,i.Ay)("text-shadow").checked,this.shadowBlur.getValue(),this.shadowAlpha.getValue(),this.shadowColor.getColor().toHEX(),this.shadowDistance.getValue(),this.shadowDirection.getValue()),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeShadowColor=t=>{const e=this.selected.textSettings.clone();this.changeShadow(),this.stage.history.add({type:"textSettings",kind:"shadow",layer:this.selected,settings:e})},this.cleanUp=()=>{this.selected=void 0,this.backgroundColor.cleanUp(),this.backgroundColor=void 0,this.outlineColor.cleanUp(),this.outlineColor=void 0,this.shadowColor.cleanUp(),this.shadowColor=void 0,this.curveAmount.cleanUp(),this.outlineSize.cleanUp(),this.outlineDistance.cleanUp(),this.outlineDirection.cleanUp(),this.warpEdgeSize.cleanUp(),this.warpCenterSize.cleanUp(),this.warpVerticalOffset.cleanUp(),this.warpHorizontalOffset.cleanUp(),this.shadowBlur.cleanUp(),this.shadowAlpha.cleanUp(),this.shadowDistance.cleanUp(),this.shadowDirection.cleanUp(),(0,i.Ay)("text-background").removeEventListener("change",this.changeBackground,!1),(0,i.Ay)("text-background-punch").removeEventListener("change",this.changeBackground,!1),(0,i.Ay)("text-background-type-full").removeEventListener("change",this.changeBackground,!1),(0,i.Ay)("text-background-type-line").removeEventListener("change",this.changeBackground,!1),(0,i.Ay)("text-background-type-word").removeEventListener("change",this.changeBackground,!1),(0,i.Ay)("text-outline").removeEventListener("change",this.changeOutlineState,!1),(0,i.Ay)("text-outline-punch").removeEventListener("change",this.changeOutlineState,!1),(0,i.Ay)("text-shadow").removeEventListener("change",this.changeShadowState,!1),(0,i.Ay)("text-curve").removeEventListener("change",this.changeCurveState,!1),(0,i.Ay)("text-curve-flip").removeEventListener("change",this.changeCurveState,!1),(0,i.Ay)("text-curve-spread").removeEventListener("change",this.changeCurveState,!1),(0,i.Ay)("text-curve-type-arc").removeEventListener("change",this.changeCurveState,!1),(0,i.Ay)("text-curve-type-circle").removeEventListener("change",this.changeCurveState,!1),(0,i.Ay)("text-curve-type-half").removeEventListener("change",this.changeCurveState,!1),(0,i.Ay)("text-warp").removeEventListener("change",this.changeWarpState,!1),(0,i.Ay)("text-warp-type-circular").removeEventListener("change",this.changeWarpState,!1),(0,i.Ay)("text-warp-type-angular").removeEventListener("change",this.changeWarpState,!1),(0,i.Ay)("text-warp-mode-upper").removeEventListener("change",this.changeWarpState,!1),(0,i.Ay)("text-warp-mode-middle").removeEventListener("change",this.changeWarpState,!1),(0,i.Ay)("text-warp-mode-lower").removeEventListener("change",this.changeWarpState,!1),this.superCleanUp()},this.stage=t,this.selected=this.stage.fresco.getSelected(),this.content.id="text-style-content",this.content.style.height="333px",this.setContent(`\n            <section>\n                <div>\n                    <input type="checkbox" class="toggle-check" id="text-curve" />\n                    <label class="switch subline top-4" for="text-curve">${(0,a.A)("curve")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <div id="text-curve-type" class="switch-field stretch top-4">\n                            <input type="radio" id="text-curve-type-arc" name="curve-type" value="arc" checked/><label for="text-curve-type-arc">${(0,a.A)("arc")}</label>\n                            <input type="radio" id="text-curve-type-circle" name="curve-type" value="circle" /><label for="text-curve-type-circle">${(0,a.A)("circle")}</label>\n                            <input type="radio" id="text-curve-type-half" name="curve-type" value="half" /><label for="text-curve-type-half">${(0,a.A)("half")}</label>\n                        </div>\n                        <div id="text-curve-amount" class="top-16"></div>\n                        <input type="checkbox" id="text-curve-spread" />\n                        <label class="top-16 switch" id="text-curve-spread-label" for="text-curve-spread">${(0,a.A)("spread")}<span></span></label>\n                        <input type="checkbox" id="text-curve-flip" />\n                        <label class="top-16 switch" id="text-curve-flip-label" for="text-curve-flip">${(0,a.A)("flip")}<span></span></label>\n                    </div>\n                </div>\n                <div>\n                    <input type="checkbox" class="toggle-check" id="text-warp" />\n                    <label class="switch subline top-10" for="text-warp">${(0,a.A)("warp")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n        \n                        <div id="text-warp-mode" class="switch-icon-field stretch">\n                            <input type="radio" id="text-warp-mode-upper" name="warp-mode" value="upper" checked /><label for="text-warp-mode-upper" tooltip="Upper" flow="up-left"><img src="/img/icon/warp-upper.svg" class="ic" width="18" height="18"></label>\n                            <input type="radio" id="text-warp-mode-middle" name="warp-mode" value="middle" /><label for="text-warp-mode-middle" tooltip="Middle" flow="up"><img src="/img/icon/warp-middle.svg" class="ic" width="18" height="18"></label>\n                            <input type="radio" id="text-warp-mode-lower" name="warp-mode" value="lower" /><label for="text-warp-mode-lower" tooltip="Lower" flow="up-right"><img src="/img/icon/warp-lower.svg" class="ic" width="18" height="18"></label>\n                        </div>\n                        <div id="text-warp-type" class="switch-field stretch top-16">\n                            <input type="radio" id="text-warp-type-circular" name="warp-type" value="circular" checked/><label for="text-warp-type-circular">${(0,a.A)("circular")}</label>\n                            <input type="radio" id="text-warp-type-angular" name="warp-type" value="angular" /><label for="text-warp-type-angular">${(0,a.A)("angular")}</label>\n                        </div>\n                        <div id="text-warp-edge-size" class="top-16"></div>\n                        <div id="text-warp-center-size"></div>\n                        <div id="text-warp-horizontal-offset"></div>\n                        <div id="text-warp-vertical-offset"></div>\n                    </div>\n                </div>\n                <div>\n                    <input type="checkbox" class="toggle-check" id="text-background" />\n                    <label class="switch subline top-10" for="text-background">${(0,a.A)("background")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <label class="split">${(0,a.A)("color")}<div id="text-background-color"></div></label>\n                        <input type="checkbox" id="text-background-punch" />\n                        <label class="top-15 switch" for="text-background-punch">${(0,a.A)("punchout")}<span></span></label>\n                        <div id="text-background-offset" class="top-15"></div>\n                        <div id="text-background-type" class="switch-field stretch top-16">\n                            <input type="radio" id="text-background-type-full" name="background-type" value="full" checked/><label for="text-background-type-full">${(0,a.A)("full")}</label>\n                            <input type="radio" id="text-background-type-line" name="background-type" value="line" /><label for="text-background-type-line">${(0,a.A)("line")}</label>\n                            <input type="radio" id="text-background-type-word" name="background-type" value="word" /><label for="text-background-type-word">${(0,a.A)("word")}</label>\n                        </div>\n                    </div>\n                </div>\n                <div>\n                    <input type="checkbox" class="toggle-check" id="text-outline" />\n                    <label class="switch subline top-10" for="text-outline">${(0,a.A)("outline")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <label class="split">${(0,a.A)("color")}<div id="text-outline-color"></div></label>\n                        <input type="checkbox" id="text-outline-punch" />\n                        <label class="top-15 switch" for="text-outline-punch">${(0,a.A)("punchout")}<span></span></label>\n                        <div id="text-outline-size" class="top-15"></div>\n                        <div id="text-outline-distance"></div>\n                        <div id="text-outline-direction"></div>\n                    </div>\n                </div>\n                <div>\n                <input type="checkbox" class="toggle-check" id="text-shadow" />\n                <label class="switch subline top-10" for="text-shadow">${(0,a.A)("shadow")}<span></span><span class="arrow"></span></label>\n                <div class="toggle">\n                        <label class="split">${(0,a.A)("color")}<div id="text-shadow-color"></div></label>\n                        <div id="text-shadow-blur" class="top-10"></div>\n                        <div id="text-shadow-distance"></div>\n                        <div id="text-shadow-direction"></div>\n                        <div id="text-shadow-alpha"></div>\n                    </div>\n                </div>\n            <section>\n        `);let s=this.selected.textSettings;this.backgroundColor=new C.A("text-background-color",c.A.fromHEX(u.Ay.altColor),this.changeBackground),this.outlineColor=new C.A("text-outline-color",c.A.fromHEX(u.Ay.altColor),this.changeOutlineColor),this.shadowColor=new C.A("text-shadow-color",c.A.fromHEX(u.Ay.altColor),this.changeShadowColor);const n={onStart:()=>{s=this.selected.textSettings.clone()},labelFormat:t=>(100*t).toFixed(0),labelParse:t=>parseInt(t,10)/100};this.outlineSize=new l.A("text-outline-size",Object.assign(Object.assign({},n),{label:(0,a.A)("size"),range:[.01,1],defaultValue:.3,onChange:()=>this.changeOutline(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:s})}})),this.outlineDistance=new l.A("text-outline-distance",Object.assign(Object.assign({},n),{label:(0,a.A)("distance"),range:[0,1],onChange:()=>this.changeOutline(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:s})}})),this.outlineDirection=new l.A("text-outline-direction",Object.assign(Object.assign({},n),{label:(0,a.A)("direction"),range:[0,360],defaultValue:180,labelFormat:t=>t.toFixed(1),labelParse:t=>parseInt(t,10),onChange:()=>this.changeOutline(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:s})}}));const o=Object.assign(Object.assign({},n),{range:[0,1],onChange:()=>this.changeShadow(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"shadow",layer:this.selected,settings:s})}});this.backgroundOffset=new l.A("text-background-offset",Object.assign(Object.assign({},n),{label:(0,a.A)("offset"),range:[-1,1],onEnd:()=>{this.changeBackground()}})),this.shadowBlur=new l.A("text-shadow-blur",Object.assign(Object.assign({},o),{label:(0,a.A)("blur")})),this.shadowAlpha=new l.A("text-shadow-alpha",Object.assign(Object.assign({},o),{label:(0,a.A)("opacity"),defaultValue:1})),this.shadowDistance=new l.A("text-shadow-distance",Object.assign(Object.assign({},o),{label:(0,a.A)("distance"),range:[0,1]})),this.shadowDirection=new l.A("text-shadow-direction",Object.assign(Object.assign({},o),{label:(0,a.A)("direction"),range:[0,360],defaultValue:180,labelFormat:t=>t.toFixed(1),labelParse:t=>parseInt(t,10)})),this.curveAmount=new l.A("text-curve-amount",{label:(0,a.A)("amount"),step:.01,range:[-1,1],labelFormat:t=>`${Math.round(100*t)}`,labelParse:t=>parseInt(t,10)/100,onChange:()=>this.changeCurve(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"curve",layer:this.selected,settings:s})}}),this.warpEdgeSize=new l.A("text-warp-edge-size",Object.assign(Object.assign({},n),{label:(0,a.A)("edgeSize"),range:[-1,1],onChange:()=>this.changeWarp(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"warp",layer:this.selected,settings:s})}})),this.warpCenterSize=new l.A("text-warp-center-size",Object.assign(Object.assign({},n),{label:(0,a.A)("centerSize"),range:[-1,1],onChange:()=>this.changeWarp(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"warp",layer:this.selected,settings:s})}})),this.warpHorizontalOffset=new l.A("text-warp-horizontal-offset",Object.assign(Object.assign({},n),{label:(0,a.A)("horizontalOffset"),range:[-1,1],onChange:()=>this.changeWarp(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"warp",layer:this.selected,settings:s})}})),this.warpVerticalOffset=new l.A("text-warp-vertical-offset",Object.assign(Object.assign({},n),{label:(0,a.A)("verticalOffset"),range:[-1,1],onChange:()=>this.changeWarp(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"warp",layer:this.selected,settings:s})}})),(0,i.Ay)("text-background").addEventListener("change",this.changeBackground,!1),(0,i.Ay)("text-background-punch").addEventListener("change",this.changeBackground,!1),(0,i.Ay)("text-background-type-full").addEventListener("change",this.changeBackground,!1),(0,i.Ay)("text-background-type-line").addEventListener("change",this.changeBackground,!1),(0,i.Ay)("text-background-type-word").addEventListener("change",this.changeBackground,!1),(0,i.Ay)("text-curve").addEventListener("change",this.changeCurveState,!1),(0,i.Ay)("text-curve-flip").addEventListener("change",this.changeCurveState,!1),(0,i.Ay)("text-curve-spread").addEventListener("change",this.changeCurveState,!1),(0,i.Ay)("text-curve-type-arc").addEventListener("change",this.changeCurveState,!1),(0,i.Ay)("text-curve-type-circle").addEventListener("change",this.changeCurveState,!1),(0,i.Ay)("text-curve-type-half").addEventListener("change",this.changeCurveState,!1),(0,i.Ay)("text-warp").addEventListener("change",this.changeWarpState,!1),(0,i.Ay)("text-warp-type-circular").addEventListener("change",this.changeWarpState,!1),(0,i.Ay)("text-warp-type-angular").addEventListener("change",this.changeWarpState,!1),(0,i.Ay)("text-warp-mode-upper").addEventListener("change",this.changeWarpState,!1),(0,i.Ay)("text-warp-mode-middle").addEventListener("change",this.changeWarpState,!1),(0,i.Ay)("text-warp-mode-lower").addEventListener("change",this.changeWarpState,!1),(0,i.Ay)("text-outline").addEventListener("change",this.changeOutlineState,!1),(0,i.Ay)("text-outline-punch").addEventListener("change",this.changeOutlineState,!1),(0,i.Ay)("text-shadow").addEventListener("change",this.changeShadowState,!1),this.updateInputs(),new v.A(this.content)}}var L=s(98244);class M extends S.A{constructor(t,e){super(e,(0,a.A)("preset"),!0),this.SERVER_URL="/",this.populatePresets=async()=>{const t=await fetch("/text/index.json"),e=await t.json(),s=(0,i.Ay)("text-preset-content-ss-content");s.classList.add("text-holder"),s.innerHTML="",e.presets.forEach((t=>{const e="/text/"+t.id+"/thumbnail.webp",a=(0,i.T)("div",{id:t.id,className:"text-box"});a.setAttribute("loading","lazy"),t.premium&&a.classList.add("premium"),a.addEventListener("click",this.selectPreset,!0),a.style.backgroundImage="url("+e+")",s.append(a)}))},this.selectPreset=async t=>{if(this.working)return;if(t.currentTarget.classList.contains("premium")&&"premium"!==(null===y.N||void 0===y.N?void 0:y.N.subscriptionAccess))return this.cleanUp(),void new x.A("font","premium");this.working=!0;const e=t.currentTarget.getAttribute("id");await(0,w.h6)(this.stage,"/text/"+e+"/manifest.json"),this.working=!1,(0,L.A)("text-preset",e)},this.stage=t,this.float.style.height="70%",this.float.style.width="265px",this.content.id="text-preset-content",new v.A(this.content),this.populatePresets()}}class P extends h.A{constructor(t){let e;super("text",t),this.showTextFormat=()=>{new E(this.stage,(0,i.Ay)("text-format"))},this.showTextStyles=()=>{new T(this.stage,(0,i.Ay)("text-styles"))},this.showTextPresets=()=>{new M(this.stage,(0,i.Ay)("text-presets"))},this.layerSelect=()=>{if(this.stage.fresco.getSelected()!==this.selected&&this.stage.history.commitTransaction(),!this.stage.fresco.isSelectedType(d.A.TYPE_TEXT))return(0,i.Ay)("text-settings").style.display="none",(0,i.Ay)("text-no-layer").style.display="flex",void(this.selected=void 0);(0,i.Ay)("text-settings").style.display="flex",(0,i.Ay)("text-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.fill.setFill(this.selected.fill),this.font.setFont(this.selected.textSettings.font),this.textSize.setValue(this.selected.textSettings.size)},this.layerArrange=()=>{this.selected&&this.textSize.setValue(this.selected.textSettings.size)},this.changeSize=t=>{this.selected.textSettings.size=t,n.sg("text-change",50,(()=>{this.selected.setTextSize(t),document.dispatchEvent(new CustomEvent("viewport-render"))}))},this.previewFill=t=>{this.selected.setTextFill(t,!0),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeFill=t=>{const e=this.selected.textSettings.clone();this.selected.setTextFill(t),this.stage.history.add({type:"textSettings",kind:"fill",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.previewFont=t=>{this.selected&&(this.selected.setTextFont(t,!0),document.dispatchEvent(new CustomEvent("viewport-render")))},this.changeFont=(t,e)=>{if(!this.selected)return;const s=this.selected.textSettings.clone();s.font=e,this.selected.setTextFont(t),this.stage.history.add({type:"textSettings",kind:"font",layer:this.selected,settings:s}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.reformDown=(t,e)=>{this.downPoint=t,this.usedtobe=e,this.stage.coating.freeze(!0),this.addMoveListeners()},this.move=t=>{const e=this.stage.translateToRect(this.downPoint,t,!1,!0);e.width>0&&e.height>0&&this.drawframe(e.topLeft(),e.bottomRight()),document.dispatchEvent(new CustomEvent("legend",{detail:"W: "+Math.round(e.width/this.stage.zoom)+"  H: "+Math.round(e.height/this.stage.zoom)}))},this.drawframe=(t,e)=>{const s=this.stage.coating.ctx;s.lineWidth=u.Ay.isHDPI?4:2,s.strokeStyle=n.bi,s.clearRect(0,0,s.canvas.width,s.canvas.height),s.strokeRect(t.x,t.y,e.x-t.x,e.y-t.y)},this.up=async t=>{if(this.stage.coating.clear(!0),this.stage.coating.freeze(!1),this.removeMoveListeners(),document.dispatchEvent(new CustomEvent("legend",{detail:"stop"})),this.downPoint.distanceTo(t)>10){const e=this.stage.translateToRect(this.downPoint,t,!1,!1);e.height=Math.round(e.height/3),e.height<20&&(e.height=20),this.addText(e)}else this.usedtobe||await new k.A((0,a.A)("addText"),(0,a.A)("doYouWantToAddANewTextLayer"),(0,a.A)("add")).init()&&this.addTextEvent()},this.addTextEvent=()=>{let t=this.stage.getViewPort();this.addText(new r.A(Math.round(t.x+(t.width-Math.round(t.width/1.2))/2),Math.round(t.y+t.height/2.5),Math.round(t.width/1.2),this.textSize.getValue()))},this.addText=async t=>{let e=new A.A(this.font.selected,t.height);await this.font.loadFont(this.font.selected),this.fill.setFill(new o.A(c.A.fromHEX(u.Ay.mainColor))),e.fillType=this.fill.getFill().getType(),e.fillValue=this.fill.getFill().getStringValue(),await this.stage.addText((0,a.A)("loremIpsum"),t,e,"add"),this.editMode()},this.editMode=()=>{this.reform.dblClick()},this.deleteLayer=()=>{this.stage.deleteLayer()},this.duplicateLayer=()=>{this.stage.duplicateLayer()},this.cleanUp=()=>{this.stage.history.commitTransaction(),this.reform.cleanUp(),this.reform=void 0,this.stage.coating.wake(),this.font.cleanUp(),this.font=null,this.fill.cleanUp(),this.fill=null,this.textSize.cleanUp(),(0,i.Ay)("text-edit").removeEventListener("click",this.editMode,!0),(0,i.Ay)("add-text-button").removeEventListener("click",this.addTextEvent,!0),(0,i.Ay)("text-format").removeEventListener("click",this.showTextFormat,!1),(0,i.Ay)("text-styles").removeEventListener("click",this.showTextStyles,!1),(0,i.Ay)("text-presets").removeEventListener("click",this.showTextPresets,!1),(0,i.Ay)("text-add").removeEventListener("click",this.addTextEvent,!1),(0,i.Ay)("text-delete").removeEventListener("click",this.deleteLayer,!1),(0,i.Ay)("text-duplicate").removeEventListener("click",this.duplicateLayer,!1),document.removeEventListener("add-text",this.addTextEvent,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("layer-arrange",this.layerArrange,!1)},this.stage=t,this.stage.coating.sleep(),this.fill=new p.A("text-fill",new o.A(c.A.fromHEX(u.Ay.mainColor)),this.changeFill,this.previewFill),this.font=new b(this.stage,(0,i.Ay)("text-font-picker"),this.changeFont,this.previewFont),(0,i.Ay)("add-text-button").addEventListener("click",this.addTextEvent,!0),(0,i.Ay)("text-edit").addEventListener("click",this.editMode,!0),this.textSize=new l.A("text-size",{compact:!0,label:(0,a.A)("size")+":",range:[4,100,1e3],defaultValue:60,step:[2,5],stops:[0,.4,1],labelFormat:t=>t.toString(),labelParse:t=>parseInt(t),onStart:()=>{e=this.selected.textSettings.clone()},onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"size",layer:this.selected,settings:e})},onChange:this.changeSize}),(0,i.Ay)("text-add").addEventListener("click",this.addTextEvent,!1),(0,i.Ay)("text-delete").addEventListener("click",this.deleteLayer,!1),(0,i.Ay)("text-duplicate").addEventListener("click",this.duplicateLayer,!1),(0,i.Ay)("text-format").addEventListener("click",this.showTextFormat,!1),(0,i.Ay)("text-styles").addEventListener("click",this.showTextStyles,!1),(0,i.Ay)("text-presets").addEventListener("click",this.showTextPresets,!1),document.addEventListener("add-text",this.addTextEvent,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("layer-arrange",this.layerArrange,!1),this.reform=new g.A(t,"TEXT"),this.reform.proxy=this.reformDown,this.layerSelect()}}},22400:(t,e,s)=>{s.d(e,{A:()=>d});var i=s(42268),a=s(21742),n=s(54738),o=s(75770),r=s(82042),h=s(59350),l=s(71499),c=s(85337);class d extends o.A{constructor(t){super("toning",t),this.mode="lighten",this.range="midtone",this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.Ay)("toning-no-layer").style.display="flex",(0,i.Ay)("toning-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.Ay)("toning-settings").style.display="flex",(0,i.Ay)("toning-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.stage.fresco.hasSelection()&&this.scratch.addBake(),this.updateBrush()},this.toggleMode=()=>{this.setMode("lighten"===this.mode?"darken":"lighten")},this.selectMode=t=>{this.setMode(t.currentTarget===(0,i.Ay)("toning-mode-lighten")?"lighten":"darken")},this.setMode=t=>{this.mode=t,(0,i.Ay)("toning-mode-lighten").checked="lighten"===this.mode,(0,i.Ay)("toning-mode-darken").checked="darken"===this.mode},this.isShiftDown=!1,this.keyDown=t=>{if("Shift"===t.key&&!this.isShiftDown)return this.isShiftDown=!0,void this.toggleMode();switch(t.key){case",":t.shiftKey?this.brushPod.stepSoftness(.1):this.brushPod.stepSize(-10);break;case".":t.shiftKey?this.brushPod.stepSoftness(-.1):this.brushPod.stepSize(10)}},this.keyUp=t=>{"Shift"===t.key&&(this.isShiftDown=!1,this.toggleMode())},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage()},this.down=(t,e)=>{this.selected&&(this.stage.coating.freeze(!0),this.range=document.querySelector('input[name="toning-range"]:checked').value,this.isShiftDown||(this.x=this.y=-1),"touch"!==e&&this.move(t),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=t=>{let e=2*this.brush.getStep(),s=!1;if(t=this.stage.translateRasterToFresco(t,this.selected.rect),-1===this.x&&(this.lx=t.x,this.ly=t.y,this.x=t.x,this.y=t.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),t.x!==this.x||t.y!==this.y){let i=t.x-this.x,a=t.y-this.y,n=i>0?1:-1,o=a>0?1:-1;if(i=i<0?-i:i,a=a<0?-a:a,i>a){let t=.5*i;for(let r=1;r<=i;r++)this.x+=n,t+=a,t>=i&&(t-=i,this.y+=o),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let t=.5*a;for(let r=1;r<=a;r++)this.y+=o,t+=i,t>=a&&(t-=a,this.x+=n),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&(this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render())))},this.drawShape=(t,e)=>{let s=this.strength.getValue(),i=this.getPatchContext(this.brush.canvas.width,this.brush.canvas.height);i.save(),i.drawImage(this.selected.canvas,-t,-e),"lighten"===this.mode?this.lighten(i,this.range,s):this.darken(i,this.range,s),i.globalCompositeOperation="destination-in",i.drawImage(this.brush.canvas,0,0),i.restore(),this.scratch.ctx.drawImage(this.patch,t,e)},this.getPatchContext=(t,e)=>this.patch?(this.patch.width!==t||this.patch.height!==e?(this.patch.width=t,this.patch.height=e):this.ptx.clearRect(0,0,t,e),this.ptx):(this.patch=n.VI(t,e),this.ptx=this.patch.getContext("2d"),this.ptx),this.up=t=>{this.stage.coating.freeze(!1),this.removeMoveListeners();let e=n.TL(this.scratch.getCanvas());if(e&&e.width>0&&e.height>0){let t=n.ON(this.selected.canvas,e);const s=this.selected.rect.clone();this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"toning",layer:this.selected,patchRect:e,patch:t,rect:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.lighten=(t,e,s)=>{var i=t.canvas.width,a=t.canvas.height;s/=100;for(var n,o,r,h,l,c,d=t.getImageData(0,0,i,a),u=d.data,p=a;p--;)for(n=i;n--;){switch(o=u[l=4*(p*i+n)]/255,r=u[l+1]/255,h=u[l+2]/255,e){case"highlight":o+=s*(Math.exp(o)-1),r+=s*(Math.exp(r)-1),h+=s*(Math.exp(h)-1);break;case"midtone":o+=(c=.25*s)*Math.sin(o*Math.PI),r+=c*Math.sin(r*Math.PI),h+=c*Math.sin(h*Math.PI);break;case"shadow":o=(c=1-.5*s)*o+(1-c),r=c*r+(1-c),h=c*h+(1-c)}(o*=255)>255&&(o=255),(r*=255)>255&&(r=255),(h*=255)>255&&(h=255),u[l]=o,u[l+1]=r,u[l+2]=h}t.putImageData(d,0,0)},this.darken=(t,e,s)=>{var i=t.canvas.width,a=t.canvas.height;s/=100;for(var n,o,r,h,l,c,d=t.getImageData(0,0,i,a),u=d.data,p=a;p--;)for(n=i;n--;){switch(o=u[l=4*(p*i+n)]/255,r=u[l+1]/255,h=u[l+2]/255,e){case"highlight":o*=c=1-.75*s,r*=c,h*=c;break;case"midtone":o-=(c=.25*s)*Math.sin(o*Math.PI),r-=c*Math.sin(r*Math.PI),h-=c*Math.sin(h*Math.PI);break;case"shadow":o+=s*(1-Math.exp(1-o)),r+=s*(1-Math.exp(1-r)),h+=s*(1-Math.exp(1-h))}(o*=255)<0&&(o=0),(r*=255)<0&&(r=0),(h*=255)<0&&(h=0),u[l]=o,u[l+1]=r,u[l+2]=h}t.putImageData(d,0,0)},this.cleanUp=()=>{var t;null===(t=this.stage.fresco)||void 0===t||t.removeScratch(),this.brushPod.cleanUp(),this.strength.cleanUp(),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.removeDownListeners(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),(0,i.Ay)("toning-mode-lighten").removeEventListener("click",this.selectMode,!1),(0,i.Ay)("toning-mode-darken").removeEventListener("click",this.selectMode,!1),this.selected=null,this.patch=null,this.ptx=null},document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),(0,i.Ay)("toning-mode-lighten").addEventListener("click",this.selectMode,!1),(0,i.Ay)("toning-mode-darken").addEventListener("click",this.selectMode,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),this.brush=new h.A(new l.A),this.brushPod=new c.A(t,"toning-brush",this.brush,this.updateBrush),this.strength=new r.A("toning-brush-strength",{compact:!0,label:(0,a.A)("strength")+":",range:[1,100],defaultValue:30,step:1});const e=document.querySelector('input[name="toning-mode"]:checked').value;this.setMode(e),this.addDownListeners(),this.layerSelect()}}},69429:(t,e,s)=>{s.d(e,{A:()=>d});var i=s(42268),a=s(21742),n=s(54738),o=s(67983),r=s(40963),h=s(82042),l=s(15818),c=s(8594);class d extends c.A{constructor(t){super("wand",t),this.selectMode=()=>{this.mode=document.querySelector('input[name="wand-mode"]:checked').value},this.keyDown=t=>{"Shift"!==t.key||this.isShiftDown||(this.isShiftDown=!0,this.isDown||((0,i.Ay)("wand-mode-add").checked=!0,this.selectMode())),"Control"!==t.key||this.isCtrlDown||(this.isCtrlDown=!0,this.isDown||((0,i.Ay)("wand-mode-remove").checked=!0,this.selectMode()))},this.keyUp=t=>{"Shift"===t.key&&this.isShiftDown&&(this.isShiftDown=!1,this.isCtrlDown||this.isDown||((0,i.Ay)("wand-mode-new").checked=!0,this.selectMode())),"Control"===t.key&&this.isCtrlDown&&(this.isCtrlDown=!1,this.isDown||((0,i.Ay)("wand-mode-new").checked=!0,this.selectMode()))},this.layerSelect=()=>{this.scratch=this.stage.fresco.addScratch(),this.flat=this.stage.getOutputCanvas(),this.canvas=this.stage.getSingleLayerOutputCanvas()},this.down=t=>{this.stage.coating.animateCursorTap();let e=!this.canvas||(0,i.Ay)("wand-sample-all").checked;t=this.stage.translateRasterToFresco(t),"new"===this.mode&&this.stage.fresco.selection&&this.stage.fresco.selection.clear();let s=this.tolerance.getValue();if(e)this.canvasData=new Uint8Array(this.flat.getContext("2d").getImageData(0,0,this.flat.width,this.flat.height).data.buffer),this.scratch.setTarget("flat",new r.A(0,0,this.flat.width,this.flat.height),"none");else{if(!this.canvas)return;this.canvasData=new Uint8Array(this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height).data.buffer),this.scratch.setTarget("flat",new r.A(0,0,this.canvas.width,this.canvas.height),"none")}if(this.setHistory(),t.x<0||t.y<0||t.x>this.scratch.canvas.width||t.y>this.scratch.canvas.height)return void(this.stage.fresco.hasSelection()&&(this.stage.fresco.selection.reset(),this.addHistory("deselect")));let a=4*(t.y*(e?this.flat.width:this.canvas.width)+t.x),o=new l.A(this.canvasData[a],this.canvasData[a+1],this.canvasData[a+2],this.canvasData[a+3]),h=this.scratch.ctx.getImageData(0,0,this.scratch.canvas.width,this.scratch.canvas.height);this.scratchData=new Uint8Array(h.data.buffer),(0,i.Ay)("wand-contiguous").checked?this.floodFill(t,o,s,(0,i.Ay)("wand-anti-alias").checked):this.allFill(o,s,(0,i.Ay)("wand-anti-alias").checked),this.scratch.ctx.putImageData(h,0,0);let c=n.TL(this.scratch.canvas);c&&c.width>0&&c.height>0&&(this.stage.fresco.addSelection(),this.stage.fresco.selection.drawOnMask(this.scratch.canvas,this.feather.getValue(),!1,"remove"===this.mode),window.requestAnimationFrame((()=>{this.stage.coating.render()}))),this.isDown=!1,this.addHistory()},this.allFill=(t,e,s)=>{var i,a;let n,o,r,h,l,c,d;for(var u=0,p=this.scratch.canvas.height;u<p;++u)for(var g=0,m=this.scratch.canvas.width;g<m;++g)a=4*(u*m+g),h=t.a-this.canvasData[a+3],o=h<0?-h:h,t.a>0&&(l=t.r-this.canvasData[a],n=l<0?-l:l,n>o&&(o=n),c=t.g-this.canvasData[a+1],n=c<0?-c:c,n>o&&(o=n),d=t.b-this.canvasData[a+2],n=d<0?-d:d,n>o&&(o=n)),s&&e>0?(r=1.5-o/e,i=r<=0?0:r<.5?Math.round(512*r):255):i=o>e?0:255,i>64&&(i>128&&(i=255),this.scratchData[a+3]=i)},this.floodFill=(t,e,s,i)=>{let a=this.scratch.canvas.width,n=this.scratch.canvas.height,o=new Array,r=new Array(a*n);for(this.linearFill(t.x,t.y,e,s,i,o,r);o.length>0;)for(var h=o.shift(),l=h.start;l<=h.stop;++l)h.row>0&&!r[(h.row-1)*a+l]&&this.linearFill(l,h.row-1,e,s,i,o,r),h.row<n-1&&!r[(h.row+1)*a+l]&&this.linearFill(l,h.row+1,e,s,i,o,r)},this.linearFill=(t,e,s,i,a,n,r)=>{var h=this.scratch.canvas.width;r[h*e+t]=!0;let l=4*(h*e+t),c=this.tolerate(l,s,i,a);if(c>5&&(this.scratchData[l+3]=c>160?255:c),c>64){for(var d=t-1,u=t+1;d>=0&&!r[h*e+d]&&c>64;)r[h*e+d]=!0,l=4*(h*e+d),c=this.tolerate(l,s,i,a),c>5&&(this.scratchData[l+3]=c>160?255:c),--d;for(c=255;u<h&&!r[h*e+u]&&c>64;)r[h*e+u]=!0,l=4*(h*e+u),c=this.tolerate(l,s,i,a),c>5&&(this.scratchData[l+3]=c>160?255:c),++u;n.push(new o.A(d+1,u-1,e))}},this.tolerate=(t,e,s,i=!1)=>{let a,n,o,r,h,l,c;return r=e.a-this.canvasData[t+3],n=r<0?-r:r,e.a>0&&(h=e.r-this.canvasData[t],a=h<0?-h:h,a>n&&(n=a),l=e.g-this.canvasData[t+1],a=l<0?-l:l,a>n&&(n=a),c=e.b-this.canvasData[t+2],a=c<0?-c:c,a>n&&(n=a)),i&&s>0?(o=1.5-n/s,o<=0?0:o<.5?Math.round(512*o):255):n>s?0:255},this.cleanUp=()=>{var t,e;(this.isShiftDown||this.isCtrlDown)&&((0,i.Ay)("wand-mode-new").checked=!0),this.superClean(),this.stage.fresco&&this.stage.fresco.selection&&0===(null===(t=this.stage.fresco.selection.outline)||void 0===t?void 0:t.length)&&this.stage.fresco.removeSelection(),null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.canvas=void 0,this.flat=void 0,this.feather.cleanUp(),this.tolerance.cleanUp(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),(0,i.Ay)("wand-mode-new").removeEventListener("change",this.selectMode,!1),(0,i.Ay)("wand-mode-add").removeEventListener("change",this.selectMode,!1),(0,i.Ay)("wand-mode-remove").removeEventListener("change",this.selectMode,!1)},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),this.tolerance=new h.A("wand-tolerance",{compact:!0,label:(0,a.A)("tolerance")+":",defaultValue:32,range:[0,255],step:1}),this.feather=new h.A("wand-feather",{compact:!0,defaultValue:0,label:(0,a.A)("feather")+":",labelFormat:t=>(100*t).toFixed(0),labelParse:t=>parseInt(t,10)/100}),(0,i.Ay)("wand-mode-new").addEventListener("change",this.selectMode,!1),(0,i.Ay)("wand-mode-add").addEventListener("change",this.selectMode,!1),(0,i.Ay)("wand-mode-remove").addEventListener("change",this.selectMode,!1),this.selectMode(),this.layerSelect()}}},39612:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(42268),a=s(21742),n=s(75770),o=s(41915),r=s(21079);class h extends n.A{constructor(t){super("zoom",t),this.stage=t,this.mode="plus",this.contextMenu=t=>{t.preventDefault(),t.stopPropagation(),new r.Ay(new o.A(t.clientX,t.clientY),[new r.kt((0,a.A)("titleFitScreen"),(()=>this.stage.setZoom("fit")),"Ctrl + 0"),new r.kt((0,a.A)("titleFillScreen"),(()=>this.stage.setZoom("fill")),"Ctrl + 2"),new r.kt("100%",(()=>this.stage.setZoom("1")),"Ctrl + 1"),new r.kt("200%",(()=>this.stage.setZoom("2"))),new r.kt("300%",(()=>this.stage.setZoom("3")),"Ctrl + 3"),new r.kt,new r.kt((0,a.A)("titleZoomIn"),(()=>this.stage.setZoomStep(!0)),"Ctrl + +"),new r.kt((0,a.A)("titleZoomOut"),(()=>this.stage.setZoomStep(!1)),"Ctrl + -")])},this.z1x=()=>{this.stage.setZoom("1")},this.fit=()=>{this.stage.setZoom("fit")},this.fill=()=>{this.stage.setZoom("fill")},this.toggleMode=()=>{this.setMode("plus"===this.mode?"minus":"plus")},this.selectMode=t=>{this.setMode(t.currentTarget===(0,i.Ay)("zoom-mode-plus")?"plus":"minus")},this.setMode=t=>{this.mode=t,(0,i.Ay)("zoom-mode-plus").checked="plus"===this.mode,(0,i.Ay)("zoom-mode-minus").checked="minus"===this.mode,this.stage.raster.style.cursor="plus"===this.mode?"zoom-in":"zoom-out"},this.shiftDown=t=>{"Shift"!==t.key||this.isShiftDown||(this.isShiftDown=!0,this.toggleMode())},this.shiftUp=t=>{"Shift"===t.key&&(this.isShiftDown=!1,this.toggleMode())},this.down=t=>{this.stage.supressRender=!0;const e=this.stage.getViewPort().center(),s=this.stage.translateRasterToFresco(t,void 0,!1);this.stage.setZoomStep("plus"===this.mode,2);const i=this.stage.translateRasterToFresco(t,void 0,!1);this.stage.supressRender=!1,this.stage.setAnchor(new o.A(e.x+(s.x-i.x),e.y+(s.y-i.y))),this.stage.updateViewport()},this.cleanUp=()=>{this.removeDownListeners(),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),(0,i.Ay)("zoom-1x").removeEventListener("click",this.z1x,!1),(0,i.Ay)("zoom-fit").removeEventListener("click",this.fit,!1),(0,i.Ay)("zoom-fill").removeEventListener("click",this.fill,!1),(0,i.Ay)("zoom-mode-plus").removeEventListener("click",this.selectMode,!1),(0,i.Ay)("zoom-mode-minus").removeEventListener("click",this.selectMode,!1),this.stage.raster.removeEventListener("contextmenu",this.contextMenu,!0)},document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),(0,i.Ay)("zoom-1x").addEventListener("click",this.z1x,!1),(0,i.Ay)("zoom-fit").addEventListener("click",this.fit,!1),(0,i.Ay)("zoom-fill").addEventListener("click",this.fill,!1),this.stage.raster.addEventListener("contextmenu",this.contextMenu,!0),(0,i.Ay)("zoom-mode-plus").addEventListener("click",this.selectMode,!1),(0,i.Ay)("zoom-mode-minus").addEventListener("click",this.selectMode,!1);const e=document.querySelector('input[name="zoom-mode"]:checked').value;this.setMode(e),this.addDownListeners()}}},18505:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(21742),a=s(41915),n=s(42268),o=s(81937);class r{constructor(t,e){this.stage=t,this.active=e,this.dragStart=t=>{this.p=t,this.d=new a.A(this.panel.offsetLeft,this.panel.offsetTop)},this.dragMove=t=>{this.panel.style.left=Math.round(this.d.x+(t.x-this.p.x))+"px",this.panel.style.top=Math.round(this.d.y+(t.y-this.p.y))+"px"},this.dragEnd=t=>{let e=Math.round(this.d.y+(t.y-this.p.y)),s=Math.round(this.d.x+(t.x-this.p.x));e<76&&(e=76),s<0&&(s=0),s+120>(0,n.Ay)("workspace").offsetWidth&&(s=(0,n.Ay)("workspace").offsetWidth-240),this.panel.style.left=s+"px",this.panel.style.top=e+"px"},this.resizeStart=t=>{this.d=new a.A(this.panel.clientHeight,t.y)},this.resizeMove=t=>{const e=this.d.x+(t.y-this.d.y);this.panel.style.height=(e<120?120:e)+"px"},this.activate=t=>{this.panel.classList.toggle("active",t),t&&this.panel.classList.remove("collapse"),this.active=t,this.render()},this.render=()=>{if(!this.active||!this.stage.fresco||!this.stage.history)return void(this.list.innerHTML="");const t=this.stage.history.undos(!1),e=this.stage.history.undos(!0),s=t.length+e.length,a=t=>()=>this.stage.history.jump(t-s),o=t=>()=>this.stage.history.jump(t),r=t.map(((t,e)=>{const s=h(t,!1);return(0,n.T)("li",(0,n.T)("div",{className:"history-item",onclick:a(e+1)},(0,n.T)("div",s.title),(0,n.T)("img",{src:`/img/tool/${s.icon}.svg`,className:"ic"})))}));if(0===e.length&&r.length>0){const t=r[r.length-1].querySelector(".history-item");t.classList.add("selected"),t.children[1].classList.remove("ic"),t.onclick=void 0}const l=this.stage.history.redos(!1);r.push(...l.map(((t,e)=>{const s=h(t,!1);return(0,n.T)("li",(0,n.T)("div",{className:"history-item redo",onclick:o(e+1)},(0,n.T)("div",s.title),(0,n.T)("img",{src:`/img/tool/${s.icon}.svg`,className:"ic"})))})));const c=this.stage.history.getActiveTransaction();if(c){const s=e.map(((s,i)=>{const o=h(s,!0);return i===e.length-1?(0,n.T)("li",{className:"selected"},o.title,(0,n.T)("img",{src:`/img/tool/${o.icon}.svg`})):(0,n.T)("li",{onclick:a(t.length+i+1)},o.title,(0,n.T)("img",{src:`/img/tool/${o.icon}.svg`,className:"ic"}))})),d=this.stage.history.redos(!0);s.push(...d.map(((t,e)=>{const s=h(t,!0);return(0,n.T)("li",{className:"redo",onclick:o(l.length+e+1)},s.title,(0,n.T)("img",{src:`/img/tool/${s.icon}.svg`,className:"ic"}))})));const u=function(t){switch(t){case"arrange":case"arrangeStack":return{title:(0,i.A)("historyArrange"),icon:"arrange"};case"textSettings":return{title:(0,i.A)("historyText"),icon:"text"};case"frameSettings":return{title:(0,i.A)("historyFrame"),icon:"frame"};case"shapeSettings":return{title:(0,i.A)("historyShape"),icon:"shape"};default:return{title:t,icon:t}}}(c.type);r.push((0,n.T)("li",(0,n.T)("div",{className:"history-item local "+(0===e.length?"redo":"")},(0,n.T)("div",u.title),(0,n.T)("img",{src:`/img/tool/${u.icon}.svg`,className:"ic"})),(0,n.T)("ol",{className:"history-local"},...s)))}this.list.innerHTML="",this.list.append(...r);let d=this.list.querySelector(".selected");d&&d.scrollIntoView({behavior:"auto",block:"nearest",inline:"nearest"})},this.panel=(0,n.Ay)("history-panel"),this.panel.classList.toggle("active",e),this.list=(0,n.Ay)("history-list"),new o.A((0,n.Ay)("history-panel-content")),document.addEventListener("history-update",this.render,!1),(0,n.Ay)("history-minimize").addEventListener("pointerdown",(t=>{t.stopPropagation(),(0,n.Ay)("history-panel").classList.toggle("collapse")}),!0),(0,n.Ay)("history-close").addEventListener("pointerdown",(t=>{t.stopPropagation(),document.dispatchEvent(new CustomEvent("panel-state",{detail:"history-panel"}))}),!0);const s=(0,n.T)("img",{id:"layer-panel-resize",src:"/img/icon/three-dot.svg",className:"resize ic"});(0,n.Bb)(s,this.resizeStart,this.resizeMove),this.panel.append(s),(0,n.Bb)((0,n.Ay)("history-panel-title"),this.dragStart,this.dragMove,this.dragEnd)}}function h(t,e){switch(t.type){case"addLayer":{let e="empty",s=(t.kind||"").charAt(0).toUpperCase()+(t.kind||"").substring(1);switch(t.kind){case"addimage":case"pasteimage":case"duplicateimage":e="image";break;case"addtext":case"pastetext":case"duplicatetext":e="text";break;case"addframe":case"pasteframe":case"duplicateframe":e="frame";break;case"addshape":case"pasteshape":case"duplicateshape":e="shape";break;case"addelement":case"pasteelement":case"duplicateelement":e="element"}return{title:(0,i.A)(`history${s}`),icon:e}}case"order":return{title:(0,i.A)("historyOrder"),icon:"menu"};case"textSettings":{let e="menu",s=(t.kind||"").charAt(0).toUpperCase()+(t.kind||"").substring(1);return{title:(0,i.A)("historyText"+s),icon:e}}case"textChange":return{title:(0,i.A)("historyTextChange"),icon:"menu"};case"bitmapSwitch":case"bitmapChange":{if(!t.kind)return{title:(0,i.A)("bitmapChange"),icon:"image"};if("eff"===t.kind.substr(0,3)){const e=t.kind.split(" - ")[1];return{title:(0,i.A)("historyEffect",e),icon:"effect"}}let e="menu",s=(t.kind||"").charAt(0).toUpperCase()+(t.kind||"").substring(1);switch(t.kind){case"adjust":e="adjust";break;case"transform":e="transform";break;case"distort":e="distort";break;case"shadow":case"shape":e="shape";break;case"draw":e="draw";break;case"fill":e="fill";break;case"gradient":case"lookup":e="gradient";break;case"pen":e="pen";break;case"temper":e="temper";break;case"detail":e="detail";break;case"toning":e="toning";break;case"eraser":e="eraser";break;case"clone":e="clone";break;case"liquify":e="liquify";break;case"healPatch":case"healInfill":e="heal";break;case"glitch":e="glitch";break;case"focus":e="focus";break;case"disperse":e="disperse";break;case"dispersion":e="dispersion";break;case"auto":e="auto";break;case"brightnessContrast":e="contrast";break;case"temperatureTint":e="temperature";break;case"hueSaturation":case"desaturate":e="saturation";break;case"vibrance":e="vibrance";break;case"mimicHDR":e="hdr";break;case"highlightsShadows":e="highlights";break;case"exposure":e="exposure";break;case"curves":case"levels":case"rgbSplit":e="hue";break;case"posterize":e="posterize";break;case"monochrome":e="monochrome";break;case"sharpen":e="sharpen";break;case"clarity":e="clarity";break;case"blur":case"gaussian":case"motionblur":case"zoom":e="blur";break;case"smooth":e="smooth";break;case"grain":case"noise":case"denoise":e="grain";break;case"fringe":e="fringe";break;case"vignette":e="vignette";break;case"bloom":e="bloom";break;case"glamour":e="glamour";break;case"dehaze":e="dehaze";break;case"pixelate":e="pixelate";break;case"mosaic":e="mosaic";break;case"halftone":e="halftone"}return{title:(0,i.A)(`history${s}`),icon:e}}case"crop":return{title:(0,i.A)("historyCrop"),icon:"crop"};case"straighten":return{title:(0,i.A)("historyStraighten"),icon:"crop"};case"deleteLayer":return{title:(0,i.A)(`historyDelete${t.layer.type}`),icon:"delete"};case"arrange":{let e=(t.kind||"").charAt(0).toUpperCase()+(t.kind||"").substring(1);return{title:(0,i.A)(`history${e}`),icon:"arrange"}}case"arrangeStack":{let e=(t.kind||"").charAt(0).toUpperCase()+(t.kind||"").substring(1);return{title:(0,i.A)(`historyStack${e}`),icon:"arrange"}}case"link":return{title:(0,i.A)("historyLink"+(t.kind||"").charAt(0).toUpperCase()+(t.kind||"").substring(1)),icon:"link"};case"flipLayer":case"flip":return{title:(0,i.A)("historyFlip"),icon:"menu"};case"rotateLayer":case"rotate":return{title:(0,i.A)("historyRotate"),icon:"menu"};case"layerSettings":return{title:(0,i.A)(`historyLayer${t.kind.charAt(0).toUpperCase()+t.kind.substring(1)}`),icon:"menu"};case"background":return{title:(0,i.A)("historyBackground"),icon:"picker"};case"pageSize":return{title:(0,i.A)("historyPageSize"),icon:"menu"};case"pageResize":return{title:(0,i.A)("historyPageResize"),icon:"menu"};case"mask":return{title:(0,i.A)("historyMask"),icon:"cutout"};case"maskInvert":return{title:(0,i.A)("historyMaskInvert"),icon:"cutout"};case"merge":return{title:(0,i.A)("historyMerge"),icon:"menu"};case"adjust":return{title:(0,i.A)("history"+t.kind.charAt(0).toUpperCase()+t.kind.substring(1)),icon:t.kind};case"glitch":return{title:(0,i.A)("historyGlitch"+t.kind.charAt(0).toUpperCase()+t.kind.substring(1)),icon:t.kind};case"effect":return{title:t.kind.charAt(0).toUpperCase()+t.kind.substring(1),icon:"effect"};case"selectionAndBitmapSwitch":case"selectionChange":{let e="marquee",s=t.kind;switch(t.kind){case"lasso":s="Lasso",e="lasso";break;case"wand":s="Wand",e="wand";break;case"marquee":s="Marquee",e="marquee";break;case"move":s="SelectionMove";break;case"invert":s="SelectionInvert";break;case"pixels":s="SelectionPixels";break;case"subject":s="SelectionSubject";break;case"all":s="SelectionAll";break;case"restore":s="SelectionRestore";break;case"deselect":s="Deselect";break;case"cut":s="SelectionCut";break;case"copy":s="SelectionCopy"}return{title:(0,i.A)(`history${s}`),icon:e}}case"open":return{title:(0,i.A)("historyOpen"),icon:"menu"};case"rasterize":return{title:(0,i.A)("historyRasterize"+t.kind),icon:"menu"};case"convertSelectionToMask":return{title:(0,i.A)("historyConvertSelectionToMask"),icon:"cutout"};case"convertMaskToSelection":return{title:(0,i.A)("historyConvertMaskToSelection"),icon:"marquee"};case"applyMask":return{title:(0,i.A)("historyApplyMask"),icon:"menu"};case"frameContent":{let e=(t.kind||"").charAt(0).toUpperCase()+(t.kind||"").substring(1);return{title:(0,i.A)("historyFrameContent"+e),icon:"image"}}case"frameSettings":{let e=(t.kind||"").charAt(0).toUpperCase()+(t.kind||"").substring(1);return{title:(0,i.A)("historyFrame"+e),icon:"frame"}}case"shapeSettings":{let e=(t.kind||"").charAt(0).toUpperCase()+(t.kind||"").substring(1);return{title:(0,i.A)("historyShape"+e),icon:"shape"}}case"groupSettings":{let e=(t.kind||"").charAt(0).toUpperCase()+(t.kind||"").substring(1);return{title:(0,i.A)("historyGroup"+e),icon:"group"}}}}},13791:(t,e,s)=>{s.d(e,{A:()=>v});var i=s(21742),a=s(54738),n=s(40963),o=s(82042),r=s(41915),h=s(42268),l=s(81937),c=s(13947),d=s(39989),u=s(26806),p=s(29755),g=s(93771);class m extends u.A{constructor(t){super((0,i.A)("dialogAddLayerTitle"),!0),this.rotation=0,this.maxSize=1920,this.addLayerChoice=async t=>{t.stopPropagation();let e="express"===p.Ay.product;switch(t.currentTarget.getAttribute("data")){case"text":this.stage.addText(),document.dispatchEvent(new CustomEvent("select-tool",{detail:e?"arrange":"text"})),this.stage.reform&&this.stage.reform.dblClick();break;case"image":await(0,g.XN)(!0).then((async t=>{document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));for(let e=0;e<t.length;e++)await(0,g.Tq)(this.stage,t[e],!1);document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("select-tool",{detail:"arrange"}))}));break;case"shape":this.stage.addShape(),document.dispatchEvent(new CustomEvent("select-tool",{detail:e?"arrange":"shape"}));break;case"frame":this.stage.addFrame(),document.dispatchEvent(new CustomEvent("select-tool",{detail:e?"arrange":"frame"}));break;case"empty":this.stage.addEmpty(),this.stage.notify("layerAdded")}this.cleanUp()},this.stage=t,this.dialog.style.width="500px",this.dialog.style.maxWidth="500px",this.setContent(`\n            <label class="top-0">${(0,i.A)("dialogAddLayerHL")}</label>\n\n            <ul id="add-layer-type" class="push-buttons small top-20">\n                <li id="add-layer-empty" data="empty"><img src="/img/tool/empty.svg" class="ic"><span>${(0,i.A)("empty")}</span></li>\n                <li id="add-layer-image" data="image"><img src="/img/tool/image.svg" class="ic"><span>${(0,i.A)("image")}</span></li>\n                <li id="add-layer-frame" data="frame"><img src="/img/tool/frame.svg" class="ic"><span>${(0,i.A)("frame")}</span></li>\n                <li id="add-layer-text" data="text"><img src="/img/tool/text.svg" class="ic"><span>${(0,i.A)("text")}</span></li>\n                <li id="add-layer-shape" data="shape"><img src="/img/tool/shape.svg" class="ic"><span>${(0,i.A)("shape")}</span></li>\n            </ul>\n        `),(0,h.Ay)("add-layer-empty").addEventListener("click",this.addLayerChoice,!0),(0,h.Ay)("add-layer-image").addEventListener("click",this.addLayerChoice,!0),(0,h.Ay)("add-layer-text").addEventListener("click",this.addLayerChoice,!0),(0,h.Ay)("add-layer-frame").addEventListener("click",this.addLayerChoice,!0),(0,h.Ay)("add-layer-shape").addEventListener("click",this.addLayerChoice,!0),(0,h.Ay)("dialog-apply"+this.mid).style.display="none"}}class v{constructor(t,e){this.stage=t,this.active=e,this.isDown=!1,this.isRight=!1,this.stamp=(new Date).getTime(),this.dragStart=t=>{this.p=t,this.d=new r.A(this.panel.offsetLeft,this.panel.offsetTop)},this.dragMove=t=>{this.panel.style.left=Math.round(this.d.x+(t.x-this.p.x))+"px",this.panel.style.top=Math.round(this.d.y+(t.y-this.p.y))+"px"},this.dragEnd=t=>{let e=Math.round(this.d.y+(t.y-this.p.y)),s=Math.round(this.d.x+(t.x-this.p.x));e<76&&(e=76),s<0&&(s=0),s+120>(0,h.Ay)("workspace").offsetWidth&&(s=(0,h.Ay)("workspace").offsetWidth-240),this.panel.style.left=s+"px",this.panel.style.top=e+"px"},this.resizeStart=t=>{this.d=new r.A(this.panel.clientHeight,t.y)},this.resizeMove=t=>{const e=this.d.x+(t.y-this.d.y);this.panel.style.height=(e<120?120:e)+"px"},this.activate=t=>{this.panel.classList.toggle("active",t),t&&this.panel.classList.remove("collapse"),this.active=t,this.render()},this.delay=!1,this.addLayerChoice=async t=>{if(t.stopPropagation(),!this.delay){this.delay=!0;try{switch(t.currentTarget.getAttribute("data")){case"text":this.stage.addText(),document.dispatchEvent(new CustomEvent("select-tool",{detail:"text"})),this.stage.reform&&this.stage.reform.dblClick();break;case"image":this.delay=!1,await(0,g.XN)(!0).then((async t=>{document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));for(let e=0;e<t.length;e++)await(0,g.Tq)(this.stage,t[e],!1);document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("select-tool",{detail:"arrange"}))}));break;case"shape":this.stage.addShape(),document.dispatchEvent(new CustomEvent("select-tool",{detail:"shape"}));break;case"frame":this.stage.addFrame(),document.dispatchEvent(new CustomEvent("select-tool",{detail:"frame"}));break;case"empty":this.stage.addEmpty(),this.stage.notify("layerAdded")}}catch(e){}a.sg("add-layer",500,(()=>{this.delay=!1}))}},this.changeName=()=>{this.stamp=(new Date).getTime();let t=this.stage.fresco.getLayerById(this.settingsId),e=Object.assign({},t.settings);const s=(0,h.Ay)("layer-settings-name").value;t.settings.name!==s&&(t.settings.name=s,this.stage.history.add({type:"layerSettings",kind:"name",layer:t,settings:e}),(0,h.Ay)(t.id+"-name")&&((0,h.Ay)(t.id+"-name").innerHTML=t.settings.name+"<span>"+(0,i.A)(t.type)+"</span>"))},this.changeBlendMode=()=>{this.stamp=(new Date).getTime();let t=this.stage.fresco.getLayerById(this.settingsId),e=Object.assign({},t.settings);t.settings.blendmode=(0,h.Ay)("layer-settings-blend-mode").value,this.stage.history.add({type:"layerSettings",kind:"blendMode",layer:t,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeLocked=t=>{this.stamp=(new Date).getTime();const e=(0,h.Ay)("layer-settings-locked-true").checked;this.stage.changeLocked(void 0,e)},this.changeVisible=t=>{this.stamp=(new Date).getTime();let e=this.stage.fresco.getLayerById(this.settingsId);const s=(0,h.Ay)("layer-settings-visible-true").checked;this.stage.changeVisible(e,s)},this.render=t=>{if(!this.active||!this.stage||this.stage.supressRender)return;if(this.isDown&&!this.stage.layerDrag)return;const e=(0,h.Ay)("layer-list");for(;e.lastChild;)e.removeChild(e.lastChild);if(this.stage.fresco){const t=n.A.bestFit(this.stage.fresco.width,this.stage.fresco.height,32,32),o=t.width/this.stage.fresco.width,r=this.stage.fresco.width,l=this.stage.fresco.height;let u=0;for(var s=this.stage.fresco.layers.length-1;s>=0;s--){const p=this.stage.fresco.layers[s];let g=(0,h.T)("div",{id:p.id,className:"layer"});if(p.settings.visible||g.classList.add("hidden"),g.addEventListener("mousedown",this.mouseDown,!1),g.addEventListener("touchstart",this.touchStart,{passive:!1}),u>0&&(g.classList.add("member"),u--),e.appendChild(g),p instanceof c.A){p.groupSettings.collapsed?(s-=3,g.classList.add("collapsed")):u=3,g.classList.add("group");let t=(0,h.T)("div",{className:"arrow"});t.addEventListener("mousedown",(t=>{t.stopPropagation(),t.preventDefault()}),!0),t.addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault(),this.stage.changeCollapsed(p)}),!1),g.append(t,(0,h.T)("div",{id:p.id+"-name",className:"name"},p.settings.name))}else{let e=a.VI(t.width,t.height);if(p.canvas){let s=e.getContext("2d");if(p.rect.width/r>.5||p.rect.height/l>.5)s.scale(o,o),this.stage.renderLayer(s,p,!0);else{s.translate(t.width/2,t.height/2),s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high",s.rotate(p.rect.rotation*Math.PI/180);const e=n.A.bestFit(p.rect.width,p.rect.height,t.width-8,t.height-8);s.drawImage(p.baked?p.baked:p.canvas,-e.width/2,-e.height/2,Math.max(e.width,1),Math.max(e.height,1))}}g.appendChild((0,h.T)("div",{className:"vertical-align thumb"},e)),g.appendChild((0,h.T)("div",{id:p.id+"-name",className:"name"},p.settings.name,(0,h.T)("span",(0,i.A)(p.type))))}if(p.settings.locked&&!p.settings.visible||!p.settings.locked){const t=(0,h.T)("img",{className:"visibility ic",title:p.settings.visible?(0,i.A)("visible"):(0,i.A)("hidden"),src:p.settings.visible?"/img/icon/visible.svg":"/img/icon/hidden.svg"});t.addEventListener("mousedown",(t=>{t.stopPropagation(),t.preventDefault()}),!0),t.addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault(),this.stage.changeVisible(p,!p.settings.visible)}),!1),g.appendChild((0,h.T)("div",{className:"right"},t))}else{let t=(0,h.T)("img",{src:"/img/icon/locked.svg",className:"locked ic",title:(0,i.A)("locked")});t.addEventListener("mousedown",(t=>{t.stopPropagation(),t.preventDefault()}),!0),t.addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault(),this.stage.changeLocked(p,!1)}),!1),g.appendChild((0,h.T)("div",{className:"right"},t))}let m=(0,h.T)("div",{className:"icons"});if(g.appendChild(m),p.animation){const t=(0,h.T)("img",{src:p.animation.block?"/img/icon/animation/none.svg":"/img/icon/animation/animation.svg",title:(0,i.A)("animation"),className:"animation ic"});t.addEventListener("mousedown",(()=>{document.dispatchEvent(new CustomEvent("panel-animation"))})),m.appendChild(t)}if(p instanceof d.A&&p.hasMask()){const t=(0,h.T)("img",{src:"/img/icon/mask.svg",title:(0,i.A)("hasCutout"),className:"cutout ic"});t.addEventListener("mousedown",(()=>{document.dispatchEvent(new CustomEvent("select-tool",{detail:"cutout"}))})),t.addEventListener("dblclick",(()=>{this.stage.maskApply()})),m.appendChild(t)}p.settings.link&&""!==p.settings.link&&(m.appendChild((0,h.T)("img",{src:"/img/icon/linked.svg",title:(0,i.A)("linked"),className:"linked ic"})),g.classList.add(p.settings.link))}this.markSelected(!1)}},this.markSelected=(t=!0)=>{var e;if("block"===(0,h.Ay)("layer-settings").style.display&&this.hideSettings(),this.stage&&this.stage.fresco&&(0,h.Ay)("layer-panel")){if(t){const t=(0,h.Ay)("layer-list").getElementsByClassName("layer");for(let e=0;e<t.length;e++)t[e].classList.remove("haslink","selected")}const s=this.stage.fresco.getSelectedStack();for(let t of s)if(null===(e=(0,h.Ay)(t.id))||void 0===e||e.classList.add("selected"),t.hasLink()){const e=(0,h.Ay)("layer-list").getElementsByClassName(t.settings.link);for(let t=0;t<e.length;t++)e[t].classList.add("haslink")}let i=this.stage.fresco.numSelected()>1;1===this.stage.fresco.numSelected()&&this.stage.fresco.getSelected().hasLink()&&(i=!0),(0,h.Ay)("layer-panel-link").style.display=i?"block":"none",(0,h.Ay)("layer-panel-more").style.display=1===s.length?"block":"none"}},this.settingsId="",this.showSettings=t=>{let e=this.stage.fresco.getSelected();e&&e.id!==this.settingsId?((0,h.Ay)("layer-settings").style.display="block",this.settingsId=e.id,this.opacity.setValue(e.settings.opacity),(0,h.Ay)("layer-settings-name").value=e.settings.name,(0,h.Ay)("layer-settings-blend-mode").value=e.settings.blendmode,(0,h.Ay)("layer-settings-visible-true").checked=e.settings.visible,(0,h.Ay)("layer-settings-visible-false").checked=!e.settings.visible,(0,h.Ay)("layer-settings-locked-true").checked=e.settings.locked,(0,h.Ay)("layer-settings-locked-false").checked=!e.settings.locked,window.requestAnimationFrame((()=>{if(t){const t=32,s=(0,h.Ay)("layer-settings").getBoundingClientRect(),i=a.oR(this.panel).y,n=a.oR((0,h.Ay)(e.id)).y,o=(0,h.Ay)("layer-panel-content-ss-content").scrollTop;let r=n-i+(0,h.Ay)("panel-bar").clientTop-o;i+r+s.height>(0,h.Ay)("workspace").clientHeight&&(r=(0,h.Ay)("workspace").clientHeight-i-s.height-4),(0,h.Ay)("layer-settings").style.top=r-t+"px"}else(0,h.Ay)("layer-settings").style.top="-12px"}))):this.hideSettings(!0)},this.hideSettings=(t=!1)=>{!t&&(new Date).getTime()-this.stamp<300||(this.settingsId="",(0,h.Ay)("layer-settings").style.display="none",document.dispatchEvent(new CustomEvent("layer-arrange")))},this.touchStart=t=>{1!==t.touches.length&&(t.preventDefault(),t.stopPropagation(),this.down(t.touches[0].clientX,t.touches[0].clientY,t.currentTarget,t.shiftKey||t.ctrlKey),this.stage.fresco.getSelected()&&(document.addEventListener("touchmove",this.touchMove,{passive:!1}),document.addEventListener("touchend",this.touchEnd,{passive:!1})))},this.touchMove=t=>{1!==t.touches.length&&(t.preventDefault(),t.stopPropagation(),this.move(t.touches[0].clientX,t.touches[0].clientY))},this.touchEnd=t=>{t.preventDefault(),t.stopPropagation(),this.up(t.touches[0].clientX,t.touches[0].clientY),document.removeEventListener("touchmove",this.touchMove),document.removeEventListener("touchend",this.touchEnd)},this.mouseDown=t=>{if("INPUT"!==document.activeElement.nodeName&&"SELECT"!==document.activeElement.nodeName){if(t.stopPropagation(),this.down(t.clientX,t.clientY,t.currentTarget,t.shiftKey||t.ctrlKey),t.button>0)return this.stamp=(new Date).getTime(),void this.showSettings(t);this.stage.fresco.getSelected()&&(document.addEventListener("mousemove",this.mouseMove,!0),document.addEventListener("mouseup",this.mouseUp,!0),(0,h.Ay)("layer-panel").classList.add("down"),this.isDown=!0)}},this.mouseMove=t=>{t.button>0||(t.stopPropagation(),this.move(t.clientX,t.clientY))},this.mouseUp=t=>{t.stopPropagation(),this.up(t.clientX,t.clientY),document.removeEventListener("mousemove",this.mouseMove,!0),document.removeEventListener("mouseup",this.mouseUp,!0)},this.down=(t,e,s,i)=>{this.downY=e,this.heightY=(0,h.Ay)("layer-panel-content-ss-content").scrollHeight,(i||this.stage.fresco.isSelectedStack()||!this.stage.fresco.isSelectedById(s.id))&&(i&&this.stage.fresco.isSelectedById(s.id)?this.stage.unselectLayerById(s.id):this.stage.selectLayerById(s.id,i,!0))},this.pointInLayerPanel=(t,e)=>{const s=(0,h.Ay)("layer-list").getBoundingClientRect();return t>=s.x&&t<=s.x+s.width&&e>=s.y&&e<=s.y+s.height},this.move=(t,e)=>{const s=(0,h.Ay)("layer-list");if(!this.pointInLayerPanel(t,e)){if(this.ghost){this.ghost.classList.remove("ghost"),this.ghost.style.left="unset",this.ghost.style.top="unset",this.ghostFill.remove();const t=this.stage.fresco.layers.length-this.stage.fresco.selectedLayerNr()-1;s.children[t].before(this.ghost),this.ghost=null,this.ghostFill=null}if(!this.stage.layerDrag){const s=this.stage.fresco.getSelected(),i=(0,h.Ay)(s.id);this.stage.layerDrag={fresco:this.stage.fresco.id,layer:s,node:(0,h.T)("div",{className:"grabbed-layer"},(0,h.T)("div",{className:"thumb"},a.oM(i.querySelector("canvas"))),(0,h.T)("div",s.settings.name)),position:new r.A(t,e),blocked:this.stage.fresco.block},this.stage.workspace.append(this.stage.layerDrag.node),document.body.style.cursor="move"}const i=this.stage.layerDrag.node.getBoundingClientRect();return this.stage.layerDrag.node.style.left=t-i.width/2+"px",this.stage.layerDrag.node.style.top=e-i.height/2+"px",this.stage.layerDrag.position=new r.A(t,e),void document.dispatchEvent(new CustomEvent("layer-drag-move"))}if(this.stage.layerDrag){if(this.stage.coating.clear(),document.body.style.cursor="unset",this.stage.layerDrag.fresco!==this.stage.fresco.id){const s=this.stage.layerDrag.node.getBoundingClientRect();return this.stage.layerDrag.node.style.left=t-s.width/2+"px",this.stage.layerDrag.node.style.top=e-s.height/2+"px",void(this.stage.layerDrag.position=new r.A(t,e))}this.stage.layerDrag.node.remove(),this.stage.layerDrag=null}this.ghost||(this.ghost=(0,h.Ay)(this.stage.fresco.getSelected().id),this.startY=this.ghost.offsetTop-1,this.ghost.style.left=this.ghost.offsetLeft+"px",this.ghostFill=document.createElement("div"),this.ghostFill.id="ghost-fill",this.ghost.before(this.ghostFill),this.ghost.classList.add("ghost"),s.appendChild(this.ghost)),-1===this.startY&&(this.startY=this.ghost.offsetTop-4,this.downY=e),this.ghost.style.top=this.startY-(this.downY-e)+"px",this.moveGhostFill(),window.clearTimeout(this.auto);let i=(0,h.Ay)("layer-panel-content-ss-content");this.ghost.offsetTop<i.scrollTop-5?this.autoScroll(-20):this.ghost.offsetTop+this.ghost.offsetHeight>i.scrollTop+i.offsetHeight+5&&this.autoScroll(20)},this.moveGhostFill=()=>{this.ghost.offsetTop>this.ghostFill.offsetTop+this.ghostFill.offsetHeight/2+2?this.ghostFill.nextElementSibling.classList.contains("selected")||this.ghostFill.nextElementSibling.after(this.ghostFill):this.ghost.offsetTop<this.ghostFill.offsetTop-this.ghostFill.offsetHeight/2-2&&this.ghostFill.previousElementSibling&&this.ghostFill.previousElementSibling.before(this.ghostFill)},this.autoScroll=t=>{window.clearTimeout(this.auto);const e=(0,h.Ay)("layer-panel-content-ss-content"),s=()=>{this.ghost&&(t<0&&e.scrollTop>10||t>0&&e.scrollTop+10<this.heightY-e.clientHeight)&&(this.startY=-1,e.scrollTop+=t,this.ghost.style.top=this.ghost.offsetTop-1+t+"px",this.moveGhostFill(),this.auto=window.setTimeout(s,80))};this.auto=window.setTimeout(s,80)},this.up=(t,e)=>{this.isDown=!1,(0,h.Ay)("layer-panel").classList.remove("down"),document.body.style.cursor="unset",this.stage.layerDrag&&(this.pointInLayerPanel(t,e)||document.dispatchEvent(new CustomEvent("layer-drag-drop")),this.stage.layerDrag.node.remove(),this.stage.layerDrag=void 0),this.ghost&&(this.ghost.classList.remove("ghost"),this.ghost.style.left="0px",this.ghost.style.top="0px",this.ghostFill.before(this.ghost),this.ghostFill.remove(),this.ghost=void 0,this.ghostFill=void 0);let s=this.stage.fresco.selectedLayerNr(),i=(0,h.Ay)("layer-list").getElementsByClassName("layer");const a=this.stage.fresco.getSelected();for(var n=0;n<i.length;n++)if(i[n].id===a.id){let t=i.length-n-1;t!=s&&this.stage.changeOrder(s,t);break}},this.panel=(0,h.Ay)("layer-panel"),this.panel.classList.toggle("active",e),document.addEventListener("layerlist-update",(()=>this.render()),!0),document.addEventListener("layer-select",(()=>this.markSelected()),!1),(0,h.Ay)("layer-panel-add").addEventListener("click",(()=>new m(this.stage)),!1),(0,h.Ay)("layer-panel-link").addEventListener("click",(()=>this.stage.linkLayer()),!1),(0,h.Ay)("layer-panel-group").addEventListener("click",(()=>this.stage.addGroup()),!1),(0,h.Ay)("layer-panel-copy").addEventListener("click",(()=>this.stage.duplicateLayer()),!1),(0,h.Ay)("layer-panel-delete").addEventListener("click",(()=>this.stage.deleteLayer()),!1),(0,h.Ay)("layer-panel-more").addEventListener("click",(t=>this.showSettings()),!0),(0,h.Ay)("layer-panel-more").addEventListener("pointerdown",(t=>{t.preventDefault(),t.stopPropagation()}),!0),(0,h.Ay)("layer-settings-name").addEventListener("blur",this.changeName,!1),(0,h.Ay)("layer-settings-name").addEventListener("keydown",(t=>{"Enter"===t.key&&(t.currentTarget.blur(),this.hideSettings(!0))}),!0),(0,h.Ay)("layer-settings-close").addEventListener("click",(()=>this.hideSettings(!0)),!1),(0,h.Ay)("layer-settings-blend-mode").addEventListener("change",this.changeBlendMode,!1),(0,h.Ay)("layer-settings-visible-false").addEventListener("click",this.changeVisible,!1),(0,h.Ay)("layer-settings-visible-true").addEventListener("click",this.changeVisible,!1),(0,h.Ay)("layer-settings-locked-false").addEventListener("click",this.changeLocked,!1),(0,h.Ay)("layer-settings-locked-true").addEventListener("click",this.changeLocked,!1),(0,h.Ay)("layer-settings-merge-down").addEventListener("click",(()=>this.stage.mergeDown()),!1),(0,h.Ay)("layer-settings-merge-visible").addEventListener("click",(()=>this.stage.mergeVisible()),!1),(0,h.Ay)("layer-settings-merge-flatten").addEventListener("click",(()=>this.stage.mergeFlatten()),!1),(0,h.Ay)("layer-panel-add-frame").addEventListener("click",this.addLayerChoice,!0),(0,h.Ay)("layer-panel-add-text").addEventListener("click",this.addLayerChoice,!0),(0,h.Ay)("layer-panel-add-image").addEventListener("click",this.addLayerChoice,!0),(0,h.Ay)("layer-panel-add-shape").addEventListener("click",this.addLayerChoice,!0),(0,h.Ay)("layer-panel-add-empty").addEventListener("click",this.addLayerChoice,!0),this.opacity=new o.A("layer-settings-opacity",{defaultValue:1,label:(0,i.A)("opacity"),labelFormat:t=>(100*t).toFixed(0),labelParse:t=>parseInt(t,10)/100,onChange:t=>{this.stage.fresco.getLayerById(this.settingsId).settings.opacity=t,document.dispatchEvent(new CustomEvent("viewport-render"))},onEnd:(t,e)=>{this.stamp=(new Date).getTime();let s=this.stage.fresco.getLayerById(this.settingsId);this.stage.history.add({type:"layerSettings",kind:"opacity",layer:s,settings:Object.assign(Object.assign({},s.settings),{opacity:e})})}}),new l.A((0,h.Ay)("layer-panel-content")),(0,h.Ay)("layer-panel-content").oncontextmenu=t=>(t.preventDefault(),t.stopPropagation(),!1),(0,h.Ay)("layer-minimize").addEventListener("pointerdown",(t=>{t.stopPropagation(),(0,h.Ay)("layer-panel").classList.toggle("collapse")}),!0),(0,h.Ay)("layer-close").addEventListener("pointerdown",(t=>{t.stopPropagation(),document.dispatchEvent(new CustomEvent("panel-state",{detail:"layer-panel"}))}),!0);const s=(0,h.T)("img",{id:"layer-panel-resize",src:"/img/icon/three-dot.svg",className:"resize ic"});(0,h.Bb)(s,this.resizeStart,this.resizeMove),this.panel.append(s),(0,h.Bb)((0,h.Ay)("layer-panel-title"),this.dragStart,this.dragMove,this.dragEnd)}}},44146:(t,e,s)=>{s.d(e,{A:()=>o});var i=s(42268),a=s(40963),n=s(41915);class o{constructor(t,e){this.stage=t,this.active=e,this.isMouseDown=!1,this.dragStart=t=>{this.p=t,this.d=new n.A(this.panel.offsetLeft,this.panel.offsetTop)},this.dragMove=t=>{this.panel.style.left=Math.round(this.d.x+(t.x-this.p.x))+"px",this.panel.style.top=Math.round(this.d.y+(t.y-this.p.y))+"px"},this.dragEnd=t=>{let e=Math.round(this.d.y+(t.y-this.p.y)),s=Math.round(this.d.x+(t.x-this.p.x));e<76&&(e=76),s<0&&(s=0),s+120>(0,i.Ay)("workspace").offsetWidth&&(s=(0,i.Ay)("workspace").offsetWidth-240),this.panel.style.left=s+"px",this.panel.style.top=e+"px"},this.activate=t=>{this.panel.classList.toggle("active",t),t&&this.panel.classList.remove("collapse"),this.active=t,this.render()},this.render=()=>{if(!this.stage||!this.stage.fresco)return this.back.width=1,this.back.height=1,void(this.navh.innerText=this.navw.innerText="");if(this.active&&!this.isMouseDown&&!this.stage.supressRender){this.viewport=a.A.bestFit(this.stage.fresco.width,this.stage.fresco.height,140,120),this.scale=this.viewport.width/this.stage.fresco.width,this.nav.style.width=this.viewport.width+2+"px",this.nav.style.height=this.viewport.height+2+"px",this.back.width=this.viewport.width,this.back.height=this.viewport.height;var t=this.back.getContext("2d");t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high",this.stage.getOutputCanvas(this.stage.fresco,this.scale,void 0,t),t=void 0,this.position()}},this.position=()=>{if(this.active&&this.stage&&this.stage.fresco){let t=this.viewport.width,e=this.viewport.height,s=0,i=0;t=Math.round(this.back.width*(this.stage.viewClip.width/(this.stage.fresco.width*this.stage.zoom))),e=Math.round(this.back.height*(this.stage.viewClip.height/(this.stage.fresco.height*this.stage.zoom))),s=-Math.round((this.stage.offset.x<0?this.stage.offset.x/this.stage.zoom:0)*this.scale),i=-Math.round((this.stage.offset.y<0?this.stage.offset.y/this.stage.zoom:0)*this.scale),this.marker.style.width=t+"px",this.marker.style.height=e+"px",this.marker.style.left=s+"px",this.marker.style.top=i+"px",this.setSelectionOrImageSize()}},this.mouseCord=t=>{if(!this.active||!this.stage.fresco)return;let e=t.detail;e&&this.stage&&e.x>-1&&e.y>-1&&e.x<this.stage.fresco.width&&e.y<this.stage.fresco.height?(this.navx.innerText=e.x.toString(),this.navy.innerText=e.y.toString()):(this.navx.innerText="",this.navy.innerText="")},this.setSelectionOrImageSize=()=>{this.stage.fresco.hasSelection()?(this.navw.innerText=this.stage.fresco.selection.bounds.width.toString(),this.navh.innerText=this.stage.fresco.selection.bounds.height.toString()):(this.navw.innerText=this.stage.fresco.width.toString(),this.navh.innerText=this.stage.fresco.height.toString())},this.backDown=t=>{t.stopPropagation();let e=this.back.getBoundingClientRect(),s=this.stage.fresco.width/this.back.width;this.stage.setAnchor(new n.A(Math.round((t.clientX-e.x)*s),Math.round((t.clientY-e.y)*s))),this.stage.updateViewport()},this.touchStart=t=>{t.preventDefault(),t.stopPropagation(),this.down(t.changedTouches[0].clientX,t.changedTouches[0].clientY),document.addEventListener("touchmove",this.touchMove,{passive:!1}),document.addEventListener("touchend",this.touchEnd,{passive:!1})},this.touchMove=t=>{t.preventDefault(),t.stopPropagation(),this.move(t.changedTouches[0].clientX,t.changedTouches[0].clientY)},this.touchEnd=t=>{t.preventDefault(),t.stopPropagation(),this.up(t.changedTouches[0].clientX,t.changedTouches[0].clientY),document.removeEventListener("touchmove",this.touchMove),document.removeEventListener("touchend",this.touchEnd)},this.mouseDown=t=>{t.stopPropagation(),this.down(t.clientX,t.clientY),document.addEventListener("mousemove",this.mouseMove,!0),document.addEventListener("mouseup",this.mouseUp,!0)},this.mouseMove=t=>{t.stopPropagation(),this.move(t.clientX,t.clientY)},this.mouseUp=t=>{t.stopPropagation(),this.up(t.clientX,t.clientY),document.removeEventListener("mousemove",this.mouseMove,!0),document.removeEventListener("mouseup",this.mouseUp,!0)},this.down=(t,e)=>{this.isMouseDown=!0,this.downPoint=new n.A(t,e),this.downPosition=new n.A(this.marker.offsetLeft,this.marker.offsetTop)},this.move=(t,e)=>{let s=this.downPosition.x+(t-this.downPoint.x),i=this.downPosition.y+(e-this.downPoint.y);this.stage.setAnchor(new n.A(Math.round((s+this.marker.clientWidth/2)/this.scale),Math.round((i+this.marker.clientHeight/2)/this.scale))),this.stage.updateViewport()},this.up=(t,e)=>{this.isMouseDown=!1},this.panel=(0,i.Ay)("navigator-panel"),this.panel.classList.toggle("active",e),this.viewport=new a.A,this.nav=(0,i.Ay)("zoom-nav"),this.back=(0,i.Ay)("zoom-nav-back"),this.marker=(0,i.Ay)("zoom-nav-marker"),this.navx=(0,i.Ay)("nav-cord-x"),this.navy=(0,i.Ay)("nav-cord-y"),this.navw=(0,i.Ay)("nav-size-w"),this.navh=(0,i.Ay)("nav-size-h"),this.marker.addEventListener("mousedown",this.mouseDown,!1),this.marker.addEventListener("touchstart",this.touchStart,{passive:!1}),this.back.addEventListener("mousedown",this.backDown,!1),(0,i.Ay)("zoom-out").addEventListener("click",(()=>this.stage.setZoomStep(!1)),!1),(0,i.Ay)("zoom-in").addEventListener("click",(()=>this.stage.setZoomStep(!0)),!1),(0,i.Ay)("zoom-input").addEventListener("input",(()=>{const t=Number.parseFloat((0,i.Ay)("zoom-input").value.replace("%",""))/100;t>0&&this.stage.setZoom(t.toString())}),!1),(0,i.Ay)("zoom-input").addEventListener("blur",(()=>{(0,i.Ay)("zoom-input").value=Math.round(100*this.stage.zoom)+"%"}),!1),(0,i.Ay)("zoom-slider").addEventListener("input",(()=>{let t=Number.parseFloat((0,i.Ay)("zoom-slider").value),e=1;e=t<=40?.1+t/40*.9:t<=75?1+(t-40)/35*4:5+(t-75)/25*45,this.stage.setZoom(e.toString())}),!1),document.addEventListener("zoom-change",(()=>{(0,i.Ay)("zoom-input")!==document.activeElement&&((0,i.Ay)("zoom-input").value=Math.round(100*this.stage.zoom)+"%");let t=this.stage.zoom,e=(0,i.Ay)("zoom-slider");e.value=t<=1?Math.round(40*(t-.1)).toString():t<=5?Math.round(40+(t-1)/4*35).toString():Math.round(75+(t-5)/45*25).toString()})),(0,i.Ay)("navigator-minimize").addEventListener("pointerdown",(t=>{t.stopPropagation(),(0,i.Ay)("navigator-panel").classList.toggle("collapse")}),!0),(0,i.Ay)("navigator-close").addEventListener("pointerdown",(t=>{t.stopPropagation(),document.dispatchEvent(new CustomEvent("panel-state",{detail:"navigator-panel"}))}),!0),document.addEventListener("mouse-cord",this.mouseCord),document.addEventListener("viewport-update",this.position),document.addEventListener("layerlist-update",this.render),(0,i.Bb)((0,i.Ay)("navigator-panel-title"),this.dragStart,this.dragMove,this.dragEnd)}}},46207:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(42268),a=s(41915),n=s(21079),o=s(21742);class r{constructor(t){this.web=t,this.resize=()=>{this.bar.style.left=this.web.stage.raster.offsetLeft+"px",this.bar.style.width=this.web.stage.raster.offsetWidth+"px"},this.handleTabContextMenu=(t,e)=>{t.preventDefault(),t.stopPropagation(),new n.Ay(new a.A(t.clientX,t.clientY),[new n.kt((0,o.A)("close"),(()=>{this.web.tabClose(e)})),new n.kt((0,o.A)("closeAll"),(()=>{this.web.tabCloseAll()})),new n.kt((0,o.A)("closeOthers"),(()=>{this.web.tabCloseOthers(e)})),new n.K5,new n.kt((0,o.A)("duplicate"),(()=>{this.web.tabDuplicate(e)})),new n.K5,new n.kt((0,o.A)("save"),(()=>{this.web.tabSave(e)})),new n.kt((0,o.A)("saveAsPZX"),(()=>{this.web.tabSave(e,"pxz")})),new n.kt((0,o.A)("quickExportPNG"),(()=>{this.web.tabQuickExport(e)}))])},this.render=()=>{if(this.tabs.innerHTML="",this.web.stage.showTabs){this.bar.style.display="block",this.resize();for(let t=0;t<this.web.stage.tabs.length;t++){const e=this.web.stage.tabs[t].fresco;if(this.web.stage.fresco&&e.id===this.web.stage.fresco.id){const t=(0,i.T)("li",{id:e.id,title:e.name,className:"active",oncontextmenu:t=>this.handleTabContextMenu(t,e.id)},e.name,(0,i.T)("img",{className:"close ic",width:10,height:10,src:"/img/icon/close.svg",onclick:()=>{this.web.tabClose(e.id)}}));this.tabs.appendChild(t)}else{let t;const s=(0,i.T)("li",{id:e.id,title:e.name,onclick:()=>this.web.tabSelect(e.id),onmouseenter:()=>{this.web.stage.layerDrag&&!this.web.stage.layerDrag.blocked&&(s.classList.add("countup"),t=window.setTimeout((()=>this.web.tabSelect(e.id)),300))},onmouseleave:()=>{window.clearTimeout(t),t=void 0,s.classList.remove("countup")},oncontextmenu:t=>this.handleTabContextMenu(t,e.id)},e.name,(0,i.T)("img",{className:"close ic",src:"/img/icon/close.svg",width:10,height:10,onclick:()=>this.web.tabClose(e.id)}));this.tabs.appendChild(s)}}}else this.bar.style.display="none"},this.tabs=(0,i.T)("ul",{id:"tabs"}),this.bar=(0,i.T)("div",{id:"tab-bar"},this.tabs,(0,i.T)("div",{id:"tabs-drop"},(0,i.T)("img",{src:"/img/icon/tabs.svg",className:"ic",width:18,height:18,loading:"lazy"}))),(0,i.Ay)("workspace").appendChild(this.bar),this.bar.style.display="none",(0,i.Ay)("tabs-drop").addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();const e=t.currentTarget.getBoundingClientRect(),s=new Array;for(let i=0;i<this.web.stage.tabs.length;i++){const t=this.web.stage.tabs[i].fresco;s.push(new n.kt(t.name,(()=>this.web.tabSelect(t.id))))}new n.Ay(new a.A(e.x+25,e.y+16),s,!0)})),document.addEventListener("fresco-select",this.render),document.addEventListener("resize",this.resize)}}},40562:(t,e,s)=>{s.a(t,(async(t,i)=>{try{s.d(e,{A:()=>R});var a=s(21742),n=s(42268),o=s(54738),r=s(53900),h=s(40963),l=s(98244),c=s(41915),d=s(59857),u=s(93771),p=s(52040),g=s(63306),m=s(30973),v=s(79453),y=s(9720),f=s(53198),w=s(37699),x=s(89209),b=s(68187),A=s(28754),k=s(82857),S=s(51668),E=s(16377),C=s(80953),T=s(97266),L=s(21079),M=s(3514),P=s(29755),D=s(66718),z=s(16499),I=s(82355),F=t([I]);I=(F.then?(await F)():F)[0];var _=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,s=t[Symbol.asyncIterator];return s?s.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(s){e[s]=t[s]&&function(e){return new Promise((function(i,a){(function(t,e,s,i){Promise.resolve(i).then((function(e){t({value:e,done:s})}),e)})(i,a,(e=t[s](e)).done,e.value)}))}}};class R{constructor(){var t,e,s,i,F;this.navigate=t=>{"editor"===t?this.hideSplash():"home"===t&&this.showSplash()},this.showSplash=()=>{(0,n.Ay)("splash-close").style.display=this.stage.fresco?"block":"none",(0,n.Ay)("splash").style.display="flex",this.setHistory()},this.hideSplash=()=>{var t;(0,n.Ay)("splash").style.display="none",null===(t=(0,n.Ay)("modal-deeplink"))||void 0===t||t.remove()},this.setUpSplash=()=>{var t,e,s,i,a,o;null===(t=(0,n.Ay)("splash"))||void 0===t||t.addEventListener("click",(t=>{this.stage.tabs.length>0&&t.target===(0,n.Ay)("splash")&&this.hideSplash()})),null===(e=(0,n.Ay)("splash-close"))||void 0===e||e.addEventListener("mousedown",this.hideSplash,!0),null===(s=(0,n.Ay)("splash-file-menu"))||void 0===s||s.addEventListener("click",this.fileMenu,!0),null===(i=(0,n.Ay)("splash-drop-icon"))||void 0===i||i.addEventListener("mousedown",this.openClick,!0),null===(a=(0,n.Ay)("splash-open-image"))||void 0===a||a.addEventListener("mousedown",this.openClick,!0),null===(o=(0,n.Ay)("splash-open-new"))||void 0===o||o.addEventListener("mousedown",this.newClick,!0)},this.fileMenu=()=>{var t,e,s,i,a;const o=new p.A((0,n.Ay)("splash-file-menu"),"down");o.setContent('\n            <ul class="option-list medium">\n                <li id="splash-file-stock"><img src="/img/tool/zoom.svg" class="ic">Stock photo search</li>\n                <li id="splash-file-template"><img src="/img/icon/template.svg" class="ic">Find template</li>\n                <li id="splash-file-generator"><img src="/img/tool/generator.svg" class="ic">AI image generator</li>\n                <li id="splash-file-paste"><img src="/img/icon/clipboard.svg" class="ic">Paste from clipboard</li>\n                <li id="splash-file-url"><img src="/img/icon/link.svg" class="ic">Load image from URL</li>\n            </ul>\n        '),null===(t=(0,n.Ay)("splash-file-stock"))||void 0===t||t.addEventListener("mousedown",(()=>{new f.A(this.stage),o.cleanUp()}),!0),null===(e=(0,n.Ay)("splash-file-template"))||void 0===e||e.addEventListener("mousedown",(()=>{window.location.href="/designer/template/",o.cleanUp()}),!0),null===(s=(0,n.Ay)("splash-file-generator"))||void 0===s||s.addEventListener("mousedown",(()=>{window.location.href="/image-generator/",o.cleanUp()}),!0),null===(i=(0,n.Ay)("splash-file-paste"))||void 0===i||i.addEventListener("mousedown",(()=>{this.pasteActivatedFromMenu(),o.cleanUp()}),!0),null===(a=(0,n.Ay)("splash-file-url"))||void 0===a||a.addEventListener("mousedown",(()=>{this.urlClick(),o.cleanUp()}),!0)},this.setUpDeepLink=()=>{const t=(0,n.T)("div",{className:"button large positive rounded top-50",style:"min-width:250px"},(0,a.A)("openImage")),e=(0,n.T)("div",{className:"link"},(0,a.A)("close")),s=(0,n.T)("div",{id:"modal-deeplink",className:"modal dim",style:"flex-direction:column;gap:20px;align-items:center;"});s.innerHTML='<svg id="icon-deeplink" style="opacity:0.6;cursor:pointer" width="200" height="200" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" class="ic">\n                <path fill="#fff" d="m2.4181 18.932-.88153-2.6572c-.15261-.47904-.11194-.99876.11334-1.4482.22542-.44773.61956-.78751 1.0956-.9445l10.376-3.6535c1.0084-.31165 2.0787.2517 2.3927 1.2593l2.5187 7.6819-3.3372-1.2593c-.30284-.11333-.64271.01615-.79338.30224l-2.8713 5.6922-2.6194-1.2593c-.25747-.12309-.56528-.061529-.7556.15112l-3.0217 2.8349-1.3349-4.1054zm13.599-11.504 2.2046-4.1762c.48035-.90871 1.5959-1.2713 2.5187-.81856l8.9412 4.6343c.44898.23275.785.63688.9319 1.1208.15189.4749.11119.99045-.11334 1.4356l-3.778 7.1908-1.3979-3.2994c-.12273-.30199-.45918-.45643-.76819-.35261l-6.5233 2.0779-1.423-4.2565c-.26042-.79413-.82707-1.4514-1.5742-1.826-.74599-.37996-1.6147-.43909-2.4053-.16371l-10.275 3.6283c-.79626.25664-1.4549.82441-1.826 1.5742-.39061.74691-.45443 1.6222-.17631 2.4179l.86894 2.7201.89412 2.5942 2.6068 7.8204c.26042.79413.82707 1.4514 1.5742 1.826.43924.21468.92155.32664 1.4104.32743.33841.001.67464-.05428.99487-.16371l10.364-3.6409c.79626-.25664 1.4549-.82441 1.826-1.5742.39061-.74691.45443-1.6222.17631-2.4179l-.10074-.30224h.06297c1.544.79997 3.4442.19665 4.2439-1.3475l6.3722-12.291c.79997-1.544.19665-3.4442-1.3475-4.2439l-8.9412-4.6343c-1.544-.79997-3.4442-.19665-4.2439 1.3475l-2.2046 4.2139m9.5717 7.6741 1.5742 3.778-1.889 3.6395c-.48035.90871-1.5959 1.2713-2.5187.81856l-1.2593-.62966-1.889-5.6796zm-4.7099 11.435c-.22542.44773-.61956.78751-1.0956.9445l-10.376 3.6535c-.97969.33024-2.0446-.17712-2.4053-1.146l-.7556-2.4053 3.1477-3.0994 2.7453 1.3727c.1533.06298.32524.06298.47854 0 .16013-.04975.29241-.16378.3652-.31483l2.9342-5.8559 3.778 1.4734.71782 2.1409.60448 1.7882c.14485.4823.09513 1.0021-.13853 1.4482zM8.4285 2.461h.61539v.61539a.61539.61539 0 0 0 1.2308 0V2.461h.61539a.61539.61539 0 0 0 0-1.2308h-.61539V.61481a.61539.61539 0 0 0-1.2308 0v.61539H8.4285a.61539.61539 0 0 0 0 1.2308zM24.429 29.538h-.61539v-.61539a.61539.61539 0 0 0-1.2308 0v.61539h-.61539a.61539.61539 0 0 0 0 1.2308h.61539v.61539a.61539.61539 0 0 0 1.2308 0v-.61539h.61539a.61539.61539 0 0 0 0-1.2308zM3.6591 7.6918a2 2 0 1 0-2-2 2 2 0 0 0 2 2zm0-3a1 1 0 1 1-1 1 1 1 0 0 1 1-1zM29 23a2 2 0 1 0 2 2 2 2 0 0 0-2-2zm0 3a1 1 0 1 1 1-1 1 1 0 0 1-1 1z"></path>\n                <circle cx="6.0883" cy="17.303" r="1.875" fill="#fff"></circle>\n                <circle cx="20.641" cy="8.0821" r="1.875" fill="#fff"></circle>\n            </svg>',s.append(t,e),document.body.append(s),t.addEventListener("click",(()=>{this.openClick()})),e.addEventListener("click",(()=>{this.showSplash(),s.remove()})),(0,n.Ay)("icon-deeplink").addEventListener("click",(()=>{this.openClick()}))},this.setHistory=async()=>{const t=(0,n.Ay)("splash-open-quick");t.innerHTML="";const e=(0,n.Ay)("history-content");e.innerHTML="";const s=await C.l.history();if((0,n.Ay)("splash-content-history").style.display=s.length>0?"block":"none",s.length>0){for(var i=0;i<s.length&&i<3;i++){const e=s[i],a=(0,n.T)("div");e.getThumbnail().then((t=>{t&&(t.onclick=()=>{this.stage&&this.stage.tabs.some((t=>t.fresco.id===e.id))?this.tabSelect(e.id):this.stage.openFromHistory(e,t)},t.alt=e.name,t.width=Math.round(t.width*(60/t.height)),t.height=60,a.appendChild(t))})),t.append(a)}t.appendChild((0,n.T)("a",{id:"quick-all",href:"#myhistory"},(0,a.A)("all"))),(0,n.Ay)("history-clear").onclick=async()=>{await new T.A("Confirm",(0,a.A)("historyClearConfirm"),(0,a.A)("clear")).init()&&(await C.l.deleteAll(),await this.setHistory(),this.stage&&this.stage.fresco&&this.stage.close(),(0,n.Ay)("splash-close").style.display="none")};for(i=0;i<s.length&&i<50;i++)e.appendChild(this.createHistoryBox(s[i]));s.length>50&&((0,n.Ay)("history-all").style.display="flex",(0,n.Ay)("history-all").onclick=this.showAllHistory),(0,n.Ay)("history-backup").onclick=async()=>{await new T.A("Confirm",(0,a.A)("historyBackupConfirm"),(0,a.A)("backup")).init()&&this.backupHistory()}}},this.backupHistory=async()=>{const t=(0,n.T)("div",{id:"modal-backup",className:"modal"});document.body.appendChild(t);const e=await C.l.history(),s=new Array;for(var i=0;i<e.length&&i<100;i++){document.dispatchEvent(new CustomEvent("loading",{detail:"Creating "+(i+1)+" of "+Math.min(e.length,100)}));const t=e[i],a=new k.A(t.id,t.name,t.width,t.height,t.transparent?void 0:t.color,t.animation,t.templateMeta);await t.restore(a);const n=await(0,D.Ab)(this.stage,{id:a.id,name:a.name,quality:1,nonDestructive:!1,type:"document",unit:"pixel"},a);s.push(new File([n],a.name+".pxz"))}document.dispatchEvent(new CustomEvent("loading",{detail:"Creating zip"}));let o=new I.ZipWriter;for(let a=0;a<s.length;a++){const t=s[a];let e=await t.arrayBuffer(),i=new Uint8Array(e);o.writeFile(t.name,i,!1)}const r=o.finish(),h=new File([new Blob([r.buffer])],"pixlr-backup("+(new Date).toDateString()+").zip",{type:"application/zip"});(0,D.gr)(h,"pixlr-backup-("+(new Date).toLocaleDateString()+")","zip"),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("fileSaved")})),t.remove()},this.showAllHistory=async()=>{(0,n.Ay)("history-all").style.display="none";const t=await C.l.history(),e=(0,n.Ay)("history-content");for(var s=50;s<t.length;s++)e.appendChild(this.createHistoryBox(t[s]))},this.createHistoryBox=t=>{const e=this.stage&&this.stage.tabs.some((e=>e.fresco.id===t.id)),s=e&&t.id===this.stage.fresco.id;let i,r=(0,n.T)("div",{id:t.id,className:"image-box"}),h=(0,n.T)("div",{className:"holder"});r.appendChild(h),e&&(r.classList.add("selected"),r.appendChild((0,n.T)("div",{id:t.id+"-active",className:"active"},s?"active":"open"))),t.getThumbnail().then((e=>{e&&(i=e,e.alt=t.name,e.width=Math.round(e.width*(180/e.height)),e.height=180,h.appendChild(e))}));const d=async e=>{null==e||e.preventDefault(),null==e||e.stopPropagation();const s=(0,n.T)("div",{className:"modal dim"});(0,n.Ay)("splash").append(s),document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));const i="pxz",o=t.name||"Untitled";let r;if(!(P.Ay.useLegacySave||!(0,D.zu)())&&(r=await(0,D.D0)(o,i,"Pixlr document","application/pxz"),!1===r))return document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),void s.remove();const h=new k.A(t.id,t.name,t.width,t.height,t.transparent?void 0:t.color,t.animation,t.templateMeta);await t.restore(h);const c=await(0,D.Ab)(this.stage,{id:h.id,name:o,quality:1,nonDestructive:!1,type:"document",unit:"pixel"},h);if(c)if(r){await(0,D.IF)(r,new File([c],o+"."+i))||(0,D.gr)(new File([c],o+"."+i),o,i)}else(0,D.gr)(new File([c],o+"."+i),o,i);s.remove(),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("fileSaved")})),(0,l.A)("save-file","pxz-home")},u=async e=>{null==e||e.preventDefault(),null==e||e.stopPropagation(),await C.l.duplicate(t.id),this.setHistory()},p=async i=>{var o,r,h;null==i||i.preventDefault(),null==i||i.stopPropagation(),await t.pendingRemove(((i,a)=>{var o,r;i&&console.log(i),a&&(e&&this.tabClose(t.id,!0),s&&((0,n.Ay)(t.id).classList.remove("selected"),null===(o=(0,n.Ay)(t.id+"-active"))||void 0===o||o.remove()),null===(r=(0,n.Ay)(t.id))||void 0===r||r.remove())})),e&&this.tabClose(t.id,!0),s&&((0,n.Ay)(t.id).classList.remove("selected"),null===(o=(0,n.Ay)(t.id+"-active"))||void 0===o||o.remove());let l=(0,n.T)("div",{className:"pending-remove"}),c=(0,n.T)("span",{},(0,a.A)("historyPendingDelete")),d=(0,n.T)("a",{},`↺ ${(0,a.A)("historyUndo")}`);d.addEventListener("click",(async e=>{null==e||e.preventDefault(),null==e||e.stopPropagation(),await t.undoRemove(),(0,n.Ay)(t.id).classList.remove("pending"),l.remove()})),l.append(c,d),null===(r=(0,n.Ay)(t.id))||void 0===r||r.classList.add("pending"),null===(h=(0,n.Ay)(t.id))||void 0===h||h.append(l)},g=(0,n.T)("div",{className:"settings"});r.appendChild(g);const m=(0,n.T)("img",{className:"close",src:"/img/icon/close.svg",alt:`${(0,a.A)("historyDelete")} ${t.name}`});m.addEventListener("click",p),g.appendChild(m);const v=(0,n.T)("img",{className:"more",src:"/img/icon/three-dot.svg",alt:(0,a.A)("documentActions")});v.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();const e=t.currentTarget.getBoundingClientRect();new L.Ay(new c.A(e.x+(0,n.Ay)("splash").scrollLeft+10,e.y+(0,n.Ay)("splash").scrollTop+10),[new L.kt((0,a.A)("historyDownloadPXZ"),d),new L.kt,new L.kt((0,a.A)("historyDuplicate"),u),new L.kt((0,a.A)("historyDelete"),p)])})),g.appendChild(v);let y=document.createElement("input");y.value=t.name?t.name.toLowerCase():"Untitled",y.className="name",y.addEventListener("click",(t=>(t.stopPropagation(),!1))),y.addEventListener("keyup",o.eD(500,(()=>{t.name=y.value,t.save()}))),r.appendChild(y);let f=document.createElement("span");return f.innerText=o.XP(t.lastModified),f.className="since",r.appendChild(f),r.addEventListener("click",(()=>{r.classList.contains("pending")||(this.stage&&this.stage.tabs.some((e=>e.fresco.id===t.id))?this.tabSelect(t.id):this.stage.openFromHistory(t,i).catch((t=>{alert("Error restoring document"),console.error(t)})))}),!1),r},this.setRads=()=>{if("localhost"!==location.hostname&&"beta.pixlr.com"!==location.hostname&&!(null===v.N||void 0===v.N?void 0:v.N.subscription)&&!(0,n.Ay)("right-space")&&document.body.clientWidth>1024){const e=(0,n.T)("div",{id:"right-space"});document.body.appendChild(e);try{document.body.clientWidth>1600?((0,l.A)("ads","cut"),e.style.width="300px",(0,n.Ay)("workspace").style.right="304px",e.appendChild((0,n.T)("iframe",{id:"iasriiigh",src:"/dad/cut/",frameBorder:"0",scrolling:"no",style:"width:300px;height:100%;overflow:hidden;"}))):((0,l.A)("ads","slot"),e.style.width="160px",(0,n.Ay)("workspace").style.right="164px",e.appendChild((0,n.T)("iframe",{id:"iasriiigh",src:"/dad/slot/",frameBorder:"0",scrolling:"no",style:"width:160px;height:100%;overflow:hidden;"})))}catch(t){console.log(t)}const s=()=>{(0,n.Ay)("iasriiigh").src=(0,n.Ay)("iasriiigh").src};window.setInterval(s,18e4)}},this.selectTool=t=>{},this.isSplash=()=>"none"!==(0,n.Ay)("splash").style.display,this.isModal=()=>document.getElementsByClassName("modal").length>0,this.tabSelect=t=>{this.stage.select(t),this.hideSplash()},this.tabClose=(t,e=!1)=>{this.stage.close(t),e||0!==this.stage.tabs.length||this.showSplash()},this.tabCloseAll=(t=!1)=>{this.stage.tabs.map((t=>t.fresco.id)).forEach((t=>this.stage.close(t))),t||this.showSplash()},this.tabCloseOthers=t=>{this.stage.select(t);this.stage.tabs.map((t=>t.fresco.id)).filter((e=>e!==t)).forEach((t=>this.stage.close(t)))},this.tabDuplicate=t=>{this.stage.duplicate(t)},this.tabQuickExport=t=>{this.stage.select(t),this.quickExport()},this.tabSave=(t,e)=>{this.stage.select(t),new m.A(this.stage,e)},this.dragOver=t=>{if(t.preventDefault(),t.stopPropagation(),!(this.isModal()&&this.stage.fresco||(0,n.Ay)("modal-drop"))){const t=document.createElement("div");t.id="modal-drop",t.classList.add("modal","dim"),t.innerHTML=`<div id="dim-message">${(0,a.A)("dropFile")}</div>`,document.body.appendChild(t)}},this.dragOut=t=>{t.preventDefault(),t.stopPropagation(),t.clientX<=0&&(0,n.Ay)("modal-drop")&&(0,n.Ay)("modal-drop").remove()},this.drop=async t=>{if(t.stopPropagation(),t.preventDefault(),(0,n.Ay)("modal-drop")&&(0,n.Ay)("modal-drop").remove(),document.body.style.pointerEvents="auto",this.isModal()&&this.stage.fresco)return;const e=t.dataTransfer.files;for(var s,i=0;s=e[i];i++)await u.Tq(this.stage,s,!0,"drop")},this.cut=async t=>{var e;if(o.Jn(document.activeElement))return;if(this.isModal())return;if(null===(e=this.stage.fresco)||void 0===e?void 0:e.block)return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("notAllowed")}));t.stopPropagation(),t.preventDefault();let s=this.stage.cut();s instanceof HTMLCanvasElement?(this.writeClipboard(t,s),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("cut")}))):navigator.clipboard.writeText("")},this.copy=async t=>{var e;if(o.Jn(document.activeElement))return;if(this.isModal())return;if(null===(e=this.stage.fresco)||void 0===e?void 0:e.block)return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("notAllowed")}));t.stopPropagation(),t.preventDefault();let s=this.stage.copy();s instanceof HTMLCanvasElement?(this.writeClipboard(t,s),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("copy")}))):navigator.clipboard.writeText("")},this.clear=async()=>{this.stage.clear()&&document.dispatchEvent(new CustomEvent("notification",{detail:"clear"}))},this.writeClipboard=async(t,e)=>{const s=await o.PG(e);if(s){this.stage.clipboard=e,this.stage.clipboardSize=new r.A(e.width,e.height);try{const t={name:"clipboard-write"};await navigator.permissions.query(t)}catch(i){console.log(i)}try{const t=new ClipboardItem({"image/png":s});await navigator.clipboard.write([t]),this.stage.clipboard=void 0}catch(i){console.log(i)}}},this.pasteActivatedFromMenu=async()=>{try{const t={name:"clipboard-read"};await navigator.permissions.query(t)}catch(t){console.log(t)}try{const t=await navigator.clipboard.read(),e=await t[0].getType("image/png");if(e)u.Tq(this.stage,new File([e],"clipboard"),!1,"paste"),this.stage.selectionDeselect(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("paste")}));else{if(this.stage.clipboard)return void this.pasteLocal();document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("noPaste")}))}}catch(t){if(console.log(t),this.stage.clipboard)return void this.pasteLocal();document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("emptyPaste")}))}},this.paste=async t=>{if(!this.isModal()&&!o.Jn(document.activeElement)){if(t.clipboardData&&t.clipboardData.items.length>0){const i=t.clipboardData.items;let n;for(var e,s=0;e=i[s];s++)if("file"===e.kind){n=e;break}if(n||(n=i[0]),"string"===n.kind)return void n.getAsString((async e=>{t.preventDefault(),t.stopPropagation();let s=/<img\s[^>]*?src\s*=\s*['\"]([^'\"]*?)['\"][^>]*?>/gi.exec(e);if(s&&s.length>1){let t=await(new g.A).load(s[1]);return u.Tq(this.stage,t,this.isSplash()),this.hideSplash(),void document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("paste")}))}if(this.stage.fresco){e.length>200&&(e=e.substring(0,200));let t=Math.max(16,Math.round(this.stage.fresco.height/20)),s=Math.round(this.stage.fresco.width/1.5),i=Math.round(this.stage.fresco.height/2.5),n=Math.round((this.stage.fresco.width-s)/2),o=new x.A("verdana",t);this.stage.addText(e,new h.A(n,i,s,t),o,"paste"),this.hideSplash(),this.stage.selectionDeselect(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("paste")}))}}));if("file"===n.kind){if(-1==n.type.indexOf("image"))return;t.preventDefault(),t.stopPropagation();const e=n.getAsFile();return u.Tq(this.stage,e,this.isSplash(),"paste"),this.stage.selectionDeselect(),this.hideSplash(),void document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("paste")}))}}else if(this.stage.clipboard)return void this.pasteLocal();document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("emptyPasteGlobal")}))}},this.pasteLocal=()=>{Array.isArray(this.stage.clipboard)?this.stage.pasteLayer():this.stage.clipboard instanceof HTMLCanvasElement&&(this.stage.addImage(o.oM(this.stage.clipboard),(this.stage.fresco,this.stage.fresco.nextAddedLayerNumber()),"paste"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("paste")})),this.stage.selectionDeselect())},this.quickExport=async(t=!1,e="png")=>{var s,i,n,r;if(this.stage.fresco.block)return!1;if(!(null===v.N||void 0===v.N?void 0:v.N.subscription)&&(0,P.P2)())return new M.A("quick-export","save"),!1;let h,c,d;if(t){if(c=null===(i=null===(s=this.stage.fresco)||void 0===s?void 0:s.getSelected())||void 0===i?void 0:i.canvas,!c)return!1;h=(null===(r=null===(n=this.stage.fresco)||void 0===n?void 0:n.getSelected())||void 0===r?void 0:r.settings.name)||"untitled"}else c=this.stage.getOutputCanvas(),h=this.stage.fresco.name||"untitled",this.stage.fresco.savedTimesCounterForUserEase>0&&(h+="("+this.stage.fresco.savedTimesCounterForUserEase+")"),this.stage.fresco.savedTimesCounterForUserEase++;if(h=h.replace(".png","").replace(".jpg",""),!(P.Ay.useLegacySave||!(0,D.zu)())&&(d=await(0,D.D0)(h,e,e.toUpperCase()+" image","image/"+e.replace("jpg","jpeg")),!1===d))return!1;const u=await o.PG(c,{type:"image/"+e.replace("jpg","jpeg"),quality:1}),p=new File([u],h+"."+e,{type:"image/"+e.replace("jpg","jpeg")});return d?(await(0,D.IF)(d,p),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.A)("fileSaved")}))):(0,D.gr)(p,h,e),(0,P.pp)(),(0,l.A)("quick-export",t?"layer":"image"),!0},this.urlClick=t=>{(0,l.A)("open-url"),new E.A(this.stage)},this.newClick=t=>{(0,l.A)("open-new"),new S.A(this.stage)},this.openClick=async t=>{(0,l.A)("open-browse"),await u.XN(!0).then((async t=>{for(let e=0;e<t.length;e++)await u.Tq(this.stage,t[e])}))},this.closeClick=()=>{(0,l.A)("close"),this.selectTool(),this.tabClose()},this.saveClick=()=>{(0,l.A)("save"),this.selectTool(),new m.A(this.stage)};new A.A,new y.A;if((window.matchMedia("(display-mode: standalone)").matches||document.referrer.includes("android-app://"))&&(document.title="Pixlr Editor",document.documentElement.classList.add("standalone")),P.Ay.performanceMode&&(null===(t=(0,n.Ay)("splash-reels"))||void 0===t||t.remove()),document.addEventListener("cut",this.cut,!0),document.addEventListener("copy",this.copy,!0),document.addEventListener("paste",this.paste,!0),document.addEventListener("cut-menu",(()=>document.execCommand("cut")),!0),document.addEventListener("copy-menu",(()=>document.execCommand("copy")),!0),document.addEventListener("paste-menu",this.pasteActivatedFromMenu,!0),document.addEventListener("clear-menu",(()=>this.clear()),!0),document.addEventListener("dragover",this.dragOver,!0),document.addEventListener("dragleave",this.dragOut,!0),document.addEventListener("drop",this.drop,!0),document.addEventListener("navigate",(t=>this.navigate(t.detail))),this.stage=new d.A((0,n.Ay)("workspace")),null===(e=(0,n.Ay)("head-settings"))||void 0===e||e.replaceWith((0,n.Ay)("head-settings").cloneNode(!0)),null===(s=(0,n.Ay)("head-settings"))||void 0===s||s.addEventListener("click",(()=>new z.A(this.stage))),null===(i=(0,n.Ay)("head-menu-settings"))||void 0===i||i.replaceWith((0,n.Ay)("head-menu-settings").cloneNode(!0)),null===(F=(0,n.Ay)("head-menu-settings"))||void 0===F||F.addEventListener("click",(()=>new z.A(this.stage))),P.Ay.tabLimit&&(this.stage.tabLimit=P.Ay.tabLimit),P.Ay.file){new g.A({title:P.Ay.name||P.Ay.file.substring(P.Ay.file.lastIndexOf("/")+1),referrer:P.Ay.referrer}).load("/proxy/?url="+encodeURIComponent(P.Ay.file)).then((async t=>{await u.Tq(this.stage,t,void 0,"api"),"http"===P.Ay.api&&P.Ay.target&&(this.stage.fresco.saveMethod=new URL(P.Ay.target))}))}"embedded"===P.Ay.api&&(0,b.E)(this.stage),P.Ay.api&&((0,n.Ay)("toggle-home").style.display="none"),P.Ay.file||P.Ay.api||!P.Ay.tool&&!P.Ay.task||this.setUpDeepLink(),async function(){var t,e,s,i;const a=await w.A.loadSaved();try{for(var n,o=!0,r=_(a);!(t=(n=await r.next()).done);o=!0){i=n.value,o=!1;const t=i;w.A.fontList.unshift(t)}}catch(h){e={error:h}}finally{try{o||t||!(s=r.return)||await s.call(r)}finally{if(e)throw e.error}}}(),P.Ay.api||(this.setUpSplash(),this.setHistory(),this.setRads()),document.dispatchEvent(new CustomEvent("resize"))}}i()}catch(R){i(R)}}))},46825:(t,e,s)=>{var i=s(29821);t.exports=s.v(e,t.id,"9826786be4943de684a7",{"./pixlr_bg.js":{__wbg_x_7af334499c70ecf9:i._k,__wbg_y_7b2e0b17f2702db7:i._4,__wbg_width_9a7937fdc4208452:i.zP,__wbg_height_c0440005f53e9792:i.Qm,__wbindgen_memory:i.Py,__wbg_buffer_085ec1f694018c4f:i.Qj,__wbg_newwithbyteoffsetandlength_a624c98280289b0f:i.Zi,__wbindgen_object_drop_ref:i.bk,__wbg_new_4c0b35176d4e6c47:i.HY,__wbindgen_string_new:i.yc,__wbindgen_throw:i.Qn}})}},l={};function c(t){var e=l[t];if(void 0!==e)return e.exports;var s=l[t]={id:t,loaded:!1,exports:{}};return h[t](s,s.exports,c),s.loaded=!0,s.exports}c.m=h,t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",s="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",i=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},c.a=(a,n,o)=>{var r;o&&((r=[]).d=-1);var h,l,c,d=new Set,u=a.exports,p=new Promise(((t,e)=>{c=e,l=t}));p[e]=u,p[t]=t=>(r&&t(r),d.forEach(t),p.catch((t=>{}))),a.exports=p,n((a=>{var n;h=(a=>a.map((a=>{if(null!==a&&"object"==typeof a){if(a[t])return a;if(a.then){var n=[];n.d=0,a.then((t=>{o[e]=t,i(n)}),(t=>{o[s]=t,i(n)}));var o={};return o[t]=t=>t(n),o}}var r={};return r[t]=t=>{},r[e]=a,r})))(a);var o=()=>h.map((t=>{if(t[s])throw t[s];return t[e]})),l=new Promise((e=>{(n=()=>e(o)).r=0;var s=t=>t!==r&&!d.has(t)&&(d.add(t),t&&!t.d&&(n.r++,t.push(n)));h.map((e=>e[t](s)))}));return n.r?l:o()}),(t=>(t?c(p[s]=t):l(u),i(r)))),r&&r.d<0&&(r.d=0)},c.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return c.d(e,{a:e}),e},n=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,c.t=function(t,e){if(1&e&&(t=this(t)),8&e)return t;if("object"==typeof t&&t){if(4&e&&t.__esModule)return t;if(16&e&&"function"==typeof t.then)return t}var s=Object.create(null);c.r(s);var i={};a=a||[null,n({}),n([]),n(n)];for(var o=2&e&&t;"object"==typeof o&&!~a.indexOf(o);o=n(o))Object.getOwnPropertyNames(o).forEach((e=>i[e]=()=>t[e]));return i.default=()=>t,c.d(s,i),s},c.d=(t,e)=>{for(var s in e)c.o(e,s)&&!c.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},c.f={},c.e=t=>Promise.all(Object.keys(c.f).reduce(((e,s)=>(c.f[s](t,e),e)),[])),c.u=t=>(({885:"pdf-lib",1161:"infill",2904:"ffmpeg",4990:"tiff",5395:"gif",7162:"checkout.modal",8636:"adyen",9262:"native"}[t]||t)+"."+{28:"3f8e243098eb4ed1aa45",76:"817e251081a539bd1ca1",106:"c5e78eed4d963799941a",443:"3ac22cee36571d9026d0",885:"95c8393926116c130e7b",936:"0b17e40b18340aba1aaf",1161:"aab2b28702a63d7b2744",1455:"3448fdbfb4e568991c5c",1810:"5c716562a96cf943d7a8",1983:"796bbd38a34aad2a2e48",1993:"eb8a60cf233ed866ea38",2016:"97f94bb2b727d55c73ef",2355:"980b5eb359b58998ea34",2724:"51af1eb5b89292de38b6",2904:"f17c774ac9d2ff5f2d9d",3329:"a5f94a304f74c6e330de",3846:"17851a3b87464d1ae8c0",4224:"1c2ede1ecb5d15a8ae7a",4990:"d4b34fae8a5ce656b0d9",5234:"276cab3587d25f002d92",5395:"2a0d98f6bd7956c025f5",5404:"276f31dd7d79c6c11d7f",5480:"cf562288683f8dfa987b",5746:"3a8a85f9ae9d10665e62",5778:"67a0069b42446289b3ab",5884:"80b25fb75b385e3a24ff",6825:"9da1249fbcd48f1796ad",7162:"83511f6f191a125af7b6",7687:"fadd9146ce1b48aea74c",7796:"d645ee439bb934c122b4",8090:"367a67ca6bd5c1e5037c",8636:"4df030c9463eba74c3b1",8746:"c30676b1ad27b73749d9",9262:"036b05aad1321d32d44e"}[t]+".js"),c.miniCssF=t=>{},c.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),c.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),c.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o={},r="pixlr:",c.l=(t,e,s,i)=>{if(o[t])o[t].push(e);else{var a,n;if(void 0!==s)for(var h=document.getElementsByTagName("script"),l=0;l<h.length;l++){var d=h[l];if(d.getAttribute("src")==t||d.getAttribute("data-webpack")==r+s){a=d;break}}a||(n=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,c.nc&&a.setAttribute("nonce",c.nc),a.setAttribute("data-webpack",r+s),a.src=t),o[t]=[e];var u=(e,s)=>{a.onerror=a.onload=null,clearTimeout(p);var i=o[t];if(delete o[t],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((t=>t(s))),e)return e(s)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),n&&document.head.appendChild(a)}},c.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.v=(t,e,s,i)=>{var a=fetch(c.p+""+s+".module.wasm"),n=()=>a.then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,i))).then((e=>Object.assign(t,e.instance.exports)));return a.then((e=>"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,i).then((e=>Object.assign(t,e.instance.exports)),(t=>{if("application/wasm"!==e.headers.get("Content-Type"))return console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t),n();throw t})):n()))},c.p="/dist/",(()=>{c.b=document.baseURI||self.location.href;var t={6008:0,9262:0,2355:0,6825:0};c.f.j=(e,s)=>{var i=c.o(t,e)?t[e]:void 0;if(0!==i)if(i)s.push(i[2]);else{var a=new Promise(((s,a)=>i=t[e]=[s,a]));s.push(i[2]=a);var n=c.p+c.u(e),o=new Error;c.l(n,(s=>{if(c.o(t,e)&&(0!==(i=t[e])&&(t[e]=void 0),i)){var a=s&&("load"===s.type?"missing":s.type),n=s&&s.target&&s.target.src;o.message="Loading chunk "+e+" failed.\n("+a+": "+n+")",o.name="ChunkLoadError",o.type=a,o.request=n,i[1](o)}}),"chunk-"+e,e)}};var e=(e,s)=>{var i,a,[n,o,r]=s,h=0;if(n.some((e=>0!==t[e]))){for(i in o)c.o(o,i)&&(c.m[i]=o[i]);if(r)r(c)}for(e&&e(s);h<n.length;h++)a=n[h],c.o(t,a)&&t[a]&&t[a][0](),t[a]=0},s=self.webpackChunkpixlr=self.webpackChunkpixlr||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})(),c.nc=void 0;var d=c(55696);editor=d})();